<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; worker-src 'self' blob:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self' https://*.streamr.network https://*.streamr.network:8002 wss://*.streamr.network wss://*.streamr-nodes.xyz wss://*.streamr-nodes.xyz:32200 https://rpc.ankr.com https://polygon.drpc.org https://polygon-bor-rpc.publicnode.com https://*.thegraph.com https://*.ens.domains https://euc.li; base-uri 'self'; form-action 'self'">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pombo - P2P Decentralized Chat</title>

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
    <link rel="shortcut icon" href="/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <meta name="theme-color" content="#121212">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS (built from src/styles/input.css) -->
    <link href="./css/output.css" rel="stylesheet">
    <!-- Component styles (extracted for maintainability) -->
    <link href="./css/components.css" rel="stylesheet">

    <!-- Vendor Bundle: Streamr Client + Ethers.js + QRCode -->
    <script src="./js/vendor.bundle.js"></script>
</head>
<body class="h-screen overflow-hidden">
    <!-- Global header spans full width -->
    <header class="bg-[#0d0d0d] border-b border-[#333] h-14 flex items-center justify-between px-5 flex-shrink-0">
        <!-- Left side: Logo and brand -->
        <div class="flex items-center gap-3">
            <!-- Logo -->
            <svg viewBox="0 0 512 512" class="w-12 h-12 header-logo" fill="#ff5c00">
                <g transform="translate(0,512) scale(0.1,-0.1)">
                    <path d="M3138 4803 c-88 -35 -88 -35 -88 -89 0 -52 1 -54 28 -54 15 -1 43 -3 62 -6 34 -5 37 -2 112 91 78 95 78 95 25 94 -34 -1 -82 -13 -139 -36z m88 -13 c11 0 12 -3 4 -12 -6 -7 -24 -31 -41 -53 -17 -22 -37 -39 -45 -39 -8 1 -20 2 -27 3 -17 1 -42 51 -26 51 6 0 8 4 5 9 -3 5 1 12 10 15 9 4 13 2 8 -5 -4 -7 6 -3 22 8 49 32 69 41 72 32 2 -5 10 -9 18 -9z"/>
                    <path d="M2878 4730 c-63 -5 -101 -14 -142 -34 -144 -70 -260 -256 -272 -434 -8 -122 7 -216 71 -456 55 -203 56 -212 54 -325 -3 -136 -17 -219 -57 -334 -28 -84 -28 -84 141 -25 169 58 169 58 371 -3 202 -62 202 -62 226 -103 13 -23 67 -107 121 -188 99 -148 99 -148 88 -370 -12 -241 5 -204 -312 -685 -24 -36 -545 -362 -612 -383 -22 -7 -87 -30 -145 -50 -485 -176 -450 -165 -1035 -315 -141 -36 -186 -52 -210 -73 -16 -15 -127 -122 -246 -239 -215 -213 -215 -213 173 -213 388 0 388 0 551 217 89 120 165 222 168 226 3 5 116 37 250 71 134 35 254 66 267 70 21 7 22 5 22 -49 0 -56 0 -56 123 -189 67 -73 136 -152 152 -176 29 -42 29 -42 -3 -71 -24 -21 -43 -29 -71 -29 -36 0 -107 -39 -126 -69 -11 -19 86 -13 141 8 51 20 51 20 254 -15 169 -29 224 -34 322 -32 118 3 118 3 96 35 -38 53 -73 63 -216 63 -181 0 -188 4 -320 189 -92 129 -102 147 -92 166 6 12 73 101 148 198 130 167 143 180 242 250 275 192 498 357 504 372 2 7 69 116 147 242 158 252 152 236 164 442 3 58 8 143 11 188 5 76 2 96 -46 270 -148 541 -118 469 -348 838 -113 182 -220 353 -237 382 -35 57 -37 76 -39 360 -1 123 -1 123 -73 124 -40 1 -79 2 -85 3 -9 1 -14 26 -16 79 -2 42 -6 76 -10 76 -4 -1 -46 -5 -94 -9z"/>
                    <path d="M2730 4570 c-8 -5 -25 -10 -37 -10 -13 0 -22 -3 -21 -7 1 -5 -6 -23 -15 -40 -22 -41 -22 -39 -2 -70 9 -14 12 -22 6 -19 -6 4 -9 2 -5 -6 8 -21 53 -50 82 -53 35 -4 104 28 120 55 8 12 9 19 3 15 -6 -3 -11 -2 -11 4 0 5 4 12 9 15 10 7 9 19 -7 59 -7 16 -12 33 -12 39 0 6 -3 8 -6 5 -4 -3 -16 0 -28 8 -24 17 -54 19 -76 5z m69 -25 c33 -16 41 -33 41 -80 0 -42 -38 -75 -86 -75 -87 0 -112 118 -34 157 32 16 45 16 79 -2z"/>
                    <path d="M2645 3034 c-190 -65 -190 -65 -331 -242 -77 -97 -206 -258 -286 -357 -146 -180 -146 -180 -112 -394 19 -121 39 -220 46 -227 7 -6 75 -64 151 -127 138 -115 138 -115 304 -162 166 -46 166 -46 247 5 44 27 159 98 255 157 173 108 173 108 265 248 50 77 119 182 154 234 60 92 62 97 62 161 0 36 3 124 6 197 6 132 6 132 -101 298 -60 91 -111 168 -115 170 -7 4 -348 105 -352 104 -2 0 -88 -30 -193 -65z"/>
                    <path d="M1730 2057 c-47 -61 -156 -203 -242 -316 -158 -205 -158 -205 -430 -423 -249 -199 -275 -222 -301 -273 -15 -32 -27 -58 -25 -59 2 -1 20 -7 41 -13 34 -10 75 -2 430 88 215 54 462 117 547 139 175 46 705 229 693 240 -4 3 -55 19 -113 35 -58 15 -114 33 -125 40 -16 10 -285 234 -319 266 -5 5 -22 92 -37 194 -14 102 -28 187 -30 189 -2 2 -42 -47 -89 -107z"/>
                    <path d="M3050 1305 c-69 -51 -136 -108 -151 -126 -14 -19 -54 -72 -90 -119 -36 -47 -68 -91 -73 -97 -4 -8 29 -53 93 -125 56 -62 101 -116 101 -120 0 -3 -11 -20 -25 -36 -14 -17 -25 -33 -25 -36 0 -3 56 -6 124 -6 142 0 211 -17 256 -62 28 -28 28 -28 170 -28 137 0 140 0 130 20 -6 11 -27 31 -48 45 -35 24 -44 25 -172 25 -218 0 -240 12 -352 190 -44 69 -82 131 -85 137 -3 7 50 93 118 190 67 98 131 191 142 206 10 16 18 30 16 32 -2 2 -60 -38 -129 -90z"/>
                </g>
            </svg>
            <!-- Status dot and Pombo name -->
            <div class="flex flex-col">
                <div class="flex items-center gap-1.5" title="Streamr Network">
                    <div id="network-dot" class="w-2.5 h-2.5 rounded-full bg-[#444] transition-colors"></div>
                    <span class="text-[17px] font-extrabold text-white tracking-tight leading-tight ml-1">Pombo</span>
                </div>
            </div>
        </div>
        
        <!-- Right side: Wallet controls -->
        <div class="flex items-center gap-3">
            <div id="wallet-info" class="text-sm text-[#666] cursor-pointer hover:text-white transition font-mono" title="Click to copy address">Not Connected</div>
            <button id="connect-wallet" class="bg-white hover:bg-[#f0f0f0] text-black px-3 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-1.5">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/>
                </svg>
                Connect
            </button>
            <div id="wallet-controls" class="hidden flex items-center gap-1">
                <button id="switch-wallet" class="hidden bg-[#1a1a1a] hover:bg-[#252525] border border-[#282828] p-1.5 rounded-lg transition" title="Switch Account">
                    <svg class="w-3.5 h-3.5 text-[#888]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"/>
                    </svg>
                </button>
                <button id="disconnect-wallet" class="bg-[#1a1a1a] hover:bg-[#252525] border border-[#282828] text-[#888] hover:text-white px-3 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-1.5">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"/>
                    </svg>
                    <span>Disconnect</span>
                </button>
            </div>
        </div>
    </header>
    
    <!-- App Container - Full Height -->
    <div class="flex app-container">
        <!-- Sidebar - Channel List (Full Height) -->
        <aside id="sidebar" class="sidebar w-80 bg-[#0d0d0d] border-r border-[#333] flex flex-col flex-shrink-0">
            <!-- Channel Controls -->
            <div class="px-3 pb-2 space-y-2.5 pt-4">
                <div class="flex items-center justify-between">
                    <span class="text-xs font-medium text-[#666] uppercase tracking-wider">Channels</span>
                    <button id="new-channel-btn" class="p-1.5 hover:bg-[#252525] rounded-lg transition group" title="New Channel">
                        <svg class="w-4 h-4 text-[#888] group-hover:text-white transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.5v15m7.5-7.5h-15"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Quick join + Explore row -->
                <div class="flex items-center gap-2">
                    <!-- Channel ID input -->
                    <div class="relative w-[42%] flex-shrink-0">
                        <span id="quick-join-hash" class="absolute left-2.5 top-1/2 -translate-y-1/2 text-sm font-medium text-[#555] hidden">#</span>
                        <input
                            type="text"
                            id="quick-join-input"
                            placeholder="Join with #ID..."
                            autocomplete="off"
                            style="text-overflow: ellipsis;"
                            class="w-full bg-[#141414] border border-[#1f1f1f] text-white px-3 py-2 rounded-lg text-sm placeholder-[#555] focus:outline-none focus:border-[#333] transition overflow-hidden quick-join-field"
                        />
                    </div>
                    
                    <!-- Explore/Join button (60-65%) -->
                    <button id="browse-channels-btn" class="flex-1 bg-[#141414] hover:bg-[#1a1a1a] border border-[#1f1f1f] px-3 py-2 rounded-lg text-sm text-[#888] hover:text-white transition flex items-center justify-center gap-1.5">
                        <svg id="browse-btn-icon" class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418"/>
                        </svg>
                        <span id="browse-btn-text">Explore</span>
                    </button>
                </div>
                
                <!-- Channel Filter Tabs -->
                <div class="flex items-center mt-3 border-b border-[#1f1f1f]">
                    <button data-channel-filter="all" class="channel-filter-tab flex-1 py-2.5 text-[10px] font-light uppercase tracking-widest transition-all text-[#F6851B] border-b-2 border-[#F6851B] -mb-px">
                        All
                    </button>
                    <button data-channel-filter="personal" class="channel-filter-tab flex-1 py-2.5 text-[10px] font-light uppercase tracking-widest transition-all text-white/40 hover:text-white/60 border-b-2 border-transparent -mb-px">
                        Personal
                    </button>
                    <button data-channel-filter="community" class="channel-filter-tab flex-1 py-2.5 text-[10px] font-light uppercase tracking-widest transition-all text-white/40 hover:text-white/60 border-b-2 border-transparent -mb-px">
                        Communities
                    </button>
                </div>
            </div>

            <!-- Channel List -->
            <div id="channel-list" class="flex-1 overflow-y-auto space-y-1.5 py-2">
                <!-- Channels will be dynamically added here -->
                <div class="p-4 text-center text-[#555] text-sm">
                    No channels yet
                </div>
            </div>

            <!-- Sidebar Footer -->
            <div class="p-3 border-t border-[#1f1f1f] space-y-1">
                <button id="contacts-btn" class="hidden w-full px-3 py-2 rounded-lg text-sm text-[#888] hover:text-white hover:bg-[#252525] transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    Contacts
                </button>
                <button id="settings-btn" class="hidden w-full px-3 py-2 rounded-lg text-sm text-[#888] hover:text-white hover:bg-[#252525] transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Settings
                </button>
            </div>
        </aside>

        <!-- Right Content Area (Chat) -->
        <div id="chat-area" class="chat-area flex-1 flex flex-col min-w-0">


            <!-- Main Chat Area -->
            <main class="flex-1 flex flex-col bg-[#161616] overflow-hidden">
            <!-- Chat Header -->
            <div id="chat-header" class="bg-[#0d0d0d] border-b border-[#333] px-5 py-4 flex items-center">
                <!-- Close button (mobile: left side) -->
                <button id="close-channel-btn" class="hidden p-2 hover:bg-gray-700 rounded-lg transition text-gray-400 hover:text-white mobile-close-btn" title="Close channel">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
                <!-- Left: Channel name -->
                <div class="flex-1">
                    <div class="flex items-center gap-2">
                        <h2 id="current-channel-name" class="text-xl font-semibold">Explore Channels</h2>
                        <button id="channel-menu-btn" class="hidden p-1 hover:bg-gray-700 rounded transition text-gray-400 hover:text-gray-200" title="Channel options">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="flex items-center gap-1.5 text-sm text-gray-400 min-h-[20px]">
                        <span id="current-channel-info" class="inline-flex items-center"></span>
                        <span id="online-separator" class="hidden leading-none">·</span>
                        <div class="relative inline-flex items-center">
                            <button id="online-header" class="hidden items-center gap-1 hover:text-gray-300 transition">
                                <span id="online-users-count">0</span>
                                <span>Online</span>
                                <span class="text-xs leading-none rotate-90">›</span>
                            </button>
                            <div id="online-users-list" class="absolute top-full left-0 mt-1 w-56 bg-[#2a2a2a] border border-gray-700 rounded-lg p-3 z-20 hidden max-h-48 overflow-y-auto">
                                <div class="text-gray-400 text-sm text-center">No one online</div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Center: Explore type tabs (shown only in Explore view) -->
                <div id="explore-type-tabs" class="hidden flex items-center justify-center">
                    <button type="button" data-browse-filter="public" class="browse-filter-tab px-3 py-1.5 text-[10px] font-light uppercase tracking-widest transition-all text-[#F6851B] border-b-2 border-[#F6851B] -mb-px">
                        Public
                    </button>
                    <button type="button" data-browse-filter="password" class="browse-filter-tab px-3 py-1.5 text-[10px] font-light uppercase tracking-widest transition-all text-white/40 hover:text-white/60 border-b-2 border-transparent -mb-px">
                        Private
                    </button>
                </div>
                <!-- Right: Action buttons -->
                <div id="chat-header-right" class="flex-1 flex items-center justify-end space-x-3">
                    <div class="flex space-x-2">
                    <!-- Join button (shown in preview mode) -->
                    <button id="join-channel-btn" class="hidden px-3 py-1.5 bg-[#F6851B]/15 hover:bg-[#F6851B]/25 text-[#F6851B] border border-[#F6851B]/40 text-sm font-medium rounded-lg transition flex items-center gap-1.5" title="Add to My Channels">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.5v15m7.5-7.5h-15"/>
                        </svg>
                        <span>Join</span>
                    </button>
                    <button id="invite-users-btn" class="p-2 hover:bg-gray-700 rounded-lg transition hidden" title="Invite Users">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                    </button>
                    <!-- Close button (desktop: right side) -->
                    <button id="close-channel-btn-desktop" class="hidden p-2 hover:bg-gray-700 rounded-lg transition text-gray-400 hover:text-white desktop-close-btn" title="Close channel">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    </div>
                </div>
            </div>

            <!-- Messages Area -->
            <div id="messages-area" class="flex-1 overflow-y-auto p-4 messages-area">
            </div>

            <!-- Typing Indicator -->
            <div id="typing-indicator" class="hidden px-4 py-1 text-sm text-gray-400">
                <span id="typing-users"></span> typing
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
            </div>

            <!-- Reply Bar -->
            <div id="reply-bar" class="reply-bar">
                <div class="reply-bar-info">
                    <span class="reply-bar-label">Replying to <span id="reply-to-name" class="reply-bar-name"></span></span>
                    <span id="reply-to-text" class="reply-bar-text"></span>
                </div>
                <span id="reply-bar-close" class="reply-bar-close" title="Cancel reply">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </span>
            </div>

            <!-- Message Input -->
            <div id="message-input-container" class="bg-[#0d0d0d] border-t border-[#222] p-4 hidden">
                <div class="relative flex items-center gap-2">
                    <!-- Emoji Picker -->
                    <div id="emoji-picker" class="emoji-picker"></div>
                    
                    <!-- Attach Button -->
                    <div class="relative input-btn-wrapper">
                        <button id="attach-btn" class="input-button text-[#666] hover:text-white transition" title="Attach">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"/>
                            </svg>
                        </button>
                        <!-- Attach Menu -->
                        <div id="attach-menu" class="hidden absolute bottom-12 left-0 bg-[#1e1e1e] border border-gray-700 rounded-lg py-1 z-50 min-w-[140px] shadow-xl">
                            <button id="send-image-btn" class="w-full text-left px-4 py-2 hover:bg-[#2a2a2a] text-sm flex items-center gap-2 text-white">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"/>
                                </svg>
                                Image
                            </button>
                            <button id="send-video-btn" class="w-full text-left px-4 py-2 hover:bg-[#2a2a2a] text-sm flex items-center gap-2 text-white">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"/>
                                </svg>
                                Video
                            </button>
                        </div>
                    </div>
                    
                    <!-- Emoji Button -->
                    <button id="emoji-btn" class="input-button text-[#666] hover:text-white transition input-btn-wrapper" title="Emoji">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </button>
                    
                    <!-- Hidden File Inputs -->
                    <input type="file" id="image-input" class="hidden" accept="image/jpeg,image/png,image/gif,image/webp">
                    <input type="file" id="video-input" class="hidden" accept="video/mp4,video/webm,video/quicktime">
                    
                    <!-- Input -->
                    <textarea
                        id="message-input"
                        placeholder="Type a message..."
                        autocomplete="off"
                        rows="1"
                        class="flex-1 bg-[#1a1a1a] text-white px-4 py-3 rounded-2xl focus:outline-none focus:border-[#444] border border-[#282828] text-sm transition resize-none overflow-y-auto min-h-[44px] max-h-[120px] leading-5"
                    ></textarea>
                    
                    <!-- Send Button: transparent, dark-orange arrow icon -->
                    <button id="send-message-btn" class="bg-transparent w-9 h-9 transition flex items-center justify-center p-0" aria-label="Send message">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6.5 w-6.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                        </svg>
                    </button>
                </div>
            </div>
        </main>
        </div>
    </div>

    <!-- Modal: New Channel -->
    <div id="new-channel-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="bg-[#141414] rounded-2xl w-[640px] max-w-[95vw] shadow-2xl border border-white/5 overflow-hidden">
            <!-- Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-white/5">
                <h3 class="text-lg font-medium text-white/90">Create Channel</h3>
                <button id="cancel-channel-btn" class="text-white/40 hover:text-white/80 transition p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="flex min-h-[400px]">
                <!-- Sidebar: Channel Type -->
                <div class="w-40 bg-[#0a0a0a] border-r border-white/5 py-3 flex flex-col">
                    <div class="px-3 mb-2">
                        <span class="text-[10px] font-medium text-white/30 uppercase tracking-wider">Type</span>
                    </div>
                    <nav class="space-y-1 px-2 flex-1">
                        <button type="button" data-tab="public" class="channel-tab w-full flex items-center gap-2.5 px-3 py-2.5 rounded-lg text-sm text-left transition-all bg-white/10 text-white">
                            <svg class="w-4 h-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                            <span>Open</span>
                        </button>
                        <button type="button" data-tab="password" class="channel-tab w-full flex items-center gap-2.5 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/60 hover:text-white/90 hover:bg-white/5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/></svg>
                            <span>Protected</span>
                        </button>
                        <button type="button" data-tab="native" class="channel-tab w-full flex items-center gap-2.5 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/60 hover:text-white/90 hover:bg-white/5">
                            <svg class="w-4 h-4" viewBox="0 0 320 512" fill="currentColor"><path d="M311.9 260.8L160 353.6 8 260.8 160 0l151.9 260.8zM160 383.4L8 290.6 160 512l152-221.4-152 92.8z"/></svg>
                            <span>Closed</span>
                        </button>
                    </nav>
                    <!-- Learn More Button -->
                    <div class="px-2 pt-3 border-t border-white/5 mt-auto">
                        <button type="button" id="channel-info-help-btn" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg text-xs text-white/40 hover:text-white/60 hover:bg-white/5 transition">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"/></svg>
                            <span>Learn more</span>
                        </button>
                    </div>
                </div>

                <!-- Content Panel -->
                <div class="flex-1 p-5 overflow-y-auto">
                    <div class="space-y-5">
                        <!-- Channel Name -->
                        <div>
                            <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Channel Name</label>
                            <input
                                type="text"
                                id="channel-name-input"
                                placeholder="e.g. general"
                                class="w-full bg-white/5 border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-white/30 transition placeholder:text-white/20"
                            />
                        </div>

                        <!-- Tab Content: Public -->
                        <div id="tab-public" class="channel-tab-content space-y-4">
                            <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                                <p class="text-sm text-white/50 leading-relaxed">
                                    Open channel that anyone can discover and join. Messages are visible to all participants
                                </p>
                            </div>
                            <input type="hidden" name="channel-type" value="public" class="channel-type-input">
                        </div>

                        <!-- Tab Content: Password -->
                        <div id="tab-password" class="channel-tab-content hidden space-y-4">
                            <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                                <p class="text-sm text-white/50 leading-relaxed">
                                    Password protected channel. Only users with the correct password can join and read messages.
                                </p>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Password</label>
                                <input
                                    type="password"
                                    id="channel-password-input"
                                    placeholder="Enter a secure password"
                                    autocomplete="new-password"
                                    class="w-full bg-white/5 border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-white/30 transition placeholder:text-white/20"
                                />
                            </div>
                            <input type="hidden" name="channel-type" value="password" class="channel-type-input">
                        </div>

                        <!-- Tab Content: Native (Closed) -->
                        <div id="tab-native" class="channel-tab-content hidden space-y-4">
                            <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-[10px] bg-white/10 text-white/60 px-1.5 py-0.5 rounded uppercase tracking-wider">Most Secure</span>
                                </div>
                                <p class="text-sm text-white/50 leading-relaxed">
                                    Private channel with on-chain verified membership. Each member is authorized by account address.
                                </p>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Member Addresses</label>
                                <textarea
                                    id="channel-members-input"
                                    placeholder="0x1234...&#10;0x5678...&#10;0xabcd..."
                                    rows="3"
                                    class="w-full bg-white/5 border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-white/30 transition resize-none font-mono placeholder:text-white/20"
                                ></textarea>
                            </div>
                            <!-- Classification for Closed channels -->
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Classification</label>
                                <div class="flex gap-2">
                                    <button type="button" data-classification="personal" class="classification-tab flex-1 px-3 py-2 rounded-lg text-xs font-medium transition bg-white/10 text-white border border-white/10">
                                        Personal
                                    </button>
                                    <button type="button" data-classification="community" class="classification-tab flex-1 px-3 py-2 rounded-lg text-xs font-medium transition bg-white/5 text-white/50 border border-white/5 hover:bg-white/10 hover:text-white/70">
                                        Community
                                    </button>
                                </div>
                                <p class="text-xs text-white/30 mt-2">For organizing your channels locally.</p>
                            </div>
                            <input type="hidden" name="channel-type" value="native" class="channel-type-input">
                        </div>

                        <!-- Divider -->
                        <div class="border-t border-white/5"></div>

                        <!-- Visibility Selection -->
                        <div id="exposure-section">
                            <div class="flex items-center justify-between">
                                <label class="text-xs font-medium text-white/30 uppercase tracking-wider">Visibility</label>
                                <div class="flex gap-1">
                                    <button type="button" data-exposure="hidden" class="exposure-tab px-2.5 py-1 rounded text-xs transition-all bg-[#F6851B]/20 text-[#F6851B]">
                                        Hidden
                                    </button>
                                    <button type="button" data-exposure="visible" class="exposure-tab px-2.5 py-1 rounded text-xs transition-all text-white/30 hover:text-white/50 hover:bg-white/5">
                                        Visible
                                    </button>
                                </div>
                            </div>
                            <p class="text-xs text-white/20 mt-1.5">Visible channels appear in Explore.</p>
                        </div>

                        <!-- Read-Only Toggle -->
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-xs font-medium text-white/30 uppercase tracking-wider">Read-Only</label>
                                <p class="text-xs text-white/20 mt-0.5">Only you can send messages</p>
                            </div>
                            <button type="button" id="read-only-toggle" class="relative w-9 h-5 rounded-full transition-colors bg-white/10" data-enabled="false">
                                <span class="absolute left-0.5 top-0.5 w-4 h-4 rounded-full bg-white/30 transition-all"></span>
                            </button>
                        </div>

                        <!-- Visible Channel Fields -->
                        <div id="visible-fields" class="hidden space-y-4">
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Description</label>
                                <textarea
                                    id="channel-description-input"
                                    placeholder="What's this channel about?"
                                    rows="2"
                                    maxlength="200"
                                    class="w-full bg-white/5 border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-white/30 transition resize-none placeholder:text-white/20"
                                ></textarea>
                            </div>
                            <div class="flex gap-3">
                                <div class="flex-1">
                                    <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Language</label>
                                    <select id="channel-language-input" class="w-full bg-[#1a1a1a] border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-white/30 transition cursor-pointer">
                                        <option value="en">English</option>
                                        <option value="pt">Português</option>
                                        <option value="es">Español</option>
                                        <option value="fr">Français</option>
                                        <option value="de">Deutsch</option>
                                        <option value="it">Italiano</option>
                                        <option value="zh">中文</option>
                                        <option value="ja">日本語</option>
                                        <option value="ko">한국어</option>
                                        <option value="ru">Русский</option>
                                        <option value="ar">العربية</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="flex-1">
                                    <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Category</label>
                                    <select id="channel-category-input" class="w-full bg-[#1a1a1a] border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-white/30 transition cursor-pointer">
                                        <option value="politics">Politics</option>
                                        <option value="news">News</option>
                                        <option value="tech">Tech & AI</option>
                                        <option value="crypto">Crypto & Web3</option>
                                        <option value="finance">Business & Finance</option>
                                        <option value="science">Science</option>
                                        <option value="gaming">Gaming</option>
                                        <option value="entertainment">Entertainment</option>
                                        <option value="sports">Sports</option>
                                        <option value="education">Education</option>
                                        <option value="comedy">Comedy & Memes</option>
                                        <option value="general">General</option>
                                        <option value="nsfw">NSFW (18+)</option>
                                        <option value="adult">Adult (18+)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Legacy hidden fields -->
                        <div id="password-field" class="hidden"></div>
                        <div id="members-field" class="hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex items-center justify-between px-6 py-4 border-t border-white/5 bg-[#0a0a0a]">
                <div class="flex items-center gap-2 text-sm">
                    <span class="text-white/40">Est. cost:</span>
                    <span id="cost-public" class="text-white/80 font-medium channel-cost-display tooltip" data-tooltip="Gas: loading...">calculating...</span>
                    <span id="cost-password" class="text-white/80 font-medium channel-cost-display tooltip hidden" data-tooltip="Gas: loading...">calculating...</span>
                    <span id="cost-native" class="text-white/80 font-medium channel-cost-display tooltip hidden" data-tooltip="Gas: loading...">calculating...</span>
                </div>
                <div class="flex gap-3">
                    <button id="cancel-channel-btn-footer" class="px-5 py-2.5 rounded-xl text-sm font-medium text-white/60 hover:text-white/90 hover:bg-white/5 transition">
                        Cancel
                    </button>
                    <button id="create-channel-btn" class="px-5 py-2.5 rounded-xl text-sm font-medium bg-white text-black hover:bg-white/90 transition">
                        Create Channel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Channel Types Info -->
    <div id="channel-types-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[60] p-4">
        <div class="bg-[#141414] rounded-2xl w-[520px] max-w-[95vw] shadow-2xl border border-white/5 overflow-hidden">
            <!-- Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-white/5">
                <h3 class="text-lg font-medium text-white/90">Channel Types</h3>
                <button id="close-channel-types-btn" class="text-white/40 hover:text-white/80 transition p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Content -->
            <div class="p-6 space-y-5 max-h-[70vh] overflow-y-auto">
                <!-- Intro -->
                <p class="text-sm text-white/50 leading-relaxed">
                    Pombo offers three channel types, each with different privacy and access control mechanisms. All channels use verified ID and decentralized infrastructure.
                </p>

                <!-- Public -->
                <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418"/></svg>
                        </div>
                        <h4 class="text-sm font-medium text-white">Public</h4>
                    </div>
                    <p class="text-sm text-white/40 leading-relaxed">
                        Open channels that anyone can discover and join. Perfect for communities, announcements, and public discussions. Everything is visible to all participants.
                    </p>
                    <div class="flex gap-4 mt-3 pt-3 border-t border-white/5 text-xs text-white/30">
                        <span>Open access</span>
                        <span>Discoverable</span>
                        <span>Community-friendly</span>
                    </div>
                </div>

                <!-- Password -->
                <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/></svg>
                        </div>
                        <h4 class="text-sm font-medium text-white">Password</h4>
                    </div>
                    <p class="text-sm text-white/40 leading-relaxed">
                        Protected channels where messages are encrypted with a shared password. Only users who know the password can decrypt and read messages. Easy to share access with friends or team members.
                    </p>
                    <div class="flex gap-4 mt-3 pt-3 border-t border-white/5 text-xs text-white/30">
                        <span>Password-encrypted</span>
                        <span>Easy sharing</span>
                        <span>Private groups</span>
                    </div>
                </div>

                <!-- Verified -->
                <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white/60" viewBox="0 0 320 512" fill="currentColor"><path d="M311.9 260.8L160 353.6 8 260.8 160 0l151.9 260.8zM160 383.4L8 290.6 160 512l152-221.4-152 92.8z"/></svg>
                        </div>
                        <h4 class="text-sm font-medium text-white">Verified</h4>
                        <span class="text-[10px] bg-white/10 text-white/50 px-1.5 py-0.5 rounded uppercase tracking-wider">Most Secure</span>
                    </div>
                    <p class="text-sm text-white/40 leading-relaxed">
                        Blockchain-verified membership using smart contracts. Access is controlled on-chain, and each member must be explicitly authorized by their wallet address. Ideal for high-security channels requiring cryptographic proof of membership.
                    </p>
                    <div class="flex gap-4 mt-3 pt-3 border-t border-white/5 text-xs text-white/30">
                        <span>On-chain access</span>
                        <span>Wallet-verified</span>
                        <span>Maximum security</span>
                    </div>
                </div>

                <!-- Tech note -->
                <div class="flex items-start gap-3 p-3 bg-blue-500/5 rounded-lg border border-blue-500/10">
                    <svg class="w-4 h-4 text-blue-400/60 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"/></svg>
                    <p class="text-xs text-blue-300/60 leading-relaxed">
                        All channel types run on Streamr's decentralized network. Messages are stored on LogStore nodes and synchronized peer-to-peer. Creating channels requires a small gas fee on Polygon.
                    </p>
                </div>
            </div>

            <!-- Footer -->
            <div class="px-6 py-4 border-t border-white/5 bg-[#0a0a0a]">
                <button id="close-channel-types-btn-footer" class="w-full px-5 py-2.5 rounded-xl text-sm font-medium bg-white/10 text-white hover:bg-white/15 transition">
                    Got it
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Join Channel -->
    <div id="join-channel-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-[#111111] rounded-xl p-5 w-[340px] max-w-full mx-4 border border-[#222]">
            <h3 class="text-base font-medium mb-4 text-white">Join Channel</h3>

            <div class="space-y-3">
                <div>
                    <label class="block text-sm text-[#666] mb-1.5 uppercase tracking-wide">Channel ID</label>
                    <input
                        type="text"
                        id="join-stream-id-input"
                        placeholder="0x.../channel_name_abc123"
                        autocomplete="off"
                        class="w-full bg-[#1a1a1a] border border-[#282828] text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:border-[#444] transition"
                    />
                    <p class="text-sm text-[#555] mt-1">Ask the channel creator for the channel ID</p>
                </div>

                <div class="flex items-center">
                    <input type="checkbox" id="join-has-password" class="w-3.5 h-3.5 mr-2 accent-white rounded">
                    <label for="join-has-password" class="text-sm text-[#888]">Channel has password</label>
                </div>

                <div id="join-password-field" class="hidden">
                    <label class="block text-sm text-[#666] mb-1.5 uppercase tracking-wide">Password</label>
                    <input
                        type="password"
                        id="join-password-input"
                        placeholder="password..."
                        autocomplete="new-password"
                        class="w-full bg-[#1a1a1a] border border-[#282828] text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:border-[#444] transition"
                    />
                </div>
            </div>

            <div class="flex gap-2 mt-5">
                <button id="cancel-join-btn" class="flex-1 bg-[#1a1a1a] hover:bg-[#252525] border border-[#282828] text-[#888] text-sm font-medium px-3 py-2.5 rounded-lg transition">
                    Cancel
                </button>
                <button id="join-btn" class="flex-1 bg-white hover:bg-[#f0f0f0] text-black text-sm font-medium px-3 py-2.5 rounded-lg transition">
                    Join
                </button>
            </div>
            
            <div class="mt-4 pt-3 border-t border-[#222] text-center">
                <button type="button" id="switch-to-closed-join-btn" class="text-xs text-white/40 hover:text-white/60 transition">
                    Joining a Closed channel? <span class="underline">Click here</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Join Closed Channel (with name + classification) -->
    <div id="join-closed-channel-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-[#111111] rounded-xl p-5 w-[340px] max-w-full mx-4 border border-[#222]">
            <h3 class="text-base font-medium mb-4 text-white">Join Closed Channel</h3>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-[#666] mb-1.5 uppercase tracking-wide">Channel ID</label>
                    <input
                        type="text"
                        id="join-closed-stream-id-input"
                        placeholder="0x.../channel_abc123"
                        autocomplete="off"
                        class="w-full bg-[#1a1a1a] border border-[#282828] text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:border-[#444] transition"
                    />
                </div>

                <div>
                    <label class="block text-sm text-[#666] mb-1.5 uppercase tracking-wide">Channel Name</label>
                    <input
                        type="text"
                        id="join-closed-name-input"
                        placeholder="Give this channel a name..."
                        autocomplete="off"
                        class="w-full bg-[#1a1a1a] border border-[#282828] text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:border-[#444] transition"
                    />
                    <p class="text-xs text-[#555] mt-1">This name is stored locally only</p>
                </div>

                <div>
                    <label class="block text-sm text-[#666] mb-2 uppercase tracking-wide">Classification</label>
                    <div class="flex gap-2">
                        <button type="button" data-join-classification="personal" class="join-classification-tab flex-1 px-3 py-2 rounded-lg text-xs font-medium transition bg-white/10 text-white border border-white/10">
                            Personal
                        </button>
                        <button type="button" data-join-classification="community" class="join-classification-tab flex-1 px-3 py-2 rounded-lg text-xs font-medium transition bg-white/5 text-white/50 border border-white/5 hover:bg-white/10 hover:text-white/70">
                            Community
                        </button>
                    </div>
                    <p class="text-xs text-[#555] mt-1.5">Helps organize your channels locally</p>
                </div>
            </div>

            <div class="flex gap-2 mt-5">
                <button id="cancel-join-closed-btn" class="flex-1 bg-[#1a1a1a] hover:bg-[#252525] border border-[#282828] text-[#888] text-sm font-medium px-3 py-2.5 rounded-lg transition">
                    Cancel
                </button>
                <button id="join-closed-btn" class="flex-1 bg-white hover:bg-[#f0f0f0] text-black text-sm font-medium px-3 py-2.5 rounded-lg transition">
                    Join
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Invite Users -->
    <div id="invite-users-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-[#111111] rounded-xl p-5 w-[380px] max-w-full mx-4 border border-[#222]">
            <h3 class="text-base font-medium mb-4 text-white">Invite to Channel</h3>

            <!-- Tabs -->
            <div class="flex bg-[#1a1a1a] rounded-lg p-1 gap-1 mb-4">
                <button type="button" data-invite-tab="link" class="invite-tab flex-1 text-sm py-2 px-3 rounded-md transition bg-white text-black font-medium">
                    Share Link
                </button>
                <button type="button" data-invite-tab="address" class="invite-tab flex-1 text-sm py-2 px-3 rounded-md transition text-[#888] hover:text-white hover:bg-[#252525]">
                    Send to Address
                </button>
            </div>

            <!-- Tab Content: Link -->
            <div id="invite-tab-link" class="invite-tab-content space-y-3">
                <div class="bg-[#1a1a1a] rounded-lg p-3 border border-[#282828]">
                    <p class="text-sm text-[#888] leading-relaxed mb-3">
                        Share this link with anyone you want to invite to the channel.
                    </p>
                    <div class="flex gap-2">
                        <input
                            type="text"
                            id="invite-link-display"
                            readonly
                            class="flex-1 bg-[#111] border border-[#282828] text-[#888] px-2.5 py-2 rounded-lg text-sm font-mono truncate"
                            value=""
                        />
                        <button id="copy-invite-link-btn" class="bg-white hover:bg-[#f0f0f0] text-black px-4 py-2 rounded-lg text-sm font-medium transition">
                            Copy
                        </button>
                    </div>
                    <button id="show-qr-btn" class="w-full mt-3 bg-[#252525] hover:bg-[#303030] border border-[#333] px-3 py-2 rounded-lg text-sm text-[#888] transition">
                        Show QR Code
                    </button>
                </div>
            </div>

            <!-- Tab Content: Address -->
            <div id="invite-tab-address" class="invite-tab-content hidden space-y-3">
                <div class="bg-amber-500/10 border border-amber-500/20 rounded-lg p-3">
                    <p class="text-sm text-amber-400/80 leading-relaxed flex items-start gap-2">
                        <svg class="w-4 h-4 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg>
                        <span>The recipient must be a Pombo user with notifications enabled to receive invites.</span>
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-[#666] mb-1.5 uppercase tracking-wide">Ethereum Address</label>
                    <input
                        type="text"
                        id="invite-address-input"
                        placeholder="0x..."
                        class="w-full bg-[#1a1a1a] border border-[#282828] text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:border-[#444] transition"
                    />
                </div>

                <button id="send-invite-btn" class="w-full bg-white hover:bg-[#f0f0f0] text-black text-sm font-medium px-3 py-2.5 rounded-lg transition">
                    Send Invite
                </button>
            </div>

            <div class="flex justify-end mt-5">
                <button id="cancel-invite-btn" class="bg-[#1a1a1a] hover:bg-[#252525] border border-[#282828] text-[#888] text-sm font-medium px-4 py-2.5 rounded-lg transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Channel Settings (Member Management) -->
    <!-- Channel Settings Modal - Tabbed Layout -->
    <div id="channel-settings-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="bg-[#141414] rounded-2xl w-[580px] max-w-full max-h-[85vh] flex flex-col shadow-2xl border border-white/5 overflow-hidden">
            <!-- Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-white/5">
                <div>
                    <h3 class="text-lg font-medium text-white/90">Channel Settings</h3>
                    <p id="channel-settings-name" class="text-sm text-white/40 mt-0.5"></p>
                </div>
                <button id="close-channel-settings-btn" class="text-white/40 hover:text-white/80 transition p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="flex flex-1 min-h-0">
                <!-- Sidebar Tabs -->
                <div class="w-40 bg-[#0a0a0a] border-r border-white/5 py-2 flex-shrink-0">
                    <nav class="space-y-1 px-2">
                        <button data-channel-tab="info" class="channel-settings-tab w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/60 hover:text-white/90 hover:bg-white/5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"/></svg>
                            <span>Info</span>
                        </button>
                        <button data-channel-tab="members" class="channel-settings-tab w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/60 hover:text-white/90 hover:bg-white/5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"/></svg>
                            <span>Members</span>
                        </button>
                        <div id="danger-tab-divider" class="hidden my-2 mx-3 border-t border-white/5"></div>
                        <button id="danger-tab-btn" data-channel-tab="danger" class="hidden channel-settings-tab w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/60 hover:text-red-400 hover:bg-red-500/5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg>
                            <span>Delete</span>
                        </button>
                    </nav>
                </div>

                <!-- Content Panels -->
                <div class="flex-1 overflow-y-auto p-6">
                    <!-- Info Panel -->
                    <div id="channel-panel-info" class="channel-settings-panel hidden space-y-4">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Permissions Type</label>
                                <div id="channel-settings-type" class="text-sm text-white font-medium"></div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Channel ID</label>
                                <div class="flex items-center gap-2">
                                    <code id="channel-settings-id" class="flex-1 text-xs font-mono text-white/60 bg-white/5 px-3 py-2 rounded-lg break-all"></code>
                                    <button id="copy-stream-id-btn" class="bg-white/5 hover:bg-white/10 border border-white/10 p-2 rounded-lg transition" title="Copy">
                                        <svg class="w-4 h-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"/></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Non-native message -->
                        <div id="non-native-message" class="hidden mt-6 text-center py-6 text-white/40 bg-white/5 rounded-xl border border-white/5">
                            <p class="text-sm">Member management is only available for</p>
                            <p class="text-sm">channels using on-chain verified membership.</p>
                        </div>
                    </div>

                    <!-- Members Panel -->
                    <div id="channel-panel-members" class="channel-settings-panel hidden">
                        <div id="members-section" class="space-y-5">
                            <!-- Current Members -->
                            <div>
                                <div class="flex items-center justify-between mb-3">
                                    <label class="text-xs font-medium text-white/40 uppercase tracking-wider">Current Members</label>
                                    <button id="refresh-members-btn" class="text-xs text-white/60 hover:text-white transition">
                                        ↻ Refresh
                                    </button>
                                </div>
                                <div id="members-list" class="space-y-2 max-h-[200px] overflow-y-auto pr-1">
                                    <div class="text-center text-white/30 py-4 text-sm">Loading...</div>
                                </div>
                            </div>

                            <!-- Add Members (Owner only) -->
                            <div id="add-member-form" class="hidden">
                                <div class="border-t border-white/5 pt-5">
                                    <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-3">Add Members</label>
                                    
                                    <!-- Single address input -->
                                    <div class="flex gap-2 mb-3">
                                        <input
                                            type="text"
                                            id="add-member-input"
                                            placeholder="0x... address"
                                            class="flex-1 bg-white/5 border border-white/10 text-white px-4 py-2.5 rounded-xl text-sm focus:outline-none focus:border-white/30 transition placeholder:text-white/20"
                                        />
                                        <button id="add-member-btn" class="bg-white/10 hover:bg-white/20 text-white border border-white/20 px-4 py-2.5 rounded-xl text-sm transition">
                                            Add
                                        </button>
                                    </div>

                                    <!-- Batch add -->
                                    <details class="group">
                                        <summary class="text-xs text-white/40 hover:text-white/60 cursor-pointer transition mb-2">
                                            <span class="group-open:hidden">▸ Batch add multiple addresses</span>
                                            <span class="hidden group-open:inline">▾ Batch add multiple addresses</span>
                                        </summary>
                                        <div class="space-y-2">
                                            <textarea
                                                id="batch-members-input"
                                                placeholder="Paste addresses (one per line)&#10;0x...&#10;0x...&#10;0x..."
                                                rows="4"
                                                class="w-full bg-white/5 border border-white/10 text-white px-4 py-3 rounded-xl text-sm font-mono focus:outline-none focus:border-white/30 transition placeholder:text-white/20 resize-none"
                                            ></textarea>
                                            <button id="batch-add-members-btn" class="w-full bg-white/10 hover:bg-white/20 text-white border border-white/20 px-4 py-2.5 rounded-xl text-sm transition">
                                                Add All Addresses
                                            </button>
                                        </div>
                                    </details>

                                    <p class="text-xs text-amber-400/60 mt-3 flex items-center gap-1.5">
                                        <svg class="w-3.5 h-3.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg>
                                        <span>Adding members requires on-chain transactions (gas fees)</span>
                                    </p>
                                </div>
                            </div>

                            <!-- Permissions Section (Owner only) -->
                            <div id="permissions-section" class="hidden">
                                <div class="border-t border-white/5 pt-5">
                                    <div class="flex items-center justify-between mb-3">
                                        <label class="text-xs font-medium text-white/40 uppercase tracking-wider">Stream Permissions</label>
                                        <button id="refresh-permissions-btn" class="text-xs text-white/60 hover:text-white transition">
                                            ↻ Refresh
                                        </button>
                                    </div>
                                    <div id="permissions-list" class="text-xs space-y-1 max-h-[120px] overflow-y-auto pr-1">
                                        <div class="text-white/30">Loading...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Danger Panel (Owner only) -->
                    <div id="channel-panel-danger" class="channel-settings-panel hidden">
                        <div id="delete-channel-section" class="space-y-4">
                            <div class="p-4 bg-red-500/5 rounded-xl border border-red-500/10">
                                <h4 class="text-sm font-medium text-white/90 mb-1 flex items-center gap-2">
                                    <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg>
                                    Delete Channel
                                </h4>
                                <p class="text-xs text-white/40 mb-4">
                                    Permanently delete this channel from the Streamr network. This cannot be undone.
                                </p>
                                <button id="delete-channel-btn" class="w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/20 px-4 py-2.5 rounded-xl text-sm transition">
                                    Delete Channel Forever
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Delete Channel Confirmation -->
    <div id="delete-channel-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60]">
        <div class="bg-[#141414] rounded-2xl w-[400px] max-w-[95vw] mx-4 shadow-2xl border border-red-500/20 overflow-hidden">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center">
                        <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg>
                    </div>
                    <h3 class="text-lg font-medium text-white/90">Delete Channel</h3>
                </div>
                <div class="bg-white/5 rounded-xl p-3 mb-4">
                    <div class="text-xs text-white/40 mb-1">Channel</div>
                    <div id="delete-channel-name" class="text-sm font-medium text-white/80"></div>
                </div>
                <p class="text-sm text-white/50 mb-3">
                    This will permanently delete the channel from Streamr. All participants will lose access.
                </p>
                <p class="text-xs text-red-400/80 bg-red-500/5 rounded-lg px-3 py-2 flex items-center gap-1.5">
                    <svg class="w-3.5 h-3.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg>
                    This action cannot be undone.
                </p>
            </div>
            <div class="flex border-t border-white/5">
                <button id="cancel-delete-btn" class="flex-1 px-4 py-3 text-sm text-white/60 hover:text-white hover:bg-white/5 transition">
                    Cancel
                </button>
                <button id="confirm-delete-btn" class="flex-1 px-4 py-3 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 border-l border-white/5 transition">
                    Delete Forever
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Settings -->
    <!-- Settings Modal - Tabbed Layout -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="bg-[#141414] rounded-2xl w-[640px] max-w-[95vw] mx-4 shadow-2xl border border-white/5 overflow-hidden">
            <!-- Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-white/5">
                <h3 class="text-lg font-medium text-white/90">Settings</h3>
                <button id="close-settings-btn" class="text-white/40 hover:text-white/80 transition p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="flex min-h-[420px]">
                <!-- Sidebar Tabs -->
                <div class="w-44 bg-[#0a0a0a] border-r border-white/5 py-2 flex flex-col justify-between">
                    <nav class="space-y-1 px-2">
                        <button data-settings-tab="profile" class="settings-tab w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/60 hover:text-white/90 hover:bg-white/5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
                            <span>Account</span>
                        </button>
                        <button data-settings-tab="notifications" class="settings-tab w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/60 hover:text-white/90 hover:bg-white/5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"/></svg>
                            <span>Notifications</span>
                        </button>
                        <button data-settings-tab="api" class="settings-tab w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/60 hover:text-white/90 hover:bg-white/5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"/></svg>
                            <span>API</span>
                        </button>
                        <div class="my-2 mx-3 border-t border-white/5"></div>
                        <button data-settings-tab="security" class="settings-tab w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/60 hover:text-white/90 hover:bg-white/5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"/></svg>
                            <span>Security</span>
                        </button>
                    </nav>
                    <div class="px-2 pb-2">
                        <button id="about-btn" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-left transition-all text-white/40 hover:text-white/60 hover:bg-white/5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"/></svg>
                            <span>About</span>
                        </button>
                    </div>
                </div>

                <!-- Content Panels -->
                <div class="flex-1 p-6 overflow-y-auto">
                    <!-- Profile Panel -->
                    <div id="settings-panel-profile" class="settings-panel hidden">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Display Name</label>
                                <input
                                    type="text"
                                    id="settings-username"
                                    placeholder="Enter your name"
                                    class="w-full bg-white/5 border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-white/30 transition placeholder:text-white/20"
                                />
                                <p class="text-xs text-white/30 mt-2">Visible to other users</p>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">Account Address</label>
                                <div class="flex gap-2">
                                    <input
                                        type="text"
                                        id="settings-address"
                                        readonly
                                        class="flex-1 bg-white/5 border border-white/10 text-white/60 px-4 py-3 rounded-xl text-xs font-mono"
                                    />
                                    <button id="copy-own-address-btn" class="bg-white/5 hover:bg-white/10 border border-white/10 px-4 rounded-xl transition flex items-center justify-center" title="Copy">
                                        <svg class="w-4 h-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">POL Balance</label>
                                <div class="bg-white/5 border border-white/10 px-4 py-3 rounded-xl">
                                    <div class="flex items-center justify-between">
                                        <span id="settings-balance" class="text-white text-sm font-medium">Loading...</span>
                                        <button id="refresh-balance-btn" class="text-white/40 hover:text-white/60 transition p-1" title="Refresh">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"/></svg>
                                        </button>
                                    </div>
                                    <p class="text-xs text-white/30 mt-1">On Polygon network</p>
                                </div>
                                <button id="fund-metamask-btn" class="w-full mt-3 bg-[#F6851B]/10 hover:bg-[#F6851B]/20 text-[#F6851B] border border-[#F6851B]/30 px-4 py-2.5 rounded-xl text-sm transition flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v3"/></svg>
                                    Fund with MetaMask
                                </button>
                                <p class="text-xs text-white/30 mt-2 text-center">Send POL from your MetaMask wallet</p>
                            </div>
                            <div class="my-4 border-t border-white/5"></div>
                            <div class="flex items-start justify-between p-4 bg-white/5 rounded-xl border border-white/5">
                                <div class="flex-1 mr-4">
                                    <h4 class="text-sm font-medium text-white/90 mb-1">Show Sensitive Content</h4>
                                    <p class="text-xs text-white/40 leading-relaxed">
                                        Enable NSFW filter in channel exploration
                                    </p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="nsfw-enabled" class="sr-only peer">
                                    <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white/60 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#F6851B]"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Panel -->
                    <div id="settings-panel-notifications" class="settings-panel hidden">
                        <div class="space-y-6">
                            <div class="flex items-start justify-between p-4 bg-white/5 rounded-xl border border-white/5">
                                <div class="flex-1 mr-4">
                                    <h4 class="text-sm font-medium text-white/90 mb-1">Push Notifications</h4>
                                    <p class="text-xs text-white/40 leading-relaxed">
                                        Receive channel invites from other users
                                    </p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="notifications-enabled" class="sr-only peer">
                                    <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white/60 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-white"></div>
                                </label>
                            </div>
                            <div class="flex items-center gap-2 text-xs text-amber-400/80">
                                <svg class="w-3.5 h-3.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg>
                                <span>Enabling creates a Streamr stream (requires gas)</span>
                            </div>
                            <div id="notifications-status" class="text-xs text-white/40"></div>
                        </div>
                    </div>

                    <!-- API Panel -->
                    <div id="settings-panel-api" class="settings-panel hidden">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-xs font-medium text-white/40 uppercase tracking-wider mb-2">The Graph API Key</label>
                                <input
                                    type="password"
                                    id="settings-graph-api-key"
                                    placeholder="Optional - uses default if empty"
                                    class="w-full bg-white/5 border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-white/30 transition placeholder:text-white/20"
                                />
                                <p class="text-xs text-white/30 mt-2">
                                    Get yours at <a href="https://thegraph.com/studio/apikeys/" target="_blank" class="text-white/60 hover:text-white transition">thegraph.com/studio</a>
                                </p>
                            </div>
                            <div id="graph-api-status" class="text-xs"></div>
                        </div>
                    </div>

                    <!-- Account Panel (Security + Backup) -->
                    <div id="settings-panel-security" class="settings-panel hidden">
                        <div class="space-y-6">
                            <!-- Export Private Key -->
                            <div class="p-4 bg-red-500/5 rounded-xl border border-red-500/10">
                                <h4 class="text-sm font-medium text-white/90 mb-1 flex items-center gap-2">
                                    <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"/></svg>
                                    Private Key
                                </h4>
                                <p class="text-xs text-white/40 mb-4">Anyone with this key has full control of your account</p>
                                
                                <div id="export-key-step1" class="space-y-3">
                                    <input
                                        type="password"
                                        id="export-key-password"
                                        placeholder="Enter password to unlock"
                                        class="w-full bg-white/5 border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-red-500/50 focus:ring-1 focus:ring-red-500/20 transition placeholder:text-white/20"
                                    />
                                    <button id="unlock-private-key-btn" class="w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/20 px-4 py-2.5 rounded-xl text-sm transition">
                                        Unlock Key
                                    </button>
                                </div>
                                
                                <div id="export-key-step2" class="hidden space-y-3">
                                    <div class="flex items-center gap-2">
                                        <input
                                            type="password"
                                            id="private-key-display"
                                            readonly
                                            class="flex-1 bg-black/30 border border-red-500/20 text-white/70 px-4 py-3 rounded-xl text-xs font-mono"
                                        />
                                        <button id="toggle-key-visibility" class="bg-white/5 hover:bg-white/10 border border-white/10 p-3 rounded-xl transition flex items-center justify-center" title="Show/Hide">
                                            <svg class="w-4 h-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                        </button>
                                    </div>
                                    <button id="copy-private-key-btn" class="w-full bg-red-600/90 hover:bg-red-600 text-white px-4 py-2.5 rounded-xl text-sm transition relative overflow-hidden">
                                        <span id="copy-key-text" class="relative z-10">Hold to Copy (2s)</span>
                                        <div id="copy-key-progress" class="absolute inset-0 bg-red-400 opacity-40 transform -translate-x-full transition-transform duration-[2000ms]"></div>
                                    </button>
                                    <button id="lock-private-key-btn" class="w-full bg-white/5 hover:bg-white/10 text-white/60 border border-white/10 px-4 py-2.5 rounded-xl text-sm transition flex items-center justify-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/></svg>
                                        Lock
                                    </button>
                                </div>
                            </div>

                            <!-- Divider -->
                            <div class="border-t border-white/5"></div>

                            <!-- Backup & Restore -->
                            <div>
                                <h4 class="text-sm font-medium text-white/90 mb-1 flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"/></svg>
                                    Backup & Restore
                                </h4>
                                <p class="text-xs text-white/40 mb-4">Export data to restore on another device</p>
                                
                                <div class="grid grid-cols-2 gap-3">
                                    <button id="export-all-data-btn" class="bg-white/10 hover:bg-white/20 text-white border border-white/20 px-4 py-3 rounded-xl text-sm transition flex items-center justify-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"/></svg>
                                        Export
                                    </button>
                                    <input type="file" id="import-data-file" accept=".json" class="hidden" />
                                    <button id="import-data-btn" class="bg-white/5 hover:bg-white/10 text-white/60 border border-white/10 px-4 py-3 rounded-xl text-sm transition flex items-center justify-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>
                                        Import
                                    </button>
                                </div>
                                <p class="text-xs text-white/30 mt-3">Passwords not included — you'll need them to unlock</p>
                            </div>

                            <!-- Divider -->
                            <div class="border-t border-white/5"></div>

                            <!-- Delete Account -->
                            <div class="p-4 bg-red-500/5 rounded-xl border border-red-500/10">
                                <h4 class="text-sm font-medium text-white/90 mb-1 flex items-center gap-2">
                                    <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg>
                                    Delete Account
                                </h4>
                                <p class="text-xs text-white/40 mb-4">Permanently delete this account and all its data</p>
                                
                                <div id="delete-account-step1" class="space-y-3">
                                    <input
                                        type="password"
                                        id="delete-account-password"
                                        placeholder="Enter password to confirm"
                                        class="w-full bg-white/5 border border-white/10 text-white px-4 py-3 rounded-xl text-sm focus:outline-none focus:border-red-500/50 focus:ring-1 focus:ring-red-500/20 transition placeholder:text-white/20"
                                    />
                                    <button id="verify-delete-account-btn" class="w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/20 px-4 py-2.5 rounded-xl text-sm transition">
                                        Verify Password
                                    </button>
                                </div>
                                
                                <div id="delete-account-step2" class="hidden space-y-3">
                                    <div class="p-3 bg-red-500/10 rounded-lg border border-red-500/20">
                                        <p class="text-xs text-red-300 leading-relaxed">
                                            <strong>Warning:</strong> This will permanently delete your keystore and all associated data (channels, messages, contacts). This action cannot be undone.
                                        </p>
                                    </div>
                                    <button id="delete-account-btn" class="w-full bg-red-600/90 hover:bg-red-600 text-white px-4 py-2.5 rounded-xl text-sm transition relative overflow-hidden">
                                        <span id="delete-account-text" class="relative z-10">Hold to Delete (2s)</span>
                                        <div id="delete-account-progress" class="absolute inset-0 bg-red-400 opacity-40 transform -translate-x-full transition-transform duration-[2000ms]"></div>
                                    </button>
                                    <button id="cancel-delete-account-btn" class="w-full bg-white/5 hover:bg-white/10 text-white/60 border border-white/10 px-4 py-2.5 rounded-xl text-sm transition">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Trusted Contacts -->
    <div id="contacts-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-[#111111] rounded-xl p-5 w-[380px] max-w-full mx-4 max-h-[80vh] flex flex-col border border-[#222]">
            <div class="flex items-center gap-2 mb-4">
                <svg class="w-4 h-4 text-[#888]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"/>
                </svg>
                <h3 class="text-base font-medium text-white">Trusted Contacts</h3>
            </div>
            
            <!-- Add new contact -->
            <div class="mb-4 p-3 bg-[#1a1a1a] border border-[#282828] rounded-lg">
                <div class="flex gap-2">
                    <input
                        type="text"
                        id="add-contact-address"
                        placeholder="0x... or ENS name"
                        class="flex-1 bg-[#111] border border-[#282828] text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:border-[#444] transition"
                    />
                    <button id="add-contact-btn" class="bg-white hover:bg-[#f0f0f0] text-black px-3 py-2 rounded-lg text-sm font-medium transition">
                        Add
                    </button>
                </div>
                <input
                    type="text"
                    id="add-contact-nickname"
                    placeholder="Nickname (optional)"
                    class="w-full mt-2 bg-[#111] border border-[#282828] text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:border-[#444] transition"
                />
            </div>

            <!-- Contacts list -->
            <div id="contacts-list" class="flex-1 overflow-y-auto space-y-2 min-h-[150px]">
                <div class="text-center text-[#555] py-8 text-sm">No trusted contacts yet</div>
            </div>

            <!-- Legend -->
            <div class="mt-4 p-3 bg-[#1a1a1a] border border-[#282828] rounded-lg text-sm text-[#666]">
                <div class="font-medium mb-1.5 text-[#888]">Trust Levels:</div>
                <div class="flex flex-wrap gap-x-4 gap-y-1">
                    <div class="flex items-center gap-1"><svg class="w-3.5 h-3.5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Valid Signature</div>
                    <div class="flex items-center gap-1"><svg class="w-3.5 h-3.5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z"/></svg> ENS Verified</div>
                    <div class="flex items-center gap-1"><svg class="w-3.5 h-3.5 text-amber-500" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd"/></svg> Trusted Contact</div>
                </div>
            </div>

            <button id="close-contacts-btn" class="mt-4 w-full bg-[#1a1a1a] hover:bg-[#252525] border border-[#282828] text-[#888] text-sm font-medium px-4 py-2.5 rounded-lg transition">
                Close
            </button>
        </div>
    </div>

    <!-- Modal: Add Contact Nickname -->
    <div id="add-contact-nickname-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-[60]">
        <div class="bg-[#111111] rounded-xl p-5 w-[340px] max-w-full mx-4 border border-[#222]">
            <h3 class="text-base font-medium mb-4 text-white">Add Contact</h3>

            <div class="space-y-3">
                <div>
                    <label class="block text-sm text-[#666] mb-1.5 uppercase tracking-wide">Address</label>
                    <div id="add-contact-modal-address" class="bg-[#1a1a1a] border border-[#282828] text-[#888] px-3 py-2 rounded-lg text-sm font-mono truncate"></div>
                </div>

                <div>
                    <label class="block text-sm text-[#666] mb-1.5 uppercase tracking-wide">Nickname <span class="text-[#555] normal-case">(optional)</span></label>
                    <input
                        type="text"
                        id="add-contact-modal-nickname"
                        placeholder="Enter a nickname"
                        class="w-full bg-[#1a1a1a] border border-[#282828] text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:border-[#444] transition"
                    />
                </div>
            </div>

            <div class="flex gap-2 mt-5">
                <button id="cancel-add-contact-btn" class="flex-1 bg-[#1a1a1a] hover:bg-[#252525] border border-[#282828] text-[#888] text-sm font-medium px-3 py-2.5 rounded-lg transition">
                    Cancel
                </button>
                <button id="confirm-add-contact-btn" class="flex-1 bg-white hover:bg-[#f0f0f0] text-black text-sm font-medium px-3 py-2.5 rounded-lg transition">
                    Add Contact
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Remove Contact Confirmation -->
    <div id="remove-contact-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-[60]">
        <div class="bg-[#111111] rounded-xl p-5 w-[340px] max-w-full mx-4 border border-[#222]">
            <h3 class="text-base font-medium mb-4 text-white">Remove Contact</h3>

            <div class="space-y-3">
                <p class="text-sm text-[#888]">Are you sure you want to remove this contact?</p>
                <div id="remove-contact-modal-address" class="bg-[#1a1a1a] border border-[#282828] text-[#888] px-3 py-2 rounded-lg text-sm font-mono truncate"></div>
            </div>

            <div class="flex gap-2 mt-5">
                <button id="cancel-remove-contact-btn" class="flex-1 bg-[#1a1a1a] hover:bg-[#252525] border border-[#282828] text-[#888] text-sm font-medium px-3 py-2.5 rounded-lg transition">
                    Cancel
                </button>
                <button id="confirm-remove-contact-btn" class="flex-1 bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/30 text-sm font-medium px-3 py-2.5 rounded-lg transition">
                    Remove
                </button>
            </div>
        </div>
    </div>

    <!-- Context Menu (for messages) -->
    <div id="message-context-menu" class="hidden fixed bg-[#1e1e1e] border border-gray-700 rounded-lg shadow-xl py-1 z-50 min-w-[180px]">
        <button class="context-menu-item w-full text-left px-4 py-2 hover:bg-[#2a2a2a] text-sm flex items-center gap-2" data-action="copy-address">
            <svg class="w-4 h-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"/></svg>
            Copy Address
        </button>
        <hr class="border-gray-700 my-1">
        <button class="context-menu-item w-full text-left px-4 py-2 hover:bg-[#2a2a2a] text-sm flex items-center gap-2" data-action="add-contact">
            <svg class="w-4 h-4 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg>
            Add to Trusted Contacts
        </button>
        <button class="context-menu-item w-full text-left px-4 py-2 hover:bg-[#2a2a2a] text-sm text-red-400 flex items-center gap-2" data-action="remove-contact">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M22 10.5h-6m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg>
            Remove from Contacts
        </button>
    </div>

    <!-- Reaction Picker  -->
<div id="reaction-picker" class="reaction-picker">
    <span data-emoji="👍">👍</span> <span data-emoji="👎">👎</span> 
    
    <span data-emoji="❤️">❤️</span> <span data-emoji="🔥">🔥</span> <span data-emoji="💯">💯</span> <span data-emoji="🚀">🚀</span> <span data-emoji="🎉">🎉</span> <span data-emoji="🍻">🍻</span> <span data-emoji="🤩">🤩</span>
    
    <span data-emoji="😂">😂</span> <span data-emoji="😅">😅</span>
    
    <span data-emoji="👏">👏</span> <span data-emoji="🙏">🙏</span> <span data-emoji="🫡">🫡</span>
    
    <span data-emoji="👀">👀</span> <span data-emoji="🤔">🤔</span> <span data-emoji="🤨">🤨</span> 
    
    <span data-emoji="😱">😱</span> <span data-emoji="🤯">🤯</span>
    
    <span data-emoji="😢">😢</span> <span data-emoji="😭">😭</span>  <span data-emoji="✅">✅</span> <span data-emoji="❌">❌</span>
    
    <span data-emoji="💀">💀</span> <span data-emoji="💩">💩</span>
</div>

    <!-- Toast Notifications Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Modal: Media Lightbox -->
    <div id="media-lightbox-modal" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center z-[70]" onclick="window.uiController?.closeLightbox()">
        <!-- Close button -->
        <button class="absolute top-4 right-4 text-white/70 hover:text-white p-2 rounded-full bg-white/10 hover:bg-white/20 transition z-10" 
                onclick="event.stopPropagation(); window.uiController?.closeLightbox()">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
        
        <!-- Image container -->
        <img id="lightbox-image" class="hidden max-w-[90vw] max-h-[90vh] object-contain rounded-lg" onclick="event.stopPropagation()" alt="Full size"/>
        
        <!-- Video container -->
        <video id="lightbox-video" class="hidden max-w-[90vw] max-h-[90vh] rounded-lg" controls onclick="event.stopPropagation()"></video>
    </div>

    <!-- Modal: File Confirm -->
    <div id="file-confirm-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-[#111111] rounded-xl p-5 w-[360px] max-w-full mx-4 border border-[#222]">
            <h3 class="text-base font-medium mb-4 text-white">Confirm Send</h3>
            <div class="bg-[#1a1a1a] rounded-lg p-4 border border-[#282828] mb-4">
                <div class="flex items-center gap-3">
                    <div id="file-preview-icon" class="w-12 h-12 rounded-lg bg-[#252525] flex items-center justify-center">
                        <svg class="w-6 h-6 text-[#666]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p id="confirm-file-name" class="text-sm text-white truncate">filename.jpg</p>
                        <p id="confirm-file-size" class="text-xs text-[#666]">2.5 MB</p>
                    </div>
                </div>
            </div>
            <div class="flex gap-3">
                <button id="cancel-file-btn" class="flex-1 bg-[#1a1a1a] hover:bg-[#252525] border border-[#282828] text-[#888] hover:text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                    Cancel
                </button>
                <button id="confirm-file-btn" class="flex-1 bg-white hover:bg-[#f0f0f0] text-black px-4 py-2 rounded-lg text-sm font-medium transition">
                    Send
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <div id="loading-text" class="loading-text">Loading...</div>
    </div>

    <!-- Modal: About/Disclaimer -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[60]">
        <div class="bg-[#141414] rounded-2xl w-[480px] max-w-[95vw] mx-4 shadow-2xl border border-white/5 overflow-hidden">
            <div class="flex items-center justify-between px-6 py-4 border-b border-white/5">
                <h3 class="text-lg font-medium text-white/90">About</h3>
                <button id="close-about-btn" class="text-white/40 hover:text-white/80 transition p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <h4 class="text-sm font-medium text-white/80 mb-3">Disclaimer</h4>
                <p class="text-sm text-white/50 leading-relaxed">
                    We provide a decentralized interface. We do not host content. By using this, you agree not to post illegal content. We reserve the right to block access to illegal content via this specific gateway.
                </p>
            </div>
        </div>
    </div>

    <!-- App Bundle (built from src/js/) -->
    <script src="./js/app.bundle.js"></script>
</body>
</html>
