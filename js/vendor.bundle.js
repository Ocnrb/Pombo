/*! For license information please see vendor.bundle.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.vendorBundle=t():e.vendorBundle=t()}(this,()=>(()=>{var e={3808(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={dev0:{id:8995,name:"dev0",nativeCurrency:{symbol:"DEV",name:"Developer Ethereum",decimals:18},rpcEndpoints:[{url:"http://10.200.10.1:8545"},{url:"ws://10.200.10.1:8545"}],contracts:{AMB:"0xaFA0dc5Ad21796C9106a36D68f69aAD69994BB64",DATA:"0xbAA81A0179015bE47Ad439566374F2Bae098686F",DataUnionFactory:"0x90a0480c6fA6b2dC967d8F03660c81C8a5A7c465",DataUnionTemplate:"0x07a4CaF6064ACFe4c279e32e5ed2F376B36DcB3F",DefaultFeeOracle:"0x454E0fEcCf4611eA9E41C986E4A2949CFD4b53d4",ENS:"0x92E8435EB56fD01BF4C79B66d47AC1A94338BB03",FIFSRegistrar:"0x57B81a9442805f88c4617B506206531e72d96290",Marketplace:"0xF1371c0f40528406dc4f4cAf89924eA9Da49E866",MarketplaceV3:"0x56e57Bf7422eDe1ED75520D4387829feEe8a8319",MigrationManager:"0xc7aaf6c62e86a36395d8108fe95d5f758794c16c",PublicResolver:"0xBc0c81a318D57ae54dA28DE69184A9c3aE9a1e1c",TokenMediator:"0xedD2aa644a6843F2e5133Fe3d6BD3F4080d97D9F",TrackerRegistry:"0xBFCF120a8fD17670536f1B27D9737B775b2FD4CF",Uniswap2Router:"0xeE1bC9a7BFF1fFD913f4c97B6177D47E804E1920",UniswapAdapter:"0xE4eA76e830a659282368cA2e7E4d18C4AE52D8B3",Uniswap2AdapterForMarketplaceV3:"0xDbcdfB708A006A9AebC592C4520289cD87a95938",XDATA:"0x6d0F3bF9aD2455b4F62f22fFD21317e1E3eEFE5C","core-api":"0xFCAd0B19bB29D4674531d6f115237E16AfCE377c"}},dev1:{id:8997,name:"dev1",nativeCurrency:{symbol:"DEV",name:"Developer Ethereum",decimals:18},rpcEndpoints:[{url:"http://10.200.10.1:8546"},{url:"ws://10.200.10.1:8546"}],contracts:{AMB:"0xaFA0dc5Ad21796C9106a36D68f69aAD69994BB64",DATA:"0x73Be21733CC5D08e1a14Ea9a399fb27DB3BEf8fF",DataUnionFactory:"0x50aAa135AeBAC61E8394F80fF2Df091fcb66b072",DefaultFeeOracle:"0xd1FA6C06E1D838Bb989640A2C4b8a499FD0ab187",DataUnionTemplate:"0xC2F87E37019e227F2Be5030aabBCc7eAF136e05c",LINK:"0x3387F44140ea19100232873a5aAf9E46608c791E",Marketplace:"0xa072C42CB167d68D4c1cA15d0e4d0bd93E74A80f",MarketplaceV3:"0xA90CeCcA042312b8f2e8B924C04Ce62516CBF7b2",MarketplaceV4:"0xB9372284e0D61607aF3B7EF5f022e7D599Ed2a37",ProjectRegistryV1:"0x3C841B9Aa08166e9B864972930703e878d25804B",ProjectStakingV1:"0xBFCF120a8fD17670536f1B27D9737B775b2FD4CF",Mediator:"0xedD2aa644a6843F2e5133Fe3d6BD3F4080d97D9F",StorageNodeRegistry:"0x231b810D98702782963472e1D60a25496999E75D",StreamRegistry:"0x6cCdd5d866ea766f6DF5965aA98DeCCD629ff222",ENSCacheV2:"0x611900fD07BB133016Ed85553aF9586771da5ff9",StreamStorageRegistry:"0xd04af489677001444280366Dd0885B03dAaDe71D",Uniswap2Router:"0xdc5F6368cd31330adC259386e78604a5E29E9415",StreamrConfig:"0xa86863053cECFD9f6f861e0Fd39a042238411b75",SponsorshipFactory:"0x58C8e321d561123649bE41445cB0690Ec3d27Fe9",SponsorshipDefaultLeavePolicy:"0xa2338F8be0941B361baBebb01ab8da5725CF0a33",SponsorshipMaxOperatorsJoinPolicy:"0x2521E0480004056c35e199a1BBE2FdA9119032A0",SponsorshipOperatorContractOnlyJoinPolicy:"0xd8F0a63e5EB661695620c92af5d981D18d5a484E",SponsorshipStakeWeightedAllocationPolicy:"0xef927F18D2ac3862c6ABCAa953203A4DbF7f519e",SponsorshipVoteKickPolicy:"0x0617466e5bC15027c604A56E35b172E06d689E4f",OperatorFactory:"0xcb5bCb343218044C547AFdcBa2e50Ac728D0DcA3",OperatorDefaultDelegationPolicy:"0x03CF38C75BFb9F4466fBA0aEd95f2613B0D1bCA0",OperatorDefaultUndelegationPolicy:"0x67A0E9C9c21d11dB4eBAe420aBf705626a3a2561",OperatorDefaultExchangeRatePolicy:"0x252743660fACD52e7CEF851CEB1c133B58Fb526d"},theGraphUrl:"http://10.200.10.1:8000/subgraphs/name/streamr-dev/network-subgraphs"},dev2:{id:31337,name:"dev2",nativeCurrency:{symbol:"DEV",name:"Developer Ethereum",decimals:18},rpcEndpoints:[{url:"http://10.200.10.1:8547"}],adminPrivateKey:"0x5e98cce00cff5dea6b454889f359a4ec06b9fa6b88e9d69b86de8e1c81887da0",contracts:{DATA:"0xbAA81A0179015bE47Ad439566374F2Bae098686F",ENS:"0xEAA002f7Dc60178B6103f8617Be45a9D3df659B6",FIFSRegistrar:"0xF1371c0f40528406dc4f4cAf89924eA9Da49E866",PublicResolver:"0xdc5F6368cd31330adC259386e78604a5E29E9415",TrackerRegistry:"0xE4eA76e830a659282368cA2e7E4d18C4AE52D8B3",StorageNodeRegistry:"0x338090C5492C5c5E41a4458f5FC4b205cbc54A24",StreamRegistry:"0x18E0937099660B82464475Ea2B7e6Af4f2BFE5F0",ENSCacheV2:"0x7739b57beC285539A62434DF9808f66ebB405ba3",StreamStorageRegistry:"0xB73189CeBCc870bE6f9aa16764bbB3665e4B49B6",StreamrConfig:"0x00E680d549FE53a627a3db86a6F88fA2471CFfAa",SponsorshipOperatorContractOnlyJoinPolicy:"0xB9372284e0D61607aF3B7EF5f022e7D599Ed2a37",SponsorshipMaxOperatorsJoinPolicy:"0x36368Be8Cde49558Ab6ceEf2632984b282Db8775",SponsorshipStakeWeightedAllocationPolicy:"0xc24BA8c05E5206F1bE57bfA0aD14E9882126eD38",SponsorshipDefaultLeavePolicy:"0xBFCF120a8fD17670536f1B27D9737B775b2FD4CF",SponsorshipVoteKickPolicy:"0x92E8435EB56fD01BF4C79B66d47AC1A94338BB03",SponsorshipFactory:"0x699B4bE95614f017Bb622e427d3232837Cc814E6",OperatorDefaultDelegationPolicy:"0x5159FBF2e0Ff63e35b17293416fdf7a0909a0cDA",OperatorDefaultExchangeRatePolicy:"0xfC31c70FafCbFe399195C789602ae2455B247fD2",OperatorDefaultUndelegationPolicy:"0xBacF06448F4f14361AD80d425686021b041F3B2C",OperatorFactory:"0xD13D34d37e2c94cb35EA8D5DE7498Cb7830d26e0",ProjectRegistryV1:"0xA9166376706611110f814D1333b8E80FEc5d8f10",MarketplaceV4:"0xb8678223183d560280a7BEF68daAbB0E3daBd97D",ProjectStakingV1:"0x73a9310C43621B853C508902bb8c1DA8f1240EaE"},theGraphUrl:"http://10.200.10.1:8800/subgraphs/name/streamr-dev/network-subgraphs",entryPoints:[{nodeId:"eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",websocket:{host:"10.200.10.1",port:40500,tls:!1}}]},alfajores:{id:44787,name:"Celo Alfajores",nativeCurrency:{symbol:"CELO",name:"Celo Alfajores",decimals:18},rpcEndpoints:[{url:"https://alfajores-forno.celo-testnet.org"}],contracts:{ProjectRegistryV1:"0x32A142A27A595DC75aD1443728fecCbD5650446A",MarketplaceV4:"0x14577e0D5BD77536E073712d98E471edDaFAE8b4",cUSD:"0x874069Fa1Eb16D44d622F2e0Ca25eeA172369bC1"},blockExplorerUrl:"https://alfajores.celoscan.io"},optGoerli:{id:420,name:"Optimism Goerli Testnet",nativeCurrency:{symbol:"ETH",name:"Optimism Goerli Testnet Ethereum",decimals:18},rpcEndpoints:[{url:"https://goerli.optimism.io"}],contracts:{RemoteMarketplaceV1:"0xBef916b1EC6EAA3F522368f75094DAed5c228aF6",DAI:"0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1"},blockExplorerUrl:"https://goerli-optimism.etherscan.io"},ethereum:{id:1,name:"Ethereum",nativeCurrency:{symbol:"ETH",name:"Ethereum",decimals:18},rpcEndpoints:[],contracts:{AMB:"0x4C36d2919e407f0Cc2Ee3c993ccF8ac26d9CE64e",DATA:"0x8f693ca8D21b157107184d29D398A8D082b38b76",ENS:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",Marketplace:"0xdc8d23092b93f9bb7416f45dea36f55996f34867",MediatorDATA:"0x29e572d45cC33D5a68DCc8f92bfc7ded0017Bc59",MediatorXDATA:"0x2eeeDdeECe91c9F4c5bA4C8E1d784A0234C6d015",MigrationManager:"0xf32219E61c840300D1B35c939ed9E54a86163334",TrackerRegistry:"0xab9BEb0e8B106078c953CcAB4D6bF9142BeF854d",UniswapAdapter:"0xbe99db4ea1964ea9a9e80de41517901da6ef9307",XDATA:"0x0cf0ee63788a0849fe5297f3407f701e122cc023","core-api":"0xf3E5A65851C3779f468c9EcB32E6f25D9D68601a"},blockExplorerUrl:"https://etherscan.io"},gnosis:{id:100,name:"Gnosis Chain",nativeCurrency:{symbol:"xDAI",name:"xDai",decimals:18},rpcEndpoints:[{url:"https://rpc.gnosischain.com"},{url:"wss://rpc.gnosischain.com/wss"}],contracts:{AMB:"0x75Df5AF045d91108662D8080fD1FEFAd6aA0bb59",BinanceAdapterDATA:"0x193888692673b5dD46e6BC90bA8cBFeDa515c8C1",BinanceAdapterXDATA:"0x0c1aF6edA561fbDA48E9A7B1Dd46D216F31A97cC",DATA:"0x256eb8a51f382650B2A1e946b8811953640ee47D",DataUnionFactory:"0xe4515702878931b45Dfe4D89d3Fb3208910C913C",DataUnionTemplate:"0x1d425525c7A5df3736875fe76Bc3B9E776E89AcA",DataUnionFeeOracle:"0x86686266E7cA80b247151104f26d308079997637",Marketplace:"0x246dd6D96282c1ED9Ca69eF9f3e1f975fC1B8Bd5",MarketplaceV3:"0x2022E1F7749D355726Fb65285E29605A098bcb52",MediatorDATA:"0x53f3F44c434494da73EC44a6E8a8D091332bC2ce",MediatorXDATA:"0x7d55f9981d4E10A193314E001b96f72FCc901e40",MigrationManager:"0x29e572d45cC33D5a68DCc8f92bfc7ded0017Bc59",RemoteMarketplaceV1:"0x023eaE17d3dd65F1e7b4daa355e6478719Bd2BEf",StorageNodeRegistry:"0xC746847d7916623fb75849696f04827bbc34854f",UniswapAdapter:"0xc5Cd4900841a849d798725441b54fB0fec0d0f5b",Uniswap2AdapterForMarketplaceV3:"0xec92c5f94d45D1a4D917f2E07dD959b33e1AFe38",XDATA:"0xE4a2620edE1058D61BEe5F45F6414314fdf10548"},blockExplorerUrl:"https://gnosisscan.io"},binance:{id:56,name:"BNB Chain",nativeCurrency:{symbol:"BNB",name:"BNB",decimals:18},rpcEndpoints:[{url:"https://bsc-dataseed.binance.org"},{url:"wss://bsc-dataseed.binance.org"}],contracts:{DATA:"0x0864c156b3c5f69824564dec60c629ae6401bf2a",xdaiBridge:"0xa93ee7b4a7215f7e725437a6b6d7a4e7fe1dd8f0"},blockExplorerUrl:"https://bscscan.com"},polygon:{id:137,name:"Polygon",nativeCurrency:{symbol:"MATIC",name:"MATIC",decimals:18},rpcEndpoints:[{url:"https://polygon-rpc.com"},{url:"https://polygon.drpc.org"},{url:"https://rpc-mainnet.matic.quiknode.pro"},{url:"https://polygon-bor-rpc.publicnode.com"}],contracts:{ChainlinkOracle:"0x36BF71D0ba2e449fc14f9C4cF51468948E4ED27D",DATA:"0x3a9A81d576d83FF21f26f325066054540720fC34",DataUnionFactory:"0xd0B3a09A6bCee8446d10e6E7e12c78F8725C9B18",DataUnionTemplate:"0xaFe97F5a1cD3edE2c11d990e0EB0270054AA0589",DataUnionFeeOracle:"0x369Be397b3Cfe914728Bbd2329c0e5D1FE2E4202",GSNPayMaster:"0x43E69adABC664617EB9C5E19413a335e9cd4A243",GSNForwarder:"0xdA78a11FD57aF7be2eDD804840eA7f4c2A38801d",ENSCache:"0xEd9d3D29c25e197677DD84E3f7D81cCCD613B2bF",ENSCacheV2:"0xEd9d3D29c25e197677DD84E3f7D81cCCD613B2bF",Marketplace:"0x058FbB3Cf628EE51CE8864C9Ee8350f81E495A7D",MarketplaceV3:"0x1e9c22B4C92ce78Fe489C72f9D070C583D8359C3",MarketplaceV4:"0xdF8b74D735197dCD5C94bE933db080E69A958de6",ProjectRegistryV1:"0x496a6154da5aA6a021a3bd0DCd337DA80F48a6e1",ProjectStakingV1:"0xAA7a4BdBE91F143F3103206e48A8AfF21101B6DE",StorageNodeRegistry:"0x080F34fec2bc33928999Ea9e39ADc798bEF3E0d6",StreamRegistry:"0x0D483E10612F327FC11965Fc82E90dC19b141641",StreamStorageRegistry:"0xe8e2660CeDf2a59C917a5ED05B72df4146b58399",StreamrConfig:"0x869e88dB146ECAF20dDf199a12684cD80c263c8f",SponsorshipOperatorContractOnlyJoinPolicy:"0xa1F3c94A682Cb43d26AcC40dA1Dc31f49e4dA466",SponsorshipMaxOperatorsJoinPolicy:"0x27448061420bAccAE8c84DDC3E7e2e8B2aE4977E",SponsorshipStakeWeightedAllocationPolicy:"0x1Dd16E748308E9f259f3D6097d00e1793BfBdcDB",SponsorshipDefaultLeavePolicy:"0xa953D590098A3d56304a12A8e929D63748D90AAC",SponsorshipVoteKickPolicy:"0xeF3F567D7328849c1130CBCBF8Cd9feB42eA5dB5",SponsorshipFactory:"0x820b2f9a15ed45F9802c59d0CC77C22C81755e45",OperatorDefaultDelegationPolicy:"0x8e449F0B1AFAD807135B5Ea829F41851d5DE1426",OperatorDefaultExchangeRatePolicy:"0xE8F511bB4888D16D81acab7ab1c05A356E37237f",OperatorDefaultUndelegationPolicy:"0x5c81fA1e79318386Dd82Ef059bCB194DbA87De45",OperatorFactory:"0x935734e66729b69260543Cf6e5EfeB42AC962183",Uniswap2Router:"0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff",UniswapAdapter:"0xAd54A57383EcA2D4f0D22337A96A7c4f6Bd51A13",Uniswap2AdapterForMarketplaceV3:"0x83C42F77c6dD09A1A93A7834be65b3bB891106bE"},blockExplorerUrl:"https://polygonscan.com",theGraphUrl:"https://gateway-arbitrum.network.thegraph.com/api/a971cec07440a9ec63cd806c06ccc990/subgraphs/id/EGWFdhhiWypDuz22Uy7b3F69E9MEkyfU9iAQMttkH5Rj",entryPoints:[{nodeId:"e5f87a7ee99b3c91e7b795b70f87ef8ba5497596",websocket:{host:"polygon-entrypoint-3.streamr.network",port:443,tls:!0}},{nodeId:"6f5b53812fd9cc07f225a0b3a6aa5b96672e852e",websocket:{host:"polygon-entrypoint-4.streamr.network",port:443,tls:!0}}]},polygonAmoy:{id:80002,name:"Polygon Amoy testnet",nativeCurrency:{symbol:"MATIC",name:"Amoy MATIC",decimals:18},rpcEndpoints:[{url:"https://polygon-amoy-bor-rpc.publicnode.com"},{url:"https://rpc-amoy.polygon.technology"}],contracts:{DATA:"0xf5e28a2E7BbedbE97c3782b17b102410E10d90f1",StreamRegistry:"0xE9C98bdE63248e58E9137Db8270D9675B9E34b93",ENSCacheV2:"0x6a81414936868fdcF4f077e2a0B24879e2871016",StorageNodeRegistry:"0x02fdF917f4e6Ae8F7F1bBDd28179d819E2b76820",StreamStorageRegistry:"0x0f3671A9A92416E1aD32750faCf2AD4FA1b66f78",StreamrConfig:"0x835bC97D2a61bbF5d05932C5105Ca34e1b815F94",SponsorshipOperatorContractOnlyJoinPolicy:"0x930Dcc2ca313ACf7177185C0D68462fDc699C7e0",SponsorshipMaxOperatorsJoinPolicy:"0xd640C2C5102953d122759826daa6Aec25eC98ca5",SponsorshipStakeWeightedAllocationPolicy:"0xaC80c738FCF8d259F07C82eAD68B75aF4DF82223",SponsorshipDefaultLeavePolicy:"0x16Ba0F2793Da54b67717c6bAD471624C6628F2aa",SponsorshipVoteKickPolicy:"0xA73aDbEC14be2D3628CeAD022243f080CB162955",SponsorshipFactory:"0xb194a68b166f2e3074B551393fA61490D19c69f8",OperatorDefaultDelegationPolicy:"0x78f29fF290148e83795393f1858DC540D8cB046b",OperatorDefaultExchangeRatePolicy:"0x48d25dd5731AD644613b67E4281C505Ef392Dd70",OperatorDefaultUndelegationPolicy:"0x7962155D5ea2fF949FCF300F221964d5ef9d1bad",OperatorFactory:"0xE02E8E9fF5ea6a58F34D00C0e4B091e066B9fA81",ProjectRegistryV1:"0xc5e1434d35c0c7291c7032Fd9C4096b4876C6823",ProjectStakingV1:"0x3A27A16770477EbcFb4B81cE462F4f12591767A0",MarketplaceV4:"0x6C8eaA8e0bF605469c15b6F9106387B4cEC99976",DataUnionFactory:"0x62d48EBcf518AF1eb4c647721a19B046810623c4",DataUnionTemplate:"0xACe6B50B1d1Fb06b4650eF4Adb094747C65Ab674",DataUnionFeeOracle:"0x1A20217419156E09D36fd380d3F429d03AD2Dc97"},theGraphUrl:"https://gateway.thegraph.com/api/dd2dd773d33a3b2f5028ddaa8e1874c1/subgraphs/id/3nVH84bDz3wFJ82UZxMD2WfpGyU2KzDnZdEdDQFsHAqp",blockExplorerUrl:"https://amoy.polygonscan.com",entryPoints:[{nodeId:"d48787fc36eaed43770ec84947ef81557b19ec98",websocket:{host:"amoy-entrypoint-1.streamr.network",port:443,tls:!0}},{nodeId:"24395826687b099fd735a730219ba750169c4f40",websocket:{host:"amoy-entrypoint-2.streamr.network",port:443,tls:!0}}]},peaq:{id:3338,name:"Peaq EVM chain",nativeCurrency:{symbol:"PEAQ",name:"PEAQ",decimals:18},rpcEndpoints:[{url:"https://peaq.api.onfinality.io/public"}],contracts:{DATA:"0xdCB1EcdD509c61De5C3B672fDD2335AC750142c9",StreamRegistry:"0xD0C720e99Bd39311614f292d8B0B4e351Bde157c",ENSCacheV2:"0x4A71d0FA9e3326E830048B1423d7010fB9343071",StorageNodeRegistry:"0xaCF9e8134047eDc671162D9404BF63a587435bAa",StreamStorageRegistry:"0xB36CF8ee4219a3Ac9FBC3865C35E9a99353c26db",StreamrConfig:"0xc81Fa3Cc3E81dF24D21bfc608f8FB06262Da4F8c",SponsorshipOperatorContractOnlyJoinPolicy:"0xF655955dc561356851e95a6D0febeB0BAc955Ab5",SponsorshipMaxOperatorsJoinPolicy:"0xE41439BF434F9CfBF0153f5231C205d4ae0C22e3",SponsorshipStakeWeightedAllocationPolicy:"0xC8E8efAF4CE7bCcFc87878631BC64A1FAe63dc5D",SponsorshipDefaultLeavePolicy:"0xDa579a9a55158Bc57389f1b05F553DEf38a121c1",SponsorshipVoteKickPolicy:"0xdc8d23092b93F9BB7416F45dEa36f55996f34867",SponsorshipFactory:"0xdaF0905e19C45b9Fea7E60D232061edF78E9F570",OperatorDefaultDelegationPolicy:"0xD3329a2FC8194f0F96749275FF5162f7f2F031F7",OperatorDefaultExchangeRatePolicy:"0xA3D82B569ab0dEF86935fCf4e7714626a608CF81",OperatorDefaultUndelegationPolicy:"0x3EF89eF888721446Cf373C5070399B8225C9E936",OperatorFactory:"0x6d201374D7c28EF1c3cc1b6FA300f06110B597A3",ProjectRegistryV1:"0xB14205AE3D7672B937B972EBdf2b986fB0B8CfaA",ProjectStakingV1:"0xd1cBD6b1Be710C41c01A9613802209843407b8b9",MarketplaceV4:"0x959684926448296ea72BD4B05593426A3cD3F0dF"},blockExplorerUrl:"https://peaq.subscan.io",theGraphUrl:"https://gateway.thegraph.com/api/5bcf7b0d11045c944600d4007737d457/subgraphs/id/CV3grB3fYpUzET1s75kXG2BaNyREK5uRA8SkjLTyXXh7",entryPoints:[{nodeId:"e5f87a7ee99b3c91e7b795b70f87ef8ba5497596",websocket:{host:"polygon-entrypoint-3.streamr.network",port:443,tls:!0}},{nodeId:"6f5b53812fd9cc07f225a0b3a6aa5b96672e852e",websocket:{host:"polygon-entrypoint-4.streamr.network",port:443,tls:!0}}]},iotex:{id:4689,name:"IoTeX",nativeCurrency:{symbol:"IOTX",name:"IOTX",decimals:18},rpcEndpoints:[{url:"https://babel-api.mainnet.iotex.one"}],contracts:{DATA:"0xD94be6fd546d4cE502CB1E870A58330Cc8869e9B",StreamRegistry:"0x080F34fec2bc33928999Ea9e39ADc798bEF3E0d6",ENSCacheV2:"0xAB072849dd3Cd648cb85c73d525a70A36523337d",StorageNodeRegistry:"0xb9e70Bd9833dd091f06edc8073aa86a76EdeF46D",StreamStorageRegistry:"0xF79c40Fbc432f1f8B8B017441B644e0ac7bccea2",StreamrConfig:"0x176B108E72ee49A01Bea1eDb32f7f296d2bb3db8",SponsorshipOperatorContractOnlyJoinPolicy:"0xace5b2A71A44efD9259983b5671d8ba802703dF7",SponsorshipMaxOperatorsJoinPolicy:"0x6956abe11F99e3983282f8B4fFb30015cC45Ae1D",SponsorshipStakeWeightedAllocationPolicy:"0x0Eb81BF75e585B227c01BBd1Ba5Ee0Ab6b1b55d5",SponsorshipDefaultLeavePolicy:"0xb9fe5430aC3eE3B1D26734C513f41Bf96B10C830",SponsorshipVoteKickPolicy:"0xc4a1ba0655FC6C34F9283e33682e57031fC060af",SponsorshipFactory:"0x7ac03730374E995E366F2a466be6aCC14E1DB1C4",OperatorDefaultDelegationPolicy:"0x5E0F361EC38cBE990baCB0D3008B5582DA4eAa2a",OperatorDefaultExchangeRatePolicy:"0x75e26741538825263954AC2a1Ad9d6eAb695FD47",OperatorDefaultUndelegationPolicy:"0x6D48ee54898e9B1f5FBe468ab85eA542dd82Ae6c",OperatorFactory:"0xD1Bc2A37405F88d4904844B7BF1BEadA7c0851c1",ProjectRegistryV1:"0xbb2a2CF40Ca86378983cfcACB7Aac1568237a692",MarketplaceV4:"0xe3F6750a5f9a6315cB11adc5CE980F7356C927C4",ProjectStakingV1:"0x0F91Edc1760e64e434Fb9CaF93a76b262E7015b3"},blockExplorerUrl:"https://iotexscan.io",theGraphUrl:"https://gateway.thegraph.com/api/4bddc6e1e1fe65a49bf8091785478835/subgraphs/id/CvGQcfBwWH1SvyxJDGjRRMa4YXQpxmpt369orMirZ3RH",entryPoints:[{nodeId:"e5f87a7ee99b3c91e7b795b70f87ef8ba5497596",websocket:{host:"polygon-entrypoint-3.streamr.network",port:443,tls:!0}},{nodeId:"6f5b53812fd9cc07f225a0b3a6aa5b96672e852e",websocket:{host:"polygon-entrypoint-4.streamr.network",port:443,tls:!0}}]},iotexTestnet:{id:4690,name:"IoTeX Testnet",nativeCurrency:{symbol:"IOTEX",name:"IOTEX",decimals:18},rpcEndpoints:[{url:"https://babel-api.testnet.iotex.io"}],contracts:{DATA:"0x5ABD469031d2B5f939808565EAB8562d7Cbaa939",StreamRegistry:"0xDC695780959aa5aEe9B28dfED7332032e3045210",ENSCacheV2:"0xDDf8FB60f8c3ffb1C20375A30f6D8CFB0C48Bd38",StorageNodeRegistry:"0xc0F9666fbF16B2ac5726697237BcdF79096e3FA7",StreamStorageRegistry:"0xd0C3A69762Bd920C1cAfBE91612a4600429f02f1",StreamrConfig:"0x6d201374D7c28EF1c3cc1b6FA300f06110B597A3",SponsorshipOperatorContractOnlyJoinPolicy:"0xAd24077505d3584F1AC8d78719F9d31F7Da0E264",SponsorshipMaxOperatorsJoinPolicy:"0x78d13aaBA657F448933Bb469E4E549Dee88cB78B",SponsorshipStakeWeightedAllocationPolicy:"0xB14205AE3D7672B937B972EBdf2b986fB0B8CfaA",SponsorshipDefaultLeavePolicy:"0xfC9C1886EAd9a757039Edbee16Bea0183344D2BA",SponsorshipVoteKickPolicy:"0xd1cBD6b1Be710C41c01A9613802209843407b8b9",SponsorshipFactory:"0x84c8d8f9760639e159350e5d2Bfaada99b670114",OperatorDefaultDelegationPolicy:"0x67352e3F7dBA907aF877020aE7E9450C0029C70c",OperatorDefaultExchangeRatePolicy:"0xE41439BF434F9CfBF0153f5231C205d4ae0C22e3",OperatorDefaultUndelegationPolicy:"0xF655955dc561356851e95a6D0febeB0BAc955Ab5",OperatorFactory:"0xdaF0905e19C45b9Fea7E60D232061edF78E9F570"},blockExplorerUrl:"https://testnet.iotexscan.io",entryPoints:[]}}},4062(e,t,r){"use strict";t.$=void 0;const n=r(3808);Object.defineProperty(t,"$",{enumerable:!0,get:function(){return n.config}}),n.config},9723(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StreamrConfigABI=t.SponsorshipFactoryABI=t.OperatorFactoryABI=t.SponsorshipABI=t.OperatorABI=t.NodeRegistryABI=t.StreamStorageRegistryABI=t.StreamRegistryABI=t.DATAv2ABI=void 0;var i=r(606);Object.defineProperty(t,"DATAv2ABI",{enumerable:!0,get:function(){return n(i).default}});var s=r(8851);Object.defineProperty(t,"StreamRegistryABI",{enumerable:!0,get:function(){return n(s).default}});var o=r(1247);Object.defineProperty(t,"StreamStorageRegistryABI",{enumerable:!0,get:function(){return n(o).default}});var a=r(3173);Object.defineProperty(t,"NodeRegistryABI",{enumerable:!0,get:function(){return n(a).default}});var c=r(862);Object.defineProperty(t,"OperatorABI",{enumerable:!0,get:function(){return n(c).default}});var u=r(6963);Object.defineProperty(t,"SponsorshipABI",{enumerable:!0,get:function(){return n(u).default}});var l=r(5324);Object.defineProperty(t,"OperatorFactoryABI",{enumerable:!0,get:function(){return n(l).default}});var d=r(7046);Object.defineProperty(t,"SponsorshipFactoryABI",{enumerable:!0,get:function(){return n(d).default}});var h=r(6544);Object.defineProperty(t,"StreamrConfigABI",{enumerable:!0,get:function(){return n(h).default}})},5568(e){"use strict";const{AbortController:t,AbortSignal:r}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;e.exports=t,e.exports.AbortSignal=r,e.exports.default=t},7568(e,t,r){"use strict";const n=t;n.bignum=r(9404),n.define=r(7363).define,n.base=r(9673),n.constants=r(2153),n.decoders=r(2853),n.encoders=r(4669)},7363(e,t,r){"use strict";const n=r(4669),i=r(2853),s=r(6698);function o(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}t.define=function(e,t){return new o(e,t)},o.prototype._createNamed=function(e){const t=this.name;function r(e){this._initNamed(e,t)}return s(r,e),r.prototype._initNamed=function(t,r){e.call(this,t,r)},new r(this)},o.prototype._getDecoder=function(e){return e=e||"der",this.decoders.hasOwnProperty(e)||(this.decoders[e]=this._createNamed(i[e])),this.decoders[e]},o.prototype.decode=function(e,t,r){return this._getDecoder(t).decode(e,r)},o.prototype._getEncoder=function(e){return e=e||"der",this.encoders.hasOwnProperty(e)||(this.encoders[e]=this._createNamed(n[e])),this.encoders[e]},o.prototype.encode=function(e,t,r){return this._getEncoder(t).encode(e,r)}},7227(e,t,r){"use strict";const n=r(6698),i=r(9220).a,s=r(4774).Buffer;function o(e,t){i.call(this,t),s.isBuffer(e)?(this.base=e,this.offset=0,this.length=e.length):this.error("Input not Buffer")}function a(e,t){if(Array.isArray(e))this.length=0,this.value=e.map(function(e){return a.isEncoderBuffer(e)||(e=new a(e,t)),this.length+=e.length,e},this);else if("number"==typeof e){if(!(0<=e&&e<=255))return t.error("non-byte EncoderBuffer value");this.value=e,this.length=1}else if("string"==typeof e)this.value=e,this.length=s.byteLength(e);else{if(!s.isBuffer(e))return t.error("Unsupported type: "+typeof e);this.value=e,this.length=e.length}}n(o,i),t.t=o,o.isDecoderBuffer=function(e){return e instanceof o||"object"==typeof e&&s.isBuffer(e.base)&&"DecoderBuffer"===e.constructor.name&&"number"==typeof e.offset&&"number"==typeof e.length&&"function"==typeof e.save&&"function"==typeof e.restore&&"function"==typeof e.isEmpty&&"function"==typeof e.readUInt8&&"function"==typeof e.skip&&"function"==typeof e.raw},o.prototype.save=function(){return{offset:this.offset,reporter:i.prototype.save.call(this)}},o.prototype.restore=function(e){const t=new o(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,i.prototype.restore.call(this,e.reporter),t},o.prototype.isEmpty=function(){return this.offset===this.length},o.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},o.prototype.skip=function(e,t){if(!(this.offset+e<=this.length))return this.error(t||"DecoderBuffer overrun");const r=new o(this.base);return r._reporterState=this._reporterState,r.offset=this.offset,r.length=this.offset+e,this.offset+=e,r},o.prototype.raw=function(e){return this.base.slice(e?e.offset:this.offset,this.length)},t.d=a,a.isEncoderBuffer=function(e){return e instanceof a||"object"==typeof e&&"EncoderBuffer"===e.constructor.name&&"number"==typeof e.length&&"function"==typeof e.join},a.prototype.join=function(e,t){return e||(e=s.alloc(this.length)),t||(t=0),0===this.length||(Array.isArray(this.value)?this.value.forEach(function(r){r.join(e,t),t+=r.length}):("number"==typeof this.value?e[t]=this.value:"string"==typeof this.value?e.write(this.value,t):s.isBuffer(this.value)&&this.value.copy(e,t),t+=this.length)),e}},9673(e,t,r){"use strict";const n=t;n.Reporter=r(9220).a,n.DecoderBuffer=r(7227).t,n.EncoderBuffer=r(7227).d,n.Node=r(993)},993(e,t,r){"use strict";const n=r(9220).a,i=r(7227).d,s=r(7227).t,o=r(3349),a=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],c=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(a);function u(e,t,r){const n={};this._baseState=n,n.name=r,n.enc=e,n.parent=t||null,n.children=null,n.tag=null,n.args=null,n.reverseArgs=null,n.choice=null,n.optional=!1,n.any=!1,n.obj=!1,n.use=null,n.useDecoder=null,n.key=null,n.default=null,n.explicit=null,n.implicit=null,n.contains=null,n.parent||(n.children=[],this._wrap())}e.exports=u;const l=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];u.prototype.clone=function(){const e=this._baseState,t={};l.forEach(function(r){t[r]=e[r]});const r=new this.constructor(t.parent);return r._baseState=t,r},u.prototype._wrap=function(){const e=this._baseState;c.forEach(function(t){this[t]=function(){const r=new this.constructor(this);return e.children.push(r),r[t].apply(r,arguments)}},this)},u.prototype._init=function(e){const t=this._baseState;o(null===t.parent),e.call(this),t.children=t.children.filter(function(e){return e._baseState.parent===this},this),o.equal(t.children.length,1,"Root node can have only one child")},u.prototype._useArgs=function(e){const t=this._baseState,r=e.filter(function(e){return e instanceof this.constructor},this);e=e.filter(function(e){return!(e instanceof this.constructor)},this),0!==r.length&&(o(null===t.children),t.children=r,r.forEach(function(e){e._baseState.parent=this},this)),0!==e.length&&(o(null===t.args),t.args=e,t.reverseArgs=e.map(function(e){if("object"!=typeof e||e.constructor!==Object)return e;const t={};return Object.keys(e).forEach(function(r){r==(0|r)&&(r|=0);const n=e[r];t[n]=r}),t}))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach(function(e){u.prototype[e]=function(){const t=this._baseState;throw new Error(e+" not implemented for encoding: "+t.enc)}}),a.forEach(function(e){u.prototype[e]=function(){const t=this._baseState,r=Array.prototype.slice.call(arguments);return o(null===t.tag),t.tag=e,this._useArgs(r),this}}),u.prototype.use=function(e){o(e);const t=this._baseState;return o(null===t.use),t.use=e,this},u.prototype.optional=function(){return this._baseState.optional=!0,this},u.prototype.def=function(e){const t=this._baseState;return o(null===t.default),t.default=e,t.optional=!0,this},u.prototype.explicit=function(e){const t=this._baseState;return o(null===t.explicit&&null===t.implicit),t.explicit=e,this},u.prototype.implicit=function(e){const t=this._baseState;return o(null===t.explicit&&null===t.implicit),t.implicit=e,this},u.prototype.obj=function(){const e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},u.prototype.key=function(e){const t=this._baseState;return o(null===t.key),t.key=e,this},u.prototype.any=function(){return this._baseState.any=!0,this},u.prototype.choice=function(e){const t=this._baseState;return o(null===t.choice),t.choice=e,this._useArgs(Object.keys(e).map(function(t){return e[t]})),this},u.prototype.contains=function(e){const t=this._baseState;return o(null===t.use),t.contains=e,this},u.prototype._decode=function(e,t){const r=this._baseState;if(null===r.parent)return e.wrapResult(r.children[0]._decode(e,t));let n,i=r.default,o=!0,a=null;if(null!==r.key&&(a=e.enterKey(r.key)),r.optional){let n=null;if(null!==r.explicit?n=r.explicit:null!==r.implicit?n=r.implicit:null!==r.tag&&(n=r.tag),null!==n||r.any){if(o=this._peekTag(e,n,r.any),e.isError(o))return o}else{const n=e.save();try{null===r.choice?this._decodeGeneric(r.tag,e,t):this._decodeChoice(e,t),o=!0}catch(e){o=!1}e.restore(n)}}if(r.obj&&o&&(n=e.enterObject()),o){if(null!==r.explicit){const t=this._decodeTag(e,r.explicit);if(e.isError(t))return t;e=t}const n=e.offset;if(null===r.use&&null===r.choice){let t;r.any&&(t=e.save());const n=this._decodeTag(e,null!==r.implicit?r.implicit:r.tag,r.any);if(e.isError(n))return n;r.any?i=e.raw(t):e=n}if(t&&t.track&&null!==r.tag&&t.track(e.path(),n,e.length,"tagged"),t&&t.track&&null!==r.tag&&t.track(e.path(),e.offset,e.length,"content"),r.any||(i=null===r.choice?this._decodeGeneric(r.tag,e,t):this._decodeChoice(e,t)),e.isError(i))return i;if(r.any||null!==r.choice||null===r.children||r.children.forEach(function(r){r._decode(e,t)}),r.contains&&("octstr"===r.tag||"bitstr"===r.tag)){const n=new s(i);i=this._getUse(r.contains,e._reporterState.obj)._decode(n,t)}}return r.obj&&o&&(i=e.leaveObject(n)),null===r.key||null===i&&!0!==o?null!==a&&e.exitKey(a):e.leaveKey(a,r.key,i),i},u.prototype._decodeGeneric=function(e,t,r){const n=this._baseState;return"seq"===e||"set"===e?null:"seqof"===e||"setof"===e?this._decodeList(t,e,n.args[0],r):/str$/.test(e)?this._decodeStr(t,e,r):"objid"===e&&n.args?this._decodeObjid(t,n.args[0],n.args[1],r):"objid"===e?this._decodeObjid(t,null,null,r):"gentime"===e||"utctime"===e?this._decodeTime(t,e,r):"null_"===e?this._decodeNull(t,r):"bool"===e?this._decodeBool(t,r):"objDesc"===e?this._decodeStr(t,e,r):"int"===e||"enum"===e?this._decodeInt(t,n.args&&n.args[0],r):null!==n.use?this._getUse(n.use,t._reporterState.obj)._decode(t,r):t.error("unknown tag: "+e)},u.prototype._getUse=function(e,t){const r=this._baseState;return r.useDecoder=this._use(e,t),o(null===r.useDecoder._baseState.parent),r.useDecoder=r.useDecoder._baseState.children[0],r.implicit!==r.useDecoder._baseState.implicit&&(r.useDecoder=r.useDecoder.clone(),r.useDecoder._baseState.implicit=r.implicit),r.useDecoder},u.prototype._decodeChoice=function(e,t){const r=this._baseState;let n=null,i=!1;return Object.keys(r.choice).some(function(s){const o=e.save(),a=r.choice[s];try{const r=a._decode(e,t);if(e.isError(r))return!1;n={type:s,value:r},i=!0}catch(t){return e.restore(o),!1}return!0},this),i?n:e.error("Choice not matched")},u.prototype._createEncoderBuffer=function(e){return new i(e,this.reporter)},u.prototype._encode=function(e,t,r){const n=this._baseState;if(null!==n.default&&n.default===e)return;const i=this._encodeValue(e,t,r);return void 0===i||this._skipDefault(i,t,r)?void 0:i},u.prototype._encodeValue=function(e,t,r){const i=this._baseState;if(null===i.parent)return i.children[0]._encode(e,t||new n);let s=null;if(this.reporter=t,i.optional&&void 0===e){if(null===i.default)return;e=i.default}let o=null,a=!1;if(i.any)s=this._createEncoderBuffer(e);else if(i.choice)s=this._encodeChoice(e,t);else if(i.contains)o=this._getUse(i.contains,r)._encode(e,t),a=!0;else if(i.children)o=i.children.map(function(r){if("null_"===r._baseState.tag)return r._encode(null,t,e);if(null===r._baseState.key)return t.error("Child should have a key");const n=t.enterKey(r._baseState.key);if("object"!=typeof e)return t.error("Child expected, but input is not object");const i=r._encode(e[r._baseState.key],t,e);return t.leaveKey(n),i},this).filter(function(e){return e}),o=this._createEncoderBuffer(o);else if("seqof"===i.tag||"setof"===i.tag){if(!i.args||1!==i.args.length)return t.error("Too many args for : "+i.tag);if(!Array.isArray(e))return t.error("seqof/setof, but data is not Array");const r=this.clone();r._baseState.implicit=null,o=this._createEncoderBuffer(e.map(function(r){const n=this._baseState;return this._getUse(n.args[0],e)._encode(r,t)},r))}else null!==i.use?s=this._getUse(i.use,r)._encode(e,t):(o=this._encodePrimitive(i.tag,e),a=!0);if(!i.any&&null===i.choice){const e=null!==i.implicit?i.implicit:i.tag,r=null===i.implicit?"universal":"context";null===e?null===i.use&&t.error("Tag could be omitted only for .use()"):null===i.use&&(s=this._encodeComposite(e,a,r,o))}return null!==i.explicit&&(s=this._encodeComposite(i.explicit,!1,"context",s)),s},u.prototype._encodeChoice=function(e,t){const r=this._baseState,n=r.choice[e.type];return n||o(!1,e.type+" not found in "+JSON.stringify(Object.keys(r.choice))),n._encode(e.value,t)},u.prototype._encodePrimitive=function(e,t){const r=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&r.args)return this._encodeObjid(t,r.reverseArgs[0],r.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();if("int"===e||"enum"===e)return this._encodeInt(t,r.args&&r.reverseArgs[0]);if("bool"===e)return this._encodeBool(t);if("objDesc"===e)return this._encodeStr(t,e);throw new Error("Unsupported tag: "+e)},u.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},u.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/.test(e)}},9220(e,t,r){"use strict";const n=r(6698);function i(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function s(e,t){this.path=e,this.rethrow(t)}t.a=i,i.prototype.isError=function(e){return e instanceof s},i.prototype.save=function(){const e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},i.prototype.restore=function(e){const t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},i.prototype.enterKey=function(e){return this._reporterState.path.push(e)},i.prototype.exitKey=function(e){const t=this._reporterState;t.path=t.path.slice(0,e-1)},i.prototype.leaveKey=function(e,t,r){const n=this._reporterState;this.exitKey(e),null!==n.obj&&(n.obj[t]=r)},i.prototype.path=function(){return this._reporterState.path.join("/")},i.prototype.enterObject=function(){const e=this._reporterState,t=e.obj;return e.obj={},t},i.prototype.leaveObject=function(e){const t=this._reporterState,r=t.obj;return t.obj=e,r},i.prototype.error=function(e){let t;const r=this._reporterState,n=e instanceof s;if(t=n?e:new s(r.path.map(function(e){return"["+JSON.stringify(e)+"]"}).join(""),e.message||e,e.stack),!r.options.partial)throw t;return n||r.errors.push(t),t},i.prototype.wrapResult=function(e){const t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},n(s,Error),s.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,s),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this}},4598(e,t){"use strict";function r(e){const t={};return Object.keys(e).forEach(function(r){(0|r)==r&&(r|=0);const n=e[r];t[n]=r}),t}t.tagClass={0:"universal",1:"application",2:"context",3:"private"},t.tagClassByName=r(t.tagClass),t.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},t.tagByName=r(t.tag)},2153(e,t,r){"use strict";const n=t;n._reverse=function(e){const t={};return Object.keys(e).forEach(function(r){(0|r)==r&&(r|=0);const n=e[r];t[n]=r}),t},n.der=r(4598)},2010(e,t,r){"use strict";const n=r(6698),i=r(9404),s=r(7227).t,o=r(993),a=r(4598);function c(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new u,this.tree._init(e.body)}function u(e){o.call(this,"der",e)}function l(e,t){let r=e.readUInt8(t);if(e.isError(r))return r;const n=a.tagClass[r>>6],i=!(32&r);if(31&~r)r&=31;else{let n=r;for(r=0;!(128&~n);){if(n=e.readUInt8(t),e.isError(n))return n;r<<=7,r|=127&n}}return{cls:n,primitive:i,tag:r,tagStr:a.tag[r]}}function d(e,t,r){let n=e.readUInt8(r);if(e.isError(n))return n;if(!t&&128===n)return null;if(!(128&n))return n;const i=127&n;if(i>4)return e.error("length octect is too long");n=0;for(let t=0;t<i;t++){n<<=8;const t=e.readUInt8(r);if(e.isError(t))return t;n|=t}return n}e.exports=c,c.prototype.decode=function(e,t){return s.isDecoderBuffer(e)||(e=new s(e,t)),this.tree._decode(e,t)},n(u,o),u.prototype._peekTag=function(e,t,r){if(e.isEmpty())return!1;const n=e.save(),i=l(e,'Failed to peek tag: "'+t+'"');return e.isError(i)?i:(e.restore(n),i.tag===t||i.tagStr===t||i.tagStr+"of"===t||r)},u.prototype._decodeTag=function(e,t,r){const n=l(e,'Failed to decode tag of "'+t+'"');if(e.isError(n))return n;let i=d(e,n.primitive,'Failed to get length of "'+t+'"');if(e.isError(i))return i;if(!r&&n.tag!==t&&n.tagStr!==t&&n.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(n.primitive||null!==i)return e.skip(i,'Failed to match body of: "'+t+'"');const s=e.save(),o=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');return e.isError(o)?o:(i=e.offset-s.offset,e.restore(s),e.skip(i,'Failed to match body of: "'+t+'"'))},u.prototype._skipUntilEnd=function(e,t){for(;;){const r=l(e,t);if(e.isError(r))return r;const n=d(e,r.primitive,t);if(e.isError(n))return n;let i;if(i=r.primitive||null!==n?e.skip(n):this._skipUntilEnd(e,t),e.isError(i))return i;if("end"===r.tagStr)break}},u.prototype._decodeList=function(e,t,r,n){const i=[];for(;!e.isEmpty();){const t=this._peekTag(e,"end");if(e.isError(t))return t;const s=r.decode(e,"der",n);if(e.isError(s)&&t)break;i.push(s)}return i},u.prototype._decodeStr=function(e,t){if("bitstr"===t){const t=e.readUInt8();return e.isError(t)?t:{unused:t,data:e.raw()}}if("bmpstr"===t){const t=e.raw();if(t.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");let r="";for(let e=0;e<t.length/2;e++)r+=String.fromCharCode(t.readUInt16BE(2*e));return r}if("numstr"===t){const t=e.raw().toString("ascii");return this._isNumstr(t)?t:e.error("Decoding of string type: numstr unsupported characters")}if("octstr"===t)return e.raw();if("objDesc"===t)return e.raw();if("printstr"===t){const t=e.raw().toString("ascii");return this._isPrintstr(t)?t:e.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(t)?e.raw().toString():e.error("Decoding of string type: "+t+" unsupported")},u.prototype._decodeObjid=function(e,t,r){let n;const i=[];let s=0,o=0;for(;!e.isEmpty();)o=e.readUInt8(),s<<=7,s|=127&o,128&o||(i.push(s),s=0);128&o&&i.push(s);const a=i[0]/40|0,c=i[0]%40;if(n=r?i:[a,c].concat(i.slice(1)),t){let e=t[n.join(" ")];void 0===e&&(e=t[n.join(".")]),void 0!==e&&(n=e)}return n},u.prototype._decodeTime=function(e,t){const r=e.raw().toString();let n,i,s,o,a,c;if("gentime"===t)n=0|r.slice(0,4),i=0|r.slice(4,6),s=0|r.slice(6,8),o=0|r.slice(8,10),a=0|r.slice(10,12),c=0|r.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");n=0|r.slice(0,2),i=0|r.slice(2,4),s=0|r.slice(4,6),o=0|r.slice(6,8),a=0|r.slice(8,10),c=0|r.slice(10,12),n=n<70?2e3+n:1900+n}return Date.UTC(n,i-1,s,o,a,c,0)},u.prototype._decodeNull=function(){return null},u.prototype._decodeBool=function(e){const t=e.readUInt8();return e.isError(t)?t:0!==t},u.prototype._decodeInt=function(e,t){const r=e.raw();let n=new i(r);return t&&(n=t[n.toString(10)]||n),n},u.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getDecoder("der").tree}},2853(e,t,r){"use strict";const n=t;n.der=r(2010),n.pem=r(8903)},8903(e,t,r){"use strict";const n=r(6698),i=r(4774).Buffer,s=r(2010);function o(e){s.call(this,e),this.enc="pem"}n(o,s),e.exports=o,o.prototype.decode=function(e,t){const r=e.toString().split(/[\r\n]+/g),n=t.label.toUpperCase(),o=/^-----(BEGIN|END) ([^-]+)-----$/;let a=-1,c=-1;for(let e=0;e<r.length;e++){const t=r[e].match(o);if(null!==t&&t[2]===n){if(-1!==a){if("END"!==t[1])break;c=e;break}if("BEGIN"!==t[1])break;a=e}}if(-1===a||-1===c)throw new Error("PEM section not found for: "+n);const u=r.slice(a+1,c).join("");u.replace(/[^a-z0-9+/=]+/gi,"");const l=i.from(u,"base64");return s.prototype.decode.call(this,l,t)}},82(e,t,r){"use strict";const n=r(6698),i=r(4774).Buffer,s=r(993),o=r(4598);function a(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new c,this.tree._init(e.body)}function c(e){s.call(this,"der",e)}function u(e){return e<10?"0"+e:e}e.exports=a,a.prototype.encode=function(e,t){return this.tree._encode(e,t).join()},n(c,s),c.prototype._encodeComposite=function(e,t,r,n){const s=function(e,t,r,n){let i;if("seqof"===e?e="seq":"setof"===e&&(e="set"),o.tagByName.hasOwnProperty(e))i=o.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return n.error("Unknown tag: "+e);i=e}return i>=31?n.error("Multi-octet tag encoding unsupported"):(t||(i|=32),i|=o.tagClassByName[r||"universal"]<<6,i)}(e,t,r,this.reporter);if(n.length<128){const e=i.alloc(2);return e[0]=s,e[1]=n.length,this._createEncoderBuffer([e,n])}let a=1;for(let e=n.length;e>=256;e>>=8)a++;const c=i.alloc(2+a);c[0]=s,c[1]=128|a;for(let e=1+a,t=n.length;t>0;e--,t>>=8)c[e]=255&t;return this._createEncoderBuffer([c,n])},c.prototype._encodeStr=function(e,t){if("bitstr"===t)return this._createEncoderBuffer([0|e.unused,e.data]);if("bmpstr"===t){const t=i.alloc(2*e.length);for(let r=0;r<e.length;r++)t.writeUInt16BE(e.charCodeAt(r),2*r);return this._createEncoderBuffer(t)}return"numstr"===t?this._isNumstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===t?this._isPrintstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(t)||"objDesc"===t?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: "+t+" unsupported")},c.prototype._encodeObjid=function(e,t,r){if("string"==typeof e){if(!t)return this.reporter.error("string objid given, but no values map found");if(!t.hasOwnProperty(e))return this.reporter.error("objid not found in values map");e=t[e].split(/[\s.]+/g);for(let t=0;t<e.length;t++)e[t]|=0}else if(Array.isArray(e)){e=e.slice();for(let t=0;t<e.length;t++)e[t]|=0}if(!Array.isArray(e))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(e));if(!r){if(e[1]>=40)return this.reporter.error("Second objid identifier OOB");e.splice(0,2,40*e[0]+e[1])}let n=0;for(let t=0;t<e.length;t++){let r=e[t];for(n++;r>=128;r>>=7)n++}const s=i.alloc(n);let o=s.length-1;for(let t=e.length-1;t>=0;t--){let r=e[t];for(s[o--]=127&r;(r>>=7)>0;)s[o--]=128|127&r}return this._createEncoderBuffer(s)},c.prototype._encodeTime=function(e,t){let r;const n=new Date(e);return"gentime"===t?r=[u(n.getUTCFullYear()),u(n.getUTCMonth()+1),u(n.getUTCDate()),u(n.getUTCHours()),u(n.getUTCMinutes()),u(n.getUTCSeconds()),"Z"].join(""):"utctime"===t?r=[u(n.getUTCFullYear()%100),u(n.getUTCMonth()+1),u(n.getUTCDate()),u(n.getUTCHours()),u(n.getUTCMinutes()),u(n.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(r,"octstr")},c.prototype._encodeNull=function(){return this._createEncoderBuffer("")},c.prototype._encodeInt=function(e,t){if("string"==typeof e){if(!t)return this.reporter.error("String int or enum given, but no values map");if(!t.hasOwnProperty(e))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(e));e=t[e]}if("number"!=typeof e&&!i.isBuffer(e)){const t=e.toArray();!e.sign&&128&t[0]&&t.unshift(0),e=i.from(t)}if(i.isBuffer(e)){let t=e.length;0===e.length&&t++;const r=i.alloc(t);return e.copy(r),0===e.length&&(r[0]=0),this._createEncoderBuffer(r)}if(e<128)return this._createEncoderBuffer(e);if(e<256)return this._createEncoderBuffer([0,e]);let r=1;for(let t=e;t>=256;t>>=8)r++;const n=new Array(r);for(let t=n.length-1;t>=0;t--)n[t]=255&e,e>>=8;return 128&n[0]&&n.unshift(0),this._createEncoderBuffer(i.from(n))},c.prototype._encodeBool=function(e){return this._createEncoderBuffer(e?255:0)},c.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getEncoder("der").tree},c.prototype._skipDefault=function(e,t,r){const n=this._baseState;let i;if(null===n.default)return!1;const s=e.join();if(void 0===n.defaultBuffer&&(n.defaultBuffer=this._encodeValue(n.default,t,r).join()),s.length!==n.defaultBuffer.length)return!1;for(i=0;i<s.length;i++)if(s[i]!==n.defaultBuffer[i])return!1;return!0}},4669(e,t,r){"use strict";const n=t;n.der=r(82),n.pem=r(735)},735(e,t,r){"use strict";const n=r(6698),i=r(82);function s(e){i.call(this,e),this.enc="pem"}n(s,i),e.exports=s,s.prototype.encode=function(e,t){const r=i.prototype.encode.call(this,e).toString("base64"),n=["-----BEGIN "+t.label+"-----"];for(let e=0;e<r.length;e+=64)n.push(r.slice(e,e+64));return n.push("-----END "+t.label+"-----"),n.join("\n")}},7526(e,t){"use strict";t.byteLength=function(e){var t=a(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,s=a(e),o=s[0],c=s[1],u=new i(function(e,t,r){return 3*(t+r)/4-r}(0,o,c)),l=0,d=c>0?o-4:o;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===c&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[l++]=255&t),1===c&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],o=16383,a=0,c=n-i;a<c;a+=o)s.push(u(e,a,a+o>c?c:a+o));return 1===i?(t=e[n-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)r[o]=s[o],n[s.charCodeAt(o)]=o;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function u(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(c(n));return i.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},9404(e,t,r){!function(e,t){"use strict";function n(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function s(e,t,r){if(s.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var o;"object"==typeof e?e.exports=s:t.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(7790).Buffer}catch(e){}function a(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function c(e,t,r){var n=a(e,r);return r-1>=t&&(n|=a(e,r-1)<<4),n}function u(e,t,r,n){for(var i=0,s=Math.min(e.length,r),o=t;o<s;o++){var a=e.charCodeAt(o)-48;i*=n,i+=a>=49?a-49+10:a>=17?a-17+10:a}return i}s.isBN=function(e){return e instanceof s||null!==e&&"object"==typeof e&&e.constructor.wordSize===s.wordSize&&Array.isArray(e.words)},s.max=function(e,t){return e.cmp(t)>0?e:t},s.min=function(e,t){return e.cmp(t)<0?e:t},s.prototype._init=function(e,t,r){if("number"==typeof e)return this._initNumber(e,t,r);if("object"==typeof e)return this._initArray(e,t,r);"hex"===t&&(t=16),n(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,r):(this._parseBase(e,t,i),"le"===r&&this._initArray(this.toArray(),t,r)))},s.prototype._initNumber=function(e,t,r){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(n(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),t,r)},s.prototype._initArray=function(e,t,r){if(n("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var s,o,a=0;if("be"===r)for(i=e.length-1,s=0;i>=0;i-=3)o=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(i=0,s=0;i<e.length;i+=3)o=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},s.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,s=0,o=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=c(e,t,n)<<s,this.words[o]|=67108863&i,s>=18?(s-=18,o+=1,this.words[o]|=i>>>26):s+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=c(e,t,n)<<s,this.words[o]|=67108863&i,s>=18?(s-=18,o+=1,this.words[o]|=i>>>26):s+=8;this.strip()},s.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var s=e.length-r,o=s%n,a=Math.min(s,s-o)+r,c=0,l=r;l<a;l+=n)c=u(e,l,l+n,t),this.imuln(i),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==o){var d=1;for(c=u(e,l,e.length,t),l=0;l<o;l++)d*=t;this.imuln(d),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this.strip()},s.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},s.prototype.clone=function(){var e=new s(null);return this.copy(e),e},s.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var l=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],h=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],s=0|t.words[0],o=i*s,a=67108863&o,c=o/67108864|0;r.words[0]=a;for(var u=1;u<n;u++){for(var l=c>>>26,d=67108863&c,h=Math.min(u,t.length-1),f=Math.max(0,u-e.length+1);f<=h;f++){var p=u-f|0;l+=(o=(i=0|e.words[p])*(s=0|t.words[f])+d)/67108864|0,d=67108863&o}r.words[u]=0|d,c=0|l}return 0!==c?r.words[u]=0|c:r.length--,r.strip()}s.prototype.toString=function(e,t){var r;if(t=0|t||1,16===(e=e||10)||"hex"===e){r="";for(var i=0,s=0,o=0;o<this.length;o++){var a=this.words[o],c=(16777215&(a<<i|s)).toString(16);s=a>>>24-i&16777215,(i+=2)>=26&&(i-=26,o--),r=0!==s||o!==this.length-1?l[6-c.length]+c+r:c+r}for(0!==s&&(r=s.toString(16)+r);r.length%t!==0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(e===(0|e)&&e>=2&&e<=36){var u=d[e],f=h[e];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var g=p.modn(f).toString(e);r=(p=p.idivn(f)).isZero()?g+r:l[u-g.length]+g+r}for(this.isZero()&&(r="0"+r);r.length%t!==0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}n(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(e,t){return n(void 0!==o),this.toArrayLike(o,e,t)},s.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},s.prototype.toArrayLike=function(e,t,r){var i=this.byteLength(),s=r||Math.max(1,i);n(i<=s,"byte array longer than desired length"),n(s>0,"Requested array length <= 0"),this.strip();var o,a,c="le"===t,u=new e(s),l=this.clone();if(c){for(a=0;!l.isZero();a++)o=l.andln(255),l.iushrn(8),u[a]=o;for(;a<s;a++)u[a]=0}else{for(a=0;a<s-i;a++)u[a]=0;for(a=0;!l.isZero();a++)o=l.andln(255),l.iushrn(8),u[s-a-1]=o}return u},Math.clz32?s.prototype._countBits=function(e){return 32-Math.clz32(e)}:s.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},s.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 8191&t||(r+=13,t>>>=13),127&t||(r+=7,t>>>=7),15&t||(r+=4,t>>>=4),3&t||(r+=2,t>>>=2),1&t||r++,r},s.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},s.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},s.prototype.ior=function(e){return n(0===(this.negative|e.negative)),this.iuor(e)},s.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},s.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},s.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},s.prototype.iand=function(e){return n(0===(this.negative|e.negative)),this.iuand(e)},s.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},s.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},s.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},s.prototype.ixor=function(e){return n(0===(this.negative|e.negative)),this.iuxor(e)},s.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},s.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},s.prototype.inotn=function(e){n("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),r=e%26;this._expand(t),r>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return r>0&&(this.words[i]=~this.words[i]&67108863>>26-r),this.strip()},s.prototype.notn=function(e){return this.clone().inotn(e)},s.prototype.setn=function(e,t){n("number"==typeof e&&e>=0);var r=e/26|0,i=e%26;return this._expand(r+1),this.words[r]=t?this.words[r]|1<<i:this.words[r]&~(1<<i),this.strip()},s.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,s=0;s<n.length;s++)t=(0|r.words[s])+(0|n.words[s])+i,this.words[s]=67108863&t,i=t>>>26;for(;0!==i&&s<r.length;s++)t=(0|r.words[s])+i,this.words[s]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},s.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var s=0,o=0;o<n.length;o++)s=(t=(0|r.words[o])-(0|n.words[o])+s)>>26,this.words[o]=67108863&t;for(;0!==s&&o<r.length;o++)s=(t=(0|r.words[o])+s)>>26,this.words[o]=67108863&t;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var n,i,s,o=e.words,a=t.words,c=r.words,u=0,l=0|o[0],d=8191&l,h=l>>>13,f=0|o[1],p=8191&f,g=f>>>13,m=0|o[2],y=8191&m,b=m>>>13,w=0|o[3],v=8191&w,E=w>>>13,A=0|o[4],S=8191&A,k=A>>>13,R=0|o[5],P=8191&R,I=R>>>13,C=0|o[6],_=8191&C,T=C>>>13,N=0|o[7],x=8191&N,O=N>>>13,D=0|o[8],M=8191&D,B=D>>>13,L=0|o[9],F=8191&L,U=L>>>13,j=0|a[0],z=8191&j,q=j>>>13,K=0|a[1],G=8191&K,$=K>>>13,V=0|a[2],H=8191&V,W=V>>>13,J=0|a[3],Z=8191&J,Q=J>>>13,Y=0|a[4],X=8191&Y,ee=Y>>>13,te=0|a[5],re=8191&te,ne=te>>>13,ie=0|a[6],se=8191&ie,oe=ie>>>13,ae=0|a[7],ce=8191&ae,ue=ae>>>13,le=0|a[8],de=8191&le,he=le>>>13,fe=0|a[9],pe=8191&fe,ge=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var me=(u+(n=Math.imul(d,z))|0)+((8191&(i=(i=Math.imul(d,q))+Math.imul(h,z)|0))<<13)|0;u=((s=Math.imul(h,q))+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(p,z),i=(i=Math.imul(p,q))+Math.imul(g,z)|0,s=Math.imul(g,q);var ye=(u+(n=n+Math.imul(d,G)|0)|0)+((8191&(i=(i=i+Math.imul(d,$)|0)+Math.imul(h,G)|0))<<13)|0;u=((s=s+Math.imul(h,$)|0)+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(y,z),i=(i=Math.imul(y,q))+Math.imul(b,z)|0,s=Math.imul(b,q),n=n+Math.imul(p,G)|0,i=(i=i+Math.imul(p,$)|0)+Math.imul(g,G)|0,s=s+Math.imul(g,$)|0;var be=(u+(n=n+Math.imul(d,H)|0)|0)+((8191&(i=(i=i+Math.imul(d,W)|0)+Math.imul(h,H)|0))<<13)|0;u=((s=s+Math.imul(h,W)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(v,z),i=(i=Math.imul(v,q))+Math.imul(E,z)|0,s=Math.imul(E,q),n=n+Math.imul(y,G)|0,i=(i=i+Math.imul(y,$)|0)+Math.imul(b,G)|0,s=s+Math.imul(b,$)|0,n=n+Math.imul(p,H)|0,i=(i=i+Math.imul(p,W)|0)+Math.imul(g,H)|0,s=s+Math.imul(g,W)|0;var we=(u+(n=n+Math.imul(d,Z)|0)|0)+((8191&(i=(i=i+Math.imul(d,Q)|0)+Math.imul(h,Z)|0))<<13)|0;u=((s=s+Math.imul(h,Q)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(S,z),i=(i=Math.imul(S,q))+Math.imul(k,z)|0,s=Math.imul(k,q),n=n+Math.imul(v,G)|0,i=(i=i+Math.imul(v,$)|0)+Math.imul(E,G)|0,s=s+Math.imul(E,$)|0,n=n+Math.imul(y,H)|0,i=(i=i+Math.imul(y,W)|0)+Math.imul(b,H)|0,s=s+Math.imul(b,W)|0,n=n+Math.imul(p,Z)|0,i=(i=i+Math.imul(p,Q)|0)+Math.imul(g,Z)|0,s=s+Math.imul(g,Q)|0;var ve=(u+(n=n+Math.imul(d,X)|0)|0)+((8191&(i=(i=i+Math.imul(d,ee)|0)+Math.imul(h,X)|0))<<13)|0;u=((s=s+Math.imul(h,ee)|0)+(i>>>13)|0)+(ve>>>26)|0,ve&=67108863,n=Math.imul(P,z),i=(i=Math.imul(P,q))+Math.imul(I,z)|0,s=Math.imul(I,q),n=n+Math.imul(S,G)|0,i=(i=i+Math.imul(S,$)|0)+Math.imul(k,G)|0,s=s+Math.imul(k,$)|0,n=n+Math.imul(v,H)|0,i=(i=i+Math.imul(v,W)|0)+Math.imul(E,H)|0,s=s+Math.imul(E,W)|0,n=n+Math.imul(y,Z)|0,i=(i=i+Math.imul(y,Q)|0)+Math.imul(b,Z)|0,s=s+Math.imul(b,Q)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(g,X)|0,s=s+Math.imul(g,ee)|0;var Ee=(u+(n=n+Math.imul(d,re)|0)|0)+((8191&(i=(i=i+Math.imul(d,ne)|0)+Math.imul(h,re)|0))<<13)|0;u=((s=s+Math.imul(h,ne)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(_,z),i=(i=Math.imul(_,q))+Math.imul(T,z)|0,s=Math.imul(T,q),n=n+Math.imul(P,G)|0,i=(i=i+Math.imul(P,$)|0)+Math.imul(I,G)|0,s=s+Math.imul(I,$)|0,n=n+Math.imul(S,H)|0,i=(i=i+Math.imul(S,W)|0)+Math.imul(k,H)|0,s=s+Math.imul(k,W)|0,n=n+Math.imul(v,Z)|0,i=(i=i+Math.imul(v,Q)|0)+Math.imul(E,Z)|0,s=s+Math.imul(E,Q)|0,n=n+Math.imul(y,X)|0,i=(i=i+Math.imul(y,ee)|0)+Math.imul(b,X)|0,s=s+Math.imul(b,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(g,re)|0,s=s+Math.imul(g,ne)|0;var Ae=(u+(n=n+Math.imul(d,se)|0)|0)+((8191&(i=(i=i+Math.imul(d,oe)|0)+Math.imul(h,se)|0))<<13)|0;u=((s=s+Math.imul(h,oe)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(x,z),i=(i=Math.imul(x,q))+Math.imul(O,z)|0,s=Math.imul(O,q),n=n+Math.imul(_,G)|0,i=(i=i+Math.imul(_,$)|0)+Math.imul(T,G)|0,s=s+Math.imul(T,$)|0,n=n+Math.imul(P,H)|0,i=(i=i+Math.imul(P,W)|0)+Math.imul(I,H)|0,s=s+Math.imul(I,W)|0,n=n+Math.imul(S,Z)|0,i=(i=i+Math.imul(S,Q)|0)+Math.imul(k,Z)|0,s=s+Math.imul(k,Q)|0,n=n+Math.imul(v,X)|0,i=(i=i+Math.imul(v,ee)|0)+Math.imul(E,X)|0,s=s+Math.imul(E,ee)|0,n=n+Math.imul(y,re)|0,i=(i=i+Math.imul(y,ne)|0)+Math.imul(b,re)|0,s=s+Math.imul(b,ne)|0,n=n+Math.imul(p,se)|0,i=(i=i+Math.imul(p,oe)|0)+Math.imul(g,se)|0,s=s+Math.imul(g,oe)|0;var Se=(u+(n=n+Math.imul(d,ce)|0)|0)+((8191&(i=(i=i+Math.imul(d,ue)|0)+Math.imul(h,ce)|0))<<13)|0;u=((s=s+Math.imul(h,ue)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(M,z),i=(i=Math.imul(M,q))+Math.imul(B,z)|0,s=Math.imul(B,q),n=n+Math.imul(x,G)|0,i=(i=i+Math.imul(x,$)|0)+Math.imul(O,G)|0,s=s+Math.imul(O,$)|0,n=n+Math.imul(_,H)|0,i=(i=i+Math.imul(_,W)|0)+Math.imul(T,H)|0,s=s+Math.imul(T,W)|0,n=n+Math.imul(P,Z)|0,i=(i=i+Math.imul(P,Q)|0)+Math.imul(I,Z)|0,s=s+Math.imul(I,Q)|0,n=n+Math.imul(S,X)|0,i=(i=i+Math.imul(S,ee)|0)+Math.imul(k,X)|0,s=s+Math.imul(k,ee)|0,n=n+Math.imul(v,re)|0,i=(i=i+Math.imul(v,ne)|0)+Math.imul(E,re)|0,s=s+Math.imul(E,ne)|0,n=n+Math.imul(y,se)|0,i=(i=i+Math.imul(y,oe)|0)+Math.imul(b,se)|0,s=s+Math.imul(b,oe)|0,n=n+Math.imul(p,ce)|0,i=(i=i+Math.imul(p,ue)|0)+Math.imul(g,ce)|0,s=s+Math.imul(g,ue)|0;var ke=(u+(n=n+Math.imul(d,de)|0)|0)+((8191&(i=(i=i+Math.imul(d,he)|0)+Math.imul(h,de)|0))<<13)|0;u=((s=s+Math.imul(h,he)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(F,z),i=(i=Math.imul(F,q))+Math.imul(U,z)|0,s=Math.imul(U,q),n=n+Math.imul(M,G)|0,i=(i=i+Math.imul(M,$)|0)+Math.imul(B,G)|0,s=s+Math.imul(B,$)|0,n=n+Math.imul(x,H)|0,i=(i=i+Math.imul(x,W)|0)+Math.imul(O,H)|0,s=s+Math.imul(O,W)|0,n=n+Math.imul(_,Z)|0,i=(i=i+Math.imul(_,Q)|0)+Math.imul(T,Z)|0,s=s+Math.imul(T,Q)|0,n=n+Math.imul(P,X)|0,i=(i=i+Math.imul(P,ee)|0)+Math.imul(I,X)|0,s=s+Math.imul(I,ee)|0,n=n+Math.imul(S,re)|0,i=(i=i+Math.imul(S,ne)|0)+Math.imul(k,re)|0,s=s+Math.imul(k,ne)|0,n=n+Math.imul(v,se)|0,i=(i=i+Math.imul(v,oe)|0)+Math.imul(E,se)|0,s=s+Math.imul(E,oe)|0,n=n+Math.imul(y,ce)|0,i=(i=i+Math.imul(y,ue)|0)+Math.imul(b,ce)|0,s=s+Math.imul(b,ue)|0,n=n+Math.imul(p,de)|0,i=(i=i+Math.imul(p,he)|0)+Math.imul(g,de)|0,s=s+Math.imul(g,he)|0;var Re=(u+(n=n+Math.imul(d,pe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ge)|0)+Math.imul(h,pe)|0))<<13)|0;u=((s=s+Math.imul(h,ge)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(F,G),i=(i=Math.imul(F,$))+Math.imul(U,G)|0,s=Math.imul(U,$),n=n+Math.imul(M,H)|0,i=(i=i+Math.imul(M,W)|0)+Math.imul(B,H)|0,s=s+Math.imul(B,W)|0,n=n+Math.imul(x,Z)|0,i=(i=i+Math.imul(x,Q)|0)+Math.imul(O,Z)|0,s=s+Math.imul(O,Q)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,ee)|0)+Math.imul(T,X)|0,s=s+Math.imul(T,ee)|0,n=n+Math.imul(P,re)|0,i=(i=i+Math.imul(P,ne)|0)+Math.imul(I,re)|0,s=s+Math.imul(I,ne)|0,n=n+Math.imul(S,se)|0,i=(i=i+Math.imul(S,oe)|0)+Math.imul(k,se)|0,s=s+Math.imul(k,oe)|0,n=n+Math.imul(v,ce)|0,i=(i=i+Math.imul(v,ue)|0)+Math.imul(E,ce)|0,s=s+Math.imul(E,ue)|0,n=n+Math.imul(y,de)|0,i=(i=i+Math.imul(y,he)|0)+Math.imul(b,de)|0,s=s+Math.imul(b,he)|0;var Pe=(u+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ge)|0)+Math.imul(g,pe)|0))<<13)|0;u=((s=s+Math.imul(g,ge)|0)+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,n=Math.imul(F,H),i=(i=Math.imul(F,W))+Math.imul(U,H)|0,s=Math.imul(U,W),n=n+Math.imul(M,Z)|0,i=(i=i+Math.imul(M,Q)|0)+Math.imul(B,Z)|0,s=s+Math.imul(B,Q)|0,n=n+Math.imul(x,X)|0,i=(i=i+Math.imul(x,ee)|0)+Math.imul(O,X)|0,s=s+Math.imul(O,ee)|0,n=n+Math.imul(_,re)|0,i=(i=i+Math.imul(_,ne)|0)+Math.imul(T,re)|0,s=s+Math.imul(T,ne)|0,n=n+Math.imul(P,se)|0,i=(i=i+Math.imul(P,oe)|0)+Math.imul(I,se)|0,s=s+Math.imul(I,oe)|0,n=n+Math.imul(S,ce)|0,i=(i=i+Math.imul(S,ue)|0)+Math.imul(k,ce)|0,s=s+Math.imul(k,ue)|0,n=n+Math.imul(v,de)|0,i=(i=i+Math.imul(v,he)|0)+Math.imul(E,de)|0,s=s+Math.imul(E,he)|0;var Ie=(u+(n=n+Math.imul(y,pe)|0)|0)+((8191&(i=(i=i+Math.imul(y,ge)|0)+Math.imul(b,pe)|0))<<13)|0;u=((s=s+Math.imul(b,ge)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(F,Z),i=(i=Math.imul(F,Q))+Math.imul(U,Z)|0,s=Math.imul(U,Q),n=n+Math.imul(M,X)|0,i=(i=i+Math.imul(M,ee)|0)+Math.imul(B,X)|0,s=s+Math.imul(B,ee)|0,n=n+Math.imul(x,re)|0,i=(i=i+Math.imul(x,ne)|0)+Math.imul(O,re)|0,s=s+Math.imul(O,ne)|0,n=n+Math.imul(_,se)|0,i=(i=i+Math.imul(_,oe)|0)+Math.imul(T,se)|0,s=s+Math.imul(T,oe)|0,n=n+Math.imul(P,ce)|0,i=(i=i+Math.imul(P,ue)|0)+Math.imul(I,ce)|0,s=s+Math.imul(I,ue)|0,n=n+Math.imul(S,de)|0,i=(i=i+Math.imul(S,he)|0)+Math.imul(k,de)|0,s=s+Math.imul(k,he)|0;var Ce=(u+(n=n+Math.imul(v,pe)|0)|0)+((8191&(i=(i=i+Math.imul(v,ge)|0)+Math.imul(E,pe)|0))<<13)|0;u=((s=s+Math.imul(E,ge)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(F,X),i=(i=Math.imul(F,ee))+Math.imul(U,X)|0,s=Math.imul(U,ee),n=n+Math.imul(M,re)|0,i=(i=i+Math.imul(M,ne)|0)+Math.imul(B,re)|0,s=s+Math.imul(B,ne)|0,n=n+Math.imul(x,se)|0,i=(i=i+Math.imul(x,oe)|0)+Math.imul(O,se)|0,s=s+Math.imul(O,oe)|0,n=n+Math.imul(_,ce)|0,i=(i=i+Math.imul(_,ue)|0)+Math.imul(T,ce)|0,s=s+Math.imul(T,ue)|0,n=n+Math.imul(P,de)|0,i=(i=i+Math.imul(P,he)|0)+Math.imul(I,de)|0,s=s+Math.imul(I,he)|0;var _e=(u+(n=n+Math.imul(S,pe)|0)|0)+((8191&(i=(i=i+Math.imul(S,ge)|0)+Math.imul(k,pe)|0))<<13)|0;u=((s=s+Math.imul(k,ge)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(F,re),i=(i=Math.imul(F,ne))+Math.imul(U,re)|0,s=Math.imul(U,ne),n=n+Math.imul(M,se)|0,i=(i=i+Math.imul(M,oe)|0)+Math.imul(B,se)|0,s=s+Math.imul(B,oe)|0,n=n+Math.imul(x,ce)|0,i=(i=i+Math.imul(x,ue)|0)+Math.imul(O,ce)|0,s=s+Math.imul(O,ue)|0,n=n+Math.imul(_,de)|0,i=(i=i+Math.imul(_,he)|0)+Math.imul(T,de)|0,s=s+Math.imul(T,he)|0;var Te=(u+(n=n+Math.imul(P,pe)|0)|0)+((8191&(i=(i=i+Math.imul(P,ge)|0)+Math.imul(I,pe)|0))<<13)|0;u=((s=s+Math.imul(I,ge)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(F,se),i=(i=Math.imul(F,oe))+Math.imul(U,se)|0,s=Math.imul(U,oe),n=n+Math.imul(M,ce)|0,i=(i=i+Math.imul(M,ue)|0)+Math.imul(B,ce)|0,s=s+Math.imul(B,ue)|0,n=n+Math.imul(x,de)|0,i=(i=i+Math.imul(x,he)|0)+Math.imul(O,de)|0,s=s+Math.imul(O,he)|0;var Ne=(u+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,ge)|0)+Math.imul(T,pe)|0))<<13)|0;u=((s=s+Math.imul(T,ge)|0)+(i>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,n=Math.imul(F,ce),i=(i=Math.imul(F,ue))+Math.imul(U,ce)|0,s=Math.imul(U,ue),n=n+Math.imul(M,de)|0,i=(i=i+Math.imul(M,he)|0)+Math.imul(B,de)|0,s=s+Math.imul(B,he)|0;var xe=(u+(n=n+Math.imul(x,pe)|0)|0)+((8191&(i=(i=i+Math.imul(x,ge)|0)+Math.imul(O,pe)|0))<<13)|0;u=((s=s+Math.imul(O,ge)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(F,de),i=(i=Math.imul(F,he))+Math.imul(U,de)|0,s=Math.imul(U,he);var Oe=(u+(n=n+Math.imul(M,pe)|0)|0)+((8191&(i=(i=i+Math.imul(M,ge)|0)+Math.imul(B,pe)|0))<<13)|0;u=((s=s+Math.imul(B,ge)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863;var De=(u+(n=Math.imul(F,pe))|0)+((8191&(i=(i=Math.imul(F,ge))+Math.imul(U,pe)|0))<<13)|0;return u=((s=Math.imul(U,ge))+(i>>>13)|0)+(De>>>26)|0,De&=67108863,c[0]=me,c[1]=ye,c[2]=be,c[3]=we,c[4]=ve,c[5]=Ee,c[6]=Ae,c[7]=Se,c[8]=ke,c[9]=Re,c[10]=Pe,c[11]=Ie,c[12]=Ce,c[13]=_e,c[14]=Te,c[15]=Ne,c[16]=xe,c[17]=Oe,c[18]=De,0!==u&&(c[19]=u,r.length++),r};function g(e,t,r){return(new m).mulp(e,t,r)}function m(e,t){this.x=e,this.y=t}Math.imul||(p=f),s.prototype.mulTo=function(e,t){var r,n=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):n<63?f(this,e,t):n<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,s=0;s<r.length-1;s++){var o=i;i=0;for(var a=67108863&n,c=Math.min(s,t.length-1),u=Math.max(0,s-e.length+1);u<=c;u++){var l=s-u,d=(0|e.words[l])*(0|t.words[u]),h=67108863&d;a=67108863&(h=h+a|0),i+=(o=(o=o+(d/67108864|0)|0)+(h>>>26)|0)>>>26,o&=67108863}r.words[s]=a,n=o,o=i}return 0!==n?r.words[s]=n:r.length--,r.strip()}(this,e,t):g(this,e,t),r},m.prototype.makeRBT=function(e){for(var t=new Array(e),r=s.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},m.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},m.prototype.permute=function(e,t,r,n,i,s){for(var o=0;o<s;o++)n[o]=t[e[o]],i[o]=r[e[o]]},m.prototype.transform=function(e,t,r,n,i,s){this.permute(s,e,t,r,n,i);for(var o=1;o<i;o<<=1)for(var a=o<<1,c=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),l=0;l<i;l+=a)for(var d=c,h=u,f=0;f<o;f++){var p=r[l+f],g=n[l+f],m=r[l+f+o],y=n[l+f+o],b=d*m-h*y;y=d*y+h*m,m=b,r[l+f]=p+m,n[l+f]=g+y,r[l+f+o]=p-m,n[l+f+o]=g-y,f!==a&&(b=c*d-u*h,h=c*h+u*d,d=b)}},m.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},m.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},m.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},m.prototype.convert13b=function(e,t,r,i){for(var s=0,o=0;o<t;o++)s+=0|e[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*t;o<i;++o)r[o]=0;n(0===s),n(!(-8192&s))},m.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},m.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),s=this.stub(n),o=new Array(n),a=new Array(n),c=new Array(n),u=new Array(n),l=new Array(n),d=new Array(n),h=r.words;h.length=n,this.convert13b(e.words,e.length,o,n),this.convert13b(t.words,t.length,u,n),this.transform(o,s,a,c,n,i),this.transform(u,s,l,d,n,i);for(var f=0;f<n;f++){var p=a[f]*l[f]-c[f]*d[f];c[f]=a[f]*d[f]+c[f]*l[f],a[f]=p}return this.conjugate(a,c,n),this.transform(a,c,h,s,n,i),this.conjugate(h,s,n),this.normalize13b(h,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},s.prototype.mul=function(e){var t=new s(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},s.prototype.mulf=function(e){var t=new s(null);return t.words=new Array(this.length+e.length),g(this,e,t)},s.prototype.imul=function(e){return this.clone().mulTo(e,this)},s.prototype.imuln=function(e){n("number"==typeof e),n(e<67108864);for(var t=0,r=0;r<this.length;r++){var i=(0|this.words[r])*e,s=(67108863&i)+(67108863&t);t>>=26,t+=i/67108864|0,t+=s>>>26,this.words[r]=67108863&s}return 0!==t&&(this.words[r]=t,this.length++),this.length=0===e?1:this.length,this},s.prototype.muln=function(e){return this.clone().imuln(e)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}(e);if(0===t.length)return new s(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},s.prototype.iushln=function(e){n("number"==typeof e&&e>=0);var t,r=e%26,i=(e-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(t=0;t<this.length;t++){var a=this.words[t]&s,c=(0|this.words[t])-a<<r;this.words[t]=c|o,o=a>>>26-r}o&&(this.words[t]=o,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},s.prototype.ishln=function(e){return n(0===this.negative),this.iushln(e)},s.prototype.iushrn=function(e,t,r){var i;n("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var s=e%26,o=Math.min((e-s)/26,this.length),a=67108863^67108863>>>s<<s,c=r;if(i-=o,i=Math.max(0,i),c){for(var u=0;u<o;u++)c.words[u]=this.words[u];c.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var l=0;for(u=this.length-1;u>=0&&(0!==l||u>=i);u--){var d=0|this.words[u];this.words[u]=l<<26-s|d>>>s,l=d&a}return c&&0!==l&&(c.words[c.length++]=l),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(e,t,r){return n(0===this.negative),this.iushrn(e,t,r)},s.prototype.shln=function(e){return this.clone().ishln(e)},s.prototype.ushln=function(e){return this.clone().iushln(e)},s.prototype.shrn=function(e){return this.clone().ishrn(e)},s.prototype.ushrn=function(e){return this.clone().iushrn(e)},s.prototype.testn=function(e){n("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26,i=1<<t;return!(this.length<=r||!(this.words[r]&i))},s.prototype.imaskn=function(e){n("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==t&&r++,this.length=Math.min(r,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this.strip()},s.prototype.maskn=function(e){return this.clone().imaskn(e)},s.prototype.iaddn=function(e){return n("number"==typeof e),n(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},s.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},s.prototype.isubn=function(e){if(n("number"==typeof e),n(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},s.prototype.addn=function(e){return this.clone().iaddn(e)},s.prototype.subn=function(e){return this.clone().isubn(e)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(e,t,r){var i,s,o=e.length+r;this._expand(o);var a=0;for(i=0;i<e.length;i++){s=(0|this.words[i+r])+a;var c=(0|e.words[i])*t;a=((s-=67108863&c)>>26)-(c/67108864|0),this.words[i+r]=67108863&s}for(;i<this.length-r;i++)a=(s=(0|this.words[i+r])+a)>>26,this.words[i+r]=67108863&s;if(0===a)return this.strip();for(n(-1===a),a=0,i=0;i<this.length;i++)a=(s=-(0|this.words[i])+a)>>26,this.words[i]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),i=e,o=0|i.words[i.length-1];0!=(r=26-this._countBits(o))&&(i=i.ushln(r),n.iushln(r),o=0|i.words[i.length-1]);var a,c=n.length-i.length;if("mod"!==t){(a=new s(null)).length=c+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var l=n.clone()._ishlnsubmul(i,1,c);0===l.negative&&(n=l,a&&(a.words[c]=1));for(var d=c-1;d>=0;d--){var h=67108864*(0|n.words[i.length+d])+(0|n.words[i.length+d-1]);for(h=Math.min(h/o|0,67108863),n._ishlnsubmul(i,h,d);0!==n.negative;)h--,n.negative=0,n._ishlnsubmul(i,1,d),n.isZero()||(n.negative^=1);a&&(a.words[d]=h)}return a&&a.strip(),n.strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:a||null,mod:n}},s.prototype.divmod=function(e,t,r){return n(!e.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(i=a.div.neg()),"div"!==t&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(e)),{div:i,mod:o}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(i=a.div.neg()),{div:i,mod:a.mod}):0!==(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(e)),{div:a.div,mod:o}):e.length>this.length||this.cmp(e)<0?{div:new s(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new s(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new s(this.modn(e.words[0]))}:this._wordDiv(e,t);var i,o,a},s.prototype.div=function(e){return this.divmod(e,"div",!1).div},s.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},s.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},s.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),s=r.cmp(n);return s<0||1===i&&0===s?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},s.prototype.modn=function(e){n(e<=67108863);for(var t=(1<<26)%e,r=0,i=this.length-1;i>=0;i--)r=(t*r+(0|this.words[i]))%e;return r},s.prototype.idivn=function(e){n(e<=67108863);for(var t=0,r=this.length-1;r>=0;r--){var i=(0|this.words[r])+67108864*t;this.words[r]=i/e|0,t=i%e}return this.strip()},s.prototype.divn=function(e){return this.clone().idivn(e)},s.prototype.egcd=function(e){n(0===e.negative),n(!e.isZero());var t=this,r=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new s(1),o=new s(0),a=new s(0),c=new s(1),u=0;t.isEven()&&r.isEven();)t.iushrn(1),r.iushrn(1),++u;for(var l=r.clone(),d=t.clone();!t.isZero();){for(var h=0,f=1;0===(t.words[0]&f)&&h<26;++h,f<<=1);if(h>0)for(t.iushrn(h);h-- >0;)(i.isOdd()||o.isOdd())&&(i.iadd(l),o.isub(d)),i.iushrn(1),o.iushrn(1);for(var p=0,g=1;0===(r.words[0]&g)&&p<26;++p,g<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(l),c.isub(d)),a.iushrn(1),c.iushrn(1);t.cmp(r)>=0?(t.isub(r),i.isub(a),o.isub(c)):(r.isub(t),a.isub(i),c.isub(o))}return{a,b:c,gcd:r.iushln(u)}},s.prototype._invmp=function(e){n(0===e.negative),n(!e.isZero());var t=this,r=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i,o=new s(1),a=new s(0),c=r.clone();t.cmpn(1)>0&&r.cmpn(1)>0;){for(var u=0,l=1;0===(t.words[0]&l)&&u<26;++u,l<<=1);if(u>0)for(t.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);for(var d=0,h=1;0===(r.words[0]&h)&&d<26;++d,h<<=1);if(d>0)for(r.iushrn(d);d-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(r)>=0?(t.isub(r),o.isub(a)):(r.isub(t),a.isub(o))}return(i=0===t.cmpn(1)?o:a).cmpn(0)<0&&i.iadd(e),i},s.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var s=t;t=r,r=s}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},s.prototype.invm=function(e){return this.egcd(e).a.umod(e)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(e){return this.words[0]&e},s.prototype.bincn=function(e){n("number"==typeof e);var t=e%26,r=(e-t)/26,i=1<<t;if(this.length<=r)return this._expand(r+1),this.words[r]|=i,this;for(var s=i,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(e){var t,r=e<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)t=1;else{r&&(e=-e),n(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},s.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},s.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},s.prototype.gtn=function(e){return 1===this.cmpn(e)},s.prototype.gt=function(e){return 1===this.cmp(e)},s.prototype.gten=function(e){return this.cmpn(e)>=0},s.prototype.gte=function(e){return this.cmp(e)>=0},s.prototype.ltn=function(e){return-1===this.cmpn(e)},s.prototype.lt=function(e){return-1===this.cmp(e)},s.prototype.lten=function(e){return this.cmpn(e)<=0},s.prototype.lte=function(e){return this.cmp(e)<=0},s.prototype.eqn=function(e){return 0===this.cmpn(e)},s.prototype.eq=function(e){return 0===this.cmp(e)},s.red=function(e){return new S(e)},s.prototype.toRed=function(e){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},s.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(e){return this.red=e,this},s.prototype.forceRed=function(e){return n(!this.red,"Already a number in reduction context"),this._forceRed(e)},s.prototype.redAdd=function(e){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},s.prototype.redIAdd=function(e){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},s.prototype.redSub=function(e){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},s.prototype.redISub=function(e){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},s.prototype.redShl=function(e){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},s.prototype.redMul=function(e){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},s.prototype.redIMul=function(e){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},s.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(e){return n(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var y={k256:null,p224:null,p192:null,p25519:null};function b(e,t){this.name=e,this.p=new s(t,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function w(){b.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function v(){b.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function E(){b.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function A(){b.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(e){if("string"==typeof e){var t=s._prime(e);this.m=t.p,this.prime=t}else n(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function k(e){S.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b.prototype._tmp=function(){var e=new s(null);return e.words=new Array(Math.ceil(this.n/13)),e},b.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},b.prototype.split=function(e,t){e.iushrn(this.n,0,t)},b.prototype.imulK=function(e){return e.imul(this.k)},i(w,b),w.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var s=e.words[9];for(t.words[t.length++]=s&r,i=10;i<e.length;i++){var o=0|e.words[i];e.words[i-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,e.words[i-10]=s,0===s&&e.length>10?e.length-=10:e.length-=9},w.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(v,b),i(E,b),i(A,b),A.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},s._prime=function(e){if(y[e])return y[e];var t;if("k256"===e)t=new w;else if("p224"===e)t=new v;else if("p192"===e)t=new E;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new A}return y[e]=t,t},S.prototype._verify1=function(e){n(0===e.negative,"red works only with positives"),n(e.red,"red works only with red numbers")},S.prototype._verify2=function(e,t){n(0===(e.negative|t.negative),"red works only with positives"),n(e.red&&e.red===t.red,"red works only with red numbers")},S.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},S.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},S.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},S.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},S.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},S.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},S.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},S.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},S.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},S.prototype.isqr=function(e){return this.imul(e,e.clone())},S.prototype.sqr=function(e){return this.mul(e,e)},S.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(n(t%2==1),3===t){var r=this.m.add(new s(1)).iushrn(2);return this.pow(e,r)}for(var i=this.m.subn(1),o=0;!i.isZero()&&0===i.andln(1);)o++,i.iushrn(1);n(!i.isZero());var a=new s(1).toRed(this),c=a.redNeg(),u=this.m.subn(1).iushrn(1),l=this.m.bitLength();for(l=new s(2*l*l).toRed(this);0!==this.pow(l,u).cmp(c);)l.redIAdd(c);for(var d=this.pow(l,i),h=this.pow(e,i.addn(1).iushrn(1)),f=this.pow(e,i),p=o;0!==f.cmp(a);){for(var g=f,m=0;0!==g.cmp(a);m++)g=g.redSqr();n(m<p);var y=this.pow(d,new s(1).iushln(p-m-1));h=h.redMul(y),d=y.redSqr(),f=f.redMul(d),p=m}return h},S.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},S.prototype.pow=function(e,t){if(t.isZero())return new s(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var i=r[0],o=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),n=t.length-1;n>=0;n--){for(var u=t.words[n],l=c-1;l>=0;l--){var d=u>>l&1;i!==r[0]&&(i=this.sqr(i)),0!==d||0!==o?(o<<=1,o|=d,(4===++a||0===n&&0===l)&&(i=this.mul(i,r[o]),a=0,o=0)):a=0}c=26}return i},S.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},S.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},s.mont=function(e){return new k(e)},i(k,S),k.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},k.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},k.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),s=i;return i.cmp(this.m)>=0?s=i.isub(this.m):i.cmpn(0)<0&&(s=i.iadd(this.m)),s._forceRed(this)},k.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new s(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},k.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=r.nmd(e),this)},5037(e,t,r){var n;function i(e){this.rand=e}if(e.exports=function(e){return n||(n=new i(null)),n.generate(e)},e.exports.Rand=i,i.prototype.generate=function(e){return this._rand(e)},i.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),r=0;r<t.length;r++)t[r]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?i.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?i.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(i.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var s=r(3776);if("function"!=typeof s.randomBytes)throw new Error("Not supported");i.prototype._rand=function(e){return s.randomBytes(e)}}catch(e){}},295(e){e.exports=function(e,t){for(var r=Math.min(e.length,t.length),n=new Buffer(r),i=0;i<r;++i)n[i]=e[i]^t[i];return n}},8287(e,t,r){"use strict";const n=r(7526),i=r(251),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50;const o=2147483647;function a(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return u(e,t,r)}function u(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|g(e,t);let n=a(r);const i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(J(e,Uint8Array)){const t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(J(e,ArrayBuffer)||e&&J(e.buffer,ArrayBuffer))return f(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(J(e,SharedArrayBuffer)||e&&J(e.buffer,SharedArrayBuffer)))return f(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return c.from(n,t,r);const i=function(e){if(c.isBuffer(e)){const t=0|p(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||Z(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return l(e),a(e<0?0:0|p(e))}function h(e){const t=e.length<0?0:0|p(e.length),r=a(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function f(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,c.prototype),n}function p(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function g(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||J(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return H(e).length;default:if(i)return n?-1:V(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,r);case"utf8":case"utf-8":return P(this,t,r);case"ascii":return C(this,t,r);case"latin1":case"binary":return _(this,t,r);case"base64":return R(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function y(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function b(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),Z(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:w(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):w(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function w(e,t,r,n,i){let s,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(s=r;s<a;s++)if(u(e,s)===u(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===c)return n*o}else-1!==n&&(s-=s-n),n=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){let r=!0;for(let n=0;n<c;n++)if(u(e,s+n)!==u(t,n)){r=!1;break}if(r)return s}return-1}function v(e,t,r,n){r=Number(r)||0;const i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;const s=t.length;let o;for(n>s/2&&(n=s/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(Z(n))return o;e[r+o]=n}return o}function E(e,t,r,n){return W(V(t,e.length-r),e,r,n)}function A(e,t,r,n){return W(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function S(e,t,r,n){return W(H(t),e,r,n)}function k(e,t,r,n){return W(function(e,t){let r,n,i;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function R(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function P(e,t,r){r=Math.min(e.length,r);const n=[];let i=t;for(;i<r;){const t=e[i];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,a,c;switch(o){case 1:t<128&&(s=t);break;case 2:r=e[i+1],128==(192&r)&&(c=(31&t)<<6|63&r,c>127&&(s=c));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(c=(15&t)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return function(e){const t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=I));return r}(n)}t.kMaxLength=o,c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)}(e,t,r)},c.allocUnsafe=function(e){return d(e)},c.allocUnsafeSlow=function(e){return d(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(J(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),J(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=c.allocUnsafe(t);let i=0;for(r=0;r<e.length;++r){let t=e[r];if(J(t,Uint8Array))i+t.length>n.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},c.byteLength=g,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)y(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?P(this,0,e):m.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(c.prototype[s]=c.prototype.inspect),c.prototype.compare=function(e,t,r,n,i){if(J(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0);const a=Math.min(s,o),u=this.slice(n,i),l=e.slice(t,r);for(let e=0;e<a;++e)if(u[e]!==l[e]){s=u[e],o=l[e];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return b(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return b(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return E(this,e,t,r);case"ascii":case"latin1":case"binary":return A(this,e,t,r);case"base64":return S(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const I=4096;function C(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function _(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function T(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=Q[e[n]];return i}function N(e,t,r){const n=e.slice(t,r);let i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function x(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,r,n,i,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function D(e,t,r,n,i){q(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function M(e,t,r,n,i){q(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function B(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function L(e,t,r,n,s){return t=+t,r>>>=0,s||B(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function F(e,t,r,n,s){return t=+t,r>>>=0,s||B(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,c.prototype),n},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||x(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=Y(function(e){K(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||G(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))}),c.prototype.readBigUInt64BE=Y(function(e){K(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||G(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return e>>>=0,t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||x(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){e>>>=0,t||x(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=Y(function(e){K(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||G(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),c.prototype.readBigInt64BE=Y(function(e){K(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||G(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)}),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||x(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||x(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||x(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||x(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||O(this,e,t,r,Math.pow(2,8*r)-1,0);let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||O(this,e,t,r,Math.pow(2,8*r)-1,0);let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=Y(function(e,t=0){return D(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=Y(function(e,t=0){return M(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);O(this,e,t,r,n-1,-n)}let i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s|0)-o&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);O(this,e,t,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s|0)-o&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=Y(function(e,t=0){return D(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=Y(function(e,t=0){return M(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeFloatLE=function(e,t,r){return L(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return L(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return F(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return F(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{const s=c.isBuffer(e)?e:c.from(e,n),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%o]}return this};const U={};function j(e,t,r){U[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function z(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function q(e,t,r,n,i,s){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let i;throw i=s>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new U.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,r){K(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||G(t,e.length-(r+1))}(n,i,s)}function K(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function G(e,t,r){if(Math.floor(e)!==e)throw K(e,r),new U.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}j("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),j("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),j("ERR_OUT_OF_RANGE",function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=z(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=z(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n},RangeError);const $=/[^+/0-9A-Za-z-_]/g;function V(e,t){let r;t=t||1/0;const n=e.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function H(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace($,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function J(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Z(e){return e!=e}const Q=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function Y(e){return"undefined"==typeof BigInt?X:e}function X(){throw new Error("BigInt not supported")}},3144(e,t,r){"use strict";var n=r(6743),i=r(1002),s=r(76),o=r(7119);e.exports=o||n.call(s,i)},2205(e,t,r){"use strict";var n=r(6743),i=r(1002),s=r(3144);e.exports=function(){return s(n,i,arguments)}},1002(e){"use strict";e.exports=Function.prototype.apply},76(e){"use strict";e.exports=Function.prototype.call},3126(e,t,r){"use strict";var n=r(6743),i=r(9675),s=r(76),o=r(3144);e.exports=function(e){if(e.length<1||"function"!=typeof e[0])throw new i("a function is required");return o(n,s,e)}},7119(e){"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},487(e,t,r){"use strict";var n=r(6897),i=r(655),s=r(3126),o=r(2205);e.exports=function(e){var t=s(arguments),r=e.length-(arguments.length-1);return n(t,1+(r>0?r:0),!0)},i?i(e.exports,"apply",{value:o}):e.exports.apply=o},6556(e,t,r){"use strict";var n=r(453),i=r(3126),s=i([n("%String.prototype.indexOf%")]);e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&s(e,".prototype.")>-1?i([r]):r}},41(e,t,r){"use strict";var n=r(655),i=r(8068),s=r(9675),o=r(5795);e.exports=function(e,t,r){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new s("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new s("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new s("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new s("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new s("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new s("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,c=arguments.length>4?arguments[4]:null,u=arguments.length>5?arguments[5]:null,l=arguments.length>6&&arguments[6],d=!!o&&o(e,t);if(n)n(e,t,{configurable:null===u&&d?d.configurable:!u,enumerable:null===a&&d?d.enumerable:!a,value:r,writable:null===c&&d?d.writable:!c});else{if(!l&&(a||c||u))throw new i("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=r}}},6320(e){"use strict";var t={single_source_shortest_paths:function(e,r,n){var i={},s={};s[r]=0;var o,a,c,u,l,d,h,f=t.PriorityQueue.make();for(f.push(r,0);!f.empty();)for(c in a=(o=f.pop()).value,u=o.cost,l=e[a]||{})l.hasOwnProperty(c)&&(d=u+l[c],h=s[c],(void 0===s[c]||h>d)&&(s[c]=d,f.push(c,d),i[c]=a));if(void 0!==n&&void 0===s[n]){var p=["Could not find a path from ",r," to ",n,"."].join("");throw new Error(p)}return i},extract_shortest_path_from_predecessor_list:function(e,t){for(var r=[],n=t;n;)r.push(n),e[n],n=e[n];return r.reverse(),r},find_path:function(e,r,n){var i=t.single_source_shortest_paths(e,r,n);return t.extract_shortest_path_from_predecessor_list(i,n)},PriorityQueue:{make:function(e){var r,n=t.PriorityQueue,i={};for(r in e=e||{},n)n.hasOwnProperty(r)&&(i[r]=n[r]);return i.queue=[],i.sorter=e.sorter||n.default_sorter,i},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var r={value:e,cost:t};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};e.exports=t},7176(e,t,r){"use strict";var n,i=r(3126),s=r(5795);try{n=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var o=!!n&&s&&s(Object.prototype,"__proto__"),a=Object,c=a.getPrototypeOf;e.exports=o&&"function"==typeof o.get?i([o.get]):"function"==typeof c&&function(e){return c(null==e?e:a(e))}},6729(e,t,r){"use strict";var n=t;n.version=r(1636).rE,n.utils=r(7011),n.rand=r(5037),n.curve=r(894),n.curves=r(480),n.ec=r(7447),n.eddsa=r(8650)},6677(e,t,r){"use strict";var n=r(9404),i=r(7011),s=i.getNAF,o=i.getJSF,a=i.assert;function c(e,t){this.type=e,this.p=new n(t.p,16),this.red=t.prime?n.red(t.prime):n.mont(this.p),this.zero=new n(0).toRed(this.red),this.one=new n(1).toRed(this.red),this.two=new n(2).toRed(this.red),this.n=t.n&&new n(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function u(e,t){this.curve=e,this.type=t,this.precomputed=null}e.exports=c,c.prototype.point=function(){throw new Error("Not implemented")},c.prototype.validate=function(){throw new Error("Not implemented")},c.prototype._fixedNafMul=function(e,t){a(e.precomputed);var r=e._getDoubles(),n=s(t,1,this._bitLength),i=(1<<r.step+1)-(r.step%2==0?2:1);i/=3;var o,c,u=[];for(o=0;o<n.length;o+=r.step){c=0;for(var l=o+r.step-1;l>=o;l--)c=(c<<1)+n[l];u.push(c)}for(var d=this.jpoint(null,null,null),h=this.jpoint(null,null,null),f=i;f>0;f--){for(o=0;o<u.length;o++)(c=u[o])===f?h=h.mixedAdd(r.points[o]):c===-f&&(h=h.mixedAdd(r.points[o].neg()));d=d.add(h)}return d.toP()},c.prototype._wnafMul=function(e,t){var r=4,n=e._getNAFPoints(r);r=n.wnd;for(var i=n.points,o=s(t,r,this._bitLength),c=this.jpoint(null,null,null),u=o.length-1;u>=0;u--){for(var l=0;u>=0&&0===o[u];u--)l++;if(u>=0&&l++,c=c.dblp(l),u<0)break;var d=o[u];a(0!==d),c="affine"===e.type?d>0?c.mixedAdd(i[d-1>>1]):c.mixedAdd(i[-d-1>>1].neg()):d>0?c.add(i[d-1>>1]):c.add(i[-d-1>>1].neg())}return"affine"===e.type?c.toP():c},c.prototype._wnafMulAdd=function(e,t,r,n,i){var a,c,u,l=this._wnafT1,d=this._wnafT2,h=this._wnafT3,f=0;for(a=0;a<n;a++){var p=(u=t[a])._getNAFPoints(e);l[a]=p.wnd,d[a]=p.points}for(a=n-1;a>=1;a-=2){var g=a-1,m=a;if(1===l[g]&&1===l[m]){var y=[t[g],null,null,t[m]];0===t[g].y.cmp(t[m].y)?(y[1]=t[g].add(t[m]),y[2]=t[g].toJ().mixedAdd(t[m].neg())):0===t[g].y.cmp(t[m].y.redNeg())?(y[1]=t[g].toJ().mixedAdd(t[m]),y[2]=t[g].add(t[m].neg())):(y[1]=t[g].toJ().mixedAdd(t[m]),y[2]=t[g].toJ().mixedAdd(t[m].neg()));var b=[-3,-1,-5,-7,0,7,5,1,3],w=o(r[g],r[m]);for(f=Math.max(w[0].length,f),h[g]=new Array(f),h[m]=new Array(f),c=0;c<f;c++){var v=0|w[0][c],E=0|w[1][c];h[g][c]=b[3*(v+1)+(E+1)],h[m][c]=0,d[g]=y}}else h[g]=s(r[g],l[g],this._bitLength),h[m]=s(r[m],l[m],this._bitLength),f=Math.max(h[g].length,f),f=Math.max(h[m].length,f)}var A=this.jpoint(null,null,null),S=this._wnafT4;for(a=f;a>=0;a--){for(var k=0;a>=0;){var R=!0;for(c=0;c<n;c++)S[c]=0|h[c][a],0!==S[c]&&(R=!1);if(!R)break;k++,a--}if(a>=0&&k++,A=A.dblp(k),a<0)break;for(c=0;c<n;c++){var P=S[c];0!==P&&(P>0?u=d[c][P-1>>1]:P<0&&(u=d[c][-P-1>>1].neg()),A="affine"===u.type?A.mixedAdd(u):A.add(u))}}for(a=0;a<n;a++)d[a]=null;return i?A:A.toP()},c.BasePoint=u,u.prototype.eq=function(){throw new Error("Not implemented")},u.prototype.validate=function(){return this.curve.validate(this)},c.prototype.decodePoint=function(e,t){e=i.toArray(e,t);var r=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*r)return 6===e[0]?a(e[e.length-1]%2==0):7===e[0]&&a(e[e.length-1]%2==1),this.point(e.slice(1,1+r),e.slice(1+r,1+2*r));if((2===e[0]||3===e[0])&&e.length-1===r)return this.pointFromX(e.slice(1,1+r),3===e[0]);throw new Error("Unknown point format")},u.prototype.encodeCompressed=function(e){return this.encode(e,!0)},u.prototype._encode=function(e){var t=this.curve.p.byteLength(),r=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",t))},u.prototype.encode=function(e,t){return i.encode(this._encode(t),e)},u.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},u.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},u.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],n=this,i=0;i<t;i+=e){for(var s=0;s<e;s++)n=n.dbl();r.push(n)}return{step:e,points:r}},u.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],r=(1<<e)-1,n=1===r?null:this.dbl(),i=1;i<r;i++)t[i]=t[i-1].add(n);return{wnd:e,points:t}},u.prototype._getBeta=function(){return null},u.prototype.dblp=function(e){for(var t=this,r=0;r<e;r++)t=t.dbl();return t}},1298(e,t,r){"use strict";var n=r(7011),i=r(9404),s=r(6698),o=r(6677),a=n.assert;function c(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,o.call(this,"edwards",e),this.a=new i(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new i(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new i(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),a(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function u(e,t,r,n,s){o.BasePoint.call(this,e,"projective"),null===t&&null===r&&null===n?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new i(t,16),this.y=new i(r,16),this.z=n?new i(n,16):this.curve.one,this.t=s&&new i(s,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}s(c,o),e.exports=c,c.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},c.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},c.prototype.jpoint=function(e,t,r,n){return this.point(e,t,r,n)},c.prototype.pointFromX=function(e,t){(e=new i(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),n=this.c2.redSub(this.a.redMul(r)),s=this.one.redSub(this.c2.redMul(this.d).redMul(r)),o=n.redMul(s.redInvm()),a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");var c=a.fromRed().isOdd();return(t&&!c||!t&&c)&&(a=a.redNeg()),this.point(e,a)},c.prototype.pointFromY=function(e,t){(e=new i(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),n=r.redSub(this.c2),s=r.redMul(this.d).redMul(this.c2).redSub(this.a),o=n.redMul(s.redInvm());if(0===o.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");return a.fromRed().isOdd()!==t&&(a=a.redNeg()),this.point(a,e)},c.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),r=e.y.redSqr(),n=t.redMul(this.a).redAdd(r),i=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(r)));return 0===n.cmp(i)},s(u,o.BasePoint),c.prototype.pointFromJSON=function(e){return u.fromJSON(this,e)},c.prototype.point=function(e,t,r,n){return new u(this,e,t,r,n)},u.fromJSON=function(e,t){return new u(e,t[0],t[1],t[2])},u.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},u.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},u.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr();r=r.redIAdd(r);var n=this.curve._mulA(e),i=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),s=n.redAdd(t),o=s.redSub(r),a=n.redSub(t),c=i.redMul(o),u=s.redMul(a),l=i.redMul(a),d=o.redMul(s);return this.curve.point(c,u,d,l)},u.prototype._projDbl=function(){var e,t,r,n,i,s,o=this.x.redAdd(this.y).redSqr(),a=this.x.redSqr(),c=this.y.redSqr();if(this.curve.twisted){var u=(n=this.curve._mulA(a)).redAdd(c);this.zOne?(e=o.redSub(a).redSub(c).redMul(u.redSub(this.curve.two)),t=u.redMul(n.redSub(c)),r=u.redSqr().redSub(u).redSub(u)):(i=this.z.redSqr(),s=u.redSub(i).redISub(i),e=o.redSub(a).redISub(c).redMul(s),t=u.redMul(n.redSub(c)),r=u.redMul(s))}else n=a.redAdd(c),i=this.curve._mulC(this.z).redSqr(),s=n.redSub(i).redSub(i),e=this.curve._mulC(o.redISub(n)).redMul(s),t=this.curve._mulC(n).redMul(a.redISub(c)),r=n.redMul(s);return this.curve.point(e,t,r)},u.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},u.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),r=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),n=this.t.redMul(this.curve.dd).redMul(e.t),i=this.z.redMul(e.z.redAdd(e.z)),s=r.redSub(t),o=i.redSub(n),a=i.redAdd(n),c=r.redAdd(t),u=s.redMul(o),l=a.redMul(c),d=s.redMul(c),h=o.redMul(a);return this.curve.point(u,l,h,d)},u.prototype._projAdd=function(e){var t,r,n=this.z.redMul(e.z),i=n.redSqr(),s=this.x.redMul(e.x),o=this.y.redMul(e.y),a=this.curve.d.redMul(s).redMul(o),c=i.redSub(a),u=i.redAdd(a),l=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(s).redISub(o),d=n.redMul(c).redMul(l);return this.curve.twisted?(t=n.redMul(u).redMul(o.redSub(this.curve._mulA(s))),r=c.redMul(u)):(t=n.redMul(u).redMul(o.redSub(s)),r=this.curve._mulC(c).redMul(u)),this.curve.point(d,t,r)},u.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},u.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},u.prototype.mulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!1)},u.prototype.jmulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!0)},u.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},u.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},u.prototype.getX=function(){return this.normalize(),this.x.fromRed()},u.prototype.getY=function(){return this.normalize(),this.y.fromRed()},u.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},u.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var r=e.clone(),n=this.curve.redN.redMul(this.z);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(n),0===this.x.cmp(t))return!0}},u.prototype.toP=u.prototype.normalize,u.prototype.mixedAdd=u.prototype.add},894(e,t,r){"use strict";var n=t;n.base=r(6677),n.short=r(9188),n.mont=r(370),n.edwards=r(1298)},370(e,t,r){"use strict";var n=r(9404),i=r(6698),s=r(6677),o=r(7011);function a(e){s.call(this,"mont",e),this.a=new n(e.a,16).toRed(this.red),this.b=new n(e.b,16).toRed(this.red),this.i4=new n(4).toRed(this.red).redInvm(),this.two=new n(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function c(e,t,r){s.BasePoint.call(this,e,"projective"),null===t&&null===r?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new n(t,16),this.z=new n(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}i(a,s),e.exports=a,a.prototype.validate=function(e){var t=e.normalize().x,r=t.redSqr(),n=r.redMul(t).redAdd(r.redMul(this.a)).redAdd(t);return 0===n.redSqrt().redSqr().cmp(n)},i(c,s.BasePoint),a.prototype.decodePoint=function(e,t){return this.point(o.toArray(e,t),1)},a.prototype.point=function(e,t){return new c(this,e,t)},a.prototype.pointFromJSON=function(e){return c.fromJSON(this,e)},c.prototype.precompute=function(){},c.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},c.fromJSON=function(e,t){return new c(e,t[0],t[1]||e.one)},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},c.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),r=e.redSub(t),n=e.redMul(t),i=r.redMul(t.redAdd(this.curve.a24.redMul(r)));return this.curve.point(n,i)},c.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.diffAdd=function(e,t){var r=this.x.redAdd(this.z),n=this.x.redSub(this.z),i=e.x.redAdd(e.z),s=e.x.redSub(e.z).redMul(r),o=i.redMul(n),a=t.z.redMul(s.redAdd(o).redSqr()),c=t.x.redMul(s.redISub(o).redSqr());return this.curve.point(a,c)},c.prototype.mul=function(e){for(var t=e.clone(),r=this,n=this.curve.point(null,null),i=[];0!==t.cmpn(0);t.iushrn(1))i.push(t.andln(1));for(var s=i.length-1;s>=0;s--)0===i[s]?(r=r.diffAdd(n,this),n=n.dbl()):(n=r.diffAdd(n,this),r=r.dbl());return n},c.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},c.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},c.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},9188(e,t,r){"use strict";var n=r(7011),i=r(9404),s=r(6698),o=r(6677),a=n.assert;function c(e){o.call(this,"short",e),this.a=new i(e.a,16).toRed(this.red),this.b=new i(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function u(e,t,r,n){o.BasePoint.call(this,e,"affine"),null===t&&null===r?(this.x=null,this.y=null,this.inf=!0):(this.x=new i(t,16),this.y=new i(r,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function l(e,t,r,n){o.BasePoint.call(this,e,"jacobian"),null===t&&null===r&&null===n?(this.x=this.curve.one,this.y=this.curve.one,this.z=new i(0)):(this.x=new i(t,16),this.y=new i(r,16),this.z=new i(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}s(c,o),e.exports=c,c.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,r;if(e.beta)t=new i(e.beta,16).toRed(this.red);else{var n=this._getEndoRoots(this.p);t=(t=n[0].cmp(n[1])<0?n[0]:n[1]).toRed(this.red)}if(e.lambda)r=new i(e.lambda,16);else{var s=this._getEndoRoots(this.n);0===this.g.mul(s[0]).x.cmp(this.g.x.redMul(t))?r=s[0]:(r=s[1],a(0===this.g.mul(r).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:r,basis:e.basis?e.basis.map(function(e){return{a:new i(e.a,16),b:new i(e.b,16)}}):this._getEndoBasis(r)}}},c.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:i.mont(e),r=new i(2).toRed(t).redInvm(),n=r.redNeg(),s=new i(3).toRed(t).redNeg().redSqrt().redMul(r);return[n.redAdd(s).fromRed(),n.redSub(s).fromRed()]},c.prototype._getEndoBasis=function(e){for(var t,r,n,s,o,a,c,u,l,d=this.n.ushrn(Math.floor(this.n.bitLength()/2)),h=e,f=this.n.clone(),p=new i(1),g=new i(0),m=new i(0),y=new i(1),b=0;0!==h.cmpn(0);){var w=f.div(h);u=f.sub(w.mul(h)),l=m.sub(w.mul(p));var v=y.sub(w.mul(g));if(!n&&u.cmp(d)<0)t=c.neg(),r=p,n=u.neg(),s=l;else if(n&&2===++b)break;c=u,f=h,h=u,m=p,p=l,y=g,g=v}o=u.neg(),a=l;var E=n.sqr().add(s.sqr());return o.sqr().add(a.sqr()).cmp(E)>=0&&(o=t,a=r),n.negative&&(n=n.neg(),s=s.neg()),o.negative&&(o=o.neg(),a=a.neg()),[{a:n,b:s},{a:o,b:a}]},c.prototype._endoSplit=function(e){var t=this.endo.basis,r=t[0],n=t[1],i=n.b.mul(e).divRound(this.n),s=r.b.neg().mul(e).divRound(this.n),o=i.mul(r.a),a=s.mul(n.a),c=i.mul(r.b),u=s.mul(n.b);return{k1:e.sub(o).sub(a),k2:c.add(u).neg()}},c.prototype.pointFromX=function(e,t){(e=new i(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),n=r.redSqrt();if(0!==n.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");var s=n.fromRed().isOdd();return(t&&!s||!t&&s)&&(n=n.redNeg()),this.point(e,n)},c.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,r=e.y,n=this.a.redMul(t),i=t.redSqr().redMul(t).redIAdd(n).redIAdd(this.b);return 0===r.redSqr().redISub(i).cmpn(0)},c.prototype._endoWnafMulAdd=function(e,t,r){for(var n=this._endoWnafT1,i=this._endoWnafT2,s=0;s<e.length;s++){var o=this._endoSplit(t[s]),a=e[s],c=a._getBeta();o.k1.negative&&(o.k1.ineg(),a=a.neg(!0)),o.k2.negative&&(o.k2.ineg(),c=c.neg(!0)),n[2*s]=a,n[2*s+1]=c,i[2*s]=o.k1,i[2*s+1]=o.k2}for(var u=this._wnafMulAdd(1,n,i,2*s,r),l=0;l<2*s;l++)n[l]=null,i[l]=null;return u},s(u,o.BasePoint),c.prototype.point=function(e,t,r){return new u(this,e,t,r)},c.prototype.pointFromJSON=function(e,t){return u.fromJSON(this,e,t)},u.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var r=this.curve,n=function(e){return r.point(e.x.redMul(r.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(n)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(n)}}}return t}},u.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},u.fromJSON=function(e,t,r){"string"==typeof t&&(t=JSON.parse(t));var n=e.point(t[0],t[1],r);if(!t[2])return n;function i(t){return e.point(t[0],t[1],r)}var s=t[2];return n.precomputed={beta:null,doubles:s.doubles&&{step:s.doubles.step,points:[n].concat(s.doubles.points.map(i))},naf:s.naf&&{wnd:s.naf.wnd,points:[n].concat(s.naf.points.map(i))}},n},u.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},u.prototype.isInfinity=function(){return this.inf},u.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var r=t.redSqr().redISub(this.x).redISub(e.x),n=t.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,n)},u.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,r=this.x.redSqr(),n=e.redInvm(),i=r.redAdd(r).redIAdd(r).redIAdd(t).redMul(n),s=i.redSqr().redISub(this.x.redAdd(this.x)),o=i.redMul(this.x.redSub(s)).redISub(this.y);return this.curve.point(s,o)},u.prototype.getX=function(){return this.x.fromRed()},u.prototype.getY=function(){return this.y.fromRed()},u.prototype.mul=function(e){return e=new i(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},u.prototype.mulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i):this.curve._wnafMulAdd(1,n,i,2)},u.prototype.jmulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i,!0):this.curve._wnafMulAdd(1,n,i,2,!0)},u.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},u.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var r=this.precomputed,n=function(e){return e.neg()};t.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(n)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(n)}}}return t},u.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},s(l,o.BasePoint),c.prototype.jpoint=function(e,t,r){return new l(this,e,t,r)},l.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),r=this.x.redMul(t),n=this.y.redMul(t).redMul(e);return this.curve.point(r,n)},l.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},l.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),r=this.z.redSqr(),n=this.x.redMul(t),i=e.x.redMul(r),s=this.y.redMul(t.redMul(e.z)),o=e.y.redMul(r.redMul(this.z)),a=n.redSub(i),c=s.redSub(o);if(0===a.cmpn(0))return 0!==c.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var u=a.redSqr(),l=u.redMul(a),d=n.redMul(u),h=c.redSqr().redIAdd(l).redISub(d).redISub(d),f=c.redMul(d.redISub(h)).redISub(s.redMul(l)),p=this.z.redMul(e.z).redMul(a);return this.curve.jpoint(h,f,p)},l.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),r=this.x,n=e.x.redMul(t),i=this.y,s=e.y.redMul(t).redMul(this.z),o=r.redSub(n),a=i.redSub(s);if(0===o.cmpn(0))return 0!==a.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var c=o.redSqr(),u=c.redMul(o),l=r.redMul(c),d=a.redSqr().redIAdd(u).redISub(l).redISub(l),h=a.redMul(l.redISub(d)).redISub(i.redMul(u)),f=this.z.redMul(o);return this.curve.jpoint(d,h,f)},l.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var t;if(this.curve.zeroA||this.curve.threeA){var r=this;for(t=0;t<e;t++)r=r.dbl();return r}var n=this.curve.a,i=this.curve.tinv,s=this.x,o=this.y,a=this.z,c=a.redSqr().redSqr(),u=o.redAdd(o);for(t=0;t<e;t++){var l=s.redSqr(),d=u.redSqr(),h=d.redSqr(),f=l.redAdd(l).redIAdd(l).redIAdd(n.redMul(c)),p=s.redMul(d),g=f.redSqr().redISub(p.redAdd(p)),m=p.redISub(g),y=f.redMul(m);y=y.redIAdd(y).redISub(h);var b=u.redMul(a);t+1<e&&(c=c.redMul(h)),s=g,a=b,u=y}return this.curve.jpoint(s,u.redMul(i),a)},l.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},l.prototype._zeroDbl=function(){var e,t,r;if(this.zOne){var n=this.x.redSqr(),i=this.y.redSqr(),s=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(n).redISub(s);o=o.redIAdd(o);var a=n.redAdd(n).redIAdd(n),c=a.redSqr().redISub(o).redISub(o),u=s.redIAdd(s);u=(u=u.redIAdd(u)).redIAdd(u),e=c,t=a.redMul(o.redISub(c)).redISub(u),r=this.y.redAdd(this.y)}else{var l=this.x.redSqr(),d=this.y.redSqr(),h=d.redSqr(),f=this.x.redAdd(d).redSqr().redISub(l).redISub(h);f=f.redIAdd(f);var p=l.redAdd(l).redIAdd(l),g=p.redSqr(),m=h.redIAdd(h);m=(m=m.redIAdd(m)).redIAdd(m),e=g.redISub(f).redISub(f),t=p.redMul(f.redISub(e)).redISub(m),r=(r=this.y.redMul(this.z)).redIAdd(r)}return this.curve.jpoint(e,t,r)},l.prototype._threeDbl=function(){var e,t,r;if(this.zOne){var n=this.x.redSqr(),i=this.y.redSqr(),s=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(n).redISub(s);o=o.redIAdd(o);var a=n.redAdd(n).redIAdd(n).redIAdd(this.curve.a),c=a.redSqr().redISub(o).redISub(o);e=c;var u=s.redIAdd(s);u=(u=u.redIAdd(u)).redIAdd(u),t=a.redMul(o.redISub(c)).redISub(u),r=this.y.redAdd(this.y)}else{var l=this.z.redSqr(),d=this.y.redSqr(),h=this.x.redMul(d),f=this.x.redSub(l).redMul(this.x.redAdd(l));f=f.redAdd(f).redIAdd(f);var p=h.redIAdd(h),g=(p=p.redIAdd(p)).redAdd(p);e=f.redSqr().redISub(g),r=this.y.redAdd(this.z).redSqr().redISub(d).redISub(l);var m=d.redSqr();m=(m=(m=m.redIAdd(m)).redIAdd(m)).redIAdd(m),t=f.redMul(p.redISub(e)).redISub(m)}return this.curve.jpoint(e,t,r)},l.prototype._dbl=function(){var e=this.curve.a,t=this.x,r=this.y,n=this.z,i=n.redSqr().redSqr(),s=t.redSqr(),o=r.redSqr(),a=s.redAdd(s).redIAdd(s).redIAdd(e.redMul(i)),c=t.redAdd(t),u=(c=c.redIAdd(c)).redMul(o),l=a.redSqr().redISub(u.redAdd(u)),d=u.redISub(l),h=o.redSqr();h=(h=(h=h.redIAdd(h)).redIAdd(h)).redIAdd(h);var f=a.redMul(d).redISub(h),p=r.redAdd(r).redMul(n);return this.curve.jpoint(l,f,p)},l.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),n=t.redSqr(),i=e.redAdd(e).redIAdd(e),s=i.redSqr(),o=this.x.redAdd(t).redSqr().redISub(e).redISub(n),a=(o=(o=(o=o.redIAdd(o)).redAdd(o).redIAdd(o)).redISub(s)).redSqr(),c=n.redIAdd(n);c=(c=(c=c.redIAdd(c)).redIAdd(c)).redIAdd(c);var u=i.redIAdd(o).redSqr().redISub(s).redISub(a).redISub(c),l=t.redMul(u);l=(l=l.redIAdd(l)).redIAdd(l);var d=this.x.redMul(a).redISub(l);d=(d=d.redIAdd(d)).redIAdd(d);var h=this.y.redMul(u.redMul(c.redISub(u)).redISub(o.redMul(a)));h=(h=(h=h.redIAdd(h)).redIAdd(h)).redIAdd(h);var f=this.z.redAdd(o).redSqr().redISub(r).redISub(a);return this.curve.jpoint(d,h,f)},l.prototype.mul=function(e,t){return e=new i(e,t),this.curve._wnafMul(this,e)},l.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),r=e.z.redSqr();if(0!==this.x.redMul(r).redISub(e.x.redMul(t)).cmpn(0))return!1;var n=t.redMul(this.z),i=r.redMul(e.z);return 0===this.y.redMul(i).redISub(e.y.redMul(n)).cmpn(0)},l.prototype.eqXToP=function(e){var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(r))return!0;for(var n=e.clone(),i=this.curve.redN.redMul(t);;){if(n.iadd(this.curve.n),n.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(i),0===this.x.cmp(r))return!0}},l.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},l.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},480(e,t,r){"use strict";var n,i=t,s=r(7952),o=r(894),a=r(7011).assert;function c(e){"short"===e.type?this.curve=new o.short(e):"edwards"===e.type?this.curve=new o.edwards(e):this.curve=new o.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,a(this.g.validate(),"Invalid curve"),a(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function u(e,t){Object.defineProperty(i,e,{configurable:!0,enumerable:!0,get:function(){var r=new c(t);return Object.defineProperty(i,e,{configurable:!0,enumerable:!0,value:r}),r}})}i.PresetCurve=c,u("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:s.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),u("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:s.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),u("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:s.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),u("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:s.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),u("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:s.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),u("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["9"]}),u("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{n=r(4011)}catch(e){n=void 0}u("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:s.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",n]})},7447(e,t,r){"use strict";var n=r(9404),i=r(2723),s=r(7011),o=r(480),a=r(5037),c=s.assert,u=r(1200),l=r(8545);function d(e){if(!(this instanceof d))return new d(e);"string"==typeof e&&(c(Object.prototype.hasOwnProperty.call(o,e),"Unknown curve "+e),e=o[e]),e instanceof o.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}e.exports=d,d.prototype.keyPair=function(e){return new u(this,e)},d.prototype.keyFromPrivate=function(e,t){return u.fromPrivate(this,e,t)},d.prototype.keyFromPublic=function(e,t){return u.fromPublic(this,e,t)},d.prototype.genKeyPair=function(e){e||(e={});for(var t=new i({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||a(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),r=this.n.byteLength(),s=this.n.sub(new n(2));;){var o=new n(t.generate(r));if(!(o.cmp(s)>0))return o.iaddn(1),this.keyFromPrivate(o)}},d.prototype._truncateToN=function(e,t,r){var i;if(n.isBN(e)||"number"==typeof e)i=(e=new n(e,16)).byteLength();else if("object"==typeof e)i=e.length,e=new n(e,16);else{var s=e.toString();i=s.length+1>>>1,e=new n(s,16)}"number"!=typeof r&&(r=8*i);var o=r-this.n.bitLength();return o>0&&(e=e.ushrn(o)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},d.prototype.sign=function(e,t,r,s){if("object"==typeof r&&(s=r,r=null),s||(s={}),"string"!=typeof e&&"number"!=typeof e&&!n.isBN(e)){c("object"==typeof e&&e&&"number"==typeof e.length,"Expected message to be an array-like, a hex string, or a BN instance"),c(e.length>>>0===e.length);for(var o=0;o<e.length;o++)c((255&e[o])===e[o])}t=this.keyFromPrivate(t,r),e=this._truncateToN(e,!1,s.msgBitLength),c(!e.isNeg(),"Can not sign a negative message");var a=this.n.byteLength(),u=t.getPrivate().toArray("be",a),d=e.toArray("be",a);c(new n(d).eq(e),"Can not sign message");for(var h=new i({hash:this.hash,entropy:u,nonce:d,pers:s.pers,persEnc:s.persEnc||"utf8"}),f=this.n.sub(new n(1)),p=0;;p++){var g=s.k?s.k(p):new n(h.generate(this.n.byteLength()));if(!((g=this._truncateToN(g,!0)).cmpn(1)<=0||g.cmp(f)>=0)){var m=this.g.mul(g);if(!m.isInfinity()){var y=m.getX(),b=y.umod(this.n);if(0!==b.cmpn(0)){var w=g.invm(this.n).mul(b.mul(t.getPrivate()).iadd(e));if(0!==(w=w.umod(this.n)).cmpn(0)){var v=(m.getY().isOdd()?1:0)|(0!==y.cmp(b)?2:0);return s.canonical&&w.cmp(this.nh)>0&&(w=this.n.sub(w),v^=1),new l({r:b,s:w,recoveryParam:v})}}}}}},d.prototype.verify=function(e,t,r,n,i){i||(i={}),e=this._truncateToN(e,!1,i.msgBitLength),r=this.keyFromPublic(r,n);var s=(t=new l(t,"hex")).r,o=t.s;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return!1;if(o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var a,c=o.invm(this.n),u=c.mul(e).umod(this.n),d=c.mul(s).umod(this.n);return this.curve._maxwellTrick?!(a=this.g.jmulAdd(u,r.getPublic(),d)).isInfinity()&&a.eqXToP(s):!(a=this.g.mulAdd(u,r.getPublic(),d)).isInfinity()&&0===a.getX().umod(this.n).cmp(s)},d.prototype.recoverPubKey=function(e,t,r,i){c((3&r)===r,"The recovery param is more than two bits"),t=new l(t,i);var s=this.n,o=new n(e),a=t.r,u=t.s,d=1&r,h=r>>1;if(a.cmp(this.curve.p.umod(this.curve.n))>=0&&h)throw new Error("Unable to find sencond key candinate");a=h?this.curve.pointFromX(a.add(this.curve.n),d):this.curve.pointFromX(a,d);var f=t.r.invm(s),p=s.sub(o).mul(f).umod(s),g=u.mul(f).umod(s);return this.g.mulAdd(p,a,g)},d.prototype.getKeyRecoveryParam=function(e,t,r,n){if(null!==(t=new l(t,n)).recoveryParam)return t.recoveryParam;for(var i=0;i<4;i++){var s;try{s=this.recoverPubKey(e,t,i)}catch(e){continue}if(s.eq(r))return i}throw new Error("Unable to find valid recovery factor")}},1200(e,t,r){"use strict";var n=r(9404),i=r(7011).assert;function s(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}e.exports=s,s.fromPublic=function(e,t,r){return t instanceof s?t:new s(e,{pub:t,pubEnc:r})},s.fromPrivate=function(e,t,r){return t instanceof s?t:new s(e,{priv:t,privEnc:r})},s.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},s.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},s.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},s.prototype._importPrivate=function(e,t){this.priv=new n(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},s.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?i(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||i(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},s.prototype.derive=function(e){return e.validate()||i(e.validate(),"public point not validated"),e.mul(this.priv).getX()},s.prototype.sign=function(e,t,r){return this.ec.sign(e,this,t,r)},s.prototype.verify=function(e,t,r){return this.ec.verify(e,t,this,void 0,r)},s.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},8545(e,t,r){"use strict";var n=r(9404),i=r(7011),s=i.assert;function o(e,t){if(e instanceof o)return e;this._importDER(e,t)||(s(e.r&&e.s,"Signature without r or s"),this.r=new n(e.r,16),this.s=new n(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function a(){this.place=0}function c(e,t){var r=e[t.place++];if(!(128&r))return r;var n=15&r;if(0===n||n>4)return!1;if(0===e[t.place])return!1;for(var i=0,s=0,o=t.place;s<n;s++,o++)i<<=8,i|=e[o],i>>>=0;return!(i<=127)&&(t.place=o,i)}function u(e){for(var t=0,r=e.length-1;!e[t]&&!(128&e[t+1])&&t<r;)t++;return 0===t?e:e.slice(t)}function l(e,t){if(t<128)e.push(t);else{var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|r);--r;)e.push(t>>>(r<<3)&255);e.push(t)}}e.exports=o,o.prototype._importDER=function(e,t){e=i.toArray(e,t);var r=new a;if(48!==e[r.place++])return!1;var s=c(e,r);if(!1===s)return!1;if(s+r.place!==e.length)return!1;if(2!==e[r.place++])return!1;var o=c(e,r);if(!1===o)return!1;if(128&e[r.place])return!1;var u=e.slice(r.place,o+r.place);if(r.place+=o,2!==e[r.place++])return!1;var l=c(e,r);if(!1===l)return!1;if(e.length!==l+r.place)return!1;if(128&e[r.place])return!1;var d=e.slice(r.place,l+r.place);if(0===u[0]){if(!(128&u[1]))return!1;u=u.slice(1)}if(0===d[0]){if(!(128&d[1]))return!1;d=d.slice(1)}return this.r=new n(u),this.s=new n(d),this.recoveryParam=null,!0},o.prototype.toDER=function(e){var t=this.r.toArray(),r=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&r[0]&&(r=[0].concat(r)),t=u(t),r=u(r);!(r[0]||128&r[1]);)r=r.slice(1);var n=[2];l(n,t.length),(n=n.concat(t)).push(2),l(n,r.length);var s=n.concat(r),o=[48];return l(o,s.length),o=o.concat(s),i.encode(o,e)}},8650(e,t,r){"use strict";var n=r(7952),i=r(480),s=r(7011),o=s.assert,a=s.parseBytes,c=r(6661),u=r(220);function l(e){if(o("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof l))return new l(e);e=i[e].curve,this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=n.sha512}e.exports=l,l.prototype.sign=function(e,t){e=a(e);var r=this.keyFromSecret(t),n=this.hashInt(r.messagePrefix(),e),i=this.g.mul(n),s=this.encodePoint(i),o=this.hashInt(s,r.pubBytes(),e).mul(r.priv()),c=n.add(o).umod(this.curve.n);return this.makeSignature({R:i,S:c,Rencoded:s})},l.prototype.verify=function(e,t,r){if(e=a(e),(t=this.makeSignature(t)).S().gte(t.eddsa.curve.n)||t.S().isNeg())return!1;var n=this.keyFromPublic(r),i=this.hashInt(t.Rencoded(),n.pubBytes(),e),s=this.g.mul(t.S());return t.R().add(n.pub().mul(i)).eq(s)},l.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return s.intFromLE(e.digest()).umod(this.curve.n)},l.prototype.keyFromPublic=function(e){return c.fromPublic(this,e)},l.prototype.keyFromSecret=function(e){return c.fromSecret(this,e)},l.prototype.makeSignature=function(e){return e instanceof u?e:new u(this,e)},l.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},l.prototype.decodePoint=function(e){var t=(e=s.parseBytes(e)).length-1,r=e.slice(0,t).concat(-129&e[t]),n=!!(128&e[t]),i=s.intFromLE(r);return this.curve.pointFromY(i,n)},l.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},l.prototype.decodeInt=function(e){return s.intFromLE(e)},l.prototype.isPoint=function(e){return e instanceof this.pointClass}},6661(e,t,r){"use strict";var n=r(7011),i=n.assert,s=n.parseBytes,o=n.cachedProperty;function a(e,t){this.eddsa=e,this._secret=s(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=s(t.pub)}a.fromPublic=function(e,t){return t instanceof a?t:new a(e,{pub:t})},a.fromSecret=function(e,t){return t instanceof a?t:new a(e,{secret:t})},a.prototype.secret=function(){return this._secret},o(a,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),o(a,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),o(a,"privBytes",function(){var e=this.eddsa,t=this.hash(),r=e.encodingLength-1,n=t.slice(0,e.encodingLength);return n[0]&=248,n[r]&=127,n[r]|=64,n}),o(a,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),o(a,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),o(a,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),a.prototype.sign=function(e){return i(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},a.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},a.prototype.getSecret=function(e){return i(this._secret,"KeyPair is public only"),n.encode(this.secret(),e)},a.prototype.getPublic=function(e){return n.encode(this.pubBytes(),e)},e.exports=a},220(e,t,r){"use strict";var n=r(9404),i=r(7011),s=i.assert,o=i.cachedProperty,a=i.parseBytes;function c(e,t){this.eddsa=e,"object"!=typeof t&&(t=a(t)),Array.isArray(t)&&(s(t.length===2*e.encodingLength,"Signature has invalid size"),t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),s(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof n&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}o(c,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),o(c,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),o(c,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),o(c,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),c.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},c.prototype.toHex=function(){return i.encode(this.toBytes(),"hex").toUpperCase()},e.exports=c},4011(e){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},7011(e,t,r){"use strict";var n=t,i=r(9404),s=r(3349),o=r(4367);n.assert=s,n.toArray=o.toArray,n.zero2=o.zero2,n.toHex=o.toHex,n.encode=o.encode,n.getNAF=function(e,t,r){var n,i=new Array(Math.max(e.bitLength(),r)+1);for(n=0;n<i.length;n+=1)i[n]=0;var s=1<<t+1,o=e.clone();for(n=0;n<i.length;n++){var a,c=o.andln(s-1);o.isOdd()?(a=c>(s>>1)-1?(s>>1)-c:c,o.isubn(a)):a=0,i[n]=a,o.iushrn(1)}return i},n.getJSF=function(e,t){var r=[[],[]];e=e.clone(),t=t.clone();for(var n,i=0,s=0;e.cmpn(-i)>0||t.cmpn(-s)>0;){var o,a,c=e.andln(3)+i&3,u=t.andln(3)+s&3;3===c&&(c=-1),3===u&&(u=-1),o=1&c?3!=(n=e.andln(7)+i&7)&&5!==n||2!==u?c:-c:0,r[0].push(o),a=1&u?3!=(n=t.andln(7)+s&7)&&5!==n||2!==c?u:-u:0,r[1].push(a),2*i===o+1&&(i=1-i),2*s===a+1&&(s=1-s),e.iushrn(1),t.iushrn(1)}return r},n.cachedProperty=function(e,t,r){var n="_"+t;e.prototype[t]=function(){return void 0!==this[n]?this[n]:this[n]=r.call(this)}},n.parseBytes=function(e){return"string"==typeof e?n.toArray(e,"hex"):e},n.intFromLE=function(e){return new i(e,"hex","le")}},655(e){"use strict";var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}e.exports=t},1237(e){"use strict";e.exports=EvalError},9383(e){"use strict";e.exports=Error},9290(e){"use strict";e.exports=RangeError},9538(e){"use strict";e.exports=ReferenceError},8068(e){"use strict";e.exports=SyntaxError},9675(e){"use strict";e.exports=TypeError},5345(e){"use strict";e.exports=URIError},9612(e){"use strict";e.exports=Object},4903(e){var t=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return t()}try{return __global__||t()}finally{delete Object.prototype.__global__}}()},228(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,s),!0;case 6:return l.fn.call(l.context,t,n,i,s,o),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},7007(e){"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise(function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}g(e,t,s,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)})},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var i,s,o,u;if(a(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function g(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(s){n.once&&e.removeEventListener(t,i),r(s)})}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var u=c.length,l=p(c,u);for(r=0;r<u;++r)n(l[r],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,s,o;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},s.prototype.listenerCount=f,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},2682(e,t,r){"use strict";var n=r(9600),i=Object.prototype.toString,s=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){if(!n(t))throw new TypeError("iterator must be a function");var o,a;arguments.length>=3&&(o=r),a=e,"[object Array]"===i.call(a)?function(e,t,r){for(var n=0,i=e.length;n<i;n++)s.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))}(e,t,o):"string"==typeof e?function(e,t,r){for(var n=0,i=e.length;n<i;n++)null==r?t(e.charAt(n),n,e):t.call(r,e.charAt(n),n,e)}(e,t,o):function(e,t,r){for(var n in e)s.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))}(e,t,o)}},9353(e){"use strict";var t=Object.prototype.toString,r=Math.max,n=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var i=0;i<t.length;i+=1)r[i+e.length]=t[i];return r};e.exports=function(e){var i=this;if("function"!=typeof i||"[object Function]"!==t.apply(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var s,o=function(e){for(var t=[],r=1,n=0;r<e.length;r+=1,n+=1)t[n]=e[r];return t}(arguments),a=r(0,i.length-o.length),c=[],u=0;u<a;u++)c[u]="$"+u;if(s=Function("binder","return function ("+function(e){for(var t="",r=0;r<e.length;r+=1)t+=e[r],r+1<e.length&&(t+=",");return t}(c)+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof s){var t=i.apply(this,n(o,arguments));return Object(t)===t?t:this}return i.apply(e,n(o,arguments))}),i.prototype){var l=function(){};l.prototype=i.prototype,s.prototype=new l,l.prototype=null}return s}},6743(e,t,r){"use strict";var n=r(9353);e.exports=Function.prototype.bind||n},453(e,t,r){"use strict";var n,i=r(9612),s=r(9383),o=r(1237),a=r(9290),c=r(9538),u=r(8068),l=r(9675),d=r(5345),h=r(1514),f=r(8968),p=r(6188),g=r(8002),m=r(5880),y=r(414),b=r(3093),w=Function,v=function(e){try{return w('"use strict"; return ('+e+").constructor;")()}catch(e){}},E=r(5795),A=r(655),S=function(){throw new l},k=E?function(){try{return S}catch(e){try{return E(arguments,"callee").get}catch(e){return S}}}():S,R=r(4039)(),P=r(3628),I=r(1064),C=r(8648),_=r(1002),T=r(76),N={},x="undefined"!=typeof Uint8Array&&P?P(Uint8Array):n,O={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":R&&P?P([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":N,"%AsyncGenerator%":N,"%AsyncGeneratorFunction%":N,"%AsyncIteratorPrototype%":N,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":s,"%eval%":eval,"%EvalError%":o,"%Float16Array%":"undefined"==typeof Float16Array?n:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":w,"%GeneratorFunction%":N,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":R&&P?P(P([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&R&&P?P((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":i,"%Object.getOwnPropertyDescriptor%":E,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":a,"%ReferenceError%":c,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&R&&P?P((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":R&&P?P(""[Symbol.iterator]()):n,"%Symbol%":R?Symbol:n,"%SyntaxError%":u,"%ThrowTypeError%":k,"%TypedArray%":x,"%TypeError%":l,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":d,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet,"%Function.prototype.call%":T,"%Function.prototype.apply%":_,"%Object.defineProperty%":A,"%Object.getPrototypeOf%":I,"%Math.abs%":h,"%Math.floor%":f,"%Math.max%":p,"%Math.min%":g,"%Math.pow%":m,"%Math.round%":y,"%Math.sign%":b,"%Reflect.getPrototypeOf%":C};if(P)try{null.error}catch(e){var D=P(P(e));O["%Error.prototype%"]=D}var M=function e(t){var r;if("%AsyncFunction%"===t)r=v("async function () {}");else if("%GeneratorFunction%"===t)r=v("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=v("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&P&&(r=P(i.prototype))}return O[t]=r,r},B={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},L=r(6743),F=r(9957),U=L.call(T,Array.prototype.concat),j=L.call(_,Array.prototype.splice),z=L.call(T,String.prototype.replace),q=L.call(T,String.prototype.slice),K=L.call(T,RegExp.prototype.exec),G=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,$=/\\(\\)?/g,V=function(e,t){var r,n=e;if(F(B,n)&&(n="%"+(r=B[n])[0]+"%"),F(O,n)){var i=O[n];if(i===N&&(i=M(n)),void 0===i&&!t)throw new l("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new u("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new l("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new l('"allowMissing" argument must be a boolean');if(null===K(/^%?[^%]*%?$/,e))throw new u("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=q(e,0,1),r=q(e,-1);if("%"===t&&"%"!==r)throw new u("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new u("invalid intrinsic syntax, expected opening `%`");var n=[];return z(e,G,function(e,t,r,i){n[n.length]=r?z(i,$,"$1"):t||e}),n}(e),n=r.length>0?r[0]:"",i=V("%"+n+"%",t),s=i.name,o=i.value,a=!1,c=i.alias;c&&(n=c[0],j(r,U([0,1],c)));for(var d=1,h=!0;d<r.length;d+=1){var f=r[d],p=q(f,0,1),g=q(f,-1);if(('"'===p||"'"===p||"`"===p||'"'===g||"'"===g||"`"===g)&&p!==g)throw new u("property names with quotes must have matching quotes");if("constructor"!==f&&h||(a=!0),F(O,s="%"+(n+="."+f)+"%"))o=O[s];else if(null!=o){if(!(f in o)){if(!t)throw new l("base intrinsic for "+e+" exists, but the property is not available.");return}if(E&&d+1>=r.length){var m=E(o,f);o=(h=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:o[f]}else h=F(o,f),o=o[f];h&&!a&&(O[s]=o)}}return o}},1064(e,t,r){"use strict";var n=r(9612);e.exports=n.getPrototypeOf||null},8648(e){"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},3628(e,t,r){"use strict";var n=r(8648),i=r(1064),s=r(7176);e.exports=n?function(e){return n(e)}:i?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return i(e)}:s?function(e){return s(e)}:null},6549(e){"use strict";e.exports=Object.getOwnPropertyDescriptor},5795(e,t,r){"use strict";var n=r(6549);if(n)try{n([],"length")}catch(e){n=null}e.exports=n},592(e,t,r){"use strict";var n=r(655),i=function(){return!!n};i.hasArrayLengthDefineBug=function(){if(!n)return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},e.exports=i},4039(e,t,r){"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(1333);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},1333(e){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(var n in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(e,t);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},9092(e,t,r){"use strict";var n=r(1333);e.exports=function(){return n()&&!!Symbol.toStringTag}},7952(e,t,r){var n=t;n.utils=r(7426),n.common=r(6166),n.sha=r(6229),n.ripemd=r(6784),n.hmac=r(8948),n.sha1=n.sha.sha1,n.sha256=n.sha.sha256,n.sha224=n.sha.sha224,n.sha384=n.sha.sha384,n.sha512=n.sha.sha512,n.ripemd160=n.ripemd.ripemd160},6166(e,t,r){"use strict";var n=r(7426),i=r(3349);function s(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}t.BlockHash=s,s.prototype.update=function(e,t){if(e=n.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var r=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-r,e.length),0===this.pending.length&&(this.pending=null),e=n.join32(e,0,e.length-r,this.endian);for(var i=0;i<e.length;i+=this._delta32)this._update(e,i,i+this._delta32)}return this},s.prototype.digest=function(e){return this.update(this._pad()),i(null===this.pending),this._digest(e)},s.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,n=new Array(r+this.padLength);n[0]=128;for(var i=1;i<r;i++)n[i]=0;if(e<<=3,"big"===this.endian){for(var s=8;s<this.padLength;s++)n[i++]=0;n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=e>>>24&255,n[i++]=e>>>16&255,n[i++]=e>>>8&255,n[i++]=255&e}else for(n[i++]=255&e,n[i++]=e>>>8&255,n[i++]=e>>>16&255,n[i++]=e>>>24&255,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0,s=8;s<this.padLength;s++)n[i++]=0;return n}},8948(e,t,r){"use strict";var n=r(7426),i=r(3349);function s(e,t,r){if(!(this instanceof s))return new s(e,t,r);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(n.toArray(t,r))}e.exports=s,s.prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),i(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=(new this.Hash).update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},s.prototype.update=function(e,t){return this.inner.update(e,t),this},s.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}},6784(e,t,r){"use strict";var n=r(7426),i=r(6166),s=n.rotl32,o=n.sum32,a=n.sum32_3,c=n.sum32_4,u=i.BlockHash;function l(){if(!(this instanceof l))return new l;u.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function d(e,t,r,n){return e<=15?t^r^n:e<=31?t&r|~t&n:e<=47?(t|~r)^n:e<=63?t&n|r&~n:t^(r|~n)}function h(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function f(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}n.inherits(l,u),t.ripemd160=l,l.blockSize=512,l.outSize=160,l.hmacStrength=192,l.padLength=64,l.prototype._update=function(e,t){for(var r=this.h[0],n=this.h[1],i=this.h[2],u=this.h[3],l=this.h[4],b=r,w=n,v=i,E=u,A=l,S=0;S<80;S++){var k=o(s(c(r,d(S,n,i,u),e[p[S]+t],h(S)),m[S]),l);r=l,l=u,u=s(i,10),i=n,n=k,k=o(s(c(b,d(79-S,w,v,E),e[g[S]+t],f(S)),y[S]),A),b=A,A=E,E=s(v,10),v=w,w=k}k=a(this.h[1],i,E),this.h[1]=a(this.h[2],u,A),this.h[2]=a(this.h[3],l,b),this.h[3]=a(this.h[4],r,w),this.h[4]=a(this.h[0],n,v),this.h[0]=k},l.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"little"):n.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],g=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],m=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],y=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},6229(e,t,r){"use strict";t.sha1=r(3917),t.sha224=r(7714),t.sha256=r(2287),t.sha384=r(1911),t.sha512=r(7766)},3917(e,t,r){"use strict";var n=r(7426),i=r(6166),s=r(6225),o=n.rotl32,a=n.sum32,c=n.sum32_5,u=s.ft_1,l=i.BlockHash,d=[1518500249,1859775393,2400959708,3395469782];function h(){if(!(this instanceof h))return new h;l.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}n.inherits(h,l),e.exports=h,h.blockSize=512,h.outSize=160,h.hmacStrength=80,h.padLength=64,h.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=o(r[n-3]^r[n-8]^r[n-14]^r[n-16],1);var i=this.h[0],s=this.h[1],l=this.h[2],h=this.h[3],f=this.h[4];for(n=0;n<r.length;n++){var p=~~(n/20),g=c(o(i,5),u(p,s,l,h),f,r[n],d[p]);f=h,h=l,l=o(s,30),s=i,i=g}this.h[0]=a(this.h[0],i),this.h[1]=a(this.h[1],s),this.h[2]=a(this.h[2],l),this.h[3]=a(this.h[3],h),this.h[4]=a(this.h[4],f)},h.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},7714(e,t,r){"use strict";var n=r(7426),i=r(2287);function s(){if(!(this instanceof s))return new s;i.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}n.inherits(s,i),e.exports=s,s.blockSize=512,s.outSize=224,s.hmacStrength=192,s.padLength=64,s.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,7),"big"):n.split32(this.h.slice(0,7),"big")}},2287(e,t,r){"use strict";var n=r(7426),i=r(6166),s=r(6225),o=r(3349),a=n.sum32,c=n.sum32_4,u=n.sum32_5,l=s.ch32,d=s.maj32,h=s.s0_256,f=s.s1_256,p=s.g0_256,g=s.g1_256,m=i.BlockHash,y=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function b(){if(!(this instanceof b))return new b;m.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=y,this.W=new Array(64)}n.inherits(b,m),e.exports=b,b.blockSize=512,b.outSize=256,b.hmacStrength=192,b.padLength=64,b.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=c(g(r[n-2]),r[n-7],p(r[n-15]),r[n-16]);var i=this.h[0],s=this.h[1],m=this.h[2],y=this.h[3],b=this.h[4],w=this.h[5],v=this.h[6],E=this.h[7];for(o(this.k.length===r.length),n=0;n<r.length;n++){var A=u(E,f(b),l(b,w,v),this.k[n],r[n]),S=a(h(i),d(i,s,m));E=v,v=w,w=b,b=a(y,A),y=m,m=s,s=i,i=a(A,S)}this.h[0]=a(this.h[0],i),this.h[1]=a(this.h[1],s),this.h[2]=a(this.h[2],m),this.h[3]=a(this.h[3],y),this.h[4]=a(this.h[4],b),this.h[5]=a(this.h[5],w),this.h[6]=a(this.h[6],v),this.h[7]=a(this.h[7],E)},b.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},1911(e,t,r){"use strict";var n=r(7426),i=r(7766);function s(){if(!(this instanceof s))return new s;i.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}n.inherits(s,i),e.exports=s,s.blockSize=1024,s.outSize=384,s.hmacStrength=192,s.padLength=128,s.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,12),"big"):n.split32(this.h.slice(0,12),"big")}},7766(e,t,r){"use strict";var n=r(7426),i=r(6166),s=r(3349),o=n.rotr64_hi,a=n.rotr64_lo,c=n.shr64_hi,u=n.shr64_lo,l=n.sum64,d=n.sum64_hi,h=n.sum64_lo,f=n.sum64_4_hi,p=n.sum64_4_lo,g=n.sum64_5_hi,m=n.sum64_5_lo,y=i.BlockHash,b=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function w(){if(!(this instanceof w))return new w;y.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=b,this.W=new Array(160)}function v(e,t,r,n,i){var s=e&r^~e&i;return s<0&&(s+=4294967296),s}function E(e,t,r,n,i,s){var o=t&n^~t&s;return o<0&&(o+=4294967296),o}function A(e,t,r,n,i){var s=e&r^e&i^r&i;return s<0&&(s+=4294967296),s}function S(e,t,r,n,i,s){var o=t&n^t&s^n&s;return o<0&&(o+=4294967296),o}function k(e,t){var r=o(e,t,28)^o(t,e,2)^o(t,e,7);return r<0&&(r+=4294967296),r}function R(e,t){var r=a(e,t,28)^a(t,e,2)^a(t,e,7);return r<0&&(r+=4294967296),r}function P(e,t){var r=o(e,t,14)^o(e,t,18)^o(t,e,9);return r<0&&(r+=4294967296),r}function I(e,t){var r=a(e,t,14)^a(e,t,18)^a(t,e,9);return r<0&&(r+=4294967296),r}function C(e,t){var r=o(e,t,1)^o(e,t,8)^c(e,t,7);return r<0&&(r+=4294967296),r}function _(e,t){var r=a(e,t,1)^a(e,t,8)^u(e,t,7);return r<0&&(r+=4294967296),r}function T(e,t){var r=o(e,t,19)^o(t,e,29)^c(e,t,6);return r<0&&(r+=4294967296),r}function N(e,t){var r=a(e,t,19)^a(t,e,29)^u(e,t,6);return r<0&&(r+=4294967296),r}n.inherits(w,y),e.exports=w,w.blockSize=1024,w.outSize=512,w.hmacStrength=192,w.padLength=128,w.prototype._prepareBlock=function(e,t){for(var r=this.W,n=0;n<32;n++)r[n]=e[t+n];for(;n<r.length;n+=2){var i=T(r[n-4],r[n-3]),s=N(r[n-4],r[n-3]),o=r[n-14],a=r[n-13],c=C(r[n-30],r[n-29]),u=_(r[n-30],r[n-29]),l=r[n-32],d=r[n-31];r[n]=f(i,s,o,a,c,u,l,d),r[n+1]=p(i,s,o,a,c,u,l,d)}},w.prototype._update=function(e,t){this._prepareBlock(e,t);var r=this.W,n=this.h[0],i=this.h[1],o=this.h[2],a=this.h[3],c=this.h[4],u=this.h[5],f=this.h[6],p=this.h[7],y=this.h[8],b=this.h[9],w=this.h[10],C=this.h[11],_=this.h[12],T=this.h[13],N=this.h[14],x=this.h[15];s(this.k.length===r.length);for(var O=0;O<r.length;O+=2){var D=N,M=x,B=P(y,b),L=I(y,b),F=v(y,0,w,0,_),U=E(0,b,0,C,0,T),j=this.k[O],z=this.k[O+1],q=r[O],K=r[O+1],G=g(D,M,B,L,F,U,j,z,q,K),$=m(D,M,B,L,F,U,j,z,q,K);D=k(n,i),M=R(n,i),B=A(n,0,o,0,c),L=S(0,i,0,a,0,u);var V=d(D,M,B,L),H=h(D,M,B,L);N=_,x=T,_=w,T=C,w=y,C=b,y=d(f,p,G,$),b=h(p,p,G,$),f=c,p=u,c=o,u=a,o=n,a=i,n=d(G,$,V,H),i=h(G,$,V,H)}l(this.h,0,n,i),l(this.h,2,o,a),l(this.h,4,c,u),l(this.h,6,f,p),l(this.h,8,y,b),l(this.h,10,w,C),l(this.h,12,_,T),l(this.h,14,N,x)},w.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},6225(e,t,r){"use strict";var n=r(7426).rotr32;function i(e,t,r){return e&t^~e&r}function s(e,t,r){return e&t^e&r^t&r}function o(e,t,r){return e^t^r}t.ft_1=function(e,t,r,n){return 0===e?i(t,r,n):1===e||3===e?o(t,r,n):2===e?s(t,r,n):void 0},t.ch32=i,t.maj32=s,t.p32=o,t.s0_256=function(e){return n(e,2)^n(e,13)^n(e,22)},t.s1_256=function(e){return n(e,6)^n(e,11)^n(e,25)},t.g0_256=function(e){return n(e,7)^n(e,18)^e>>>3},t.g1_256=function(e){return n(e,17)^n(e,19)^e>>>10}},7426(e,t,r){"use strict";var n=r(3349),i=r(6698);function s(e,t){return 55296==(64512&e.charCodeAt(t))&&!(t<0||t+1>=e.length)&&56320==(64512&e.charCodeAt(t+1))}function o(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function a(e){return 1===e.length?"0"+e:e}function c(e){return 7===e.length?"0"+e:6===e.length?"00"+e:5===e.length?"000"+e:4===e.length?"0000"+e:3===e.length?"00000"+e:2===e.length?"000000"+e:1===e.length?"0000000"+e:e}t.inherits=i,t.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),i=0;i<e.length;i+=2)r.push(parseInt(e[i]+e[i+1],16))}else for(var n=0,i=0;i<e.length;i++){var o=e.charCodeAt(i);o<128?r[n++]=o:o<2048?(r[n++]=o>>6|192,r[n++]=63&o|128):s(e,i)?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++i)),r[n++]=o>>18|240,r[n++]=o>>12&63|128,r[n++]=o>>6&63|128,r[n++]=63&o|128):(r[n++]=o>>12|224,r[n++]=o>>6&63|128,r[n++]=63&o|128)}else for(i=0;i<e.length;i++)r[i]=0|e[i];return r},t.toHex=function(e){for(var t="",r=0;r<e.length;r++)t+=a(e[r].toString(16));return t},t.htonl=o,t.toHex32=function(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n];"little"===t&&(i=o(i)),r+=c(i.toString(16))}return r},t.zero2=a,t.zero8=c,t.join32=function(e,t,r,i){var s=r-t;n(s%4==0);for(var o=new Array(s/4),a=0,c=t;a<o.length;a++,c+=4){var u;u="big"===i?e[c]<<24|e[c+1]<<16|e[c+2]<<8|e[c+3]:e[c+3]<<24|e[c+2]<<16|e[c+1]<<8|e[c],o[a]=u>>>0}return o},t.split32=function(e,t){for(var r=new Array(4*e.length),n=0,i=0;n<e.length;n++,i+=4){var s=e[n];"big"===t?(r[i]=s>>>24,r[i+1]=s>>>16&255,r[i+2]=s>>>8&255,r[i+3]=255&s):(r[i+3]=s>>>24,r[i+2]=s>>>16&255,r[i+1]=s>>>8&255,r[i]=255&s)}return r},t.rotr32=function(e,t){return e>>>t|e<<32-t},t.rotl32=function(e,t){return e<<t|e>>>32-t},t.sum32=function(e,t){return e+t>>>0},t.sum32_3=function(e,t,r){return e+t+r>>>0},t.sum32_4=function(e,t,r,n){return e+t+r+n>>>0},t.sum32_5=function(e,t,r,n,i){return e+t+r+n+i>>>0},t.sum64=function(e,t,r,n){var i=e[t],s=n+e[t+1]>>>0,o=(s<n?1:0)+r+i;e[t]=o>>>0,e[t+1]=s},t.sum64_hi=function(e,t,r,n){return(t+n>>>0<t?1:0)+e+r>>>0},t.sum64_lo=function(e,t,r,n){return t+n>>>0},t.sum64_4_hi=function(e,t,r,n,i,s,o,a){var c=0,u=t;return c+=(u=u+n>>>0)<t?1:0,c+=(u=u+s>>>0)<s?1:0,e+r+i+o+(c+=(u=u+a>>>0)<a?1:0)>>>0},t.sum64_4_lo=function(e,t,r,n,i,s,o,a){return t+n+s+a>>>0},t.sum64_5_hi=function(e,t,r,n,i,s,o,a,c,u){var l=0,d=t;return l+=(d=d+n>>>0)<t?1:0,l+=(d=d+s>>>0)<s?1:0,l+=(d=d+a>>>0)<a?1:0,e+r+i+o+c+(l+=(d=d+u>>>0)<u?1:0)>>>0},t.sum64_5_lo=function(e,t,r,n,i,s,o,a,c,u){return t+n+s+a+u>>>0},t.rotr64_hi=function(e,t,r){return(t<<32-r|e>>>r)>>>0},t.rotr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0},t.shr64_hi=function(e,t,r){return e>>>r},t.shr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0}},9957(e,t,r){"use strict";var n=Function.prototype.call,i=Object.prototype.hasOwnProperty,s=r(6743);e.exports=s.call(n,i)},1031(e){var t,r,n,i=(t={km:6371,mile:3960,meter:6371e3,nmi:3440},r=function(e){return e*Math.PI/180},n=function(e,t){switch(e){case"[lat,lon]":return{latitude:t[0],longitude:t[1]};case"[lon,lat]":return{latitude:t[1],longitude:t[0]};case"{lon,lat}":return{latitude:t.lat,longitude:t.lon};case"{lat,lng}":return{latitude:t.lat,longitude:t.lng};case"geojson":return{latitude:t.geometry.coordinates[1],longitude:t.geometry.coordinates[0]};default:return t}},function(e,i,s){var o=(s=s||{}).unit in t?t[s.unit]:t.km,a=n(s.format,e),c=n(s.format,i),u=r(c.latitude-a.latitude),l=r(c.longitude-a.longitude),d=r(a.latitude),h=r(c.latitude),f=Math.sin(u/2)*Math.sin(u/2)+Math.sin(l/2)*Math.sin(l/2)*Math.cos(d)*Math.cos(h),p=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f));return s.threshold?s.threshold>o*p:o*p});e.exports&&(e.exports=i)},5731(e,t,r){r(4297)},4297(e,t){var r,n,i;(function(){var s,o,a,c,u,l,d,h,f,p,g,m,y,b,w;a=Math.floor,p=Math.min,o=function(e,t){return e<t?-1:e>t?1:0},f=function(e,t,r,n,i){var s;if(null==r&&(r=0),null==i&&(i=o),r<0)throw new Error("lo must be non-negative");for(null==n&&(n=e.length);r<n;)i(t,e[s=a((r+n)/2)])<0?n=s:r=s+1;return[].splice.apply(e,[r,r-r].concat(t)),t},l=function(e,t,r){return null==r&&(r=o),e.push(t),b(e,0,e.length-1,r)},u=function(e,t){var r,n;return null==t&&(t=o),r=e.pop(),e.length?(n=e[0],e[0]=r,w(e,0,t)):n=r,n},h=function(e,t,r){var n;return null==r&&(r=o),n=e[0],e[0]=t,w(e,0,r),n},d=function(e,t,r){var n;return null==r&&(r=o),e.length&&r(e[0],t)<0&&(t=(n=[e[0],t])[0],e[0]=n[1],w(e,0,r)),t},c=function(e,t){var r,n,i,s,c,u;for(null==t&&(t=o),c=[],n=0,i=(s=function(){u=[];for(var t=0,r=a(e.length/2);0<=r?t<r:t>r;0<=r?t++:t--)u.push(t);return u}.apply(this).reverse()).length;n<i;n++)r=s[n],c.push(w(e,r,t));return c},y=function(e,t,r){var n;if(null==r&&(r=o),-1!==(n=e.indexOf(t)))return b(e,0,n,r),w(e,n,r)},g=function(e,t,r){var n,i,s,a,u;if(null==r&&(r=o),!(i=e.slice(0,t)).length)return i;for(c(i,r),s=0,a=(u=e.slice(t)).length;s<a;s++)n=u[s],d(i,n,r);return i.sort(r).reverse()},m=function(e,t,r){var n,i,s,a,l,d,h,g,m;if(null==r&&(r=o),10*t<=e.length){if(!(s=e.slice(0,t).sort(r)).length)return s;for(i=s[s.length-1],a=0,d=(h=e.slice(t)).length;a<d;a++)r(n=h[a],i)<0&&(f(s,n,0,null,r),s.pop(),i=s[s.length-1]);return s}for(c(e,r),m=[],l=0,g=p(t,e.length);0<=g?l<g:l>g;0<=g?++l:--l)m.push(u(e,r));return m},b=function(e,t,r,n){var i,s,a;for(null==n&&(n=o),i=e[r];r>t&&n(i,s=e[a=r-1>>1])<0;)e[r]=s,r=a;return e[r]=i},w=function(e,t,r){var n,i,s,a,c;for(null==r&&(r=o),i=e.length,c=t,s=e[t],n=2*t+1;n<i;)(a=n+1)<i&&!(r(e[n],e[a])<0)&&(n=a),e[t]=e[n],n=2*(t=n)+1;return e[t]=s,b(e,c,t,r)},s=function(){function e(e){this.cmp=null!=e?e:o,this.nodes=[]}return e.push=l,e.pop=u,e.replace=h,e.pushpop=d,e.heapify=c,e.updateItem=y,e.nlargest=g,e.nsmallest=m,e.prototype.push=function(e){return l(this.nodes,e,this.cmp)},e.prototype.pop=function(){return u(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return h(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return d(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return c(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return y(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return(t=new e).nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),n=[],void 0===(i="function"==typeof(r=function(){return s})?r.apply(t,n):r)||(e.exports=i)}).call(this)},2723(e,t,r){"use strict";var n=r(7952),i=r(4367),s=r(3349);function o(e){if(!(this instanceof o))return new o(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=i.toArray(e.entropy,e.entropyEnc||"hex"),r=i.toArray(e.nonce,e.nonceEnc||"hex"),n=i.toArray(e.pers,e.persEnc||"hex");s(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,r,n)}e.exports=o,o.prototype._init=function(e,t,r){var n=e.concat(t).concat(r);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var i=0;i<this.V.length;i++)this.K[i]=0,this.V[i]=1;this._update(n),this._reseed=1,this.reseedInterval=281474976710656},o.prototype._hmac=function(){return new n.hmac(this.hash,this.K)},o.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},o.prototype.reseed=function(e,t,r,n){"string"!=typeof t&&(n=r,r=t,t=null),e=i.toArray(e,t),r=i.toArray(r,n),s(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(r||[])),this._reseed=1},o.prototype.generate=function(e,t,r,n){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(n=r,r=t,t=null),r&&(r=i.toArray(r,n||"hex"),this._update(r));for(var s=[];s.length<e;)this.V=this._hmac().update(this.V).digest(),s=s.concat(this.V);var o=s.slice(0,e);return this._update(r),this._reseed++,i.encode(o,t)}},251(e,t){t.read=function(e,t,r,n,i){var s,o,a=8*i-n-1,c=(1<<a)-1,u=c>>1,l=-7,d=r?i-1:0,h=r?-1:1,f=e[t+d];for(d+=h,s=f&(1<<-l)-1,f>>=-l,l+=a;l>0;s=256*s+e[t+d],d+=h,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=n;l>0;o=256*o+e[t+d],d+=h,l-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),s-=u}return(f?-1:1)*o*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var o,a,c,u=8*s-i-1,l=(1<<u)-1,d=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(o++,c/=2),o+d>=l?(a=0,o=l):o+d>=1?(a=(t*c-1)*Math.pow(2,i),o+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[r+f]=255&o,f+=p,o/=256,u-=8);e[r+f-p]|=128*g}},6698(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},640(e){!function(t){"use strict";const r="(0?\\d+|0x[a-f0-9]+)",n={fourOctet:new RegExp(`^${r}\\.${r}\\.${r}\\.${r}$`,"i"),threeOctet:new RegExp(`^${r}\\.${r}\\.${r}$`,"i"),twoOctet:new RegExp(`^${r}\\.${r}$`,"i"),longValue:new RegExp(`^${r}$`,"i")},i=new RegExp("^0[0-7]+$","i"),s=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",c={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${r}\\.${r}\\.${r}\\.${r}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${r}\\.${r}\\.${r}\\.${r}(${o})?$`,"i")};function u(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let r,n,i=0,s=-1,o=(e.match(c.zoneIndex)||[])[0];for(o&&(o=o.substring(1),e=e.replace(/%.+$/,""));(s=e.indexOf(":",s+1))>=0;)i++;if("::"===e.substr(0,2)&&i--,"::"===e.substr(-2,2)&&i--,i>t)return null;for(n=t-i,r=":";n--;)r+="0:";return":"===(e=e.replace("::",r))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),r=[];for(let e=0;e<t.length;e++)r.push(parseInt(t[e],16));return r}(),zoneId:o}}function l(e,t,r,n){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let i,s=0;for(;n>0;){if(i=r-n,i<0&&(i=0),e[s]>>i!==t[s]>>i)return!1;n-=r,s+=1}return!0}function d(e){if(s.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(i.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function h(e,t){for(;e.length<t;)e=`0${e}`;return e}const f={};f.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,r;for(t=0;t<e.length;t++)if(r=e[t],!(0<=r&&r<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,18,0,0]),15],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]],as112:[[new e([192,175,48,0]),24],[new e([192,31,196,0]),24]],amt:[[new e([192,52,193,0]),24]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return l(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let n,i,s;for(n=3;n>=0;n-=1){if(i=this.octets[n],!(i in r))return null;if(s=r[i],t&&0!==s)return null;8!==s&&(t=!0),e+=s}return 32-e},e.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return f.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),f.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[];let s=0;for(;s<4;)i.push(parseInt(r[s],10)|255^parseInt(n[s],10)),s++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},f.IPv4.isIPv4=function(e){return null!==this.parser(e)},f.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},f.IPv4.isValidCIDR=function(e){try{return this.parseCIDR(e),!0}catch(e){return!1}},f.IPv4.isValidFourPartDecimal=function(e){return!(!f.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},f.IPv4.isValidCIDRFourPartDecimal=function(e){const t=e.match(/^(.+)\/(\d+)$/);return!(!f.IPv4.isValidCIDR(e)||!t)&&f.IPv4.isValidFourPartDecimal(t[1])},f.IPv4.networkAddressFromCIDR=function(e){let t,r,n,i,s;try{for(t=this.parseCIDR(e),n=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],r=0;r<4;)i.push(parseInt(n[r],10)&parseInt(s[r],10)),r++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},f.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},f.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const r=[this.parse(t[1]),e];return Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},f.IPv4.parser=function(e){let t,r,i;if(t=e.match(n.fourOctet))return function(){const e=t.slice(1,6),n=[];for(let t=0;t<e.length;t++)r=e[t],n.push(d(r));return n}();if(t=e.match(n.longValue)){if(i=d(t[1]),i>4294967295||i<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(i>>t&255);return e}().reverse()}return(t=e.match(n.twoOctet))?function(){const e=t.slice(1,4),r=[];if(i=d(e[1]),i>16777215||i<0)throw new Error("ipaddr: address outside defined range");return r.push(d(e[0])),r.push(i>>16&255),r.push(i>>8&255),r.push(255&i),r}():(t=e.match(n.threeOctet))?function(){const e=t.slice(1,5),r=[];if(i=d(e[2]),i>65535||i<0)throw new Error("ipaddr: address outside defined range");return r.push(d(e[0])),r.push(d(e[1])),r.push(i>>8&255),r.push(255&i),r}():null},f.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let r=0;const n=Math.floor(e/8);for(;r<n;)t[r]=255,r++;return n<4&&(t[n]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},f.IPv6=function(){function e(e,t){let r,n;if(16===e.length)for(this.parts=[],r=0;r<=14;r+=2)this.parts.push(e[r]<<8|e[r+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(r=0;r<this.parts.length;r++)if(n=this.parts[r],!(0<=n&&n<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],discard:[new e([256,0,0,0,0,0,0,0]),64],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],benchmarking:[new e([8193,2,0,0,0,0,0,0]),48],amt:[new e([8193,3,0,0,0,0,0,0]),32],as112v6:[[new e([8193,4,274,0,0,0,0,0]),48],[new e([9760,79,32768,0,0,0,0,0]),48]],deprecated:[new e([8193,16,0,0,0,0,0,0]),28],orchid2:[new e([8193,32,0,0,0,0,0,0]),28],droneRemoteIdProtocolEntityTags:[new e([8193,48,0,0,0,0,0,0]),28],reserved:[[new e([8193,0,0,0,0,0,0,0]),23],[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return l(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let n,i;for(let s=7;s>=0;s-=1){if(n=this.parts[s],!(n in r))return null;if(i=r[n],t&&0!==i)return null;16!==i&&(t=!0),e+=i}return 128-e},e.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],r=this.parts;for(let n=0;n<r.length;n++)e=r[n],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(h(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],r=e[1];return new f.IPv4([t>>8,255&t,r>>8,255&r])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let r,n=0,i=-1;for(;r=e.exec(t);)r[0].length>i&&(n=r.index,i=r[0].length);return i<0?t:`${t.substring(0,n)}::${t.substring(n+i)}`},e.prototype.toString=function(){return this.toRFC5952String()},e}(),f.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[];let s=0;for(;s<16;)i.push(parseInt(r[s],10)|255^parseInt(n[s],10)),s++;return new this(i)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},f.IPv6.isIPv6=function(e){return null!==this.parser(e)},f.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},f.IPv6.isValidCIDR=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{return this.parseCIDR(e),!0}catch(e){return!1}},f.IPv6.networkAddressFromCIDR=function(e){let t,r,n,i,s;try{for(t=this.parseCIDR(e),n=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],r=0;r<16;)i.push(parseInt(n[r],10)&parseInt(s[r],10)),r++;return new this(i)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},f.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},f.IPv6.parseCIDR=function(e){let t,r,n;if((r=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(r[2]),t>=0&&t<=128))return n=[this.parse(r[1]),t],Object.defineProperty(n,"toString",{value:function(){return this.join("/")}}),n;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},f.IPv6.parser=function(e){let t,r,n,i,s,o;if(n=e.match(c.deprecatedTransitional))return this.parser(`::ffff:${n[1]}`);if(c.native.test(e))return u(e,8);if((n=e.match(c.transitional))&&(o=n[6]||"",t=n[1],n[1].endsWith("::")||(t=t.slice(0,-1)),t=u(t+o,6),t.parts)){for(s=[parseInt(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5])],r=0;r<s.length;r++)if(i=s[r],!(0<=i&&i<=255))return null;return t.parts.push(s[0]<<8|s[1]),t.parts.push(s[2]<<8|s[3]),{parts:t.parts,zoneId:t.zoneId}}return null},f.IPv6.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let r=0;const n=Math.floor(e/8);for(;r<n;)t[r]=255,r++;return n<16&&(t[n]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},f.fromByteArray=function(e){const t=e.length;if(4===t)return new f.IPv4(e);if(16===t)return new f.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},f.isValid=function(e){return f.IPv6.isValid(e)||f.IPv4.isValid(e)},f.isValidCIDR=function(e){return f.IPv6.isValidCIDR(e)||f.IPv4.isValidCIDR(e)},f.parse=function(e){if(f.IPv6.isValid(e))return f.IPv6.parse(e);if(f.IPv4.isValid(e))return f.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},f.parseCIDR=function(e){try{return f.IPv6.parseCIDR(e)}catch(t){try{return f.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},f.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},f.subnetMatch=function(e,t,r){let n,i,s,o;for(i in null==r&&(r="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,i))for(s=t[i],!s[0]||s[0]instanceof Array||(s=[s]),n=0;n<s.length;n++)if(o=s[n],e.kind()===o[0].kind()&&e.match.apply(e,o))return i;return r},e.exports?e.exports=f:t.ipaddr=f}(this)},9600(e){"use strict";var t,r,n=Function.prototype.toString,i="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof i&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw r}}),r={},i(function(){throw 42},null,t)}catch(e){e!==r&&(i=null)}else i=null;var s=/^\s*class\b/,o=function(e){try{var t=n.call(e);return s.test(t)}catch(e){return!1}},a=function(e){try{return!o(e)&&(n.call(e),!0)}catch(e){return!1}},c=Object.prototype.toString,u="function"==typeof Symbol&&!!Symbol.toStringTag,l=!(0 in[,]),d=function(){return!1};if("object"==typeof document){var h=document.all;c.call(h)===c.call(document.all)&&(d=function(e){if((l||!e)&&(void 0===e||"object"==typeof e))try{var t=c.call(e);return("[object HTMLAllCollection]"===t||"[object HTML document.all class]"===t||"[object HTMLCollection]"===t||"[object Object]"===t)&&null==e("")}catch(e){}return!1})}e.exports=i?function(e){if(d(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;try{i(e,null,t)}catch(e){if(e!==r)return!1}return!o(e)&&a(e)}:function(e){if(d(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(u)return a(e);if(o(e))return!1;var t=c.call(e);return!("[object Function]"!==t&&"[object GeneratorFunction]"!==t&&!/^\[object HTML/.test(t))&&a(e)}},5680(e,t,r){"use strict";var n=r(5767);e.exports=function(e){return!!n(e)}},4634(e){var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},9971(e,t,r){"use strict";const n=r(3209),{EventEmitter:i}=r(7007);function s(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function o(e,t){if(!(t instanceof Uint8Array))throw new TypeError(e+" is not a Uint8Array")}class a extends i{constructor(e={}){super(),this.localNodeId=e.localNodeId||n(20),this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||a.distance,this.arbiter=e.arbiter||a.arbiter,this.metadata=Object.assign({},e.metadata),o("option.localNodeId as parameter 1",this.localNodeId),this.root={contacts:[],dontSplit:!1,left:null,right:null}}static arbiter(e,t){return e.vectorClock>t.vectorClock?e:t}static distance(e,t){let r=0,n=0;const i=Math.min(e.length,t.length),s=Math.max(e.length,t.length);for(;n<i;++n)r=256*r+(e[n]^t[n]);for(;n<s;++n)r=256*r+255;return r}add(e){o("contact.id",(e||{}).id);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e.id,t++);const n=this._indexOf(r,e.id);return n>=0?(this._update(r,n,e),this):r.contacts.length<this.numberOfNodesPerKBucket?(r.contacts.push(e),this.emit("added",e),this):r.dontSplit?(this.emit("ping",r.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(r,t),this.add(e))}closest(e,t=1/0){if(o("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let r=[];for(let n=[this.root],i=0;n.length>0&&r.length<t;){const t=n.pop();if(null===t.contacts){const r=this._determineNode(t,e,i++);n.push(t.left===r?t.right:t.left),n.push(r)}else r=r.concat(t.contacts)}return r.map(t=>[this.distance(t.id,e),t]).sort((e,t)=>e[0]-t[0]).slice(0,t).map(e=>e[1])}count(){let e=0;for(const t=[this.root];t.length>0;){const r=t.pop();null===r.contacts?t.push(r.right,r.left):e+=r.contacts.length}return e}_determineNode(e,t,r){const n=r>>3,i=r%8;return t.length<=n&&0!==i?e.left:t[n]&1<<7-i?e.right:e.left}get(e){o("id",e);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);return n>=0?r.contacts[n]:null}_indexOf(e,t){for(let r=0;r<e.contacts.length;++r)if(s(e.contacts[r].id,t))return r;return-1}remove(e){o("the id as parameter 1",e);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);if(n>=0){const e=r.contacts.splice(n,1)[0];this.emit("removed",e)}return this}_split(e,t){e.left={contacts:[],dontSplit:!1,left:null,right:null},e.right={contacts:[],dontSplit:!1,left:null,right:null};for(const r of e.contacts)this._determineNode(e,r.id,t).contacts.push(r);e.contacts=null;const r=this._determineNode(e,this.localNodeId,t);(e.left===r?e.right:e.left).dontSplit=!0}toArray(){let e=[];for(const t=[this.root];t.length>0;){const r=t.pop();null===r.contacts?t.push(r.right,r.left):e=e.concat(r.contacts)}return e}*toIterable(){for(const e=[this.root];e.length>0;){const t=e.pop();null===t.contacts?e.push(t.right,t.left):yield*t.contacts}}_update(e,t,r){if(!s(e.contacts[t].id,r.id))throw new Error("wrong index for _update");const n=e.contacts[t],i=this.arbiter(n,r);i===n&&n!==r||(e.contacts.splice(t,1),e.contacts.push(i),this.emit("updated",n,i))}}e.exports=a},5580(e,t,r){var n=r(6110)(r(9325),"DataView");e.exports=n},1549(e,t,r){var n=r(9651),i=r(3862),s=r(6721),o=r(2749),a=r(5749);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=i,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},79(e,t,r){var n=r(3702),i=r(80),s=r(4739),o=r(8655),a=r(1175);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=i,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},8223(e,t,r){var n=r(6110)(r(9325),"Map");e.exports=n},3661(e,t,r){var n=r(3040),i=r(7670),s=r(289),o=r(4509),a=r(2949);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=i,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},2804(e,t,r){var n=r(6110)(r(9325),"Promise");e.exports=n},6545(e,t,r){var n=r(6110)(r(9325),"Set");e.exports=n},8859(e,t,r){var n=r(3661),i=r(1380),s=r(1459);function o(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new n;++t<r;)this.add(e[t])}o.prototype.add=o.prototype.push=i,o.prototype.has=s,e.exports=o},7217(e,t,r){var n=r(79),i=r(1420),s=r(938),o=r(3605),a=r(9817),c=r(945);function u(e){var t=this.__data__=new n(e);this.size=t.size}u.prototype.clear=i,u.prototype.delete=s,u.prototype.get=o,u.prototype.has=a,u.prototype.set=c,e.exports=u},1873(e,t,r){var n=r(9325).Symbol;e.exports=n},7828(e,t,r){var n=r(9325).Uint8Array;e.exports=n},8303(e,t,r){var n=r(6110)(r(9325),"WeakMap");e.exports=n},1033(e){e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},3729(e){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},9770(e){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s}},5325(e,t,r){var n=r(6131);e.exports=function(e,t){return!(null==e||!e.length)&&n(e,t,0)>-1}},9905(e){e.exports=function(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}},695(e,t,r){var n=r(8096),i=r(2428),s=r(6449),o=r(3656),a=r(361),c=r(7167),u=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=s(e),l=!r&&i(e),d=!r&&!l&&o(e),h=!r&&!l&&!d&&c(e),f=r||l||d||h,p=f?n(e.length,String):[],g=p.length;for(var m in e)!t&&!u.call(e,m)||f&&("length"==m||d&&("offset"==m||"parent"==m)||h&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||a(m,g))||p.push(m);return p}},4932(e){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}},4528(e){e.exports=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}},3390(e,t,r){var n=r(3195);e.exports=function(e){var t=e.length;return t?e[n(0,t-1)]:void 0}},4435(e,t,r){var n=r(7133),i=r(3007),s=r(7410);e.exports=function(e,t){return s(i(e),n(t,0,e.length))}},8567(e,t,r){var n=r(3007),i=r(7410);e.exports=function(e){return i(n(e))}},4248(e){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},9811(e,t,r){var n=r(7237)("length");e.exports=n},1074(e){e.exports=function(e){return e.split("")}},7805(e,t,r){var n=r(3360),i=r(5288);e.exports=function(e,t,r){(void 0!==r&&!i(e[t],r)||void 0===r&&!(t in e))&&n(e,t,r)}},6547(e,t,r){var n=r(3360),i=r(5288),s=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var o=e[t];s.call(e,t)&&i(o,r)&&(void 0!==r||t in e)||n(e,t,r)}},6025(e,t,r){var n=r(5288);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},4733(e,t,r){var n=r(1791),i=r(5950);e.exports=function(e,t){return e&&n(t,i(t),e)}},3838(e,t,r){var n=r(1791),i=r(7241);e.exports=function(e,t){return e&&n(t,i(t),e)}},3360(e,t,r){var n=r(3243);e.exports=function(e,t,r){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},7133(e){e.exports=function(e,t,r){return e==e&&(void 0!==r&&(e=e<=r?e:r),void 0!==t&&(e=e>=t?e:t)),e}},9999(e,t,r){var n=r(7217),i=r(3729),s=r(6547),o=r(4733),a=r(3838),c=r(3290),u=r(3007),l=r(2271),d=r(6567),h=r(2),f=r(5730),p=r(5861),g=r(6189),m=r(7199),y=r(5529),b=r(6449),w=r(3656),v=r(7730),E=r(3805),A=r(8440),S=r(5950),k=r(7241),R="[object Arguments]",P="[object Function]",I="[object Object]",C={};C[R]=C["[object Array]"]=C["[object ArrayBuffer]"]=C["[object DataView]"]=C["[object Boolean]"]=C["[object Date]"]=C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Map]"]=C["[object Number]"]=C[I]=C["[object RegExp]"]=C["[object Set]"]=C["[object String]"]=C["[object Symbol]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C["[object Error]"]=C[P]=C["[object WeakMap]"]=!1,e.exports=function e(t,r,_,T,N,x){var O,D=1&r,M=2&r,B=4&r;if(_&&(O=N?_(t,T,N,x):_(t)),void 0!==O)return O;if(!E(t))return t;var L=b(t);if(L){if(O=g(t),!D)return u(t,O)}else{var F=p(t),U=F==P||"[object GeneratorFunction]"==F;if(w(t))return c(t,D);if(F==I||F==R||U&&!N){if(O=M||U?{}:y(t),!D)return M?d(t,a(O,t)):l(t,o(O,t))}else{if(!C[F])return N?t:{};O=m(t,F,D)}}x||(x=new n);var j=x.get(t);if(j)return j;x.set(t,O),A(t)?t.forEach(function(n){O.add(e(n,r,_,n,t,x))}):v(t)&&t.forEach(function(n,i){O.set(i,e(n,r,_,i,t,x))});var z=L?void 0:(B?M?f:h:M?k:S)(t);return i(z||t,function(n,i){z&&(n=t[i=n]),s(O,i,e(n,r,_,i,t,x))}),O}},9344(e,t,r){var n=r(3805),i=Object.create,s=function(){function e(){}return function(t){if(!n(t))return{};if(i)return i(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=s},3915(e,t,r){var n=r(8859),i=r(5325),s=r(9905),o=r(4932),a=r(7301),c=r(9219);e.exports=function(e,t,r,u){var l=-1,d=i,h=!0,f=e.length,p=[],g=t.length;if(!f)return p;r&&(t=o(t,a(r))),u?(d=s,h=!1):t.length>=200&&(d=c,h=!1,t=new n(t));e:for(;++l<f;){var m=e[l],y=null==r?m:r(m);if(m=u||0!==m?m:0,h&&y==y){for(var b=g;b--;)if(t[b]===y)continue e;p.push(m)}else d(t,y,u)||p.push(m)}return p}},3599(e,t,r){var n=r(4394);e.exports=function(e,t,r){for(var i=-1,s=e.length;++i<s;){var o=e[i],a=t(o);if(null!=a&&(void 0===c?a==a&&!n(a):r(a,c)))var c=a,u=o}return u}},2523(e){e.exports=function(e,t,r,n){for(var i=e.length,s=r+(n?1:-1);n?s--:++s<i;)if(t(e[s],s,e))return s;return-1}},3120(e,t,r){var n=r(4528),i=r(5891);e.exports=function e(t,r,s,o,a){var c=-1,u=t.length;for(s||(s=i),a||(a=[]);++c<u;){var l=t[c];r>0&&s(l)?r>1?e(l,r-1,s,o,a):n(a,l):o||(a[a.length]=l)}return a}},6649(e,t,r){var n=r(3221)();e.exports=n},7422(e,t,r){var n=r(1769),i=r(7797);e.exports=function(e,t){for(var r=0,s=(t=n(t,e)).length;null!=e&&r<s;)e=e[i(t[r++])];return r&&r==s?e:void 0}},2199(e,t,r){var n=r(4528),i=r(6449);e.exports=function(e,t,r){var s=t(e);return i(e)?s:n(s,r(e))}},2552(e,t,r){var n=r(1873),i=r(659),s=r(9350),o=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?i(e):s(e)}},8077(e){e.exports=function(e,t){return null!=e&&t in Object(e)}},6131(e,t,r){var n=r(2523),i=r(5463),s=r(6959);e.exports=function(e,t,r){return t==t?s(e,t,r):n(e,i,r)}},2027(e){e.exports=function(e,t,r,n){for(var i=r-1,s=e.length;++i<s;)if(n(e[i],t))return i;return-1}},7185(e,t,r){var n=r(8859),i=r(5325),s=r(9905),o=r(4932),a=r(7301),c=r(9219),u=Math.min;e.exports=function(e,t,r){for(var l=r?s:i,d=e[0].length,h=e.length,f=h,p=Array(h),g=1/0,m=[];f--;){var y=e[f];f&&t&&(y=o(y,a(t))),g=u(y.length,g),p[f]=!r&&(t||d>=120&&y.length>=120)?new n(f&&y):void 0}y=e[0];var b=-1,w=p[0];e:for(;++b<d&&m.length<g;){var v=y[b],E=t?t(v):v;if(v=r||0!==v?v:0,!(w?c(w,E):l(m,E,r))){for(f=h;--f;){var A=p[f];if(!(A?c(A,E):l(e[f],E,r)))continue e}w&&w.push(E),m.push(v)}}return m}},7534(e,t,r){var n=r(2552),i=r(346);e.exports=function(e){return i(e)&&"[object Arguments]"==n(e)}},270(e,t,r){var n=r(7068),i=r(346);e.exports=function e(t,r,s,o,a){return t===r||(null==t||null==r||!i(t)&&!i(r)?t!=t&&r!=r:n(t,r,s,o,e,a))}},7068(e,t,r){var n=r(7217),i=r(5911),s=r(1986),o=r(689),a=r(5861),c=r(6449),u=r(3656),l=r(7167),d="[object Arguments]",h="[object Array]",f="[object Object]",p=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,g,m,y){var b=c(e),w=c(t),v=b?h:a(e),E=w?h:a(t),A=(v=v==d?f:v)==f,S=(E=E==d?f:E)==f,k=v==E;if(k&&u(e)){if(!u(t))return!1;b=!0,A=!1}if(k&&!A)return y||(y=new n),b||l(e)?i(e,t,r,g,m,y):s(e,t,v,r,g,m,y);if(!(1&r)){var R=A&&p.call(e,"__wrapped__"),P=S&&p.call(t,"__wrapped__");if(R||P){var I=R?e.value():e,C=P?t.value():t;return y||(y=new n),m(I,C,r,g,y)}}return!!k&&(y||(y=new n),o(e,t,r,g,m,y))}},9172(e,t,r){var n=r(5861),i=r(346);e.exports=function(e){return i(e)&&"[object Map]"==n(e)}},1799(e,t,r){var n=r(7217),i=r(270);e.exports=function(e,t,r,s){var o=r.length,a=o,c=!s;if(null==e)return!a;for(e=Object(e);o--;){var u=r[o];if(c&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++o<a;){var l=(u=r[o])[0],d=e[l],h=u[1];if(c&&u[2]){if(void 0===d&&!(l in e))return!1}else{var f=new n;if(s)var p=s(d,h,l,e,t,f);if(!(void 0===p?i(h,d,3,s,f):p))return!1}}return!0}},5463(e){e.exports=function(e){return e!=e}},5083(e,t,r){var n=r(1882),i=r(7296),s=r(3805),o=r(7473),a=/^\[object .+?Constructor\]$/,c=Function.prototype,u=Object.prototype,l=c.toString,d=u.hasOwnProperty,h=RegExp("^"+l.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!s(e)||i(e))&&(n(e)?h:a).test(o(e))}},6038(e,t,r){var n=r(5861),i=r(346);e.exports=function(e){return i(e)&&"[object Set]"==n(e)}},4901(e,t,r){var n=r(2552),i=r(294),s=r(346),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return s(e)&&i(e.length)&&!!o[n(e)]}},5389(e,t,r){var n=r(3663),i=r(7978),s=r(3488),o=r(6449),a=r(583);e.exports=function(e){return"function"==typeof e?e:null==e?s:"object"==typeof e?o(e)?i(e[0],e[1]):n(e):a(e)}},8984(e,t,r){var n=r(5527),i=r(3650),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=[];for(var r in Object(e))s.call(e,r)&&"constructor"!=r&&t.push(r);return t}},2903(e,t,r){var n=r(3805),i=r(5527),s=r(181),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return s(e);var t=i(e),r=[];for(var a in e)("constructor"!=a||!t&&o.call(e,a))&&r.push(a);return r}},6176(e){e.exports=function(e,t){return e<t}},3663(e,t,r){var n=r(1799),i=r(776),s=r(7197);e.exports=function(e){var t=i(e);return 1==t.length&&t[0][2]?s(t[0][0],t[0][1]):function(r){return r===e||n(r,e,t)}}},7978(e,t,r){var n=r(270),i=r(8156),s=r(631),o=r(8586),a=r(756),c=r(7197),u=r(7797);e.exports=function(e,t){return o(e)&&a(t)?c(u(e),t):function(r){var o=i(r,e);return void 0===o&&o===t?s(r,e):n(t,o,3)}}},5250(e,t,r){var n=r(7217),i=r(7805),s=r(6649),o=r(2824),a=r(3805),c=r(7241),u=r(4974);e.exports=function e(t,r,l,d,h){t!==r&&s(r,function(s,c){if(h||(h=new n),a(s))o(t,r,c,l,e,d,h);else{var f=d?d(u(t,c),s,c+"",t,r,h):void 0;void 0===f&&(f=s),i(t,c,f)}},c)}},2824(e,t,r){var n=r(7805),i=r(3290),s=r(1961),o=r(3007),a=r(5529),c=r(2428),u=r(6449),l=r(3693),d=r(3656),h=r(1882),f=r(3805),p=r(1331),g=r(7167),m=r(4974),y=r(9884);e.exports=function(e,t,r,b,w,v,E){var A=m(e,r),S=m(t,r),k=E.get(S);if(k)n(e,r,k);else{var R=v?v(A,S,r+"",e,t,E):void 0,P=void 0===R;if(P){var I=u(S),C=!I&&d(S),_=!I&&!C&&g(S);R=S,I||C||_?u(A)?R=A:l(A)?R=o(A):C?(P=!1,R=i(S,!0)):_?(P=!1,R=s(S,!0)):R=[]:p(S)||c(S)?(R=A,c(A)?R=y(A):f(A)&&!h(A)||(R=a(S))):P=!1}P&&(E.set(S,R),w(R,S,b,v,E),E.delete(S)),n(e,r,R)}}},7237(e){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},7255(e,t,r){var n=r(7422);e.exports=function(e){return function(t){return n(t,e)}}},1988(e,t,r){var n=r(4932),i=r(6131),s=r(2027),o=r(7301),a=r(3007),c=Array.prototype.splice;e.exports=function(e,t,r,u){var l=u?s:i,d=-1,h=t.length,f=e;for(e===t&&(t=a(t)),r&&(f=n(e,o(r)));++d<h;)for(var p=0,g=t[d],m=r?r(g):g;(p=l(f,m,p,u))>-1;)f!==e&&c.call(f,p,1),c.call(e,p,1);return e}},306(e,t,r){var n=r(9931),i=r(361),s=Array.prototype.splice;e.exports=function(e,t){for(var r=e?t.length:0,o=r-1;r--;){var a=t[r];if(r==o||a!==c){var c=a;i(a)?s.call(e,a,1):n(e,a)}}return e}},3195(e){var t=Math.floor,r=Math.random;e.exports=function(e,n){return e+t(r()*(n-e+1))}},6151(e){var t=Math.ceil,r=Math.max;e.exports=function(e,n,i,s){for(var o=-1,a=r(t((n-e)/(i||1)),0),c=Array(a);a--;)c[s?a:++o]=e,e+=i;return c}},4051(e){var t=Math.floor;e.exports=function(e,r){var n="";if(!e||r<1||r>9007199254740991)return n;do{r%2&&(n+=e),(r=t(r/2))&&(e+=e)}while(r);return n}},9302(e,t,r){var n=r(3488),i=r(6757),s=r(2865);e.exports=function(e,t){return s(i(e,t,n),e+"")}},8170(e,t,r){var n=r(3390),i=r(3499);e.exports=function(e){return n(i(e))}},9095(e,t,r){var n=r(7133),i=r(7410),s=r(3499);e.exports=function(e,t){var r=s(e);return i(r,n(t,0,r.length))}},3170(e,t,r){var n=r(6547),i=r(1769),s=r(361),o=r(3805),a=r(7797);e.exports=function(e,t,r,c){if(!o(e))return e;for(var u=-1,l=(t=i(t,e)).length,d=l-1,h=e;null!=h&&++u<l;){var f=a(t[u]),p=r;if("__proto__"===f||"constructor"===f||"prototype"===f)return e;if(u!=d){var g=h[f];void 0===(p=c?c(g,f,h):void 0)&&(p=o(g)?g:s(t[u+1])?[]:{})}n(h,f,p),h=h[f]}return e}},9570(e,t,r){var n=r(7334),i=r(3243),s=r(3488),o=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:s;e.exports=o},4171(e,t,r){var n=r(7410),i=r(3499);e.exports=function(e){return n(i(e))}},5160(e){e.exports=function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}},4116(e,t,r){var n=r(4394),i=Math.floor,s=Math.min;e.exports=function(e,t,r,o){var a=0,c=null==e?0:e.length;if(0===c)return 0;for(var u=(t=r(t))!=t,l=null===t,d=n(t),h=void 0===t;a<c;){var f=i((a+c)/2),p=r(e[f]),g=void 0!==p,m=null===p,y=p==p,b=n(p);if(u)var w=o||y;else w=h?y&&(o||g):l?y&&g&&(o||!m):d?y&&g&&!m&&(o||!b):!m&&!b&&(o?p<=t:p<t);w?a=f+1:c=f}return s(c,4294967294)}},8096(e){e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},7556(e,t,r){var n=r(1873),i=r(4932),s=r(6449),o=r(4394),a=n?n.prototype:void 0,c=a?a.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(s(t))return i(t,e)+"";if(o(t))return c?c.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r}},4128(e,t,r){var n=r(1800),i=/^\s+/;e.exports=function(e){return e?e.slice(0,n(e)+1).replace(i,""):e}},7301(e){e.exports=function(e){return function(t){return e(t)}}},5765(e,t,r){var n=r(8859),i=r(5325),s=r(9905),o=r(9219),a=r(4517),c=r(4247);e.exports=function(e,t,r){var u=-1,l=i,d=e.length,h=!0,f=[],p=f;if(r)h=!1,l=s;else if(d>=200){var g=t?null:a(e);if(g)return c(g);h=!1,l=o,p=new n}else p=t?[]:f;e:for(;++u<d;){var m=e[u],y=t?t(m):m;if(m=r||0!==m?m:0,h&&y==y){for(var b=p.length;b--;)if(p[b]===y)continue e;t&&p.push(y),f.push(m)}else l(p,y,r)||(p!==f&&p.push(y),f.push(m))}return f}},9931(e,t,r){var n=r(1769),i=r(8090),s=r(8969),o=r(7797),a=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=-1,c=(t=n(t,e)).length;if(!c)return!0;for(var u=null==e||"object"!=typeof e&&"function"!=typeof e;++r<c;){var l=t[r];if("string"==typeof l){if("__proto__"===l&&!a.call(e,"__proto__"))return!1;if("constructor"===l&&r+1<c&&"string"==typeof t[r+1]&&"prototype"===t[r+1]){if(u&&0===r)continue;return!1}}}var d=s(e,t);return null==d||delete d[o(i(t))]}},514(e,t,r){var n=r(4932);e.exports=function(e,t){return n(t,function(t){return e[t]})}},9219(e){e.exports=function(e,t){return e.has(t)}},741(e,t,r){var n=r(3693);e.exports=function(e){return n(e)?e:[]}},1769(e,t,r){var n=r(6449),i=r(8586),s=r(1802),o=r(3222);e.exports=function(e,t){return n(e)?e:i(e,t)?[e]:s(o(e))}},8754(e,t,r){var n=r(5160);e.exports=function(e,t,r){var i=e.length;return r=void 0===r?i:r,!t&&r>=i?e:n(e,t,r)}},9653(e,t,r){var n=r(7828);e.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},3290(e,t,r){e=r.nmd(e);var n=r(9325),i=t&&!t.nodeType&&t,s=i&&e&&!e.nodeType&&e,o=s&&s.exports===i?n.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}},6169(e,t,r){var n=r(9653);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},3201(e){var t=/\w*$/;e.exports=function(e){var r=new e.constructor(e.source,t.exec(e));return r.lastIndex=e.lastIndex,r}},3736(e,t,r){var n=r(1873),i=n?n.prototype:void 0,s=i?i.valueOf:void 0;e.exports=function(e){return s?Object(s.call(e)):{}}},1961(e,t,r){var n=r(9653);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},3007(e){e.exports=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}},1791(e,t,r){var n=r(6547),i=r(3360);e.exports=function(e,t,r,s){var o=!r;r||(r={});for(var a=-1,c=t.length;++a<c;){var u=t[a],l=s?s(r[u],e[u],u,r,e):void 0;void 0===l&&(l=e[u]),o?i(r,u,l):n(r,u,l)}return r}},2271(e,t,r){var n=r(1791),i=r(4664);e.exports=function(e,t){return n(e,i(e),t)}},6567(e,t,r){var n=r(1791),i=r(6375);e.exports=function(e,t){return n(e,i(e),t)}},5481(e,t,r){var n=r(9325)["__core-js_shared__"];e.exports=n},999(e,t,r){var n=r(9302),i=r(6800);e.exports=function(e){return n(function(t,r){var n=-1,s=r.length,o=s>1?r[s-1]:void 0,a=s>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(s--,o):void 0,a&&i(r[0],r[1],a)&&(o=s<3?void 0:o,s=1),t=Object(t);++n<s;){var c=r[n];c&&e(t,c,n,o)}return t})}},3221(e){e.exports=function(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===r(s[c],c,s))break}return t}}},7216(e,t,r){var n=r(4051),i=r(7556),s=r(8754),o=r(9698),a=r(1993),c=r(3912),u=Math.ceil;e.exports=function(e,t){var r=(t=void 0===t?" ":i(t)).length;if(r<2)return r?n(t,e):t;var l=n(t,u(e/a(t)));return o(t)?s(c(l),0,e).join(""):l.slice(0,e)}},5508(e,t,r){var n=r(6151),i=r(6800),s=r(7400);e.exports=function(e){return function(t,r,o){return o&&"number"!=typeof o&&i(t,r,o)&&(r=o=void 0),t=s(t),void 0===r?(r=t,t=0):r=s(r),o=void 0===o?t<r?1:-1:s(o),n(t,r,o,e)}}},4517(e,t,r){var n=r(6545),i=r(3950),s=r(4247),o=n&&1/s(new n([,-0]))[1]==1/0?function(e){return new n(e)}:i;e.exports=o},3138(e,t,r){var n=r(1331);e.exports=function(e){return n(e)?void 0:e}},3243(e,t,r){var n=r(6110),i=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},5911(e,t,r){var n=r(8859),i=r(4248),s=r(9219);e.exports=function(e,t,r,o,a,c){var u=1&r,l=e.length,d=t.length;if(l!=d&&!(u&&d>l))return!1;var h=c.get(e),f=c.get(t);if(h&&f)return h==t&&f==e;var p=-1,g=!0,m=2&r?new n:void 0;for(c.set(e,t),c.set(t,e);++p<l;){var y=e[p],b=t[p];if(o)var w=u?o(b,y,p,t,e,c):o(y,b,p,e,t,c);if(void 0!==w){if(w)continue;g=!1;break}if(m){if(!i(t,function(e,t){if(!s(m,t)&&(y===e||a(y,e,r,o,c)))return m.push(t)})){g=!1;break}}else if(y!==b&&!a(y,b,r,o,c)){g=!1;break}}return c.delete(e),c.delete(t),g}},1986(e,t,r){var n=r(1873),i=r(7828),s=r(5288),o=r(5911),a=r(317),c=r(4247),u=n?n.prototype:void 0,l=u?u.valueOf:void 0;e.exports=function(e,t,r,n,u,d,h){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!d(new i(e),new i(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return s(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var f=a;case"[object Set]":var p=1&n;if(f||(f=c),e.size!=t.size&&!p)return!1;var g=h.get(e);if(g)return g==t;n|=2,h.set(e,t);var m=o(f(e),f(t),n,u,d,h);return h.delete(e),m;case"[object Symbol]":if(l)return l.call(e)==l.call(t)}return!1}},689(e,t,r){var n=r(2),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,s,o,a){var c=1&r,u=n(e),l=u.length;if(l!=n(t).length&&!c)return!1;for(var d=l;d--;){var h=u[d];if(!(c?h in t:i.call(t,h)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var g=!0;a.set(e,t),a.set(t,e);for(var m=c;++d<l;){var y=e[h=u[d]],b=t[h];if(s)var w=c?s(b,y,h,t,e,a):s(y,b,h,e,t,a);if(!(void 0===w?y===b||o(y,b,r,s,a):w)){g=!1;break}m||(m="constructor"==h)}if(g&&!m){var v=e.constructor,E=t.constructor;v==E||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof E&&E instanceof E||(g=!1)}return a.delete(e),a.delete(t),g}},8816(e,t,r){var n=r(5970),i=r(6757),s=r(2865);e.exports=function(e){return s(i(e,void 0,n),e+"")}},4840(e,t,r){var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=n},2(e,t,r){var n=r(2199),i=r(4664),s=r(5950);e.exports=function(e){return n(e,s,i)}},5730(e,t,r){var n=r(2199),i=r(6375),s=r(7241);e.exports=function(e){return n(e,s,i)}},2651(e,t,r){var n=r(4218);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},776(e,t,r){var n=r(756),i=r(5950);e.exports=function(e){for(var t=i(e),r=t.length;r--;){var s=t[r],o=e[s];t[r]=[s,o,n(o)]}return t}},6110(e,t,r){var n=r(5083),i=r(8011);e.exports=function(e,t){var r=i(e,t);return n(r)?r:void 0}},8879(e,t,r){var n=r(4335)(Object.getPrototypeOf,Object);e.exports=n},659(e,t,r){var n=r(1873),i=Object.prototype,s=i.hasOwnProperty,o=i.toString,a=n?n.toStringTag:void 0;e.exports=function(e){var t=s.call(e,a),r=e[a];try{e[a]=void 0;var n=!0}catch(e){}var i=o.call(e);return n&&(t?e[a]=r:delete e[a]),i}},4664(e,t,r){var n=r(9770),i=r(3345),s=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(e){return null==e?[]:(e=Object(e),n(o(e),function(t){return s.call(e,t)}))}:i;e.exports=a},6375(e,t,r){var n=r(4528),i=r(8879),s=r(4664),o=r(3345),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,s(e)),e=i(e);return t}:o;e.exports=a},5861(e,t,r){var n=r(5580),i=r(8223),s=r(2804),o=r(6545),a=r(8303),c=r(2552),u=r(7473),l="[object Map]",d="[object Promise]",h="[object Set]",f="[object WeakMap]",p="[object DataView]",g=u(n),m=u(i),y=u(s),b=u(o),w=u(a),v=c;(n&&v(new n(new ArrayBuffer(1)))!=p||i&&v(new i)!=l||s&&v(s.resolve())!=d||o&&v(new o)!=h||a&&v(new a)!=f)&&(v=function(e){var t=c(e),r="[object Object]"==t?e.constructor:void 0,n=r?u(r):"";if(n)switch(n){case g:return p;case m:return l;case y:return d;case b:return h;case w:return f}return t}),e.exports=v},8011(e){e.exports=function(e,t){return null==e?void 0:e[t]}},9326(e,t,r){var n=r(1769),i=r(2428),s=r(6449),o=r(361),a=r(294),c=r(7797);e.exports=function(e,t,r){for(var u=-1,l=(t=n(t,e)).length,d=!1;++u<l;){var h=c(t[u]);if(!(d=null!=e&&r(e,h)))break;e=e[h]}return d||++u!=l?d:!!(l=null==e?0:e.length)&&a(l)&&o(h,l)&&(s(e)||i(e))}},9698(e){var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},9651(e,t,r){var n=r(1042);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},3862(e){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},6721(e,t,r){var n=r(1042),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return i.call(t,e)?t[e]:void 0}},2749(e,t,r){var n=r(1042),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:i.call(t,e)}},5749(e,t,r){var n=r(1042);e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?"__lodash_hash_undefined__":t,this}},6189(e){var t=Object.prototype.hasOwnProperty;e.exports=function(e){var r=e.length,n=new e.constructor(r);return r&&"string"==typeof e[0]&&t.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},7199(e,t,r){var n=r(9653),i=r(6169),s=r(3201),o=r(3736),a=r(1961);e.exports=function(e,t,r){var c=e.constructor;switch(t){case"[object ArrayBuffer]":return n(e);case"[object Boolean]":case"[object Date]":return new c(+e);case"[object DataView]":return i(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return a(e,r);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(e);case"[object RegExp]":return s(e);case"[object Symbol]":return o(e)}}},5529(e,t,r){var n=r(9344),i=r(8879),s=r(5527);e.exports=function(e){return"function"!=typeof e.constructor||s(e)?{}:n(i(e))}},5891(e,t,r){var n=r(1873),i=r(2428),s=r(6449),o=n?n.isConcatSpreadable:void 0;e.exports=function(e){return s(e)||i(e)||!!(o&&e&&e[o])}},361(e){var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var n=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<r}},6800(e,t,r){var n=r(5288),i=r(4894),s=r(361),o=r(3805);e.exports=function(e,t,r){if(!o(r))return!1;var a=typeof t;return!!("number"==a?i(r)&&s(t,r.length):"string"==a&&t in r)&&n(r[t],e)}},8586(e,t,r){var n=r(6449),i=r(4394),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;e.exports=function(e,t){if(n(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!i(e))||o.test(e)||!s.test(e)||null!=t&&e in Object(t)}},4218(e){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},7296(e,t,r){var n,i=r(5481),s=(n=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!s&&s in e}},5527(e){var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},756(e,t,r){var n=r(3805);e.exports=function(e){return e==e&&!n(e)}},3702(e){e.exports=function(){this.__data__=[],this.size=0}},80(e,t,r){var n=r(6025),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0||(r==t.length-1?t.pop():i.call(t,r,1),--this.size,0))}},4739(e,t,r){var n=r(6025);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},8655(e,t,r){var n=r(6025);e.exports=function(e){return n(this.__data__,e)>-1}},1175(e,t,r){var n=r(6025);e.exports=function(e,t){var r=this.__data__,i=n(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this}},3040(e,t,r){var n=r(1549),i=r(79),s=r(8223);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(s||i),string:new n}}},7670(e,t,r){var n=r(2651);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},289(e,t,r){var n=r(2651);e.exports=function(e){return n(this,e).get(e)}},4509(e,t,r){var n=r(2651);e.exports=function(e){return n(this,e).has(e)}},2949(e,t,r){var n=r(2651);e.exports=function(e,t){var r=n(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this}},317(e){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}},7197(e){e.exports=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}}},2224(e,t,r){var n=r(104);e.exports=function(e){var t=n(e,function(e){return 500===r.size&&r.clear(),e}),r=t.cache;return t}},1042(e,t,r){var n=r(6110)(Object,"create");e.exports=n},3650(e,t,r){var n=r(4335)(Object.keys,Object);e.exports=n},181(e){e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},6009(e,t,r){e=r.nmd(e);var n=r(4840),i=t&&!t.nodeType&&t,s=i&&e&&!e.nodeType&&e,o=s&&s.exports===i&&n.process,a=function(){try{return s&&s.require&&s.require("util").types||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a},9350(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},4335(e){e.exports=function(e,t){return function(r){return e(t(r))}}},6757(e,t,r){var n=r(1033),i=Math.max;e.exports=function(e,t,r){return t=i(void 0===t?e.length-1:t,0),function(){for(var s=arguments,o=-1,a=i(s.length-t,0),c=Array(a);++o<a;)c[o]=s[t+o];o=-1;for(var u=Array(t+1);++o<t;)u[o]=s[o];return u[t]=r(c),n(e,this,u)}}},8969(e,t,r){var n=r(7422),i=r(5160);e.exports=function(e,t){return t.length<2?e:n(e,i(t,0,-1))}},9325(e,t,r){var n=r(4840),i="object"==typeof self&&self&&self.Object===Object&&self,s=n||i||Function("return this")();e.exports=s},4974(e){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},1380(e){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},1459(e){e.exports=function(e){return this.__data__.has(e)}},4247(e){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}},2865(e,t,r){var n=r(9570),i=r(1811)(n);e.exports=i},1811(e){var t=Date.now;e.exports=function(e){var r=0,n=0;return function(){var i=t(),s=16-(i-n);if(n=i,s>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},7410(e,t,r){var n=r(3195);e.exports=function(e,t){var r=-1,i=e.length,s=i-1;for(t=void 0===t?i:t;++r<t;){var o=n(r,s),a=e[o];e[o]=e[r],e[r]=a}return e.length=t,e}},1420(e,t,r){var n=r(79);e.exports=function(){this.__data__=new n,this.size=0}},938(e){e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},3605(e){e.exports=function(e){return this.__data__.get(e)}},9817(e){e.exports=function(e){return this.__data__.has(e)}},945(e,t,r){var n=r(79),i=r(8223),s=r(3661);e.exports=function(e,t){var r=this.__data__;if(r instanceof n){var o=r.__data__;if(!i||o.length<199)return o.push([e,t]),this.size=++r.size,this;r=this.__data__=new s(o)}return r.set(e,t),this.size=r.size,this}},6959(e){e.exports=function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}},1993(e,t,r){var n=r(9811),i=r(9698),s=r(7927);e.exports=function(e){return i(e)?s(e):n(e)}},3912(e,t,r){var n=r(1074),i=r(9698),s=r(2054);e.exports=function(e){return i(e)?s(e):n(e)}},1802(e,t,r){var n=r(2224),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s=/\\(\\)?/g,o=n(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(i,function(e,r,n,i){t.push(n?i.replace(s,"$1"):r||e)}),t});e.exports=o},7797(e,t,r){var n=r(4394);e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},7473(e){var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},1800(e){var t=/\s/;e.exports=function(e){for(var r=e.length;r--&&t.test(e.charAt(r)););return r}},7927(e){var t="\\ud800-\\udfff",r="["+t+"]",n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",s="[^"+t+"]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:"+n+"|"+i+")?",u="[\\ufe0e\\ufe0f]?",l=u+c+"(?:\\u200d(?:"+[s,o,a].join("|")+")"+u+c+")*",d="(?:"+[s+n+"?",n,o,a,r].join("|")+")",h=RegExp(i+"(?="+i+")|"+d+l,"g");e.exports=function(e){for(var t=h.lastIndex=0;h.test(e);)++t;return t}},2054(e){var t="\\ud800-\\udfff",r="["+t+"]",n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",s="[^"+t+"]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:"+n+"|"+i+")?",u="[\\ufe0e\\ufe0f]?",l=u+c+"(?:\\u200d(?:"+[s,o,a].join("|")+")"+u+c+")*",d="(?:"+[s+n+"?",n,o,a,r].join("|")+")",h=RegExp(i+"(?="+i+")|"+d+l,"g");e.exports=function(e){return e.match(h)||[]}},2177(e,t,r){var n=r(1489);e.exports=function(e,t){var r;if("function"!=typeof t)throw new TypeError("Expected a function");return e=n(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=void 0),r}}},8055(e,t,r){var n=r(9999);e.exports=function(e){return n(e,5)}},7334(e){e.exports=function(e){return function(){return e}}},5288(e){e.exports=function(e,t){return e===t||e!=e&&t!=t}},5970(e,t,r){var n=r(3120);e.exports=function(e){return null!=e&&e.length?n(e,1):[]}},8156(e,t,r){var n=r(7422);e.exports=function(e,t,r){var i=null==e?void 0:n(e,t);return void 0===i?r:i}},631(e,t,r){var n=r(8077),i=r(9326);e.exports=function(e,t){return null!=e&&i(e,t,n)}},3488(e){e.exports=function(e){return e}},5287(e,t,r){var n=r(4932),i=r(7185),s=r(9302),o=r(741),a=s(function(e){var t=n(e,o);return t.length&&t[0]===e[0]?i(t):[]});e.exports=a},2428(e,t,r){var n=r(7534),i=r(346),s=Object.prototype,o=s.hasOwnProperty,a=s.propertyIsEnumerable,c=n(function(){return arguments}())?n:function(e){return i(e)&&o.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},6449(e){var t=Array.isArray;e.exports=t},4894(e,t,r){var n=r(1882),i=r(294);e.exports=function(e){return null!=e&&i(e.length)&&!n(e)}},3693(e,t,r){var n=r(4894),i=r(346);e.exports=function(e){return i(e)&&n(e)}},3656(e,t,r){e=r.nmd(e);var n=r(9325),i=r(9935),s=t&&!t.nodeType&&t,o=s&&e&&!e.nodeType&&e,a=o&&o.exports===s?n.Buffer:void 0,c=(a?a.isBuffer:void 0)||i;e.exports=c},1882(e,t,r){var n=r(2552),i=r(3805);e.exports=function(e){if(!i(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},294(e){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},7730(e,t,r){var n=r(9172),i=r(7301),s=r(6009),o=s&&s.isMap,a=o?i(o):n;e.exports=a},8023(e,t,r){var n=r(2552),i=r(346);e.exports=function(e){return"number"==typeof e||i(e)&&"[object Number]"==n(e)}},3805(e){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},346(e){e.exports=function(e){return null!=e&&"object"==typeof e}},1331(e,t,r){var n=r(2552),i=r(8879),s=r(346),o=Function.prototype,a=Object.prototype,c=o.toString,u=a.hasOwnProperty,l=c.call(Object);e.exports=function(e){if(!s(e)||"[object Object]"!=n(e))return!1;var t=i(e);if(null===t)return!0;var r=u.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&c.call(r)==l}},8440(e,t,r){var n=r(6038),i=r(7301),s=r(6009),o=s&&s.isSet,a=o?i(o):n;e.exports=a},5015(e,t,r){var n=r(2552),i=r(6449),s=r(346);e.exports=function(e){return"string"==typeof e||!i(e)&&s(e)&&"[object String]"==n(e)}},4394(e,t,r){var n=r(2552),i=r(346);e.exports=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==n(e)}},7167(e,t,r){var n=r(4901),i=r(7301),s=r(6009),o=s&&s.isTypedArray,a=o?i(o):n;e.exports=a},5950(e,t,r){var n=r(695),i=r(8984),s=r(4894);e.exports=function(e){return s(e)?n(e):i(e)}},7241(e,t,r){var n=r(695),i=r(2903),s=r(4894);e.exports=function(e){return s(e)?n(e,!0):i(e)}},8090(e){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},104(e,t,r){var n=r(3661);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(i.Cache||n),r}i.Cache=n,e.exports=i},5364(e,t,r){var n=r(5250),i=r(999)(function(e,t,r){n(e,t,r)});e.exports=i},6924(e,t,r){var n=r(5250),i=r(999)(function(e,t,r,i){n(e,t,r,i)});e.exports=i},1684(e,t,r){var n=r(3599),i=r(6176),s=r(3488);e.exports=function(e){return e&&e.length?n(e,s,i):void 0}},3950(e){e.exports=function(){}},179(e,t,r){var n=r(4932),i=r(9999),s=r(9931),o=r(1769),a=r(1791),c=r(3138),u=r(8816),l=r(5730),d=u(function(e,t){var r={};if(null==e)return r;var u=!1;t=n(t,function(t){return t=o(t,e),u||(u=t.length>1),t}),a(e,l(e),r),u&&(r=i(r,7,c));for(var d=t.length;d--;)s(r,t[d]);return r});e.exports=d},8059(e,t,r){var n=r(2177);e.exports=function(e){return n(2,e)}},7948(e,t,r){var n=r(7216),i=r(1993),s=r(1489),o=r(3222);e.exports=function(e,t,r){e=o(e);var a=(t=s(t))?i(e):0;return t&&a<t?e+n(t-a,r):e}},583(e,t,r){var n=r(7237),i=r(7255),s=r(8586),o=r(7797);e.exports=function(e){return s(e)?n(o(e)):i(e)}},121(e,t,r){var n=r(9302)(r(2358));e.exports=n},2358(e,t,r){var n=r(1988);e.exports=function(e,t){return e&&e.length&&t&&t.length?n(e,t):e}},8253(e,t,r){var n=r(3195),i=r(6800),s=r(7400),o=parseFloat,a=Math.min,c=Math.random;e.exports=function(e,t,r){if(r&&"boolean"!=typeof r&&i(e,t,r)&&(t=r=void 0),void 0===r&&("boolean"==typeof t?(r=t,t=void 0):"boolean"==typeof e&&(r=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=s(e),void 0===t?(t=e,e=0):t=s(t)),e>t){var u=e;e=t,t=u}if(r||e%1||t%1){var l=c();return a(e+l*(t-e+o("1e-"+((l+"").length-1))),t)}return n(e,t)}},3181(e,t,r){var n=r(5508)();e.exports=n},4174(e,t,r){var n=r(5389),i=r(306);e.exports=function(e,t){var r=[];if(!e||!e.length)return r;var s=-1,o=[],a=e.length;for(t=n(t,3);++s<a;){var c=e[s];t(c,s,e)&&(r.push(c),o.push(s))}return i(e,o),r}},5620(e,t,r){var n=r(3390),i=r(8170),s=r(6449);e.exports=function(e){return(s(e)?n:i)(e)}},3441(e,t,r){var n=r(4435),i=r(9095),s=r(6449),o=r(6800),a=r(1489);e.exports=function(e,t,r){return t=(r?o(e,t,r):void 0===t)?1:a(t),(s(e)?n:i)(e,t)}},3560(e,t,r){var n=r(3170);e.exports=function(e,t,r){return null==e?e:n(e,t,r)}},6049(e,t,r){var n=r(8567),i=r(4171),s=r(6449);e.exports=function(e){return(s(e)?n:i)(e)}},8917(e,t,r){var n=r(5389),i=r(4116);e.exports=function(e,t,r){return i(e,t,n(r,2))}},3345(e){e.exports=function(){return[]}},9935(e){e.exports=function(){return!1}},7400(e,t,r){var n=r(9374),i=1/0;e.exports=function(e){return e?(e=n(e))===i||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},1489(e,t,r){var n=r(7400);e.exports=function(e){var t=n(e),r=t%1;return t==t?r?t-r:t:0}},9374(e,t,r){var n=r(4128),i=r(3805),s=r(4394),o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(s(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=n(e);var r=a.test(e);return r||c.test(e)?u(e.slice(2),r?2:8):o.test(e)?NaN:+e}},9884(e,t,r){var n=r(1791),i=r(7241);e.exports=function(e){return n(e,i(e))}},3222(e,t,r){var n=r(7556);e.exports=function(e){return null==e?"":n(e)}},3375(e,t,r){var n=r(5765);e.exports=function(e){return e&&e.length?n(e):[]}},7200(e,t,r){var n=r(3222),i=0;e.exports=function(e){var t=++i;return n(e)+t}},3499(e,t,r){var n=r(514),i=r(5950);e.exports=function(e){return null==e?[]:n(e,i(e))}},1648(e,t,r){var n=r(3915),i=r(9302),s=r(3693),o=i(function(e,t){return s(e)?n(e,t):[]});e.exports=o},1514(e){"use strict";e.exports=Math.abs},8968(e){"use strict";e.exports=Math.floor},4459(e){"use strict";e.exports=Number.isNaN||function(e){return e!=e}},6188(e){"use strict";e.exports=Math.max},8002(e){"use strict";e.exports=Math.min},5880(e){"use strict";e.exports=Math.pow},414(e){"use strict";e.exports=Math.round},3093(e,t,r){"use strict";var n=r(4459);e.exports=function(e){return n(e)||0===e?e:e<0?-1:1}},3349(e){function t(e,t){if(!e)throw new Error(t||"Assertion failed")}e.exports=t,t.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)}},4367(e,t){"use strict";var r=t;function n(e){return 1===e.length?"0"+e:e}function i(e){for(var t="",r=0;r<e.length;r++)t+=n(e[r].toString(16));return t}r.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"!=typeof e){for(var n=0;n<e.length;n++)r[n]=0|e[n];return r}if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),n=0;n<e.length;n+=2)r.push(parseInt(e[n]+e[n+1],16));else for(n=0;n<e.length;n++){var i=e.charCodeAt(n),s=i>>8,o=255&i;s?r.push(s,o):r.push(o)}return r},r.zero2=n,r.toHex=i,r.encode=function(e,t){return"hex"===t?i(e):e}},165(e,t,r){"use strict";const n=r(4693);e.exports=e=>{if(!Number.isInteger(e)&&e!==1/0||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new n;let r=0;const i=async(e,n,...i)=>{r++;const s=(async()=>e(...i))();n(s);try{await s}catch{}r--,t.size>0&&t.dequeue()()},s=(n,...s)=>new Promise(o=>{((n,s,...o)=>{t.enqueue(i.bind(null,n,s,...o)),(async()=>{await Promise.resolve(),r<e&&t.size>0&&t.dequeue()()})()})(n,o,...s)});return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),s}},8998(e){"use strict";class t extends Error{constructor(){super("Throttled function aborted"),this.name="AbortError"}}e.exports=({limit:e,interval:r,strict:n})=>{if(!Number.isFinite(e))throw new TypeError("Expected `limit` to be a finite number");if(!Number.isFinite(r))throw new TypeError("Expected `interval` to be a finite number");const i=new Map;let s=0,o=0;const a=[],c=n?function(){const t=Date.now();if(a.length<e)return a.push(t),0;const n=a.shift()+r;return t>=n?(a.push(t),0):(a.push(n),n-t)}:function(){const t=Date.now();return t-s>r?(o=1,s=t,0):(o<e?o++:(s+=r,o=1),s-t)};return e=>{const r=function(...t){if(!r.isEnabled)return(async()=>e.apply(this,t))();let n;return new Promise((r,s)=>{n=setTimeout(()=>{r(e.apply(this,t)),i.delete(n)},c()),i.set(n,s)})};return r.abort=()=>{for(const e of i.keys())clearTimeout(e),i.get(e)(new t);i.clear(),a.splice(0,a.length)},r.isEnabled=!0,r}},e.exports.AbortError=t},7975(e){"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",i=0,s=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)r=e.charCodeAt(a);else{if(47===r)break;r=47}if(47===r){if(s===a-1||1===o);else if(s!==a-1&&2===o){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var c=n.lastIndexOf("/");if(c!==n.length-1){-1===c?(n="",i=0):i=(n=n.slice(0,c)).length-1-n.lastIndexOf("/"),s=a,o=0;continue}}else if(2===n.length||1===n.length){n="",i=0,s=a,o=0;continue}t&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+e.slice(s+1,a):n=e.slice(s+1,a),i=a-s-1;s=a,o=0}else 46===r&&-1!==o?++o:o=-1}return n}var n={resolve:function(){for(var e,n="",i=!1,s=arguments.length-1;s>=-1&&!i;s--){var o;s>=0?o=arguments[s]:(void 0===e&&(e=process.cwd()),o=e),t(o),0!==o.length&&(n=o+"/"+n,i=47===o.charCodeAt(0))}return n=r(n,!i),i?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=r(e,!n)).length||n||(e="."),e.length>0&&i&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var i=arguments[r];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":n.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r)return"";if((e=n.resolve(e))===(r=n.resolve(r)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var s=e.length,o=s-i,a=1;a<r.length&&47===r.charCodeAt(a);++a);for(var c=r.length-a,u=o<c?o:c,l=-1,d=0;d<=u;++d){if(d===u){if(c>u){if(47===r.charCodeAt(a+d))return r.slice(a+d+1);if(0===d)return r.slice(a+d)}else o>u&&(47===e.charCodeAt(i+d)?l=d:0===d&&(l=0));break}var h=e.charCodeAt(i+d);if(h!==r.charCodeAt(a+d))break;47===h&&(l=d)}var f="";for(d=i+l+1;d<=s;++d)d!==s&&47!==e.charCodeAt(d)||(0===f.length?f+="..":f+="/..");return f.length>0?f+r.slice(a+l):(a+=l,47===r.charCodeAt(a)&&++a,r.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,i=-1,s=!0,o=e.length-1;o>=1;--o)if(47===(r=e.charCodeAt(o))){if(!s){i=o;break}}else s=!1;return-1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,r){if(void 0!==r&&"string"!=typeof r)throw new TypeError('"ext" argument must be a string');t(e);var n,i=0,s=-1,o=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var a=r.length-1,c=-1;for(n=e.length-1;n>=0;--n){var u=e.charCodeAt(n);if(47===u){if(!o){i=n+1;break}}else-1===c&&(o=!1,c=n+1),a>=0&&(u===r.charCodeAt(a)?-1===--a&&(s=n):(a=-1,s=c))}return i===s?s=c:-1===s&&(s=e.length),e.slice(i,s)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!o){i=n+1;break}}else-1===s&&(o=!1,s=n+1);return-1===s?"":e.slice(i,s)},extname:function(e){t(e);for(var r=-1,n=0,i=-1,s=!0,o=0,a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(47!==c)-1===i&&(s=!1,i=a+1),46===c?-1===r?r=a:1!==o&&(o=1):-1!==r&&(o=-1);else if(!s){n=a+1;break}}return-1===r||-1===i||0===o||1===o&&r===i-1&&r===n+1?"":e.slice(r,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+"/"+n:n}(0,e)},parse:function(e){t(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;var n,i=e.charCodeAt(0),s=47===i;s?(r.root="/",n=1):n=0;for(var o=-1,a=0,c=-1,u=!0,l=e.length-1,d=0;l>=n;--l)if(47!==(i=e.charCodeAt(l)))-1===c&&(u=!1,c=l+1),46===i?-1===o?o=l:1!==d&&(d=1):-1!==o&&(d=-1);else if(!u){a=l+1;break}return-1===o||-1===c||0===d||1===d&&o===c-1&&o===a+1?-1!==c&&(r.base=r.name=0===a&&s?e.slice(1,c):e.slice(a,c)):(0===a&&s?(r.name=e.slice(1,o),r.base=e.slice(1,c)):(r.name=e.slice(a,o),r.base=e.slice(a,c)),r.ext=e.slice(o,c)),a>0?r.dir=e.slice(0,a-1):s&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,e.exports=n},6578(e){"use strict";e.exports=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]},5606(e){var t,r,n=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var a,c=[],u=!1,l=-1;function d(){u&&a&&(u=!1,a.length?c=a.concat(c):l=-1,c.length&&h())}function h(){if(!u){var e=o(d);u=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new f(e,t)),1!==c.length||u||o(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},7583(e,t,r){const n=r(3714),i=r(157),s=r(7899),o=r(6756);function a(e,t,r,s,o){const a=[].slice.call(arguments,1),c=a.length,u="function"==typeof a[c-1];if(!u&&!n())throw new Error("Callback required as last argument");if(!u){if(c<1)throw new Error("Too few arguments provided");return 1===c?(r=t,t=s=void 0):2!==c||t.getContext||(s=r,r=t,t=void 0),new Promise(function(n,o){try{const o=i.create(r,s);n(e(o,t,s))}catch(e){o(e)}})}if(c<2)throw new Error("Too few arguments provided");2===c?(o=r,r=t,t=s=void 0):3===c&&(t.getContext&&void 0===o?(o=s,s=void 0):(o=s,s=r,r=t,t=void 0));try{const n=i.create(r,s);o(null,e(n,t,s))}catch(e){o(e)}}t.create=i.create,t.toCanvas=a.bind(null,s.render),t.toDataURL=a.bind(null,s.renderToDataURL),t.toString=a.bind(null,function(e,t,r){return o.render(e,r)})},3714(e){e.exports=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}},6421(e,t,r){const n=r(6886).getSymbolSize;t.getRowColCoords=function(e){if(1===e)return[];const t=Math.floor(e/7)+2,r=n(e),i=145===r?26:2*Math.ceil((r-13)/(2*t-2)),s=[r-7];for(let e=1;e<t-1;e++)s[e]=s[e-1]-i;return s.push(6),s.reverse()},t.getPositions=function(e){const r=[],n=t.getRowColCoords(e),i=n.length;for(let e=0;e<i;e++)for(let t=0;t<i;t++)0===e&&0===t||0===e&&t===i-1||e===i-1&&0===t||r.push([n[e],n[t]]);return r}},1433(e,t,r){const n=r(208),i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(e){this.mode=n.ALPHANUMERIC,this.data=e}s.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let r=45*i.indexOf(this.data[t]);r+=i.indexOf(this.data[t+1]),e.put(r,11)}this.data.length%2&&e.put(i.indexOf(this.data[t]),6)},e.exports=s},9899(e){function t(){this.buffer=[],this.length=0}t.prototype={get:function(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let r=0;r<t;r++)this.putBit(1==(e>>>t-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},e.exports=t},8820(e){function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}t.prototype.set=function(e,t,r,n){const i=e*this.size+t;this.data[i]=r,n&&(this.reservedBit[i]=!0)},t.prototype.get=function(e,t){return this.data[e*this.size+t]},t.prototype.xor=function(e,t,r){this.data[e*this.size+t]^=r},t.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},e.exports=t},5822(e,t,r){const n=r(208);function i(e){this.mode=n.BYTE,this.data="string"==typeof e?(new TextEncoder).encode(e):new Uint8Array(e)}i.getBitsLength=function(e){return 8*e},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){for(let t=0,r=this.data.length;t<r;t++)e.put(this.data[t],8)},e.exports=i},7518(e,t,r){const n=r(9953),i=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];t.getBlocksCount=function(e,t){switch(t){case n.L:return i[4*(e-1)+0];case n.M:return i[4*(e-1)+1];case n.Q:return i[4*(e-1)+2];case n.H:return i[4*(e-1)+3];default:return}},t.getTotalCodewordsCount=function(e,t){switch(t){case n.L:return s[4*(e-1)+0];case n.M:return s[4*(e-1)+1];case n.Q:return s[4*(e-1)+2];case n.H:return s[4*(e-1)+3];default:return}}},9953(e,t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2},t.isValid=function(e){return e&&void 0!==e.bit&&e.bit>=0&&e.bit<4},t.from=function(e,r){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+e)}}(e)}catch(e){return r}}},7756(e,t,r){const n=r(6886).getSymbolSize;t.getPositions=function(e){const t=n(e);return[[0,0],[t-7,0],[0,t-7]]}},4565(e,t,r){const n=r(6886),i=n.getBCHDigit(1335);t.getEncodedBits=function(e,t){const r=e.bit<<3|t;let s=r<<10;for(;n.getBCHDigit(s)-i>=0;)s^=1335<<n.getBCHDigit(s)-i;return 21522^(r<<10|s)}},2731(e,t){const r=new Uint8Array(512),n=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)r[t]=e,n[e]=t,e<<=1,256&e&&(e^=285);for(let e=255;e<512;e++)r[e]=r[e-255]}(),t.log=function(e){if(e<1)throw new Error("log("+e+")");return n[e]},t.exp=function(e){return r[e]},t.mul=function(e,t){return 0===e||0===t?0:r[n[e]+n[t]]}},4861(e,t,r){const n=r(208),i=r(6886);function s(e){this.mode=n.KANJI,this.data=e}s.getBitsLength=function(e){return 13*e},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let r=i.toSJIS(this.data[t]);if(r>=33088&&r<=40956)r-=33088;else{if(!(r>=57408&&r<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");r-=49472}r=192*(r>>>8&255)+(255&r),e.put(r,13)}},e.exports=s},1332(e,t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};function r(e,r,n){switch(e){case t.Patterns.PATTERN000:return(r+n)%2==0;case t.Patterns.PATTERN001:return r%2==0;case t.Patterns.PATTERN010:return n%3==0;case t.Patterns.PATTERN011:return(r+n)%3==0;case t.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(n/3))%2==0;case t.Patterns.PATTERN101:return r*n%2+r*n%3==0;case t.Patterns.PATTERN110:return(r*n%2+r*n%3)%2==0;case t.Patterns.PATTERN111:return(r*n%3+(r+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}}t.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},t.from=function(e){return t.isValid(e)?parseInt(e,10):void 0},t.getPenaltyN1=function(e){const t=e.size;let r=0,n=0,i=0,s=null,o=null;for(let a=0;a<t;a++){n=i=0,s=o=null;for(let c=0;c<t;c++){let t=e.get(a,c);t===s?n++:(n>=5&&(r+=n-5+3),s=t,n=1),t=e.get(c,a),t===o?i++:(i>=5&&(r+=i-5+3),o=t,i=1)}n>=5&&(r+=n-5+3),i>=5&&(r+=i-5+3)}return r},t.getPenaltyN2=function(e){const t=e.size;let r=0;for(let n=0;n<t-1;n++)for(let i=0;i<t-1;i++){const t=e.get(n,i)+e.get(n,i+1)+e.get(n+1,i)+e.get(n+1,i+1);4!==t&&0!==t||r++}return 3*r},t.getPenaltyN3=function(e){const t=e.size;let r=0,n=0,i=0;for(let s=0;s<t;s++){n=i=0;for(let o=0;o<t;o++)n=n<<1&2047|e.get(s,o),o>=10&&(1488===n||93===n)&&r++,i=i<<1&2047|e.get(o,s),o>=10&&(1488===i||93===i)&&r++}return 40*r},t.getPenaltyN4=function(e){let t=0;const r=e.data.length;for(let n=0;n<r;n++)t+=e.data[n];return 10*Math.abs(Math.ceil(100*t/r/5)-10)},t.applyMask=function(e,t){const n=t.size;for(let i=0;i<n;i++)for(let s=0;s<n;s++)t.isReserved(s,i)||t.xor(s,i,r(e,s,i))},t.getBestMask=function(e,r){const n=Object.keys(t.Patterns).length;let i=0,s=1/0;for(let o=0;o<n;o++){r(o),t.applyMask(o,e);const n=t.getPenaltyN1(e)+t.getPenaltyN2(e)+t.getPenaltyN3(e)+t.getPenaltyN4(e);t.applyMask(o,e),n<s&&(s=n,i=o)}return i}},208(e,t,r){const n=r(1878),i=r(7044);t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(e,t){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!n.isValid(t))throw new Error("Invalid version: "+t);return t>=1&&t<10?e.ccBits[0]:t<27?e.ccBits[1]:e.ccBits[2]},t.getBestModeForData=function(e){return i.testNumeric(e)?t.NUMERIC:i.testAlphanumeric(e)?t.ALPHANUMERIC:i.testKanji(e)?t.KANJI:t.BYTE},t.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},t.isValid=function(e){return e&&e.bit&&e.ccBits},t.from=function(e,r){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+e)}}(e)}catch(e){return r}}},4357(e,t,r){const n=r(208);function i(e){this.mode=n.NUMERIC,this.data=e.toString()}i.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t,r,n;for(t=0;t+3<=this.data.length;t+=3)r=this.data.substr(t,3),n=parseInt(r,10),e.put(n,10);const i=this.data.length-t;i>0&&(r=this.data.substr(t),n=parseInt(r,10),e.put(n,3*i+1))},e.exports=i},4713(e,t,r){const n=r(2731);t.mul=function(e,t){const r=new Uint8Array(e.length+t.length-1);for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)r[i+s]^=n.mul(e[i],t[s]);return r},t.mod=function(e,t){let r=new Uint8Array(e);for(;r.length-t.length>=0;){const e=r[0];for(let i=0;i<t.length;i++)r[i]^=n.mul(t[i],e);let i=0;for(;i<r.length&&0===r[i];)i++;r=r.slice(i)}return r},t.generateECPolynomial=function(e){let r=new Uint8Array([1]);for(let i=0;i<e;i++)r=t.mul(r,new Uint8Array([1,n.exp(i)]));return r}},157(e,t,r){const n=r(6886),i=r(9953),s=r(9899),o=r(8820),a=r(6421),c=r(7756),u=r(1332),l=r(7518),d=r(4764),h=r(1427),f=r(4565),p=r(208),g=r(9801);function m(e,t,r){const n=e.size,i=f.getEncodedBits(t,r);let s,o;for(s=0;s<15;s++)o=1==(i>>s&1),s<6?e.set(s,8,o,!0):s<8?e.set(s+1,8,o,!0):e.set(n-15+s,8,o,!0),s<8?e.set(8,n-s-1,o,!0):s<9?e.set(8,15-s-1+1,o,!0):e.set(8,15-s-1,o,!0);e.set(n-8,8,1,!0)}function y(e,t,r,i){let f;if(Array.isArray(e))f=g.fromArray(e);else{if("string"!=typeof e)throw new Error("Invalid data");{let n=t;if(!n){const t=g.rawSplit(e);n=h.getBestVersionForData(t,r)}f=g.fromString(e,n||40)}}const y=h.getBestVersionForData(f,r);if(!y)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<y)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+y+".\n")}else t=y;const b=function(e,t,r){const i=new s;r.forEach(function(t){i.put(t.mode.bit,4),i.put(t.getLength(),p.getCharCountIndicator(t.mode,e)),t.write(i)});const o=8*(n.getSymbolTotalCodewords(e)-l.getTotalCodewordsCount(e,t));for(i.getLengthInBits()+4<=o&&i.put(0,4);i.getLengthInBits()%8!=0;)i.putBit(0);const a=(o-i.getLengthInBits())/8;for(let e=0;e<a;e++)i.put(e%2?17:236,8);return function(e,t,r){const i=n.getSymbolTotalCodewords(t),s=i-l.getTotalCodewordsCount(t,r),o=l.getBlocksCount(t,r),a=o-i%o,c=Math.floor(i/o),u=Math.floor(s/o),h=u+1,f=c-u,p=new d(f);let g=0;const m=new Array(o),y=new Array(o);let b=0;const w=new Uint8Array(e.buffer);for(let e=0;e<o;e++){const t=e<a?u:h;m[e]=w.slice(g,g+t),y[e]=p.encode(m[e]),g+=t,b=Math.max(b,t)}const v=new Uint8Array(i);let E,A,S=0;for(E=0;E<b;E++)for(A=0;A<o;A++)E<m[A].length&&(v[S++]=m[A][E]);for(E=0;E<f;E++)for(A=0;A<o;A++)v[S++]=y[A][E];return v}(i,e,t)}(t,r,f),w=n.getSymbolSize(t),v=new o(w);return function(e,t){const r=e.size,n=c.getPositions(t);for(let t=0;t<n.length;t++){const i=n[t][0],s=n[t][1];for(let t=-1;t<=7;t++)if(!(i+t<=-1||r<=i+t))for(let n=-1;n<=7;n++)s+n<=-1||r<=s+n||(t>=0&&t<=6&&(0===n||6===n)||n>=0&&n<=6&&(0===t||6===t)||t>=2&&t<=4&&n>=2&&n<=4?e.set(i+t,s+n,!0,!0):e.set(i+t,s+n,!1,!0))}}(v,t),function(e){const t=e.size;for(let r=8;r<t-8;r++){const t=r%2==0;e.set(r,6,t,!0),e.set(6,r,t,!0)}}(v),function(e,t){const r=a.getPositions(t);for(let t=0;t<r.length;t++){const n=r[t][0],i=r[t][1];for(let t=-2;t<=2;t++)for(let r=-2;r<=2;r++)-2===t||2===t||-2===r||2===r||0===t&&0===r?e.set(n+t,i+r,!0,!0):e.set(n+t,i+r,!1,!0)}}(v,t),m(v,r,0),t>=7&&function(e,t){const r=e.size,n=h.getEncodedBits(t);let i,s,o;for(let t=0;t<18;t++)i=Math.floor(t/3),s=t%3+r-8-3,o=1==(n>>t&1),e.set(i,s,o,!0),e.set(s,i,o,!0)}(v,t),function(e,t){const r=e.size;let n=-1,i=r-1,s=7,o=0;for(let a=r-1;a>0;a-=2)for(6===a&&a--;;){for(let r=0;r<2;r++)if(!e.isReserved(i,a-r)){let n=!1;o<t.length&&(n=1==(t[o]>>>s&1)),e.set(i,a-r,n),s--,-1===s&&(o++,s=7)}if(i+=n,i<0||r<=i){i-=n,n=-n;break}}}(v,b),isNaN(i)&&(i=u.getBestMask(v,m.bind(null,v,r))),u.applyMask(i,v),m(v,r,i),{modules:v,version:t,errorCorrectionLevel:r,maskPattern:i,segments:f}}t.create=function(e,t){if(void 0===e||""===e)throw new Error("No input text");let r,s,o=i.M;return void 0!==t&&(o=i.from(t.errorCorrectionLevel,i.M),r=h.from(t.version),s=u.from(t.maskPattern),t.toSJISFunc&&n.setToSJISFunction(t.toSJISFunc)),y(e,r,o,s)}},4764(e,t,r){const n=r(4713);function i(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}i.prototype.initialize=function(e){this.degree=e,this.genPoly=n.generateECPolynomial(this.degree)},i.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const r=n.mod(t,this.genPoly),i=this.degree-r.length;if(i>0){const e=new Uint8Array(this.degree);return e.set(r,i),e}return r},e.exports=i},7044(e,t){const r="[0-9]+";let n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";n=n.replace(/u/g,"\\u");const i="(?:(?![A-Z0-9 $%*+\\-./:]|"+n+")(?:.|[\r\n]))+";t.KANJI=new RegExp(n,"g"),t.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),t.BYTE=new RegExp(i,"g"),t.NUMERIC=new RegExp(r,"g"),t.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const s=new RegExp("^"+n+"$"),o=new RegExp("^"+r+"$"),a=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");t.testKanji=function(e){return s.test(e)},t.testNumeric=function(e){return o.test(e)},t.testAlphanumeric=function(e){return a.test(e)}},9801(e,t,r){const n=r(208),i=r(4357),s=r(1433),o=r(5822),a=r(4861),c=r(7044),u=r(6886),l=r(6320);function d(e){return unescape(encodeURIComponent(e)).length}function h(e,t,r){const n=[];let i;for(;null!==(i=e.exec(r));)n.push({data:i[0],index:i.index,mode:t,length:i[0].length});return n}function f(e){const t=h(c.NUMERIC,n.NUMERIC,e),r=h(c.ALPHANUMERIC,n.ALPHANUMERIC,e);let i,s;return u.isKanjiModeEnabled()?(i=h(c.BYTE,n.BYTE,e),s=h(c.KANJI,n.KANJI,e)):(i=h(c.BYTE_KANJI,n.BYTE,e),s=[]),t.concat(r,i,s).sort(function(e,t){return e.index-t.index}).map(function(e){return{data:e.data,mode:e.mode,length:e.length}})}function p(e,t){switch(t){case n.NUMERIC:return i.getBitsLength(e);case n.ALPHANUMERIC:return s.getBitsLength(e);case n.KANJI:return a.getBitsLength(e);case n.BYTE:return o.getBitsLength(e)}}function g(e,t){let r;const c=n.getBestModeForData(e);if(r=n.from(t,c),r!==n.BYTE&&r.bit<c.bit)throw new Error('"'+e+'" cannot be encoded with mode '+n.toString(r)+".\n Suggested mode is: "+n.toString(c));switch(r!==n.KANJI||u.isKanjiModeEnabled()||(r=n.BYTE),r){case n.NUMERIC:return new i(e);case n.ALPHANUMERIC:return new s(e);case n.KANJI:return new a(e);case n.BYTE:return new o(e)}}t.fromArray=function(e){return e.reduce(function(e,t){return"string"==typeof t?e.push(g(t,null)):t.data&&e.push(g(t.data,t.mode)),e},[])},t.fromString=function(e,r){const i=function(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r];switch(i.mode){case n.NUMERIC:t.push([i,{data:i.data,mode:n.ALPHANUMERIC,length:i.length},{data:i.data,mode:n.BYTE,length:i.length}]);break;case n.ALPHANUMERIC:t.push([i,{data:i.data,mode:n.BYTE,length:i.length}]);break;case n.KANJI:t.push([i,{data:i.data,mode:n.BYTE,length:d(i.data)}]);break;case n.BYTE:t.push([{data:i.data,mode:n.BYTE,length:d(i.data)}])}}return t}(f(e,u.isKanjiModeEnabled())),s=function(e,t){const r={},i={start:{}};let s=["start"];for(let o=0;o<e.length;o++){const a=e[o],c=[];for(let e=0;e<a.length;e++){const u=a[e],l=""+o+e;c.push(l),r[l]={node:u,lastCount:0},i[l]={};for(let e=0;e<s.length;e++){const o=s[e];r[o]&&r[o].node.mode===u.mode?(i[o][l]=p(r[o].lastCount+u.length,u.mode)-p(r[o].lastCount,u.mode),r[o].lastCount+=u.length):(r[o]&&(r[o].lastCount=u.length),i[o][l]=p(u.length,u.mode)+4+n.getCharCountIndicator(u.mode,t))}}s=c}for(let e=0;e<s.length;e++)i[s[e]].end=0;return{map:i,table:r}}(i,r),o=l.find_path(s.map,"start","end"),a=[];for(let e=1;e<o.length-1;e++)a.push(s.table[o[e]].node);return t.fromArray(a.reduce(function(e,t){const r=e.length-1>=0?e[e.length-1]:null;return r&&r.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)},[]))},t.rawSplit=function(e){return t.fromArray(f(e,u.isKanjiModeEnabled()))}},6886(e,t){let r;const n=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];t.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},t.getSymbolTotalCodewords=function(e){return n[e]},t.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},t.setToSJISFunction=function(e){if("function"!=typeof e)throw new Error('"toSJISFunc" is not a valid function.');r=e},t.isKanjiModeEnabled=function(){return void 0!==r},t.toSJIS=function(e){return r(e)}},1878(e,t){t.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}},1427(e,t,r){const n=r(6886),i=r(7518),s=r(9953),o=r(208),a=r(1878),c=n.getBCHDigit(7973);function u(e,t){return o.getCharCountIndicator(e,t)+4}function l(e,t){let r=0;return e.forEach(function(e){const n=u(e.mode,t);r+=n+e.getBitsLength()}),r}t.from=function(e,t){return a.isValid(e)?parseInt(e,10):t},t.getCapacity=function(e,t,r){if(!a.isValid(e))throw new Error("Invalid QR Code version");void 0===r&&(r=o.BYTE);const s=8*(n.getSymbolTotalCodewords(e)-i.getTotalCodewordsCount(e,t));if(r===o.MIXED)return s;const c=s-u(r,e);switch(r){case o.NUMERIC:return Math.floor(c/10*3);case o.ALPHANUMERIC:return Math.floor(c/11*2);case o.KANJI:return Math.floor(c/13);case o.BYTE:default:return Math.floor(c/8)}},t.getBestVersionForData=function(e,r){let n;const i=s.from(r,s.M);if(Array.isArray(e)){if(e.length>1)return function(e,r){for(let n=1;n<=40;n++)if(l(e,n)<=t.getCapacity(n,r,o.MIXED))return n}(e,i);if(0===e.length)return 1;n=e[0]}else n=e;return function(e,r,n){for(let i=1;i<=40;i++)if(r<=t.getCapacity(i,n,e))return i}(n.mode,n.getLength(),i)},t.getEncodedBits=function(e){if(!a.isValid(e)||e<7)throw new Error("Invalid QR Code version");let t=e<<12;for(;n.getBCHDigit(t)-c>=0;)t^=7973<<n.getBCHDigit(t)-c;return e<<12|t}},7899(e,t,r){const n=r(2726);t.render=function(e,t,r){let i=r,s=t;void 0!==i||t&&t.getContext||(i=t,t=void 0),t||(s=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}()),i=n.getOptions(i);const o=n.getImageWidth(e.modules.size,i),a=s.getContext("2d"),c=a.createImageData(o,o);return n.qrToImageData(c.data,e,i),function(e,t,r){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=r,t.width=r,t.style.height=r+"px",t.style.width=r+"px"}(a,s,o),a.putImageData(c,0,0),s},t.renderToDataURL=function(e,r,n){let i=n;void 0!==i||r&&r.getContext||(i=r,r=void 0),i||(i={});const s=t.render(e,r,i),o=i.type||"image/png",a=i.rendererOpts||{};return s.toDataURL(o,a.quality)}},6756(e,t,r){const n=r(2726);function i(e,t){const r=e.a/255,n=t+'="'+e.hex+'"';return r<1?n+" "+t+'-opacity="'+r.toFixed(2).slice(1)+'"':n}function s(e,t,r){let n=e+t;return void 0!==r&&(n+=" "+r),n}t.render=function(e,t,r){const o=n.getOptions(t),a=e.modules.size,c=e.modules.data,u=a+2*o.margin,l=o.color.light.a?"<path "+i(o.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",d="<path "+i(o.color.dark,"stroke")+' d="'+function(e,t,r){let n="",i=0,o=!1,a=0;for(let c=0;c<e.length;c++){const u=Math.floor(c%t),l=Math.floor(c/t);u||o||(o=!0),e[c]?(a++,c>0&&u>0&&e[c-1]||(n+=o?s("M",u+r,.5+l+r):s("m",i,0),i=0,o=!1),u+1<t&&e[c+1]||(n+=s("h",a),a=0)):i++}return n}(c,a,o.margin)+'"/>',h='viewBox="0 0 '+u+" "+u+'"',f='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+h+' shape-rendering="crispEdges">'+l+d+"</svg>\n";return"function"==typeof r&&r(null,f),f}},2726(e,t){function r(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map(function(e){return[e,e]}))),6===t.length&&t.push("F","F");const r=parseInt(t.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:255&r,hex:"#"+t.slice(0,6).join("")}}t.getOptions=function(e){e||(e={}),e.color||(e.color={});const t=void 0===e.margin||null===e.margin||e.margin<0?4:e.margin,n=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:n,scale:n?4:i,margin:t,color:{dark:r(e.color.dark||"#000000ff"),light:r(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},t.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},t.getImageWidth=function(e,r){const n=t.getScale(e,r);return Math.floor((e+2*r.margin)*n)},t.qrToImageData=function(e,r,n){const i=r.modules.size,s=r.modules.data,o=t.getScale(i,n),a=Math.floor((i+2*n.margin)*o),c=n.margin*o,u=[n.color.light,n.color.dark];for(let t=0;t<a;t++)for(let r=0;r<a;r++){let l=4*(t*a+r),d=n.color.light;t>=c&&r>=c&&t<a-c&&r<a-c&&(d=u[s[Math.floor((t-c)/o)*i+Math.floor((r-c)/o)]?1:0]),e[l++]=d.r,e[l++]=d.g,e[l++]=d.b,e[l]=d.a}}},793(e){"use strict";function t(e){try{return JSON.stringify(e)}catch(e){return'"[Circular]"'}}e.exports=function(e,r,n){var i=n&&n.stringify||t;if("object"==typeof e&&null!==e){var s=r.length+1;if(1===s)return e;var o=new Array(s);o[0]=i(e);for(var a=1;a<s;a++)o[a]=i(r[a]);return o.join(" ")}if("string"!=typeof e)return e;var c=r.length;if(0===c)return e;for(var u="",l=0,d=-1,h=e&&e.length||0,f=0;f<h;){if(37===e.charCodeAt(f)&&f+1<h){switch(d=d>-1?d:0,e.charCodeAt(f+1)){case 100:case 102:if(l>=c)break;if(null==r[l])break;d<f&&(u+=e.slice(d,f)),u+=Number(r[l]),d=f+2,f++;break;case 105:if(l>=c)break;if(null==r[l])break;d<f&&(u+=e.slice(d,f)),u+=Math.floor(Number(r[l])),d=f+2,f++;break;case 79:case 111:case 106:if(l>=c)break;if(void 0===r[l])break;d<f&&(u+=e.slice(d,f));var p=typeof r[l];if("string"===p){u+="'"+r[l]+"'",d=f+2,f++;break}if("function"===p){u+=r[l].name||"<anonymous>",d=f+2,f++;break}u+=i(r[l]),d=f+2,f++;break;case 115:if(l>=c)break;d<f&&(u+=e.slice(d,f)),u+=String(r[l]),d=f+2,f++;break;case 37:d<f&&(u+=e.slice(d,f)),u+="%",d=f+2,f++,l--}++l}++f}return-1===d?e:(d<h&&(u+=e.slice(d)),u)}},3209(e,t,r){"use strict";var n=65536,i=r(2861).Buffer,s=r.g.crypto||r.g.msCrypto;s&&s.getRandomValues?e.exports=function(e,t){if(e>4294967295)throw new RangeError("requested too many random bytes");var r=i.allocUnsafe(e);if(e>0)if(e>n)for(var o=0;o<e;o+=n)s.getRandomValues(r.slice(o,o+n));else s.getRandomValues(r);return"function"==typeof t?process.nextTick(function(){t(null,r)}):r}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}},4147(e,t,r){"use strict";const{SymbolDispose:n}=r(4134),{AbortError:i,codes:s}=r(6371),{isNodeStream:o,isWebStream:a,kControllerErrorFunction:c}=r(6115),u=r(6238),{ERR_INVALID_ARG_TYPE:l}=s;let d;e.exports.addAbortSignal=function(t,r){if((e=>{if("object"!=typeof e||!("aborted"in e))throw new l("signal","AbortSignal",e)})(t),!o(r)&&!a(r))throw new l("stream",["ReadableStream","WritableStream","Stream"],r);return e.exports.addAbortSignalNoValidate(t,r)},e.exports.addAbortSignalNoValidate=function(e,t){if("object"!=typeof e||!("aborted"in e))return t;const s=o(t)?()=>{t.destroy(new i(void 0,{cause:e.reason}))}:()=>{t[c](new i(void 0,{cause:e.reason}))};if(e.aborted)s();else{d=d||r(7760).addAbortListener;const i=d(e,s);u(t,i[n])}return t}},345(e,t,r){"use strict";const{StringPrototypeSlice:n,SymbolIterator:i,TypedArrayPrototypeSet:s,Uint8Array:o}=r(4134),{Buffer:a}=r(8287),{inspect:c}=r(7760);e.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}unshift(e){const t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}shift(){if(0===this.length)return;const e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(0===this.length)return"";let t=this.head,r=""+t.data;for(;null!==(t=t.next);)r+=e+t.data;return r}concat(e){if(0===this.length)return a.alloc(0);const t=a.allocUnsafe(e>>>0);let r=this.head,n=0;for(;r;)s(t,r.data,n),n+=r.data.length,r=r.next;return t}consume(e,t){const r=this.head.data;if(e<r.length){const t=r.slice(0,e);return this.head.data=r.slice(e),t}return e===r.length?this.shift():t?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[i](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let t="",r=this.head,i=0;do{const s=r.data;if(!(e>s.length)){e===s.length?(t+=s,++i,r.next?this.head=r.next:this.head=this.tail=null):(t+=n(s,0,e),this.head=r,r.data=n(s,e));break}t+=s,e-=s.length,++i}while(null!==(r=r.next));return this.length-=i,t}_getBuffer(e){const t=a.allocUnsafe(e),r=e;let n=this.head,i=0;do{const a=n.data;if(!(e>a.length)){e===a.length?(s(t,a,r-e),++i,n.next?this.head=n.next:this.head=this.tail=null):(s(t,new o(a.buffer,a.byteOffset,e),r-e),this.head=n,n.data=a.slice(e));break}s(t,a,r-e),e-=a.length,++i}while(null!==(n=n.next));return this.length-=i,t}[Symbol.for("nodejs.util.inspect.custom")](e,t){return c(this,{...t,depth:0,customInspect:!1})}}},7830(e,t,r){"use strict";const{pipeline:n}=r(7758),i=r(3370),{destroyer:s}=r(5896),{isNodeStream:o,isReadable:a,isWritable:c,isWebStream:u,isTransformStream:l,isWritableStream:d,isReadableStream:h}=r(6115),{AbortError:f,codes:{ERR_INVALID_ARG_VALUE:p,ERR_MISSING_ARGS:g}}=r(6371),m=r(6238);e.exports=function(...e){if(0===e.length)throw new g("streams");if(1===e.length)return i.from(e[0]);const t=[...e];if("function"==typeof e[0]&&(e[0]=i.from(e[0])),"function"==typeof e[e.length-1]){const t=e.length-1;e[t]=i.from(e[t])}for(let r=0;r<e.length;++r)if(o(e[r])||u(e[r])){if(r<e.length-1&&!(a(e[r])||h(e[r])||l(e[r])))throw new p(`streams[${r}]`,t[r],"must be readable");if(r>0&&!(c(e[r])||d(e[r])||l(e[r])))throw new p(`streams[${r}]`,t[r],"must be writable")}let r,y,b,w,v;const E=e[0],A=n(e,function(e){const t=w;w=null,t?t(e):e?v.destroy(e):k||S||v.destroy()}),S=!!(c(E)||d(E)||l(E)),k=!!(a(A)||h(A)||l(A));if(v=new i({writableObjectMode:!(null==E||!E.writableObjectMode),readableObjectMode:!(null==A||!A.readableObjectMode),writable:S,readable:k}),S){if(o(E))v._write=function(e,t,n){E.write(e,t)?n():r=n},v._final=function(e){E.end(),y=e},E.on("drain",function(){if(r){const e=r;r=null,e()}});else if(u(E)){const e=(l(E)?E.writable:E).getWriter();v._write=async function(t,r,n){try{await e.ready,e.write(t).catch(()=>{}),n()}catch(e){n(e)}},v._final=async function(t){try{await e.ready,e.close().catch(()=>{}),y=t}catch(e){t(e)}}}const e=l(A)?A.readable:A;m(e,()=>{if(y){const e=y;y=null,e()}})}if(k)if(o(A))A.on("readable",function(){if(b){const e=b;b=null,e()}}),A.on("end",function(){v.push(null)}),v._read=function(){for(;;){const e=A.read();if(null===e)return void(b=v._read);if(!v.push(e))return}};else if(u(A)){const e=(l(A)?A.readable:A).getReader();v._read=async function(){for(;;)try{const{value:t,done:r}=await e.read();if(!v.push(t))return;if(r)return void v.push(null)}catch{return}}}return v._destroy=function(e,t){e||null===w||(e=new f),b=null,r=null,y=null,null===w?t(e):(w=t,o(A)&&s(A,e))},v}},5896(e,t,r){"use strict";const n=r(5606),{aggregateTwoErrors:i,codes:{ERR_MULTIPLE_CALLBACK:s},AbortError:o}=r(6371),{Symbol:a}=r(4134),{kIsDestroyed:c,isDestroyed:u,isFinished:l,isServerRequest:d}=r(6115),h=a("kDestroy"),f=a("kConstruct");function p(e,t,r){e&&(e.stack,t&&!t.errored&&(t.errored=e),r&&!r.errored&&(r.errored=e))}function g(e,t,r){let i=!1;function s(t){if(i)return;i=!0;const s=e._readableState,o=e._writableState;p(t,o,s),o&&(o.closed=!0),s&&(s.closed=!0),"function"==typeof r&&r(t),t?n.nextTick(m,e,t):n.nextTick(y,e)}try{e._destroy(t||null,s)}catch(t){s(t)}}function m(e,t){b(e,t),y(e)}function y(e){const t=e._readableState,r=e._writableState;r&&(r.closeEmitted=!0),t&&(t.closeEmitted=!0),(null!=r&&r.emitClose||null!=t&&t.emitClose)&&e.emit("close")}function b(e,t){const r=e._readableState,n=e._writableState;null!=n&&n.errorEmitted||null!=r&&r.errorEmitted||(n&&(n.errorEmitted=!0),r&&(r.errorEmitted=!0),e.emit("error",t))}function w(e,t,r){const i=e._readableState,s=e._writableState;if(null!=s&&s.destroyed||null!=i&&i.destroyed)return this;null!=i&&i.autoDestroy||null!=s&&s.autoDestroy?e.destroy(t):t&&(t.stack,s&&!s.errored&&(s.errored=t),i&&!i.errored&&(i.errored=t),r?n.nextTick(b,e,t):b(e,t))}function v(e){let t=!1;function r(r){if(t)return void w(e,null!=r?r:new s);t=!0;const i=e._readableState,o=e._writableState,a=o||i;i&&(i.constructed=!0),o&&(o.constructed=!0),a.destroyed?e.emit(h,r):r?w(e,r,!0):n.nextTick(E,e)}try{e._construct(e=>{n.nextTick(r,e)})}catch(e){n.nextTick(r,e)}}function E(e){e.emit(f)}function A(e){return(null==e?void 0:e.setHeader)&&"function"==typeof e.abort}function S(e){e.emit("close")}function k(e,t){e.emit("error",t),n.nextTick(S,e)}e.exports={construct:function(e,t){if("function"!=typeof e._construct)return;const r=e._readableState,i=e._writableState;r&&(r.constructed=!1),i&&(i.constructed=!1),e.once(f,t),e.listenerCount(f)>1||n.nextTick(v,e)},destroyer:function(e,t){e&&!u(e)&&(t||l(e)||(t=new o),d(e)?(e.socket=null,e.destroy(t)):A(e)?e.abort():A(e.req)?e.req.abort():"function"==typeof e.destroy?e.destroy(t):"function"==typeof e.close?e.close():t?n.nextTick(k,e,t):n.nextTick(S,e),e.destroyed||(e[c]=!0))},destroy:function(e,t){const r=this._readableState,n=this._writableState,s=n||r;return null!=n&&n.destroyed||null!=r&&r.destroyed?("function"==typeof t&&t(),this):(p(e,n,r),n&&(n.destroyed=!0),r&&(r.destroyed=!0),s.constructed?g(this,e,t):this.once(h,function(r){g(this,i(r,e),t)}),this)},undestroy:function(){const e=this._readableState,t=this._writableState;e&&(e.constructed=!0,e.closed=!1,e.closeEmitted=!1,e.destroyed=!1,e.errored=null,e.errorEmitted=!1,e.reading=!1,e.ended=!1===e.readable,e.endEmitted=!1===e.readable),t&&(t.constructed=!0,t.destroyed=!1,t.closed=!1,t.closeEmitted=!1,t.errored=null,t.errorEmitted=!1,t.finalCalled=!1,t.prefinished=!1,t.ended=!1===t.writable,t.ending=!1===t.writable,t.finished=!1===t.writable)},errorOrDestroy:w}},3370(e,t,r){"use strict";const{ObjectDefineProperties:n,ObjectGetOwnPropertyDescriptor:i,ObjectKeys:s,ObjectSetPrototypeOf:o}=r(4134);e.exports=u;const a=r(7576),c=r(8584);o(u.prototype,a.prototype),o(u,a);{const e=s(c.prototype);for(let t=0;t<e.length;t++){const r=e[t];u.prototype[r]||(u.prototype[r]=c.prototype[r])}}function u(e){if(!(this instanceof u))return new u(e);a.call(this,e),c.call(this,e),e?(this.allowHalfOpen=!1!==e.allowHalfOpen,!1===e.readable&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),!1===e.writable&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}let l,d;function h(){return void 0===l&&(l={}),l}n(u.prototype,{writable:{__proto__:null,...i(c.prototype,"writable")},writableHighWaterMark:{__proto__:null,...i(c.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...i(c.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...i(c.prototype,"writableBuffer")},writableLength:{__proto__:null,...i(c.prototype,"writableLength")},writableFinished:{__proto__:null,...i(c.prototype,"writableFinished")},writableCorked:{__proto__:null,...i(c.prototype,"writableCorked")},writableEnded:{__proto__:null,...i(c.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...i(c.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set(e){this._readableState&&this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}}),u.fromWeb=function(e,t){return h().newStreamDuplexFromReadableWritablePair(e,t)},u.toWeb=function(e){return h().newReadableWritablePairFromDuplex(e)},u.from=function(e){return d||(d=r(6706)),d(e,"body")}},6706(e,t,r){const n=r(5606),i=r(8287),{isReadable:s,isWritable:o,isIterable:a,isNodeStream:c,isReadableNodeStream:u,isWritableNodeStream:l,isDuplexNodeStream:d,isReadableStream:h,isWritableStream:f}=r(6115),p=r(6238),{AbortError:g,codes:{ERR_INVALID_ARG_TYPE:m,ERR_INVALID_RETURN_VALUE:y}}=r(6371),{destroyer:b}=r(5896),w=r(3370),v=r(7576),E=r(8584),{createDeferredPromise:A}=r(7760),S=r(6532),k=globalThis.Blob||i.Blob,R=void 0!==k?function(e){return e instanceof k}:function(e){return!1},P=globalThis.AbortController||r(5568).AbortController,{FunctionPrototypeCall:I}=r(4134);class C extends w{constructor(e){super(e),!1===(null==e?void 0:e.readable)&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),!1===(null==e?void 0:e.writable)&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}function _(e){const t=e.readable&&"function"!=typeof e.readable.read?v.wrap(e.readable):e.readable,r=e.writable;let n,i,a,c,u,l=!!s(t),d=!!o(r);function h(e){const t=c;c=null,t?t(e):e&&u.destroy(e)}return u=new C({readableObjectMode:!(null==t||!t.readableObjectMode),writableObjectMode:!(null==r||!r.writableObjectMode),readable:l,writable:d}),d&&(p(r,e=>{d=!1,e&&b(t,e),h(e)}),u._write=function(e,t,i){r.write(e,t)?i():n=i},u._final=function(e){r.end(),i=e},r.on("drain",function(){if(n){const e=n;n=null,e()}}),r.on("finish",function(){if(i){const e=i;i=null,e()}})),l&&(p(t,e=>{l=!1,e&&b(t,e),h(e)}),t.on("readable",function(){if(a){const e=a;a=null,e()}}),t.on("end",function(){u.push(null)}),u._read=function(){for(;;){const e=t.read();if(null===e)return void(a=u._read);if(!u.push(e))return}}),u._destroy=function(e,s){e||null===c||(e=new g),a=null,n=null,i=null,null===c?s(e):(c=s,b(r,e),b(t,e))},u}e.exports=function e(t,r){if(d(t))return t;if(u(t))return _({readable:t});if(l(t))return _({writable:t});if(c(t))return _({writable:!1,readable:!1});if(h(t))return _({readable:v.fromWeb(t)});if(f(t))return _({writable:E.fromWeb(t)});if("function"==typeof t){const{value:e,write:i,final:s,destroy:o}=function(e){let{promise:t,resolve:r}=A();const i=new P,s=i.signal;return{value:e(async function*(){for(;;){const e=t;t=null;const{chunk:i,done:o,cb:a}=await e;if(n.nextTick(a),o)return;if(s.aborted)throw new g(void 0,{cause:s.reason});({promise:t,resolve:r}=A()),yield i}}(),{signal:s}),write(e,t,n){const i=r;r=null,i({chunk:e,done:!1,cb:n})},final(e){const t=r;r=null,t({done:!0,cb:e})},destroy(e,t){i.abort(),t(e)}}}(t);if(a(e))return S(C,e,{objectMode:!0,write:i,final:s,destroy:o});const c=null==e?void 0:e.then;if("function"==typeof c){let t;const r=I(c,e,e=>{if(null!=e)throw new y("nully","body",e)},e=>{b(t,e)});return t=new C({objectMode:!0,readable:!1,write:i,final(e){s(async()=>{try{await r,n.nextTick(e,null)}catch(t){n.nextTick(e,t)}})},destroy:o})}throw new y("Iterable, AsyncIterable or AsyncFunction",r,e)}if(R(t))return e(t.arrayBuffer());if(a(t))return S(C,t,{objectMode:!0,writable:!1});if(h(null==t?void 0:t.readable)&&f(null==t?void 0:t.writable))return C.fromWeb(t);if("object"==typeof(null==t?void 0:t.writable)||"object"==typeof(null==t?void 0:t.readable))return _({readable:null!=t&&t.readable?u(null==t?void 0:t.readable)?null==t?void 0:t.readable:e(t.readable):void 0,writable:null!=t&&t.writable?l(null==t?void 0:t.writable)?null==t?void 0:t.writable:e(t.writable):void 0});const i=null==t?void 0:t.then;if("function"==typeof i){let e;return I(i,t,t=>{null!=t&&e.push(t),e.push(null)},t=>{b(e,t)}),e=new C({objectMode:!0,writable:!1,read(){}})}throw new m(r,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],t)}},6238(e,t,r){"use strict";const n=r(5606),{AbortError:i,codes:s}=r(6371),{ERR_INVALID_ARG_TYPE:o,ERR_STREAM_PREMATURE_CLOSE:a}=s,{kEmptyObject:c,once:u}=r(7760),{validateAbortSignal:l,validateFunction:d,validateObject:h,validateBoolean:f}=r(277),{Promise:p,PromisePrototypeThen:g,SymbolDispose:m}=r(4134),{isClosed:y,isReadable:b,isReadableNodeStream:w,isReadableStream:v,isReadableFinished:E,isReadableErrored:A,isWritable:S,isWritableNodeStream:k,isWritableStream:R,isWritableFinished:P,isWritableErrored:I,isNodeStream:C,willEmitClose:_,kIsClosedPromise:T}=r(6115);let N;const x=()=>{};function O(e,t,s){var f,p;if(2===arguments.length?(s=t,t=c):null==t?t=c:h(t,"options"),d(s,"callback"),l(t.signal,"options.signal"),s=u(s),v(e)||R(e))return function(e,t,s){let o=!1,a=x;if(t.signal)if(a=()=>{o=!0,s.call(e,new i(void 0,{cause:t.signal.reason}))},t.signal.aborted)n.nextTick(a);else{N=N||r(7760).addAbortListener;const n=N(t.signal,a),i=s;s=u((...t)=>{n[m](),i.apply(e,t)})}const c=(...t)=>{o||n.nextTick(()=>s.apply(e,t))};return g(e[T].promise,c,c),x}(e,t,s);if(!C(e))throw new o("stream",["ReadableStream","WritableStream","Stream"],e);const O=null!==(f=t.readable)&&void 0!==f?f:w(e),D=null!==(p=t.writable)&&void 0!==p?p:k(e),M=e._writableState,B=e._readableState,L=()=>{e.writable||j()};let F=_(e)&&w(e)===O&&k(e)===D,U=P(e,!1);const j=()=>{U=!0,e.destroyed&&(F=!1),(!F||e.readable&&!O)&&(O&&!z||s.call(e))};let z=E(e,!1);const q=()=>{z=!0,e.destroyed&&(F=!1),(!F||e.writable&&!D)&&(D&&!U||s.call(e))},K=t=>{s.call(e,t)};let G=y(e);const $=()=>{G=!0;const t=I(e)||A(e);return t&&"boolean"!=typeof t?s.call(e,t):O&&!z&&w(e,!0)&&!E(e,!1)?s.call(e,new a):!D||U||P(e,!1)?void s.call(e):s.call(e,new a)},V=()=>{G=!0;const t=I(e)||A(e);if(t&&"boolean"!=typeof t)return s.call(e,t);s.call(e)},H=()=>{e.req.on("finish",j)};!function(e){return e.setHeader&&"function"==typeof e.abort}(e)?D&&!M&&(e.on("end",L),e.on("close",L)):(e.on("complete",j),F||e.on("abort",$),e.req?H():e.on("request",H)),F||"boolean"!=typeof e.aborted||e.on("aborted",$),e.on("end",q),e.on("finish",j),!1!==t.error&&e.on("error",K),e.on("close",$),G?n.nextTick($):null!=M&&M.errorEmitted||null!=B&&B.errorEmitted?F||n.nextTick(V):(O||F&&!b(e)||!U&&!1!==S(e))&&(D||F&&!S(e)||!z&&!1!==b(e))?B&&e.req&&e.aborted&&n.nextTick(V):n.nextTick(V);const W=()=>{s=x,e.removeListener("aborted",$),e.removeListener("complete",j),e.removeListener("abort",$),e.removeListener("request",H),e.req&&e.req.removeListener("finish",j),e.removeListener("end",L),e.removeListener("close",L),e.removeListener("finish",j),e.removeListener("end",q),e.removeListener("error",K),e.removeListener("close",$)};if(t.signal&&!G){const o=()=>{const r=s;W(),r.call(e,new i(void 0,{cause:t.signal.reason}))};if(t.signal.aborted)n.nextTick(o);else{N=N||r(7760).addAbortListener;const n=N(t.signal,o),i=s;s=u((...t)=>{n[m](),i.apply(e,t)})}}return W}e.exports=O,e.exports.finished=function(e,t){var r;let n=!1;return null===t&&(t=c),null!==(r=t)&&void 0!==r&&r.cleanup&&(f(t.cleanup,"cleanup"),n=t.cleanup),new p((r,i)=>{const s=O(e,t,e=>{n&&s(),e?i(e):r()})})}},6532(e,t,r){"use strict";const n=r(5606),{PromisePrototypeThen:i,SymbolAsyncIterator:s,SymbolIterator:o}=r(4134),{Buffer:a}=r(8287),{ERR_INVALID_ARG_TYPE:c,ERR_STREAM_NULL_VALUES:u}=r(6371).codes;e.exports=function(e,t,r){let l,d;if("string"==typeof t||t instanceof a)return new e({objectMode:!0,...r,read(){this.push(t),this.push(null)}});if(t&&t[s])d=!0,l=t[s]();else{if(!t||!t[o])throw new c("iterable",["Iterable"],t);d=!1,l=t[o]()}const h=new e({objectMode:!0,highWaterMark:1,...r});let f=!1;return h._read=function(){f||(f=!0,async function(){for(;;){try{const{value:e,done:t}=d?await l.next():l.next();if(t)h.push(null);else{const t=e&&"function"==typeof e.then?await e:e;if(null===t)throw f=!1,new u;if(h.push(t))continue;f=!1}}catch(e){h.destroy(e)}break}}())},h._destroy=function(e,t){i(async function(e){const t=null!=e,r="function"==typeof l.throw;if(t&&r){const{value:t,done:r}=await l.throw(e);if(await t,r)return}if("function"==typeof l.return){const{value:e}=await l.return();await e}}(e),()=>n.nextTick(t,e),r=>n.nextTick(t,r||e))},h}},4259(e,t,r){"use strict";const{ArrayIsArray:n,ObjectSetPrototypeOf:i}=r(4134),{EventEmitter:s}=r(7007);function o(e){s.call(this,e)}function a(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?n(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}i(o.prototype,s.prototype),i(o,s),o.prototype.pipe=function(e,t){const r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",i),e._isStdio||t&&!1===t.end||(r.on("end",c),r.on("close",u));let o=!1;function c(){o||(o=!0,e.end())}function u(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){d(),0===s.listenerCount(this,"error")&&this.emit("error",e)}function d(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",c),r.removeListener("close",u),r.removeListener("error",l),e.removeListener("error",l),r.removeListener("end",d),r.removeListener("close",d),e.removeListener("close",d)}return a(r,"error",l),a(e,"error",l),r.on("end",d),r.on("close",d),e.on("close",d),e.emit("pipe",r),e},e.exports={Stream:o,prependListener:a}},823(e,t,r){"use strict";const n=globalThis.AbortController||r(5568).AbortController,{codes:{ERR_INVALID_ARG_VALUE:i,ERR_INVALID_ARG_TYPE:s,ERR_MISSING_ARGS:o,ERR_OUT_OF_RANGE:a},AbortError:c}=r(6371),{validateAbortSignal:u,validateInteger:l,validateObject:d}=r(277),h=r(4134).Symbol("kWeak"),f=r(4134).Symbol("kResistStopPropagation"),{finished:p}=r(6238),g=r(7830),{addAbortSignalNoValidate:m}=r(4147),{isWritable:y,isNodeStream:b}=r(6115),{deprecate:w}=r(7760),{ArrayPrototypePush:v,Boolean:E,MathFloor:A,Number:S,NumberIsNaN:k,Promise:R,PromiseReject:P,PromiseResolve:I,PromisePrototypeThen:C,Symbol:_}=r(4134),T=_("kEmpty"),N=_("kEof");function x(e,t){if("function"!=typeof e)throw new s("fn",["Function","AsyncFunction"],e);null!=t&&d(t,"options"),null!=(null==t?void 0:t.signal)&&u(t.signal,"options.signal");let n=1;null!=(null==t?void 0:t.concurrency)&&(n=A(t.concurrency));let i=n-1;return null!=(null==t?void 0:t.highWaterMark)&&(i=A(t.highWaterMark)),l(n,"options.concurrency",1),l(i,"options.highWaterMark",0),i+=n,async function*(){const s=r(7760).AbortSignalAny([null==t?void 0:t.signal].filter(E)),o=this,a=[],u={signal:s};let l,d,h=!1,f=0;function p(){h=!0,g()}function g(){f-=1,m()}function m(){d&&!h&&f<n&&a.length<i&&(d(),d=null)}!async function(){try{for await(let t of o){if(h)return;if(s.aborted)throw new c;try{if(t=e(t,u),t===T)continue;t=I(t)}catch(e){t=P(e)}f+=1,C(t,g,p),a.push(t),l&&(l(),l=null),!h&&(a.length>=i||f>=n)&&await new R(e=>{d=e})}a.push(N)}catch(e){const t=P(e);C(t,g,p),a.push(t)}finally{h=!0,l&&(l(),l=null)}}();try{for(;;){for(;a.length>0;){const e=await a[0];if(e===N)return;if(s.aborted)throw new c;e!==T&&(yield e),a.shift(),m()}await new R(e=>{l=e})}}finally{h=!0,d&&(d(),d=null)}}.call(this)}async function O(e,t=void 0){for await(const r of D.call(this,e,t))return!0;return!1}function D(e,t){if("function"!=typeof e)throw new s("fn",["Function","AsyncFunction"],e);return x.call(this,async function(t,r){return await e(t,r)?t:T},t)}class M extends o{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}function B(e){if(e=S(e),k(e))return 0;if(e<0)throw new a("number",">= 0",e);return e}e.exports.streamReturningOperators={asIndexedPairs:w(function(e=void 0){return null!=e&&d(e,"options"),null!=(null==e?void 0:e.signal)&&u(e.signal,"options.signal"),async function*(){let t=0;for await(const n of this){var r;if(null!=e&&null!==(r=e.signal)&&void 0!==r&&r.aborted)throw new c({cause:e.signal.reason});yield[t++,n]}}.call(this)},"readable.asIndexedPairs will be removed in a future version."),drop:function(e,t=void 0){return null!=t&&d(t,"options"),null!=(null==t?void 0:t.signal)&&u(t.signal,"options.signal"),e=B(e),async function*(){var r;if(null!=t&&null!==(r=t.signal)&&void 0!==r&&r.aborted)throw new c;for await(const r of this){var n;if(null!=t&&null!==(n=t.signal)&&void 0!==n&&n.aborted)throw new c;e--<=0&&(yield r)}}.call(this)},filter:D,flatMap:function(e,t){const r=x.call(this,e,t);return async function*(){for await(const e of r)yield*e}.call(this)},map:x,take:function(e,t=void 0){return null!=t&&d(t,"options"),null!=(null==t?void 0:t.signal)&&u(t.signal,"options.signal"),e=B(e),async function*(){var r;if(null!=t&&null!==(r=t.signal)&&void 0!==r&&r.aborted)throw new c;for await(const r of this){var n;if(null!=t&&null!==(n=t.signal)&&void 0!==n&&n.aborted)throw new c;if(e-- >0&&(yield r),e<=0)return}}.call(this)},compose:function(e,t){if(null!=t&&d(t,"options"),null!=(null==t?void 0:t.signal)&&u(t.signal,"options.signal"),b(e)&&!y(e))throw new i("stream",e,"must be writable");const r=g(this,e);return null!=t&&t.signal&&m(t.signal,r),r}},e.exports.promiseReturningOperators={every:async function(e,t=void 0){if("function"!=typeof e)throw new s("fn",["Function","AsyncFunction"],e);return!await O.call(this,async(...t)=>!await e(...t),t)},forEach:async function(e,t){if("function"!=typeof e)throw new s("fn",["Function","AsyncFunction"],e);for await(const r of x.call(this,async function(t,r){return await e(t,r),T},t));},reduce:async function(e,t,r){var i;if("function"!=typeof e)throw new s("reducer",["Function","AsyncFunction"],e);null!=r&&d(r,"options"),null!=(null==r?void 0:r.signal)&&u(r.signal,"options.signal");let o=arguments.length>1;if(null!=r&&null!==(i=r.signal)&&void 0!==i&&i.aborted){const e=new c(void 0,{cause:r.signal.reason});throw this.once("error",()=>{}),await p(this.destroy(e)),e}const a=new n,l=a.signal;if(null!=r&&r.signal){const e={once:!0,[h]:this,[f]:!0};r.signal.addEventListener("abort",()=>a.abort(),e)}let g=!1;try{for await(const n of this){var m;if(g=!0,null!=r&&null!==(m=r.signal)&&void 0!==m&&m.aborted)throw new c;o?t=await e(t,n,{signal:l}):(t=n,o=!0)}if(!g&&!o)throw new M}finally{a.abort()}return t},toArray:async function(e){null!=e&&d(e,"options"),null!=(null==e?void 0:e.signal)&&u(e.signal,"options.signal");const t=[];for await(const n of this){var r;if(null!=e&&null!==(r=e.signal)&&void 0!==r&&r.aborted)throw new c(void 0,{cause:e.signal.reason});v(t,n)}return t},some:O,find:async function(e,t){for await(const r of D.call(this,e,t))return r}}},6524(e,t,r){"use strict";const{ObjectSetPrototypeOf:n}=r(4134);e.exports=s;const i=r(7382);function s(e){if(!(this instanceof s))return new s(e);i.call(this,e)}n(s.prototype,i.prototype),n(s,i),s.prototype._transform=function(e,t,r){r(null,e)}},7758(e,t,r){const n=r(5606),{ArrayIsArray:i,Promise:s,SymbolAsyncIterator:o,SymbolDispose:a}=r(4134),c=r(6238),{once:u}=r(7760),l=r(5896),d=r(3370),{aggregateTwoErrors:h,codes:{ERR_INVALID_ARG_TYPE:f,ERR_INVALID_RETURN_VALUE:p,ERR_MISSING_ARGS:g,ERR_STREAM_DESTROYED:m,ERR_STREAM_PREMATURE_CLOSE:y},AbortError:b}=r(6371),{validateFunction:w,validateAbortSignal:v}=r(277),{isIterable:E,isReadable:A,isReadableNodeStream:S,isNodeStream:k,isTransformStream:R,isWebStream:P,isReadableStream:I,isReadableFinished:C}=r(6115),_=globalThis.AbortController||r(5568).AbortController;let T,N,x;function O(e,t,r){let n=!1;return e.on("close",()=>{n=!0}),{destroy:t=>{n||(n=!0,l.destroyer(e,t||new m("pipe")))},cleanup:c(e,{readable:t,writable:r},e=>{n=!e})}}function D(e){if(E(e))return e;if(S(e))return async function*(e){N||(N=r(7576)),yield*N.prototype[o].call(e)}(e);throw new f("val",["Readable","Iterable","AsyncIterable"],e)}async function M(e,t,r,{end:n}){let i,o=null;const a=e=>{if(e&&(i=e),o){const e=o;o=null,e()}},u=()=>new s((e,t)=>{i?t(i):o=()=>{i?t(i):e()}});t.on("drain",a);const l=c(t,{readable:!1},a);try{t.writableNeedDrain&&await u();for await(const r of e)t.write(r)||await u();n&&(t.end(),await u()),r()}catch(e){r(i!==e?h(i,e):e)}finally{l(),t.off("drain",a)}}async function B(e,t,r,{end:n}){R(t)&&(t=t.writable);const i=t.getWriter();try{for await(const t of e)await i.ready,i.write(t).catch(()=>{});await i.ready,n&&await i.close(),r()}catch(e){try{await i.abort(e),r(e)}catch(e){r(e)}}}function L(e,t,s){if(1===e.length&&i(e[0])&&(e=e[0]),e.length<2)throw new g("streams");const o=new _,c=o.signal,u=null==s?void 0:s.signal,l=[];function h(){j(new b)}let m,y,w;v(u,"options.signal"),x=x||r(7760).addAbortListener,u&&(m=x(u,h));const C=[];let N,L=0;function U(e){j(e,0===--L)}function j(e,r){var i;if(!e||y&&"ERR_STREAM_PREMATURE_CLOSE"!==y.code||(y=e),y||r){for(;C.length;)C.shift()(y);null===(i=m)||void 0===i||i[a](),o.abort(),r&&(y||l.forEach(e=>e()),n.nextTick(t,y,w))}}for(let G=0;G<e.length;G++){const $=e[G],V=G<e.length-1,H=G>0,W=V||!1!==(null==s?void 0:s.end),J=G===e.length-1;if(k($)){if(W){const{destroy:Z,cleanup:Q}=O($,V,H);C.push(Z),A($)&&J&&l.push(Q)}function z(e){e&&"AbortError"!==e.name&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code&&U(e)}$.on("error",z),A($)&&J&&l.push(()=>{$.removeListener("error",z)})}if(0===G)if("function"==typeof $){if(N=$({signal:c}),!E(N))throw new p("Iterable, AsyncIterable or Stream","source",N)}else N=E($)||S($)||R($)?$:d.from($);else if("function"==typeof $){var q;if(N=R(N)?D(null===(q=N)||void 0===q?void 0:q.readable):D(N),N=$(N,{signal:c}),V){if(!E(N,!0))throw new p("AsyncIterable",`transform[${G-1}]`,N)}else{var K;T||(T=r(6524));const Y=new T({objectMode:!0}),X=null===(K=N)||void 0===K?void 0:K.then;if("function"==typeof X)L++,X.call(N,e=>{w=e,null!=e&&Y.write(e),W&&Y.end(),n.nextTick(U)},e=>{Y.destroy(e),n.nextTick(U,e)});else if(E(N,!0))L++,M(N,Y,U,{end:W});else{if(!I(N)&&!R(N))throw new p("AsyncIterable or Promise","destination",N);{const re=N.readable||N;L++,M(re,Y,U,{end:W})}}N=Y;const{destroy:ee,cleanup:te}=O(N,!1,!0);C.push(ee),J&&l.push(te)}}else if(k($)){if(S(N)){L+=2;const ne=F(N,$,U,{end:W});A($)&&J&&l.push(ne)}else if(R(N)||I(N)){const ie=N.readable||N;L++,M(ie,$,U,{end:W})}else{if(!E(N))throw new f("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],N);L++,M(N,$,U,{end:W})}N=$}else if(P($)){if(S(N))L++,B(D(N),$,U,{end:W});else if(I(N)||E(N))L++,B(N,$,U,{end:W});else{if(!R(N))throw new f("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],N);L++,B(N.readable,$,U,{end:W})}N=$}else N=d.from($)}return(null!=c&&c.aborted||null!=u&&u.aborted)&&n.nextTick(h),N}function F(e,t,r,{end:i}){let s=!1;if(t.on("close",()=>{s||r(new y)}),e.pipe(t,{end:!1}),i){function o(){s=!0,t.end()}C(e)?n.nextTick(o):e.once("end",o)}else r();return c(e,{readable:!0,writable:!1},t=>{const n=e._readableState;t&&"ERR_STREAM_PREMATURE_CLOSE"===t.code&&n&&n.ended&&!n.errored&&!n.errorEmitted?e.once("end",r).once("error",r):r(t)}),c(t,{readable:!1,writable:!0},r)}e.exports={pipelineImpl:L,pipeline:function(...e){return L(e,u(function(e){return w(e[e.length-1],"streams[stream.length - 1]"),e.pop()}(e)))}}},7576(e,t,r){"use strict";const n=r(5606),{ArrayPrototypeIndexOf:i,NumberIsInteger:s,NumberIsNaN:o,NumberParseInt:a,ObjectDefineProperties:c,ObjectKeys:u,ObjectSetPrototypeOf:l,Promise:d,SafeSet:h,SymbolAsyncDispose:f,SymbolAsyncIterator:p,Symbol:g}=r(4134);e.exports=q,q.ReadableState=z;const{EventEmitter:m}=r(7007),{Stream:y,prependListener:b}=r(4259),{Buffer:w}=r(8287),{addAbortSignal:v}=r(4147),E=r(6238);let A=r(7760).debuglog("stream",e=>{A=e});const S=r(345),k=r(5896),{getHighWaterMark:R,getDefaultHighWaterMark:P}=r(5291),{aggregateTwoErrors:I,codes:{ERR_INVALID_ARG_TYPE:C,ERR_METHOD_NOT_IMPLEMENTED:_,ERR_OUT_OF_RANGE:T,ERR_STREAM_PUSH_AFTER_EOF:N,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:x},AbortError:O}=r(6371),{validateObject:D}=r(277),M=g("kPaused"),{StringDecoder:B}=r(3141),L=r(6532);l(q.prototype,y.prototype),l(q,y);const F=()=>{},{errorOrDestroy:U}=k;function j(e){return{enumerable:!1,get(){return 0!==(this.state&e)},set(t){t?this.state|=e:this.state&=~e}}}function z(e,t,n){"boolean"!=typeof n&&(n=t instanceof r(3370)),this.state=6192,e&&e.objectMode&&(this.state|=1),n&&e&&e.readableObjectMode&&(this.state|=1),this.highWaterMark=e?R(this,e,"readableHighWaterMark",n):P(!1),this.buffer=new S,this.length=0,this.pipes=[],this.flowing=null,this[M]=null,e&&!1===e.emitClose&&(this.state&=-2049),e&&!1===e.autoDestroy&&(this.state&=-4097),this.errored=null,this.defaultEncoding=e&&e.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,e&&e.encoding&&(this.decoder=new B(e.encoding),this.encoding=e.encoding)}function q(e){if(!(this instanceof q))return new q(e);const t=this instanceof r(3370);this._readableState=new z(e,this,t),e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.construct&&(this._construct=e.construct),e.signal&&!t&&v(e.signal,this)),y.call(this,e),k.construct(this,()=>{this._readableState.needReadable&&W(this,this._readableState)})}function K(e,t,r,n){A("readableAddChunk",t);const i=e._readableState;let s;if(1&i.state||("string"==typeof t?(r=r||i.defaultEncoding,i.encoding!==r&&(n&&i.encoding?t=w.from(t,r).toString(i.encoding):(t=w.from(t,r),r=""))):t instanceof w?r="":y._isUint8Array(t)?(t=y._uint8ArrayToBuffer(t),r=""):null!=t&&(s=new C("chunk",["string","Buffer","Uint8Array"],t))),s)U(e,s);else if(null===t)i.state&=-9,function(e,t){if(A("onEofChunk"),!t.ended){if(t.decoder){const e=t.decoder.end();e&&e.length&&(t.buffer.push(e),t.length+=t.objectMode?1:e.length)}t.ended=!0,t.sync?V(e):(t.needReadable=!1,t.emittedReadable=!0,H(e))}}(e,i);else if(1&i.state||t&&t.length>0)if(n)if(4&i.state)U(e,new x);else{if(i.destroyed||i.errored)return!1;G(e,i,t,!0)}else if(i.ended)U(e,new N);else{if(i.destroyed||i.errored)return!1;i.state&=-9,i.decoder&&!r?(t=i.decoder.write(t),i.objectMode||0!==t.length?G(e,i,t,!1):W(e,i)):G(e,i,t,!1)}else n||(i.state&=-9,W(e,i));return!i.ended&&(i.length<i.highWaterMark||0===i.length)}function G(e,t,r,n){t.flowing&&0===t.length&&!t.sync&&e.listenerCount("data")>0?(65536&t.state?t.awaitDrainWriters.clear():t.awaitDrainWriters=null,t.dataEmitted=!0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),64&t.state&&V(e)),W(e,t)}function $(e,t){return e<=0||0===t.length&&t.ended?0:1&t.state?1:o(e)?t.flowing&&t.length?t.buffer.first().length:t.length:e<=t.length?e:t.ended?t.length:0}function V(e){const t=e._readableState;A("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(A("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(H,e))}function H(e){const t=e._readableState;A("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||t.errored||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,X(e)}function W(e,t){!t.readingMore&&t.constructed&&(t.readingMore=!0,n.nextTick(J,e,t))}function J(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){const r=t.length;if(A("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function Z(e){const t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!1===t[M]?t.flowing=!0:e.listenerCount("data")>0?e.resume():t.readableListening||(t.flowing=null)}function Q(e){A("readable nexttick read 0"),e.read(0)}function Y(e,t){A("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),X(e),t.flowing&&!t.reading&&e.read(0)}function X(e){const t=e._readableState;for(A("flow",t.flowing);t.flowing&&null!==e.read(););}function ee(e,t){"function"!=typeof e.read&&(e=q.wrap(e,{objectMode:!0}));const r=async function*(e,t){let r,n=F;function i(t){this===e?(n(),n=F):n=t}e.on("readable",i);const s=E(e,{writable:!1},e=>{r=e?I(r,e):null,n(),n=F});try{for(;;){const t=e.destroyed?null:e.read();if(null!==t)yield t;else{if(r)throw r;if(null===r)return;await new d(i)}}}catch(e){throw r=I(r,e),r}finally{!r&&!1===(null==t?void 0:t.destroyOnReturn)||void 0!==r&&!e._readableState.autoDestroy?(e.off("readable",i),s()):k.destroyer(e,null)}}(e,t);return r.stream=e,r}function te(e,t){if(0===t.length)return null;let r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function re(e){const t=e._readableState;A("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(ne,t,e))}function ne(e,t){if(A("endReadableNT",e.endEmitted,e.length),!e.errored&&!e.closeEmitted&&!e.endEmitted&&0===e.length)if(e.endEmitted=!0,t.emit("end"),t.writable&&!1===t.allowHalfOpen)n.nextTick(ie,t);else if(e.autoDestroy){const e=t._writableState;(!e||e.autoDestroy&&(e.finished||!1===e.writable))&&t.destroy()}}function ie(e){e.writable&&!e.writableEnded&&!e.destroyed&&e.end()}let se;function oe(){return void 0===se&&(se={}),se}c(z.prototype,{objectMode:j(1),ended:j(2),endEmitted:j(4),reading:j(8),constructed:j(16),sync:j(32),needReadable:j(64),emittedReadable:j(128),readableListening:j(256),resumeScheduled:j(512),errorEmitted:j(1024),emitClose:j(2048),autoDestroy:j(4096),destroyed:j(8192),closed:j(16384),closeEmitted:j(32768),multiAwaitDrain:j(65536),readingMore:j(1<<17),dataEmitted:j(1<<18)}),q.prototype.destroy=k.destroy,q.prototype._undestroy=k.undestroy,q.prototype._destroy=function(e,t){t(e)},q.prototype[m.captureRejectionSymbol]=function(e){this.destroy(e)},q.prototype[f]=function(){let e;return this.destroyed||(e=this.readableEnded?null:new O,this.destroy(e)),new d((t,r)=>E(this,n=>n&&n!==e?r(n):t(null)))},q.prototype.push=function(e,t){return K(this,e,t,!1)},q.prototype.unshift=function(e,t){return K(this,e,t,!0)},q.prototype.isPaused=function(){const e=this._readableState;return!0===e[M]||!1===e.flowing},q.prototype.setEncoding=function(e){const t=new B(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;const r=this._readableState.buffer;let n="";for(const e of r)n+=t.write(e);return r.clear(),""!==n&&r.push(n),this._readableState.length=n.length,this},q.prototype.read=function(e){A("read",e),void 0===e?e=NaN:s(e)||(e=a(e,10));const t=this._readableState,r=e;if(e>t.highWaterMark&&(t.highWaterMark=function(e){if(e>1073741824)throw new T("size","<= 1GiB",e);return e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,++e}(e)),0!==e&&(t.state&=-129),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return A("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?re(this):V(this),null;if(0===(e=$(e,t))&&t.ended)return 0===t.length&&re(this),null;let n,i=!!(64&t.state);if(A("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&(i=!0,A("length less than watermark",i)),t.ended||t.reading||t.destroyed||t.errored||!t.constructed)i=!1,A("reading, ended or constructing",i);else if(i){A("do read"),t.state|=40,0===t.length&&(t.state|=64);try{this._read(t.highWaterMark)}catch(e){U(this,e)}t.state&=-33,t.reading||(e=$(r,t))}return n=e>0?te(e,t):null,null===n?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.multiAwaitDrain?t.awaitDrainWriters.clear():t.awaitDrainWriters=null),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&re(this)),null===n||t.errorEmitted||t.closeEmitted||(t.dataEmitted=!0,this.emit("data",n)),n},q.prototype._read=function(e){throw new _("_read()")},q.prototype.pipe=function(e,t){const r=this,i=this._readableState;1===i.pipes.length&&(i.multiAwaitDrain||(i.multiAwaitDrain=!0,i.awaitDrainWriters=new h(i.awaitDrainWriters?[i.awaitDrainWriters]:[]))),i.pipes.push(e),A("pipe count=%d opts=%j",i.pipes.length,t);const s=t&&!1===t.end||e===n.stdout||e===n.stderr?g:o;function o(){A("onend"),e.end()}let a;i.endEmitted?n.nextTick(s):r.once("end",s),e.on("unpipe",function t(n,s){A("onunpipe"),n===r&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,A("cleanup"),e.removeListener("close",f),e.removeListener("finish",p),a&&e.removeListener("drain",a),e.removeListener("error",d),e.removeListener("unpipe",t),r.removeListener("end",o),r.removeListener("end",g),r.removeListener("data",l),c=!0,a&&i.awaitDrainWriters&&(!e._writableState||e._writableState.needDrain)&&a())});let c=!1;function u(){c||(1===i.pipes.length&&i.pipes[0]===e?(A("false write response, pause",0),i.awaitDrainWriters=e,i.multiAwaitDrain=!1):i.pipes.length>1&&i.pipes.includes(e)&&(A("false write response, pause",i.awaitDrainWriters.size),i.awaitDrainWriters.add(e)),r.pause()),a||(a=function(e,t){return function(){const r=e._readableState;r.awaitDrainWriters===t?(A("pipeOnDrain",1),r.awaitDrainWriters=null):r.multiAwaitDrain&&(A("pipeOnDrain",r.awaitDrainWriters.size),r.awaitDrainWriters.delete(t)),r.awaitDrainWriters&&0!==r.awaitDrainWriters.size||!e.listenerCount("data")||e.resume()}}(r,e),e.on("drain",a))}function l(t){A("ondata");const r=e.write(t);A("dest.write",r),!1===r&&u()}function d(t){if(A("onerror",t),g(),e.removeListener("error",d),0===e.listenerCount("error")){const r=e._writableState||e._readableState;r&&!r.errorEmitted?U(e,t):e.emit("error",t)}}function f(){e.removeListener("finish",p),g()}function p(){A("onfinish"),e.removeListener("close",f),g()}function g(){A("unpipe"),r.unpipe(e)}return r.on("data",l),b(e,"error",d),e.once("close",f),e.once("finish",p),e.emit("pipe",r),!0===e.writableNeedDrain?u():i.flowing||(A("pipe resume"),r.resume()),e},q.prototype.unpipe=function(e){const t=this._readableState;if(0===t.pipes.length)return this;if(!e){const e=t.pipes;t.pipes=[],this.pause();for(let t=0;t<e.length;t++)e[t].emit("unpipe",this,{hasUnpiped:!1});return this}const r=i(t.pipes,e);return-1===r||(t.pipes.splice(r,1),0===t.pipes.length&&this.pause(),e.emit("unpipe",this,{hasUnpiped:!1})),this},q.prototype.on=function(e,t){const r=y.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,A("on readable",i.length,i.reading),i.length?V(this):i.reading||n.nextTick(Q,this))),r},q.prototype.addListener=q.prototype.on,q.prototype.removeListener=function(e,t){const r=y.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(Z,this),r},q.prototype.off=q.prototype.removeListener,q.prototype.removeAllListeners=function(e){const t=y.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||n.nextTick(Z,this),t},q.prototype.resume=function(){const e=this._readableState;return e.flowing||(A("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(Y,e,t))}(this,e)),e[M]=!1,this},q.prototype.pause=function(){return A("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(A("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[M]=!0,this},q.prototype.wrap=function(e){let t=!1;e.on("data",r=>{!this.push(r)&&e.pause&&(t=!0,e.pause())}),e.on("end",()=>{this.push(null)}),e.on("error",e=>{U(this,e)}),e.on("close",()=>{this.destroy()}),e.on("destroy",()=>{this.destroy()}),this._read=()=>{t&&e.resume&&(t=!1,e.resume())};const r=u(e);for(let t=1;t<r.length;t++){const n=r[t];void 0===this[n]&&"function"==typeof e[n]&&(this[n]=e[n].bind(e))}return this},q.prototype[p]=function(){return ee(this)},q.prototype.iterator=function(e){return void 0!==e&&D(e,"options"),ee(this,e)},c(q.prototype,{readable:{__proto__:null,get(){const e=this._readableState;return!(!e||!1===e.readable||e.destroyed||e.errorEmitted||e.endEmitted)},set(e){this._readableState&&(this._readableState.readable=!!e)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!(!1===this._readableState.readable||!this._readableState.destroyed&&!this._readableState.errored||this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.objectMode}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return!!this._readableState&&this._readableState.closed}},destroyed:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.destroyed},set(e){this._readableState&&(this._readableState.destroyed=e)}},readableEnded:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.endEmitted}}}),c(z.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return!1!==this[M]},set(e){this[M]=!!e}}}),q._fromList=te,q.from=function(e,t){return L(q,e,t)},q.fromWeb=function(e,t){return oe().newStreamReadableFromReadableStream(e,t)},q.toWeb=function(e,t){return oe().newReadableStreamFromStreamReadable(e,t)},q.wrap=function(e,t){var r,n;return new q({objectMode:null===(r=null!==(n=e.readableObjectMode)&&void 0!==n?n:e.objectMode)||void 0===r||r,...t,destroy(t,r){k.destroyer(e,t),r(t)}}).wrap(e)}},5291(e,t,r){"use strict";const{MathFloor:n,NumberIsInteger:i}=r(4134),{validateInteger:s}=r(277),{ERR_INVALID_ARG_VALUE:o}=r(6371).codes;let a=16384,c=16;function u(e){return e?c:a}e.exports={getHighWaterMark:function(e,t,r,s){const a=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,s,r);if(null!=a){if(!i(a)||a<0)throw new o(s?`options.${r}`:"options.highWaterMark",a);return n(a)}return u(e.objectMode)},getDefaultHighWaterMark:u,setDefaultHighWaterMark:function(e,t){s(t,"value",0),e?c=t:a=t}}},7382(e,t,r){"use strict";const{ObjectSetPrototypeOf:n,Symbol:i}=r(4134);e.exports=u;const{ERR_METHOD_NOT_IMPLEMENTED:s}=r(6371).codes,o=r(3370),{getHighWaterMark:a}=r(5291);n(u.prototype,o.prototype),n(u,o);const c=i("kCallback");function u(e){if(!(this instanceof u))return new u(e);const t=e?a(this,e,"readableHighWaterMark",!0):null;0===t&&(e={...e,highWaterMark:null,readableHighWaterMark:t,writableHighWaterMark:e.writableHighWaterMark||0}),o.call(this,e),this._readableState.sync=!1,this[c]=null,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function l(e){"function"!=typeof this._flush||this.destroyed?(this.push(null),e&&e()):this._flush((t,r)=>{t?e?e(t):this.destroy(t):(null!=r&&this.push(r),this.push(null),e&&e())})}function d(){this._final!==l&&l.call(this)}u.prototype._final=l,u.prototype._transform=function(e,t,r){throw new s("_transform()")},u.prototype._write=function(e,t,r){const n=this._readableState,i=this._writableState,s=n.length;this._transform(e,t,(e,t)=>{e?r(e):(null!=t&&this.push(t),i.ended||s===n.length||n.length<n.highWaterMark?r():this[c]=r)})},u.prototype._read=function(){if(this[c]){const e=this[c];this[c]=null,e()}}},6115(e,t,r){"use strict";const{SymbolAsyncIterator:n,SymbolIterator:i,SymbolFor:s}=r(4134),o=s("nodejs.stream.destroyed"),a=s("nodejs.stream.errored"),c=s("nodejs.stream.readable"),u=s("nodejs.stream.writable"),l=s("nodejs.stream.disturbed"),d=s("nodejs.webstream.isClosedPromise"),h=s("nodejs.webstream.controllerErrorFunction");function f(e,t=!1){var r;return!(!e||"function"!=typeof e.pipe||"function"!=typeof e.on||t&&("function"!=typeof e.pause||"function"!=typeof e.resume)||e._writableState&&!1===(null===(r=e._readableState)||void 0===r?void 0:r.readable)||e._writableState&&!e._readableState)}function p(e){var t;return!(!e||"function"!=typeof e.write||"function"!=typeof e.on||e._readableState&&!1===(null===(t=e._writableState)||void 0===t?void 0:t.writable))}function g(e){return e&&(e._readableState||e._writableState||"function"==typeof e.write&&"function"==typeof e.on||"function"==typeof e.pipe&&"function"==typeof e.on)}function m(e){return!(!e||g(e)||"function"!=typeof e.pipeThrough||"function"!=typeof e.getReader||"function"!=typeof e.cancel)}function y(e){return!(!e||g(e)||"function"!=typeof e.getWriter||"function"!=typeof e.abort)}function b(e){return!(!e||g(e)||"object"!=typeof e.readable||"object"!=typeof e.writable)}function w(e){if(!g(e))return null;const t=e._writableState,r=e._readableState,n=t||r;return!!(e.destroyed||e[o]||null!=n&&n.destroyed)}function v(e){if(!p(e))return null;if(!0===e.writableEnded)return!0;const t=e._writableState;return(null==t||!t.errored)&&("boolean"!=typeof(null==t?void 0:t.ended)?null:t.ended)}function E(e,t){if(!f(e))return null;const r=e._readableState;return(null==r||!r.errored)&&("boolean"!=typeof(null==r?void 0:r.endEmitted)?null:!!(r.endEmitted||!1===t&&!0===r.ended&&0===r.length))}function A(e){return e&&null!=e[c]?e[c]:"boolean"!=typeof(null==e?void 0:e.readable)?null:!w(e)&&f(e)&&e.readable&&!E(e)}function S(e){return e&&null!=e[u]?e[u]:"boolean"!=typeof(null==e?void 0:e.writable)?null:!w(e)&&p(e)&&e.writable&&!v(e)}function k(e){return"boolean"==typeof e._closed&&"boolean"==typeof e._defaultKeepAlive&&"boolean"==typeof e._removedConnection&&"boolean"==typeof e._removedContLen}function R(e){return"boolean"==typeof e._sent100&&k(e)}e.exports={isDestroyed:w,kIsDestroyed:o,isDisturbed:function(e){var t;return!(!e||!(null!==(t=e[l])&&void 0!==t?t:e.readableDidRead||e.readableAborted))},kIsDisturbed:l,isErrored:function(e){var t,r,n,i,s,o,c,u,l,d;return!(!e||!(null!==(t=null!==(r=null!==(n=null!==(i=null!==(s=null!==(o=e[a])&&void 0!==o?o:e.readableErrored)&&void 0!==s?s:e.writableErrored)&&void 0!==i?i:null===(c=e._readableState)||void 0===c?void 0:c.errorEmitted)&&void 0!==n?n:null===(u=e._writableState)||void 0===u?void 0:u.errorEmitted)&&void 0!==r?r:null===(l=e._readableState)||void 0===l?void 0:l.errored)&&void 0!==t?t:null===(d=e._writableState)||void 0===d?void 0:d.errored))},kIsErrored:a,isReadable:A,kIsReadable:c,kIsClosedPromise:d,kControllerErrorFunction:h,kIsWritable:u,isClosed:function(e){if(!g(e))return null;if("boolean"==typeof e.closed)return e.closed;const t=e._writableState,r=e._readableState;return"boolean"==typeof(null==t?void 0:t.closed)||"boolean"==typeof(null==r?void 0:r.closed)?(null==t?void 0:t.closed)||(null==r?void 0:r.closed):"boolean"==typeof e._closed&&k(e)?e._closed:null},isDuplexNodeStream:function(e){return!(!e||"function"!=typeof e.pipe||!e._readableState||"function"!=typeof e.on||"function"!=typeof e.write)},isFinished:function(e,t){return g(e)?!(!w(e)&&(!1!==(null==t?void 0:t.readable)&&A(e)||!1!==(null==t?void 0:t.writable)&&S(e))):null},isIterable:function(e,t){return null!=e&&(!0===t?"function"==typeof e[n]:!1===t?"function"==typeof e[i]:"function"==typeof e[n]||"function"==typeof e[i])},isReadableNodeStream:f,isReadableStream:m,isReadableEnded:function(e){if(!f(e))return null;if(!0===e.readableEnded)return!0;const t=e._readableState;return!(!t||t.errored)&&("boolean"!=typeof(null==t?void 0:t.ended)?null:t.ended)},isReadableFinished:E,isReadableErrored:function(e){var t,r;return g(e)?e.readableErrored?e.readableErrored:null!==(t=null===(r=e._readableState)||void 0===r?void 0:r.errored)&&void 0!==t?t:null:null},isNodeStream:g,isWebStream:function(e){return m(e)||y(e)||b(e)},isWritable:S,isWritableNodeStream:p,isWritableStream:y,isWritableEnded:v,isWritableFinished:function(e,t){if(!p(e))return null;if(!0===e.writableFinished)return!0;const r=e._writableState;return(null==r||!r.errored)&&("boolean"!=typeof(null==r?void 0:r.finished)?null:!!(r.finished||!1===t&&!0===r.ended&&0===r.length))},isWritableErrored:function(e){var t,r;return g(e)?e.writableErrored?e.writableErrored:null!==(t=null===(r=e._writableState)||void 0===r?void 0:r.errored)&&void 0!==t?t:null:null},isServerRequest:function(e){var t;return"boolean"==typeof e._consuming&&"boolean"==typeof e._dumped&&void 0===(null===(t=e.req)||void 0===t?void 0:t.upgradeOrConnect)},isServerResponse:R,willEmitClose:function(e){if(!g(e))return null;const t=e._writableState,r=e._readableState,n=t||r;return!n&&R(e)||!!(n&&n.autoDestroy&&n.emitClose&&!1===n.closed)},isTransformStream:b}},8584(e,t,r){"use strict";const n=r(5606),{ArrayPrototypeSlice:i,Error:s,FunctionPrototypeSymbolHasInstance:o,ObjectDefineProperty:a,ObjectDefineProperties:c,ObjectSetPrototypeOf:u,StringPrototypeToLowerCase:l,Symbol:d,SymbolHasInstance:h}=r(4134);e.exports=D,D.WritableState=x;const{EventEmitter:f}=r(7007),p=r(4259).Stream,{Buffer:g}=r(8287),m=r(5896),{addAbortSignal:y}=r(4147),{getHighWaterMark:b,getDefaultHighWaterMark:w}=r(5291),{ERR_INVALID_ARG_TYPE:v,ERR_METHOD_NOT_IMPLEMENTED:E,ERR_MULTIPLE_CALLBACK:A,ERR_STREAM_CANNOT_PIPE:S,ERR_STREAM_DESTROYED:k,ERR_STREAM_ALREADY_FINISHED:R,ERR_STREAM_NULL_VALUES:P,ERR_STREAM_WRITE_AFTER_END:I,ERR_UNKNOWN_ENCODING:C}=r(6371).codes,{errorOrDestroy:_}=m;function T(){}u(D.prototype,p.prototype),u(D,p);const N=d("kOnFinished");function x(e,t,n){"boolean"!=typeof n&&(n=t instanceof r(3370)),this.objectMode=!(!e||!e.objectMode),n&&(this.objectMode=this.objectMode||!(!e||!e.writableObjectMode)),this.highWaterMark=e?b(this,e,"writableHighWaterMark",n):w(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const i=!(!e||!1!==e.decodeStrings);this.decodeStrings=!i,this.defaultEncoding=e&&e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=F.bind(void 0,t),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,O(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!e||!1!==e.emitClose,this.autoDestroy=!e||!1!==e.autoDestroy,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[N]=[]}function O(e){e.buffered=[],e.bufferedIndex=0,e.allBuffers=!0,e.allNoop=!0}function D(e){const t=this instanceof r(3370);if(!t&&!o(D,this))return new D(e);this._writableState=new x(e,this,t),e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final),"function"==typeof e.construct&&(this._construct=e.construct),e.signal&&y(e.signal,this)),p.call(this,e),m.construct(this,()=>{const e=this._writableState;e.writing||q(this,e),G(this,e)})}function M(e,t,r,i){const s=e._writableState;if("function"==typeof r)i=r,r=s.defaultEncoding;else{if(r){if("buffer"!==r&&!g.isEncoding(r))throw new C(r)}else r=s.defaultEncoding;"function"!=typeof i&&(i=T)}if(null===t)throw new P;if(!s.objectMode)if("string"==typeof t)!1!==s.decodeStrings&&(t=g.from(t,r),r="buffer");else if(t instanceof g)r="buffer";else{if(!p._isUint8Array(t))throw new v("chunk",["string","Buffer","Uint8Array"],t);t=p._uint8ArrayToBuffer(t),r="buffer"}let o;return s.ending?o=new I:s.destroyed&&(o=new k("write")),o?(n.nextTick(i,o),_(e,o,!0),o):(s.pendingcb++,function(e,t,r,n,i){const s=t.objectMode?1:r.length;t.length+=s;const o=t.length<t.highWaterMark;return o||(t.needDrain=!0),t.writing||t.corked||t.errored||!t.constructed?(t.buffered.push({chunk:r,encoding:n,callback:i}),t.allBuffers&&"buffer"!==n&&(t.allBuffers=!1),t.allNoop&&i!==T&&(t.allNoop=!1)):(t.writelen=s,t.writecb=i,t.writing=!0,t.sync=!0,e._write(r,n,t.onwrite),t.sync=!1),o&&!t.errored&&!t.destroyed}(e,s,t,r,i))}function B(e,t,r,n,i,s,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new k("write")):r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function L(e,t,r,n){--t.pendingcb,n(r),z(t),_(e,r)}function F(e,t){const r=e._writableState,i=r.sync,s=r.writecb;"function"==typeof s?(r.writing=!1,r.writecb=null,r.length-=r.writelen,r.writelen=0,t?(t.stack,r.errored||(r.errored=t),e._readableState&&!e._readableState.errored&&(e._readableState.errored=t),i?n.nextTick(L,e,r,t,s):L(e,r,t,s)):(r.buffered.length>r.bufferedIndex&&q(e,r),i?null!==r.afterWriteTickInfo&&r.afterWriteTickInfo.cb===s?r.afterWriteTickInfo.count++:(r.afterWriteTickInfo={count:1,cb:s,stream:e,state:r},n.nextTick(U,r.afterWriteTickInfo)):j(e,r,1,s))):_(e,new A)}function U({stream:e,state:t,count:r,cb:n}){return t.afterWriteTickInfo=null,j(e,t,r,n)}function j(e,t,r,n){for(!t.ending&&!e.destroyed&&0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"));r-- >0;)t.pendingcb--,n();t.destroyed&&z(t),G(e,t)}function z(e){if(e.writing)return;for(let r=e.bufferedIndex;r<e.buffered.length;++r){var t;const{chunk:n,callback:i}=e.buffered[r],s=e.objectMode?1:n.length;e.length-=s,i(null!==(t=e.errored)&&void 0!==t?t:new k("write"))}const r=e[N].splice(0);for(let t=0;t<r.length;t++){var n;r[t](null!==(n=e.errored)&&void 0!==n?n:new k("end"))}O(e)}function q(e,t){if(t.corked||t.bufferProcessing||t.destroyed||!t.constructed)return;const{buffered:r,bufferedIndex:n,objectMode:s}=t,o=r.length-n;if(!o)return;let a=n;if(t.bufferProcessing=!0,o>1&&e._writev){t.pendingcb-=o-1;const n=t.allNoop?T:e=>{for(let t=a;t<r.length;++t)r[t].callback(e)},s=t.allNoop&&0===a?r:i(r,a);s.allBuffers=t.allBuffers,B(e,t,!0,t.length,s,"",n),O(t)}else{do{const{chunk:n,encoding:i,callback:o}=r[a];r[a++]=null,B(e,t,!1,s?1:n.length,n,i,o)}while(a<r.length&&!t.writing);a===r.length?O(t):a>256?(r.splice(0,a),t.bufferedIndex=0):t.bufferedIndex=a}t.bufferProcessing=!1}function K(e){return e.ending&&!e.destroyed&&e.constructed&&0===e.length&&!e.errored&&0===e.buffered.length&&!e.finished&&!e.writing&&!e.errorEmitted&&!e.closeEmitted}function G(e,t,r){K(t)&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.finalCalled=!0,function(e,t){let r=!1;function i(i){if(r)_(e,null!=i?i:A());else if(r=!0,t.pendingcb--,i){const r=t[N].splice(0);for(let e=0;e<r.length;e++)r[e](i);_(e,i,t.sync)}else K(t)&&(t.prefinished=!0,e.emit("prefinish"),t.pendingcb++,n.nextTick($,e,t))}t.sync=!0,t.pendingcb++;try{e._final(i)}catch(e){i(e)}t.sync=!1}(e,t)))}(e,t),0===t.pendingcb&&(r?(t.pendingcb++,n.nextTick((e,t)=>{K(t)?$(e,t):t.pendingcb--},e,t)):K(t)&&(t.pendingcb++,$(e,t))))}function $(e,t){t.pendingcb--,t.finished=!0;const r=t[N].splice(0);for(let e=0;e<r.length;e++)r[e]();if(e.emit("finish"),t.autoDestroy){const t=e._readableState;(!t||t.autoDestroy&&(t.endEmitted||!1===t.readable))&&e.destroy()}}x.prototype.getBuffer=function(){return i(this.buffered,this.bufferedIndex)},a(x.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}}),a(D,h,{__proto__:null,value:function(e){return!!o(this,e)||this===D&&e&&e._writableState instanceof x}}),D.prototype.pipe=function(){_(this,new S)},D.prototype.write=function(e,t,r){return!0===M(this,e,t,r)},D.prototype.cork=function(){this._writableState.corked++},D.prototype.uncork=function(){const e=this._writableState;e.corked&&(e.corked--,e.writing||q(this,e))},D.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=l(e)),!g.isEncoding(e))throw new C(e);return this._writableState.defaultEncoding=e,this},D.prototype._write=function(e,t,r){if(!this._writev)throw new E("_write()");this._writev([{chunk:e,encoding:t}],r)},D.prototype._writev=null,D.prototype.end=function(e,t,r){const i=this._writableState;let o;if("function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e){const r=M(this,e,t);r instanceof s&&(o=r)}return i.corked&&(i.corked=1,this.uncork()),o||(i.errored||i.ending?i.finished?o=new R("end"):i.destroyed&&(o=new k("end")):(i.ending=!0,G(this,i,!0),i.ended=!0)),"function"==typeof r&&(o||i.finished?n.nextTick(r,o):i[N].push(r)),this},c(D.prototype,{closed:{__proto__:null,get(){return!!this._writableState&&this._writableState.closed}},destroyed:{__proto__:null,get(){return!!this._writableState&&this._writableState.destroyed},set(e){this._writableState&&(this._writableState.destroyed=e)}},writable:{__proto__:null,get(){const e=this._writableState;return!(!e||!1===e.writable||e.destroyed||e.errored||e.ending||e.ended)},set(e){this._writableState&&(this._writableState.writable=!!e)}},writableFinished:{__proto__:null,get(){return!!this._writableState&&this._writableState.finished}},writableObjectMode:{__proto__:null,get(){return!!this._writableState&&this._writableState.objectMode}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return!!this._writableState&&this._writableState.ending}},writableNeedDrain:{__proto__:null,get(){const e=this._writableState;return!!e&&!e.destroyed&&!e.ending&&e.needDrain}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!(!1===this._writableState.writable||!this._writableState.destroyed&&!this._writableState.errored||this._writableState.finished)}}});const V=m.destroy;let H;function W(){return void 0===H&&(H={}),H}D.prototype.destroy=function(e,t){const r=this._writableState;return!r.destroyed&&(r.bufferedIndex<r.buffered.length||r[N].length)&&n.nextTick(z,r),V.call(this,e,t),this},D.prototype._undestroy=m.undestroy,D.prototype._destroy=function(e,t){t(e)},D.prototype[f.captureRejectionSymbol]=function(e){this.destroy(e)},D.fromWeb=function(e,t){return W().newStreamWritableFromWritableStream(e,t)},D.toWeb=function(e){return W().newWritableStreamFromStreamWritable(e)}},277(e,t,r){"use strict";const{ArrayIsArray:n,ArrayPrototypeIncludes:i,ArrayPrototypeJoin:s,ArrayPrototypeMap:o,NumberIsInteger:a,NumberIsNaN:c,NumberMAX_SAFE_INTEGER:u,NumberMIN_SAFE_INTEGER:l,NumberParseInt:d,ObjectPrototypeHasOwnProperty:h,RegExpPrototypeExec:f,String:p,StringPrototypeToUpperCase:g,StringPrototypeTrim:m}=r(4134),{hideStackFrames:y,codes:{ERR_SOCKET_BAD_PORT:b,ERR_INVALID_ARG_TYPE:w,ERR_INVALID_ARG_VALUE:v,ERR_OUT_OF_RANGE:E,ERR_UNKNOWN_SIGNAL:A}}=r(6371),{normalizeEncoding:S}=r(7760),{isAsyncFunction:k,isArrayBufferView:R}=r(7760).types,P={},I=/^[0-7]+$/,C=y((e,t,r=l,n=u)=>{if("number"!=typeof e)throw new w(t,"number",e);if(!a(e))throw new E(t,"an integer",e);if(e<r||e>n)throw new E(t,`>= ${r} && <= ${n}`,e)}),_=y((e,t,r=-2147483648,n=2147483647)=>{if("number"!=typeof e)throw new w(t,"number",e);if(!a(e))throw new E(t,"an integer",e);if(e<r||e>n)throw new E(t,`>= ${r} && <= ${n}`,e)}),T=y((e,t,r=!1)=>{if("number"!=typeof e)throw new w(t,"number",e);if(!a(e))throw new E(t,"an integer",e);const n=r?1:0,i=4294967295;if(e<n||e>i)throw new E(t,`>= ${n} && <= ${i}`,e)});function N(e,t){if("string"!=typeof e)throw new w(t,"string",e)}const x=y((e,t,r)=>{if(!i(r,e)){const n=s(o(r,e=>"string"==typeof e?`'${e}'`:p(e)),", ");throw new v(t,e,"must be one of: "+n)}});function O(e,t){if("boolean"!=typeof e)throw new w(t,"boolean",e)}function D(e,t,r){return null!=e&&h(e,t)?e[t]:r}const M=y((e,t,r=null)=>{const i=D(r,"allowArray",!1),s=D(r,"allowFunction",!1);if(!D(r,"nullable",!1)&&null===e||!i&&n(e)||"object"!=typeof e&&(!s||"function"!=typeof e))throw new w(t,"Object",e)}),B=y((e,t)=>{if(null!=e&&"object"!=typeof e&&"function"!=typeof e)throw new w(t,"a dictionary",e)}),L=y((e,t,r=0)=>{if(!n(e))throw new w(t,"Array",e);if(e.length<r)throw new v(t,e,`must be longer than ${r}`)}),F=y((e,t="buffer")=>{if(!R(e))throw new w(t,["Buffer","TypedArray","DataView"],e)}),U=y((e,t)=>{if(void 0!==e&&(null===e||"object"!=typeof e||!("aborted"in e)))throw new w(t,"AbortSignal",e)}),j=y((e,t)=>{if("function"!=typeof e)throw new w(t,"Function",e)}),z=y((e,t)=>{if("function"!=typeof e||k(e))throw new w(t,"Function",e)}),q=y((e,t)=>{if(void 0!==e)throw new w(t,"undefined",e)}),K=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function G(e,t){if(void 0===e||!f(K,e))throw new v(t,e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}e.exports={isInt32:function(e){return e===(0|e)},isUint32:function(e){return e===e>>>0},parseFileMode:function(e,t,r){if(void 0===e&&(e=r),"string"==typeof e){if(null===f(I,e))throw new v(t,e,"must be a 32-bit unsigned integer or an octal string");e=d(e,8)}return T(e,t),e},validateArray:L,validateStringArray:function(e,t){L(e,t);for(let r=0;r<e.length;r++)N(e[r],`${t}[${r}]`)},validateBooleanArray:function(e,t){L(e,t);for(let r=0;r<e.length;r++)O(e[r],`${t}[${r}]`)},validateAbortSignalArray:function(e,t){L(e,t);for(let r=0;r<e.length;r++){const n=e[r],i=`${t}[${r}]`;if(null==n)throw new w(i,"AbortSignal",n);U(n,i)}},validateBoolean:O,validateBuffer:F,validateDictionary:B,validateEncoding:function(e,t){const r=S(t),n=e.length;if("hex"===r&&n%2!=0)throw new v("encoding",t,`is invalid for data of length ${n}`)},validateFunction:j,validateInt32:_,validateInteger:C,validateNumber:function(e,t,r=void 0,n){if("number"!=typeof e)throw new w(t,"number",e);if(null!=r&&e<r||null!=n&&e>n||(null!=r||null!=n)&&c(e))throw new E(t,`${null!=r?`>= ${r}`:""}${null!=r&&null!=n?" && ":""}${null!=n?`<= ${n}`:""}`,e)},validateObject:M,validateOneOf:x,validatePlainFunction:z,validatePort:function(e,t="Port",r=!0){if("number"!=typeof e&&"string"!=typeof e||"string"==typeof e&&0===m(e).length||+e!==+e>>>0||e>65535||0===e&&!r)throw new b(t,e,r);return 0|e},validateSignalName:function(e,t="signal"){if(N(e,t),void 0===P[e]){if(void 0!==P[g(e)])throw new A(e+" (signals must use all capital letters)");throw new A(e)}},validateString:N,validateUint32:T,validateUndefined:q,validateUnion:function(e,t,r){if(!i(r,e))throw new w(t,`('${s(r,"|")}')`,e)},validateAbortSignal:U,validateLinkHeaderValue:function(e){if("string"==typeof e)return G(e,"hints"),e;if(n(e)){const t=e.length;let r="";if(0===t)return r;for(let n=0;n<t;n++){const i=e[n];G(i,"hints"),r+=i,n!==t-1&&(r+=", ")}return r}throw new v("hints",e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}}},9198(e,t,r){"use strict";const n=r(5506),i=r(3095),s=n.Readable.destroy;e.exports=n.Readable,e.exports._uint8ArrayToBuffer=n._uint8ArrayToBuffer,e.exports._isUint8Array=n._isUint8Array,e.exports.isDisturbed=n.isDisturbed,e.exports.isErrored=n.isErrored,e.exports.isReadable=n.isReadable,e.exports.Readable=n.Readable,e.exports.Writable=n.Writable,e.exports.Duplex=n.Duplex,e.exports.Transform=n.Transform,e.exports.PassThrough=n.PassThrough,e.exports.addAbortSignal=n.addAbortSignal,e.exports.finished=n.finished,e.exports.destroy=n.destroy,e.exports.destroy=s,e.exports.pipeline=n.pipeline,e.exports.compose=n.compose,Object.defineProperty(n,"promises",{configurable:!0,enumerable:!0,get:()=>i}),e.exports.Stream=n.Stream,e.exports.default=e.exports},6371(e,t,r){"use strict";const{format:n,inspect:i}=r(9231),{AggregateError:s}=r(4134),o=globalThis.AggregateError||s,a=Symbol("kIsNodeError"),c=["string","function","number","object","Function","Object","boolean","bigint","symbol"],u=/^([A-Z][a-z0-9]*)+$/,l={};function d(e,t){if(!e)throw new l.ERR_INTERNAL_ASSERTION(t)}function h(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function f(e,t,r){r||(r=Error);class i extends r{constructor(...r){super(function(e,t,r){if("function"==typeof t)return d(t.length<=r.length,`Code: ${e}; The provided arguments length (${r.length}) does not match the required ones (${t.length}).`),t(...r);const i=(t.match(/%[dfijoOs]/g)||[]).length;return d(i===r.length,`Code: ${e}; The provided arguments length (${r.length}) does not match the required ones (${i}).`),0===r.length?t:n(t,...r)}(e,t,r))}toString(){return`${this.name} [${e}]: ${this.message}`}}Object.defineProperties(i.prototype,{name:{value:r.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${e}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),i.prototype.code=e,i.prototype[a]=!0,l[e]=i}function p(e){const t="__node_internal_"+e.name;return Object.defineProperty(e,"name",{value:t}),e}class g extends Error{constructor(e="The operation was aborted",t=void 0){if(void 0!==t&&"object"!=typeof t)throw new l.ERR_INVALID_ARG_TYPE("options","Object",t);super(e,t),this.code="ABORT_ERR",this.name="AbortError"}}f("ERR_ASSERTION","%s",Error),f("ERR_INVALID_ARG_TYPE",(e,t,r)=>{d("string"==typeof e,"'name' must be a string"),Array.isArray(t)||(t=[t]);let n="The ";e.endsWith(" argument")?n+=`${e} `:n+=`"${e}" ${e.includes(".")?"property":"argument"} `,n+="must be ";const s=[],o=[],a=[];for(const e of t)d("string"==typeof e,"All expected entries have to be of type string"),c.includes(e)?s.push(e.toLowerCase()):u.test(e)?o.push(e):(d("object"!==e,'The value "object" should be written as "Object"'),a.push(e));if(o.length>0){const e=s.indexOf("object");-1!==e&&(s.splice(s,e,1),o.push("Object"))}if(s.length>0){switch(s.length){case 1:n+=`of type ${s[0]}`;break;case 2:n+=`one of type ${s[0]} or ${s[1]}`;break;default:{const e=s.pop();n+=`one of type ${s.join(", ")}, or ${e}`}}(o.length>0||a.length>0)&&(n+=" or ")}if(o.length>0){switch(o.length){case 1:n+=`an instance of ${o[0]}`;break;case 2:n+=`an instance of ${o[0]} or ${o[1]}`;break;default:{const e=o.pop();n+=`an instance of ${o.join(", ")}, or ${e}`}}a.length>0&&(n+=" or ")}switch(a.length){case 0:break;case 1:a[0].toLowerCase()!==a[0]&&(n+="an "),n+=`${a[0]}`;break;case 2:n+=`one of ${a[0]} or ${a[1]}`;break;default:{const e=a.pop();n+=`one of ${a.join(", ")}, or ${e}`}}if(null==r)n+=`. Received ${r}`;else if("function"==typeof r&&r.name)n+=`. Received function ${r.name}`;else if("object"==typeof r){var l;null!==(l=r.constructor)&&void 0!==l&&l.name?n+=`. Received an instance of ${r.constructor.name}`:n+=`. Received ${i(r,{depth:-1})}`}else{let e=i(r,{colors:!1});e.length>25&&(e=`${e.slice(0,25)}...`),n+=`. Received type ${typeof r} (${e})`}return n},TypeError),f("ERR_INVALID_ARG_VALUE",(e,t,r="is invalid")=>{let n=i(t);return n.length>128&&(n=n.slice(0,128)+"..."),`The ${e.includes(".")?"property":"argument"} '${e}' ${r}. Received ${n}`},TypeError),f("ERR_INVALID_RETURN_VALUE",(e,t,r)=>{var n;return`Expected ${e} to be returned from the "${t}" function but got ${null!=r&&null!==(n=r.constructor)&&void 0!==n&&n.name?`instance of ${r.constructor.name}`:"type "+typeof r}.`},TypeError),f("ERR_MISSING_ARGS",(...e)=>{let t;d(e.length>0,"At least one arg needs to be specified");const r=e.length;switch(e=(Array.isArray(e)?e:[e]).map(e=>`"${e}"`).join(" or "),r){case 1:t+=`The ${e[0]} argument`;break;case 2:t+=`The ${e[0]} and ${e[1]} arguments`;break;default:{const r=e.pop();t+=`The ${e.join(", ")}, and ${r} arguments`}}return`${t} must be specified`},TypeError),f("ERR_OUT_OF_RANGE",(e,t,r)=>{let n;if(d(t,'Missing "range" argument'),Number.isInteger(r)&&Math.abs(r)>2**32)n=h(String(r));else if("bigint"==typeof r){n=String(r);const e=BigInt(2)**BigInt(32);(r>e||r<-e)&&(n=h(n)),n+="n"}else n=i(r);return`The value of "${e}" is out of range. It must be ${t}. Received ${n}`},RangeError),f("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),f("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),f("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),f("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),f("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),f("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),f("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),f("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),f("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),f("ERR_STREAM_WRITE_AFTER_END","write after end",Error),f("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),e.exports={AbortError:g,aggregateTwoErrors:p(function(e,t){if(e&&t&&e!==t){if(Array.isArray(t.errors))return t.errors.push(e),t;const r=new o([t,e],t.message);return r.code=t.code,r}return e||t}),hideStackFrames:p,codes:l}},4134(e){"use strict";class t extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError("Expected input to be an Array, got "+typeof e);let t="";for(let r=0;r<e.length;r++)t+=`    ${e[r].stack}\n`;super(t),this.name="AggregateError",this.errors=e}}e.exports={AggregateError:t,ArrayIsArray:e=>Array.isArray(e),ArrayPrototypeIncludes:(e,t)=>e.includes(t),ArrayPrototypeIndexOf:(e,t)=>e.indexOf(t),ArrayPrototypeJoin:(e,t)=>e.join(t),ArrayPrototypeMap:(e,t)=>e.map(t),ArrayPrototypePop:(e,t)=>e.pop(t),ArrayPrototypePush:(e,t)=>e.push(t),ArrayPrototypeSlice:(e,t,r)=>e.slice(t,r),Error,FunctionPrototypeCall:(e,t,...r)=>e.call(t,...r),FunctionPrototypeSymbolHasInstance:(e,t)=>Function.prototype[Symbol.hasInstance].call(e,t),MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties:(e,t)=>Object.defineProperties(e,t),ObjectDefineProperty:(e,t,r)=>Object.defineProperty(e,t,r),ObjectGetOwnPropertyDescriptor:(e,t)=>Object.getOwnPropertyDescriptor(e,t),ObjectKeys:e=>Object.keys(e),ObjectSetPrototypeOf:(e,t)=>Object.setPrototypeOf(e,t),Promise,PromisePrototypeCatch:(e,t)=>e.catch(t),PromisePrototypeThen:(e,t,r)=>e.then(t,r),PromiseReject:e=>Promise.reject(e),PromiseResolve:e=>Promise.resolve(e),ReflectApply:Reflect.apply,RegExpPrototypeTest:(e,t)=>e.test(t),SafeSet:Set,String,StringPrototypeSlice:(e,t,r)=>e.slice(t,r),StringPrototypeToLowerCase:e=>e.toLowerCase(),StringPrototypeToUpperCase:e=>e.toUpperCase(),StringPrototypeTrim:e=>e.trim(),Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet:(e,t,r)=>e.set(t,r),Boolean,Uint8Array}},7760(e,t,r){"use strict";const n=r(8287),{format:i,inspect:s}=r(9231),{codes:{ERR_INVALID_ARG_TYPE:o}}=r(6371),{kResistStopPropagation:a,AggregateError:c,SymbolDispose:u}=r(4134),l=globalThis.AbortSignal||r(5568).AbortSignal,d=globalThis.AbortController||r(5568).AbortController,h=Object.getPrototypeOf(async function(){}).constructor,f=globalThis.Blob||n.Blob,p=void 0!==f?function(e){return e instanceof f}:function(e){return!1},g=(e,t)=>{if(void 0!==e&&(null===e||"object"!=typeof e||!("aborted"in e)))throw new o(t,"AbortSignal",e)};e.exports={AggregateError:c,kEmptyObject:Object.freeze({}),once(e){let t=!1;return function(...r){t||(t=!0,e.apply(this,r))}},createDeferredPromise:function(){let e,t;return{promise:new Promise((r,n)=>{e=r,t=n}),resolve:e,reject:t}},promisify:e=>new Promise((t,r)=>{e((e,...n)=>e?r(e):t(...n))}),debuglog:()=>function(){},format:i,inspect:s,types:{isAsyncFunction:e=>e instanceof h,isArrayBufferView:e=>ArrayBuffer.isView(e)},isBlob:p,deprecate:(e,t)=>e,addAbortListener:r(7007).addAbortListener||function(e,t){if(void 0===e)throw new o("signal","AbortSignal",e);let r;return g(e,"signal"),(e=>{if("function"!=typeof e)throw new o("listener","Function",e)})(t),e.aborted?queueMicrotask(()=>t()):(e.addEventListener("abort",t,{__proto__:null,once:!0,[a]:!0}),r=()=>{e.removeEventListener("abort",t)}),{__proto__:null,[u](){var e;null===(e=r)||void 0===e||e()}}},AbortSignalAny:l.any||function(e){if(1===e.length)return e[0];const t=new d,r=()=>t.abort();return e.forEach(e=>{g(e,"signals"),e.addEventListener("abort",r,{once:!0})}),t.signal.addEventListener("abort",()=>{e.forEach(e=>e.removeEventListener("abort",r))},{once:!0}),t.signal}},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")},9231(e){"use strict";e.exports={format:(e,...t)=>e.replace(/%([sdifj])/g,function(...[e,r]){const n=t.shift();return"f"===r?n.toFixed(6):"j"===r?JSON.stringify(n):"s"===r&&"object"==typeof n?`${n.constructor!==Object?n.constructor.name:""} {}`.trim():n.toString()}),inspect(e){switch(typeof e){case"string":if(e.includes("'")){if(!e.includes('"'))return`"${e}"`;if(!e.includes("`")&&!e.includes("${"))return`\`${e}\``}return`'${e}'`;case"number":return isNaN(e)?"NaN":Object.is(e,-0)?String(e):e;case"bigint":return`${String(e)}n`;case"boolean":case"undefined":return String(e);case"object":return"{}"}}}},5506(e,t,r){"use strict";const{Buffer:n}=r(8287),{ObjectDefineProperty:i,ObjectKeys:s,ReflectApply:o}=r(4134),{promisify:{custom:a}}=r(7760),{streamReturningOperators:c,promiseReturningOperators:u}=r(823),{codes:{ERR_ILLEGAL_CONSTRUCTOR:l}}=r(6371),d=r(7830),{setDefaultHighWaterMark:h,getDefaultHighWaterMark:f}=r(5291),{pipeline:p}=r(7758),{destroyer:g}=r(5896),m=r(6238),y=r(3095),b=r(6115),w=e.exports=r(4259).Stream;w.isDestroyed=b.isDestroyed,w.isDisturbed=b.isDisturbed,w.isErrored=b.isErrored,w.isReadable=b.isReadable,w.isWritable=b.isWritable,w.Readable=r(7576);for(const E of s(c)){const A=c[E];function S(...e){if(new.target)throw l();return w.Readable.from(o(A,this,e))}i(S,"name",{__proto__:null,value:A.name}),i(S,"length",{__proto__:null,value:A.length}),i(w.Readable.prototype,E,{__proto__:null,value:S,enumerable:!1,configurable:!0,writable:!0})}for(const k of s(u)){const R=u[k];function P(...e){if(new.target)throw l();return o(R,this,e)}i(P,"name",{__proto__:null,value:R.name}),i(P,"length",{__proto__:null,value:R.length}),i(w.Readable.prototype,k,{__proto__:null,value:P,enumerable:!1,configurable:!0,writable:!0})}w.Writable=r(8584),w.Duplex=r(3370),w.Transform=r(7382),w.PassThrough=r(6524),w.pipeline=p;const{addAbortSignal:v}=r(4147);w.addAbortSignal=v,w.finished=m,w.destroy=g,w.compose=d,w.setDefaultHighWaterMark=h,w.getDefaultHighWaterMark=f,i(w,"promises",{__proto__:null,configurable:!0,enumerable:!0,get:()=>y}),i(p,a,{__proto__:null,enumerable:!0,get:()=>y.pipeline}),i(m,a,{__proto__:null,enumerable:!0,get:()=>y.finished}),w.Stream=w,w._isUint8Array=function(e){return e instanceof Uint8Array},w._uint8ArrayToBuffer=function(e){return n.from(e.buffer,e.byteOffset,e.byteLength)}},3095(e,t,r){"use strict";const{ArrayPrototypePop:n,Promise:i}=r(4134),{isIterable:s,isNodeStream:o,isWebStream:a}=r(6115),{pipelineImpl:c}=r(7758),{finished:u}=r(6238);r(5506),e.exports={finished:u,pipeline:function(...e){return new i((t,r)=>{let i,u;const l=e[e.length-1];if(l&&"object"==typeof l&&!o(l)&&!s(l)&&!a(l)){const t=n(e);i=t.signal,u=t.end}c(e,(e,n)=>{e?r(e):t(n)},{signal:i,end:u})})}}},2861(e,t,r){var n=r(8287),i=n.Buffer;function s(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},4774(e,t,r){"use strict";var n,i=r(8287),s=i.Buffer,o={};for(n in i)i.hasOwnProperty(n)&&"SlowBuffer"!==n&&"Buffer"!==n&&(o[n]=i[n]);var a=o.Buffer={};for(n in s)s.hasOwnProperty(n)&&"allocUnsafe"!==n&&"allocUnsafeSlow"!==n&&(a[n]=s[n]);if(o.Buffer.prototype=s.prototype,a.from&&a.from!==Uint8Array.from||(a.from=function(e,t,r){if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type '+typeof e);if(e&&void 0===e.length)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);return s(e,t,r)}),a.alloc||(a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError('The "size" argument must be of type number. Received type '+typeof e);if(e<0||e>=2*(1<<30))throw new RangeError('The value "'+e+'" is invalid for option "size"');var n=s(e);return t&&0!==t.length?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n}),!o.kStringMaxLength)try{o.kStringMaxLength=process.binding("buffer").kStringMaxLength}catch(e){}o.constants||(o.constants={MAX_LENGTH:o.kMaxLength},o.kStringMaxLength&&(o.constants.MAX_STRING_LENGTH=o.kStringMaxLength)),e.exports=o},7141(e,t,r){e.exports=r(5483)(r(533))},533(e,t,r){const n=new(0,r(6729).ec)("secp256k1"),i=n.curve,s=i.n.constructor;function o(e){const t=e[0];switch(t){case 2:case 3:return 33!==e.length?null:function(e,t){let r=new s(t);if(r.cmp(i.p)>=0)return null;r=r.toRed(i.red);let o=r.redSqr().redIMul(r).redIAdd(i.b).redSqrt();3===e!==o.isOdd()&&(o=o.redNeg());const a=r.redSqr().redIMul(r);return o.redSqr().redISub(a.redIAdd(i.b)).isZero()?n.keyPair({pub:{x:r,y:o}}):null}(t,e.subarray(1,33));case 4:case 6:case 7:return 65!==e.length?null:function(e,t,r){let o=new s(t),a=new s(r);if(o.cmp(i.p)>=0||a.cmp(i.p)>=0)return null;if(o=o.toRed(i.red),a=a.toRed(i.red),(6===e||7===e)&&a.isOdd()!==(7===e))return null;const c=o.redSqr().redIMul(o);return a.redSqr().redISub(c.redIAdd(i.b)).isZero()?n.keyPair({pub:{x:o,y:a}}):null}(t,e.subarray(1,33),e.subarray(33,65));default:return null}}function a(e,t){const r=t.encode(null,33===e.length);for(let t=0;t<e.length;++t)e[t]=r[t]}e.exports={contextRandomize:()=>0,privateKeyVerify(e){const t=new s(e);return t.cmp(i.n)<0&&!t.isZero()?0:1},privateKeyNegate(e){const t=new s(e),r=i.n.sub(t).umod(i.n).toArrayLike(Uint8Array,"be",32);return e.set(r),0},privateKeyTweakAdd(e,t){const r=new s(t);if(r.cmp(i.n)>=0)return 1;if(r.iadd(new s(e)),r.cmp(i.n)>=0&&r.isub(i.n),r.isZero())return 1;const n=r.toArrayLike(Uint8Array,"be",32);return e.set(n),0},privateKeyTweakMul(e,t){let r=new s(t);if(r.cmp(i.n)>=0||r.isZero())return 1;r.imul(new s(e)),r.cmp(i.n)>=0&&(r=r.umod(i.n));const n=r.toArrayLike(Uint8Array,"be",32);return e.set(n),0},publicKeyVerify:e=>null===o(e)?1:0,publicKeyCreate(e,t){const r=new s(t);return r.cmp(i.n)>=0||r.isZero()?1:(a(e,n.keyFromPrivate(t).getPublic()),0)},publicKeyConvert(e,t){const r=o(t);return null===r?1:(a(e,r.getPublic()),0)},publicKeyNegate(e,t){const r=o(t);if(null===r)return 1;const n=r.getPublic();return n.y=n.y.redNeg(),a(e,n),0},publicKeyCombine(e,t){const r=new Array(t.length);for(let e=0;e<t.length;++e)if(r[e]=o(t[e]),null===r[e])return 1;let n=r[0].getPublic();for(let e=1;e<r.length;++e)n=n.add(r[e].pub);return n.isInfinity()?2:(a(e,n),0)},publicKeyTweakAdd(e,t,r){const n=o(t);if(null===n)return 1;if((r=new s(r)).cmp(i.n)>=0)return 2;const c=n.getPublic().add(i.g.mul(r));return c.isInfinity()?2:(a(e,c),0)},publicKeyTweakMul(e,t,r){const n=o(t);return null===n?1:(r=new s(r)).cmp(i.n)>=0||r.isZero()?2:(a(e,n.getPublic().mul(r)),0)},signatureNormalize(e){const t=new s(e.subarray(0,32)),r=new s(e.subarray(32,64));return t.cmp(i.n)>=0||r.cmp(i.n)>=0?1:(1===r.cmp(n.nh)&&e.set(i.n.sub(r).toArrayLike(Uint8Array,"be",32),32),0)},signatureExport(e,t){const r=t.subarray(0,32),n=t.subarray(32,64);if(new s(r).cmp(i.n)>=0)return 1;if(new s(n).cmp(i.n)>=0)return 1;const{output:o}=e;let a=o.subarray(4,37);a[0]=0,a.set(r,1);let c=33,u=0;for(;c>1&&0===a[u]&&!(128&a[u+1]);--c,++u);if(a=a.subarray(u),128&a[0])return 1;if(c>1&&0===a[0]&&!(128&a[1]))return 1;let l=o.subarray(39,72);l[0]=0,l.set(n,1);let d=33,h=0;for(;d>1&&0===l[h]&&!(128&l[h+1]);--d,++h);return l=l.subarray(h),128&l[0]||d>1&&0===l[0]&&!(128&l[1])?1:(e.outputlen=6+c+d,o[0]=48,o[1]=e.outputlen-2,o[2]=2,o[3]=a.length,o.set(a,4),o[4+c]=2,o[5+c]=l.length,o.set(l,6+c),0)},signatureImport(e,t){if(t.length<8)return 1;if(t.length>72)return 1;if(48!==t[0])return 1;if(t[1]!==t.length-2)return 1;if(2!==t[2])return 1;const r=t[3];if(0===r)return 1;if(5+r>=t.length)return 1;if(2!==t[4+r])return 1;const n=t[5+r];if(0===n)return 1;if(6+r+n!==t.length)return 1;if(128&t[4])return 1;if(r>1&&0===t[4]&&!(128&t[5]))return 1;if(128&t[r+6])return 1;if(n>1&&0===t[r+6]&&!(128&t[r+7]))return 1;let o=t.subarray(4,4+r);if(33===o.length&&0===o[0]&&(o=o.subarray(1)),o.length>32)return 1;let a=t.subarray(6+r);if(33===a.length&&0===a[0]&&(a=a.slice(1)),a.length>32)throw new Error("S length is too long");let c=new s(o);c.cmp(i.n)>=0&&(c=new s(0));let u=new s(t.subarray(6+r));return u.cmp(i.n)>=0&&(u=new s(0)),e.set(c.toArrayLike(Uint8Array,"be",32),0),e.set(u.toArrayLike(Uint8Array,"be",32),32),0},ecdsaSign(e,t,r,o,a){if(a){const e=a;a=n=>{const i=e(t,r,null,o,n);if(!(i instanceof Uint8Array&&32===i.length))throw new Error("This is the way");return new s(i)}}const c=new s(r);if(c.cmp(i.n)>=0||c.isZero())return 1;let u;try{u=n.sign(t,r,{canonical:!0,k:a,pers:o})}catch(e){return 1}return e.signature.set(u.r.toArrayLike(Uint8Array,"be",32),0),e.signature.set(u.s.toArrayLike(Uint8Array,"be",32),32),e.recid=u.recoveryParam,0},ecdsaVerify(e,t,r){const a={r:e.subarray(0,32),s:e.subarray(32,64)},c=new s(a.r),u=new s(a.s);if(c.cmp(i.n)>=0||u.cmp(i.n)>=0)return 1;if(1===u.cmp(n.nh)||c.isZero()||u.isZero())return 3;const l=o(r);if(null===l)return 2;const d=l.getPublic();return n.verify(t,a,d)?0:3},ecdsaRecover(e,t,r,o){const c={r:t.slice(0,32),s:t.slice(32,64)},u=new s(c.r),l=new s(c.s);if(u.cmp(i.n)>=0||l.cmp(i.n)>=0)return 1;if(u.isZero()||l.isZero())return 2;let d;try{d=n.recoverPubKey(o,c,r)}catch(e){return 2}return a(e,d),0},ecdh(e,t,r,a,c,u,l){const d=o(t);if(null===d)return 1;const h=new s(r);if(h.cmp(i.n)>=0||h.isZero())return 2;const f=d.getPublic().mul(h);if(void 0===c){const t=f.encode(null,!0),r=n.hash().update(t).digest();for(let t=0;t<32;++t)e[t]=r[t]}else{u||(u=new Uint8Array(32));const t=f.getX().toArray("be",32);for(let e=0;e<32;++e)u[e]=t[e];l||(l=new Uint8Array(32));const r=f.getY().toArray("be",32);for(let e=0;e<32;++e)l[e]=r[e];const n=c(u,l,a);if(!(n instanceof Uint8Array&&n.length===e.length))return 2;e.set(n)}return 0}}},5483(e){const t="Impossible case. Please create issue.",r="The tweak was out of range or the resulted private key is invalid",n="The tweak was out of range or equal to zero",i="Public Key could not be parsed",s="Public Key serialization error",o="Signature could not be parsed";function a(e,t){if(!e)throw new Error(t)}function c(e,t,r){if(a(t instanceof Uint8Array,`Expected ${e} to be an Uint8Array`),void 0!==r)if(Array.isArray(r)){const n=`Expected ${e} to be an Uint8Array with length [${r.join(", ")}]`;a(r.includes(t.length),n)}else{const n=`Expected ${e} to be an Uint8Array with length ${r}`;a(t.length===r,n)}}function u(e){a("Boolean"===d(e),"Expected compressed to be a Boolean")}function l(e=e=>new Uint8Array(e),t){return"function"==typeof e&&(e=e(t)),c("output",e,t),e}function d(e){return Object.prototype.toString.call(e).slice(8,-1)}e.exports=e=>({contextRandomize(t){if(a(null===t||t instanceof Uint8Array,"Expected seed to be an Uint8Array or null"),null!==t&&c("seed",t,32),1===e.contextRandomize(t))throw new Error("Unknow error on context randomization")},privateKeyVerify:t=>(c("private key",t,32),0===e.privateKeyVerify(t)),privateKeyNegate(r){switch(c("private key",r,32),e.privateKeyNegate(r)){case 0:return r;case 1:throw new Error(t)}},privateKeyTweakAdd(t,n){switch(c("private key",t,32),c("tweak",n,32),e.privateKeyTweakAdd(t,n)){case 0:return t;case 1:throw new Error(r)}},privateKeyTweakMul(t,r){switch(c("private key",t,32),c("tweak",r,32),e.privateKeyTweakMul(t,r)){case 0:return t;case 1:throw new Error(n)}},publicKeyVerify:t=>(c("public key",t,[33,65]),0===e.publicKeyVerify(t)),publicKeyCreate(t,r=!0,n){switch(c("private key",t,32),u(r),n=l(n,r?33:65),e.publicKeyCreate(n,t)){case 0:return n;case 1:throw new Error("Private Key is invalid");case 2:throw new Error(s)}},publicKeyConvert(t,r=!0,n){switch(c("public key",t,[33,65]),u(r),n=l(n,r?33:65),e.publicKeyConvert(n,t)){case 0:return n;case 1:throw new Error(i);case 2:throw new Error(s)}},publicKeyNegate(r,n=!0,o){switch(c("public key",r,[33,65]),u(n),o=l(o,n?33:65),e.publicKeyNegate(o,r)){case 0:return o;case 1:throw new Error(i);case 2:throw new Error(t);case 3:throw new Error(s)}},publicKeyCombine(t,r=!0,n){a(Array.isArray(t),"Expected public keys to be an Array"),a(t.length>0,"Expected public keys array will have more than zero items");for(const e of t)c("public key",e,[33,65]);switch(u(r),n=l(n,r?33:65),e.publicKeyCombine(n,t)){case 0:return n;case 1:throw new Error(i);case 2:throw new Error("The sum of the public keys is not valid");case 3:throw new Error(s)}},publicKeyTweakAdd(t,n,s=!0,o){switch(c("public key",t,[33,65]),c("tweak",n,32),u(s),o=l(o,s?33:65),e.publicKeyTweakAdd(o,t,n)){case 0:return o;case 1:throw new Error(i);case 2:throw new Error(r)}},publicKeyTweakMul(t,r,s=!0,o){switch(c("public key",t,[33,65]),c("tweak",r,32),u(s),o=l(o,s?33:65),e.publicKeyTweakMul(o,t,r)){case 0:return o;case 1:throw new Error(i);case 2:throw new Error(n)}},signatureNormalize(t){switch(c("signature",t,64),e.signatureNormalize(t)){case 0:return t;case 1:throw new Error(o)}},signatureExport(r,n){c("signature",r,64);const i={output:n=l(n,72),outputlen:72};switch(e.signatureExport(i,r)){case 0:return n.slice(0,i.outputlen);case 1:throw new Error(o);case 2:throw new Error(t)}},signatureImport(r,n){switch(c("signature",r),n=l(n,64),e.signatureImport(n,r)){case 0:return n;case 1:throw new Error(o);case 2:throw new Error(t)}},ecdsaSign(r,n,i={},s){c("message",r,32),c("private key",n,32),a("Object"===d(i),"Expected options to be an Object"),void 0!==i.data&&c("options.data",i.data),void 0!==i.noncefn&&a("Function"===d(i.noncefn),"Expected options.noncefn to be a Function");const o={signature:s=l(s,64),recid:null};switch(e.ecdsaSign(o,r,n,i.data,i.noncefn)){case 0:return o;case 1:throw new Error("The nonce generation function failed, or the private key was invalid");case 2:throw new Error(t)}},ecdsaVerify(t,r,n){switch(c("signature",t,64),c("message",r,32),c("public key",n,[33,65]),e.ecdsaVerify(t,r,n)){case 0:return!0;case 3:return!1;case 1:throw new Error(o);case 2:throw new Error(i)}},ecdsaRecover(r,n,i,s=!0,h){switch(c("signature",r,64),a("Number"===d(n)&&n>=0&&n<=3,"Expected recovery id to be a Number within interval [0, 3]"),c("message",i,32),u(s),h=l(h,s?33:65),e.ecdsaRecover(h,r,n,i)){case 0:return h;case 1:throw new Error(o);case 2:throw new Error("Public key could not be recover");case 3:throw new Error(t)}},ecdh(t,r,n={},s){switch(c("public key",t,[33,65]),c("private key",r,32),a("Object"===d(n),"Expected options to be an Object"),void 0!==n.data&&c("options.data",n.data),void 0!==n.hashfn?(a("Function"===d(n.hashfn),"Expected options.hashfn to be a Function"),void 0!==n.xbuf&&c("options.xbuf",n.xbuf,32),void 0!==n.ybuf&&c("options.ybuf",n.ybuf,32),c("output",s)):s=l(s,32),e.ecdh(s,t,r,n.data,n.hashfn,n.xbuf,n.ybuf)){case 0:return s;case 1:throw new Error(i);case 2:throw new Error("Scalar was invalid (zero or overflow)")}}})},6897(e,t,r){"use strict";var n=r(453),i=r(41),s=r(592)(),o=r(5795),a=r(9675),c=n("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||c(t)!==t)throw new a("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,u=!0;if("length"in e&&o){var l=o(e,"length");l&&!l.configurable&&(n=!1),l&&!l.writable&&(u=!1)}return(n||u||!r)&&(s?i(e,"length",t,!0,!0):i(e,"length",t)),e}},392(e,t,r){"use strict";var n=r(2861).Buffer,i=r(5377);function s(e,t){this._block=n.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}s.prototype.update=function(e,t){e=i(e,t||"utf8");for(var r=this._block,n=this._blockSize,s=e.length,o=this._len,a=0;a<s;){for(var c=o%n,u=Math.min(s-a,n-c),l=0;l<u;l++)r[c+l]=e[a+l];a+=u,(o+=u)%n===0&&this._update(r)}return this._len+=s,this},s.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var r=8*this._len;if(r<=4294967295)this._block.writeUInt32BE(r,this._blockSize-4);else{var n=(4294967295&r)>>>0,i=(r-n)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)}this._update(this._block);var s=this._hash();return e?s.toString(e):s},s.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=s},2802(e,t,r){"use strict";e.exports=function(t){var r=t.toLowerCase(),n=e.exports[r];if(!n)throw new Error(r+" is not supported (we accept pull requests)");return new n},e.exports.sha=r(7816),e.exports.sha1=r(3737),e.exports.sha224=r(6710),e.exports.sha256=r(4107),e.exports.sha384=r(2827),e.exports.sha512=r(2890)},7816(e,t,r){"use strict";var n=r(6698),i=r(392),s=r(2861).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function c(){this.init(),this._w=a,i.call(this,64,56)}function u(e){return e<<5|e>>>27}function l(e){return e<<30|e>>>2}function d(e,t,r,n){return 0===e?t&r|~t&n:2===e?t&r|t&n|r&n:t^r^n}n(c,i),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t=this._w,r=0|this._a,n=0|this._b,i=0|this._c,s=0|this._d,a=0|this._e,c=0;c<16;++c)t[c]=e.readInt32BE(4*c);for(;c<80;++c)t[c]=t[c-3]^t[c-8]^t[c-14]^t[c-16];for(var h=0;h<80;++h){var f=~~(h/20),p=u(r)+d(f,n,i,s)+a+t[h]+o[f]|0;a=s,s=i,i=l(n),n=r,r=p}this._a=r+this._a|0,this._b=n+this._b|0,this._c=i+this._c|0,this._d=s+this._d|0,this._e=a+this._e|0},c.prototype._hash=function(){var e=s.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},3737(e,t,r){"use strict";var n=r(6698),i=r(392),s=r(2861).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function c(){this.init(),this._w=a,i.call(this,64,56)}function u(e){return e<<1|e>>>31}function l(e){return e<<5|e>>>27}function d(e){return e<<30|e>>>2}function h(e,t,r,n){return 0===e?t&r|~t&n:2===e?t&r|t&n|r&n:t^r^n}n(c,i),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t=this._w,r=0|this._a,n=0|this._b,i=0|this._c,s=0|this._d,a=0|this._e,c=0;c<16;++c)t[c]=e.readInt32BE(4*c);for(;c<80;++c)t[c]=u(t[c-3]^t[c-8]^t[c-14]^t[c-16]);for(var f=0;f<80;++f){var p=~~(f/20),g=l(r)+h(p,n,i,s)+a+t[f]+o[p]|0;a=s,s=i,i=d(n),n=r,r=g}this._a=r+this._a|0,this._b=n+this._b|0,this._c=i+this._c|0,this._d=s+this._d|0,this._e=a+this._e|0},c.prototype._hash=function(){var e=s.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},6710(e,t,r){"use strict";var n=r(6698),i=r(4107),s=r(392),o=r(2861).Buffer,a=new Array(64);function c(){this.init(),this._w=a,s.call(this,64,56)}n(c,i),c.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},c.prototype._hash=function(){var e=o.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=c},4107(e,t,r){"use strict";var n=r(6698),i=r(392),s=r(2861).Buffer,o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=new Array(64);function c(){this.init(),this._w=a,i.call(this,64,56)}function u(e,t,r){return r^e&(t^r)}function l(e,t,r){return e&t|r&(e|t)}function d(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function h(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function f(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}function p(e){return(e>>>17|e<<15)^(e>>>19|e<<13)^e>>>10}n(c,i),c.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},c.prototype._update=function(e){for(var t=this._w,r=0|this._a,n=0|this._b,i=0|this._c,s=0|this._d,a=0|this._e,c=0|this._f,g=0|this._g,m=0|this._h,y=0;y<16;++y)t[y]=e.readInt32BE(4*y);for(;y<64;++y)t[y]=p(t[y-2])+t[y-7]+f(t[y-15])+t[y-16]|0;for(var b=0;b<64;++b){var w=m+h(a)+u(a,c,g)+o[b]+t[b]|0,v=d(r)+l(r,n,i)|0;m=g,g=c,c=a,a=s+w|0,s=i,i=n,n=r,r=w+v|0}this._a=r+this._a|0,this._b=n+this._b|0,this._c=i+this._c|0,this._d=s+this._d|0,this._e=a+this._e|0,this._f=c+this._f|0,this._g=g+this._g|0,this._h=m+this._h|0},c.prototype._hash=function(){var e=s.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=c},2827(e,t,r){"use strict";var n=r(6698),i=r(2890),s=r(392),o=r(2861).Buffer,a=new Array(160);function c(){this.init(),this._w=a,s.call(this,128,112)}n(c,i),c.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},c.prototype._hash=function(){var e=o.allocUnsafe(48);function t(t,r,n){e.writeInt32BE(t,n),e.writeInt32BE(r,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=c},2890(e,t,r){"use strict";var n=r(6698),i=r(392),s=r(2861).Buffer,o=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],a=new Array(160);function c(){this.init(),this._w=a,i.call(this,128,112)}function u(e,t,r){return r^e&(t^r)}function l(e,t,r){return e&t|r&(e|t)}function d(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function h(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function f(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function p(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function g(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function y(e,t){return e>>>0<t>>>0?1:0}n(c,i),c.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},c.prototype._update=function(e){for(var t=this._w,r=0|this._ah,n=0|this._bh,i=0|this._ch,s=0|this._dh,a=0|this._eh,c=0|this._fh,b=0|this._gh,w=0|this._hh,v=0|this._al,E=0|this._bl,A=0|this._cl,S=0|this._dl,k=0|this._el,R=0|this._fl,P=0|this._gl,I=0|this._hl,C=0;C<32;C+=2)t[C]=e.readInt32BE(4*C),t[C+1]=e.readInt32BE(4*C+4);for(;C<160;C+=2){var _=t[C-30],T=t[C-30+1],N=f(_,T),x=p(T,_),O=g(_=t[C-4],T=t[C-4+1]),D=m(T,_),M=t[C-14],B=t[C-14+1],L=t[C-32],F=t[C-32+1],U=x+B|0,j=N+M+y(U,x)|0;j=(j=j+O+y(U=U+D|0,D)|0)+L+y(U=U+F|0,F)|0,t[C]=j,t[C+1]=U}for(var z=0;z<160;z+=2){j=t[z],U=t[z+1];var q=l(r,n,i),K=l(v,E,A),G=d(r,v),$=d(v,r),V=h(a,k),H=h(k,a),W=o[z],J=o[z+1],Z=u(a,c,b),Q=u(k,R,P),Y=I+H|0,X=w+V+y(Y,I)|0;X=(X=(X=X+Z+y(Y=Y+Q|0,Q)|0)+W+y(Y=Y+J|0,J)|0)+j+y(Y=Y+U|0,U)|0;var ee=$+K|0,te=G+q+y(ee,$)|0;w=b,I=P,b=c,P=R,c=a,R=k,a=s+X+y(k=S+Y|0,S)|0,s=i,S=A,i=n,A=E,n=r,E=v,r=X+te+y(v=Y+ee|0,Y)|0}this._al=this._al+v|0,this._bl=this._bl+E|0,this._cl=this._cl+A|0,this._dl=this._dl+S|0,this._el=this._el+k|0,this._fl=this._fl+R|0,this._gl=this._gl+P|0,this._hl=this._hl+I|0,this._ah=this._ah+r+y(this._al,v)|0,this._bh=this._bh+n+y(this._bl,E)|0,this._ch=this._ch+i+y(this._cl,A)|0,this._dh=this._dh+s+y(this._dl,S)|0,this._eh=this._eh+a+y(this._el,k)|0,this._fh=this._fh+c+y(this._fl,R)|0,this._gh=this._gh+b+y(this._gl,P)|0,this._hh=this._hh+w+y(this._hl,I)|0},c.prototype._hash=function(){var e=s.allocUnsafe(64);function t(t,r,n){e.writeInt32BE(t,n),e.writeInt32BE(r,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=c},8190(e,t,r){"use strict";t.vm=void 0;var n,i=r(8287),s=(n=r(3417))&&n.__esModule?n:{default:n},o=function(e){var t=e.allowedSizes,r=e.defaultSize,n=e.padding;return function e(){var o=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;if(!this||this.constructor!==e)return new e(a);if(t&&!t.includes(a))throw new Error("Unsupported hash length");var c=new s.default({capacity:a});return this.update=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(i.Buffer.isBuffer(e))return c.absorb(e),o;if("string"==typeof e)return o.update(i.Buffer.from(e,t));throw new TypeError("Not a string or buffer")},this.digest=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"binary",t="string"==typeof e?{format:e}:e,r=c.squeeze({buffer:t.buffer,padding:t.padding||n});return t.format&&"binary"!==t.format?r.toString(t.format):r},this.reset=function(){return c.reset(),o},this}},a=o({allowedSizes:[224,256,384,512],defaultSize:512,padding:1});t.vm=a;var c=o({allowedSizes:[224,256,384,512],defaultSize:512,padding:6});o({allowedSizes:[128,256],defaultSize:256,padding:31});var u=a;c.SHA3Hash=u},3417(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=r(8287),s=(n=r(5715))&&n.__esModule?n:{default:n},o=function(e,t){for(var r=0;r<e.length;r+=8){var n=r/4;t[n]^=e[r+7]<<24|e[r+6]<<16|e[r+5]<<8|e[r+4],t[n+1]^=e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]}return t},a=function(e,t){for(var r=0;r<t.length;r+=8){var n=r/4;t[r]=e[n+1],t[r+1]=e[n+1]>>>8,t[r+2]=e[n+1]>>>16,t[r+3]=e[n+1]>>>24,t[r+4]=e[n],t[r+5]=e[n]>>>8,t[r+6]=e[n]>>>16,t[r+7]=e[n]>>>24}return t};t.default=function(e){var t=this,r=e.capacity,n=e.padding,c=(0,s.default)(),u=r/8,l=200-r/4,d=0,h=new Uint32Array(50),f=i.Buffer.allocUnsafe(l);return this.absorb=function(e){for(var r=0;r<e.length;r++)f[d]=e[r],(d+=1)>=l&&(o(f,h),c(h),d=0);return t},this.squeeze=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={buffer:e.buffer||i.Buffer.allocUnsafe(u),padding:e.padding||n,queue:i.Buffer.allocUnsafe(f.length),state:new Uint32Array(h.length)};f.copy(t.queue);for(var r=0;r<h.length;r++)t.state[r]=h[r];t.queue.fill(0,d),t.queue[d]|=t.padding,t.queue[l-1]|=128,o(t.queue,t.state);for(var s=0;s<t.buffer.length;s+=l)c(t.state),a(t.state,t.buffer.slice(s,s+l));return t.buffer},this.reset=function(){return f.fill(0),h.fill(0),d=0,t},this}},6317(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=(n=r(1196))&&n.__esModule?n:{default:n};t.default=function(e){for(var t=e.A,r=e.C,n=0;n<25;n+=5){for(var s=0;s<5;s++)(0,i.default)(t,n+s)(r,s);for(var o=0;o<5;o++){var a=2*(n+o),c=(o+1)%5*2,u=(o+2)%5*2;t[a]^=~r[c]&r[u],t[a+1]^=~r[c+1]&r[u+1]}}}},1196(e){"use strict";e.exports=function(e,t){return function(r,n){var i=2*n,s=2*t;r[i]=e[s],r[i+1]=e[s+1]}}},5715(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(6317)),i=a(r(745)),s=a(r(2700)),o=a(r(3671));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=new Uint32Array(10),t=new Uint32Array(10),r=new Uint32Array(2);return function(a){for(var c=0;c<24;c++)(0,o.default)({A:a,C:e,D:t,W:r}),(0,s.default)({A:a,C:e,W:r}),(0,n.default)({A:a,C:e}),(0,i.default)({A:a,roundIndex:c});e.fill(0),t.fill(0),r.fill(0)}}},745(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=(n=r(1165))&&n.__esModule?n:{default:n};t.default=function(e){var t=e.A,r=2*e.roundIndex;t[0]^=i.default[r],t[1]^=i.default[r+1]}},1165(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=new Uint32Array([0,1,0,32898,2147483648,32906,2147483648,2147516416,0,32907,0,2147483649,2147483648,2147516545,2147483648,32777,0,138,0,136,0,2147516425,0,2147483658,0,2147516555,2147483648,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,0,32778,2147483648,2147483658,2147483648,2147516545,2147483648,32896,0,2147483649,2147483648,2147516424]);t.default=r},2700(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r(6351)),i=o(r(5841)),s=o(r(1196));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.A,r=e.C,o=e.W;(0,s.default)(t,1)(o,0);for(var a=0,c=0,u=0,l=32,d=0;d<24;d++){var h=n.default[d],f=i.default[d];(0,s.default)(t,h)(r,0),a=o[0],c=o[1],l=32-f,o[u=f<32?0:1]=a<<f|c>>>l,o[(u+1)%2]=c<<f|a>>>l,(0,s.default)(o,0)(t,h),(0,s.default)(r,0)(o,0)}}},6351(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=[10,7,11,17,18,3,5,16,8,21,24,4,15,23,19,13,12,2,20,14,22,9,6,1]},5841(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=[1,3,6,10,15,21,28,36,45,55,2,14,27,41,56,8,25,43,62,18,39,61,20,44]},3671(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=(n=r(1196))&&n.__esModule?n:{default:n};t.default=function(e){for(var t=e.A,r=e.C,n=e.D,s=e.W,o=0,a=0,c=0;c<5;c++){var u=2*c,l=2*(c+5),d=2*(c+10),h=2*(c+15),f=2*(c+20);r[u]=t[u]^t[l]^t[d]^t[h]^t[f],r[u+1]=t[u+1]^t[l+1]^t[d+1]^t[h+1]^t[f+1]}for(var p=0;p<5;p++){(0,i.default)(r,(p+1)%5)(s,0),o=s[0],a=s[1],s[0]=o<<1|a>>>31,s[1]=a<<1|o>>>31,n[2*p]=r[(p+4)%5*2]^s[0],n[2*p+1]=r[(p+4)%5*2+1]^s[1];for(var g=0;g<25;g+=5)t[2*(g+p)]^=n[2*p],t[2*(g+p)+1]^=n[2*p+1]}}},3141(e,t,r){"use strict";var n=r(2861).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=l,this.end=d,t=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function l(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=s,s.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},s.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=o(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=o(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=o(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},5377(e,t,r){"use strict";var n=r(2861).Buffer,i=r(4634),s=r(4372),o=ArrayBuffer.isView||function(e){try{return s(e),!0}catch(e){return!1}},a="undefined"!=typeof Uint8Array,c="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,u=c&&(n.prototype instanceof Uint8Array||n.TYPED_ARRAY_SUPPORT);e.exports=function(e,t){if(n.isBuffer(e))return e.constructor&&!("isBuffer"in e)?n.from(e):e;if("string"==typeof e)return n.from(e,t);if(c&&o(e)){if(0===e.byteLength)return n.alloc(0);if(u){var r=n.from(e.buffer,e.byteOffset,e.byteLength);if(r.byteLength===e.byteLength)return r}var s=e instanceof Uint8Array?e:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),l=n.from(s);if(l.length===e.byteLength)return l}if(a&&e instanceof Uint8Array)return n.from(e);var d=i(e);if(d)for(var h=0;h<e.length;h+=1){var f=e[h];if("number"!=typeof f||f<0||f>255||~~f!==f)throw new RangeError("Array items must be numbers in the range 0-255.")}if(d||n.isBuffer(e)&&e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e))return n.from(e);throw new TypeError('The "data" argument must be a string, an Array, a Buffer, a Uint8Array, or a DataView.')}},3686(e,t){"use strict";t.O=void 0,t.O=function(e,t,r){const[,n=null]=e.toString().match(/constructor\(([\w, ]+)\)/)||[];return function(e,t,r="    "){return[e,...t.message.split("\n").map(e=>r+e)].join("\n")}(`Cannot inject the dependency ${function(e,t){return null===e?`at position #${t}`:`"${e.split(",")[t].trim()}" at position #${t}`}(n,t)} of "${e.name}" constructor. Reason:`,r)}},8304(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delay=t.DelayedConstructor=void 0;class r{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let t,r=!1;return new Proxy({},this.createHandler(()=>(r||(t=e(this.wrap()),r=!0),t)))}createHandler(e){const t={};return this.reflectMethods.forEach(r=>{t[r]=(...t)=>(t[0]=e(),(0,Reflect[r])(...t))}),t}}t.DelayedConstructor=r,t.delay=function(e){if(void 0===e)throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new r(e)}},9456(e,t,r){"use strict";t.gC=t.X2=void 0;r(8304);t.X2=function(e){return"object"==typeof e&&"token"in e&&"multiple"in e},t.gC=function(e){return"object"==typeof e&&"token"in e&&"transform"in e}},8100(e,t,r){var n,i,s,o,a,c,u,l,d,h,f,p,g,m,y,b,w,v,E,A,S,k,R,P;!function(){var I="object"==typeof r.g?r.g:"object"==typeof self?self:"object"==typeof this?this:{};function C(e,t){return e!==I&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(r,n){return e[r]=t?t(r,n):n}}n=function(e){var t,r;t=C(I,C(e)),r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i=function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},a=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},c=function(e,t){return function(r,n){t(r,n,e)}},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((n=n.apply(e,t||[])).next())})},d=function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},P=function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},h=function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])},f=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o},g=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},m=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n},y=function(e){return this instanceof y?(this.v=e,this):new y(e)},b=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){i[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||a(e,t)})})}function a(e,t){try{(r=i[e](t)).value instanceof y?Promise.resolve(r.value.v).then(c,u):l(s[0][2],r)}catch(e){l(s[0][3],e)}var r}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},w=function(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:y(e[n](t)),done:"return"===n}:i?i(t):t}:i}},v=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=f(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){!function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}(n,i,(t=e[r](t)).done,t.value)})}}},E=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},A=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},S=function(e){return e&&e.__esModule?e:{default:e}},k=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},R=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},t("__extends",i),t("__assign",s),t("__rest",o),t("__decorate",a),t("__param",c),t("__metadata",u),t("__awaiter",l),t("__generator",d),t("__exportStar",h),t("__createBinding",P),t("__values",f),t("__read",p),t("__spread",g),t("__spreadArrays",m),t("__await",y),t("__asyncGenerator",b),t("__asyncDelegator",w),t("__asyncValues",v),t("__makeTemplateObject",E),t("__importStar",A),t("__importDefault",S),t("__classPrivateFieldGet",k),t("__classPrivateFieldSet",R)}.apply(t,[t]),void 0===n||(e.exports=n)}()},4372(e,t,r){"use strict";var n=r(9675),i=r(6556)("TypedArray.prototype.buffer",!0),s=r(5680);e.exports=i||function(e){if(!s(e))throw new n("Not a Typed Array");return e.buffer}},952(e,t,r){var n;if("object"==typeof globalThis)n=globalThis;else try{n=r(4903)}catch(e){}finally{if(n||"undefined"==typeof window||(n=window),!n)throw new Error("Could not determine global this")}var i=n.WebSocket||n.MozWebSocket,s=r(9840);function o(e,t){return t?new i(e,t):new i(e)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(o,e,{get:function(){return i[e]}})}),e.exports={w3cwebsocket:i?o:null,version:s}},9840(e,t,r){e.exports=r(9003).version},5767(e,t,r){"use strict";var n=r(2682),i=r(9209),s=r(487),o=r(6556),a=r(5795),c=r(3628),u=o("Object.prototype.toString"),l=r(9092)(),d="undefined"==typeof globalThis?r.g:globalThis,h=i(),f=o("String.prototype.slice"),p=o("Array.prototype.indexOf",!0)||function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t)return r;return-1},g={__proto__:null};n(h,l&&a&&c?function(e){var t=new d[e];if(Symbol.toStringTag in t&&c){var r=c(t),n=a(r,Symbol.toStringTag);if(!n&&r){var i=c(r);n=a(i,Symbol.toStringTag)}if(n&&n.get){var o=s(n.get);g["$"+e]=o}}}:function(e){var t=new d[e],r=t.slice||t.set;if(r){var n=s(r);g["$"+e]=n}}),e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!l){var t=f(u(e),8,-1);return p(h,t)>-1?t:"Object"===t&&function(e){var t=!1;return n(g,function(r,n){if(!t)try{r(e),t=f(n,1)}catch(e){}}),t}(e)}return a?function(e){var t=!1;return n(g,function(r,n){if(!t)try{"$"+r(e)===n&&(t=f(n,1))}catch(e){}}),t}(e):null}},4693(e){class t{constructor(e){this.value=e,this.next=void 0}}class r{constructor(){this.clear()}enqueue(e){const r=new t(e);this._head?(this._tail.next=r,this._tail=r):(this._head=r,this._tail=r),this._size++}dequeue(){const e=this._head;if(e)return this._head=this._head.next,this._size--,e.value}clear(){this._head=void 0,this._tail=void 0,this._size=0}get size(){return this._size}*[Symbol.iterator](){let e=this._head;for(;e;)yield e.value,e=e.next}}e.exports=r},2032(){if(void 0===globalThis.setImmediate){const e=new MessageChannel,t=[];e.port1.onmessage=()=>{const e=t.shift();e&&e()},globalThis.setImmediate=(r,...n)=>(t.push(()=>r(...n)),e.port2.postMessage(0),t.length),globalThis.clearImmediate=e=>{e>0&&e<=t.length&&(t[e-1]=null)}}},7790(){},3776(){},9209(e,t,r){"use strict";var n=r(6578),i="undefined"==typeof globalThis?r.g:globalThis;e.exports=function(){for(var e=[],t=0;t<n.length;t++)"function"==typeof i[n[t]]&&(e[e.length]=n[t]);return e}},4874(e,t,r){"use strict";const n=r(793);e.exports=d;const i=function(){function e(e){return void 0!==e&&e}try{return"undefined"!=typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{},s={mapHttpRequest:y,mapHttpResponse:y,wrapRequestSerializer:b,wrapResponseSerializer:b,wrapErrorSerializer:b,req:y,res:y,err:g,errWithCause:g};function o(e,t){return"silent"===e?1/0:t.levels.values[e]}const a=Symbol("pino.logFuncs"),c=Symbol("pino.hierarchy"),u={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function l(e,t){const r={logger:t,parent:e[c]};t[c]=r}function d(e){(e=e||{}).browser=e.browser||{};const t=e.browser.transmit;if(t&&"function"!=typeof t.send)throw Error("pino: transmit option must have a send function");const r=e.browser.write||i;e.browser.write&&(e.browser.asObject=!0);const n=e.serializers||{},s=function(e,t){return Array.isArray(e)?e.filter(function(e){return"!stdSerializers.err"!==e}):!0===e&&Object.keys(t)}(e.browser.serialize,n);let c=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const g=Object.keys(e.customLevels||{}),y=["error","fatal","warn","info","debug","trace"].concat(g);"function"==typeof r&&y.forEach(function(e){r[e]=r}),(!1===e.enabled||e.browser.disabled)&&(e.level="silent");const b=e.level||"info",v=Object.create(r);v.log||(v.log=w),function(e,t,r){const n={};t.forEach(e=>{n[e]=r[e]?r[e]:i[e]||i[u[e]||"log"]||w}),e[a]=n}(v,y,r),l({},v),Object.defineProperty(v,"levelVal",{get:function(){return o(this.level,this)}}),Object.defineProperty(v,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,h(this,E,v,"error"),h(this,E,v,"fatal"),h(this,E,v,"warn"),h(this,E,v,"info"),h(this,E,v,"debug"),h(this,E,v,"trace"),g.forEach(e=>{h(this,E,v,e)})}});const E={transmit:t,serialize:s,asObject:e.browser.asObject,asObjectBindingsOnly:e.browser.asObjectBindingsOnly,formatters:e.browser.formatters,reportCaller:e.browser.reportCaller,levels:y,timestamp:m(e),messageKey:e.messageKey||"msg",onChild:e.onChild||w};function A(r,i,o){if(!i)throw new Error("missing bindings for child Pino");o=o||{},s&&i.serializers&&(o.serializers=i.serializers);const a=o.serializers;if(s&&a){var c=Object.assign({},n,a),u=!0===e.browser.serialize?Object.keys(c):s;delete i.serializers,f([i],u,c,this._stdErrSerialize)}function d(e){this._childLevel=1+(0|e._childLevel),this.bindings=i,c&&(this.serializers=c,this._serialize=u),t&&(this._logEvent=p([].concat(e._logEvent.bindings,i)))}d.prototype=this;const h=new d(this);return l(this,h),h.child=function(...e){return A.call(this,r,...e)},h.level=o.level||this.level,r.onChild(h),h}return v.levels=function(e){const t=e.customLevels||{};return{values:Object.assign({},d.levels.values,t),labels:Object.assign({},d.levels.labels,function(e){const t={};return Object.keys(e).forEach(function(r){t[e[r]]=r}),t}(t))}}(e),v.level=b,v.isLevelEnabled=function(e){return!!this.levels.values[e]&&this.levels.values[e]>=this.levels.values[this.level]},v.setMaxListeners=v.getMaxListeners=v.emit=v.addListener=v.on=v.prependListener=v.once=v.prependOnceListener=v.removeListener=v.removeAllListeners=v.listeners=v.listenerCount=v.eventNames=v.write=v.flush=w,v.serializers=n,v._serialize=s,v._stdErrSerialize=c,v.child=function(...e){return A.call(this,E,...e)},t&&(v._logEvent=p()),v}function h(e,t,r,s){if(Object.defineProperty(e,s,{value:o(e.level,r)>o(s,r)?w:r[a][s],writable:!0,enumerable:!0,configurable:!0}),e[s]===w){if(!t.transmit)return;const n=o(t.transmit.level||e.level,r);if(o(s,r)<n)return}e[s]=function(e,t,r,s){return c=e[a][s],function(){const a=t.timestamp(),u=new Array(arguments.length),l=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var d=0;d<u.length;d++)u[d]=arguments[d];var h=!1;if(t.serialize&&(f(u,this._serialize,this.serializers,this._stdErrSerialize),h=!0),t.asObject||t.formatters){const e=function(e,t,r,i,s){const{level:o,log:a=e=>e}=s.formatters||{},c=r.slice();let u=c[0];const l={};let d=1+(0|e._childLevel);if(d<1&&(d=1),i&&(l.time=i),o){const r=o(t,e.levels.values[t]);Object.assign(l,r)}else l.level=e.levels.values[t];if(s.asObjectBindingsOnly){if(null!==u&&"object"==typeof u)for(;d--&&"object"==typeof c[0];)Object.assign(l,c.shift());return[a(l),...c]}if(null!==u&&"object"==typeof u){for(;d--&&"object"==typeof c[0];)Object.assign(l,c.shift());u=c.length?n(c.shift(),c):void 0}else"string"==typeof u&&(u=n(c.shift(),c));return void 0!==u&&(l[s.messageKey]=u),[a(l)]}(this,s,u,a,t);if(t.reportCaller&&e&&e.length>0&&e[0]&&"object"==typeof e[0])try{const t=A();t&&(e[0].caller=t)}catch(e){}c.call(l,...e)}else{if(t.reportCaller)try{const e=A();e&&u.push(e)}catch(e){}c.apply(l,u)}if(t.transmit){const n=t.transmit.level||e._level,i=o(n,r),c=o(s,r);if(c<i)return;!function(e,t,r,n=!1){const i=t.send,s=t.ts,o=t.methodLevel,a=t.methodValue,c=t.val,u=e._logEvent.bindings;n||f(r,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=s,e._logEvent.messages=r.filter(function(e){return-1===u.indexOf(e)}),e._logEvent.level.label=o,e._logEvent.level.value=a,i(o,e._logEvent,c),e._logEvent=p(u)}(this,{ts:a,methodLevel:s,methodValue:c,transmitLevel:n,transmitValue:r.levels.values[t.transmit.level||e._level],send:t.transmit.send,val:o(e._level,r)},u,h)}};var c}(e,t,r,s);const u=function(e){const t=[];e.bindings&&t.push(e.bindings);let r=e[c];for(;r.parent;)r=r.parent,r.logger.bindings&&t.push(r.logger.bindings);return t.reverse()}(e);0!==u.length&&(e[s]=function(e,t){return function(){return t.apply(this,[...e,...arguments])}}(u,e[s]))}function f(e,t,r,n){for(const i in e)if(n&&e[i]instanceof Error)e[i]=d.stdSerializers.err(e[i]);else if("object"==typeof e[i]&&!Array.isArray(e[i])&&t)for(const n in e[i])t.indexOf(n)>-1&&n in r&&(e[i][n]=r[n](e[i][n]))}function p(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function g(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const r in e)void 0===t[r]&&(t[r]=e[r]);return t}function m(e){return"function"==typeof e.timestamp?e.timestamp:!1===e.timestamp?v:E}function y(){return{}}function b(e){return e}function w(){}function v(){return!1}function E(){return Date.now()}function A(){const e=(new Error).stack;if(!e)return null;const t=e.split("\n");for(let e=1;e<t.length;e++){const r=t[e].trim();if(/(^at\s+)?(createWrap|LOG|set\s*\(|asObject|Object\.apply|Function\.apply)/.test(r))continue;if(-1!==r.indexOf("browser.js"))continue;if(-1!==r.indexOf("node:internal"))continue;if(-1!==r.indexOf("node_modules"))continue;let n=r.match(/\((.*?):(\d+):(\d+)\)/);if(n||(n=r.match(/at\s+(.*?):(\d+):(\d+)/)),n)return n[1]+":"+n[2]+":"+n[3]}return null}d.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},d.stdSerializers=s,d.stdTimeFunctions=Object.assign({},{nullTime:v,epochTime:E,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}}),e.exports.default=d,e.exports.pino=d},8630(e,t,r){var n;!function(e){!function(){var t="object"==typeof globalThis?globalThis:"object"==typeof r.g?r.g:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),n=i(e);function i(e,t){return function(r,n){Object.defineProperty(e,r,{configurable:!0,writable:!0,value:n}),t&&t(r,n)}}void 0!==t.Reflect&&(n=i(t.Reflect,n)),function(e,t){var r=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,c=!o&&!a,u={create:o?function(){return q(Object.create(null))}:a?function(){return q({__proto__:null})}:function(){return q({})},has:c?function(e,t){return r.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return r.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),d="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[s]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var n=this._keys.length,i=r+1;i<n;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,D(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,n)},t.prototype.values=function(){return new r(this._keys,this._values,i)},t.prototype.entries=function(){return new r(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[s]=function(){return this.entries()},t.prototype._find=function(e,t){if(!D(this._cacheKey,e)){this._cacheIndex=-1;for(var r=0;r<this._keys.length;r++)if(D(this._keys[r],e)){this._cacheIndex=r;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function n(e,t){return e}function i(e,t){return t}function o(e,t){return[e,t]}}(),h="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[s]=function(){return this.keys()},e}(),f="function"==typeof WeakMap?WeakMap:function(){var e=u.create(),t=n();return function(){function e(){this._key=n()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=n()},e}();function n(){var t;do{t="@@WeakMap@@"+o()}while(u.has(e,t));return e[t]=!0,t}function i(e,n){if(!r.call(e,t)){if(!n)return;Object.defineProperty(e,t,{value:u.create()})}return e[t]}function s(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function o(){var e=function(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):s(t,e),t}return s(new Array(e),e)}(16);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var t="",r=0;r<16;++r){var n=e[r];4!==r&&6!==r&&8!==r||(t+="-"),n<16&&(t+="0"),t+=n.toString(16).toLowerCase()}return t}}(),p=n?Symbol.for("@reflect-metadata:registry"):void 0,g=function(){var e;return!R(p)&&I(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[p]),R(e)&&(e=function(){var e,r,n,i;R(p)||void 0===t.Reflect||p in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=function(e){var t=e.defineMetadata,r=e.hasOwnMetadata,n=e.getOwnMetadata,i=e.getOwnMetadataKeys,s=e.deleteMetadata,o=new f;return{isProviderFor:function(e,t){var r=o.get(e);return!(R(r)||!r.has(t))||!!i(e,t).length&&(R(r)&&(r=new h,o.set(e,r)),r.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:n,OrdinaryOwnMetadataKeys:i,OrdinaryDeleteMetadata:s}}(t.Reflect));var s=new f,o={registerProvider:a,getProvider:u,setProvider:g};return o;function a(t){if(!Object.isExtensible(o))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case R(r):r=t;break;case r===t:break;case R(n):n=t;break;case n===t:break;default:void 0===i&&(i=new h),i.add(t)}}function c(t,s){if(!R(r)){if(r.isProviderFor(t,s))return r;if(!R(n)){if(n.isProviderFor(t,s))return r;if(!R(i))for(var o=B(i);;){var a=F(o);if(!a)return;var c=L(a);if(c.isProviderFor(t,s))return U(o),c}}}if(!R(e)&&e.isProviderFor(t,s))return e}function u(e,t){var r,n=s.get(e);return R(n)||(r=n.get(t)),R(r)?(R(r=c(e,t))||(R(n)&&(n=new d,s.set(e,n)),n.set(t,r)),r):r}function l(e){if(R(e))throw new TypeError;return r===e||n===e||!R(i)&&i.has(e)}function g(e,t,r){if(!l(r))throw new Error("Metadata provider not registered.");var n=u(e,t);if(n!==r){if(!R(n))return!1;var i=s.get(e);R(i)&&(i=new d,s.set(e,i)),i.set(t,r)}return!0}}()),!R(p)&&I(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,p,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}(),m=function(e){var t=new f,r={isProviderFor:function(e,r){var n=t.get(e);return!R(n)&&n.has(r)},OrdinaryDefineOwnMetadata:function(e,t,r,i){n(r,i,!0).set(e,t)},OrdinaryHasOwnMetadata:function(e,t,r){var i=n(t,r,!1);return!R(i)&&_(i.has(e))},OrdinaryGetOwnMetadata:function(e,t,r){var i=n(t,r,!1);if(!R(i))return i.get(e)},OrdinaryOwnMetadataKeys:function(e,t){var r=[],i=n(e,t,!1);if(R(i))return r;for(var s=B(i.keys()),o=0;;){var a=F(s);if(!a)return r.length=o,r;var c=L(a);try{r[o]=c}catch(e){try{U(s)}finally{throw e}}o++}},OrdinaryDeleteMetadata:function(e,r,i){var s=n(r,i,!1);if(R(s))return!1;if(!s.delete(e))return!1;if(0===s.size){var o=t.get(r);R(o)||(o.delete(i),0===o.size&&t.delete(o))}return!0}};return g.registerProvider(r),r;function n(n,i,s){var o=t.get(n),a=!1;if(R(o)){if(!s)return;o=new d,t.set(n,o),a=!0}var c=o.get(i);if(R(c)){if(!s)return;if(c=new d,o.set(i,c),!e.setProvider(n,i,r))throw o.delete(i),a&&t.delete(n),new Error("Wrong provider for target.")}return c}}(g);function y(e,t,r){if(b(e,t,r))return!0;var n=j(t);return!P(n)&&y(e,n,r)}function b(e,t,r){var n=z(t,r,!1);return!R(n)&&_(n.OrdinaryHasOwnMetadata(e,t,r))}function w(e,t,r){if(b(e,t,r))return v(e,t,r);var n=j(t);return P(n)?void 0:w(e,n,r)}function v(e,t,r){var n=z(t,r,!1);if(!R(n))return n.OrdinaryGetOwnMetadata(e,t,r)}function E(e,t,r,n){z(r,n,!0).OrdinaryDefineOwnMetadata(e,t,r,n)}function A(e,t){var r=S(e,t),n=j(e);if(null===n)return r;var i=A(n,t);if(i.length<=0)return r;if(r.length<=0)return i;for(var s=new h,o=[],a=0,c=r;a<c.length;a++){var u=c[a];s.has(u)||(s.add(u),o.push(u))}for(var l=0,d=i;l<d.length;l++)u=d[l],s.has(u)||(s.add(u),o.push(u));return o}function S(e,t){var r=z(e,t,!1);return r?r.OrdinaryOwnMetadataKeys(e,t):[]}function k(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function R(e){return void 0===e}function P(e){return null===e}function I(e){return"object"==typeof e?null!==e:"function"==typeof e}function C(e,t){switch(k(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",n=M(e,i);if(void 0!==n){var s=n.call(e,r);if(I(s))throw new TypeError;return s}return function(e,t){if("string"===t){var r=e.toString;if(x(r)&&!I(i=r.call(e)))return i;if(x(n=e.valueOf)&&!I(i=n.call(e)))return i}else{var n;if(x(n=e.valueOf)&&!I(i=n.call(e)))return i;var i,s=e.toString;if(x(s)&&!I(i=s.call(e)))return i}throw new TypeError}(e,"default"===r?"number":r)}function _(e){return!!e}function T(e){var t=C(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function N(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function x(e){return"function"==typeof e}function O(e){return"function"==typeof e}function D(e,t){return e===t||e!=e&&t!=t}function M(e,t){var r=e[t];if(null!=r){if(!x(r))throw new TypeError;return r}}function B(e){var t=M(e,s);if(!x(t))throw new TypeError;var r=t.call(e);if(!I(r))throw new TypeError;return r}function L(e){return e.value}function F(e){var t=e.next();return!t.done&&t}function U(e){var t=e.return;t&&t.call(e)}function j(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var r=e.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return t;var i=n.constructor;return"function"!=typeof i||i===e?t:i}function z(e,t,r){var n=g.getProvider(e,t);if(!R(n))return n;if(r){if(g.setProvider(e,t,m))return m;throw new Error("Illegal state.")}}function q(e){return e.__=void 0,delete e.__,e}e("decorate",function(e,t,r,n){if(R(r)){if(!N(e))throw new TypeError;if(!O(t))throw new TypeError;return function(e,t){for(var r=e.length-1;r>=0;--r){var n=(0,e[r])(t);if(!R(n)&&!P(n)){if(!O(n))throw new TypeError;t=n}}return t}(e,t)}if(!N(e))throw new TypeError;if(!I(t))throw new TypeError;if(!I(n)&&!R(n)&&!P(n))throw new TypeError;return P(n)&&(n=void 0),function(e,t,r,n){for(var i=e.length-1;i>=0;--i){var s=(0,e[i])(t,r,n);if(!R(s)&&!P(s)){if(!I(s))throw new TypeError;n=s}}return n}(e,t,r=T(r),n)}),e("metadata",function(e,t){return function(r,n){if(!I(r))throw new TypeError;if(!R(n)&&!function(e){switch(k(e)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;E(e,t,r,n)}}),e("defineMetadata",function(e,t,r,n){if(!I(r))throw new TypeError;return R(n)||(n=T(n)),E(e,t,r,n)}),e("hasMetadata",function(e,t,r){if(!I(t))throw new TypeError;return R(r)||(r=T(r)),y(e,t,r)}),e("hasOwnMetadata",function(e,t,r){if(!I(t))throw new TypeError;return R(r)||(r=T(r)),b(e,t,r)}),e("getMetadata",function(e,t,r){if(!I(t))throw new TypeError;return R(r)||(r=T(r)),w(e,t,r)}),e("getOwnMetadata",function(e,t,r){if(!I(t))throw new TypeError;return R(r)||(r=T(r)),v(e,t,r)}),e("getMetadataKeys",function(e,t){if(!I(e))throw new TypeError;return R(t)||(t=T(t)),A(e,t)}),e("getOwnMetadataKeys",function(e,t){if(!I(e))throw new TypeError;return R(t)||(t=T(t)),S(e,t)}),e("deleteMetadata",function(e,t,r){if(!I(t))throw new TypeError;if(R(r)||(r=T(r)),!I(t))throw new TypeError;R(r)||(r=T(r));var n=z(t,r,!1);return!R(n)&&n.OrdinaryDeleteMetadata(e,t,r)})}(n,t),void 0===t.Reflect&&(t.Reflect=e)}()}(n||(n={}))},606(e){"use strict";e.exports=JSON.parse('["constructor()","event Approval(address indexed owner, address indexed spender, uint256 value)","event RoleAdminChanged(bytes32 indexed role, bytes32 indexed previousAdminRole, bytes32 indexed newAdminRole)","event RoleGranted(bytes32 indexed role, address indexed account, address indexed sender)","event RoleRevoked(bytes32 indexed role, address indexed account, address indexed sender)","event Transfer(address indexed from, address indexed to, uint256 value, bytes data)","event Transfer(address indexed from, address indexed to, uint256 value)","event UpdatedTokenInformation(string newName, string newSymbol)","function DEFAULT_ADMIN_ROLE() view returns (bytes32)","function DOMAIN_SEPARATOR() view returns (bytes32)","function MINTER_ROLE() view returns (bytes32)","function allowance(address owner, address spender) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function balanceOf(address account) view returns (uint256)","function burn(uint256 amount)","function burnFrom(address account, uint256 amount)","function decimals() view returns (uint8)","function decreaseAllowance(address spender, uint256 subtractedValue) returns (bool)","function getRoleAdmin(bytes32 role) view returns (bytes32)","function grantRole(bytes32 role, address account)","function hasRole(bytes32 role, address account) view returns (bool)","function increaseAllowance(address spender, uint256 addedValue) returns (bool)","function isMinter(address minter) view returns (bool)","function mint(address to, uint256 amount)","function name() view returns (string)","function nonces(address owner) view returns (uint256)","function permit(address owner, address spender, uint256 value, uint256 deadline, uint8 v, bytes32 r, bytes32 s)","function renounceRole(bytes32 role, address account)","function revokeRole(bytes32 role, address account)","function setTokenInformation(string newName, string newSymbol)","function supportsInterface(bytes4 interfaceId) view returns (bool)","function symbol() view returns (string)","function totalSupply() view returns (uint256)","function transfer(address recipient, uint256 amount) returns (bool)","function transferAndCall(address _to, uint256 _value, bytes _data) returns (bool success)","function transferFrom(address sender, address recipient, uint256 amount) returns (bool)"]')},3173(e){"use strict";e.exports=JSON.parse('["event AdminChanged(address previousAdmin, address newAdmin)","event BeaconUpgraded(address indexed beacon)","event NodeRemoved(address indexed nodeAddress)","event NodeUpdated(address indexed nodeAddress, string metadata, uint256 indexed isNew, uint256 lastSeen)","event NodeWhitelistApproved(address indexed nodeAddress)","event NodeWhitelistRejected(address indexed nodeAddress)","event OwnershipTransferred(address indexed previousOwner, address indexed newOwner)","event RequiresWhitelistChanged(bool indexed value)","event Upgraded(address indexed implementation)","function createOrUpdateNode(address node, string metadata_)","function createOrUpdateNodeSelf(string metadata_)","function getNode(address nodeAddress) view returns ((address nodeAddress, string metadata, uint256 lastSeen))","function getNodeByNumber(uint256 i) view returns ((address nodeAddress, string metadata, uint256 lastSeen))","function getNodes() view returns ((address nodeAddress, string metadata, uint256 lastSeen)[])","function headNode() view returns (address)","function initialize(address owner, bool requiresWhitelist_, address[] initialNodes, string[] initialMetadata)","function kickOut(address nodeAddress)","function nodeCount() view returns (uint64)","function nodes(address) view returns ((address nodeAddress, string metadata, uint256 lastSeen) node, address next, address prev)","function owner() view returns (address)","function removeNode(address nodeAddress)","function removeNodeSelf()","function renounceOwnership()","function requiresWhitelist() view returns (bool)","function setRequiresWhitelist(bool value)","function tailNode() view returns (address)","function transferOwnership(address newOwner)","function upgradeTo(address newImplementation)","function upgradeToAndCall(address newImplementation, bytes data) payable","function whitelist(address) view returns (uint8)","function whitelistApproveNode(address nodeAddress)","function whitelistRejectNode(address nodeAddress)"]')},862(e){"use strict";e.exports=JSON.parse('["constructor()","error AccessDenied()","error AccessDeniedDATATokenOnly()","error AccessDeniedNodesOnly()","error AccessDeniedOperatorOnly()","error AccessDeniedStreamrSponsorshipOnly()","error DelegationBelowMinimum(uint256 operatorTokenBalanceWei, uint256 minimumDelegationWei)","error DidNotReceiveReward()","error FirstEmptyQueueThenStake()","error InvalidOperatorsCut(uint256 newOperatorsCutFraction)","error ModuleCallError(address module, bytes data)","error ModuleGetError(bytes data)","error NoEarnings()","error NotMyStakedSponsorship()","error SelfDelegationTooLow(uint256 operatorBalanceWei, uint256 minimumSelfDelegationWei)","error StakedInSponsorships()","error ZeroUndelegation()","event Approval(address indexed owner, address indexed spender, uint256 value)","event BalanceUpdate(address indexed delegator, uint256 balanceWei, uint256 totalSupplyWei, uint256 dataValueWithoutEarnings)","event Delegated(address indexed delegator, uint256 amountDataWei)","event Heartbeat(address indexed nodeAddress, string jsonData)","event Initialized(uint8 version)","event Loss(uint256 valueDecreaseWei)","event MetadataUpdated(string metadataJsonString, address indexed operatorAddress, uint256 indexed operatorsCutFraction)","event NodesSet(address[] nodes)","event OperatorSlashed(uint256 slashingAmountDataWei, uint256 slashingAmountInOperatorTokensWei, uint256 actuallySlashedInOperatorTokensWei)","event OperatorValueUpdate(uint256 totalStakeInSponsorshipsWei, uint256 dataTokenBalanceWei)","event Profit(uint256 valueIncreaseWei, uint256 indexed operatorsCutDataWei, uint256 indexed protocolFeeDataWei)","event QueueUpdated(address indexed delegator, uint256 amountWei, uint256 queueIndex)","event QueuedDataPayout(address indexed delegator, uint256 amountWei, uint256 queueIndex)","event ReviewRequest(address indexed sponsorship, address indexed targetOperator, uint256 voteStartTimestamp, uint256 voteEndTimestamp, string flagMetadata)","event RoleAdminChanged(bytes32 indexed role, bytes32 indexed previousAdminRole, bytes32 indexed newAdminRole)","event RoleGranted(bytes32 indexed role, address indexed account, address indexed sender)","event RoleRevoked(bytes32 indexed role, address indexed account, address indexed sender)","event StakeUpdate(address indexed sponsorship, uint256 stakedWei)","event Staked(address indexed sponsorship)","event Transfer(address indexed from, address indexed to, uint256 value)","event Undelegated(address indexed delegator, uint256 amountDataWei)","event Unstaked(address indexed sponsorship)","fallback()","function CONTROLLER_ROLE() view returns (bytes32)","function DEFAULT_ADMIN_ROLE() view returns (bytes32)","function OWNER_ROLE() view returns (bytes32)","function allowance(address owner, address spender) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function balanceInData(address delegator) view returns (uint256 amountDataWei)","function balanceOf(address account) view returns (uint256)","function decimals() view returns (uint8)","function decreaseAllowance(address spender, uint256 subtractedValue) returns (bool)","function delegate(uint256 amountWei)","function delegationPolicy() view returns (address)","function exchangeRatePolicy() view returns (address)","function flag(address sponsorship, address targetOperator, string flagMetadata)","function forceUnstake(address sponsorship, uint256 maxQueuePayoutIterations)","function getNodeAddresses() view returns (address[])","function getRoleAdmin(bytes32 role) view returns (bytes32)","function getSponsorshipsAndEarnings() view returns (address[] addresses, uint256[] earnings, uint256 maxAllowedEarnings)","function getStreamMetadata() view returns (string)","function grantRole(bytes32 role, address account)","function hasRole(bytes32 role, address account) view returns (bool)","function heartbeat(string jsonData)","function increaseAllowance(address spender, uint256 addedValue) returns (bool)","function indexOfSponsorships(address) view returns (uint256)","function initialize(address tokenAddress, address config, address ownerAddress, string operatorTokenName, string operatorMetadataJson, uint256 operatorsCut, address[3] modules)","function isTrustedForwarder(address forwarder) view returns (bool)","function latestDelegationTimestamp(address) view returns (uint256)","function metadata() view returns (string)","function name() view returns (string)","function nodeIndex(address) view returns (uint256)","function nodeModule() view returns (address)","function nodes(uint256) view returns (address)","function onKick(uint256 amountSlashedDataWei, uint256 receivedPayoutWei)","function onReviewRequest(address targetOperator)","function onSlash(uint256 amountSlashed)","function onTokenTransfer(address sender, uint256 amount, bytes data)","function operatorsCutFraction() view returns (uint256)","function owner() view returns (address)","function payOutFirstInQueue() returns (bool payoutComplete)","function payOutQueue(uint256 maxIterations)","function queueCurrentIndex() view returns (uint256)","function queueEntryAt(uint256) view returns (address delegator, uint256 amountWei, uint256 timestamp)","function queueIsEmpty() view returns (bool)","function queueLastIndex() view returns (uint256)","function queueModule() view returns (address)","function reduceStakeTo(address sponsorship, uint256 targetStakeWei)","function reduceStakeWithoutQueue(address sponsorship, uint256 targetStakeWei)","function renounceRole(bytes32 role, address account)","function revokeRole(bytes32 role, address account)","function setDelegationPolicy(address policy, uint256 param)","function setExchangeRatePolicy(address policy, uint256 param)","function setNodeAddresses(address[] newNodes)","function setUndelegationPolicy(address policy, uint256 param)","function slashedIn(address) view returns (uint256)","function sponsorships(uint256) view returns (address)","function stake(address sponsorship, uint256 amountWei)","function stakeModule() view returns (address)","function stakedInto(address) view returns (uint256)","function streamId() view returns (string)","function streamRegistry() view returns (address)","function streamrConfig() view returns (address)","function supportsInterface(bytes4 interfaceId) view returns (bool)","function symbol() view returns (string)","function token() view returns (address)","function totalSlashedInSponsorshipsWei() view returns (uint256)","function totalStakedIntoSponsorshipsWei() view returns (uint256)","function totalSupply() view returns (uint256)","function transfer(address to, uint256 amount) returns (bool)","function transferFrom(address from, address to, uint256 amount) returns (bool)","function triggerAnotherOperatorWithdraw(address other, address[] sponsorshipAddresses)","function undelegate(uint256 amountDataWei)","function undelegationPolicy() view returns (address)","function undelegationQueue() view returns ((address delegator, uint256 amountWei, uint256 timestamp)[] queue)","function unstake(address sponsorship)","function unstakeWithoutQueue(address sponsorship)","function updateMetadata(string metadataJsonString)","function updateNodeAddresses(address[] addNodes, address[] removeNodes)","function updateOperatorsCutFraction(uint256 newOperatorsCutFraction)","function updateStreamMetadata(string metadataJsonString)","function valueWithoutEarnings() view returns (uint256)","function version() pure returns (uint256)","function voteOnFlag(address sponsorship, address targetOperator, bytes32 voteData)","function withdrawEarningsFromSponsorships(address[] sponsorshipAddresses)","function withdrawEarningsFromSponsorshipsWithoutQueue(address[] sponsorshipAddresses) returns (uint256 withdrawnEarningsDataWei)"]')},5324(e){"use strict";e.exports=JSON.parse('["constructor()","error AccessDeniedDATATokenOnly()","error AlreadyLive()","error ExchangeRatePolicyRequired()","error InvalidOperatorContract(address notAnOperatorContractAddress)","error NotDelegationPolicy()","error NotExchangeRatePolicy()","error NotLive()","error NotUndelegationPolicy()","error OperatorAlreadyDeployed(address operatorContractAddress)","error PolicyNotTrusted()","event AdminChanged(address previousAdmin, address newAdmin)","event BeaconUpgraded(address indexed beacon)","event Initialized(uint8 version)","event NewOperator(address indexed operatorAddress, address indexed operatorContractAddress)","event PolicyWhitelisted(address indexed policyAddress, bool indexed isWhitelisted)","event RoleAdminChanged(bytes32 indexed role, bytes32 indexed previousAdminRole, bytes32 indexed newAdminRole)","event RoleGranted(bytes32 indexed role, address indexed account, address indexed sender)","event RoleRevoked(bytes32 indexed role, address indexed account, address indexed sender)","event TemplateAddresses(address indexed operatorTemplate, address nodeModuleTemplate, address indexed queueModuleTemplate, address indexed stakeModuleTemplate)","event Upgraded(address indexed implementation)","event VoterUpdate(address indexed voterAddress, bool indexed isVoter)","function ADMIN_ROLE() view returns (bytes32)","function DEFAULT_ADMIN_ROLE() view returns (bytes32)","function addTrustedPolicies(address[] policyAddresses)","function addTrustedPolicy(address policyAddress)","function deployOperator(uint256 operatorsCutFraction, string operatorTokenName, string operatorMetadataJson, address[3] policies, uint256[3] policyParams) returns (address)","function deploymentTimestamp(address) view returns (uint256)","function getRoleAdmin(bytes32 role) view returns (bytes32)","function grantRole(bytes32 role, address account)","function hasRole(bytes32 role, address account) view returns (bool)","function initialize(address templateAddress, address dataTokenAddress, address streamrConfigAddress, address nodeModuleAddress, address queueModuleAddress, address stakeModuleAddress)","function isTrustedForwarder(address forwarder) view returns (bool)","function isTrustedPolicy(address policyAddress) view returns (bool)","function nodeModuleTemplate() view returns (address)","function onTokenTransfer(address from, uint256 amount, bytes param)","function operatorTemplate() view returns (address)","function operators(address) view returns (address)","function predictAddress(address deployer, string operatorTokenName) view returns (address)","function proxiableUUID() view returns (bytes32)","function queueModuleTemplate() view returns (address)","function removeTrustedPolicy(address policyAddress)","function renounceRole(bytes32 role, address account)","function revokeRole(bytes32 role, address account)","function stakeModuleTemplate() view returns (address)","function stakedWei(address) view returns (uint256)","function streamrConfig() view returns (address)","function supportsInterface(bytes4 interfaceId) view returns (bool)","function tokenAddress() view returns (address)","function totalStakedWei() view returns (uint256)","function trustedPolicies(address) view returns (bool)","function updateTemplates(address templateAddress, address nodeModuleAddress, address queueModuleAddress, address stakeModuleAddress)","function upgradeTo(address newImplementation)","function upgradeToAndCall(address newImplementation, bytes data) payable","function voterCount() view returns (uint256)","function voterUpdate(address operatorContractAddress) returns (bool isEligible)","function voters(uint256) view returns (address)","function votersIndex(address) view returns (uint256)"]')},6963(e){"use strict";e.exports=JSON.parse('["constructor()","error AccessDenied()","error AccessDeniedDATATokenOnly()","error ActiveFlag(uint256 lockedStakeWei)","error CannotIncreaseStakeUsingReduceStakeTo()","error FlaggingNotSupported()","error LeavePenalty(uint256 penaltyWei)","error MinOperatorCountZero()","error MinimumStake(uint256 minimumStakeWei)","error ModuleCallError(address moduleAddress, bytes callBytes)","error ModuleGetError(bytes callBytes)","error OperatorNotStaked()","event FlagUpdate(address indexed target, uint8 indexed status, uint256 votesForKick, uint256 votesAgainstKick, address indexed voter, int256 voterWeight)","event Flagged(address indexed target, address indexed flagger, uint256 targetStakeAtRiskWei, uint256 indexed reviewerCount, string flagMetadata)","event Initialized(uint8 version)","event InsolvencyEnded(uint256 endTimeStamp, uint256 defaultedWeiPerStake, uint256 defaultedWei)","event InsolvencyStarted(uint256 startTimeStamp)","event OperatorJoined(address indexed operator)","event OperatorKicked(address indexed operator)","event OperatorLeft(address indexed operator, uint256 returnedStakeWei)","event OperatorSlashed(address indexed operator, uint256 amountWei)","event RoleAdminChanged(bytes32 indexed role, bytes32 indexed previousAdminRole, bytes32 indexed newAdminRole)","event RoleGranted(bytes32 indexed role, address indexed account, address indexed sender)","event RoleRevoked(bytes32 indexed role, address indexed account, address indexed sender)","event SponsorshipReceived(address indexed sponsor, uint256 amount)","event SponsorshipUpdate(uint256 totalStakedWei, uint256 remainingWei, uint256 indexed operatorCount, bool indexed isRunning)","event StakeLockUpdate(address indexed operator, uint256 lockedStakeWei, uint256 minimumStakeWei)","event StakeUpdate(address indexed operator, uint256 stakedWei, uint256 earningsWei)","fallback()","function DEFAULT_ADMIN_ROLE() view returns (bytes32)","function addJoinPolicy(address newJoinPolicy, uint256 param)","function allocationPolicy() view returns (address)","function earningsWei() view returns (uint256)","function flag(address target, string metadataJsonString)","function flagMetadataJson(address) view returns (string)","function forceUnstake() returns (uint256 payoutWei)","function forfeitedStakeWei() view returns (uint256)","function getEarnings(address operator) view returns (uint256 allocation)","function getFlag(address target) view returns (uint256 flagData, string flagMetadata)","function getLeavePenalty(address operator) view returns (uint256 leavePenalty)","function getMyStake() view returns (uint256)","function getRoleAdmin(bytes32 role) view returns (bytes32)","function grantRole(bytes32 role, address account)","function hasRole(bytes32 role, address account) view returns (bool)","function initialize(string streamId_, string metadata_, address globalStreamrConfig, address tokenAddress, uint256[3] initParams, address initialAllocationPolicy)","function isFunded() view returns (bool)","function isRunning() view returns (bool)","function isTrustedForwarder(address forwarder) view returns (bool)","function joinPolicies(uint256) view returns (address)","function joinTimeOfOperator(address) view returns (uint256)","function kickPolicy() view returns (address)","function leavePolicy() view returns (address)","function lockedStakeWei(address) view returns (uint256)","function metadata() view returns (string)","function minHorizonSeconds() view returns (uint256)","function minOperatorCount() view returns (uint256)","function minimumStakeOf(address operator) view returns (uint256 individualMinimumStakeWei)","function onTokenTransfer(address sender, uint256 amount, bytes data)","function operatorCount() view returns (uint256)","function reduceStakeTo(uint256 targetStakeWei) returns (uint256 payoutWei)","function remainingWei() view returns (uint256)","function renounceRole(bytes32 role, address account)","function revokeRole(bytes32 role, address account)","function setAllocationPolicy(address newAllocationPolicy, uint256 param)","function setKickPolicy(address newKickPolicy, uint256 param)","function setLeavePolicy(address newLeavePolicy, uint256 param)","function solventUntilTimestamp() view returns (uint256 horizon)","function sponsor(uint256 amountWei)","function stake(address operator, uint256 amountWei)","function stakedWei(address) view returns (uint256)","function streamId() view returns (string)","function streamrConfig() view returns (address)","function supportsInterface(bytes4 interfaceId) view returns (bool)","function token() view returns (address)","function totalStakedWei() view returns (uint256)","function unstake() returns (uint256 payoutWei)","function voteOnFlag(address target, bytes32 voteData)","function withdraw() returns (uint256 payoutWei)"]')},7046(e){"use strict";e.exports=JSON.parse('["constructor()","error AccessDeniedDATATokenOnly()","error AllocationPolicyRequired()","error BadArguments()","error PolicyNotTrusted()","error StreamNotFound()","event AdminChanged(address previousAdmin, address newAdmin)","event BeaconUpgraded(address indexed beacon)","event Initialized(uint8 version)","event NewSponsorship(address indexed sponsorshipContract, string streamId, string metadata, address[] policies, uint256[] policyParams, address indexed creator)","event PolicyWhitelisted(address indexed policyAddress, bool indexed isWhitelisted)","event RoleAdminChanged(bytes32 indexed role, bytes32 indexed previousAdminRole, bytes32 indexed newAdminRole)","event RoleGranted(bytes32 indexed role, address indexed account, address indexed sender)","event RoleRevoked(bytes32 indexed role, address indexed account, address indexed sender)","event TemplateAddress(address indexed templateAddress)","event Upgraded(address indexed implementation)","function ADMIN_ROLE() view returns (bytes32)","function DEFAULT_ADMIN_ROLE() view returns (bytes32)","function addTrustedPolicies(address[] policyAddresses)","function addTrustedPolicy(address policyAddress)","function deploySponsorship(uint256 minOperatorCount, string streamId, string metadata, address[] policies, uint256[] policyParams) returns (address)","function deploymentTimestamp(address) view returns (uint256)","function getRoleAdmin(bytes32 role) view returns (bytes32)","function grantRole(bytes32 role, address account)","function hasRole(bytes32 role, address account) view returns (bool)","function initialize(address templateAddress, address dataTokenAddress, address streamrConfigAddress)","function isTrustedForwarder(address forwarder) view returns (bool)","function isTrustedPolicy(address policyAddress) view returns (bool)","function onTokenTransfer(address from, uint256 amount, bytes param)","function proxiableUUID() view returns (bytes32)","function removeTrustedPolicy(address policyAddress)","function renounceRole(bytes32 role, address account)","function revokeRole(bytes32 role, address account)","function sponsorshipContractTemplate() view returns (address)","function streamrConfig() view returns (address)","function supportsInterface(bytes4 interfaceId) view returns (bool)","function tokenAddress() view returns (address)","function trustedPolicies(address) view returns (bool)","function updateTemplate(address templateAddress)","function upgradeTo(address newImplementation)","function upgradeToAndCall(address newImplementation, bytes data) payable"]')},6544(e){"use strict";e.exports=JSON.parse('["error TooHigh(uint256 value, uint256 limit)","error TooLow(uint256 value, uint256 limit)","event AdminChanged(address previousAdmin, address newAdmin)","event BeaconUpgraded(address indexed beacon)","event ConfigChanged(string indexed key, uint256 indexed newValue, address indexed newAddress)","event Initialized(uint8 version)","event RoleAdminChanged(bytes32 indexed role, bytes32 indexed previousAdminRole, bytes32 indexed newAdminRole)","event RoleGranted(bytes32 indexed role, address indexed account, address indexed sender)","event RoleRevoked(bytes32 indexed role, address indexed account, address indexed sender)","event Upgraded(address indexed implementation)","function ADMIN_ROLE() view returns (bytes32)","function CONFIGURATOR_ROLE() view returns (bytes32)","function DEFAULT_ADMIN_ROLE() view returns (bytes32)","function UPGRADER_ROLE() view returns (bytes32)","function earlyLeaverPenaltyWei() view returns (uint256)","function fishermanRewardFraction() view returns (uint256)","function flagProtectionSeconds() view returns (uint256)","function flagReviewerCount() view returns (uint256)","function flagReviewerRewardWei() view returns (uint256)","function flagReviewerSelectionIterations() view returns (uint256)","function flagStakeWei() view returns (uint256)","function flaggerRewardWei() view returns (uint256)","function getRoleAdmin(bytes32 role) view returns (bytes32)","function grantRole(bytes32 role, address account)","function hasRole(bytes32 role, address account) view returns (bool)","function initialize()","function maxAllowedEarningsFraction() view returns (uint256)","function maxPenaltyPeriodSeconds() view returns (uint256)","function maxQueueSeconds() view returns (uint256)","function minEligibleVoterAge() view returns (uint256)","function minEligibleVoterFractionOfAllStake() view returns (uint256)","function minimumDelegationSeconds() view returns (uint256)","function minimumDelegationWei() view returns (uint256)","function minimumSelfDelegationFraction() view returns (uint256)","function minimumStakeWei() view returns (uint256)","function operatorContractOnlyJoinPolicy() view returns (address)","function operatorFactory() view returns (address)","function protocolFeeBeneficiary() view returns (address)","function protocolFeeFraction() view returns (uint256)","function proxiableUUID() view returns (bytes32)","function randomOracle() view returns (address)","function renounceRole(bytes32 role, address account)","function reviewPeriodSeconds() view returns (uint256)","function revokeRole(bytes32 role, address account)","function setEarlyLeaverPenaltyWei(uint256 newEarlyLeaverPenaltyWei)","function setFishermanRewardFraction(uint256 newFishermanRewardFraction)","function setFlagProtectionSeconds(uint256 newFlagProtectionSeconds)","function setFlagReviewerCount(uint256 newFlagReviewerCount)","function setFlagReviewerRewardWei(uint256 newFlagReviewerRewardWei)","function setFlagReviewerSelectionIterations(uint256 newFlagReviewerSelectionIterations)","function setFlagStakeWei(uint256 newFlagStakeWei)","function setFlaggerRewardWei(uint256 newFlaggerRewardWei)","function setMaxAllowedEarningsFraction(uint256 newMaxAllowedEarningsFraction)","function setMaxPenaltyPeriodSeconds(uint256 newMaxPenaltyPeriodSeconds)","function setMaxQueueSeconds(uint256 newMaxQueueSeconds)","function setMinEligibleVoterAge(uint256 ageLimitSeconds)","function setMinEligibleVoterFractionOfAllStake(uint256 newMinEligibleVoterFractionOfAllStake)","function setMinimumDelegationSeconds(uint256 newMinimumDelegationSeconds)","function setMinimumDelegationWei(uint256 newMinimumDelegationWei)","function setMinimumSelfDelegationFraction(uint256 newMinimumSelfDelegationFraction)","function setOperatorContractOnlyJoinPolicy(address operatorContractOnlyJoinPolicyAddress)","function setOperatorFactory(address operatorFactoryAddress)","function setProtocolFeeBeneficiary(address newProtocolFeeBeneficiary)","function setProtocolFeeFraction(uint256 newProtocolFeeFraction)","function setRandomOracle(address newRandomOracle)","function setReviewPeriodSeconds(uint256 newReviewPeriodSeconds)","function setSlashingFraction(uint256 newSlashingFraction)","function setSponsorshipFactory(address sponsorshipFactoryAddress)","function setStreamRegistryAddress(address streamRegistryAddress_)","function setTrustedForwarder(address newTrustedForwarder)","function setVotingPeriodSeconds(uint256 newVotingPeriodSeconds)","function slashingFraction() view returns (uint256)","function sponsorshipFactory() view returns (address)","function streamRegistryAddress() view returns (address)","function supportsInterface(bytes4 interfaceId) view returns (bool)","function trustedForwarder() view returns (address)","function upgradeTo(address newImplementation)","function upgradeToAndCall(address newImplementation, bytes data) payable","function voterRegistry() view returns (address)","function votingPeriodSeconds() view returns (uint256)"]')},8851(e){"use strict";e.exports=JSON.parse('["event AdminChanged(address previousAdmin, address newAdmin)","event BeaconUpgraded(address indexed beacon)","event PermissionUpdated(string streamId, address user, bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)","event PermissionUpdatedForUserId(string streamId, bytes user, bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)","event RoleAdminChanged(bytes32 indexed role, bytes32 indexed previousAdminRole, bytes32 indexed newAdminRole)","event RoleGranted(bytes32 indexed role, address indexed account, address indexed sender)","event RoleRevoked(bytes32 indexed role, address indexed account, address indexed sender)","event StreamCreated(string id, string metadata)","event StreamDeleted(string id)","event StreamUpdated(string id, string metadata)","event Upgraded(address indexed implementation)","function DEFAULT_ADMIN_ROLE() view returns (bytes32)","function ENScreateStreamCallback(address ownerAddress, string ensName, string streamIdPath, string metadataJsonString)","function MAX_INT() view returns (uint256)","function PUBLIC_PERMISSION_USER_ID() view returns (address)","function TRUSTED_ROLE() view returns (bytes32)","function addressToString(address _address) pure returns (string)","function createMultipleStreamsWithPermissions(string[] streamIdPaths, string[] metadataJsonStrings, address[][] users, (bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)[][] permissions)","function createStream(string streamIdPath, string metadataJsonString)","function createStreamWithENS(string ensName, string streamIdPath, string metadataJsonString)","function createStreamWithPermissions(string streamIdPath, string metadataJsonString, address[] users, (bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)[] permissions)","function deleteStream(string streamId)","function ensCache() view returns (address)","function exists(string streamId) view returns (bool)","function getAddressKey(string streamId, address user) view returns (bytes32)","function getDirectPermissionsForUser(string streamId, address user) view returns ((bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant) permission)","function getDirectPermissionsForUserId(string streamId, bytes user) view returns ((bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant) permission)","function getPermissionsForUser(string streamId, address user) view returns ((bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant) permission)","function getPermissionsForUserId(string streamId, bytes user) view returns ((bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant) permission)","function getRoleAdmin(bytes32 role) view returns (bytes32)","function getStreamMetadata(string streamId) view returns (string des)","function getTrustedRole() pure returns (bytes32)","function getUserKeyForUserId(string streamId, bytes user) view returns (bytes32)","function grantPermission(string streamId, address user, uint8 permissionType)","function grantPermissionForUserId(string streamId, bytes user, uint8 permissionType)","function grantPublicPermission(string streamId, uint8 permissionType)","function grantRole(bytes32 role, address account)","function hasDirectPermission(string streamId, address user, uint8 permissionType) view returns (bool userHasPermission)","function hasPermission(string streamId, address user, uint8 permissionType) view returns (bool userHasPermission)","function hasPublicPermission(string streamId, uint8 permissionType) view returns (bool userHasPermission)","function hasRole(bytes32 role, address account) view returns (bool)","function initialize(address ensCacheAddr, address trustedForwarderAddress)","function isTrustedForwarder(address forwarder) view returns (bool)","function renounceRole(bytes32 role, address account)","function revokeAllPermissionsForUser(string streamId, address user)","function revokeAllPermissionsForUserId(string streamId, bytes user)","function revokePermission(string streamId, address user, uint8 permissionType)","function revokePermissionForUserId(string streamId, bytes user, uint8 permissionType)","function revokePublicPermission(string streamId, uint8 permissionType)","function revokeRole(bytes32 role, address account)","function setEnsCache(address ensCacheAddr)","function setExpirationTime(string streamId, address user, uint8 permissionType, uint256 expirationTime)","function setExpirationTimeForUserId(string streamId, bytes user, uint8 permissionType, uint256 expirationTime)","function setMultipleStreamPermissionsForUserIds(string[] streamIds, bytes[][] users, (bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)[][] permissions)","function setPermissions(string streamId, address[] users, (bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)[] permissions)","function setPermissionsForUser(string streamId, address user, bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)","function setPermissionsForUserIds(string streamId, bytes[] users, (bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)[] permissions)","function setPermissionsMultipleStreams(string[] streamIds, address[][] users, (bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)[][] permissions)","function setPublicPermission(string streamId, uint256 publishExpiration, uint256 subscribeExpiration)","function setTrustedForwarder(address forwarder)","function streamIdToMetadata(string) view returns (string)","function streamIdToPermissions(string, bytes32) view returns (bool canEdit, bool canDelete, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)","function streamIdToVersion(string) view returns (uint32)","function supportsInterface(bytes4 interfaceId) view returns (bool)","function trustedSetPermissionsForUser(string streamId, address user, bool canEdit, bool deletePerm, uint256 publishExpiration, uint256 subscribeExpiration, bool canGrant)","function updateStreamMetadata(string streamId, string metadata)","function upgradeTo(address newImplementation)","function upgradeToAndCall(address newImplementation, bytes data) payable"]')},1247(e){"use strict";e.exports=JSON.parse('["event Added(string streamId, address indexed nodeAddress)","event AdminChanged(address previousAdmin, address newAdmin)","event BeaconUpgraded(address indexed beacon)","event Removed(string streamId, address indexed nodeAddress)","event Upgraded(address indexed implementation)","function addAndRemoveStorageNodes(string streamId, address[] addNodes, address[] removeNodes)","function addStorageNode(string streamId, address nodeAddress)","function initialize(address streamRegistryAddress, address nodeRegistryAddress, address trustedForwarderAddress)","function isStorageNodeOf(string streamId, address nodeAddress) view returns (bool)","function isTrustedForwarder(address forwarder) view returns (bool)","function nodeRegistry() view returns (address)","function pairs(string, address) view returns (uint256 dateCreated)","function removeStorageNode(string streamId, address nodeAddress)","function setTrustedForwarder(address forwarder)","function streamRegistry() view returns (address)","function upgradeTo(address newImplementation)","function upgradeToAndCall(address newImplementation, bytes data) payable"]')},1636(e){"use strict";e.exports={rE:"6.6.1"}},9003(e){"use strict";e.exports={version:"1.0.35"}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}r.m=e,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.b="undefined"!=typeof document&&document.baseURI||self.location.href;var n={};return(()=>{"use strict";r.r(n),r.d(n,{QRCode:()=>bW,STREAMR_STORAGE_NODE_GERMANY:()=>Jz,StreamPermission:()=>mK,StreamrClient:()=>kH,ethers:()=>u});var e={};r.r(e),r.d(e,{OG:()=>xh,My:()=>Sh,Ph:()=>Ph,lX:()=>Ih,Id:()=>Nh,fg:()=>Mh,qj:()=>Th,aT:()=>Rh,lq:()=>Ch,z:()=>_h,Q5:()=>Lh});var t={};r.r(t),r.d(t,{base64:()=>ED,base64url:()=>AD,bigint:()=>xD,boolean:()=>MD,browserEmail:()=>fD,cidrv4:()=>wD,cidrv6:()=>vD,cuid:()=>JO,cuid2:()=>ZO,date:()=>ID,datetime:()=>TD,domain:()=>kD,duration:()=>tD,e164:()=>RD,email:()=>cD,emoji:()=>gD,extendedDuration:()=>rD,guid:()=>nD,hex:()=>jD,hostname:()=>SD,html5Email:()=>uD,idnEmail:()=>hD,integer:()=>OD,ipv4:()=>mD,ipv6:()=>yD,ksuid:()=>XO,lowercase:()=>FD,mac:()=>bD,md5_base64:()=>GD,md5_base64url:()=>$D,md5_hex:()=>KD,nanoid:()=>eD,null:()=>BD,number:()=>DD,rfc5322Email:()=>lD,sha1_base64:()=>HD,sha1_base64url:()=>WD,sha1_hex:()=>VD,sha256_base64:()=>ZD,sha256_base64url:()=>QD,sha256_hex:()=>JD,sha384_base64:()=>XD,sha384_base64url:()=>eM,sha384_hex:()=>YD,sha512_base64:()=>rM,sha512_base64url:()=>nM,sha512_hex:()=>tM,string:()=>ND,time:()=>_D,ulid:()=>QO,undefined:()=>LD,unicodeEmail:()=>dD,uppercase:()=>UD,uuid:()=>iD,uuid4:()=>sD,uuid6:()=>oD,uuid7:()=>aD,xid:()=>YO});var i={};r.r(i),r.d(i,{endsWith:()=>sF,gt:()=>zL,gte:()=>qL,includes:()=>nF,length:()=>XL,lowercase:()=>tF,lt:()=>UL,lte:()=>jL,maxLength:()=>QL,maxSize:()=>WL,mime:()=>aF,minLength:()=>YL,minSize:()=>JL,multipleOf:()=>HL,negative:()=>GL,nonnegative:()=>VL,nonpositive:()=>$L,normalize:()=>uF,overwrite:()=>cF,positive:()=>KL,property:()=>oF,regex:()=>eF,size:()=>ZL,slugify:()=>fF,startsWith:()=>iF,toLowerCase:()=>dF,toUpperCase:()=>hF,trim:()=>lF,uppercase:()=>rF});var s={};r.r(s),r.d(s,{ZodISODate:()=>PF,ZodISODateTime:()=>kF,ZodISODuration:()=>TF,ZodISOTime:()=>CF,date:()=>IF,datetime:()=>RF,duration:()=>NF,time:()=>_F});var o={};r.r(o),r.d(o,{ZodAny:()=>fj,ZodArray:()=>Sj,ZodBase64:()=>OU,ZodBase64URL:()=>MU,ZodBigInt:()=>rj,ZodBigIntFormat:()=>ij,ZodBoolean:()=>ej,ZodCIDRv4:()=>_U,ZodCIDRv6:()=>NU,ZodCUID:()=>fU,ZodCUID2:()=>gU,ZodCatch:()=>bz,ZodCodec:()=>kz,ZodCustom:()=>Bz,ZodCustomStringFormat:()=>zU,ZodDate:()=>Ej,ZodDefault:()=>lz,ZodDiscriminatedUnion:()=>Dj,ZodE164:()=>LU,ZodEmail:()=>QF,ZodEmoji:()=>uU,ZodEnum:()=>Wj,ZodExactOptional:()=>sz,ZodFile:()=>Xj,ZodFunction:()=>Dz,ZodGUID:()=>XF,ZodIPv4:()=>SU,ZodIPv6:()=>IU,ZodIntersection:()=>Bj,ZodJWT:()=>UU,ZodKSUID:()=>EU,ZodLazy:()=>Tz,ZodLiteral:()=>Qj,ZodMAC:()=>RU,ZodMap:()=>Gj,ZodNaN:()=>vz,ZodNanoID:()=>dU,ZodNever:()=>yj,ZodNonOptional:()=>pz,ZodNull:()=>dj,ZodNullable:()=>az,ZodNumber:()=>VU,ZodNumberFormat:()=>WU,ZodObject:()=>Pj,ZodOptional:()=>nz,ZodPipe:()=>Az,ZodPrefault:()=>hz,ZodPromise:()=>xz,ZodReadonly:()=>Pz,ZodRecord:()=>jj,ZodSet:()=>Vj,ZodString:()=>WF,ZodStringFormat:()=>ZF,ZodSuccess:()=>mz,ZodSymbol:()=>aj,ZodTemplateLiteral:()=>Cz,ZodTransform:()=>tz,ZodTuple:()=>Fj,ZodType:()=>VF,ZodULID:()=>yU,ZodURL:()=>oU,ZodUUID:()=>tU,ZodUndefined:()=>uj,ZodUnion:()=>Tj,ZodUnknown:()=>gj,ZodVoid:()=>wj,ZodXID:()=>wU,ZodXor:()=>xj,_ZodString:()=>HF,_default:()=>dz,_function:()=>Mz,any:()=>pj,array:()=>kj,base64:()=>DU,base64url:()=>BU,bigint:()=>nj,boolean:()=>tj,catch:()=>wz,check:()=>Lz,cidrv4:()=>TU,cidrv6:()=>xU,codec:()=>Rz,cuid:()=>pU,cuid2:()=>mU,custom:()=>Fz,date:()=>Aj,describe:()=>zz,discriminatedUnion:()=>Mj,e164:()=>FU,email:()=>YF,emoji:()=>lU,enum:()=>Jj,exactOptional:()=>oz,file:()=>ez,float32:()=>ZU,float64:()=>QU,function:()=>Mz,guid:()=>eU,hash:()=>$U,hex:()=>GU,hostname:()=>KU,httpUrl:()=>cU,instanceof:()=>Kz,int:()=>JU,int32:()=>YU,int64:()=>sj,intersection:()=>Lj,ipv4:()=>kU,ipv6:()=>CU,json:()=>$z,jwt:()=>jU,keyof:()=>Rj,ksuid:()=>AU,lazy:()=>Nz,literal:()=>Yj,looseObject:()=>_j,looseRecord:()=>Kj,mac:()=>PU,map:()=>$j,meta:()=>qz,nan:()=>Ez,nanoid:()=>hU,nativeEnum:()=>Zj,never:()=>bj,nonoptional:()=>gz,null:()=>hj,nullable:()=>cz,nullish:()=>uz,number:()=>HU,object:()=>Ij,optional:()=>iz,partialRecord:()=>qj,pipe:()=>Sz,prefault:()=>fz,preprocess:()=>Vz,promise:()=>Oz,readonly:()=>Iz,record:()=>zj,refine:()=>Uz,set:()=>Hj,strictObject:()=>Cj,string:()=>JF,stringFormat:()=>qU,stringbool:()=>Gz,success:()=>yz,superRefine:()=>jz,symbol:()=>cj,templateLiteral:()=>_z,transform:()=>rz,tuple:()=>Uj,uint32:()=>XU,uint64:()=>oj,ulid:()=>bU,undefined:()=>lj,union:()=>Nj,unknown:()=>mj,url:()=>aU,uuid:()=>rU,uuidv4:()=>nU,uuidv6:()=>iU,uuidv7:()=>sU,void:()=>vj,xid:()=>vU,xor:()=>Oj});var a={};r.r(a),r.d(a,{AbiCoder:()=>oh,AbstractProvider:()=>Ab,AbstractSigner:()=>xb,AlchemyProvider:()=>zH,AnkrProvider:()=>UH,BaseContract:()=>lg,BaseWallet:()=>bw,Block:()=>Tp,BlockscoutProvider:()=>hW,BrowserProvider:()=>ME,ChainstackProvider:()=>KH,CloudflareProvider:()=>GH,ConstructorFragment:()=>Qd,Contract:()=>dg,ContractEventPayload:()=>qp,ContractFactory:()=>IH,ContractTransactionReceipt:()=>Up,ContractTransactionResponse:()=>jp,ContractUnknownEventPayload:()=>zp,EnsPlugin:()=>Xy,EnsResolver:()=>Ly,ErrorDescription:()=>vp,ErrorFragment:()=>Jd,EtherSymbol:()=>hw,EtherscanPlugin:()=>HH,EtherscanProvider:()=>ZH,EventFragment:()=>Zd,EventLog:()=>Lp,EventPayload:()=>Bp,FallbackFragment:()=>Yd,FallbackProvider:()=>ow,FeeData:()=>Cp,FeeDataNetworkPlugin:()=>eb,FetchCancelSignal:()=>hp,FetchRequest:()=>pp,FetchResponse:()=>gp,FetchUrlFeeDataNetworkPlugin:()=>tb,FixedNumber:()=>$E,Fragment:()=>Vd,FunctionFragment:()=>Xd,GasCostPlugin:()=>Yy,HDNodeVoidWallet:()=>CE,HDNodeWallet:()=>IE,Indexed:()=>Ep,InfuraProvider:()=>oW,InfuraWebSocketProvider:()=>sW,Interface:()=>kp,IpcSocketProvider:()=>gW,JsonRpcApiProvider:()=>Gb,JsonRpcProvider:()=>Vb,JsonRpcSigner:()=>Kb,LangEn:()=>Qw,Log:()=>Np,LogDescription:()=>bp,MaxInt256:()=>dw,MaxUint256:()=>uw,MessagePrefix:()=>fw,MinInt256:()=>lw,Mnemonic:()=>av,MulticoinProviderPlugin:()=>Dy,N:()=>aw,NamedFragment:()=>Hd,Network:()=>nb,NetworkPlugin:()=>Qy,NonceManager:()=>dW,ParamType:()=>$d,PocketProvider:()=>pW,QuickNodeProvider:()=>cW,Result:()=>Cu,Signature:()=>xf,SigningKey:()=>Of,SocketBlockSubscriber:()=>XH,SocketEventSubscriber:()=>tW,SocketPendingSubscriber:()=>eW,SocketProvider:()=>rW,SocketSubscriber:()=>YH,StructFragment:()=>eh,Transaction:()=>Ry,TransactionDescription:()=>wp,TransactionReceipt:()=>xp,TransactionResponse:()=>Op,Typed:()=>Ul,TypedDataEncoder:()=>Zf,UndecodedEventLog:()=>Fp,UnmanagedSubscriber:()=>yb,Utf8ErrorFuncs:()=>rd,VoidSigner:()=>Ob,Wallet:()=>DE,WebSocketProvider:()=>nW,WeiPerEther:()=>cw,Wordlist:()=>Ww,WordlistOwl:()=>Jw,WordlistOwlA:()=>mW,ZeroAddress:()=>yp,ZeroHash:()=>vf,accessListify:()=>Xf,assert:()=>Fc,assertArgument:()=>Uc,assertArgumentCount:()=>jc,assertNormalize:()=>qc,assertPrivate:()=>Kc,authorizationify:()=>ep,checkResultErrors:()=>_u,computeAddress:()=>Df,computeHmac:()=>Aw,concat:()=>Qc,copyRequest:()=>_p,dataLength:()=>Yc,dataSlice:()=>Xc,decodeBase58:()=>xy,decodeBase64:()=>tp,decodeBytes32String:()=>PH,decodeRlp:()=>ty,decryptCrowdsaleJson:()=>xE,decryptKeystoreJson:()=>fE,decryptKeystoreJsonSync:()=>dE,defaultPath:()=>bE,defineProperties:()=>Oc,dnsEncode:()=>xm,encodeBase58:()=>Ny,encodeBase64:()=>rp,encodeBytes32String:()=>RH,encodeRlp:()=>sy,encryptKeystoreJson:()=>yE,encryptKeystoreJsonSync:()=>mE,ensNormalize:()=>_m,formatEther:()=>JE,formatUnits:()=>HE,fromTwos:()=>au,getAccountPath:()=>_E,getAddress:()=>Ol,getBigInt:()=>lu,getBytes:()=>$c,getBytesCopy:()=>Vc,getCreate2Address:()=>Uy,getCreateAddress:()=>Fy,getDefaultProvider:()=>lW,getIcapAddress:()=>Dl,getIndexedAccountPath:()=>TE,getNumber:()=>pu,getUint:()=>du,hashAuthorization:()=>mw,hashMessage:()=>pw,hexlify:()=>Zc,id:()=>ud,isAddress:()=>ch,isAddressable:()=>ah,isBytesLike:()=>Wc,isCallException:()=>Bc,isCrowdsaleJson:()=>NE,isError:()=>Mc,isHexString:()=>Hc,isKeystoreJson:()=>cE,isValidName:()=>Tm,keccak256:()=>Rl,lock:()=>CH,makeError:()=>Lc,mask:()=>uu,namehash:()=>Nm,parseEther:()=>ZE,parseUnits:()=>WE,pbkdf2:()=>tv,randomBytes:()=>Gw,recoverAddress:()=>Mf,resolveAddress:()=>lh,resolveProperties:()=>xc,ripemd160:()=>jw,scrypt:()=>eE,scryptSync:()=>tE,sha256:()=>Jm,sha512:()=>Zm,showThrottleMessage:()=>LH,solidityPacked:()=>OH,solidityPackedKeccak256:()=>DH,solidityPackedSha256:()=>MH,stripZerosLeft:()=>eu,toBeArray:()=>yu,toBeHex:()=>mu,toBigInt:()=>fu,toNumber:()=>gu,toQuantity:()=>bu,toTwos:()=>cu,toUtf8Bytes:()=>id,toUtf8CodePoints:()=>od,toUtf8String:()=>sd,uuidV4:()=>rE,verifyAuthorization:()=>yw,verifyMessage:()=>gw,verifyTypedData:()=>Qf,version:()=>Tc,wordlists:()=>yW,zeroPadBytes:()=>nu,zeroPadValue:()=>ru});var c,u={};r.r(u),r.d(u,{AbiCoder:()=>oh,AbstractProvider:()=>Ab,AbstractSigner:()=>xb,AlchemyProvider:()=>zH,AnkrProvider:()=>UH,BaseContract:()=>lg,BaseWallet:()=>bw,Block:()=>Tp,BlockscoutProvider:()=>hW,BrowserProvider:()=>ME,ChainstackProvider:()=>KH,CloudflareProvider:()=>GH,ConstructorFragment:()=>Qd,Contract:()=>dg,ContractEventPayload:()=>qp,ContractFactory:()=>IH,ContractTransactionReceipt:()=>Up,ContractTransactionResponse:()=>jp,ContractUnknownEventPayload:()=>zp,EnsPlugin:()=>Xy,EnsResolver:()=>Ly,ErrorDescription:()=>vp,ErrorFragment:()=>Jd,EtherSymbol:()=>hw,EtherscanPlugin:()=>HH,EtherscanProvider:()=>ZH,EventFragment:()=>Zd,EventLog:()=>Lp,EventPayload:()=>Bp,FallbackFragment:()=>Yd,FallbackProvider:()=>ow,FeeData:()=>Cp,FeeDataNetworkPlugin:()=>eb,FetchCancelSignal:()=>hp,FetchRequest:()=>pp,FetchResponse:()=>gp,FetchUrlFeeDataNetworkPlugin:()=>tb,FixedNumber:()=>$E,Fragment:()=>Vd,FunctionFragment:()=>Xd,GasCostPlugin:()=>Yy,HDNodeVoidWallet:()=>CE,HDNodeWallet:()=>IE,Indexed:()=>Ep,InfuraProvider:()=>oW,InfuraWebSocketProvider:()=>sW,Interface:()=>kp,IpcSocketProvider:()=>gW,JsonRpcApiProvider:()=>Gb,JsonRpcProvider:()=>Vb,JsonRpcSigner:()=>Kb,LangEn:()=>Qw,Log:()=>Np,LogDescription:()=>bp,MaxInt256:()=>dw,MaxUint256:()=>uw,MessagePrefix:()=>fw,MinInt256:()=>lw,Mnemonic:()=>av,MulticoinProviderPlugin:()=>Dy,N:()=>aw,NamedFragment:()=>Hd,Network:()=>nb,NetworkPlugin:()=>Qy,NonceManager:()=>dW,ParamType:()=>$d,PocketProvider:()=>pW,QuickNodeProvider:()=>cW,Result:()=>Cu,Signature:()=>xf,SigningKey:()=>Of,SocketBlockSubscriber:()=>XH,SocketEventSubscriber:()=>tW,SocketPendingSubscriber:()=>eW,SocketProvider:()=>rW,SocketSubscriber:()=>YH,StructFragment:()=>eh,Transaction:()=>Ry,TransactionDescription:()=>wp,TransactionReceipt:()=>xp,TransactionResponse:()=>Op,Typed:()=>Ul,TypedDataEncoder:()=>Zf,UndecodedEventLog:()=>Fp,UnmanagedSubscriber:()=>yb,Utf8ErrorFuncs:()=>rd,VoidSigner:()=>Ob,Wallet:()=>DE,WebSocketProvider:()=>nW,WeiPerEther:()=>cw,Wordlist:()=>Ww,WordlistOwl:()=>Jw,WordlistOwlA:()=>mW,ZeroAddress:()=>yp,ZeroHash:()=>vf,accessListify:()=>Xf,assert:()=>Fc,assertArgument:()=>Uc,assertArgumentCount:()=>jc,assertNormalize:()=>qc,assertPrivate:()=>Kc,authorizationify:()=>ep,checkResultErrors:()=>_u,computeAddress:()=>Df,computeHmac:()=>Aw,concat:()=>Qc,copyRequest:()=>_p,dataLength:()=>Yc,dataSlice:()=>Xc,decodeBase58:()=>xy,decodeBase64:()=>tp,decodeBytes32String:()=>PH,decodeRlp:()=>ty,decryptCrowdsaleJson:()=>xE,decryptKeystoreJson:()=>fE,decryptKeystoreJsonSync:()=>dE,defaultPath:()=>bE,defineProperties:()=>Oc,dnsEncode:()=>xm,encodeBase58:()=>Ny,encodeBase64:()=>rp,encodeBytes32String:()=>RH,encodeRlp:()=>sy,encryptKeystoreJson:()=>yE,encryptKeystoreJsonSync:()=>mE,ensNormalize:()=>_m,ethers:()=>a,formatEther:()=>JE,formatUnits:()=>HE,fromTwos:()=>au,getAccountPath:()=>_E,getAddress:()=>Ol,getBigInt:()=>lu,getBytes:()=>$c,getBytesCopy:()=>Vc,getCreate2Address:()=>Uy,getCreateAddress:()=>Fy,getDefaultProvider:()=>lW,getIcapAddress:()=>Dl,getIndexedAccountPath:()=>TE,getNumber:()=>pu,getUint:()=>du,hashAuthorization:()=>mw,hashMessage:()=>pw,hexlify:()=>Zc,id:()=>ud,isAddress:()=>ch,isAddressable:()=>ah,isBytesLike:()=>Wc,isCallException:()=>Bc,isCrowdsaleJson:()=>NE,isError:()=>Mc,isHexString:()=>Hc,isKeystoreJson:()=>cE,isValidName:()=>Tm,keccak256:()=>Rl,lock:()=>CH,makeError:()=>Lc,mask:()=>uu,namehash:()=>Nm,parseEther:()=>ZE,parseUnits:()=>WE,pbkdf2:()=>tv,randomBytes:()=>Gw,recoverAddress:()=>Mf,resolveAddress:()=>lh,resolveProperties:()=>xc,ripemd160:()=>jw,scrypt:()=>eE,scryptSync:()=>tE,sha256:()=>Jm,sha512:()=>Zm,showThrottleMessage:()=>LH,solidityPacked:()=>OH,solidityPackedKeccak256:()=>DH,solidityPackedSha256:()=>MH,stripZerosLeft:()=>eu,toBeArray:()=>yu,toBeHex:()=>mu,toBigInt:()=>fu,toNumber:()=>gu,toQuantity:()=>bu,toTwos:()=>cu,toUtf8Bytes:()=>id,toUtf8CodePoints:()=>od,toUtf8String:()=>sd,uuidV4:()=>rE,verifyAuthorization:()=>yw,verifyMessage:()=>gw,verifyTypedData:()=>Qf,version:()=>Tc,wordlists:()=>yW,zeroPadBytes:()=>nu,zeroPadValue:()=>ru}),r(2032),r(8630),function(e){e[e.Transient=0]="Transient",e[e.Singleton=1]="Singleton",e[e.ResolutionScoped=2]="ResolutionScoped",e[e.ContainerScoped=3]="ContainerScoped"}(c||(c={}));const l=c;var d=r(8100);const{__extends:h,__assign:f,__rest:p,__decorate:g,__param:m,__metadata:y,__awaiter:b,__generator:w,__exportStar:v,__createBinding:E,__values:A,__read:S,__spread:k,__spreadArrays:R,__await:P,__asyncGenerator:I,__asyncDelegator:C,__asyncValues:_,__makeTemplateObject:T,__importStar:N,__importDefault:x,__classPrivateFieldGet:O,__classPrivateFieldSet:D}=d;function M(e){return!!e.useClass}function B(e){return!!e.useFactory}var L=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,r=this,n=!1;return new Proxy({},this.createHandler(function(){return n||(t=e(r.wrap()),n=!0),t}))},e.prototype.createHandler=function(e){var t={};return this.reflectMethods.forEach(function(r){t[r]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t[0]=e(),Reflect[r].apply(void 0,k(t))}}),t},e}();function F(e){if(void 0===e)throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new L(e)}function U(e){return"string"==typeof e||"symbol"==typeof e}function j(e){return"object"==typeof e&&"token"in e&&"transform"in e}function z(e){return!!e.useToken}function q(e){return null!=e.useValue}const K=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}(),G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return h(t,e),t}(K),$=function(){this.scopedResolutions=new Map};var V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return h(t,e),t}(K),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return h(t,e),t}(K);const W=function(){this.preResolution=new V,this.postResolution=new H};var J=new Map,Z=function(){function e(e){this.parent=e,this._registry=new G,this.interceptors=new W,this.disposed=!1,this.disposables=new Set}return e.prototype.register=function(e,t,r){var n;if(void 0===r&&(r={lifecycle:l.Transient}),this.ensureNotDisposed(),n=function(e){return M(e)||q(e)||z(e)||B(e)}(t)?t:{useClass:t},z(n))for(var i=[e],s=n;null!=s;){var o=s.useToken;if(i.includes(o))throw new Error("Token registration cycle detected! "+k(i,[o]).join(" -> "));i.push(o);var a=this._registry.get(o);s=a&&z(a.provider)?a.provider:null}if((r.lifecycle===l.Singleton||r.lifecycle==l.ContainerScoped||r.lifecycle==l.ResolutionScoped)&&(q(n)||B(n)))throw new Error('Cannot use lifecycle "'+l[r.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:n,options:r}),this},e.prototype.registerType=function(e,t){return this.ensureNotDisposed(),U(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),U(e)){if(U(t))return this.register(e,{useToken:t},{lifecycle:l.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:l.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var r=e;return t&&!U(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:l.Singleton})},e.prototype.resolve=function(e,t,r){void 0===t&&(t=new $),void 0===r&&(r=!1),this.ensureNotDisposed();var n=this.getRegistration(e);if(!n&&U(e)){if(r)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),n){var i=this.resolveRegistration(n,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(function(e){return"function"==typeof e||e instanceof L}(e))return i=this.construct(e,t),this.executePostResolutionInterceptor(e,i,"Single"),i;throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var r,n;if(this.interceptors.preResolution.has(e)){var i=[];try{for(var s=A(this.interceptors.preResolution.getAll(e)),o=s.next();!o.done;o=s.next()){var a=o.value;"Once"!=a.options.frequency&&i.push(a),a.callback(e,t)}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}this.interceptors.preResolution.setAll(e,i)}},e.prototype.executePostResolutionInterceptor=function(e,t,r){var n,i;if(this.interceptors.postResolution.has(e)){var s=[];try{for(var o=A(this.interceptors.postResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;"Once"!=c.options.frequency&&s.push(c),c.callback(e,t,r)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}this.interceptors.postResolution.setAll(e,s)}},e.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===l.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var r,n=e.options.lifecycle===l.Singleton,i=e.options.lifecycle===l.ContainerScoped,s=n||i;return r=q(e.provider)?e.provider.useValue:z(e.provider)?s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):M(e.provider)?s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):B(e.provider)?e.provider.useFactory(this):this.construct(e.provider,t),e.options.lifecycle===l.ResolutionScoped&&t.scopedResolutions.set(e,r),r},e.prototype.resolveAll=function(e,t,r){var n=this;void 0===t&&(t=new $),void 0===r&&(r=!1),this.ensureNotDisposed();var i=this.getAllRegistrations(e);if(!i&&U(e)){if(r)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),i){var s=i.map(function(e){return n.resolveRegistration(e,t)});return this.executePostResolutionInterceptor(e,s,"All"),s}var o=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,o,"All"),o},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var r=A(this._registry.entries()),n=r.next();!n.done;n=r.next()){var i=S(n.value,2),s=i[0],o=i[1];this._registry.setAll(s,o.filter(function(e){return!q(e.provider)}).map(function(e){return e.instance=void 0,e}))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){var t,r;this.ensureNotDisposed();var n=new e(this);try{for(var i=A(this._registry.entries()),s=i.next();!s.done;s=i.next()){var o=S(s.value,2),a=o[0],c=o[1];c.some(function(e){return e.options.lifecycle===l.ContainerScoped})&&n._registry.setAll(a,c.map(function(e){return e.options.lifecycle===l.ContainerScoped?{provider:e.provider,options:e.options}:e}))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},e.prototype.beforeResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:r})},e.prototype.afterResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:r})},e.prototype.dispose=function(){return b(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(t){var r=t.dispose();r&&e.push(r)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var r=this;if(e instanceof L)return e.createProxy(function(e){return r.resolve(e,t)});var n,i=function(){var n=J.get(e);if(!n||0===n.length){if(0===e.length)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var i=n.map(r.resolveParams(t,e));return new(e.bind.apply(e,k([void 0],i)))}();return"function"!=typeof(n=i).dispose||n.dispose.length>0||this.disposables.add(i),i},e.prototype.resolveParams=function(e,t){var r=this;return function(n,i){var s,o,a,c;try{return"object"==typeof(c=n)&&"token"in c&&"multiple"in c?j(n)?n.multiple?(s=r.resolve(n.transform)).transform.apply(s,k([r.resolveAll(n.token,new $,n.isOptional)],n.transformArgs)):(o=r.resolve(n.transform)).transform.apply(o,k([r.resolve(n.token,e,n.isOptional)],n.transformArgs)):n.multiple?r.resolveAll(n.token,new $,n.isOptional):r.resolve(n.token,e,n.isOptional):j(n)?(a=r.resolve(n.transform,e)).transform.apply(a,k([r.resolve(n.token,e)],n.transformArgs)):r.resolve(n,e)}catch(e){throw new Error(function(e,t,r){var n,i,s,o,a=S(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1];return n="Cannot inject the dependency "+(o=t,(null===(s=void 0===a?null:a)?"at position #"+o:'"'+s.split(",")[o].trim()+'" at position #'+o)+' of "')+e.name+'" constructor. Reason:',void 0===i&&(i="    "),k([n],r.message.split("\n").map(function(e){return i+e})).join("\n")}(t,i,e))}}},e.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},e}(),Q=new Z,Y="injectionTokens";const X=function(e,t){return r={token:e,multiple:!1,isOptional:t&&t.isOptional},function(e,t,n){var i=Reflect.getOwnMetadata(Y,e)||{};i[n]=r,Reflect.defineMetadata(Y,i,e)};var r},ee=function(e){return function(t){J.set(t,function(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],r=Reflect.getOwnMetadata(Y,e)||{};return Object.keys(r).forEach(function(e){t[+e]=r[e]}),t}(t)),e&&e.token&&(Array.isArray(e.token)?e.token.forEach(function(e){Q.register(e,t)}):Q.register(e.token,t))}};function te(e,t){return function(r){ee()(r),Q.register(t||r,r,{lifecycle:e})}}if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");var re=r(8287);"undefined"==typeof globalThis||globalThis.Buffer||(globalThis.Buffer=re.Buffer);var ne=r(8059),ie=r.n(ne),se=r(295),oe=r.n(se),ae=r(2861),ce=r.n(ae),ue=r(9198),le=r.n(ue),de=r(3141),he=r(6698),fe=r.n(he);function pe(e,t,r=""){const n=(i=e)instanceof Uint8Array||ArrayBuffer.isView(i)&&"Uint8Array"===i.constructor.name;var i;const s=e?.length,o=void 0!==t;if(!n||o&&s!==t)throw new Error((r&&`"${r}" `)+"expected Uint8Array"+(o?` of length ${t}`:"")+", got "+(n?`length=${s}`:"type="+typeof e));return e}function ge(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function me(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ye(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function be(e,t){return e<<t|e>>>32-t>>>0}function we(e,t={}){const r=(t,r)=>e(r).update(t).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=t=>e(t),Object.assign(r,t),Object.freeze(r)}function ve(e,t,r){return e&t^~e&r}function Ee(e,t,r){return e&t^e&r^t&r}class Ae{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,t,r,n){this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=ye(this.buffer)}update(e){ge(this),pe(e);const{view:t,buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){const t=ye(e);for(;n<=i-s;s+=n)this.process(t,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ge(this),function(e,t){pe(e,void 0,"digestInto() output");const r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:i}=this;let{pos:s}=this;t[s++]=128,me(this.buffer.subarray(s)),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;r.setBigUint64(n-8,BigInt(8*this.length),i),this.process(r,0);const o=ye(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||=new this.constructor,e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.destroyed=s,e.finished=i,e.length=n,e.pos=o,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const Se=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),ke=new Uint32Array(80);class Re extends Ae{A=0|Se[0];B=0|Se[1];C=0|Se[2];D=0|Se[3];E=0|Se[4];constructor(){super(64,20,8,!1)}get(){const{A:e,B:t,C:r,D:n,E:i}=this;return[e,t,r,n,i]}set(e,t,r,n,i){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i}process(e,t){for(let r=0;r<16;r++,t+=4)ke[r]=e.getUint32(t,!1);for(let e=16;e<80;e++)ke[e]=be(ke[e-3]^ke[e-8]^ke[e-14]^ke[e-16],1);let{A:r,B:n,C:i,D:s,E:o}=this;for(let e=0;e<80;e++){let t,a;e<20?(t=ve(n,i,s),a=1518500249):e<40?(t=n^i^s,a=1859775393):e<60?(t=Ee(n,i,s),a=2400959708):(t=n^i^s,a=3395469782);const c=be(r,5)+t+o+a+ke[e]|0;o=s,s=i,i=be(n,30),n=r,r=c}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,this.set(r,n,i,s,o)}roundClean(){me(ke)}destroy(){this.set(0,0,0,0,0),me(this.buffer)}}const Pe=we(()=>new Re),Ie=Math.pow(2,32),Ce=Array.from({length:64},(e,t)=>Math.floor(Ie*Math.abs(Math.sin(t+1)))),_e=Se.slice(0,4),Te=new Uint32Array(16);class Ne extends Ae{A=0|_e[0];B=0|_e[1];C=0|_e[2];D=0|_e[3];constructor(){super(64,16,8,!0)}get(){const{A:e,B:t,C:r,D:n}=this;return[e,t,r,n]}set(e,t,r,n){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n}process(e,t){for(let r=0;r<16;r++,t+=4)Te[r]=e.getUint32(t,!0);let{A:r,B:n,C:i,D:s}=this;for(let e=0;e<64;e++){let t,o,a;e<16?(t=ve(n,i,s),o=e,a=[7,12,17,22]):e<32?(t=ve(s,n,i),o=(5*e+1)%16,a=[5,9,14,20]):e<48?(t=n^i^s,o=(3*e+5)%16,a=[4,11,16,23]):(t=i^(n|~s),o=7*e%16,a=[6,10,15,21]),t=t+r+Ce[e]+Te[o],r=s,s=i,i=n,n+=be(t,a[e%4])}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,this.set(r,n,i,s)}roundClean(){me(Te)}destroy(){this.set(0,0,0,0),me(this.buffer)}}const xe=we(()=>new Ne);var Oe=r(7568),De=r.n(Oe),Me=r(2802),Be=r.n(Me);const Le="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function Fe(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function Ue(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function je(e,...t){if(!Fe(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ze(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");Ue(e.outputLen),Ue(e.blockLen)}function qe(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ke(e,t){je(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ge(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function $e(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Ve(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function He(e,t){return e<<32-t|e>>>t}function We(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const Je=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])()?e=>e:function(e){for(let t=0;t<e.length;t++)e[t]=We(e[t]);return e},Ze=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),Qe=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ye(e){if(je(e),Ze)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=Qe[e[r]];return t}function Xe(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function et(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(Ze)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){const r=Xe(e.charCodeAt(i)),s=Xe(e.charCodeAt(i+1));if(void 0===r||void 0===s){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}n[t]=16*r+s}return n}function tt(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e)),je(e),e}function rt(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];je(n),t+=n.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}class nt{}function it(e){const t=t=>e().update(tt(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function st(e=32){if(Le&&"function"==typeof Le.getRandomValues)return Le.getRandomValues(new Uint8Array(e));if(Le&&"function"==typeof Le.randomBytes)return Uint8Array.from(Le.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function ot(e,t,r){return e&t^~e&r}function at(e,t,r){return e&t^e&r^t&r}class ct extends nt{constructor(e,t,r,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=Ve(this.buffer)}update(e){qe(this),je(e=tt(e));const{view:t,buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){const t=Ve(e);for(;n<=i-s;s+=n)this.process(t,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){qe(this),Ke(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:i}=this;let{pos:s}=this;t[s++]=128,$e(this.buffer.subarray(s)),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+u,a,n)}(r,n-8,BigInt(8*this.length),i),this.process(r,0);const o=Ve(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.destroyed=s,e.finished=i,e.length=n,e.pos=o,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const ut=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),lt=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),dt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),ht=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),ft=BigInt(2**32-1),pt=BigInt(32);function gt(e,t=!1){return t?{h:Number(e&ft),l:Number(e>>pt&ft)}:{h:0|Number(e>>pt&ft),l:0|Number(e&ft)}}function mt(e,t=!1){const r=e.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:r,l:o}=gt(e[s],t);[n[s],i[s]]=[r,o]}return[n,i]}const yt=(e,t,r)=>e>>>r,bt=(e,t,r)=>e<<32-r|t>>>r,wt=(e,t,r)=>e>>>r|t<<32-r,vt=(e,t,r)=>e<<32-r|t>>>r,Et=(e,t,r)=>e<<64-r|t>>>r-32,At=(e,t,r)=>e>>>r-32|t<<64-r;function St(e,t,r,n){const i=(t>>>0)+(n>>>0);return{h:e+r+(i/2**32|0)|0,l:0|i}}const kt=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Rt=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,Pt=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),It=(e,t,r,n,i)=>t+r+n+i+(e/2**32|0)|0,Ct=(e,t,r,n,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(i>>>0),_t=(e,t,r,n,i,s)=>t+r+n+i+s+(e/2**32|0)|0,Tt=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Nt=new Uint32Array(64);class xt extends ct{constructor(e=32){super(64,e,8,!1),this.A=0|ut[0],this.B=0|ut[1],this.C=0|ut[2],this.D=0|ut[3],this.E=0|ut[4],this.F=0|ut[5],this.G=0|ut[6],this.H=0|ut[7]}get(){const{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)Nt[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Nt[e-15],r=Nt[e-2],n=He(t,7)^He(t,18)^t>>>3,i=He(r,17)^He(r,19)^r>>>10;Nt[e]=i+Nt[e-7]+n+Nt[e-16]|0}let{A:r,B:n,C:i,D:s,E:o,F:a,G:c,H:u}=this;for(let e=0;e<64;e++){const t=u+(He(o,6)^He(o,11)^He(o,25))+ot(o,a,c)+Tt[e]+Nt[e]|0,l=(He(r,2)^He(r,13)^He(r,22))+at(r,n,i)|0;u=c,c=a,a=o,o=s+t|0,s=i,i=n,n=r,r=t+l|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,n,i,s,o,a,c,u)}roundClean(){$e(Nt)}destroy(){this.set(0,0,0,0,0,0,0,0),$e(this.buffer)}}class Ot extends xt{constructor(){super(28),this.A=0|lt[0],this.B=0|lt[1],this.C=0|lt[2],this.D=0|lt[3],this.E=0|lt[4],this.F=0|lt[5],this.G=0|lt[6],this.H=0|lt[7]}}const Dt=(()=>mt(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))))(),Mt=(()=>Dt[0])(),Bt=(()=>Dt[1])(),Lt=new Uint32Array(80),Ft=new Uint32Array(80);class Ut extends ct{constructor(e=64){super(128,e,16,!1),this.Ah=0|ht[0],this.Al=0|ht[1],this.Bh=0|ht[2],this.Bl=0|ht[3],this.Ch=0|ht[4],this.Cl=0|ht[5],this.Dh=0|ht[6],this.Dl=0|ht[7],this.Eh=0|ht[8],this.El=0|ht[9],this.Fh=0|ht[10],this.Fl=0|ht[11],this.Gh=0|ht[12],this.Gl=0|ht[13],this.Hh=0|ht[14],this.Hl=0|ht[15]}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:i,Cl:s,Dh:o,Dl:a,Eh:c,El:u,Fh:l,Fl:d,Gh:h,Gl:f,Hh:p,Hl:g}=this;return[e,t,r,n,i,s,o,a,c,u,l,d,h,f,p,g]}set(e,t,r,n,i,s,o,a,c,u,l,d,h,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|c,this.El=0|u,this.Fh=0|l,this.Fl=0|d,this.Gh=0|h,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)Lt[r]=e.getUint32(t),Ft[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|Lt[e-15],r=0|Ft[e-15],n=wt(t,r,1)^wt(t,r,8)^yt(t,0,7),i=vt(t,r,1)^vt(t,r,8)^bt(t,r,7),s=0|Lt[e-2],o=0|Ft[e-2],a=wt(s,o,19)^Et(s,o,61)^yt(s,0,6),c=vt(s,o,19)^At(s,o,61)^bt(s,o,6),u=Pt(i,c,Ft[e-7],Ft[e-16]),l=It(u,n,a,Lt[e-7],Lt[e-16]);Lt[e]=0|l,Ft[e]=0|u}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:o,Cl:a,Dh:c,Dl:u,Eh:l,El:d,Fh:h,Fl:f,Gh:p,Gl:g,Hh:m,Hl:y}=this;for(let e=0;e<80;e++){const t=wt(l,d,14)^wt(l,d,18)^Et(l,d,41),b=vt(l,d,14)^vt(l,d,18)^At(l,d,41),w=l&h^~l&p,v=Ct(y,b,d&f^~d&g,Bt[e],Ft[e]),E=_t(v,m,t,w,Mt[e],Lt[e]),A=0|v,S=wt(r,n,28)^Et(r,n,34)^Et(r,n,39),k=vt(r,n,28)^At(r,n,34)^At(r,n,39),R=r&i^r&o^i&o,P=n&s^n&a^s&a;m=0|p,y=0|g,p=0|h,g=0|f,h=0|l,f=0|d,({h:l,l:d}=St(0|c,0|u,0|E,0|A)),c=0|o,u=0|a,o=0|i,a=0|s,i=0|r,s=0|n;const I=kt(A,k,P);r=Rt(I,E,S,R),n=0|I}({h:r,l:n}=St(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=St(0|this.Bh,0|this.Bl,0|i,0|s)),({h:o,l:a}=St(0|this.Ch,0|this.Cl,0|o,0|a)),({h:c,l:u}=St(0|this.Dh,0|this.Dl,0|c,0|u)),({h:l,l:d}=St(0|this.Eh,0|this.El,0|l,0|d)),({h,l:f}=St(0|this.Fh,0|this.Fl,0|h,0|f)),({h:p,l:g}=St(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:y}=St(0|this.Hh,0|this.Hl,0|m,0|y)),this.set(r,n,i,s,o,a,c,u,l,d,h,f,p,g,m,y)}roundClean(){$e(Lt,Ft)}destroy(){$e(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class jt extends Ut{constructor(){super(48),this.Ah=0|dt[0],this.Al=0|dt[1],this.Bh=0|dt[2],this.Bl=0|dt[3],this.Ch=0|dt[4],this.Cl=0|dt[5],this.Dh=0|dt[6],this.Dl=0|dt[7],this.Eh=0|dt[8],this.El=0|dt[9],this.Fh=0|dt[10],this.Fl=0|dt[11],this.Gh=0|dt[12],this.Gl=0|dt[13],this.Hh=0|dt[14],this.Hl=0|dt[15]}}const zt=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),qt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class Kt extends Ut{constructor(){super(28),this.Ah=0|zt[0],this.Al=0|zt[1],this.Bh=0|zt[2],this.Bl=0|zt[3],this.Ch=0|zt[4],this.Cl=0|zt[5],this.Dh=0|zt[6],this.Dl=0|zt[7],this.Eh=0|zt[8],this.El=0|zt[9],this.Fh=0|zt[10],this.Fl=0|zt[11],this.Gh=0|zt[12],this.Gl=0|zt[13],this.Hh=0|zt[14],this.Hl=0|zt[15]}}class Gt extends Ut{constructor(){super(32),this.Ah=0|qt[0],this.Al=0|qt[1],this.Bh=0|qt[2],this.Bl=0|qt[3],this.Ch=0|qt[4],this.Cl=0|qt[5],this.Dh=0|qt[6],this.Dl=0|qt[7],this.Eh=0|qt[8],this.El=0|qt[9],this.Fh=0|qt[10],this.Fl=0|qt[11],this.Gh=0|qt[12],this.Gl=0|qt[13],this.Hh=0|qt[14],this.Hl=0|qt[15]}}const $t=it(()=>new xt),Vt=it(()=>new Ot),Ht=it(()=>new Ut),Wt=it(()=>new jt),Jt=it(()=>new Gt),Zt=it(()=>new Kt),Qt=BigInt(0),Yt=BigInt(1),Xt=BigInt(2),er=BigInt(7),tr=BigInt(256),rr=BigInt(113),nr=[],ir=[],sr=[];for(let e=0,t=Yt,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],nr.push(2*(5*n+r)),ir.push((e+1)*(e+2)/2%64);let i=Qt;for(let e=0;e<7;e++)t=(t<<Yt^(t>>er)*rr)%tr,t&Xt&&(i^=Yt<<(Yt<<BigInt(e))-Yt);sr.push(i)}const or=mt(sr,!0),ar=or[0],cr=or[1],ur=(e,t,r)=>r>32?((e,t,r)=>t<<r-32|e>>>64-r)(e,t,r):((e,t,r)=>e<<r|t>>>32-r)(e,t,r),lr=(e,t,r)=>r>32?((e,t,r)=>e<<r-32|t>>>64-r)(e,t,r):((e,t,r)=>t<<r|e>>>32-r)(e,t,r);class dr extends nt{constructor(e,t,r,n=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=i,Ue(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ge(this.state)}clone(){return this._cloneInto()}keccak(){Je(this.state32),function(e,t=24){const r=new Uint32Array(10);for(let n=24-t;n<24;n++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){const n=(t+8)%10,i=(t+2)%10,s=r[i],o=r[i+1],a=ur(s,o,1)^r[n],c=lr(s,o,1)^r[n+1];for(let r=0;r<50;r+=10)e[t+r]^=a,e[t+r+1]^=c}let t=e[2],i=e[3];for(let r=0;r<24;r++){const n=ir[r],s=ur(t,i,n),o=lr(t,i,n),a=nr[r];t=e[a],i=e[a+1],e[a]=s,e[a+1]=o}for(let t=0;t<50;t+=10){for(let n=0;n<10;n++)r[n]=e[t+n];for(let n=0;n<10;n++)e[t+n]^=~r[(n+2)%10]&r[(n+4)%10]}e[0]^=ar[n],e[1]^=cr[n]}$e(r)}(this.state32,this.rounds),Je(this.state32),this.posOut=0,this.pos=0}update(e){qe(this),je(e=tt(e));const{blockLen:t,state:r}=this,n=e.length;for(let i=0;i<n;){const s=Math.min(t-this.pos,n-i);for(let t=0;t<s;t++)r[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:n}=this;e[r]^=t,128&t&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){qe(this,!1),je(e),this.finish();const t=this.state,{blockLen:r}=this;for(let n=0,i=e.length;n<i;){this.posOut>=r&&this.keccak();const s=Math.min(r-this.posOut,i-n);e.set(t.subarray(this.posOut,this.posOut+s),n),this.posOut+=s,n+=s}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ue(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ke(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,$e(this.state)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:n,rounds:i,enableXOF:s}=this;return e||(e=new dr(t,r,n,s,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=r,e.outputLen=n,e.enableXOF=s,e.destroyed=this.destroyed,e}}const hr=(e,t,r)=>it(()=>new dr(t,e,r)),fr=(()=>hr(6,144,28))(),pr=(()=>hr(6,136,32))(),gr=(()=>hr(6,104,48))(),mr=(()=>hr(6,72,64))(),yr=(e,t,r)=>function(e){const t=(t,r)=>e(r).update(tt(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}((n={})=>new dr(t,e,void 0===n.dkLen?r:n.dkLen,!0)),br=(()=>yr(31,168,16))(),wr=(()=>yr(31,136,32))(),vr=je,Er=st;function Ar(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}function Sr(...e){const t=e=>"number"==typeof e?e:e.bytesLen,r=e.reduce((e,r)=>e+t(r),0);return{bytesLen:r,encode:n=>{const i=new Uint8Array(r);for(let r=0,s=0;r<e.length;r++){const o=e[r],a=t(o),c="number"==typeof o?n[r]:o.encode(n[r]);vr(c,a),i.set(c,s),"number"!=typeof o&&c.fill(0),s+=a}return i},decode:n=>{vr(n,r);const i=[];for(const r of e){const e=t(r),s=n.subarray(0,e);i.push("number"==typeof r?s:r.decode(s)),n=n.subarray(e)}return i}}}function kr(e,t){const r=t*e.bytesLen;return{bytesLen:r,encode:n=>{if(n.length!==t)throw new Error(`vecCoder.encode: wrong length=${n.length}. Expected: ${t}`);const i=new Uint8Array(r);for(let t=0,r=0;t<n.length;t++){const s=e.encode(n[t]);i.set(s,r),s.fill(0),r+=s.length}return i},decode:t=>{vr(t,r);const n=[];for(let r=0;r<t.length;r+=e.bytesLen)n.push(e.decode(t.subarray(r,r+e.bytesLen)));return n}}}function Rr(...e){for(const t of e)if(Array.isArray(t))for(const e of t)e.fill(0);else t.fill(0)}function Pr(e){return(1<<e)-1}const Ir=new Uint8Array(0);function Cr(e,t=Ir){if(vr(e),vr(t),t.length>255)throw new Error("context should be less than 255 bytes");return rt(new Uint8Array([0,t.length]),t,e)}const _r={"SHA2-256":{oid:et("0609608648016503040201"),hash:$t},"SHA2-384":{oid:et("0609608648016503040202"),hash:Wt},"SHA2-512":{oid:et("0609608648016503040203"),hash:Ht},"SHA2-224":{oid:et("0609608648016503040204"),hash:Vt},"SHA2-512/224":{oid:et("0609608648016503040205"),hash:Zt},"SHA2-512/256":{oid:et("0609608648016503040206"),hash:Jt},"SHA3-224":{oid:et("0609608648016503040207"),hash:fr},"SHA3-256":{oid:et("0609608648016503040208"),hash:pr},"SHA3-384":{oid:et("0609608648016503040209"),hash:gr},"SHA3-512":{oid:et("060960864801650304020A"),hash:mr},"SHAKE-128":{oid:et("060960864801650304020B"),hash:e=>br(e,{dkLen:32})},"SHAKE-256":{oid:et("060960864801650304020C"),hash:e=>wr(e,{dkLen:64})}};function Tr(e,t,r=Ir){if(vr(t),vr(r),r.length>255)throw new Error("context should be less than 255 bytes");if(!_r[e])throw new Error("unknown hash: "+e);const{oid:n,hash:i}=_r[e],s=i(t);return rt(new Uint8Array([1,r.length]),r,n,s)}var Nr=r(9404),xr=r.n(Nr),Or=r(4874),Dr=r.n(Or),Mr=r(7975),Br=r.n(Mr),Lr=r(1648),Fr=r.n(Lr),Ur=r(7948),jr=r.n(Ur),zr=r(228),qr=r(3560),Kr=r.n(qr),Gr=r(6449),$r=r.n(Gr),Vr=r(6924),Hr=r.n(Vr),Wr=r(7141),Jr=r.n(Wr),Zr=r(8190);function Qr(e,t=8){const r=e.toString(2).padStart(8,"0").slice(-t).padStart(7,"0").split("").reverse().join("");return Number.parseInt(r,2)}const Yr=e=>{const{newPoly:t,N:r,Q:n,F:i,ROOT_OF_UNITY:s,brvBits:o,isKyber:a}=e,c=(e,t=n)=>{const r=e%t|0;return 0|(r>=0?r:t+r)},u=function(){const e=t(r);for(let t=0;t<r;t++){const r=Qr(t,o),i=BigInt(s)**BigInt(r)%BigInt(n);e[t]=0|Number(i)}return e}(),l=a?128:r,d=a?1:0,h={encode:e=>{for(let t=1,n=128;n>d;n>>=1)for(let i=0;i<r;i+=2*n){const r=u[t++];for(let t=i;t<i+n;t++){const i=c(r*e[t+n]);e[t+n]=0|c(e[t]-i),e[t]=0|c(e[t]+i)}}return e},decode:e=>{for(let t=l-1,n=1+d;n<l+d;n<<=1)for(let i=0;i<r;i+=2*n){const r=u[t--];for(let t=i;t<i+n;t++){const i=e[t];e[t]=c(i+e[t+n]),e[t+n]=c(r*(e[t+n]-i))}}for(let t=0;t<e.length;t++)e[t]=c(i*e[t]);return e}};return{mod:c,smod:(e,t=n)=>{const r=0|c(e,t);return 0|(r>t>>1?r-t:r)},nttZetas:u,NTT:h,bitsCoder:(e,n)=>{const i=Pr(e),s=e*(r/8);return{bytesLen:s,encode:t=>{const r=new Uint8Array(s);for(let s=0,o=0,a=0,c=0;s<t.length;s++)for(o|=(n.encode(t[s])&i)<<a,a+=e;a>=8;a-=8,o>>=8)r[c++]=o&Pr(a);return r},decode:s=>{const o=t(r);for(let t=0,r=0,a=0,c=0;t<s.length;t++)for(r|=s[t]<<a,a+=8;a>=e;a-=e,r>>=e)o[c++]=n.decode(r&i);return o}}}}},Xr=e=>(t,r)=>{r||(r=e.blockLen);const n=new Uint8Array(t.length+2);n.set(t);const i=t.length,s=new Uint8Array(r);let o=e.create({}),a=0,c=0;return{stats:()=>({calls:a,xofs:c}),get:(t,r)=>(n[i+0]=t,n[i+1]=r,o.destroy(),o=e.create({}).update(n),a++,()=>(c++,o.xofInto(s))),clean:()=>{o.destroy(),s.fill(0),n.fill(0)}}},en=Xr(br),tn=Xr(wr),rn=256,nn=8380417,sn=0|Math.floor(95232),on=0|Math.floor(261888),an={K:8,L:7,D:13,GAMMA1:2**19,GAMMA2:on,TAU:60,ETA:2,OMEGA:75},cn=e=>new Int32Array(e),{mod:un,smod:ln,NTT:dn,bitsCoder:hn}=Yr({N:rn,Q:nn,F:8347681,ROOT_OF_UNITY:1753,newPoly:cn,isKyber:!1,brvBits:8}),fn=e=>e,pn=(e,t=fn,r=fn)=>hn(e,{encode:e=>t(r(e)),decode:e=>r(t(e))}),gn=(e,t)=>{for(let r=0;r<e.length;r++)e[r]=un(e[r]+t[r]);return e},mn=(e,t)=>{for(let r=0;r<e.length;r++)e[r]=un(e[r]-t[r]);return e},yn=e=>{for(let t=0;t<rn;t++)e[t]<<=13;return e},bn=(e,t)=>{for(let r=0;r<rn;r++)if(Math.abs(ln(e[r]))>=t)return!0;return!1},wn=(e,t)=>{const r=cn(rn);for(let n=0;n<e.length;n++)r[n]=un(e[n]*t[n]);return r};function vn(e){const t=cn(rn);for(let r=0;r<rn;){const n=e();if(n.length%3)throw new Error("RejNTTPoly: unaligned block");for(let e=0;r<rn&&e<=n.length-3;e+=3){const i=8388607&(n[e+0]|n[e+1]<<8|n[e+2]<<16);i<nn&&(t[r++]=i)}}return t}function En(e){const{K:t,L:r,GAMMA1:n,GAMMA2:i,TAU:s,ETA:o,OMEGA:a}=e,{CRH_BYTES:c,TR_BYTES:u,C_TILDE_BYTES:l,XOF128:d,XOF256:h}=e;if(![2,4].includes(o))throw new Error("Wrong ETA");if(![1<<17,1<<19].includes(n))throw new Error("Wrong GAMMA1");if(![sn,on].includes(i))throw new Error("Wrong GAMMA2");const f=s*o,p=e=>{const t=un(e),r=0|ln(t,2*i);return t-r===nn-1?{r1:0,r0:r-1|0}:{r1:0|Math.floor((t-r)/(2*i)),r0:r}},g=e=>p(e).r1,m=e=>p(e).r0,y=(e,t)=>e<=i||e>nn-i||e===nn-i&&0===t?0:1,b=(e,t)=>{const r=Math.floor((nn-1)/(2*i)),{r1:n,r0:s}=p(t);return 1===e?s>0?0|un(n+1,r):0|un(n-1,r):0|n},w=e=>{const t=un(e),r=0|ln(t,8192);return{r1:0|Math.floor((t-r)/8192),r0:r}},v={bytesLen:a+t,encode:e=>{if(!1===e)throw new Error("hint.encode: hint is false");const r=new Uint8Array(a+t);for(let n=0,i=0;n<t;n++){for(let t=0;t<rn;t++)0!==e[n][t]&&(r[i++]=t);r[a+n]=i}return r},decode:e=>{const r=[];let n=0;for(let i=0;i<t;i++){const t=cn(rn);if(e[a+i]<n||e[a+i]>a)return!1;for(let r=n;r<e[a+i];r++){if(r>n&&e[r]<=e[r-1])return!1;t[e[r]]=1}n=e[a+i],r.push(t)}for(let t=n;t<a;t++)if(0!==e[t])return!1;return r}},E=pn(2===o?3:4,e=>o-e,e=>{if(!(-o<=e&&e<=o))throw new Error(`malformed key s1/s3 ${e} outside of ETA range [${-o}, ${o}]`);return e}),A=pn(13,e=>4096-e),S=pn(10),k=pn(n===1<<17?18:20,e=>ln(n-e)),R=kr(pn(i===sn?6:4),t),P=Sr(32,kr(S,t)),I=Sr(32,32,u,kr(E,r),kr(E,t),kr(A,t)),C=Sr(l,kr(k,r),v),_=2===o?e=>e<15&&2-e%5:e=>e<9&&4-e;function T(e){const t=cn(rn);for(let r=0;r<rn;){const n=e();for(let e=0;r<rn&&e<n.length;e+=1){const i=_(15&n[e]),s=_(n[e]>>4&15);!1!==i&&(t[r++]=i),r<rn&&!1!==s&&(t[r++]=s)}}return t}const N=e=>{const t=cn(rn),r=wr.create({}).update(e),n=new Uint8Array(wr.blockLen);r.xofInto(n);const i=n.slice(0,8);for(let e=rn-s,o=8,a=0,c=0;e<rn;e++){let s=e+1;for(;s>e;)s=n[o++],o<wr.blockLen||(r.xofInto(n),o=0);t[e]=t[s],t[s]=1-((i[a]>>c++&1)<<1),c>=8&&(a++,c=0)}return t},x=e=>{const t=cn(rn),r=cn(rn);for(let n=0;n<e.length;n++){const{r0:i,r1:s}=w(e[n]);t[n]=i,r[n]=s}return{r0:t,r1:r}},O=(e,t)=>{for(let r=0;r<rn;r++)e[r]=b(t[r],e[r]);return e},D=(e,t)=>{const r=cn(rn);let n=0;for(let i=0;i<rn;i++){const s=y(e[i],t[i]);r[i]=s,n+=s}return{v:r,cnt:n}},M=Sr(32,64,32),B={signRandBytes:32,keygen:e=>{const n=new Uint8Array(34),i=void 0===e;i&&(e=Er(32)),vr(e,32),n.set(e),i&&e.fill(0),n[32]=t,n[33]=r;const[s,o,a]=M.decode(wr(n,{dkLen:M.bytesLen})),c=h(o),l=[];for(let e=0;e<r;e++)l.push(T(c.get(255&e,e>>8&255)));const f=[];for(let e=r;e<r+t;e++)f.push(T(c.get(255&e,e>>8&255)));const p=l.map(e=>dn.encode(e.slice())),g=[],m=[],y=d(s),b=cn(rn);for(let e=0;e<t;e++){b.fill(0);for(let t=0;t<r;t++){const r=vn(y.get(t,e));gn(b,wn(r,p[t]))}dn.decode(b);const{r0:t,r1:n}=x(gn(b,f[e]));g.push(t),m.push(n)}const w=P.encode([s,m]),v=wr(w,{dkLen:u}),E=I.encode([s,a,v,l,f,g]);return y.clean(),c.clean(),Rr(s,o,a,l,f,p,b,g,m,v,n),{publicKey:w,secretKey:E}},sign:(e,s,o,u=!1)=>{const[p,y,b,w,v,E]=I.decode(e),A=[],S=d(p);for(let e=0;e<t;e++){const t=[];for(let n=0;n<r;n++)t.push(vn(S.get(n,e)));A.push(t)}S.clean();for(let e=0;e<r;e++)dn.encode(w[e]);for(let e=0;e<t;e++)dn.encode(v[e]),dn.encode(E[e]);const P=u?s:wr.create({dkLen:c}).update(b).update(s).digest(),_=o||new Uint8Array(32);vr(_);const T=wr.create({dkLen:c}).update(y).update(_).update(P).digest();vr(T,c);const x=h(T,k.bytesLen);e:for(let e=0;;){const s=[];for(let t=0;t<r;t++,e++)s.push(k.decode(x.get(255&e,e>>8)()));const o=s.map(e=>dn.encode(e.slice())),c=[];for(let e=0;e<t;e++){const t=cn(rn);for(let n=0;n<r;n++)gn(t,wn(A[e][n],o[n]));dn.decode(t),c.push(t)}const u=c.map(e=>e.map(g)),d=wr.create({dkLen:l}).update(P).update(R.encode(u)).digest(),h=dn.encode(N(d)),p=w.map(e=>wn(e,h));for(let e=0;e<r;e++)if(gn(dn.decode(p[e]),s[e]),bn(p[e],n-f))continue e;let y=0;const b=[];for(let e=0;e<t;e++){const t=dn.decode(wn(v[e],h)),r=mn(c[e],t).map(m);if(bn(r,i-f))continue e;const n=dn.decode(wn(E[e],h));if(bn(n,i))continue e;gn(r,n);const s=D(r,u[e]);b.push(s.v),y+=s.cnt}if(y>a)continue;x.clean();const S=C.encode([d,p,b]);return Rr(d,p,b,h,u,c,o,s,T,P,w,v,E,...A),S}throw new Error("Unreachable code path reached, report this error")},verify:(e,i,s,o=!1)=>{const[h,p]=P.decode(e),g=wr(e,{dkLen:u});if(s.length!==C.bytesLen)return!1;const[m,y,b]=C.decode(s);if(!1===b)return!1;for(let e=0;e<r;e++)if(bn(y[e],n-f))return!1;const w=o?i:wr.create({dkLen:c}).update(g).update(i).digest(),v=dn.encode(N(m)),E=y.map(e=>e.slice());for(let e=0;e<r;e++)dn.encode(E[e]);const A=[],S=d(h);for(let e=0;e<t;e++){const t=wn(dn.encode(yn(p[e])),v),n=cn(rn);for(let t=0;t<r;t++){const r=vn(S.get(t,e));gn(n,wn(r,E[t]))}const i=dn.decode(mn(n,t));A.push(O(i,b[e]))}S.clean();const k=wr.create({dkLen:l}).update(w).update(R.encode(A)).digest();for(const e of b)if(!(e.reduce((e,t)=>e+t,0)<=a))return!1;for(const e of y)if(bn(e,n-f))return!1;return Ar(m,k)}};return{internal:B,keygen:B.keygen,signRandBytes:B.signRandBytes,sign:(e,t,r=Ir,n)=>{const i=Cr(t,r),s=B.sign(e,i,n);return i.fill(0),s},verify:(e,t,r,n=Ir)=>B.verify(e,Cr(t,n),r),prehash:e=>({sign:(t,r,n=Ir,i)=>{const s=Tr(e,r,n),o=B.sign(t,s,i);return s.fill(0),o},verify:(t,r,n,i=Ir)=>B.verify(t,Tr(e,r,i),n)})}}const An=En({...an,CRH_BYTES:64,TR_BYTES:64,C_TILDE_BYTES:64,XOF128:en,XOF256:tn});class Sn extends nt{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ze(e);const r=tt(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),$e(i)}update(e){return qe(this),this.iHash.update(e),this}digestInto(e){qe(this),je(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const kn=(e,t,r)=>new Sn(e,t).update(r).digest();kn.create=(e,t)=>new Sn(e,t);const Rn=BigInt(0),Pn=BigInt(1);function In(e,t=""){if("boolean"!=typeof e)throw new Error((t&&`"${t}"`)+"expected boolean, got type="+typeof e);return e}function Cn(e,t,r=""){const n=Fe(e),i=e?.length,s=void 0!==t;if(!n||s&&i!==t)throw new Error((r&&`"${r}" `)+"expected Uint8Array"+(s?` of length ${t}`:"")+", got "+(n?`length=${i}`:"type="+typeof e));return e}function _n(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function Tn(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?Rn:BigInt("0x"+e)}function Nn(e){return Tn(Ye(e))}function xn(e){return je(e),Tn(Ye(Uint8Array.from(e).reverse()))}function On(e,t){return et(e.toString(16).padStart(2*t,"0"))}function Dn(e,t){return On(e,t).reverse()}function Mn(e,t,r){let n;if("string"==typeof t)try{n=et(t)}catch(t){throw new Error(e+" must be hex string or Uint8Array, cause: "+t)}else{if(!Fe(t))throw new Error(e+" must be hex string or Uint8Array");n=Uint8Array.from(t)}const i=n.length;if("number"==typeof r&&i!==r)throw new Error(e+" of length "+r+" expected, got "+i);return n}const Bn=e=>"bigint"==typeof e&&Rn<=e;function Ln(e){let t;for(t=0;e>Rn;e>>=Pn,t+=1);return t}const Fn=e=>(Pn<<BigInt(e))-Pn;function Un(e,t,r={}){if(!e||"object"!=typeof e)throw new Error("expected valid options object");function n(t,r,n){const i=e[t];if(n&&void 0===i)return;const s=typeof i;if(s!==r||null===i)throw new Error(`param "${t}" is invalid: expected ${r}, got ${s}`)}Object.entries(t).forEach(([e,t])=>n(e,t,!1)),Object.entries(r).forEach(([e,t])=>n(e,t,!0))}function jn(e){const t=new WeakMap;return(r,...n)=>{const i=t.get(r);if(void 0!==i)return i;const s=e(r,...n);return t.set(r,s),s}}const zn=BigInt(0),qn=BigInt(1),Kn=BigInt(2),Gn=BigInt(3),$n=BigInt(4),Vn=BigInt(5),Hn=BigInt(7),Wn=BigInt(8),Jn=BigInt(9),Zn=BigInt(16);function Qn(e,t){const r=e%t;return r>=zn?r:t+r}function Yn(e,t){if(e===zn)throw new Error("invert: expected non-zero number");if(t<=zn)throw new Error("invert: expected positive modulus, got "+t);let r=Qn(e,t),n=t,i=zn,s=qn,o=qn,a=zn;for(;r!==zn;){const e=n/r,t=n%r,c=i-o*e,u=s-a*e;n=r,r=t,i=o,s=a,o=c,a=u}if(n!==qn)throw new Error("invert: does not exist");return Qn(i,t)}function Xn(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function ei(e,t){const r=(e.ORDER+qn)/$n,n=e.pow(t,r);return Xn(e,n,t),n}function ti(e,t){const r=(e.ORDER-Vn)/Wn,n=e.mul(t,Kn),i=e.pow(n,r),s=e.mul(t,i),o=e.mul(e.mul(s,Kn),i),a=e.mul(s,e.sub(o,e.ONE));return Xn(e,a,t),a}function ri(e){if(e<Gn)throw new Error("sqrt is not defined for small field");let t=e-qn,r=0;for(;t%Kn===zn;)t/=Kn,r++;let n=Kn;const i=ai(e);for(;1===si(i,n);)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===r)return ei;let s=i.pow(n,t);const o=(t+qn)/Kn;return function(e,n){if(e.is0(n))return n;if(1!==si(e,n))throw new Error("Cannot find square root");let i=r,a=e.mul(e.ONE,s),c=e.pow(n,t),u=e.pow(n,o);for(;!e.eql(c,e.ONE);){if(e.is0(c))return e.ZERO;let t=1,r=e.sqr(c);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===i)throw new Error("Cannot find square root");const n=qn<<BigInt(i-t-1),s=e.pow(a,n);i=t,a=e.sqr(s),c=e.mul(c,a),u=e.mul(u,s)}return u}}const ni=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ii(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),i=t.reduce((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r)),e.ONE),s=e.inv(i);return t.reduceRight((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r)),s),n}function si(e,t){const r=(e.ORDER-qn)/Kn,n=e.pow(t,r),i=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),o=e.eql(n,e.neg(e.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function oi(e,t){void 0!==t&&Ue(t);const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function ai(e,t,r=!1,n={}){if(e<=zn)throw new Error("invalid field: expected ORDER > 0, got "+e);let i,s,o,a=!1;if("object"==typeof t&&null!=t){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const e=t;e.BITS&&(i=e.BITS),e.sqrt&&(s=e.sqrt),"boolean"==typeof e.isLE&&(r=e.isLE),"boolean"==typeof e.modFromBytes&&(a=e.modFromBytes),o=e.allowedLengths}else"number"==typeof t&&(i=t),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:u}=oi(e,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const d=Object.freeze({ORDER:e,isLE:r,BITS:c,BYTES:u,MASK:Fn(c),ZERO:zn,ONE:qn,allowedLengths:o,create:t=>Qn(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return zn<=t&&t<e},is0:e=>e===zn,isValidNot0:e=>!d.is0(e)&&d.isValid(e),isOdd:e=>(e&qn)===qn,neg:t=>Qn(-t,e),eql:(e,t)=>e===t,sqr:t=>Qn(t*t,e),add:(t,r)=>Qn(t+r,e),sub:(t,r)=>Qn(t-r,e),mul:(t,r)=>Qn(t*r,e),pow:(e,t)=>function(e,t,r){if(r<zn)throw new Error("invalid exponent, negatives unsupported");if(r===zn)return e.ONE;if(r===qn)return t;let n=e.ONE,i=t;for(;r>zn;)r&qn&&(n=e.mul(n,i)),i=e.sqr(i),r>>=qn;return n}(d,e,t),div:(t,r)=>Qn(t*Yn(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Yn(t,e),sqrt:s||(t=>{return l||(l=(r=e)%$n===Gn?ei:r%Wn===Vn?ti:r%Zn===Jn?function(e){const t=ai(e),r=ri(e),n=r(t,t.neg(t.ONE)),i=r(t,n),s=r(t,t.neg(n)),o=(e+Hn)/Zn;return(e,t)=>{let r=e.pow(t,o),a=e.mul(r,n);const c=e.mul(r,i),u=e.mul(r,s),l=e.eql(e.sqr(a),t),d=e.eql(e.sqr(c),t);r=e.cmov(r,a,l),a=e.cmov(u,c,d);const h=e.eql(e.sqr(a),t),f=e.cmov(r,a,h);return Xn(e,f,t),f}}(r):ri(r)),l(d,t);var r}),toBytes:e=>r?Dn(e,u):On(e,u),fromBytes:(t,n=!0)=>{if(o){if(!o.includes(t.length)||t.length>u)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);const e=new Uint8Array(u);e.set(t,r?0:e.length-t.length),t=e}if(t.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+t.length);let i=r?xn(t):Nn(t);if(a&&(i=Qn(i,e)),!n&&!d.isValid(i))throw new Error("invalid field element: outside of range 0..ORDER");return i},invertBatch:e=>ii(d,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(d)}function ci(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function ui(e){const t=ci(e);return t+Math.ceil(t/2)}const li=BigInt(0),di=BigInt(1);function hi(e,t){const r=t.negate();return e?r:t}function fi(e,t){const r=ii(e.Fp,t.map(e=>e.Z));return t.map((t,n)=>e.fromAffine(t.toAffine(r[n])))}function pi(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function gi(e,t){pi(e,t);const r=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:Fn(e),maxNumber:r,shiftBy:BigInt(e)}}function mi(e,t,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(e&i),c=e>>o;a>n&&(a-=s,c+=di);const u=t*n;return{nextN:c,offset:u+Math.abs(a)-1,isZero:0===a,isNeg:a<0,isNegF:t%2!=0,offsetF:u}}const yi=new WeakMap,bi=new WeakMap;function wi(e){return bi.get(e)||1}function vi(e){if(e!==li)throw new Error("invalid wNAF")}class Ei{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let n=e;for(;t>li;)t&di&&(r=r.add(n)),n=n.double(),t>>=di;return r}precomputeWindow(e,t){const{windows:r,windowSize:n}=gi(t,this.bits),i=[];let s=e,o=s;for(let e=0;e<r;e++){o=s,i.push(o);for(let e=1;e<n;e++)o=o.add(s),i.push(o);s=o.double()}return i}wNAF(e,t,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let n=this.ZERO,i=this.BASE;const s=gi(e,this.bits);for(let e=0;e<s.windows;e++){const{nextN:o,offset:a,isZero:c,isNeg:u,isNegF:l,offsetF:d}=mi(r,e,s);r=o,c?i=i.add(hi(l,t[d])):n=n.add(hi(u,t[a]))}return vi(r),{p:n,f:i}}wNAFUnsafe(e,t,r,n=this.ZERO){const i=gi(e,this.bits);for(let e=0;e<i.windows&&r!==li;e++){const{nextN:s,offset:o,isZero:a,isNeg:c}=mi(r,e,i);if(r=s,!a){const e=t[o];n=n.add(c?e.negate():e)}}return vi(r),n}getPrecomputes(e,t,r){let n=yi.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(n=r(n)),yi.set(t,n))),n}cached(e,t,r){const n=wi(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)}unsafe(e,t,r,n){const i=wi(e);return 1===i?this._unsafeLadder(e,t,n):this.wNAFUnsafe(i,this.getPrecomputes(i,e,r),t,n)}createCache(e,t){pi(t,this.bits),bi.set(e,t),yi.delete(e)}hasCache(e){return 1!==wi(e)}}function Ai(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return function(e){const t=ni.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"});Un(e,t)}(t),t}return ai(e,{isLE:r})}const Si=(e,t)=>(e+(e>=0?t:-t)/Ti)/t;function ki(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Ri(e,t){const r={};for(let n of Object.keys(t))r[n]=void 0===e[n]?t[n]:e[n];return In(r.lowS,"lowS"),In(r.prehash,"prehash"),void 0!==r.format&&ki(r.format),r}class Pi extends Error{constructor(e=""){super(e)}}const Ii={Err:Pi,_tlv:{encode:(e,t)=>{const{Err:r}=Ii;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");const n=t.length/2,i=_n(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?_n(i.length/2|128):"";return _n(e)+s+i+t},decode(e,t){const{Err:r}=Ii;let n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");const i=t[n++];let s=0;if(128&i){const e=127&i;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");const o=t.subarray(n,n+e);if(o.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===o[0])throw new r("tlv.decode(long): zero leftmost byte");for(const e of o)s=s<<8|e;if(n+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=i;const o=t.subarray(n,n+s);if(o.length!==s)throw new r("tlv.decode: wrong value length");return{v:o,l:t.subarray(n+s)}}},_int:{encode(e){const{Err:t}=Ii;if(e<Ci)throw new t("integer: negative integers are not allowed");let r=_n(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){const{Err:t}=Ii;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return Nn(e)}},toSig(e){const{Err:t,_int:r,_tlv:n}=Ii,i=Mn("signature",e),{v:s,l:o}=n.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(e){const{_tlv:t,_int:r}=Ii,n=t.encode(2,r.encode(e.r))+t.encode(2,r.encode(e.s));return t.encode(48,n)}},Ci=BigInt(0),_i=BigInt(1),Ti=BigInt(2),Ni=BigInt(3),xi=BigInt(4);function Oi(e,t){const{BYTES:r}=e;let n;if("bigint"==typeof t)n=t;else{let i=Mn("private key",t);try{n=e.fromBytes(i)}catch(e){throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof t}`)}}if(!e.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function Di(e,t={}){const r=function(e,t,r={},n){if(void 0===n&&(n="edwards"===e),!t||"object"!=typeof t)throw new Error(`expected valid ${e} CURVE object`);for(const e of["p","n","h"]){const r=t[e];if(!("bigint"==typeof r&&r>li))throw new Error(`CURVE.${e} must be positive bigint`)}const i=Ai(t.p,r.Fp,n),s=Ai(t.n,r.Fn,n),o=["Gx","Gy","a","weierstrass"===e?"b":"d"];for(const e of o)if(!i.isValid(t[e]))throw new Error(`CURVE.${e} must be valid field element of CURVE.Fp`);return{CURVE:t=Object.freeze(Object.assign({},t)),Fp:i,Fn:s}}("weierstrass",e,t),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;Un(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=t;if(c&&(!n.is0(s.a)||"bigint"!=typeof c.beta||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=Bi(n,i);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const d=t.toBytes||function(e,t,r){const{x:i,y:s}=t.toAffine(),o=n.toBytes(i);return In(r,"isCompressed"),r?(l(),rt(Mi(!n.isOdd(s)),o)):rt(Uint8Array.of(4),o,n.toBytes(s))},h=t.fromBytes||function(e){Cn(e,void 0,"Point");const{publicKey:t,publicKeyUncompressed:r}=u,i=e.length,s=e[0],o=e.subarray(1);if(i!==t||2!==s&&3!==s){if(i===r&&4===s){const e=n.BYTES,t=n.fromBytes(o.subarray(0,e)),r=n.fromBytes(o.subarray(e,2*e));if(!p(t,r))throw new Error("bad point: is not on curve");return{x:t,y:r}}throw new Error(`bad point: got length ${i}, expected compressed=${t} or uncompressed=${r}`)}{const e=n.fromBytes(o);if(!n.isValid(e))throw new Error("bad point: is not on curve, wrong x");const t=f(e);let r;try{r=n.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("bad point: is not on curve, sqrt error"+t)}return l(),!(1&~s)!==n.isOdd(r)&&(r=n.neg(r)),{x:e,y:r}}};function f(e){const t=n.sqr(e),r=n.mul(t,e);return n.add(n.add(r,n.mul(e,s.a)),s.b)}function p(e,t){const r=n.sqr(t),i=f(e);return n.eql(r,i)}if(!p(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const g=n.mul(n.pow(s.a,Ni),xi),m=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(g,m)))throw new Error("bad curve params: a or b");function y(e,t,r=!1){if(!n.isValid(t)||r&&n.is0(t))throw new Error(`bad point coordinate ${e}`);return t}function b(e){if(!(e instanceof S))throw new Error("ProjectivePoint expected")}function w(e){if(!c||!c.basises)throw new Error("no endo");return function(e,t,r){const[[n,i],[s,o]]=t,a=Si(o*e,r),c=Si(-i*e,r);let u=e-a*n-c*s,l=-a*i-c*o;const d=u<Ci,h=l<Ci;d&&(u=-u),h&&(l=-l);const f=Fn(Math.ceil(Ln(r)/2))+_i;if(u<Ci||u>=f||l<Ci||l>=f)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:u,k2neg:h,k2:l}}(e,c.basises,i.ORDER)}const v=jn((e,t)=>{const{X:r,Y:i,Z:s}=e;if(n.eql(s,n.ONE))return{x:r,y:i};const o=e.is0();null==t&&(t=o?n.ONE:n.inv(s));const a=n.mul(r,t),c=n.mul(i,t),u=n.mul(s,t);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(u,n.ONE))throw new Error("invZ was invalid");return{x:a,y:c}}),E=jn(e=>{if(e.is0()){if(t.allowInfinityPoint&&!n.is0(e.Y))return;throw new Error("bad point: ZERO")}const{x:r,y:i}=e.toAffine();if(!n.isValid(r)||!n.isValid(i))throw new Error("bad point: x or y not field elements");if(!p(r,i))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function A(e,t,r,i,s){return r=new S(n.mul(r.X,e),r.Y,r.Z),t=hi(i,t),r=hi(s,r),t.add(r)}class S{constructor(e,t,r){this.X=y("x",e),this.Y=y("y",t,!0),this.Z=y("z",r),Object.freeze(this)}static CURVE(){return s}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof S)throw new Error("projective point not allowed");return n.is0(t)&&n.is0(r)?S.ZERO:new S(t,r,n.ONE)}static fromBytes(e){const t=S.fromAffine(h(Cn(e,void 0,"point")));return t.assertValidity(),t}static fromHex(e){return S.fromBytes(Mn("pointHex",e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(e=8,t=!0){return R.createCache(this,e),t||this.multiply(Ni),this}assertValidity(){E(this)}hasEvenY(){const{y:e}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(e)}equals(e){b(e);const{X:t,Y:r,Z:i}=this,{X:s,Y:o,Z:a}=e,c=n.eql(n.mul(t,a),n.mul(s,i)),u=n.eql(n.mul(r,a),n.mul(o,i));return c&&u}negate(){return new S(this.X,n.neg(this.Y),this.Z)}double(){const{a:e,b:t}=s,r=n.mul(t,Ni),{X:i,Y:o,Z:a}=this;let c=n.ZERO,u=n.ZERO,l=n.ZERO,d=n.mul(i,i),h=n.mul(o,o),f=n.mul(a,a),p=n.mul(i,o);return p=n.add(p,p),l=n.mul(i,a),l=n.add(l,l),c=n.mul(e,l),u=n.mul(r,f),u=n.add(c,u),c=n.sub(h,u),u=n.add(h,u),u=n.mul(c,u),c=n.mul(p,c),l=n.mul(r,l),f=n.mul(e,f),p=n.sub(d,f),p=n.mul(e,p),p=n.add(p,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,f),d=n.mul(d,p),u=n.add(u,d),f=n.mul(o,a),f=n.add(f,f),d=n.mul(f,p),c=n.sub(c,d),l=n.mul(f,h),l=n.add(l,l),l=n.add(l,l),new S(c,u,l)}add(e){b(e);const{X:t,Y:r,Z:i}=this,{X:o,Y:a,Z:c}=e;let u=n.ZERO,l=n.ZERO,d=n.ZERO;const h=s.a,f=n.mul(s.b,Ni);let p=n.mul(t,o),g=n.mul(r,a),m=n.mul(i,c),y=n.add(t,r),w=n.add(o,a);y=n.mul(y,w),w=n.add(p,g),y=n.sub(y,w),w=n.add(t,i);let v=n.add(o,c);return w=n.mul(w,v),v=n.add(p,m),w=n.sub(w,v),v=n.add(r,i),u=n.add(a,c),v=n.mul(v,u),u=n.add(g,m),v=n.sub(v,u),d=n.mul(h,w),u=n.mul(f,m),d=n.add(u,d),u=n.sub(g,d),d=n.add(g,d),l=n.mul(u,d),g=n.add(p,p),g=n.add(g,p),m=n.mul(h,m),w=n.mul(f,w),g=n.add(g,m),m=n.sub(p,m),m=n.mul(h,m),w=n.add(w,m),p=n.mul(g,w),l=n.add(l,p),p=n.mul(v,w),u=n.mul(y,u),u=n.sub(u,p),p=n.mul(y,g),d=n.mul(v,d),d=n.add(d,p),new S(u,l,d)}subtract(e){return this.add(e.negate())}is0(){return this.equals(S.ZERO)}multiply(e){const{endo:r}=t;if(!i.isValidNot0(e))throw new Error("invalid scalar: out of range");let n,s;const o=e=>R.cached(this,e,e=>fi(S,e));if(r){const{k1neg:t,k1:i,k2neg:a,k2:c}=w(e),{p:u,f:l}=o(i),{p:d,f:h}=o(c);s=l.add(h),n=A(r.beta,u,d,t,a)}else{const{p:t,f:r}=o(e);n=t,s=r}return fi(S,[n,s])[0]}multiplyUnsafe(e){const{endo:r}=t,n=this;if(!i.isValid(e))throw new Error("invalid scalar: out of range");if(e===Ci||n.is0())return S.ZERO;if(e===_i)return n;if(R.hasCache(this))return this.multiply(e);if(r){const{k1neg:t,k1:i,k2neg:s,k2:o}=w(e),{p1:a,p2:c}=function(e,t,r,n){let i=t,s=e.ZERO,o=e.ZERO;for(;r>li||n>li;)r&di&&(s=s.add(i)),n&di&&(o=o.add(i)),i=i.double(),r>>=di,n>>=di;return{p1:s,p2:o}}(S,n,i,o);return A(r.beta,a,c,t,s)}return R.unsafe(n,e)}multiplyAndAddUnsafe(e,t,r){const n=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return n.is0()?void 0:n}toAffine(e){return v(this,e)}isTorsionFree(){const{isTorsionFree:e}=t;return o===_i||(e?e(S,this):R.unsafe(this,a).is0())}clearCofactor(){const{clearCofactor:e}=t;return o===_i?this:e?e(S,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(e=!0){return In(e,"isCompressed"),this.assertValidity(),d(S,this,e)}toHex(e=!0){return Ye(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(e=!0){return this.toBytes(e)}_setWindowSize(e){this.precompute(e)}static normalizeZ(e){return fi(S,e)}static msm(e,t){return function(e,t,r,n){(function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw new Error("invalid point at index "+r)})})(r,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+r)})}(n,t);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=Ln(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Fn(c),l=new Array(Number(u)+1).fill(o);let d=o;for(let e=Math.floor((t.BITS-1)/c)*c;e>=0;e-=c){l.fill(o);for(let t=0;t<s;t++){const i=n[t],s=Number(i>>BigInt(e)&u);l[s]=l[s].add(r[t])}let t=o;for(let e=l.length-1,r=o;e>0;e--)r=r.add(l[e]),t=t.add(r);if(d=d.add(t),0!==e)for(let e=0;e<c;e++)d=d.double()}return d}(S,i,e,t)}static fromPrivateKey(e){return S.BASE.multiply(Oi(i,e))}}S.BASE=new S(s.Gx,s.Gy,n.ONE),S.ZERO=new S(n.ZERO,n.ONE,n.ZERO),S.Fp=n,S.Fn=i;const k=i.BITS,R=new Ei(S,t.endo?Math.ceil(k/2):k);return S.BASE.precompute(8),S}function Mi(e){return Uint8Array.of(e?2:3)}function Bi(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function Li(e,t,r={}){ze(t),Un(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||st,i=r.hmac||((e,...r)=>kn(t,e,rt(...r))),{Fp:s,Fn:o}=e,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:d,utils:h,lengths:f}=function(e,t={}){const{Fn:r}=e,n=t.randomBytes||st,i=Object.assign(Bi(e.Fp,r),{seed:ui(r.ORDER)});function s(e){try{return!!Oi(r,e)}catch(e){return!1}}function o(e=n(i.seed)){return function(e,t,r=!1){const n=e.length,i=ci(t),s=ui(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=Qn(r?xn(e):Nn(e),t-qn)+qn;return r?Dn(o,i):On(o,i)}(Cn(e,i.seed,"seed"),r.ORDER)}function a(t,n=!0){return e.BASE.multiply(Oi(r,t)).toBytes(n)}function c(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;const{secretKey:n,publicKey:s,publicKeyUncompressed:o}=i;if(r.allowedLengths||n===s)return;const a=Mn("key",t).length;return a===s||a===o}const u={isValidSecretKey:s,isValidPublicKey:function(t,r){const{publicKey:n,publicKeyUncompressed:s}=i;try{const i=t.length;return!(!0===r&&i!==n||!1===r&&i!==s||!e.fromBytes(t))}catch(e){return!1}},randomSecretKey:o,isValidPrivateKey:s,randomPrivateKey:o,normPrivateKeyToScalar:e=>Oi(r,e),precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)};return Object.freeze({getPublicKey:a,getSharedSecret:function(t,n,i=!0){if(!0===c(t))throw new Error("first arg must be private key");if(!1===c(n))throw new Error("second arg must be public key");const s=Oi(r,t);return e.fromHex(n).multiply(s).toBytes(i)},keygen:function(e){const t=o(e);return{secretKey:t,publicKey:a(t)}},Point:e,utils:u,lengths:i})}(e,r),p={prehash:!1,lowS:"boolean"==typeof r.lowS&&r.lowS,format:void 0,extraEntropy:!1},g="compact";function m(e){return e>a>>_i}function y(e,t){if(!o.isValidNot0(t))throw new Error(`invalid signature ${e}: out of range 1..Point.Fn.ORDER`);return t}class b{constructor(e,t,r){this.r=y("r",e),this.s=y("s",t),null!=r&&(this.recovery=r),Object.freeze(this)}static fromBytes(e,t=g){let r;if(function(e,t){ki(t);const r=f.signature;Cn(e,"compact"===t?r:"recovered"===t?r+1:void 0,`${t} signature`)}(e,t),"der"===t){const{r:t,s:r}=Ii.toSig(Cn(e));return new b(t,r)}"recovered"===t&&(r=e[0],t="compact",e=e.subarray(1));const n=o.BYTES,i=e.subarray(0,n),s=e.subarray(n,2*n);return new b(o.fromBytes(i),o.fromBytes(s),r)}static fromHex(e,t){return this.fromBytes(et(e),t)}addRecoveryBit(e){return new b(this.r,this.s,e)}recoverPublicKey(t){const r=s.ORDER,{r:n,s:i,recovery:c}=this;if(null==c||![0,1,2,3].includes(c))throw new Error("recovery id invalid");if(a*Ti<r&&c>1)throw new Error("recovery id is ambiguous for h>1 curve");const u=2===c||3===c?n+a:n;if(!s.isValid(u))throw new Error("recovery id 2 or 3 invalid");const l=s.toBytes(u),d=e.fromBytes(rt(Mi(!(1&c)),l)),h=o.inv(u),f=v(Mn("msgHash",t)),p=o.create(-f*h),g=o.create(i*h),m=e.BASE.multiplyUnsafe(p).add(d.multiplyUnsafe(g));if(m.is0())throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return m(this.s)}toBytes(e=g){if(ki(e),"der"===e)return et(Ii.hexFromSig(this));const t=o.toBytes(this.r),r=o.toBytes(this.s);if("recovered"===e){if(null==this.recovery)throw new Error("recovery bit must be present");return rt(Uint8Array.of(this.recovery),t,r)}return rt(t,r)}toHex(e){return Ye(this.toBytes(e))}assertValidity(){}static fromCompact(e){return b.fromBytes(Mn("sig",e),"compact")}static fromDER(e){return b.fromBytes(Mn("sig",e),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Ye(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Ye(this.toBytes("compact"))}}const w=r.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const t=Nn(e),r=8*e.length-c;return r>0?t>>BigInt(r):t},v=r.bits2int_modN||function(e){return o.create(w(e))},E=Fn(c);function A(e){return function(e,t,r,n){if(!function(e,t,r){return Bn(e)&&Bn(t)&&Bn(r)&&t<=e&&e<r}(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}("num < 2^"+c,e,Ci,E),o.toBytes(e)}function S(e,r){return Cn(e,void 0,"message"),r?Cn(t(e),void 0,"prehashed message"):e}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:d,utils:h,lengths:f,Point:e,sign:function(r,s,a={}){r=Mn("message",r);const{seed:c,k2sig:u}=function(t,r,i){if(["recovered","canonical"].some(e=>e in i))throw new Error("sign() legacy options not supported");const{lowS:s,prehash:a,extraEntropy:c}=Ri(i,p);t=S(t,a);const u=v(t),l=Oi(o,r),d=[A(l),A(u)];if(null!=c&&!1!==c){const e=!0===c?n(f.secretKey):c;d.push(Mn("extraEntropy",e))}const h=rt(...d),g=u;return{seed:h,k2sig:function(t){const r=w(t);if(!o.isValidNot0(r))return;const n=o.inv(r),i=e.BASE.multiply(r).toAffine(),a=o.create(i.x);if(a===Ci)return;const c=o.create(n*o.create(g+a*l));if(c===Ci)return;let u=(i.x===a?0:2)|Number(i.y&_i),d=c;return s&&m(c)&&(d=o.neg(c),u^=1),new b(a,d,u)}}}(r,s,a),l=function(e,t,r){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");const n=e=>new Uint8Array(e),i=e=>Uint8Array.of(e);let s=n(e),o=n(e),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...e)=>r(o,s,...e),l=(e=n(0))=>{o=u(i(0),e),s=u(),0!==e.length&&(o=u(i(1),e),s=u())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const r=[];for(;e<t;){s=u();const t=s.slice();r.push(t),e+=s.length}return rt(...r)};return(e,t)=>{let r;for(c(),l(e);!(r=t(d()));)l();return c(),r}}(t.outputLen,o.BYTES,i);return l(c,u)},verify:function(t,r,n,i={}){const{lowS:s,prehash:a,format:c}=Ri(i,p);if(n=Mn("publicKey",n),r=S(Mn("message",r),a),"strict"in i)throw new Error("options.strict was renamed to lowS");const u=void 0===c?function(e){let t;const r="string"==typeof e||Fe(e),n=!r&&null!==e&&"object"==typeof e&&"bigint"==typeof e.r&&"bigint"==typeof e.s;if(!r&&!n)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(n)t=new b(e.r,e.s);else if(r){try{t=b.fromBytes(Mn("sig",e),"der")}catch(e){if(!(e instanceof Ii.Err))throw e}if(!t)try{t=b.fromBytes(Mn("sig",e),"compact")}catch(e){return!1}}return t||!1}(t):b.fromBytes(Mn("sig",t),c);if(!1===u)return!1;try{const t=e.fromBytes(n);if(s&&u.hasHighS())return!1;const{r:i,s:a}=u,c=v(r),l=o.inv(a),d=o.create(c*l),h=o.create(i*l),f=e.BASE.multiplyUnsafe(d).add(t.multiplyUnsafe(h));return!f.is0()&&o.create(f.x)===i}catch(e){return!1}},recoverPublicKey:function(e,t,r={}){const{prehash:n}=Ri(r,p);return t=S(t,n),b.fromBytes(e,"recovered").recoverPublicKey(t).toBytes()},Signature:b,hash:t})}function Fi(e){const{CURVE:t,curveOpts:r,hash:n,ecdsaOpts:i}=function(e){const{CURVE:t,curveOpts:r}=function(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp;let n=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(e=>Math.ceil(e/2)))):void 0;return{CURVE:t,curveOpts:{Fp:r,Fn:ai(t.n,{BITS:e.nBitLength,allowedLengths:n,modFromBytes:e.wrapPrivateKey}),allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes}}}(e),n={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:r,hash:e.hash,ecdsaOpts:n}}(e);return function(e,t){const r=t.Point;return Object.assign({},t,{ProjectivePoint:r,CURVE:Object.assign({},e,oi(r.Fn.ORDER,r.Fn.BITS))})}(e,Li(Di(t,r),n,i))}function Ui(e,t){const r=t=>Fi({...e,hash:t});return{...r(t),create:r}}const ji={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},zi={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},qi={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},Ki=ai(ji.p),Gi=ai(zi.p),$i=ai(qi.p),Vi=Ui({...ji,Fp:Ki,lowS:!1},$t);Ui({...zi,Fp:Gi,lowS:!1},Wt),Ui({...qi,Fp:$i,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},Ht);const Hi=Vi;class Wi extends Error{code="AbortError";constructor(e){super(void 0===e?"aborted":`${e} aborted`)}}function Ji(e,t,r){if(void 0===t)return e;if(t.aborted)return Promise.reject(new Wi(r));let n;return new Promise((i,s)=>{n=()=>{s(new Wi(r))},t.addEventListener("abort",n),e.then(i,s)}).finally(()=>{t.removeEventListener("abort",n)})}const Zi=(e,t,r)=>{if(r.aborted)return;const n=()=>{clearTimeout(i)};r.addEventListener("abort",n,{once:!0});const i=setTimeout(()=>{r.removeEventListener("abort",n),e()},t)},Qi=()=>{};class Yi extends Promise{resolveFn;rejectFn;ensureNoopCatchAttached;settled=!1;constructor(e=Qi){let t,r;if(super((n,i)=>{t=n,r=i,e(n,i)}),void 0===t)throw new Error("invariant violation: resolveFn was undefined");if(void 0===r)throw new Error("invariant violation: rejectFn was undefined");this.resolveFn=t,this.rejectFn=r,this.ensureNoopCatchAttached=ie()(()=>{super.catch(()=>{})})}resolve(e){this.ensureNoopCatchAttached(),this.settled||(this.settled=!0,this.resolveFn(e))}reject(e){this.ensureNoopCatchAttached(),this.settled||(this.settled=!0,this.rejectFn(e))}wrap(e){return this.ensureNoopCatchAttached(),async(...t)=>{try{const r=await e(...t);return this.resolve(r),r}catch(e){throw this.reject(e),e}}}}function Xi(e){return e.indexOf(".")>0}const es=/^0x[a-fA-F0-9]{40}$/;function ts(e){if(es.test(e))return e.toLowerCase();throw new Error(`not a valid Ethereum address: "${e}"`)}var rs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{};function ns(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function is(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){var r=!1;try{r=this instanceof e}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}),r}var ss,os,as={},cs={},us={},ls={};function ds(){if(os)return ls;os=1;var e=oe();return ls.encrypt=function(t,r){var n=e(r,t._prev);return t._prev=t._cipher.encryptBlock(n),t._prev},ls.decrypt=function(t,r){var n=t._prev;t._prev=r;var i=t._cipher.decryptBlock(r);return e(i,n)},ls}var hs,fs={};function ps(){if(hs)return fs;hs=1;var e=ce().Buffer,t=oe();function r(r,n,i){var s=n.length,o=t(n,r._cache);return r._cache=r._cache.slice(s),r._prev=e.concat([r._prev,i?n:o]),o}return fs.encrypt=function(t,n,i){for(var s,o=e.allocUnsafe(0);n.length;){if(0===t._cache.length&&(t._cache=t._cipher.encryptBlock(t._prev),t._prev=e.allocUnsafe(0)),!(t._cache.length<=n.length)){o=e.concat([o,r(t,n,i)]);break}s=t._cache.length,o=e.concat([o,r(t,n.slice(0,s),i)]),n=n.slice(s)}return o},fs}var gs,ms={};function ys(){if(gs)return ms;gs=1;var e=ce().Buffer;function t(t,r,n){var i=t._cipher.encryptBlock(t._prev)[0]^r;return t._prev=e.concat([t._prev.slice(1),e.from([n?r:i])]),i}return ms.encrypt=function(r,n,i){for(var s=n.length,o=e.allocUnsafe(s),a=-1;++a<s;)o[a]=t(r,n[a],i);return o},ms}var bs,ws={};function vs(){if(bs)return ws;bs=1;var e=ce().Buffer;function t(e,t,n){for(var i,s,o=-1,a=0;++o<8;)i=t&1<<7-o?128:0,a+=(128&(s=e._cipher.encryptBlock(e._prev)[0]^i))>>o%8,e._prev=r(e._prev,n?i:s);return a}function r(t,r){var n=t.length,i=-1,s=e.allocUnsafe(t.length);for(t=e.concat([t,e.from([r])]);++i<n;)s[i]=t[i]<<1|t[i+1]>>7;return s}return ws.encrypt=function(r,n,i){for(var s=n.length,o=e.allocUnsafe(s),a=-1;++a<s;)o[a]=t(r,n[a],i);return o},ws}var Es,As={};function Ss(){if(Es)return As;Es=1;var e=oe();function t(e){return e._prev=e._cipher.encryptBlock(e._prev),e._prev}return As.encrypt=function(r,n){for(;r._cache.length<n.length;)r._cache=Buffer.concat([r._cache,t(r)]);var i=r._cache.slice(0,n.length);return r._cache=r._cache.slice(n.length),e(n,i)},As}var ks,Rs,Ps,Is={};function Cs(){return Rs?ks:(Rs=1,ks=function(e){for(var t,r=e.length;r--;){if(255!==(t=e.readUInt8(r))){t++,e.writeUInt8(t,r);break}e.writeUInt8(0,r)}})}function _s(){if(Ps)return Is;Ps=1;var e=oe(),t=ce().Buffer,r=Cs();function n(e){var t=e._cipher.encryptBlockRaw(e._prev);return r(e._prev),t}return Is.encrypt=function(r,i){var s=Math.ceil(i.length/16),o=r._cache.length;r._cache=t.concat([r._cache,t.allocUnsafe(16*s)]);for(var a=0;a<s;a++){var c=n(r),u=o+16*a;r._cache.writeUInt32BE(c[0],u+0),r._cache.writeUInt32BE(c[1],u+4),r._cache.writeUInt32BE(c[2],u+8),r._cache.writeUInt32BE(c[3],u+12)}var l=r._cache.slice(0,i.length);return r._cache=r._cache.slice(i.length),e(i,l)},Is}var Ts,Ns,xs={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128:{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192:{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256:{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}};function Os(){if(Ns)return Ts;Ns=1;var e={ECB:(ss||(ss=1,us.encrypt=function(e,t){return e._cipher.encryptBlock(t)},us.decrypt=function(e,t){return e._cipher.decryptBlock(t)}),us),CBC:ds(),CFB:ps(),CFB8:ys(),CFB1:vs(),OFB:Ss(),CTR:_s(),GCM:_s()},t=xs;for(var r in t)t[r].module=e[t[r].mode];return Ts=t}var Ds,Ms,Bs,Ls,Fs,Us,js,zs,qs,Ks,Gs,$s,Vs,Hs,Ws,Js,Zs={};function Qs(){if(Ds)return Zs;Ds=1;var e=ce().Buffer;function t(t){e.isBuffer(t)||(t=e.from(t));for(var r=t.length/4|0,n=new Array(r),i=0;i<r;i++)n[i]=t.readUInt32BE(4*i);return n}function r(e){for(;0<e.length;e++)e[0]=0}function n(e,t,r,n,i){for(var s,o,a,c,u=r[0],l=r[1],d=r[2],h=r[3],f=e[0]^t[0],p=e[1]^t[1],g=e[2]^t[2],m=e[3]^t[3],y=4,b=1;b<i;b++)s=u[f>>>24]^l[p>>>16&255]^d[g>>>8&255]^h[255&m]^t[y++],o=u[p>>>24]^l[g>>>16&255]^d[m>>>8&255]^h[255&f]^t[y++],a=u[g>>>24]^l[m>>>16&255]^d[f>>>8&255]^h[255&p]^t[y++],c=u[m>>>24]^l[f>>>16&255]^d[p>>>8&255]^h[255&g]^t[y++],f=s,p=o,g=a,m=c;return s=(n[f>>>24]<<24|n[p>>>16&255]<<16|n[g>>>8&255]<<8|n[255&m])^t[y++],o=(n[p>>>24]<<24|n[g>>>16&255]<<16|n[m>>>8&255]<<8|n[255&f])^t[y++],a=(n[g>>>24]<<24|n[m>>>16&255]<<16|n[f>>>8&255]<<8|n[255&p])^t[y++],c=(n[m>>>24]<<24|n[f>>>16&255]<<16|n[p>>>8&255]<<8|n[255&g])^t[y++],[s>>>=0,o>>>=0,a>>>=0,c>>>=0]}var i=[0,1,2,4,8,16,32,64,128,27,54],s=function(){for(var e=new Array(256),t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var r=[],n=[],i=[[],[],[],[]],s=[[],[],[],[]],o=0,a=0,c=0;c<256;++c){var u=a^a<<1^a<<2^a<<3^a<<4;u=u>>>8^255&u^99,r[o]=u,n[u]=o;var l=e[o],d=e[l],h=e[d],f=257*e[u]^16843008*u;i[0][o]=f<<24|f>>>8,i[1][o]=f<<16|f>>>16,i[2][o]=f<<8|f>>>24,i[3][o]=f,f=16843009*h^65537*d^257*l^16843008*o,s[0][u]=f<<24|f>>>8,s[1][u]=f<<16|f>>>16,s[2][u]=f<<8|f>>>24,s[3][u]=f,0===o?o=a=1:(o=l^e[e[e[h^l]]],a^=e[e[a]])}return{SBOX:r,INV_SBOX:n,SUB_MIX:i,INV_SUB_MIX:s}}();function o(e){this._key=t(e),this._reset()}return o.blockSize=16,o.keySize=32,o.prototype.blockSize=o.blockSize,o.prototype.keySize=o.keySize,o.prototype._reset=function(){for(var e=this._key,t=e.length,r=t+6,n=4*(r+1),o=[],a=0;a<t;a++)o[a]=e[a];for(a=t;a<n;a++){var c=o[a-1];a%t===0?(c=c<<8|c>>>24,c=s.SBOX[c>>>24]<<24|s.SBOX[c>>>16&255]<<16|s.SBOX[c>>>8&255]<<8|s.SBOX[255&c],c^=i[a/t|0]<<24):t>6&&a%t===4&&(c=s.SBOX[c>>>24]<<24|s.SBOX[c>>>16&255]<<16|s.SBOX[c>>>8&255]<<8|s.SBOX[255&c]),o[a]=o[a-t]^c}for(var u=[],l=0;l<n;l++){var d=n-l,h=o[d-(l%4?0:4)];u[l]=l<4||d<=4?h:s.INV_SUB_MIX[0][s.SBOX[h>>>24]]^s.INV_SUB_MIX[1][s.SBOX[h>>>16&255]]^s.INV_SUB_MIX[2][s.SBOX[h>>>8&255]]^s.INV_SUB_MIX[3][s.SBOX[255&h]]}this._nRounds=r,this._keySchedule=o,this._invKeySchedule=u},o.prototype.encryptBlockRaw=function(e){return n(e=t(e),this._keySchedule,s.SUB_MIX,s.SBOX,this._nRounds)},o.prototype.encryptBlock=function(t){var r=this.encryptBlockRaw(t),n=e.allocUnsafe(16);return n.writeUInt32BE(r[0],0),n.writeUInt32BE(r[1],4),n.writeUInt32BE(r[2],8),n.writeUInt32BE(r[3],12),n},o.prototype.decryptBlock=function(r){var i=(r=t(r))[1];r[1]=r[3],r[3]=i;var o=n(r,this._invKeySchedule,s.INV_SUB_MIX,s.INV_SBOX,this._nRounds),a=e.allocUnsafe(16);return a.writeUInt32BE(o[0],0),a.writeUInt32BE(o[3],4),a.writeUInt32BE(o[2],8),a.writeUInt32BE(o[1],12),a},o.prototype.scrub=function(){r(this._keySchedule),r(this._invKeySchedule),r(this._key)},Zs.AES=o,Zs}function Ys(){if(Bs)return Ms;Bs=1;var e=ce().Buffer,t=le().Transform,r=de.StringDecoder;function n(e){t.call(this),this.hashMode="string"==typeof e,this.hashMode?this[e]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}fe()(n,t);var i="undefined"!=typeof Uint8Array,s="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&ArrayBuffer.isView&&(e.prototype instanceof Uint8Array||e.TYPED_ARRAY_SUPPORT);return n.prototype.update=function(t,r,n){var o=function(t,r){if(t instanceof e)return t;if("string"==typeof t)return e.from(t,r);if(s&&ArrayBuffer.isView(t)){if(0===t.byteLength)return e.alloc(0);var n=e.from(t.buffer,t.byteOffset,t.byteLength);if(n.byteLength===t.byteLength)return n}if(i&&t instanceof Uint8Array)return e.from(t);if(e.isBuffer(t)&&t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t))return e.from(t);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}(t,r),a=this._update(o);return this.hashMode?this:(n&&(a=this._toString(a,n)),a)},n.prototype.setAutoPadding=function(){},n.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},n.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},n.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},n.prototype._transform=function(e,t,r){var n;try{this.hashMode?this._update(e):this.push(this._update(e))}catch(e){n=e}finally{r(n)}},n.prototype._flush=function(e){var t;try{this.push(this.__final())}catch(e){t=e}e(t)},n.prototype._finalOrDigest=function(t){var r=this.__final()||e.alloc(0);return t&&(r=this._toString(r,t,!0)),r},n.prototype._toString=function(e,t,n){if(this._decoder||(this._decoder=new r(t),this._encoding=t),this._encoding!==t)throw new Error("cant switch encodings");var i=this._decoder.write(e);return n&&(i+=this._decoder.end()),i},Ms=n}function Xs(){if(js)return Us;js=1;var e=Qs(),t=ce().Buffer,r=Ys(),n=fe(),i=function(){if(Fs)return Ls;Fs=1;var e=ce().Buffer,t=e.alloc(16,0);function r(t){var r=e.allocUnsafe(16);return r.writeUInt32BE(t[0]>>>0,0),r.writeUInt32BE(t[1]>>>0,4),r.writeUInt32BE(t[2]>>>0,8),r.writeUInt32BE(t[3]>>>0,12),r}function n(t){this.h=t,this.state=e.alloc(16,0),this.cache=e.allocUnsafe(0)}return n.prototype.ghash=function(e){for(var t=-1;++t<e.length;)this.state[t]^=e[t];this._multiply()},n.prototype._multiply=function(){for(var e,t,n,i=[(e=this.h).readUInt32BE(0),e.readUInt32BE(4),e.readUInt32BE(8),e.readUInt32BE(12)],s=[0,0,0,0],o=-1;++o<128;){for(!!(this.state[~~(o/8)]&1<<7-o%8)&&(s[0]^=i[0],s[1]^=i[1],s[2]^=i[2],s[3]^=i[3]),n=!!(1&i[3]),t=3;t>0;t--)i[t]=i[t]>>>1|(1&i[t-1])<<31;i[0]=i[0]>>>1,n&&(i[0]=i[0]^225<<24)}this.state=r(s)},n.prototype.update=function(t){var r;for(this.cache=e.concat([this.cache,t]);this.cache.length>=16;)r=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(r)},n.prototype.final=function(n,i){return this.cache.length&&this.ghash(e.concat([this.cache,t],16)),this.ghash(r([0,n,0,i])),this.state},Ls=n}(),s=oe(),o=Cs();function a(n,s,a,c){r.call(this);var u=t.alloc(4,0);this._cipher=new e.AES(s);var l=this._cipher.encryptBlock(u);this._ghash=new i(l),a=function(e,r,n){if(12===r.length)return e._finID=t.concat([r,t.from([0,0,0,1])]),t.concat([r,t.from([0,0,0,2])]);var s=new i(n),a=r.length,c=a%16;s.update(r),c&&(c=16-c,s.update(t.alloc(c,0))),s.update(t.alloc(8,0));var u=8*a,l=t.alloc(8);l.writeUIntBE(u,0,8),s.update(l),e._finID=s.state;var d=t.from(e._finID);return o(d),d}(this,a,l),this._prev=t.from(a),this._cache=t.allocUnsafe(0),this._secCache=t.allocUnsafe(0),this._decrypt=c,this._alen=0,this._len=0,this._mode=n,this._authTag=null,this._called=!1}return n(a,r),a.prototype._update=function(e){if(!this._called&&this._alen){var r=16-this._alen%16;r<16&&(r=t.alloc(r,0),this._ghash.update(r))}this._called=!0;var n=this._mode.encrypt(this,e);return this._decrypt?this._ghash.update(e):this._ghash.update(n),this._len+=e.length,n},a.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var e=s(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function(e,t){var r=0;e.length!==t.length&&r++;for(var n=Math.min(e.length,t.length),i=0;i<n;++i)r+=e[i]^t[i];return r}(e,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=e,this._cipher.scrub()},a.prototype.getAuthTag=function(){if(this._decrypt||!t.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},a.prototype.setAuthTag=function(e){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=e},a.prototype.setAAD=function(e){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length},Us=a}function eo(){if(qs)return zs;qs=1;var e=Qs(),t=ce().Buffer,r=Ys();function n(n,i,s,o){r.call(this),this._cipher=new e.AES(i),this._prev=t.from(s),this._cache=t.allocUnsafe(0),this._secCache=t.allocUnsafe(0),this._decrypt=o,this._mode=n}return fe()(n,r),n.prototype._update=function(e){return this._mode.encrypt(this,e,this._decrypt)},n.prototype._final=function(){this._cipher.scrub()},zs=n}function to(){if(Gs)return Ks;Gs=1;var e=ce().Buffer,t=le().Transform;function r(r){t.call(this),this._block=e.allocUnsafe(r),this._blockSize=r,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}fe()(r,t),r.prototype._transform=function(e,t,r){var n=null;try{this.update(e,t)}catch(e){n=e}r(n)},r.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(e){t=e}e(t)};var n="undefined"!=typeof Uint8Array,i="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&ArrayBuffer.isView&&(e.prototype instanceof Uint8Array||e.TYPED_ARRAY_SUPPORT);return r.prototype.update=function(t,r){if(this._finalized)throw new Error("Digest already called");t=function(t,r){if(t instanceof e)return t;if("string"==typeof t)return e.from(t,r);if(i&&ArrayBuffer.isView(t)){if(0===t.byteLength)return e.alloc(0);var s=e.from(t.buffer,t.byteOffset,t.byteLength);if(s.byteLength===t.byteLength)return s}if(n&&t instanceof Uint8Array)return e.from(t);if(e.isBuffer(t)&&t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t))return e.from(t);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}(t,r);for(var s=this._block,o=0;this._blockOffset+t.length-o>=this._blockSize;){for(var a=this._blockOffset;a<this._blockSize;)s[a++]=t[o++];this._update(),this._blockOffset=0}for(;o<t.length;)s[this._blockOffset++]=t[o++];for(var c=0,u=8*t.length;u>0;++c)this._length[c]+=u,(u=this._length[c]/4294967296|0)>0&&(this._length[c]-=4294967296*u);return this},r.prototype._update=function(){throw new Error("_update is not implemented")},r.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0),this._blockOffset=0;for(var r=0;r<4;++r)this._length[r]=0;return t},r.prototype._digest=function(){throw new Error("_digest is not implemented")},Ks=r}function ro(){if(Vs)return $s;Vs=1;var e=fe(),t=to(),r=ce().Buffer,n=new Array(16);function i(){t.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function s(e,t){return e<<t|e>>>32-t}function o(e,t,r,n,i,o,a){return s(e+(t&r|~t&n)+i+o|0,a)+t|0}function a(e,t,r,n,i,o,a){return s(e+(t&n|r&~n)+i+o|0,a)+t|0}function c(e,t,r,n,i,o,a){return s(e+(t^r^n)+i+o|0,a)+t|0}function u(e,t,r,n,i,o,a){return s(e+(r^(t|~n))+i+o|0,a)+t|0}return e(i,t),i.prototype._update=function(){for(var e=n,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var r=this._a,i=this._b,s=this._c,l=this._d;r=o(r,i,s,l,e[0],3614090360,7),l=o(l,r,i,s,e[1],3905402710,12),s=o(s,l,r,i,e[2],606105819,17),i=o(i,s,l,r,e[3],3250441966,22),r=o(r,i,s,l,e[4],4118548399,7),l=o(l,r,i,s,e[5],1200080426,12),s=o(s,l,r,i,e[6],2821735955,17),i=o(i,s,l,r,e[7],4249261313,22),r=o(r,i,s,l,e[8],1770035416,7),l=o(l,r,i,s,e[9],2336552879,12),s=o(s,l,r,i,e[10],4294925233,17),i=o(i,s,l,r,e[11],2304563134,22),r=o(r,i,s,l,e[12],1804603682,7),l=o(l,r,i,s,e[13],4254626195,12),s=o(s,l,r,i,e[14],2792965006,17),r=a(r,i=o(i,s,l,r,e[15],1236535329,22),s,l,e[1],4129170786,5),l=a(l,r,i,s,e[6],3225465664,9),s=a(s,l,r,i,e[11],643717713,14),i=a(i,s,l,r,e[0],3921069994,20),r=a(r,i,s,l,e[5],3593408605,5),l=a(l,r,i,s,e[10],38016083,9),s=a(s,l,r,i,e[15],3634488961,14),i=a(i,s,l,r,e[4],3889429448,20),r=a(r,i,s,l,e[9],568446438,5),l=a(l,r,i,s,e[14],3275163606,9),s=a(s,l,r,i,e[3],4107603335,14),i=a(i,s,l,r,e[8],1163531501,20),r=a(r,i,s,l,e[13],2850285829,5),l=a(l,r,i,s,e[2],4243563512,9),s=a(s,l,r,i,e[7],1735328473,14),r=c(r,i=a(i,s,l,r,e[12],2368359562,20),s,l,e[5],4294588738,4),l=c(l,r,i,s,e[8],2272392833,11),s=c(s,l,r,i,e[11],1839030562,16),i=c(i,s,l,r,e[14],4259657740,23),r=c(r,i,s,l,e[1],2763975236,4),l=c(l,r,i,s,e[4],1272893353,11),s=c(s,l,r,i,e[7],4139469664,16),i=c(i,s,l,r,e[10],3200236656,23),r=c(r,i,s,l,e[13],681279174,4),l=c(l,r,i,s,e[0],3936430074,11),s=c(s,l,r,i,e[3],3572445317,16),i=c(i,s,l,r,e[6],76029189,23),r=c(r,i,s,l,e[9],3654602809,4),l=c(l,r,i,s,e[12],3873151461,11),s=c(s,l,r,i,e[15],530742520,16),r=u(r,i=c(i,s,l,r,e[2],3299628645,23),s,l,e[0],4096336452,6),l=u(l,r,i,s,e[7],1126891415,10),s=u(s,l,r,i,e[14],2878612391,15),i=u(i,s,l,r,e[5],4237533241,21),r=u(r,i,s,l,e[12],1700485571,6),l=u(l,r,i,s,e[3],2399980690,10),s=u(s,l,r,i,e[10],4293915773,15),i=u(i,s,l,r,e[1],2240044497,21),r=u(r,i,s,l,e[8],1873313359,6),l=u(l,r,i,s,e[15],4264355552,10),s=u(s,l,r,i,e[6],2734768916,15),i=u(i,s,l,r,e[13],1309151649,21),r=u(r,i,s,l,e[4],4149444226,6),l=u(l,r,i,s,e[11],3174756917,10),s=u(s,l,r,i,e[2],718787259,15),i=u(i,s,l,r,e[9],3951481745,21),this._a=this._a+r|0,this._b=this._b+i|0,this._c=this._c+s|0,this._d=this._d+l|0},i.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=r.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},$s=i}function no(){if(Ws)return Hs;Ws=1;var e=ce().Buffer,t=ro();return Hs=function(r,n,i,s){if(e.isBuffer(r)||(r=e.from(r,"binary")),n&&(e.isBuffer(n)||(n=e.from(n,"binary")),8!==n.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var o=i/8,a=e.alloc(o),c=e.alloc(s||0),u=e.alloc(0);o>0||s>0;){var l=new t;l.update(u),l.update(r),n&&l.update(n),u=l.digest();var d=0;if(o>0){var h=a.length-o;d=Math.min(o,u.length),u.copy(a,h,0,d),o-=d}if(d<u.length&&s>0){var f=c.length-s,p=Math.min(s,u.length-d);u.copy(c,f,d,d+p),s-=p}}return u.fill(0),{key:a,iv:c}},Hs}var io,so,oo={};function ao(){if(so)return as;so=1;var e=function(){if(Js)return cs;Js=1;var e=Os(),t=Xs(),r=ce().Buffer,n=eo(),i=Ys(),s=Qs(),o=no();function a(e,t,n){i.call(this),this._cache=new u,this._cipher=new s.AES(t),this._prev=r.from(n),this._mode=e,this._autopadding=!0}fe()(a,i),a.prototype._update=function(e){var t,n;this._cache.add(e);for(var i=[];t=this._cache.get();)n=this._mode.encrypt(this,t),i.push(n);return r.concat(i)};var c=r.alloc(16,16);function u(){this.cache=r.allocUnsafe(0)}function l(i,s,o){var c=e[i.toLowerCase()];if(!c)throw new TypeError("invalid suite type");if("string"==typeof s&&(s=r.from(s)),s.length!==c.key/8)throw new TypeError("invalid key length "+s.length);if("string"==typeof o&&(o=r.from(o)),"GCM"!==c.mode&&o.length!==c.iv)throw new TypeError("invalid iv length "+o.length);return"stream"===c.type?new n(c.module,s,o):"auth"===c.type?new t(c.module,s,o):new a(c.module,s,o)}return a.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return e=this._mode.encrypt(this,e),this._cipher.scrub(),e;if(!e.equals(c))throw this._cipher.scrub(),new Error("data not multiple of block length")},a.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},u.prototype.add=function(e){this.cache=r.concat([this.cache,e])},u.prototype.get=function(){if(this.cache.length>15){var e=this.cache.slice(0,16);return this.cache=this.cache.slice(16),e}return null},u.prototype.flush=function(){for(var e=16-this.cache.length,t=r.allocUnsafe(e),n=-1;++n<e;)t.writeUInt8(e,n);return r.concat([this.cache,t])},cs.createCipheriv=l,cs.createCipher=function(t,r){var n=e[t.toLowerCase()];if(!n)throw new TypeError("invalid suite type");var i=o(r,!1,n.key,n.iv);return l(t,i.key,i.iv)},cs}(),t=function(){if(io)return oo;io=1;var e=Xs(),t=ce().Buffer,r=Os(),n=eo(),i=Ys(),s=Qs(),o=no();function a(e,r,n){i.call(this),this._cache=new c,this._last=void 0,this._cipher=new s.AES(r),this._prev=t.from(n),this._mode=e,this._autopadding=!0}function c(){this.cache=t.allocUnsafe(0)}function u(i,s,o){var c=r[i.toLowerCase()];if(!c)throw new TypeError("invalid suite type");if("string"==typeof o&&(o=t.from(o)),"GCM"!==c.mode&&o.length!==c.iv)throw new TypeError("invalid iv length "+o.length);if("string"==typeof s&&(s=t.from(s)),s.length!==c.key/8)throw new TypeError("invalid key length "+s.length);return"stream"===c.type?new n(c.module,s,o,!0):"auth"===c.type?new e(c.module,s,o,!0):new a(c.module,s,o)}return fe()(a,i),a.prototype._update=function(e){var r,n;this._cache.add(e);for(var i=[];r=this._cache.get(this._autopadding);)n=this._mode.decrypt(this,r),i.push(n);return t.concat(i)},a.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return function(e){var t=e[15];if(t<1||t>16)throw new Error("unable to decrypt data");for(var r=-1;++r<t;)if(e[r+(16-t)]!==t)throw new Error("unable to decrypt data");if(16!==t)return e.slice(0,16-t)}(this._mode.decrypt(this,e));if(e)throw new Error("data not multiple of block length")},a.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},c.prototype.add=function(e){this.cache=t.concat([this.cache,e])},c.prototype.get=function(e){var t;if(e){if(this.cache.length>16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t}else if(this.cache.length>=16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t;return null},c.prototype.flush=function(){if(this.cache.length)return this.cache},oo.createDecipher=function(e,t){var n=r[e.toLowerCase()];if(!n)throw new TypeError("invalid suite type");var i=o(t,!1,n.key,n.iv);return u(e,i.key,i.iv)},oo.createDecipheriv=u,oo}(),r=xs;return as.createCipher=as.Cipher=e.createCipher,as.createCipheriv=as.Cipheriv=e.createCipheriv,as.createDecipher=as.Decipher=t.createDecipher,as.createDecipheriv=as.Decipheriv=t.createDecipheriv,as.listCiphers=as.getCiphers=function(){return Object.keys(r)},as}var co=ao(),uo=ns(Os());const lo=e=>(new TextDecoder).decode(e),ho=e=>(new TextEncoder).encode(e),fo=(e,t=!1)=>t?`0x${Buffer.from(e).toString("hex")}`:Buffer.from(e).toString("hex"),po=e=>{if(e.startsWith("0x")&&(e=e.slice(2)),e.length%2!=0)throw new Error(`Hex string length must be even, received: 0x${e}`);const t=Buffer.from(e,"hex");if(e.length!==2*t.length)throw new Error(`Hex string input is likely malformed, received: 0x${e}`);return t},go=(e,t)=>0===Buffer.compare(e,t);var mo,yo,bo,wo={},vo={};var Eo,Ao,So={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"};function ko(){if(Ao)return Eo;Ao=1;var e=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,t=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,r=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,n=no(),i=ao(),s=ce().Buffer;return Eo=function(o,a){var c,u=o.toString(),l=u.match(e);if(l){var d="aes"+l[1],h=s.from(l[2],"hex"),f=s.from(l[3].replace(/[\r\n]/g,""),"base64"),p=n(a,h.slice(0,8),parseInt(l[1],10)).key,g=[],m=i.createDecipheriv(d,p,h);g.push(m.update(f)),g.push(m.final()),c=s.concat(g)}else{var y=u.match(r);c=s.from(y[2].replace(/[\r\n]/g,""),"base64")}return{tag:u.match(t)[1],data:c}}}var Ro,Po,Io,Co,_o,To,No,xo,Oo,Do,Mo,Bo,Lo,Fo,Uo,jo,zo,qo={};function Ko(){if(Po)return Ro;Po=1;var e=Math.pow(2,30)-1;return Ro=function(t,r){if("number"!=typeof t)throw new TypeError("Iterations not a number");if(t<0)throw new TypeError("Bad iterations");if("number"!=typeof r)throw new TypeError("Key length not a number");if(r<0||r>e||r!=r)throw new TypeError("Bad key length")}}function Go(){return Co?Io:(Co=1,e=rs.process&&rs.process.browser?"utf-8":rs.process&&rs.process.version?parseInt(process.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary":"utf-8",Io=e);var e}function $o(){if(xo)return No;xo=1;var e=re.Buffer,t=fe(),r=to(),n=new Array(16),i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],s=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],o=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],a=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],c=[0,1518500249,1859775393,2400959708,2840853838],u=[1352829926,1548603684,1836072691,2053994217,0];function l(){r.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function d(e,t){return e<<t|e>>>32-t}function h(e,t,r,n,i,s,o,a){return d(e+(t^r^n)+s+o|0,a)+i|0}function f(e,t,r,n,i,s,o,a){return d(e+(t&r|~t&n)+s+o|0,a)+i|0}function p(e,t,r,n,i,s,o,a){return d(e+((t|~r)^n)+s+o|0,a)+i|0}function g(e,t,r,n,i,s,o,a){return d(e+(t&n|r&~n)+s+o|0,a)+i|0}function m(e,t,r,n,i,s,o,a){return d(e+(t^(r|~n))+s+o|0,a)+i|0}return t(l,r),l.prototype._update=function(){for(var e=n,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);for(var r=0|this._a,l=0|this._b,y=0|this._c,b=0|this._d,w=0|this._e,v=0|this._a,E=0|this._b,A=0|this._c,S=0|this._d,k=0|this._e,R=0;R<80;R+=1){var P,I;R<16?(P=h(r,l,y,b,w,e[i[R]],c[0],o[R]),I=m(v,E,A,S,k,e[s[R]],u[0],a[R])):R<32?(P=f(r,l,y,b,w,e[i[R]],c[1],o[R]),I=g(v,E,A,S,k,e[s[R]],u[1],a[R])):R<48?(P=p(r,l,y,b,w,e[i[R]],c[2],o[R]),I=p(v,E,A,S,k,e[s[R]],u[2],a[R])):R<64?(P=g(r,l,y,b,w,e[i[R]],c[3],o[R]),I=f(v,E,A,S,k,e[s[R]],u[3],a[R])):(P=m(r,l,y,b,w,e[i[R]],c[4],o[R]),I=h(v,E,A,S,k,e[s[R]],u[4],a[R])),r=w,w=b,b=d(y,10),y=l,l=P,v=k,k=S,S=d(A,10),A=E,E=I}var C=this._b+y+S|0;this._b=this._c+b+k|0,this._c=this._d+w+v|0,this._d=this._e+r+E|0,this._e=this._a+l+A|0,this._a=C},l.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var t=e.alloc?e.alloc(20):new e(20);return t.writeInt32LE(this._a,0),t.writeInt32LE(this._b,4),t.writeInt32LE(this._c,8),t.writeInt32LE(this._d,12),t.writeInt32LE(this._e,16),t},No=l}function Vo(){if(Do)return Oo;Do=1;var e=ce().Buffer;return Oo=function(t,r,n){if(e.isBuffer(t))return t;if("string"==typeof t)return e.from(t,r);if(ArrayBuffer.isView(t))return e.from(t.buffer);throw new TypeError(n+" must be a string, a Buffer, a typed array or a DataView")}}function Ho(){if(Bo)return Mo;Bo=1;var e=function(){if(To)return _o;To=1;var e=ro();return _o=function(t){return(new e).update(t).digest()},_o}(),t=$o(),r=Be(),n=ce().Buffer,i=Ko(),s=Go(),o=Vo(),a=n.alloc(128),c={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function u(i,s,o){var u=function(n){return"rmd160"===n||"ripemd160"===n?function(e){return(new t).update(e).digest()}:"md5"===n?e:function(e){return r(n).update(e).digest()}}(i),l="sha512"===i||"sha384"===i?128:64;s.length>l?s=u(s):s.length<l&&(s=n.concat([s,a],l));for(var d=n.allocUnsafe(l+c[i]),h=n.allocUnsafe(l+c[i]),f=0;f<l;f++)d[f]=54^s[f],h[f]=92^s[f];var p=n.allocUnsafe(l+o+4);d.copy(p,0,0,l),this.ipad1=p,this.ipad2=d,this.opad=h,this.alg=i,this.blocksize=l,this.hash=u,this.size=c[i]}return u.prototype.run=function(e,t){return e.copy(t,this.blocksize),this.hash(t).copy(this.opad,this.blocksize),this.hash(this.opad)},Mo=function(e,t,r,a,l){i(r,a);var d=new u(l=l||"sha1",e=o(e,s,"Password"),(t=o(t,s,"Salt")).length),h=n.allocUnsafe(a),f=n.allocUnsafe(t.length+4);t.copy(f,0,0,t.length);for(var p=0,g=c[l],m=Math.ceil(a/g),y=1;y<=m;y++){f.writeUInt32BE(y,t.length);for(var b=d.run(f,d.ipad1),w=b,v=1;v<r;v++){w=d.run(w,d.ipad2);for(var E=0;E<g;E++)b[E]^=w[E]}b.copy(h,p),p+=g}return h},Mo}function Wo(){if(zo)return jo;zo=1;var e=function(){if(bo)return vo;bo=1;var e=De();vo.certificate=function(){if(yo)return mo;yo=1;var e=De(),t=e.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),r=e.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),n=e.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),i=e.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(n),this.key("subjectPublicKey").bitstr())}),s=e.define("RelativeDistinguishedName",function(){this.setof(r)}),o=e.define("RDNSequence",function(){this.seqof(s)}),a=e.define("Name",function(){this.choice({rdnSequence:this.use(o)})}),c=e.define("Validity",function(){this.seq().obj(this.key("notBefore").use(t),this.key("notAfter").use(t))}),u=e.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),l=e.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(n),this.key("issuer").use(a),this.key("validity").use(c),this.key("subject").use(a),this.key("subjectPublicKeyInfo").use(i),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(u).optional())}),d=e.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(l),this.key("signatureAlgorithm").use(n),this.key("signatureValue").bitstr())});return mo=d}();var t=e.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});vo.RSAPrivateKey=t;var r=e.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});vo.RSAPublicKey=r;var n=e.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),i=e.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(n),this.key("subjectPublicKey").bitstr())});vo.PublicKey=i;var s=e.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(n),this.key("subjectPrivateKey").octstr())});vo.PrivateKey=s;var o=e.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});vo.EncryptedPrivateKey=o;var a=e.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});vo.DSAPrivateKey=a,vo.DSAparam=e.define("DSAparam",function(){this.int()});var c=e.define("ECParameters",function(){this.choice({namedCurve:this.objid()})}),u=e.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(c),this.key("publicKey").optional().explicit(1).bitstr())});return vo.ECPrivateKey=u,vo.signature=e.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())}),vo}(),t=So,r=ko(),n=ao(),i=(Uo||(Uo=1,qo.pbkdf2=function(){if(Fo)return Lo;Fo=1;var e,t,r=ce().Buffer,n=Ko(),i=Go(),s=Ho(),o=Vo(),a=rs.crypto&&rs.crypto.subtle,c={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},u=[];function l(){return t||(t=rs.process&&rs.process.nextTick?rs.process.nextTick:rs.queueMicrotask?rs.queueMicrotask:rs.setImmediate?rs.setImmediate:rs.setTimeout)}function d(e,t,n,i,s){return a.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return a.deriveBits({name:"PBKDF2",salt:t,iterations:n,hash:{name:s}},e,i<<3)}).then(function(e){return r.from(e)})}return Lo=function(t,h,f,p,g,m){"function"==typeof g&&(m=g,g=void 0);var y=c[(g=g||"sha1").toLowerCase()];if(y&&"function"==typeof rs.Promise){if(n(f,p),t=o(t,i,"Password"),h=o(h,i,"Salt"),"function"!=typeof m)throw new Error("No callback provided to pbkdf2");!function(e,t){e.then(function(e){l()(function(){t(null,e)})},function(e){l()(function(){t(e)})})}(function(t){if(rs.process&&!rs.process.browser)return Promise.resolve(!1);if(!a||!a.importKey||!a.deriveBits)return Promise.resolve(!1);if(void 0!==u[t])return u[t];var n=d(e=e||r.alloc(8),e,10,128,t).then(function(){return!0}).catch(function(){return!1});return u[t]=n,n}(y).then(function(e){return e?d(t,h,f,p,y):s(t,h,f,p,g)}),m)}else l()(function(){var e;try{e=s(t,h,f,p,g)}catch(e){return m(e)}m(null,e)})},Lo}(),qo.pbkdf2Sync=Ho()),qo),s=ce().Buffer;function o(o){var a;"object"!=typeof o||s.isBuffer(o)||(a=o.passphrase,o=o.key),"string"==typeof o&&(o=s.from(o));var c,u,l=r(o,a),d=l.tag,h=l.data;switch(d){case"CERTIFICATE":u=e.certificate.decode(h,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(u||(u=e.PublicKey.decode(h,"der")),c=u.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return e.RSAPublicKey.decode(u.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return u.subjectPrivateKey=u.subjectPublicKey,{type:"ec",data:u};case"1.2.840.10040.4.1":return u.algorithm.params.pub_key=e.DSAparam.decode(u.subjectPublicKey.data,"der"),{type:"dsa",data:u.algorithm.params};default:throw new Error("unknown key id "+c)}case"ENCRYPTED PRIVATE KEY":h=function(e,r){var o=e.algorithm.decrypt.kde.kdeparams.salt,a=parseInt(e.algorithm.decrypt.kde.kdeparams.iters.toString(),10),c=t[e.algorithm.decrypt.cipher.algo.join(".")],u=e.algorithm.decrypt.cipher.iv,l=e.subjectPrivateKey,d=parseInt(c.split("-")[1],10)/8,h=i.pbkdf2Sync(r,o,a,d,"sha1"),f=n.createDecipheriv(c,h,u),p=[];return p.push(f.update(l)),p.push(f.final()),s.concat(p)}(h=e.EncryptedPrivateKey.decode(h,"der"),a);case"PRIVATE KEY":switch(c=(u=e.PrivateKey.decode(h,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return e.RSAPrivateKey.decode(u.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:u.algorithm.curve,privateKey:e.ECPrivateKey.decode(u.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return u.algorithm.params.priv_key=e.DSAparam.decode(u.subjectPrivateKey,"der"),{type:"dsa",params:u.algorithm.params};default:throw new Error("unknown key id "+c)}case"RSA PUBLIC KEY":return e.RSAPublicKey.decode(h,"der");case"RSA PRIVATE KEY":return e.RSAPrivateKey.decode(h,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:e.DSAPrivateKey.decode(h,"der")};case"EC PRIVATE KEY":return{curve:(h=e.ECPrivateKey.decode(h,"der")).parameters.value,privateKey:h.privateKey};default:throw new Error("unknown key type "+d)}}return o.signature=e.signature,jo=o}var Jo,Zo,Qo,Yo,Xo,ea,ta=is(Object.freeze({__proto__:null,default:Er}));function ra(){if(Zo)return Jo;Zo=1;var e=fe(),t=ro(),r=$o(),n=Be(),i=Ys();function s(e){i.call(this,"digest"),this._hash=e}return e(s,i),s.prototype._update=function(e){this._hash.update(e)},s.prototype._final=function(){return this._hash.digest()},Jo=function(e){return"md5"===(e=e.toLowerCase())?new t:"rmd160"===e||"ripemd160"===e?new r:new s(n(e))}}function na(){if(Yo)return Qo;Yo=1;var e=ra(),t=ce().Buffer;function r(e){var r=t.allocUnsafe(4);return r.writeUInt32BE(e,0),r}return Qo=function(n,i){for(var s,o=t.alloc(0),a=0;o.length<i;)s=r(a++),o=t.concat([o,e("sha1").update(n).update(s).digest()]);return o.slice(0,i)}}function ia(){return ea||(ea=1,Xo=function(e,t){for(var r=e.length,n=-1;++n<r;)e[n]^=t[n];return e}),Xo}var sa,oa,aa,ca,ua,la,da,ha,fa,pa,ga={exports:{}},ma=is(Object.freeze({__proto__:null,default:{}})),ya=ga.exports;function ba(){return sa||(sa=1,function(e){!function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function i(e,t,r){if(i.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var s;"object"==typeof e?e.exports=i:t.BN=i,i.BN=i,i.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:ma.Buffer}catch(e){}function o(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function a(e,t,r){var n=o(e,r);return r-1>=t&&(n|=o(e,r-1)<<4),n}function c(e,t,r,n){for(var i=0,s=Math.min(e.length,r),o=t;o<s;o++){var a=e.charCodeAt(o)-48;i*=n,i+=a>=49?a-49+10:a>=17?a-17+10:a}return i}i.isBN=function(e){return e instanceof i||null!==e&&"object"==typeof e&&e.constructor.wordSize===i.wordSize&&Array.isArray(e.words)},i.max=function(e,t){return e.cmp(t)>0?e:t},i.min=function(e,t){return e.cmp(t)<0?e:t},i.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},i.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},i.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var s,o,a=0;if("be"===n)for(i=e.length-1,s=0;i>=0;i-=3)o=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===n)for(i=0,s=0;i<e.length;i+=3)o=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},i.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,s=0,o=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=a(e,t,n)<<s,this.words[o]|=67108863&i,s>=18?(s-=18,o+=1,this.words[o]|=i>>>26):s+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=a(e,t,n)<<s,this.words[o]|=67108863&i,s>=18?(s-=18,o+=1,this.words[o]|=i>>>26):s+=8;this.strip()},i.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var s=e.length-r,o=s%n,a=Math.min(s,s-o)+r,u=0,l=r;l<a;l+=n)u=c(e,l,l+n,t),this.imuln(i),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==o){var d=1;for(u=c(e,l,e.length,t),l=0;l<o;l++)d*=t;this.imuln(d),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}this.strip()},i.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},i.prototype.clone=function(){var e=new i(null);return this.copy(e),e},i.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},i.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},i.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},i.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],s=0|t.words[0],o=i*s,a=67108863&o,c=o/67108864|0;r.words[0]=a;for(var u=1;u<n;u++){for(var l=c>>>26,d=67108863&c,h=Math.min(u,t.length-1),f=Math.max(0,u-e.length+1);f<=h;f++){var p=u-f|0;l+=(o=(i=0|e.words[p])*(s=0|t.words[f])+d)/67108864|0,d=67108863&o}r.words[u]=0|d,c=0|l}return 0!==c?r.words[u]=0|c:r.length--,r.strip()}i.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,s=0,o=0;o<this.length;o++){var a=this.words[o],c=(16777215&(a<<i|s)).toString(16);s=a>>>24-i&16777215,(i+=2)>=26&&(i-=26,o--),n=0!==s||o!==this.length-1?u[6-c.length]+c+n:c+n}for(0!==s&&(n=s.toString(16)+n);n.length%t!==0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var h=l[e],f=d[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var g=p.modn(f).toString(e);n=(p=p.idivn(f)).isZero()?g+n:u[h-g.length]+g+n}for(this.isZero()&&(n="0"+n);n.length%t!==0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},i.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},i.prototype.toJSON=function(){return this.toString(16)},i.prototype.toBuffer=function(e,t){return r(void 0!==s),this.toArrayLike(s,e,t)},i.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},i.prototype.toArrayLike=function(e,t,n){var i=this.byteLength(),s=n||Math.max(1,i);r(i<=s,"byte array longer than desired length"),r(s>0,"Requested array length <= 0"),this.strip();var o,a,c="le"===t,u=new e(s),l=this.clone();if(c){for(a=0;!l.isZero();a++)o=l.andln(255),l.iushrn(8),u[a]=o;for(;a<s;a++)u[a]=0}else{for(a=0;a<s-i;a++)u[a]=0;for(a=0;!l.isZero();a++)o=l.andln(255),l.iushrn(8),u[s-a-1]=o}return u},Math.clz32?i.prototype._countBits=function(e){return 32-Math.clz32(e)}:i.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},i.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 8191&t||(r+=13,t>>>=13),127&t||(r+=7,t>>>=7),15&t||(r+=4,t>>>=4),3&t||(r+=2,t>>>=2),1&t||r++,r},i.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},i.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},i.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},i.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},i.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},i.prototype.isNeg=function(){return 0!==this.negative},i.prototype.neg=function(){return this.clone().ineg()},i.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},i.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},i.prototype.ior=function(e){return r(0===(this.negative|e.negative)),this.iuor(e)},i.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},i.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},i.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},i.prototype.iand=function(e){return r(0===(this.negative|e.negative)),this.iuand(e)},i.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},i.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},i.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},i.prototype.ixor=function(e){return r(0===(this.negative|e.negative)),this.iuxor(e)},i.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},i.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},i.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this.strip()},i.prototype.notn=function(e){return this.clone().inotn(e)},i.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this.strip()},i.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,s=0;s<n.length;s++)t=(0|r.words[s])+(0|n.words[s])+i,this.words[s]=67108863&t,i=t>>>26;for(;0!==i&&s<r.length;s++)t=(0|r.words[s])+i,this.words[s]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},i.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},i.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var s=0,o=0;o<n.length;o++)s=(t=(0|r.words[o])-(0|n.words[o])+s)>>26,this.words[o]=67108863&t;for(;0!==s&&o<r.length;o++)s=(t=(0|r.words[o])+s)>>26,this.words[o]=67108863&t;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},i.prototype.sub=function(e){return this.clone().isub(e)};var f=function(e,t,r){var n,i,s,o=e.words,a=t.words,c=r.words,u=0,l=0|o[0],d=8191&l,h=l>>>13,f=0|o[1],p=8191&f,g=f>>>13,m=0|o[2],y=8191&m,b=m>>>13,w=0|o[3],v=8191&w,E=w>>>13,A=0|o[4],S=8191&A,k=A>>>13,R=0|o[5],P=8191&R,I=R>>>13,C=0|o[6],_=8191&C,T=C>>>13,N=0|o[7],x=8191&N,O=N>>>13,D=0|o[8],M=8191&D,B=D>>>13,L=0|o[9],F=8191&L,U=L>>>13,j=0|a[0],z=8191&j,q=j>>>13,K=0|a[1],G=8191&K,$=K>>>13,V=0|a[2],H=8191&V,W=V>>>13,J=0|a[3],Z=8191&J,Q=J>>>13,Y=0|a[4],X=8191&Y,ee=Y>>>13,te=0|a[5],re=8191&te,ne=te>>>13,ie=0|a[6],se=8191&ie,oe=ie>>>13,ae=0|a[7],ce=8191&ae,ue=ae>>>13,le=0|a[8],de=8191&le,he=le>>>13,fe=0|a[9],pe=8191&fe,ge=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var me=(u+(n=Math.imul(d,z))|0)+((8191&(i=(i=Math.imul(d,q))+Math.imul(h,z)|0))<<13)|0;u=((s=Math.imul(h,q))+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(p,z),i=(i=Math.imul(p,q))+Math.imul(g,z)|0,s=Math.imul(g,q);var ye=(u+(n=n+Math.imul(d,G)|0)|0)+((8191&(i=(i=i+Math.imul(d,$)|0)+Math.imul(h,G)|0))<<13)|0;u=((s=s+Math.imul(h,$)|0)+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(y,z),i=(i=Math.imul(y,q))+Math.imul(b,z)|0,s=Math.imul(b,q),n=n+Math.imul(p,G)|0,i=(i=i+Math.imul(p,$)|0)+Math.imul(g,G)|0,s=s+Math.imul(g,$)|0;var be=(u+(n=n+Math.imul(d,H)|0)|0)+((8191&(i=(i=i+Math.imul(d,W)|0)+Math.imul(h,H)|0))<<13)|0;u=((s=s+Math.imul(h,W)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(v,z),i=(i=Math.imul(v,q))+Math.imul(E,z)|0,s=Math.imul(E,q),n=n+Math.imul(y,G)|0,i=(i=i+Math.imul(y,$)|0)+Math.imul(b,G)|0,s=s+Math.imul(b,$)|0,n=n+Math.imul(p,H)|0,i=(i=i+Math.imul(p,W)|0)+Math.imul(g,H)|0,s=s+Math.imul(g,W)|0;var we=(u+(n=n+Math.imul(d,Z)|0)|0)+((8191&(i=(i=i+Math.imul(d,Q)|0)+Math.imul(h,Z)|0))<<13)|0;u=((s=s+Math.imul(h,Q)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(S,z),i=(i=Math.imul(S,q))+Math.imul(k,z)|0,s=Math.imul(k,q),n=n+Math.imul(v,G)|0,i=(i=i+Math.imul(v,$)|0)+Math.imul(E,G)|0,s=s+Math.imul(E,$)|0,n=n+Math.imul(y,H)|0,i=(i=i+Math.imul(y,W)|0)+Math.imul(b,H)|0,s=s+Math.imul(b,W)|0,n=n+Math.imul(p,Z)|0,i=(i=i+Math.imul(p,Q)|0)+Math.imul(g,Z)|0,s=s+Math.imul(g,Q)|0;var ve=(u+(n=n+Math.imul(d,X)|0)|0)+((8191&(i=(i=i+Math.imul(d,ee)|0)+Math.imul(h,X)|0))<<13)|0;u=((s=s+Math.imul(h,ee)|0)+(i>>>13)|0)+(ve>>>26)|0,ve&=67108863,n=Math.imul(P,z),i=(i=Math.imul(P,q))+Math.imul(I,z)|0,s=Math.imul(I,q),n=n+Math.imul(S,G)|0,i=(i=i+Math.imul(S,$)|0)+Math.imul(k,G)|0,s=s+Math.imul(k,$)|0,n=n+Math.imul(v,H)|0,i=(i=i+Math.imul(v,W)|0)+Math.imul(E,H)|0,s=s+Math.imul(E,W)|0,n=n+Math.imul(y,Z)|0,i=(i=i+Math.imul(y,Q)|0)+Math.imul(b,Z)|0,s=s+Math.imul(b,Q)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(g,X)|0,s=s+Math.imul(g,ee)|0;var Ee=(u+(n=n+Math.imul(d,re)|0)|0)+((8191&(i=(i=i+Math.imul(d,ne)|0)+Math.imul(h,re)|0))<<13)|0;u=((s=s+Math.imul(h,ne)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(_,z),i=(i=Math.imul(_,q))+Math.imul(T,z)|0,s=Math.imul(T,q),n=n+Math.imul(P,G)|0,i=(i=i+Math.imul(P,$)|0)+Math.imul(I,G)|0,s=s+Math.imul(I,$)|0,n=n+Math.imul(S,H)|0,i=(i=i+Math.imul(S,W)|0)+Math.imul(k,H)|0,s=s+Math.imul(k,W)|0,n=n+Math.imul(v,Z)|0,i=(i=i+Math.imul(v,Q)|0)+Math.imul(E,Z)|0,s=s+Math.imul(E,Q)|0,n=n+Math.imul(y,X)|0,i=(i=i+Math.imul(y,ee)|0)+Math.imul(b,X)|0,s=s+Math.imul(b,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(g,re)|0,s=s+Math.imul(g,ne)|0;var Ae=(u+(n=n+Math.imul(d,se)|0)|0)+((8191&(i=(i=i+Math.imul(d,oe)|0)+Math.imul(h,se)|0))<<13)|0;u=((s=s+Math.imul(h,oe)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(x,z),i=(i=Math.imul(x,q))+Math.imul(O,z)|0,s=Math.imul(O,q),n=n+Math.imul(_,G)|0,i=(i=i+Math.imul(_,$)|0)+Math.imul(T,G)|0,s=s+Math.imul(T,$)|0,n=n+Math.imul(P,H)|0,i=(i=i+Math.imul(P,W)|0)+Math.imul(I,H)|0,s=s+Math.imul(I,W)|0,n=n+Math.imul(S,Z)|0,i=(i=i+Math.imul(S,Q)|0)+Math.imul(k,Z)|0,s=s+Math.imul(k,Q)|0,n=n+Math.imul(v,X)|0,i=(i=i+Math.imul(v,ee)|0)+Math.imul(E,X)|0,s=s+Math.imul(E,ee)|0,n=n+Math.imul(y,re)|0,i=(i=i+Math.imul(y,ne)|0)+Math.imul(b,re)|0,s=s+Math.imul(b,ne)|0,n=n+Math.imul(p,se)|0,i=(i=i+Math.imul(p,oe)|0)+Math.imul(g,se)|0,s=s+Math.imul(g,oe)|0;var Se=(u+(n=n+Math.imul(d,ce)|0)|0)+((8191&(i=(i=i+Math.imul(d,ue)|0)+Math.imul(h,ce)|0))<<13)|0;u=((s=s+Math.imul(h,ue)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(M,z),i=(i=Math.imul(M,q))+Math.imul(B,z)|0,s=Math.imul(B,q),n=n+Math.imul(x,G)|0,i=(i=i+Math.imul(x,$)|0)+Math.imul(O,G)|0,s=s+Math.imul(O,$)|0,n=n+Math.imul(_,H)|0,i=(i=i+Math.imul(_,W)|0)+Math.imul(T,H)|0,s=s+Math.imul(T,W)|0,n=n+Math.imul(P,Z)|0,i=(i=i+Math.imul(P,Q)|0)+Math.imul(I,Z)|0,s=s+Math.imul(I,Q)|0,n=n+Math.imul(S,X)|0,i=(i=i+Math.imul(S,ee)|0)+Math.imul(k,X)|0,s=s+Math.imul(k,ee)|0,n=n+Math.imul(v,re)|0,i=(i=i+Math.imul(v,ne)|0)+Math.imul(E,re)|0,s=s+Math.imul(E,ne)|0,n=n+Math.imul(y,se)|0,i=(i=i+Math.imul(y,oe)|0)+Math.imul(b,se)|0,s=s+Math.imul(b,oe)|0,n=n+Math.imul(p,ce)|0,i=(i=i+Math.imul(p,ue)|0)+Math.imul(g,ce)|0,s=s+Math.imul(g,ue)|0;var ke=(u+(n=n+Math.imul(d,de)|0)|0)+((8191&(i=(i=i+Math.imul(d,he)|0)+Math.imul(h,de)|0))<<13)|0;u=((s=s+Math.imul(h,he)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(F,z),i=(i=Math.imul(F,q))+Math.imul(U,z)|0,s=Math.imul(U,q),n=n+Math.imul(M,G)|0,i=(i=i+Math.imul(M,$)|0)+Math.imul(B,G)|0,s=s+Math.imul(B,$)|0,n=n+Math.imul(x,H)|0,i=(i=i+Math.imul(x,W)|0)+Math.imul(O,H)|0,s=s+Math.imul(O,W)|0,n=n+Math.imul(_,Z)|0,i=(i=i+Math.imul(_,Q)|0)+Math.imul(T,Z)|0,s=s+Math.imul(T,Q)|0,n=n+Math.imul(P,X)|0,i=(i=i+Math.imul(P,ee)|0)+Math.imul(I,X)|0,s=s+Math.imul(I,ee)|0,n=n+Math.imul(S,re)|0,i=(i=i+Math.imul(S,ne)|0)+Math.imul(k,re)|0,s=s+Math.imul(k,ne)|0,n=n+Math.imul(v,se)|0,i=(i=i+Math.imul(v,oe)|0)+Math.imul(E,se)|0,s=s+Math.imul(E,oe)|0,n=n+Math.imul(y,ce)|0,i=(i=i+Math.imul(y,ue)|0)+Math.imul(b,ce)|0,s=s+Math.imul(b,ue)|0,n=n+Math.imul(p,de)|0,i=(i=i+Math.imul(p,he)|0)+Math.imul(g,de)|0,s=s+Math.imul(g,he)|0;var Re=(u+(n=n+Math.imul(d,pe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ge)|0)+Math.imul(h,pe)|0))<<13)|0;u=((s=s+Math.imul(h,ge)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(F,G),i=(i=Math.imul(F,$))+Math.imul(U,G)|0,s=Math.imul(U,$),n=n+Math.imul(M,H)|0,i=(i=i+Math.imul(M,W)|0)+Math.imul(B,H)|0,s=s+Math.imul(B,W)|0,n=n+Math.imul(x,Z)|0,i=(i=i+Math.imul(x,Q)|0)+Math.imul(O,Z)|0,s=s+Math.imul(O,Q)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,ee)|0)+Math.imul(T,X)|0,s=s+Math.imul(T,ee)|0,n=n+Math.imul(P,re)|0,i=(i=i+Math.imul(P,ne)|0)+Math.imul(I,re)|0,s=s+Math.imul(I,ne)|0,n=n+Math.imul(S,se)|0,i=(i=i+Math.imul(S,oe)|0)+Math.imul(k,se)|0,s=s+Math.imul(k,oe)|0,n=n+Math.imul(v,ce)|0,i=(i=i+Math.imul(v,ue)|0)+Math.imul(E,ce)|0,s=s+Math.imul(E,ue)|0,n=n+Math.imul(y,de)|0,i=(i=i+Math.imul(y,he)|0)+Math.imul(b,de)|0,s=s+Math.imul(b,he)|0;var Pe=(u+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ge)|0)+Math.imul(g,pe)|0))<<13)|0;u=((s=s+Math.imul(g,ge)|0)+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,n=Math.imul(F,H),i=(i=Math.imul(F,W))+Math.imul(U,H)|0,s=Math.imul(U,W),n=n+Math.imul(M,Z)|0,i=(i=i+Math.imul(M,Q)|0)+Math.imul(B,Z)|0,s=s+Math.imul(B,Q)|0,n=n+Math.imul(x,X)|0,i=(i=i+Math.imul(x,ee)|0)+Math.imul(O,X)|0,s=s+Math.imul(O,ee)|0,n=n+Math.imul(_,re)|0,i=(i=i+Math.imul(_,ne)|0)+Math.imul(T,re)|0,s=s+Math.imul(T,ne)|0,n=n+Math.imul(P,se)|0,i=(i=i+Math.imul(P,oe)|0)+Math.imul(I,se)|0,s=s+Math.imul(I,oe)|0,n=n+Math.imul(S,ce)|0,i=(i=i+Math.imul(S,ue)|0)+Math.imul(k,ce)|0,s=s+Math.imul(k,ue)|0,n=n+Math.imul(v,de)|0,i=(i=i+Math.imul(v,he)|0)+Math.imul(E,de)|0,s=s+Math.imul(E,he)|0;var Ie=(u+(n=n+Math.imul(y,pe)|0)|0)+((8191&(i=(i=i+Math.imul(y,ge)|0)+Math.imul(b,pe)|0))<<13)|0;u=((s=s+Math.imul(b,ge)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(F,Z),i=(i=Math.imul(F,Q))+Math.imul(U,Z)|0,s=Math.imul(U,Q),n=n+Math.imul(M,X)|0,i=(i=i+Math.imul(M,ee)|0)+Math.imul(B,X)|0,s=s+Math.imul(B,ee)|0,n=n+Math.imul(x,re)|0,i=(i=i+Math.imul(x,ne)|0)+Math.imul(O,re)|0,s=s+Math.imul(O,ne)|0,n=n+Math.imul(_,se)|0,i=(i=i+Math.imul(_,oe)|0)+Math.imul(T,se)|0,s=s+Math.imul(T,oe)|0,n=n+Math.imul(P,ce)|0,i=(i=i+Math.imul(P,ue)|0)+Math.imul(I,ce)|0,s=s+Math.imul(I,ue)|0,n=n+Math.imul(S,de)|0,i=(i=i+Math.imul(S,he)|0)+Math.imul(k,de)|0,s=s+Math.imul(k,he)|0;var Ce=(u+(n=n+Math.imul(v,pe)|0)|0)+((8191&(i=(i=i+Math.imul(v,ge)|0)+Math.imul(E,pe)|0))<<13)|0;u=((s=s+Math.imul(E,ge)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(F,X),i=(i=Math.imul(F,ee))+Math.imul(U,X)|0,s=Math.imul(U,ee),n=n+Math.imul(M,re)|0,i=(i=i+Math.imul(M,ne)|0)+Math.imul(B,re)|0,s=s+Math.imul(B,ne)|0,n=n+Math.imul(x,se)|0,i=(i=i+Math.imul(x,oe)|0)+Math.imul(O,se)|0,s=s+Math.imul(O,oe)|0,n=n+Math.imul(_,ce)|0,i=(i=i+Math.imul(_,ue)|0)+Math.imul(T,ce)|0,s=s+Math.imul(T,ue)|0,n=n+Math.imul(P,de)|0,i=(i=i+Math.imul(P,he)|0)+Math.imul(I,de)|0,s=s+Math.imul(I,he)|0;var _e=(u+(n=n+Math.imul(S,pe)|0)|0)+((8191&(i=(i=i+Math.imul(S,ge)|0)+Math.imul(k,pe)|0))<<13)|0;u=((s=s+Math.imul(k,ge)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(F,re),i=(i=Math.imul(F,ne))+Math.imul(U,re)|0,s=Math.imul(U,ne),n=n+Math.imul(M,se)|0,i=(i=i+Math.imul(M,oe)|0)+Math.imul(B,se)|0,s=s+Math.imul(B,oe)|0,n=n+Math.imul(x,ce)|0,i=(i=i+Math.imul(x,ue)|0)+Math.imul(O,ce)|0,s=s+Math.imul(O,ue)|0,n=n+Math.imul(_,de)|0,i=(i=i+Math.imul(_,he)|0)+Math.imul(T,de)|0,s=s+Math.imul(T,he)|0;var Te=(u+(n=n+Math.imul(P,pe)|0)|0)+((8191&(i=(i=i+Math.imul(P,ge)|0)+Math.imul(I,pe)|0))<<13)|0;u=((s=s+Math.imul(I,ge)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(F,se),i=(i=Math.imul(F,oe))+Math.imul(U,se)|0,s=Math.imul(U,oe),n=n+Math.imul(M,ce)|0,i=(i=i+Math.imul(M,ue)|0)+Math.imul(B,ce)|0,s=s+Math.imul(B,ue)|0,n=n+Math.imul(x,de)|0,i=(i=i+Math.imul(x,he)|0)+Math.imul(O,de)|0,s=s+Math.imul(O,he)|0;var Ne=(u+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,ge)|0)+Math.imul(T,pe)|0))<<13)|0;u=((s=s+Math.imul(T,ge)|0)+(i>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,n=Math.imul(F,ce),i=(i=Math.imul(F,ue))+Math.imul(U,ce)|0,s=Math.imul(U,ue),n=n+Math.imul(M,de)|0,i=(i=i+Math.imul(M,he)|0)+Math.imul(B,de)|0,s=s+Math.imul(B,he)|0;var xe=(u+(n=n+Math.imul(x,pe)|0)|0)+((8191&(i=(i=i+Math.imul(x,ge)|0)+Math.imul(O,pe)|0))<<13)|0;u=((s=s+Math.imul(O,ge)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(F,de),i=(i=Math.imul(F,he))+Math.imul(U,de)|0,s=Math.imul(U,he);var Oe=(u+(n=n+Math.imul(M,pe)|0)|0)+((8191&(i=(i=i+Math.imul(M,ge)|0)+Math.imul(B,pe)|0))<<13)|0;u=((s=s+Math.imul(B,ge)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863;var De=(u+(n=Math.imul(F,pe))|0)+((8191&(i=(i=Math.imul(F,ge))+Math.imul(U,pe)|0))<<13)|0;return u=((s=Math.imul(U,ge))+(i>>>13)|0)+(De>>>26)|0,De&=67108863,c[0]=me,c[1]=ye,c[2]=be,c[3]=we,c[4]=ve,c[5]=Ee,c[6]=Ae,c[7]=Se,c[8]=ke,c[9]=Re,c[10]=Pe,c[11]=Ie,c[12]=Ce,c[13]=_e,c[14]=Te,c[15]=Ne,c[16]=xe,c[17]=Oe,c[18]=De,0!==u&&(c[19]=u,r.length++),r};function p(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(f=h),i.prototype.mulTo=function(e,t){var r,n=this.length+e.length;return r=10===this.length&&10===e.length?f(this,e,t):n<63?h(this,e,t):n<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,s=0;s<r.length-1;s++){var o=i;i=0;for(var a=67108863&n,c=Math.min(s,t.length-1),u=Math.max(0,s-e.length+1);u<=c;u++){var l=s-u,d=(0|e.words[l])*(0|t.words[u]),h=67108863&d;a=67108863&(h=h+a|0),i+=(o=(o=o+(d/67108864|0)|0)+(h>>>26)|0)>>>26,o&=67108863}r.words[s]=a,n=o,o=i}return 0!==n?r.words[s]=n:r.length--,r.strip()}(this,e,t):p(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=i.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},g.prototype.permute=function(e,t,r,n,i,s){for(var o=0;o<s;o++)n[o]=t[e[o]],i[o]=r[e[o]]},g.prototype.transform=function(e,t,r,n,i,s){this.permute(s,e,t,r,n,i);for(var o=1;o<i;o<<=1)for(var a=o<<1,c=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),l=0;l<i;l+=a)for(var d=c,h=u,f=0;f<o;f++){var p=r[l+f],g=n[l+f],m=r[l+f+o],y=n[l+f+o],b=d*m-h*y;y=d*y+h*m,m=b,r[l+f]=p+m,n[l+f]=g+y,r[l+f+o]=p-m,n[l+f+o]=g-y,f!==a&&(b=c*d-u*h,h=c*h+u*d,d=b)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},g.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},g.prototype.convert13b=function(e,t,n,i){for(var s=0,o=0;o<t;o++)s+=0|e[o],n[2*o]=8191&s,s>>>=13,n[2*o+1]=8191&s,s>>>=13;for(o=2*t;o<i;++o)n[o]=0;r(0===s),r(!(-8192&s))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),s=this.stub(n),o=new Array(n),a=new Array(n),c=new Array(n),u=new Array(n),l=new Array(n),d=new Array(n),h=r.words;h.length=n,this.convert13b(e.words,e.length,o,n),this.convert13b(t.words,t.length,u,n),this.transform(o,s,a,c,n,i),this.transform(u,s,l,d,n,i);for(var f=0;f<n;f++){var p=a[f]*l[f]-c[f]*d[f];c[f]=a[f]*d[f]+c[f]*l[f],a[f]=p}return this.conjugate(a,c,n),this.transform(a,c,h,s,n,i),this.conjugate(h,s,n),this.normalize13b(h,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},i.prototype.mul=function(e){var t=new i(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},i.prototype.mulf=function(e){var t=new i(null);return t.words=new Array(this.length+e.length),p(this,e,t)},i.prototype.imul=function(e){return this.clone().mulTo(e,this)},i.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,n=0;n<this.length;n++){var i=(0|this.words[n])*e,s=(67108863&i)+(67108863&t);t>>=26,t+=i/67108864|0,t+=s>>>26,this.words[n]=67108863&s}return 0!==t&&(this.words[n]=t,this.length++),this},i.prototype.muln=function(e){return this.clone().imuln(e)},i.prototype.sqr=function(){return this.mul(this)},i.prototype.isqr=function(){return this.imul(this.clone())},i.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}(e);if(0===t.length)return new i(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var s=r.sqr();n<t.length;n++,s=s.sqr())0!==t[n]&&(r=r.mul(s));return r},i.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,s=67108863>>>26-n<<26-n;if(0!==n){var o=0;for(t=0;t<this.length;t++){var a=this.words[t]&s,c=(0|this.words[t])-a<<n;this.words[t]=c|o,o=a>>>26-n}o&&(this.words[t]=o,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},i.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},i.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var s=e%26,o=Math.min((e-s)/26,this.length),a=67108863^67108863>>>s<<s,c=n;if(i-=o,i=Math.max(0,i),c){for(var u=0;u<o;u++)c.words[u]=this.words[u];c.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var l=0;for(u=this.length-1;u>=0&&(0!==l||u>=i);u--){var d=0|this.words[u];this.words[u]=l<<26-s|d>>>s,l=d&a}return c&&0!==l&&(c.words[c.length++]=l),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},i.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},i.prototype.shln=function(e){return this.clone().ishln(e)},i.prototype.ushln=function(e){return this.clone().iushln(e)},i.prototype.shrn=function(e){return this.clone().ishrn(e)},i.prototype.ushrn=function(e){return this.clone().iushrn(e)},i.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n||!(this.words[n]&i))},i.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this.strip()},i.prototype.maskn=function(e){return this.clone().imaskn(e)},i.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},i.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},i.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},i.prototype.addn=function(e){return this.clone().iaddn(e)},i.prototype.subn=function(e){return this.clone().isubn(e)},i.prototype.iabs=function(){return this.negative=0,this},i.prototype.abs=function(){return this.clone().iabs()},i.prototype._ishlnsubmul=function(e,t,n){var i,s,o=e.length+n;this._expand(o);var a=0;for(i=0;i<e.length;i++){s=(0|this.words[i+n])+a;var c=(0|e.words[i])*t;a=((s-=67108863&c)>>26)-(c/67108864|0),this.words[i+n]=67108863&s}for(;i<this.length-n;i++)a=(s=(0|this.words[i+n])+a)>>26,this.words[i+n]=67108863&s;if(0===a)return this.strip();for(r(-1===a),a=0,i=0;i<this.length;i++)a=(s=-(0|this.words[i])+a)>>26,this.words[i]=67108863&s;return this.negative=1,this.strip()},i.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),s=e,o=0|s.words[s.length-1];0!=(r=26-this._countBits(o))&&(s=s.ushln(r),n.iushln(r),o=0|s.words[s.length-1]);var a,c=n.length-s.length;if("mod"!==t){(a=new i(null)).length=c+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var l=n.clone()._ishlnsubmul(s,1,c);0===l.negative&&(n=l,a&&(a.words[c]=1));for(var d=c-1;d>=0;d--){var h=67108864*(0|n.words[s.length+d])+(0|n.words[s.length+d-1]);for(h=Math.min(h/o|0,67108863),n._ishlnsubmul(s,h,d);0!==n.negative;)h--,n.negative=0,n._ishlnsubmul(s,1,d),n.isZero()||(n.negative^=1);a&&(a.words[d]=h)}return a&&a.strip(),n.strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:a||null,mod:n}},i.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new i(0),mod:new i(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(s=a.div.neg()),"div"!==t&&(o=a.mod.neg(),n&&0!==o.negative&&o.iadd(e)),{div:s,mod:o}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(s=a.div.neg()),{div:s,mod:a.mod}):0!==(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(o=a.mod.neg(),n&&0!==o.negative&&o.isub(e)),{div:a.div,mod:o}):e.length>this.length||this.cmp(e)<0?{div:new i(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new i(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new i(this.modn(e.words[0]))}:this._wordDiv(e,t);var s,o,a},i.prototype.div=function(e){return this.divmod(e,"div",!1).div},i.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},i.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},i.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),s=r.cmp(n);return s<0||1===i&&0===s?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},i.prototype.modn=function(e){r(e<=67108863);for(var t=(1<<26)%e,n=0,i=this.length-1;i>=0;i--)n=(t*n+(0|this.words[i]))%e;return n},i.prototype.idivn=function(e){r(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var i=(0|this.words[n])+67108864*t;this.words[n]=i/e|0,t=i%e}return this.strip()},i.prototype.divn=function(e){return this.clone().idivn(e)},i.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s=new i(1),o=new i(0),a=new i(0),c=new i(1),u=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++u;for(var l=n.clone(),d=t.clone();!t.isZero();){for(var h=0,f=1;0===(t.words[0]&f)&&h<26;++h,f<<=1);if(h>0)for(t.iushrn(h);h-- >0;)(s.isOdd()||o.isOdd())&&(s.iadd(l),o.isub(d)),s.iushrn(1),o.iushrn(1);for(var p=0,g=1;0===(n.words[0]&g)&&p<26;++p,g<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(l),c.isub(d)),a.iushrn(1),c.iushrn(1);t.cmp(n)>=0?(t.isub(n),s.isub(a),o.isub(c)):(n.isub(t),a.isub(s),c.isub(o))}return{a,b:c,gcd:n.iushln(u)}},i.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s,o=new i(1),a=new i(0),c=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var u=0,l=1;0===(t.words[0]&l)&&u<26;++u,l<<=1);if(u>0)for(t.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);for(var d=0,h=1;0===(n.words[0]&h)&&d<26;++d,h<<=1);if(d>0)for(n.iushrn(d);d-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(n)>=0?(t.isub(n),o.isub(a)):(n.isub(t),a.isub(o))}return(s=0===t.cmpn(1)?o:a).cmpn(0)<0&&s.iadd(e),s},i.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var s=t;t=r,r=s}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},i.prototype.invm=function(e){return this.egcd(e).a.umod(e)},i.prototype.isEven=function(){return!(1&this.words[0])},i.prototype.isOdd=function(){return!(1&~this.words[0])},i.prototype.andln=function(e){return this.words[0]&e},i.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var s=i,o=n;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},i.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},i.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},i.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},i.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},i.prototype.gtn=function(e){return 1===this.cmpn(e)},i.prototype.gt=function(e){return 1===this.cmp(e)},i.prototype.gten=function(e){return this.cmpn(e)>=0},i.prototype.gte=function(e){return this.cmp(e)>=0},i.prototype.ltn=function(e){return-1===this.cmpn(e)},i.prototype.lt=function(e){return-1===this.cmp(e)},i.prototype.lten=function(e){return this.cmpn(e)<=0},i.prototype.lte=function(e){return this.cmp(e)<=0},i.prototype.eqn=function(e){return 0===this.cmpn(e)},i.prototype.eq=function(e){return 0===this.cmp(e)},i.red=function(e){return new A(e)},i.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},i.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},i.prototype._forceRed=function(e){return this.red=e,this},i.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},i.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},i.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},i.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},i.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},i.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},i.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},i.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},i.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},i.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},i.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},i.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},i.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},i.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var m={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new i(t,16),this.n=this.p.bitLength(),this.k=new i(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function v(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function E(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function A(e){if("string"==typeof e){var t=i._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function S(e){A.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new i(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new i(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},n(b,y),b.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var s=e.words[9];for(t.words[t.length++]=s&r,i=10;i<e.length;i++){var o=0|e.words[i];e.words[i-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,e.words[i-10]=s,0===s&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(w,y),n(v,y),n(E,y),E.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},i._prime=function(e){if(m[e])return m[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new w;else if("p192"===e)t=new v;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new E}return m[e]=t,t},A.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},A.prototype._verify2=function(e,t){r(0===(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},A.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},A.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},A.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},A.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},A.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},A.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},A.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},A.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},A.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},A.prototype.isqr=function(e){return this.imul(e,e.clone())},A.prototype.sqr=function(e){return this.mul(e,e)},A.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new i(1)).iushrn(2);return this.pow(e,n)}for(var s=this.m.subn(1),o=0;!s.isZero()&&0===s.andln(1);)o++,s.iushrn(1);r(!s.isZero());var a=new i(1).toRed(this),c=a.redNeg(),u=this.m.subn(1).iushrn(1),l=this.m.bitLength();for(l=new i(2*l*l).toRed(this);0!==this.pow(l,u).cmp(c);)l.redIAdd(c);for(var d=this.pow(l,s),h=this.pow(e,s.addn(1).iushrn(1)),f=this.pow(e,s),p=o;0!==f.cmp(a);){for(var g=f,m=0;0!==g.cmp(a);m++)g=g.redSqr();r(m<p);var y=this.pow(d,new i(1).iushln(p-m-1));h=h.redMul(y),d=y.redSqr(),f=f.redMul(d),p=m}return h},A.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},A.prototype.pow=function(e,t){if(t.isZero())return new i(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new i(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var s=r[0],o=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),n=t.length-1;n>=0;n--){for(var u=t.words[n],l=c-1;l>=0;l--){var d=u>>l&1;s!==r[0]&&(s=this.sqr(s)),0!==d||0!==o?(o<<=1,o|=d,(4===++a||0===n&&0===l)&&(s=this.mul(s,r[o]),a=0,o=0)):a=0}c=26}return s},A.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},A.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},i.mont=function(e){return new S(e)},n(S,A),S.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},S.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},S.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),s=i;return i.cmp(this.m)>=0?s=i.isub(this.m):i.cmpn(0)<0&&(s=i.iadd(this.m)),s._forceRed(this)},S.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new i(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=r.isub(n).iushrn(this.shift),o=s;return s.cmp(this.m)>=0?o=s.isub(this.m):s.cmpn(0)<0&&(o=s.iadd(this.m)),o._forceRed(this)},S.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,ya)}(ga)),ga.exports}function wa(){if(aa)return oa;aa=1;var e=ba(),t=ce().Buffer;return oa=function(r,n){return t.from(r.toRed(e.mont(n.modulus)).redPow(new e(n.publicExponent)).fromRed().toArray())}}function va(){if(ua)return ca;ua=1;var e=xr(),t=ta,r=ce().Buffer;function n(r){var n,i=r.modulus.byteLength();do{n=new e(t(i))}while(n.cmp(r.modulus)>=0||!n.umod(r.prime1)||!n.umod(r.prime2));return n}function i(t,i){var s=function(t){var r=n(t);return{blinder:r.toRed(e.mont(t.modulus)).redPow(new e(t.publicExponent)).fromRed(),unblinder:r.invm(t.modulus)}}(i),o=i.modulus.byteLength(),a=new e(t).mul(s.blinder).umod(i.modulus),c=a.toRed(e.mont(i.prime1)),u=a.toRed(e.mont(i.prime2)),l=i.coefficient,d=i.prime1,h=i.prime2,f=c.redPow(i.exponent1).fromRed(),p=u.redPow(i.exponent2).fromRed(),g=f.isub(p).imul(l).umod(d).imul(h);return p.iadd(g).imul(s.unblinder).umod(i.modulus).toArrayLike(r,"be",o)}return i.getr=n,ca=i}var Ea,Aa=(pa||(pa=1,(Ea=wo).publicEncrypt=function(){if(da)return la;da=1;var e=Wo(),t=ta,r=ra(),n=na(),i=ia(),s=ba(),o=wa(),a=va(),c=ce().Buffer;return la=function(u,l,d){var h;h=u.padding?u.padding:d?1:4;var f,p=e(u);if(4===h)f=function(e,o){var a=e.modulus.byteLength(),u=o.length,l=r("sha1").update(c.alloc(0)).digest(),d=l.length,h=2*d;if(u>a-h-2)throw new Error("message too long");var f=c.alloc(a-u-h-2),p=a-d-1,g=t(d),m=i(c.concat([l,f,c.alloc(1,1),o],p),n(g,p)),y=i(g,n(m,d));return new s(c.concat([c.alloc(1),y,m],a))}(p,l);else if(1===h)f=function(e,r,n){var i,o=r.length,a=e.modulus.byteLength();if(o>a-11)throw new Error("message too long");return i=n?c.alloc(a-o-3,255):function(e){for(var r,n=c.allocUnsafe(e),i=0,s=t(2*e),o=0;i<e;)o===s.length&&(s=t(2*e),o=0),(r=s[o++])&&(n[i++]=r);return n}(a-o-3),new s(c.concat([c.from([0,n?1:2]),i,c.alloc(1),r],a))}(p,l,d);else{if(3!==h)throw new Error("unknown padding");if((f=new s(l)).cmp(p.modulus)>=0)throw new Error("data too long for modulus")}return d?a(f,p):o(f,p)},la}(),Ea.privateDecrypt=function(){if(fa)return ha;fa=1;var e=Wo(),t=na(),r=ia(),n=ba(),i=va(),s=ra(),o=wa(),a=ce().Buffer;return ha=function(c,u,l){var d;d=c.padding?c.padding:l?1:4;var h,f=e(c),p=f.modulus.byteLength();if(u.length>p||new n(u).cmp(f.modulus)>=0)throw new Error("decryption error");h=l?o(new n(u),f):i(u,f);var g=a.alloc(p-h.length);if(h=a.concat([g,h],p),4===d)return function(e,n){var i=e.modulus.byteLength(),o=s("sha1").update(a.alloc(0)).digest(),c=o.length;if(0!==n[0])throw new Error("decryption error");var u=n.slice(1,c+1),l=n.slice(c+1),d=r(u,t(l,c)),h=r(l,t(d,i-c-1));if(function(e,t){e=a.from(e),t=a.from(t);var r=0,n=e.length;e.length!==t.length&&(r++,n=Math.min(e.length,t.length));for(var i=-1;++i<n;)r+=e[i]^t[i];return r}(o,h.slice(0,c)))throw new Error("decryption error");for(var f=c;0===h[f];)f++;if(1!==h[f++])throw new Error("decryption error");return h.slice(f)}(f,h);if(1===d)return function(e,t,r){for(var n=t.slice(0,2),i=2,s=0;0!==t[i++];)if(i>=t.length){s++;break}var o=t.slice(2,i-1);if(("0002"!==n.toString("hex")&&!r||"0001"!==n.toString("hex")&&r)&&s++,o.length<8&&s++,s)throw new Error("decryption error");return t.slice(i)}(0,h,l);if(3===d)return h;throw new Error("unknown padding")},ha}(),Ea.privateEncrypt=function(e,t){return Ea.publicEncrypt(e,t,!0)},Ea.publicDecrypt=function(e,t){return Ea.privateDecrypt(e,t,!0)}),wo);function Sa(){const{crypto:e}=globalThis;if(!e?.subtle)throw new Error("SubtleCrypto not supported. This feature is available only in secure contexts (HTTPS). https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto");return e.subtle}function ka(e){return Buffer.from(xe(ho(e)))}const Ra="undefined"!=typeof process&&process?.env?process.env:{},Pa=Object.assign(Ra,{DISABLE_PRETTY_LOG:"true"}),Ia=e=>{switch(e){case"true":return!0;case"false":return!1;case void 0:return;default:throw new Error("Invalid boolean value: ${value}")}};function Ca(){return Ia(Pa.DISABLE_PRETTY_LOG)??!1}function _a(e){return(t,r)=>{void 0!==r?e(r,t):e(t)}}class Ta{static NAME_LENGTH=25;static rootLogger;static getRootLogger(){return Ta.rootLogger??=Dr()({name:"rootLogger",enabled:!Pa.NOLOG,level:Pa.LOG_LEVEL??"info",formatters:{level:e=>({level:e})},transport:Ca()?void 0:{target:"pino-pretty",options:{colorize:Ia(Pa.LOG_COLORS)??!0,singleLine:!0,translateTime:'yyyy-mm-dd"T"HH:MM:ss.l',ignore:"pid,hostname",levelFirst:!0,sync:void 0!==Pa.JEST_WORKER_ID}},browser:{asObject:!0}}),Ta.rootLogger}logger;fatal;error;warn;info;debug;trace;constructor(e,t,r="info",n=Ta.getRootLogger()){this.logger=n.child({name:Ta.createName(e),...t},{level:Pa.LOG_LEVEL??r}),this.fatal=_a(this.logger.fatal.bind(this.logger)),this.error=_a(this.logger.error.bind(this.logger)),this.warn=_a(this.logger.warn.bind(this.logger)),this.info=_a(this.logger.info.bind(this.logger)),this.debug=_a(this.logger.debug.bind(this.logger)),this.trace=_a(this.logger.trace.bind(this.logger))}static createName(e){const t="string"==typeof e?e:String(e.id),r=Br().parse(t);let n=r.name;if("index"===n){const e=r.dir.split(Br().sep);n=e[e.length-1]}const i=Fr()([Pa.STREAMR_APPLICATION_ID,n],void 0).join(":");return Ca()?i:jr()(i.substring(0,this.NAME_LENGTH),this.NAME_LENGTH," ")}}const Na=(e,t)=>{const r=()=>{t?.aborted||e(r)};r()};class xa{metric;listener;constructor(e){this.metric=e,this.listener=e=>this.onRecord(e)}start(e){this.metric.on("record",this.listener)}stop(e){this.metric.off("record",this.listener)}}class Oa{latestValue;eventEmitter=new zr;samplerFactory;constructor(e,t){this.samplerFactory=e,this.latestValue=t}record(e){this.latestValue=e,this.eventEmitter.emit("record",e)}getLatestValue(){return this.latestValue}on(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}createSampler(){return this.samplerFactory(this)}}class Da extends xa{sum=0;onRecord(e){this.sum+=e}getAggregatedValue(){return this.sum}}class Ma extends Oa{constructor(){super(e=>new Da(e))}}class Ba extends xa{sum=0;count=0;onRecord(e){this.sum+=e,this.count++}getAggregatedValue(){return this.count>0?this.sum/this.count:void 0}}class La extends Ba{start(e){super.start(e);const t=this.metric.getLatestValue();void 0!==t&&this.onRecord(t)}}class Fa extends Oa{constructor(e){super(e=>new La(e),e)}}class Ua extends xa{sum=0;startTimestamp=void 0;stopTimestamp=void 0;start(e){super.start(e),this.startTimestamp=e}stop(e){super.stop(e),this.stopTimestamp=e}onRecord(e){this.sum+=e}getAggregatedValue(){if(void 0!==this.startTimestamp&&void 0!==this.stopTimestamp&&this.startTimestamp!==this.stopTimestamp){const e=(this.stopTimestamp-this.startTimestamp)/1e3;return this.sum/e}}}class ja extends Oa{constructor(){super(e=>new Ua(e))}}class za{metrics=new Map;addMetrics(e,t){Object.keys(t).forEach(r=>{const n=`${e}.${r}`;if(this.metrics.has(n))throw new Error(`Metrics "${n}" already created`);this.metrics.set(n,t[r])})}createReportProducer(e,t,r,n){const i=new Map;((e,t,r)=>{const n=Date.now();let i=n-n%t;Na(n=>{const s=Date.now();i+=t,s<i?Zi(async()=>{await e(i),n()},i-s,r):n()},r)})(async r=>{if(i.size>0){const s={period:{start:r-t,end:r}};i.forEach((e,t)=>{e.stop(r);const i=e.getAggregatedValue();void 0!==i&&Kr()(s,t,void 0!==n?n(i):i)}),e(s),i.clear()}this.metrics.forEach((e,t)=>{const n=e.createSampler();n.start(r),i.set(t,n)})},t,r)}getMetric(e){return this.metrics.get(e)}}function qa(e,t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"){let r="";for(let n=0;n<e;++n)r+=t[Math.floor(Math.random()*t.length)];return r}const Ka=async(e,t,r,n)=>{n.aborted||(r&&await e(),Na(r=>{Zi(async()=>{await e(),r()},t,n)},n))};function Ga(e,t){let r;return Ji(new Promise(t=>{r=setTimeout(t,e)}),t).finally(()=>{clearTimeout(r)})}class $a extends Error{code="TimeoutError";constructor(e,t){super(void 0===t?`timed out after ${e} ms`:`${t} (timed out after ${e} ms)`)}}const Va=(e,t,r,n)=>{let i;return Ji(Promise.race([e,new Promise((e,n)=>{i=setTimeout(()=>{n(new $a(t,r))},t)})]),n,r).finally(()=>{clearTimeout(i)})};async function Ha(e,t,r=5e3,n=()=>!0,i){let s;const o=new Promise(r=>{s=(...e)=>{n(...e)&&r(e)},e.on(t,s)});return Va(o,r,"waitForEvent",i).finally(()=>{e.off(t,s)})}async function Wa(e,t,r=5e3){const n=new AbortController,i=t.map(async t=>({winnerName:t,winnerArgs:await Ha(e,t,r,()=>!0,n.signal)}));let s;try{s=await Promise.race(i)}finally{n.abort(),await Promise.allSettled(i)}return s}function Ja(...e){const t=new AbortController;for(const r of e)if(r?.aborted)return t.abort(),Object.assign(t.signal,{destroy:()=>{}});function r(){for(const t of e)t?.removeEventListener("abort",i)}let n=!1;function i(){n||(n=!0,t.abort(),r())}for(const t of e)t?.addEventListener("abort",i,{once:!0});return Object.assign(t.signal,{destroy:r})}function Za(e,t,r){let n=`until: ${e?"aborted":"timed out"} before "${t.toString()}" became true`;throw r&&(n+=`\n${r()}`),new Error(n)}const Qa=async(e,t=5e3,r=100,n,i)=>{let s=n?.aborted??!1;s&&Za(s,e,i),n?.addEventListener("abort",()=>{s=!0},{once:!0});const o=Ja(AbortSignal.timeout(t),n);try{for(;;){if(await Ji(Promise.resolve(e()),o))return;await Ga(r,o)}}catch(t){throw t instanceof Wi&&Za(s,e,i),t}finally{o.destroy()}};class Ya{delegate=new zr;observer=new zr;on(e,t){this.delegate.on(e,t),this.observer.emit("addEventListener",e)}once(e,t){this.delegate.once(e,r=>{t(r),this.observer.emit("removeEventListener",e)}),this.observer.emit("addEventListener",e)}off(e,t){this.delegate.off(e,t),this.observer.emit("removeEventListener",e)}removeAllListeners(){const e=this.delegate.eventNames();this.delegate.removeAllListeners();for(const t of e)this.observer.emit("removeEventListener",t)}emit(e,t){this.delegate.emit(e,t)}getListenerCount(e){return this.delegate.listenerCount(e)}getObserver(){return this.observer}}const Xa=(e,t,r,n)=>{n.aborted||(e.on(t,r),n.addEventListener("abort",()=>{e.off(t,r)},{once:!0}))},ec=(...e)=>{const t={};return Hr()(t,...e,(e,t)=>$r()(t)?[...t]:void 0),t},tc=async(e,t)=>{if(void 0!==t&&t<=0)return[];const r=[];for await(const n of e)if(r.push(n),void 0!==t&&r.length>=t)break;return r};class rc{pending;constructor(e){e||this.close()}open(){this.clearPending()}close(){this.pending??=new Yi}isOpen(){return!this.pending}clearPending(){const{pending:e}=this;void 0!==e&&(this.pending=void 0,e.resolve(void 0))}async waitUntilOpen(){this.pending&&await this.pending}}class nc{requiredBlockNumber=0;indexingState;serverUrl;fetch;logger;constructor(e){this.serverUrl=e.serverUrl,this.fetch=e.fetch,this.logger=e.logger??new Ta("TheGraphClient"),this.indexingState=new sc(()=>this.getIndexBlockNumber(),e.indexTimeout??6e4,e.indexPollInterval??1e3,this.logger)}async queryEntity(e){return await this.indexingState.waitUntilIndexed(this.requiredBlockNumber),this.sendQuery(e)}async*queryEntities(e,t=e=>e[Object.keys(e)[0]],r=1e3){let n;await this.indexingState.waitUntilIndexed(this.requiredBlockNumber);do{const i=e(void 0!==n?n[n.length-1].id:"",r,this.requiredBlockNumber),s=t(await this.sendQuery(i));yield*s,n=s}while(n.length===r)}updateRequiredBlockNumber(e){this.requiredBlockNumber=Math.max(e,this.requiredBlockNumber)}async sendQuery(e){this.logger.trace("Send GraphQL query",{query:e});const t=await this.fetch(this.serverUrl,{method:"POST",headers:{"Content-Type":"application/json",accept:"*/*"},body:JSON.stringify(e)}),r=await t.text();let n;try{n=JSON.parse(r)}catch{throw new Error(`GraphQL query failed with "${r}"`)}if(this.logger.trace("Received GraphQL response",{resJson:n}),!n.data)throw n.errors&&n.errors.length>0?new Error("GraphQL query failed: "+JSON.stringify(n.errors.map(e=>e.message))):new Error("GraphQL query failed");return n.data}async getIndexBlockNumber(){return(await this.sendQuery({query:"{ _meta { block { number } } }"}))._meta.block.number}}class ic extends rc{blockNumber;constructor(e){super(!0),this.blockNumber=e}}class sc{blockNumber=0;gates=new Set;getCurrentBlockNumber;timeout;pollInterval;logger;constructor(e,t,r,n){this.getCurrentBlockNumber=async()=>{try{return await e()}catch(e){return void n.warn("Failed to get current block number",{reason:e instanceof Error?e.message:String(e)})}},this.timeout=t,this.pollInterval=r,this.logger=n}async waitUntilIndexed(e){if(e<=this.blockNumber)return;this.logger.debug("Wait until The Graph is synchronized",{blockNumber:this.blockNumber,blockTarget:e});const t=this.getOrCreateGate(e);try{await Va(t.waitUntilOpen(),this.timeout,`The Graph did not synchronize to block ${e}`)}catch(e){throw e instanceof $a&&this.gates.delete(t),e}}getOrCreateGate(e){const t=new ic(e);if(e>this.blockNumber){const e=this.gates.size>0;t.close(),this.gates.add(t),e||this.startPolling()}return t}async startPolling(){for(this.logger.trace("Start polling");this.gates.size>0;){const e=await this.getCurrentBlockNumber();void 0!==e&&e!==this.blockNumber&&(this.blockNumber=e,this.logger.trace("Polled",{blockNumber:this.blockNumber}),this.gates.forEach(e=>{e.blockNumber<=this.blockNumber&&(e.open(),this.gates.delete(e))})),this.gates.size>0&&await Ga(this.pollInterval)}this.logger.trace("Stop polling")}}class oc{items;compare;constructor(e){this.items=[],this.compare=e}push(e){const t=this.getItemIndex(e);this.items.splice(t,0,e)}pop(){return this.items.shift()}peek(){return this.isEmpty()?void 0:this.items[0]}contains(e){if(!this.isEmpty()){const t=this.getItemIndex(e);if(t!==this.items.length)return 0===this.compare(this.items[t],e)}return!1}isEmpty(){return 0===this.items.length}values(){return this.items}getItemIndex(e){if(this.isEmpty())return 0;{let t=0,r=this.items.length;for(;t<r;){const n=Math.floor((t+r)/2);this.compare(this.items[n],e)<0?t=n+1:r=n}return r}}}const ac=async e=>{try{return await e()}catch(e){if(new Ta("executeSafePromise").fatal("Assertion failure!",{message:e?.message,err:e}),"undefined"==typeof process||void 0===process.exit)throw new Error("executeSafePromise: Assertion failure!",{cause:e});process.exit(1)}};class cc extends ue.Transform{buffer=Buffer.alloc(0);constructor(){super({objectMode:!0})}_transform(e,t,r){this.buffer=Buffer.concat([this.buffer,e]),this.processStreamData(r)}_flush(e){this.processStreamData(e)}processStreamData(e){for(;this.buffer.length>=4;){const e=this.buffer.readUInt32BE(0);if(!(this.buffer.length>=e+4))break;{const t=this.buffer.subarray(4,e+4);this.push(t),this.buffer=this.buffer.subarray(e+4)}}e()}}const uc=e=>{const t=e.split(".").map(Number);return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0};class lc{delegate=new Map;getTtl;constructor(e){this.getTtl=e}set(e,t){const r=this.delegate.get(e);void 0!==r&&clearTimeout(r.timeout),this.delegate.set(e,{value:t,timeout:this.createTimeout(e,t)})}get(e){const t=this.delegate.get(e);return t?.value}has(e){return this.delegate.has(e)}delete(e){const t=this.delegate.get(e);void 0!==t&&(clearTimeout(t.timeout),this.delegate.delete(e))}clear(){this.delegate.forEach(e=>{clearTimeout(e.timeout)}),this.delegate.clear()}size(){return this.delegate.size}*values(){for(const e of this.delegate.values())yield e.value}forEach(e){this.delegate.forEach((t,r)=>{e(t.value,r)})}createTimeout(e,t){return setTimeout(()=>{this.delete(e)},this.getTtl(t))}}function dc(e,t){if(0===e.length)throw new Error("stream id may not be empty");const r=e.indexOf("/");if(-1===r)return e;if(0===r){if(void 0===t)throw new Error(`path-only format "${e}" provided without domain`);return t+e}return(Xi(n=e.substring(0,r))?function(e){if(Xi(e))return e.toLowerCase();throw new Error(`not a valid ENS name: "${e}"`)}(n):ts(n))+e.substring(r);var n}class hc{static isPathOnlyFormat(e){return e.startsWith("/")}static getDomain(e){const t=hc.getDomainAndPath(e);return t?.[0]}static getPath(e){const t=hc.getDomainAndPath(e);return t?.[1]}static getDomainAndPath(e){const t=e.indexOf("/");if(-1!==t)return[e.substring(0,t),e.substring(t)]}}function fc(e){if(!Number.isSafeInteger(e)||e<0||e>=100)throw new Error(`invalid streamPartition value: ${e}`)}function pc(e,t){return fc(t),`${e}#${t}`}class gc{static parse(e){const[t,r]=gc.parseRawElements(e);if(void 0===r)throw new Error(`invalid streamPartId string: ${e}`);return dc(t),fc(r),e}static getStreamID(e){return this.getStreamIDAndPartition(e)[0]}static getStreamPartition(e){return this.getStreamIDAndPartition(e)[1]}static getStreamIDAndPartition(e){return gc.parseRawElements(e)}static parseRawElements(e){const t=e.lastIndexOf("#");return-1===t||t===e.length-1?[e,void 0]:[e.substring(0,t),Number(e.substring(t+1))]}}const mc=/^0x[a-fA-F0-9]+$/,yc=e=>{if(e instanceof Uint8Array)return fo(e,!0);if(wc(e))return e.toLowerCase();throw new Error(`not a valid UserID: "${e}"`)},bc=e=>po(e),wc=e=>mc.test(e),vc=e=>42===e.length;class Ec{static getInstance(e){switch(e){case"ECDSA_SECP256K1_EVM":return new Ac;case"ECDSA_SECP256R1":return new Sc;case"ML_DSA_87":return new kc;default:throw new Error(`Unknown key pair type: ${e}`)}}}class Ac extends Ec{generateKeyPair(){const e=Er(32),t=Jr().publicKeyCreate(e,!1);return{publicKey:this.publicKeyToAddress(t),privateKey:e}}keccakHash(e,t=!0){const r=new Zr.vm(256);return r.update(t?Buffer.concat([Buffer.from("Ethereum Signed Message:\n"+e.length),e]):Buffer.from(e)),r.digest("binary")}recoverPublicKey(e,t){const r=Buffer.from(e),n=r.readUInt8(r.length-1)-27;return Jr().ecdsaRecover(r.subarray(0,r.length-1),n,this.keccakHash(t),!1,Buffer.alloc)}async createSignature(e,t){const r=this.keccakHash(e),n=Jr().ecdsaSign(r,t),i=Buffer.alloc(n.signature.length+1,Buffer.from(n.signature));return i.writeInt8(27+n.recid,i.length-1),i}publicKeyToAddress(e){if(65!==e.length)throw new Error(`Expected 65 bytes (an ECDSA uncompressed public key with header byte). Got length: ${e.length}`);const t=e.subarray(1,e.length),r=new Zr.vm(256);r.update(Buffer.from(t));const n=r.digest("binary");return n.subarray(12,n.length)}recoverSignerUserId(e,t){const r=this.recoverPublicKey(e,t);return this.publicKeyToAddress(r)}async verifySignature(e,t,r){try{const n=this.recoverSignerUserId(r,t);return go(n,e)}catch{return!1}}assertValidKeyPair(e,t){const r=Jr().publicKeyCreate(t,!1),n=this.publicKeyToAddress(r);if(!go(e,n))throw new Error(`Given private key is for a different address! Given: ${fo(e)}, Computed: ${fo(n)}`)}}class Sc extends Ec{generateKeyPair(e=!0){const t=Er(32);return{publicKey:this.getPublicKeyFromPrivateKey(t,e),privateKey:t}}isCompressedPublicKey(e){return 33===e.length}isUncompressedPublicKey(e){return 65===e.length}toBase64Url(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}getPublicKeyFromPrivateKey(e,t=!0){return Hi.getPublicKey(e,t)}getUncompressedPublicKey(e){if(this.isCompressedPublicKey(e))return Hi.ProjectivePoint.fromHex(e).toRawBytes(!1);if(this.isUncompressedPublicKey(e))return e;throw new Error(`Unexpected public key length: ${e.length}`)}privateKeyToJWK(e){const t=this.getPublicKeyFromPrivateKey(e,!1),r=t.subarray(1,33),n=t.subarray(33),i=Buffer.from(r).toString("base64"),s=Buffer.from(n).toString("base64"),o=Buffer.from(e).toString("base64");return{key_ops:["sign"],ext:!0,kty:"EC",x:this.toBase64Url(i),y:this.toBase64Url(s),crv:"P-256",d:this.toBase64Url(o)}}async createSignature(e,t){const r=Sa(),n=t instanceof Uint8Array?this.privateKeyToJWK(t):t,i=await r.importKey("jwk",n,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]),s=await r.sign({name:"ECDSA",hash:{name:"SHA-256"}},i,e);return new Uint8Array(s)}async publicKeyToCryptoKey(e){return Sa().importKey("raw",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"])}async verifySignature(e,t,r){let n;try{n=await this.publicKeyToCryptoKey(e)}catch(t){if(!this.isCompressedPublicKey(e))throw t;n=await this.publicKeyToCryptoKey(this.getUncompressedPublicKey(e))}return await Sa().verify({name:"ECDSA",hash:{name:"SHA-256"}},n,r,t)}assertValidKeyPair(e,t){if(32!==t.length)throw new Error("Expected a raw private key of 32 bytes. Maybe your key is in some encapsulating format?");if(!this.isCompressedPublicKey(e)&&!this.isUncompressedPublicKey(e))throw new Error("Expected a public key of either 33 bytes (compressed) or 65 bytes (uncompressed)!");const r=this.getPublicKeyFromPrivateKey(t,33===e.length);if(!go(r,e))throw new Error(`Given private key is for a different public key! Given: ${fo(e)}, Computed: ${fo(r)}`)}}class kc extends Ec{generateKeyPair(){const e=Er(32),t=An.keygen(e);return{privateKey:t.secretKey,publicKey:t.publicKey}}async createSignature(e,t,r){return An.sign(t,e,r)}async verifySignature(e,t,r){return An.verify(e,t,r)}assertValidKeyPair(e,t){const r=Buffer.from("data-to-sign"),n=An.sign(t,r);if(!An.verify(e,r,n))throw new Error("The given ML-DSA public key and private key don't match!")}}var Rc=r(8253),Pc=r.n(Rc),Ic=r(5620),Cc=r.n(Ic),_c=r(9723);const Tc="6.16.0";function Nc(e,t,r){const n=t.split("|").map(e=>e.trim());for(let r=0;r<n.length;r++)switch(t){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof e===t)return}const i=new Error(`invalid value for type ${t}`);throw i.code="INVALID_ARGUMENT",i.argument=`value.${r}`,i.value=e,i}async function xc(e){const t=Object.keys(e);return(await Promise.all(t.map(t=>Promise.resolve(e[t])))).reduce((e,r,n)=>(e[t[n]]=r,e),{})}function Oc(e,t,r){for(let n in t){let i=t[n];const s=r?r[n]:null;s&&Nc(i,s,n),Object.defineProperty(e,n,{enumerable:!0,value:i,writable:!1})}}function Dc(e,t){if(null==e)return"null";if(null==t&&(t=new Set),"object"==typeof e){if(t.has(e))return"[Circular]";t.add(e)}if(Array.isArray(e))return"[ "+e.map(e=>Dc(e,t)).join(", ")+" ]";if(e instanceof Uint8Array){const t="0123456789abcdef";let r="0x";for(let n=0;n<e.length;n++)r+=t[e[n]>>4],r+=t[15&e[n]];return r}if("object"==typeof e&&"function"==typeof e.toJSON)return Dc(e.toJSON(),t);switch(typeof e){case"boolean":case"number":case"symbol":return e.toString();case"bigint":return BigInt(e).toString();case"string":return JSON.stringify(e);case"object":{const r=Object.keys(e);return r.sort(),"{ "+r.map(r=>`${Dc(r,t)}: ${Dc(e[r],t)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function Mc(e,t){return e&&e.code===t}function Bc(e){return Mc(e,"CALL_EXCEPTION")}function Lc(e,t,r){let n,i=e;{const n=[];if(r){if("message"in r||"code"in r||"name"in r)throw new Error(`value will overwrite populated values: ${Dc(r)}`);for(const e in r){if("shortMessage"===e)continue;const t=r[e];n.push(e+"="+Dc(t))}}n.push(`code=${t}`),n.push(`version=${Tc}`),n.length&&(e+=" ("+n.join(", ")+")")}switch(t){case"INVALID_ARGUMENT":n=new TypeError(e);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":n=new RangeError(e);break;default:n=new Error(e)}return Oc(n,{code:t}),r&&Object.assign(n,r),null==n.shortMessage&&Oc(n,{shortMessage:i}),n}function Fc(e,t,r,n){if(!e)throw Lc(t,r,n)}function Uc(e,t,r,n){Fc(e,t,"INVALID_ARGUMENT",{argument:r,value:n})}function jc(e,t,r){null==r&&(r=""),r&&(r=": "+r),Fc(e>=t,"missing argument"+r,"MISSING_ARGUMENT",{count:e,expectedCount:t}),Fc(e<=t,"too many arguments"+r,"UNEXPECTED_ARGUMENT",{count:e,expectedCount:t})}const zc=["NFD","NFC","NFKD","NFKC"].reduce((e,t)=>{try{if("test"!=="test".normalize(t))throw new Error("bad");if("NFD"===t){if(String.fromCharCode(233).normalize("NFD")!==String.fromCharCode(101,769))throw new Error("broken")}e.push(t)}catch(e){}return e},[]);function qc(e){Fc(zc.indexOf(e)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:e}})}function Kc(e,t,r){if(null==r&&(r=""),e!==t){let e=r,t="new";r&&(e+=".",t+=" "+r),Fc(!1,`private constructor; use ${e}from* methods`,"UNSUPPORTED_OPERATION",{operation:t})}}function Gc(e,t,r){if(e instanceof Uint8Array)return r?new Uint8Array(e):e;if("string"==typeof e&&e.length%2==0&&e.match(/^0x[0-9a-f]*$/i)){const t=new Uint8Array((e.length-2)/2);let r=2;for(let n=0;n<t.length;n++)t[n]=parseInt(e.substring(r,r+2),16),r+=2;return t}Uc(!1,"invalid BytesLike value",t||"value",e)}function $c(e,t){return Gc(e,t,!1)}function Vc(e,t){return Gc(e,t,!0)}function Hc(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/)||"number"==typeof t&&e.length!==2+2*t||!0===t&&e.length%2!=0)}function Wc(e){return Hc(e,!0)||e instanceof Uint8Array}const Jc="0123456789abcdef";function Zc(e){const t=$c(e);let r="0x";for(let e=0;e<t.length;e++){const n=t[e];r+=Jc[(240&n)>>4]+Jc[15&n]}return r}function Qc(e){return"0x"+e.map(e=>Zc(e).substring(2)).join("")}function Yc(e){return Hc(e,!0)?(e.length-2)/2:$c(e).length}function Xc(e,t,r){const n=$c(e);return null!=r&&r>n.length&&Fc(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:n,length:n.length,offset:r}),Zc(n.slice(null==t?0:t,null==r?n.length:r))}function eu(e){let t=Zc(e).substring(2);for(;t.startsWith("00");)t=t.substring(2);return"0x"+t}function tu(e,t,r){const n=$c(e);Fc(t>=n.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(n),length:t,offset:t+1});const i=new Uint8Array(t);return i.fill(0),r?i.set(n,t-n.length):i.set(n,0),Zc(i)}function ru(e,t){return tu(e,t,!0)}function nu(e,t){return tu(e,t,!1)}const iu=BigInt(0),su=BigInt(1),ou=9007199254740991;function au(e,t){const r=du(e,"value"),n=BigInt(pu(t,"width"));return Fc(r>>n===iu,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:e}),r>>n-su?-((~r&(su<<n)-su)+su):r}function cu(e,t){let r=lu(e,"value");const n=BigInt(pu(t,"width")),i=su<<n-su;return r<iu?(r=-r,Fc(r<=i,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e}),(~r&(su<<n)-su)+su):(Fc(r<i,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e}),r)}function uu(e,t){const r=du(e,"value"),n=BigInt(pu(t,"bits"));return r&(su<<n)-su}function lu(e,t){switch(typeof e){case"bigint":return e;case"number":return Uc(Number.isInteger(e),"underflow",t||"value",e),Uc(e>=-ou&&e<=ou,"overflow",t||"value",e),BigInt(e);case"string":try{if(""===e)throw new Error("empty string");return"-"===e[0]&&"-"!==e[1]?-BigInt(e.substring(1)):BigInt(e)}catch(r){Uc(!1,`invalid BigNumberish string: ${r.message}`,t||"value",e)}}Uc(!1,"invalid BigNumberish value",t||"value",e)}function du(e,t){const r=lu(e,t);return Fc(r>=iu,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:e}),r}const hu="0123456789abcdef";function fu(e){if(e instanceof Uint8Array){let t="0x0";for(const r of e)t+=hu[r>>4],t+=hu[15&r];return BigInt(t)}return lu(e)}function pu(e,t){switch(typeof e){case"bigint":return Uc(e>=-ou&&e<=ou,"overflow",t||"value",e),Number(e);case"number":return Uc(Number.isInteger(e),"underflow",t||"value",e),Uc(e>=-ou&&e<=ou,"overflow",t||"value",e),e;case"string":try{if(""===e)throw new Error("empty string");return pu(BigInt(e),t)}catch(r){Uc(!1,`invalid numeric string: ${r.message}`,t||"value",e)}}Uc(!1,"invalid numeric value",t||"value",e)}function gu(e){return pu(fu(e))}function mu(e,t){const r=du(e,"value");let n=r.toString(16);if(null==t)n.length%2&&(n="0"+n);else{const i=pu(t,"width");if(0===i&&r===iu)return"0x";for(Fc(2*i>=n.length,`value exceeds width (${i} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:e});n.length<2*i;)n="0"+n}return"0x"+n}function yu(e,t){const r=du(e,"value");if(r===iu){const e=null!=t?pu(t,"width"):0;return new Uint8Array(e)}let n=r.toString(16);if(n.length%2&&(n="0"+n),null!=t){const r=pu(t,"width");for(;n.length<2*r;)n="00"+n;Fc(2*r===n.length,`value exceeds width (${r} bytes)`,"NUMERIC_FAULT",{operation:"toBeArray",fault:"overflow",value:e})}const i=new Uint8Array(n.length/2);for(let e=0;e<i.length;e++){const t=2*e;i[e]=parseInt(n.substring(t,t+2),16)}return i}function bu(e){let t=Zc(Wc(e)?e:yu(e)).substring(2);for(;t.startsWith("0");)t=t.substring(1);return""===t&&(t="0"),"0x"+t}const wu=32,vu=new Uint8Array(wu),Eu=["then"],Au={},Su=new WeakMap;function ku(e){return Su.get(e)}function Ru(e,t){Su.set(e,t)}function Pu(e,t){const r=new Error(`deferred error during ABI decoding triggered accessing ${e}`);throw r.error=t,r}function Iu(e,t,r){return e.indexOf(null)>=0?t.map((e,t)=>e instanceof Cu?Iu(ku(e),e,r):e):e.reduce((e,n,i)=>{let s=t.getValue(n);return n in e||(r&&s instanceof Cu&&(s=Iu(ku(s),s,r)),e[n]=s),e},{})}class Cu extends Array{#e;constructor(...e){const t=e[0];let r=e[1],n=(e[2]||[]).slice(),i=!0;t!==Au&&(r=e,n=[],i=!1),super(r.length),r.forEach((e,t)=>{this[t]=e});const s=n.reduce((e,t)=>("string"==typeof t&&e.set(t,(e.get(t)||0)+1),e),new Map);if(Ru(this,Object.freeze(r.map((e,t)=>{const r=n[t];return null!=r&&1===s.get(r)?r:null}))),this.#e=[],null==this.#e&&this.#e,!i)return;Object.freeze(this);const o=new Proxy(this,{get:(e,t,r)=>{if("string"==typeof t){if(t.match(/^[0-9]+$/)){const r=pu(t,"%index");if(r<0||r>=this.length)throw new RangeError("out of result range");const n=e[r];return n instanceof Error&&Pu(`index ${r}`,n),n}if(Eu.indexOf(t)>=0)return Reflect.get(e,t,r);const n=e[t];if(n instanceof Function)return function(...t){return n.apply(this===r?e:this,t)};if(!(t in e))return e.getValue.apply(this===r?e:this,[t])}return Reflect.get(e,t,r)}});return Ru(o,ku(this)),o}toArray(e){const t=[];return this.forEach((r,n)=>{r instanceof Error&&Pu(`index ${n}`,r),e&&r instanceof Cu&&(r=r.toArray(e)),t.push(r)}),t}toObject(e){const t=ku(this);return t.reduce((r,n,i)=>(Fc(null!=n,`value at index ${i} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),Iu(t,this,e)),{})}slice(e,t){null==e&&(e=0),e<0&&(e+=this.length)<0&&(e=0),null==t&&(t=this.length),t<0&&(t+=this.length)<0&&(t=0),t>this.length&&(t=this.length);const r=ku(this),n=[],i=[];for(let s=e;s<t;s++)n.push(this[s]),i.push(r[s]);return new Cu(Au,n,i)}filter(e,t){const r=ku(this),n=[],i=[];for(let s=0;s<this.length;s++){const o=this[s];o instanceof Error&&Pu(`index ${s}`,o),e.call(t,o,s,this)&&(n.push(o),i.push(r[s]))}return new Cu(Au,n,i)}map(e,t){const r=[];for(let n=0;n<this.length;n++){const i=this[n];i instanceof Error&&Pu(`index ${n}`,i),r.push(e.call(t,i,n,this))}return r}getValue(e){const t=ku(this).indexOf(e);if(-1===t)return;const r=this[t];return r instanceof Error&&Pu(`property ${JSON.stringify(e)}`,r.error),r}static fromItems(e,t){return new Cu(Au,e,t)}}function _u(e){const t=[],r=function(e,n){if(Array.isArray(n))for(let i in n){const s=e.slice();s.push(i);try{r(s,n[i])}catch(e){t.push({path:s,error:e})}}};return r([],e),t}function Tu(e){let t=yu(e);return Fc(t.length<=wu,"value out-of-bounds","BUFFER_OVERRUN",{buffer:t,length:wu,offset:t.length}),t.length!==wu&&(t=Vc(Qc([vu.slice(t.length%wu),t]))),t}class Nu{name;type;localName;dynamic;constructor(e,t,r,n){Oc(this,{name:e,type:t,localName:r,dynamic:n},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(e,t){Uc(!1,e,this.localName,t)}}class xu{#t;#r;constructor(){this.#t=[],this.#r=0}get data(){return Qc(this.#t)}get length(){return this.#r}#n(e){return this.#t.push(e),this.#r+=e.length,e.length}appendWriter(e){return this.#n(Vc(e.data))}writeBytes(e){let t=Vc(e);const r=t.length%wu;return r&&(t=Vc(Qc([t,vu.slice(r)]))),this.#n(t)}writeValue(e){return this.#n(Tu(e))}writeUpdatableValue(){const e=this.#t.length;return this.#t.push(vu),this.#r+=wu,t=>{this.#t[e]=Tu(t)}}}class Ou{allowLoose;#t;#i;#s;#o;#a;constructor(e,t,r){Oc(this,{allowLoose:!!t}),this.#t=Vc(e),this.#s=0,this.#o=null,this.#a=null!=r?r:1024,this.#i=0}get data(){return Zc(this.#t)}get dataLength(){return this.#t.length}get consumed(){return this.#i}get bytes(){return new Uint8Array(this.#t)}#c(e){if(this.#o)return this.#o.#c(e);this.#s+=e,Fc(this.#a<1||this.#s<=this.#a*this.dataLength,`compressed ABI data exceeds inflation ratio of ${this.#a} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:Vc(this.#t),offset:this.#i,length:e,info:{bytesRead:this.#s,dataLength:this.dataLength}})}#u(e,t,r){let n=Math.ceil(t/wu)*wu;return this.#i+n>this.#t.length&&(this.allowLoose&&r&&this.#i+t<=this.#t.length?n=t:Fc(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:Vc(this.#t),length:this.#t.length,offset:this.#i+n})),this.#t.slice(this.#i,this.#i+n)}subReader(e){const t=new Ou(this.#t.slice(this.#i+e),this.allowLoose,this.#a);return t.#o=this,t}readBytes(e,t){let r=this.#u(0,e,!!t);return this.#c(e),this.#i+=r.length,r.slice(0,e)}readValue(){return fu(this.readBytes(wu))}readIndex(){return gu(this.readBytes(wu))}}function Du(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Mu(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Bu(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Du(e.outputLen),Du(e.blockLen)}function Lu(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Fu(e,t){Mu(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const Uu=BigInt(2**32-1),ju=BigInt(32);function zu(e,t=!1){return t?{h:Number(e&Uu),l:Number(e>>ju&Uu)}:{h:0|Number(e>>ju&Uu),l:0|Number(e&Uu)}}function qu(e,t=!1){let r=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let i=0;i<e.length;i++){const{h:s,l:o}=zu(e[i],t);[r[i],n[i]]=[s,o]}return[r,n]}const Ku=(e,t,r)=>e<<r|t>>>32-r,Gu=(e,t,r)=>t<<r|e>>>32-r,$u=(e,t,r)=>t<<r-32|e>>>64-r,Vu=(e,t,r)=>e<<r-32|t>>>64-r,Hu={fromBig:zu,split:qu,toBig:(e,t)=>BigInt(e>>>0)<<ju|BigInt(t>>>0),shrSH:(e,t,r)=>e>>>r,shrSL:(e,t,r)=>e<<32-r|t>>>r,rotrSH:(e,t,r)=>e>>>r|t<<32-r,rotrSL:(e,t,r)=>e<<32-r|t>>>r,rotrBH:(e,t,r)=>e<<64-r|t>>>r-32,rotrBL:(e,t,r)=>e>>>r-32|t<<64-r,rotr32H:(e,t)=>t,rotr32L:(e,t)=>e,rotlSH:Ku,rotlSL:Gu,rotlBH:$u,rotlBL:Vu,add:function(e,t,r,n){const i=(t>>>0)+(n>>>0);return{h:e+r+(i/2**32|0)|0,l:0|i}},add3L:(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),add3H:(e,t,r,n)=>t+r+n+(e/2**32|0)|0,add4L:(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),add4H:(e,t,r,n,i)=>t+r+n+i+(e/2**32|0)|0,add5H:(e,t,r,n,i,s)=>t+r+n+i+s+(e/2**32|0)|0,add5L:(e,t,r,n,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(i>>>0)},Wu="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Ju=e=>e instanceof Uint8Array,Zu=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Qu=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Yu=(e,t)=>e<<32-t|e>>>t;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");const Xu=async()=>{};async function el(e,t,r){let n=Date.now();for(let i=0;i<e;i++){r(i);const e=Date.now()-n;e>=0&&e<t||(await Xu(),n+=e)}}function tl(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!Ju(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class rl{clone(){return this._cloneInto()}}const nl={}.toString;function il(e,t){if(void 0!==t&&"[object Object]"!==nl.call(t))throw new Error("Options should be object or undefined");return Object.assign(e,t)}function sl(e){const t=t=>e().update(tl(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function ol(e=32){if(Wu&&"function"==typeof Wu.getRandomValues)return Wu.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}const[al,cl,ul]=[[],[],[]],ll=BigInt(0),dl=BigInt(1),hl=BigInt(2),fl=BigInt(7),pl=BigInt(256),gl=BigInt(113);for(let e=0,t=dl,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],al.push(2*(5*n+r)),cl.push((e+1)*(e+2)/2%64);let i=ll;for(let e=0;e<7;e++)t=(t<<dl^(t>>fl)*gl)%pl,t&hl&&(i^=dl<<(dl<<BigInt(e))-dl);ul.push(i)}const[ml,yl]=qu(ul,!0),bl=(e,t,r)=>r>32?$u(e,t,r):Ku(e,t,r),wl=(e,t,r)=>r>32?Vu(e,t,r):Gu(e,t,r);class vl extends rl{constructor(e,t,r,n=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Du(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Zu(this.state)}keccak(){!function(e,t=24){const r=new Uint32Array(10);for(let n=24-t;n<24;n++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){const n=(t+8)%10,i=(t+2)%10,s=r[i],o=r[i+1],a=bl(s,o,1)^r[n],c=wl(s,o,1)^r[n+1];for(let r=0;r<50;r+=10)e[t+r]^=a,e[t+r+1]^=c}let t=e[2],i=e[3];for(let r=0;r<24;r++){const n=cl[r],s=bl(t,i,n),o=wl(t,i,n),a=al[r];t=e[a],i=e[a+1],e[a]=s,e[a+1]=o}for(let t=0;t<50;t+=10){for(let n=0;n<10;n++)r[n]=e[t+n];for(let n=0;n<10;n++)e[t+n]^=~r[(n+2)%10]&r[(n+4)%10]}e[0]^=ml[n],e[1]^=yl[n]}r.fill(0)}(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){Lu(this);const{blockLen:t,state:r}=this,n=(e=tl(e)).length;for(let i=0;i<n;){const s=Math.min(t-this.pos,n-i);for(let t=0;t<s;t++)r[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:n}=this;e[r]^=t,128&t&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Lu(this,!1),Mu(e),this.finish();const t=this.state,{blockLen:r}=this;for(let n=0,i=e.length;n<i;){this.posOut>=r&&this.keccak();const s=Math.min(r-this.posOut,i-n);e.set(t.subarray(this.posOut,this.posOut+s),n),this.posOut+=s,n+=s}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Du(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Fu(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:n,rounds:i,enableXOF:s}=this;return e||(e=new vl(t,r,n,s,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=r,e.outputLen=n,e.enableXOF=s,e.destroyed=this.destroyed,e}}const El=((e,t,r)=>sl(()=>new vl(t,e,r)))(1,136,32);let Al=!1;const Sl=function(e){return El(e)};let kl=Sl;function Rl(e){const t=$c(e,"data");return Zc(kl(t))}Rl._=Sl,Rl.lock=function(){Al=!0},Rl.register=function(e){if(Al)throw new TypeError("keccak256 is locked");kl=e},Object.freeze(Rl);const Pl=BigInt(0),Il=BigInt(36);function Cl(e){const t=(e=e.toLowerCase()).substring(2).split(""),r=new Uint8Array(40);for(let e=0;e<40;e++)r[e]=t[e].charCodeAt(0);const n=$c(Rl(r));for(let e=0;e<40;e+=2)n[e>>1]>>4>=8&&(t[e]=t[e].toUpperCase()),(15&n[e>>1])>=8&&(t[e+1]=t[e+1].toUpperCase());return"0x"+t.join("")}const _l={};for(let e=0;e<10;e++)_l[String(e)]=String(e);for(let e=0;e<26;e++)_l[String.fromCharCode(65+e)]=String(10+e);const Tl=15;function Nl(e){let t=(e=(e=e.toUpperCase()).substring(4)+e.substring(0,2)+"00").split("").map(e=>_l[e]).join("");for(;t.length>=Tl;){let e=t.substring(0,Tl);t=parseInt(e,10)%97+t.substring(e.length)}let r=String(98-parseInt(t,10)%97);for(;r.length<2;)r="0"+r;return r}const xl=function(){const e={};for(let t=0;t<36;t++)e["0123456789abcdefghijklmnopqrstuvwxyz"[t]]=BigInt(t);return e}();function Ol(e){if(Uc("string"==typeof e,"invalid address","address",e),e.match(/^(0x)?[0-9a-fA-F]{40}$/)){e.startsWith("0x")||(e="0x"+e);const t=Cl(e);return Uc(!e.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||t===e,"bad address checksum","address",e),t}if(e.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){Uc(e.substring(2,4)===Nl(e),"bad icap checksum","address",e);let t=function(e){e=e.toLowerCase();let t=Pl;for(let r=0;r<e.length;r++)t=t*Il+xl[e[r]];return t}(e.substring(4)).toString(16);for(;t.length<40;)t="0"+t;return Cl("0x"+t)}Uc(!1,"invalid address","address",e)}function Dl(e){let t=BigInt(Ol(e)).toString(36).toUpperCase();for(;t.length<30;)t="0"+t;return"XE"+Nl("XE00"+t)+t}const Ml={};function Bl(e,t){let r=!1;return t<0&&(r=!0,t*=-1),new Ul(Ml,`${r?"":"u"}int${t}`,e,{signed:r,width:t})}function Ll(e,t){return new Ul(Ml,`bytes${t||""}`,e,{size:t})}const Fl=Symbol.for("_ethers_typed");class Ul{type;value;#l;_typedSymbol;constructor(e,t,r,n){null==n&&(n=null),Kc(Ml,e,"Typed"),Oc(this,{_typedSymbol:Fl,type:t,value:r}),this.#l=n,this.format()}format(){if("array"===this.type)throw new Error("");if("dynamicArray"===this.type)throw new Error("");return"tuple"===this.type?`tuple(${this.value.map(e=>e.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return"string"===this.type}get tupleName(){if("tuple"!==this.type)throw TypeError("not a tuple");return this.#l}get arrayLength(){if("array"!==this.type)throw TypeError("not an array");return!0===this.#l?-1:!1===this.#l?this.value.length:null}static from(e,t){return new Ul(Ml,e,t)}static uint8(e){return Bl(e,8)}static uint16(e){return Bl(e,16)}static uint24(e){return Bl(e,24)}static uint32(e){return Bl(e,32)}static uint40(e){return Bl(e,40)}static uint48(e){return Bl(e,48)}static uint56(e){return Bl(e,56)}static uint64(e){return Bl(e,64)}static uint72(e){return Bl(e,72)}static uint80(e){return Bl(e,80)}static uint88(e){return Bl(e,88)}static uint96(e){return Bl(e,96)}static uint104(e){return Bl(e,104)}static uint112(e){return Bl(e,112)}static uint120(e){return Bl(e,120)}static uint128(e){return Bl(e,128)}static uint136(e){return Bl(e,136)}static uint144(e){return Bl(e,144)}static uint152(e){return Bl(e,152)}static uint160(e){return Bl(e,160)}static uint168(e){return Bl(e,168)}static uint176(e){return Bl(e,176)}static uint184(e){return Bl(e,184)}static uint192(e){return Bl(e,192)}static uint200(e){return Bl(e,200)}static uint208(e){return Bl(e,208)}static uint216(e){return Bl(e,216)}static uint224(e){return Bl(e,224)}static uint232(e){return Bl(e,232)}static uint240(e){return Bl(e,240)}static uint248(e){return Bl(e,248)}static uint256(e){return Bl(e,256)}static uint(e){return Bl(e,256)}static int8(e){return Bl(e,-8)}static int16(e){return Bl(e,-16)}static int24(e){return Bl(e,-24)}static int32(e){return Bl(e,-32)}static int40(e){return Bl(e,-40)}static int48(e){return Bl(e,-48)}static int56(e){return Bl(e,-56)}static int64(e){return Bl(e,-64)}static int72(e){return Bl(e,-72)}static int80(e){return Bl(e,-80)}static int88(e){return Bl(e,-88)}static int96(e){return Bl(e,-96)}static int104(e){return Bl(e,-104)}static int112(e){return Bl(e,-112)}static int120(e){return Bl(e,-120)}static int128(e){return Bl(e,-128)}static int136(e){return Bl(e,-136)}static int144(e){return Bl(e,-144)}static int152(e){return Bl(e,-152)}static int160(e){return Bl(e,-160)}static int168(e){return Bl(e,-168)}static int176(e){return Bl(e,-176)}static int184(e){return Bl(e,-184)}static int192(e){return Bl(e,-192)}static int200(e){return Bl(e,-200)}static int208(e){return Bl(e,-208)}static int216(e){return Bl(e,-216)}static int224(e){return Bl(e,-224)}static int232(e){return Bl(e,-232)}static int240(e){return Bl(e,-240)}static int248(e){return Bl(e,-248)}static int256(e){return Bl(e,-256)}static int(e){return Bl(e,-256)}static bytes1(e){return Ll(e,1)}static bytes2(e){return Ll(e,2)}static bytes3(e){return Ll(e,3)}static bytes4(e){return Ll(e,4)}static bytes5(e){return Ll(e,5)}static bytes6(e){return Ll(e,6)}static bytes7(e){return Ll(e,7)}static bytes8(e){return Ll(e,8)}static bytes9(e){return Ll(e,9)}static bytes10(e){return Ll(e,10)}static bytes11(e){return Ll(e,11)}static bytes12(e){return Ll(e,12)}static bytes13(e){return Ll(e,13)}static bytes14(e){return Ll(e,14)}static bytes15(e){return Ll(e,15)}static bytes16(e){return Ll(e,16)}static bytes17(e){return Ll(e,17)}static bytes18(e){return Ll(e,18)}static bytes19(e){return Ll(e,19)}static bytes20(e){return Ll(e,20)}static bytes21(e){return Ll(e,21)}static bytes22(e){return Ll(e,22)}static bytes23(e){return Ll(e,23)}static bytes24(e){return Ll(e,24)}static bytes25(e){return Ll(e,25)}static bytes26(e){return Ll(e,26)}static bytes27(e){return Ll(e,27)}static bytes28(e){return Ll(e,28)}static bytes29(e){return Ll(e,29)}static bytes30(e){return Ll(e,30)}static bytes31(e){return Ll(e,31)}static bytes32(e){return Ll(e,32)}static address(e){return new Ul(Ml,"address",e)}static bool(e){return new Ul(Ml,"bool",!!e)}static bytes(e){return new Ul(Ml,"bytes",e)}static string(e){return new Ul(Ml,"string",e)}static array(e,t){throw new Error("not implemented yet")}static tuple(e,t){throw new Error("not implemented yet")}static overrides(e){return new Ul(Ml,"overrides",Object.assign({},e))}static isTyped(e){return e&&"object"==typeof e&&"_typedSymbol"in e&&e._typedSymbol===Fl}static dereference(e,t){if(Ul.isTyped(e)){if(e.type!==t)throw new Error(`invalid type: expecetd ${t}, got ${e.type}`);return e.value}return e}}class jl extends Nu{constructor(e){super("address","address",e,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(e,t){let r=Ul.dereference(t,"string");try{r=Ol(r)}catch(e){return this._throwError(e.message,t)}return e.writeValue(r)}decode(e){return Ol(mu(e.readValue(),20))}}class zl extends Nu{coder;constructor(e){super(e.name,e.type,"_",e.dynamic),this.coder=e}defaultValue(){return this.coder.defaultValue()}encode(e,t){return this.coder.encode(e,t)}decode(e){return this.coder.decode(e)}}function ql(e,t,r){let n=[];if(Array.isArray(r))n=r;else if(r&&"object"==typeof r){let e={};n=t.map(t=>{const n=t.localName;return Fc(n,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:t},value:r}),Fc(!e[n],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:t},value:r}),e[n]=!0,r[n]})}else Uc(!1,"invalid tuple value","tuple",r);Uc(t.length===n.length,"types/value length mismatch","tuple",r);let i=new xu,s=new xu,o=[];t.forEach((e,t)=>{let r=n[t];if(e.dynamic){let t=s.length;e.encode(s,r);let n=i.writeUpdatableValue();o.push(e=>{n(e+t)})}else e.encode(i,r)}),o.forEach(e=>{e(i.length)});let a=e.appendWriter(i);return a+=e.appendWriter(s),a}function Kl(e,t){let r=[],n=[],i=e.subReader(0);return t.forEach(t=>{let s=null;if(t.dynamic){let r=e.readIndex(),n=i.subReader(r);try{s=t.decode(n)}catch(e){if(Mc(e,"BUFFER_OVERRUN"))throw e;s=e,s.baseType=t.name,s.name=t.localName,s.type=t.type}}else try{s=t.decode(e)}catch(e){if(Mc(e,"BUFFER_OVERRUN"))throw e;s=e,s.baseType=t.name,s.name=t.localName,s.type=t.type}if(null==s)throw new Error("investigate");r.push(s),n.push(t.localName||null)}),Cu.fromItems(r,n)}class Gl extends Nu{coder;length;constructor(e,t,r){super("array",e.type+"["+(t>=0?t:"")+"]",r,-1===t||e.dynamic),Oc(this,{coder:e,length:t})}defaultValue(){const e=this.coder.defaultValue(),t=[];for(let r=0;r<this.length;r++)t.push(e);return t}encode(e,t){const r=Ul.dereference(t,"array");Array.isArray(r)||this._throwError("expected array value",r);let n=this.length;-1===n&&(n=r.length,e.writeValue(r.length)),jc(r.length,n,"coder array"+(this.localName?" "+this.localName:""));let i=[];for(let e=0;e<r.length;e++)i.push(this.coder);return ql(e,i,r)}decode(e){let t=this.length;-1===t&&(t=e.readIndex(),Fc(t*wu<=e.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:e.bytes,offset:t*wu,length:e.dataLength}));let r=[];for(let e=0;e<t;e++)r.push(new zl(this.coder));return Kl(e,r)}}class $l extends Nu{constructor(e){super("bool","bool",e,!1)}defaultValue(){return!1}encode(e,t){const r=Ul.dereference(t,"bool");return e.writeValue(r?1:0)}decode(e){return!!e.readValue()}}class Vl extends Nu{constructor(e,t){super(e,e,t,!0)}defaultValue(){return"0x"}encode(e,t){t=Vc(t);let r=e.writeValue(t.length);return r+=e.writeBytes(t),r}decode(e){return e.readBytes(e.readIndex(),!0)}}class Hl extends Vl{constructor(e){super("bytes",e)}decode(e){return Zc(super.decode(e))}}class Wl extends Nu{size;constructor(e,t){let r="bytes"+String(e);super(r,r,t,!1),Oc(this,{size:e},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+2*this.size)}encode(e,t){let r=Vc(Ul.dereference(t,this.type));return r.length!==this.size&&this._throwError("incorrect data length",t),e.writeBytes(r)}decode(e){return Zc(e.readBytes(this.size))}}const Jl=new Uint8Array([]);class Zl extends Nu{constructor(e){super("null","",e,!1)}defaultValue(){return null}encode(e,t){return null!=t&&this._throwError("not null",t),e.writeBytes(Jl)}decode(e){return e.readBytes(0),null}}const Ql=BigInt(0),Yl=BigInt(1),Xl=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class ed extends Nu{size;signed;constructor(e,t,r){const n=(t?"int":"uint")+8*e;super(n,n,r,!1),Oc(this,{size:e,signed:t},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(e,t){let r=lu(Ul.dereference(t,this.type)),n=uu(Xl,256);if(this.signed){let e=uu(n,8*this.size-1);(r>e||r<-(e+Yl))&&this._throwError("value out-of-bounds",t),r=cu(r,256)}else(r<Ql||r>uu(n,8*this.size))&&this._throwError("value out-of-bounds",t);return e.writeValue(r)}decode(e){let t=uu(e.readValue(),8*this.size);return this.signed&&(t=au(t,8*this.size)),t}}function td(e,t,r,n,i){if("BAD_PREFIX"===e||"UNEXPECTED_CONTINUE"===e){let e=0;for(let n=t+1;n<r.length&&r[n]>>6==2;n++)e++;return e}return"OVERRUN"===e?r.length-t-1:0}const rd=Object.freeze({error:function(e,t,r,n,i){Uc(!1,`invalid codepoint at offset ${t}; ${e}`,"bytes",r)},ignore:td,replace:function(e,t,r,n,i){return"OVERLONG"===e?(Uc("number"==typeof i,"invalid bad code point for replacement","badCodepoint",i),n.push(i),0):(n.push(65533),td(e,t,r))}});function nd(e,t){null==t&&(t=rd.error);const r=$c(e,"bytes"),n=[];let i=0;for(;i<r.length;){const e=r[i++];if(!(e>>7)){n.push(e);continue}let s=null,o=null;if(192==(224&e))s=1,o=127;else if(224==(240&e))s=2,o=2047;else{if(240!=(248&e)){i+=t(128==(192&e)?"UNEXPECTED_CONTINUE":"BAD_PREFIX",i-1,r,n);continue}s=3,o=65535}if(i-1+s>=r.length){i+=t("OVERRUN",i-1,r,n);continue}let a=e&(1<<8-s-1)-1;for(let e=0;e<s;e++){let e=r[i];if(128!=(192&e)){i+=t("MISSING_CONTINUE",i,r,n),a=null;break}a=a<<6|63&e,i++}null!==a&&(a>1114111?i+=t("OUT_OF_RANGE",i-1-s,r,n,a):a>=55296&&a<=57343?i+=t("UTF16_SURROGATE",i-1-s,r,n,a):a<=o?i+=t("OVERLONG",i-1-s,r,n,a):n.push(a))}return n}function id(e,t){Uc("string"==typeof e,"invalid string value","str",e),null!=t&&(qc(t),e=e.normalize(t));let r=[];for(let t=0;t<e.length;t++){const n=e.charCodeAt(t);if(n<128)r.push(n);else if(n<2048)r.push(n>>6|192),r.push(63&n|128);else if(55296==(64512&n)){t++;const i=e.charCodeAt(t);Uc(t<e.length&&56320==(64512&i),"invalid surrogate pair","str",e);const s=65536+((1023&n)<<10)+(1023&i);r.push(s>>18|240),r.push(s>>12&63|128),r.push(s>>6&63|128),r.push(63&s|128)}else r.push(n>>12|224),r.push(n>>6&63|128),r.push(63&n|128)}return new Uint8Array(r)}function sd(e,t){return nd(e,t).map(e=>e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10&1023),56320+(1023&e)))).join("")}function od(e,t){return nd(id(e,t))}class ad extends Vl{constructor(e){super("string",e)}defaultValue(){return""}encode(e,t){return super.encode(e,id(Ul.dereference(t,"string")))}decode(e){return sd(super.decode(e))}}class cd extends Nu{coders;constructor(e,t){let r=!1;const n=[];e.forEach(e=>{e.dynamic&&(r=!0),n.push(e.type)}),super("tuple","tuple("+n.join(",")+")",t,r),Oc(this,{coders:Object.freeze(e.slice())})}defaultValue(){const e=[];this.coders.forEach(t=>{e.push(t.defaultValue())});const t=this.coders.reduce((e,t)=>{const r=t.localName;return r&&(e[r]||(e[r]=0),e[r]++),e},{});return this.coders.forEach((r,n)=>{let i=r.localName;i&&1===t[i]&&("length"===i&&(i="_length"),null==e[i]&&(e[i]=e[n]))}),Object.freeze(e)}encode(e,t){const r=Ul.dereference(t,"tuple");return ql(e,this.coders,r)}decode(e){return Kl(e,this.coders)}}function ud(e){return Rl(id(e))}function ld(e){const t=new Set;return e.forEach(e=>t.add(e)),Object.freeze(t)}const dd=ld("external public payable override".split(" ")),hd="constant external internal payable private public pure view override",fd=ld(hd.split(" ")),pd="constructor error event fallback function receive struct",gd=ld(pd.split(" ")),md="calldata memory storage payable indexed",yd=ld(md.split(" ")),bd=ld([pd,md,"tuple returns",hd].join(" ").split(" ")),wd={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},vd=new RegExp("^(\\s*)"),Ed=new RegExp("^([0-9]+)"),Ad=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),Sd=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),kd=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");class Rd{#i;#d;get offset(){return this.#i}get length(){return this.#d.length-this.#i}constructor(e){this.#i=0,this.#d=e.slice()}clone(){return new Rd(this.#d)}reset(){this.#i=0}#h(e=0,t=0){return new Rd(this.#d.slice(e,t).map(t=>Object.freeze(Object.assign({},t,{match:t.match-e,linkBack:t.linkBack-e,linkNext:t.linkNext-e}))))}popKeyword(e){const t=this.peek();if("KEYWORD"!==t.type||!e.has(t.text))throw new Error(`expected keyword ${t.text}`);return this.pop().text}popType(e){if(this.peek().type!==e){const t=this.peek();throw new Error(`expected ${e}; got ${t.type} ${JSON.stringify(t.text)}`)}return this.pop().text}popParen(){const e=this.peek();if("OPEN_PAREN"!==e.type)throw new Error("bad start");const t=this.#h(this.#i+1,e.match+1);return this.#i=e.match+1,t}popParams(){const e=this.peek();if("OPEN_PAREN"!==e.type)throw new Error("bad start");const t=[];for(;this.#i<e.match-1;){const e=this.peek().linkNext;t.push(this.#h(this.#i+1,e)),this.#i=e}return this.#i=e.match+1,t}peek(){if(this.#i>=this.#d.length)throw new Error("out-of-bounds");return this.#d[this.#i]}peekKeyword(e){const t=this.peekType("KEYWORD");return null!=t&&e.has(t)?t:null}peekType(e){if(0===this.length)return null;const t=this.peek();return t.type===e?t.text:null}pop(){const e=this.peek();return this.#i++,e}toString(){const e=[];for(let t=this.#i;t<this.#d.length;t++){const r=this.#d[t];e.push(`${r.type}:${r.text}`)}return`<TokenString ${e.join(" ")}>`}}function Pd(e){const t=[],r=t=>{const r=s<e.length?JSON.stringify(e[s]):"$EOI";throw new Error(`invalid token ${r} at ${s}: ${t}`)};let n=[],i=[],s=0;for(;s<e.length;){let o=e.substring(s),a=o.match(vd);a&&(s+=a[1].length,o=e.substring(s));const c={depth:n.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:s,value:-1};t.push(c);let u=wd[o[0]]||"";if(u){if(c.type=u,c.text=o[0],s++,"OPEN_PAREN"===u)n.push(t.length-1),i.push(t.length-1);else if("CLOSE_PAREN"==u)0===n.length&&r("no matching open bracket"),c.match=n.pop(),t[c.match].match=t.length-1,c.depth--,c.linkBack=i.pop(),t[c.linkBack].linkNext=t.length-1;else if("COMMA"===u)c.linkBack=i.pop(),t[c.linkBack].linkNext=t.length-1,i.push(t.length-1);else if("OPEN_BRACKET"===u)c.type="BRACKET";else if("CLOSE_BRACKET"===u){let e=t.pop().text;if(t.length>0&&"NUMBER"===t[t.length-1].type){const r=t.pop().text;e=r+e,t[t.length-1].value=pu(r)}if(0===t.length||"BRACKET"!==t[t.length-1].type)throw new Error("missing opening bracket");t[t.length-1].text+=e}}else if(a=o.match(Ad),a){if(c.text=a[1],s+=c.text.length,bd.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(kd)){c.type="TYPE";continue}c.type="ID"}else{if(a=o.match(Ed),!a)throw new Error(`unexpected token ${JSON.stringify(o[0])} at position ${s}`);c.text=a[1],c.type="NUMBER",s+=c.text.length}}return new Rd(t.map(e=>Object.freeze(e)))}function Id(e,t){let r=[];for(const n in t.keys())e.has(n)&&r.push(n);if(r.length>1)throw new Error(`conflicting types: ${r.join(", ")}`)}function Cd(e,t){if(t.peekKeyword(gd)){const r=t.pop().text;if(r!==e)throw new Error(`expected ${e}, got ${r}`)}return t.popType("ID")}function _d(e,t){const r=new Set;for(;;){const n=e.peekType("KEYWORD");if(null==n||t&&!t.has(n))break;if(e.pop(),r.has(n))throw new Error(`duplicate keywords: ${JSON.stringify(n)}`);r.add(n)}return Object.freeze(r)}function Td(e){let t=_d(e,fd);return Id(t,ld("constant payable nonpayable".split(" "))),Id(t,ld("pure view payable nonpayable".split(" "))),t.has("view")?"view":t.has("pure")?"pure":t.has("payable")?"payable":t.has("nonpayable")?"nonpayable":t.has("constant")?"view":"nonpayable"}function Nd(e,t){return e.popParams().map(e=>$d.from(e,t))}function xd(e){if(e.peekType("AT")){if(e.pop(),e.peekType("NUMBER"))return lu(e.pop().text);throw new Error("invalid gas")}return null}function Od(e){if(e.length)throw new Error(`unexpected tokens at offset ${e.offset}: ${e.toString()}`)}const Dd=new RegExp(/^(.*)\[([0-9]*)\]$/);function Md(e){const t=e.match(kd);if(Uc(t,"invalid type","type",e),"uint"===e)return"uint256";if("int"===e)return"int256";if(t[2]){const r=parseInt(t[2]);Uc(0!==r&&r<=32,"invalid bytes length","type",e)}else if(t[3]){const r=parseInt(t[3]);Uc(0!==r&&r<=256&&r%8==0,"invalid numeric width","type",e)}return e}const Bd={},Ld=Symbol.for("_ethers_internal"),Fd="_ParamTypeInternal",Ud="_ErrorInternal",jd="_EventInternal",zd="_ConstructorInternal",qd="_FallbackInternal",Kd="_FunctionInternal",Gd="_StructInternal";class $d{name;type;baseType;indexed;components;arrayLength;arrayChildren;constructor(e,t,r,n,i,s,o,a){if(Kc(e,Bd,"ParamType"),Object.defineProperty(this,Ld,{value:Fd}),s&&(s=Object.freeze(s.slice())),"array"===n){if(null==o||null==a)throw new Error("")}else if(null!=o||null!=a)throw new Error("");if("tuple"===n){if(null==s)throw new Error("")}else if(null!=s)throw new Error("");Oc(this,{name:t,type:r,baseType:n,indexed:i,components:s,arrayLength:o,arrayChildren:a})}format(e){if(null==e&&(e="sighash"),"json"===e){const t=this.name||"";if(this.isArray()){const e=JSON.parse(this.arrayChildren.format("json"));return e.name=t,e.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(e)}const r={type:"tuple"===this.baseType?"tuple":this.type,name:t};return"boolean"==typeof this.indexed&&(r.indexed=this.indexed),this.isTuple()&&(r.components=this.components.map(t=>JSON.parse(t.format(e)))),JSON.stringify(r)}let t="";return this.isArray()?(t+=this.arrayChildren.format(e),t+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?t+="("+this.components.map(t=>t.format(e)).join("full"===e?", ":",")+")":t+=this.type,"sighash"!==e&&(!0===this.indexed&&(t+=" indexed"),"full"===e&&this.name&&(t+=" "+this.name)),t}isArray(){return"array"===this.baseType}isTuple(){return"tuple"===this.baseType}isIndexable(){return null!=this.indexed}walk(e,t){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(-1!==this.arrayLength&&e.length!==this.arrayLength)throw new Error("array is wrong length");const r=this;return e.map(e=>r.arrayChildren.walk(e,t))}if(this.isTuple()){if(!Array.isArray(e))throw new Error("invalid tuple value");if(e.length!==this.components.length)throw new Error("array is wrong length");const r=this;return e.map((e,n)=>r.components[n].walk(e,t))}return t(this.type,e)}#f(e,t,r,n){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(-1!==this.arrayLength&&t.length!==this.arrayLength)throw new Error("array is wrong length");const i=this.arrayChildren,s=t.slice();return s.forEach((t,n)=>{i.#f(e,t,r,e=>{s[n]=e})}),void n(s)}if(this.isTuple()){const i=this.components;let s;if(Array.isArray(t))s=t.slice();else{if(null==t||"object"!=typeof t)throw new Error("invalid tuple value");s=i.map(e=>{if(!e.name)throw new Error("cannot use object value with unnamed components");if(!(e.name in t))throw new Error(`missing value for component ${e.name}`);return t[e.name]})}if(s.length!==this.components.length)throw new Error("array is wrong length");return s.forEach((t,n)=>{i[n].#f(e,t,r,e=>{s[n]=e})}),void n(s)}const i=r(this.type,t);i.then?e.push(async function(){n(await i)}()):n(i)}async walkAsync(e,t){const r=[],n=[e];return this.#f(r,e,t,e=>{n[0]=e}),r.length&&await Promise.all(r),n[0]}static from(e,t){if($d.isParamType(e))return e;if("string"==typeof e)try{return $d.from(Pd(e),t)}catch(t){Uc(!1,"invalid param type","obj",e)}else if(e instanceof Rd){let r="",n="",i=null;_d(e,ld(["tuple"])).has("tuple")||e.peekType("OPEN_PAREN")?(n="tuple",i=e.popParams().map(e=>$d.from(e)),r=`tuple(${i.map(e=>e.format()).join(",")})`):(r=Md(e.popType("TYPE")),n=r);let s=null,o=null;for(;e.length&&e.peekType("BRACKET");){const t=e.pop();s=new $d(Bd,"",r,n,null,i,o,s),o=t.value,r+=t.text,n="array",i=null}let a=null;if(_d(e,yd).has("indexed")){if(!t)throw new Error("");a=!0}const c=e.peekType("ID")?e.pop().text:"";if(e.length)throw new Error("leftover tokens");return new $d(Bd,c,r,n,a,i,o,s)}const r=e.name;Uc(!r||"string"==typeof r&&r.match(Sd),"invalid name","obj.name",r);let n=e.indexed;null!=n&&(Uc(t,"parameter cannot be indexed","obj.indexed",e.indexed),n=!!n);let i=e.type,s=i.match(Dd);if(s){const t=parseInt(s[2]||"-1"),o=$d.from({type:s[1],components:e.components});return new $d(Bd,r||"",i,"array",n,null,t,o)}if("tuple"===i||i.startsWith("tuple(")||i.startsWith("(")){const t=null!=e.components?e.components.map(e=>$d.from(e)):null;return new $d(Bd,r||"",i,"tuple",n,t,null,null)}return i=Md(e.type),new $d(Bd,r||"",i,i,n,null,null,null)}static isParamType(e){return e&&e[Ld]===Fd}}class Vd{type;inputs;constructor(e,t,r){Kc(e,Bd,"Fragment"),Oc(this,{type:t,inputs:r=Object.freeze(r.slice())})}static from(e){if("string"==typeof e){try{Vd.from(JSON.parse(e))}catch(e){}return Vd.from(Pd(e))}if(e instanceof Rd)switch(e.peekKeyword(gd)){case"constructor":return Qd.from(e);case"error":return Jd.from(e);case"event":return Zd.from(e);case"fallback":case"receive":return Yd.from(e);case"function":return Xd.from(e);case"struct":return eh.from(e)}else if("object"==typeof e){switch(e.type){case"constructor":return Qd.from(e);case"error":return Jd.from(e);case"event":return Zd.from(e);case"fallback":case"receive":return Yd.from(e);case"function":return Xd.from(e);case"struct":return eh.from(e)}Fc(!1,`unsupported type: ${e.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}Uc(!1,"unsupported frgament object","obj",e)}static isConstructor(e){return Qd.isFragment(e)}static isError(e){return Jd.isFragment(e)}static isEvent(e){return Zd.isFragment(e)}static isFunction(e){return Xd.isFragment(e)}static isStruct(e){return eh.isFragment(e)}}class Hd extends Vd{name;constructor(e,t,r,n){super(e,t,n),Uc("string"==typeof r&&r.match(Sd),"invalid identifier","name",r),n=Object.freeze(n.slice()),Oc(this,{name:r})}}function Wd(e,t){return"("+t.map(t=>t.format(e)).join("full"===e?", ":",")+")"}class Jd extends Hd{constructor(e,t,r){super(e,"error",t,r),Object.defineProperty(this,Ld,{value:Ud})}get selector(){return ud(this.format("sighash")).substring(0,10)}format(e){if(null==e&&(e="sighash"),"json"===e)return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(t=>JSON.parse(t.format(e)))});const t=[];return"sighash"!==e&&t.push("error"),t.push(this.name+Wd(e,this.inputs)),t.join(" ")}static from(e){if(Jd.isFragment(e))return e;if("string"==typeof e)return Jd.from(Pd(e));if(e instanceof Rd){const t=Cd("error",e),r=Nd(e);return Od(e),new Jd(Bd,t,r)}return new Jd(Bd,e.name,e.inputs?e.inputs.map($d.from):[])}static isFragment(e){return e&&e[Ld]===Ud}}class Zd extends Hd{anonymous;constructor(e,t,r,n){super(e,"event",t,r),Object.defineProperty(this,Ld,{value:jd}),Oc(this,{anonymous:n})}get topicHash(){return ud(this.format("sighash"))}format(e){if(null==e&&(e="sighash"),"json"===e)return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(t=>JSON.parse(t.format(e)))});const t=[];return"sighash"!==e&&t.push("event"),t.push(this.name+Wd(e,this.inputs)),"sighash"!==e&&this.anonymous&&t.push("anonymous"),t.join(" ")}static getTopicHash(e,t){return t=(t||[]).map(e=>$d.from(e)),new Zd(Bd,e,t,!1).topicHash}static from(e){if(Zd.isFragment(e))return e;if("string"==typeof e)try{return Zd.from(Pd(e))}catch(t){Uc(!1,"invalid event fragment","obj",e)}else if(e instanceof Rd){const t=Cd("event",e),r=Nd(e,!0),n=!!_d(e,ld(["anonymous"])).has("anonymous");return Od(e),new Zd(Bd,t,r,n)}return new Zd(Bd,e.name,e.inputs?e.inputs.map(e=>$d.from(e,!0)):[],!!e.anonymous)}static isFragment(e){return e&&e[Ld]===jd}}class Qd extends Vd{payable;gas;constructor(e,t,r,n,i){super(e,t,r),Object.defineProperty(this,Ld,{value:zd}),Oc(this,{payable:n,gas:i})}format(e){if(Fc(null!=e&&"sighash"!==e,"cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),"json"===e)return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:null!=this.gas?this.gas:void 0,inputs:this.inputs.map(t=>JSON.parse(t.format(e)))});const t=[`constructor${Wd(e,this.inputs)}`];return this.payable&&t.push("payable"),null!=this.gas&&t.push(`@${this.gas.toString()}`),t.join(" ")}static from(e){if(Qd.isFragment(e))return e;if("string"==typeof e)try{return Qd.from(Pd(e))}catch(t){Uc(!1,"invalid constuctor fragment","obj",e)}else if(e instanceof Rd){_d(e,ld(["constructor"]));const t=Nd(e),r=!!_d(e,dd).has("payable"),n=xd(e);return Od(e),new Qd(Bd,"constructor",t,r,n)}return new Qd(Bd,"constructor",e.inputs?e.inputs.map($d.from):[],!!e.payable,null!=e.gas?e.gas:null)}static isFragment(e){return e&&e[Ld]===zd}}class Yd extends Vd{payable;constructor(e,t,r){super(e,"fallback",t),Object.defineProperty(this,Ld,{value:qd}),Oc(this,{payable:r})}format(e){const t=0===this.inputs.length?"receive":"fallback";if("json"===e){const e=this.payable?"payable":"nonpayable";return JSON.stringify({type:t,stateMutability:e})}return`${t}()${this.payable?" payable":""}`}static from(e){if(Yd.isFragment(e))return e;if("string"==typeof e)try{return Yd.from(Pd(e))}catch(t){Uc(!1,"invalid fallback fragment","obj",e)}else if(e instanceof Rd){const t=e.toString();if(Uc(e.peekKeyword(ld(["fallback","receive"])),"type must be fallback or receive","obj",t),"receive"===e.popKeyword(ld(["fallback","receive"]))){const t=Nd(e);return Uc(0===t.length,"receive cannot have arguments","obj.inputs",t),_d(e,ld(["payable"])),Od(e),new Yd(Bd,[],!0)}let r=Nd(e);r.length?Uc(1===r.length&&"bytes"===r[0].type,"invalid fallback inputs","obj.inputs",r.map(e=>e.format("minimal")).join(", ")):r=[$d.from("bytes")];const n=Td(e);if(Uc("nonpayable"===n||"payable"===n,"fallback cannot be constants","obj.stateMutability",n),_d(e,ld(["returns"])).has("returns")){const t=Nd(e);Uc(1===t.length&&"bytes"===t[0].type,"invalid fallback outputs","obj.outputs",t.map(e=>e.format("minimal")).join(", "))}return Od(e),new Yd(Bd,r,"payable"===n)}if("receive"===e.type)return new Yd(Bd,[],!0);if("fallback"===e.type){const t=[$d.from("bytes")],r="payable"===e.stateMutability;return new Yd(Bd,t,r)}Uc(!1,"invalid fallback description","obj",e)}static isFragment(e){return e&&e[Ld]===qd}}class Xd extends Hd{constant;outputs;stateMutability;payable;gas;constructor(e,t,r,n,i,s){super(e,"function",t,n),Object.defineProperty(this,Ld,{value:Kd}),Oc(this,{constant:"view"===r||"pure"===r,gas:s,outputs:i=Object.freeze(i.slice()),payable:"payable"===r,stateMutability:r})}get selector(){return ud(this.format("sighash")).substring(0,10)}format(e){if(null==e&&(e="sighash"),"json"===e)return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:"nonpayable"!==this.stateMutability?this.stateMutability:void 0,payable:this.payable,gas:null!=this.gas?this.gas:void 0,inputs:this.inputs.map(t=>JSON.parse(t.format(e))),outputs:this.outputs.map(t=>JSON.parse(t.format(e)))});const t=[];return"sighash"!==e&&t.push("function"),t.push(this.name+Wd(e,this.inputs)),"sighash"!==e&&("nonpayable"!==this.stateMutability&&t.push(this.stateMutability),this.outputs&&this.outputs.length&&(t.push("returns"),t.push(Wd(e,this.outputs))),null!=this.gas&&t.push(`@${this.gas.toString()}`)),t.join(" ")}static getSelector(e,t){return t=(t||[]).map(e=>$d.from(e)),new Xd(Bd,e,"view",t,[],null).selector}static from(e){if(Xd.isFragment(e))return e;if("string"==typeof e)try{return Xd.from(Pd(e))}catch(t){Uc(!1,"invalid function fragment","obj",e)}else if(e instanceof Rd){const t=Cd("function",e),r=Nd(e),n=Td(e);let i=[];_d(e,ld(["returns"])).has("returns")&&(i=Nd(e));const s=xd(e);return Od(e),new Xd(Bd,t,n,r,i,s)}let t=e.stateMutability;return null==t&&(t="payable","boolean"==typeof e.constant?(t="view",e.constant||(t="payable","boolean"!=typeof e.payable||e.payable||(t="nonpayable"))):"boolean"!=typeof e.payable||e.payable||(t="nonpayable")),new Xd(Bd,e.name,t,e.inputs?e.inputs.map($d.from):[],e.outputs?e.outputs.map($d.from):[],null!=e.gas?e.gas:null)}static isFragment(e){return e&&e[Ld]===Kd}}class eh extends Hd{constructor(e,t,r){super(e,"struct",t,r),Object.defineProperty(this,Ld,{value:Gd})}format(){throw new Error("@TODO")}static from(e){if("string"==typeof e)try{return eh.from(Pd(e))}catch(t){Uc(!1,"invalid struct fragment","obj",e)}else if(e instanceof Rd){const t=Cd("struct",e),r=Nd(e);return Od(e),new eh(Bd,t,r)}return new eh(Bd,e.name,e.inputs?e.inputs.map($d.from):[])}static isFragment(e){return e&&e[Ld]===Gd}}const th=new Map;th.set(0,"GENERIC_PANIC"),th.set(1,"ASSERT_FALSE"),th.set(17,"OVERFLOW"),th.set(18,"DIVIDE_BY_ZERO"),th.set(33,"ENUM_RANGE_ERROR"),th.set(34,"BAD_STORAGE_DATA"),th.set(49,"STACK_UNDERFLOW"),th.set(50,"ARRAY_RANGE_ERROR"),th.set(65,"OUT_OF_MEMORY"),th.set(81,"UNINITIALIZED_FUNCTION_CALL");const rh=new RegExp(/^bytes([0-9]*)$/),nh=new RegExp(/^(u?int)([0-9]*)$/);let ih=null,sh=1024;class oh{#p(e){if(e.isArray())return new Gl(this.#p(e.arrayChildren),e.arrayLength,e.name);if(e.isTuple())return new cd(e.components.map(e=>this.#p(e)),e.name);switch(e.baseType){case"address":return new jl(e.name);case"bool":return new $l(e.name);case"string":return new ad(e.name);case"bytes":return new Hl(e.name);case"":return new Zl(e.name)}let t=e.type.match(nh);if(t){let r=parseInt(t[2]||"256");return Uc(0!==r&&r<=256&&r%8==0,"invalid "+t[1]+" bit length","param",e),new ed(r/8,"int"===t[1],e.name)}if(t=e.type.match(rh),t){let r=parseInt(t[1]);return Uc(0!==r&&r<=32,"invalid bytes length","param",e),new Wl(r,e.name)}Uc(!1,"invalid type","type",e.type)}getDefaultValue(e){const t=e.map(e=>this.#p($d.from(e)));return new cd(t,"_").defaultValue()}encode(e,t){jc(t.length,e.length,"types/values length mismatch");const r=e.map(e=>this.#p($d.from(e))),n=new cd(r,"_"),i=new xu;return n.encode(i,t),i.data}decode(e,t,r){const n=e.map(e=>this.#p($d.from(e)));return new cd(n,"_").decode(new Ou(t,r,sh))}static _setDefaultMaxInflation(e){Uc("number"==typeof e&&Number.isInteger(e),"invalid defaultMaxInflation factor","value",e),sh=e}static defaultAbiCoder(){return null==ih&&(ih=new oh),ih}static getBuiltinCallException(e,t,r){return function(e,t,r,n){let i="missing revert data",s=null,o=null;if(r){i="execution reverted";const e=$c(r);if(r=Zc(r),0===e.length)i+=" (no data present; likely require(false) occurred",s="require(false)";else if(e.length%32!=4)i+=" (could not decode reason; invalid data length)";else if("0x08c379a0"===Zc(e.slice(0,4)))try{s=n.decode(["string"],e.slice(4))[0],o={signature:"Error(string)",name:"Error",args:[s]},i+=`: ${JSON.stringify(s)}`}catch(e){i+=" (could not decode reason; invalid string data)"}else if("0x4e487b71"===Zc(e.slice(0,4)))try{const t=Number(n.decode(["uint256"],e.slice(4))[0]);o={signature:"Panic(uint256)",name:"Panic",args:[t]},s=`Panic due to ${th.get(t)||"UNKNOWN"}(${t})`,i+=`: ${s}`}catch(e){i+=" (could not decode panic code)"}else i+=" (unknown custom error)"}const a={to:t.to?Ol(t.to):null,data:t.data||"0x"};return t.from&&(a.from=Ol(t.from)),Lc(i,"CALL_EXCEPTION",{action:e,data:r,reason:s,transaction:a,invocation:null,revert:o})}(e,t,r,oh.defaultAbiCoder())}}function ah(e){return e&&"function"==typeof e.getAddress}function ch(e){try{return Ol(e),!0}catch(e){}return!1}async function uh(e,t){const r=await t;return null!=r&&"0x0000000000000000000000000000000000000000"!==r||(Fc("string"!=typeof e,"unconfigured name","UNCONFIGURED_NAME",{value:e}),Uc(!1,"invalid AddressLike value; did not resolve to a value address","target",e)),Ol(r)}function lh(e,t){return"string"==typeof e?e.match(/^0x[0-9a-f]{40}$/i)?Ol(e):(Fc(null!=t,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),uh(e,t.resolveName(e))):ah(e)?uh(e,e.getAddress()):e&&"function"==typeof e.then?uh(e,e):void Uc(!1,"unsupported addressable value","target",e)}class dh extends rl{constructor(e,t,r,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Qu(this.buffer)}update(e){Lu(this);const{view:t,buffer:r,blockLen:n}=this,i=(e=tl(e)).length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){const t=Qu(e);for(;n<=i-s;s+=n)this.process(t,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Lu(this),Fu(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:i}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+u,a,n)}(r,n-8,BigInt(8*this.length),i),this.process(r,0);const o=Qu(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.length=n,e.pos=o,e.finished=i,e.destroyed=s,n%t&&e.buffer.set(r),e}}const hh=(e,t,r)=>e&t^~e&r,fh=(e,t,r)=>e&t^e&r^t&r,ph=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),gh=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),mh=new Uint32Array(64);class yh extends dh{constructor(){super(64,32,8,!1),this.A=0|gh[0],this.B=0|gh[1],this.C=0|gh[2],this.D=0|gh[3],this.E=0|gh[4],this.F=0|gh[5],this.G=0|gh[6],this.H=0|gh[7]}get(){const{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)mh[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=mh[e-15],r=mh[e-2],n=Yu(t,7)^Yu(t,18)^t>>>3,i=Yu(r,17)^Yu(r,19)^r>>>10;mh[e]=i+mh[e-7]+n+mh[e-16]|0}let{A:r,B:n,C:i,D:s,E:o,F:a,G:c,H:u}=this;for(let e=0;e<64;e++){const t=u+(Yu(o,6)^Yu(o,11)^Yu(o,25))+hh(o,a,c)+ph[e]+mh[e]|0,l=(Yu(r,2)^Yu(r,13)^Yu(r,22))+fh(r,n,i)|0;u=c,c=a,a=o,o=s+t|0,s=i,i=n,n=r,r=t+l|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,n,i,s,o,a,c,u)}roundClean(){mh.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const bh=sl(()=>new yh),wh=(BigInt(0),BigInt(1)),vh=BigInt(2),Eh=e=>e instanceof Uint8Array,Ah=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Sh(e){if(!Eh(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=Ah[e[r]];return t}function kh(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function Rh(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(t/2);for(let t=0;t<r.length;t++){const n=2*t,i=e.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");r[t]=s}return r}function Ph(e){return kh(Sh(e))}function Ih(e){if(!Eh(e))throw new Error("Uint8Array expected");return kh(Sh(Uint8Array.from(e).reverse()))}function Ch(e,t){return Rh(e.toString(16).padStart(2*t,"0"))}function _h(e,t){return Ch(e,t).reverse()}function Th(e,t,r){let n;if("string"==typeof t)try{n=Rh(t)}catch(r){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${r}`)}else{if(!Eh(t))throw new Error(`${e} must be hex string or Uint8Array`);n=Uint8Array.from(t)}const i=n.length;if("number"==typeof r&&i!==r)throw new Error(`${e} expected ${r} bytes, got ${i}`);return n}function Nh(...e){const t=new Uint8Array(e.reduce((e,t)=>e+t.length,0));let r=0;return e.forEach(e=>{if(!Eh(e))throw new Error("Uint8Array expected");t.set(e,r),r+=e.length}),t}const xh=e=>(vh<<BigInt(e-1))-wh,Oh=e=>new Uint8Array(e),Dh=e=>Uint8Array.from(e);function Mh(e,t,r){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");let n=Oh(e),i=Oh(e),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...e)=>r(i,n,...e),c=(e=Oh())=>{i=a(Dh([0]),e),n=a(),0!==e.length&&(i=a(Dh([1]),e),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const r=[];for(;e<t;){n=a();const t=n.slice();r.push(t),e+=n.length}return Nh(...r)};return(e,t)=>{let r;for(o(),c(e);!(r=t(u()));)c();return o(),r}}const Bh={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function Lh(e,t,r={}){const n=(t,r,n)=>{const i=Bh[r];if("function"!=typeof i)throw new Error(`Invalid validator "${r}", expected function`);const s=e[t];if(!(n&&void 0===s||i(s,e)))throw new Error(`Invalid param ${String(t)}=${s} (${typeof s}), expected ${r}`)};for(const[e,r]of Object.entries(t))n(e,r,!1);for(const[e,t]of Object.entries(r))n(e,t,!0);return e}const Fh=BigInt(0),Uh=BigInt(1),jh=BigInt(2),zh=BigInt(3),qh=BigInt(4),Kh=BigInt(5),Gh=BigInt(8);function $h(e,t){const r=e%t;return r>=Fh?r:t+r}function Vh(e,t,r){if(r<=Fh||t<Fh)throw new Error("Expected power/modulo > 0");if(r===Uh)return Fh;let n=Uh;for(;t>Fh;)t&Uh&&(n=n*e%r),e=e*e%r,t>>=Uh;return n}function Hh(e,t,r){let n=e;for(;t-- >Fh;)n*=n,n%=r;return n}function Wh(e,t){if(e===Fh||t<=Fh)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=$h(e,t),n=t,i=Fh,s=Uh,o=Uh,a=Fh;for(;r!==Fh;){const e=n/r,t=n%r,c=i-o*e,u=s-a*e;n=r,r=t,i=o,s=a,o=c,a=u}if(n!==Uh)throw new Error("invert: does not exist");return $h(i,t)}BigInt(9),BigInt(16);const Jh=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Zh(e,t){const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function Qh(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Yh(e){const t=Qh(e);return t+Math.ceil(t/2)}class Xh extends rl{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Bu(e);const r=tl(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return Lu(this),this.iHash.update(e),this}digestInto(e){Lu(this),Mu(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ef=(e,t,r)=>new Xh(e,t).update(r).digest();ef.create=(e,t)=>new Xh(e,t);const tf=BigInt(0),rf=BigInt(1);function nf(e){return function(e){const t=Jh.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});Lh(e,t)}(e.Fp),Lh(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Zh(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const{Ph:sf,aT:of}=e,af={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=af;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const r=e[1],n=e.subarray(2,r+2);if(!r||n.length!==r)throw new t("Invalid signature integer: wrong length");if(128&n[0])throw new t("Invalid signature integer: negative");if(0===n[0]&&!(128&n[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:sf(n),l:e.subarray(r+2)}},toSig(e){const{Err:t}=af,r="string"==typeof e?of(e):e;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let n=r.length;if(n<2||48!=r[0])throw new t("Invalid signature tag");if(r[1]!==n-2)throw new t("Invalid signature: incorrect length");const{d:i,l:s}=af._parseInt(r.subarray(2)),{d:o,l:a}=af._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,r=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},n=t(r(e.s)),i=t(r(e.r)),s=n.length/2,o=i.length/2,a=r(s),c=r(o);return`30${r(o+s+4)}02${c}${i}02${a}${n}`}},cf=BigInt(0),uf=BigInt(1),lf=(BigInt(2),BigInt(3));function df(e){const t=function(e){const t=nf(e);return Lh(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:r,n}=t,i=r.BYTES+1,s=2*r.BYTES+1;function o(e){return $h(e,n)}function a(e){return Wh(e,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:d}=function(e){const t=function(e){const t=nf(e);Lh(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:i}=t;if(r){if(!n.eql(i,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:r}=t,n=t.toBytes||((e,t,n)=>{const i=t.toAffine();return Nh(Uint8Array.from([4]),r.toBytes(i.x),r.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function s(e){const{a:n,b:i}=t,s=r.sqr(e),o=r.mul(s,e);return r.add(r.add(o,r.mul(e,n)),i)}if(!r.eql(r.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function o(e){return"bigint"==typeof e&&cf<e&&e<t.n}function a(e){if(!o(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:r,nByteLength:n,wrapPrivateKey:i,n:s}=t;if(r&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=Sh(e)),"string"!=typeof e||!r.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*n,"0")}let o;try{o="bigint"==typeof e?e:Ph(Th("private key",e,n))}catch(t){throw new Error(`private key must be ${n} bytes, hex or bigint, not ${typeof e}`)}return i&&(o=$h(o,s)),a(o),o}const u=new Map;function l(e){if(!(e instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(e,t,n){if(this.px=e,this.py=t,this.pz=n,null==e||!r.isValid(e))throw new Error("x required");if(null==t||!r.isValid(t))throw new Error("y required");if(null==n||!r.isValid(n))throw new Error("z required")}static fromAffine(e){const{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw new Error("invalid affine point");if(e instanceof d)throw new Error("projective point not allowed");const i=e=>r.eql(e,r.ZERO);return i(t)&&i(n)?d.ZERO:new d(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=r.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(d.fromAffine)}static fromHex(e){const t=d.fromAffine(i(Th("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return d.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,u.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:n}=this.toAffine();if(!r.isValid(e)||!r.isValid(n))throw new Error("bad point: x or y not FE");const i=r.sqr(n),o=s(e);if(!r.eql(i,o))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){l(e);const{px:t,py:n,pz:i}=this,{px:s,py:o,pz:a}=e,c=r.eql(r.mul(t,a),r.mul(s,i)),u=r.eql(r.mul(n,a),r.mul(o,i));return c&&u}negate(){return new d(this.px,r.neg(this.py),this.pz)}double(){const{a:e,b:n}=t,i=r.mul(n,lf),{px:s,py:o,pz:a}=this;let c=r.ZERO,u=r.ZERO,l=r.ZERO,h=r.mul(s,s),f=r.mul(o,o),p=r.mul(a,a),g=r.mul(s,o);return g=r.add(g,g),l=r.mul(s,a),l=r.add(l,l),c=r.mul(e,l),u=r.mul(i,p),u=r.add(c,u),c=r.sub(f,u),u=r.add(f,u),u=r.mul(c,u),c=r.mul(g,c),l=r.mul(i,l),p=r.mul(e,p),g=r.sub(h,p),g=r.mul(e,g),g=r.add(g,l),l=r.add(h,h),h=r.add(l,h),h=r.add(h,p),h=r.mul(h,g),u=r.add(u,h),p=r.mul(o,a),p=r.add(p,p),h=r.mul(p,g),c=r.sub(c,h),l=r.mul(p,f),l=r.add(l,l),l=r.add(l,l),new d(c,u,l)}add(e){l(e);const{px:n,py:i,pz:s}=this,{px:o,py:a,pz:c}=e;let u=r.ZERO,h=r.ZERO,f=r.ZERO;const p=t.a,g=r.mul(t.b,lf);let m=r.mul(n,o),y=r.mul(i,a),b=r.mul(s,c),w=r.add(n,i),v=r.add(o,a);w=r.mul(w,v),v=r.add(m,y),w=r.sub(w,v),v=r.add(n,s);let E=r.add(o,c);return v=r.mul(v,E),E=r.add(m,b),v=r.sub(v,E),E=r.add(i,s),u=r.add(a,c),E=r.mul(E,u),u=r.add(y,b),E=r.sub(E,u),f=r.mul(p,v),u=r.mul(g,b),f=r.add(u,f),u=r.sub(y,f),f=r.add(y,f),h=r.mul(u,f),y=r.add(m,m),y=r.add(y,m),b=r.mul(p,b),v=r.mul(g,v),y=r.add(y,b),b=r.sub(m,b),b=r.mul(p,b),v=r.add(v,b),m=r.mul(y,v),h=r.add(h,m),m=r.mul(E,v),u=r.mul(w,u),u=r.sub(u,m),m=r.mul(w,y),f=r.mul(E,f),f=r.add(f,m),new d(u,h,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(d.ZERO)}wNAF(e){return f.wNAFCached(this,u,e,e=>{const t=r.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(d.fromAffine)})}multiplyUnsafe(e){const n=d.ZERO;if(e===cf)return n;if(a(e),e===uf)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:s,k1:o,k2neg:c,k2:u}=i.splitScalar(e),l=n,h=n,p=this;for(;o>cf||u>cf;)o&uf&&(l=l.add(p)),u&uf&&(h=h.add(p)),p=p.double(),o>>=uf,u>>=uf;return s&&(l=l.negate()),c&&(h=h.negate()),h=new d(r.mul(h.px,i.beta),h.py,h.pz),l.add(h)}multiply(e){a(e);let n,i,s=e;const{endo:o}=t;if(o){const{k1neg:e,k1:t,k2neg:a,k2:c}=o.splitScalar(s);let{p:u,f:l}=this.wNAF(t),{p:h,f:p}=this.wNAF(c);u=f.constTimeNegate(e,u),h=f.constTimeNegate(a,h),h=new d(r.mul(h.px,o.beta),h.py,h.pz),n=u.add(h),i=l.add(p)}else{const{p:e,f:t}=this.wNAF(s);n=e,i=t}return d.normalizeZ([n,i])[0]}multiplyAndAddUnsafe(e,t,r){const n=d.BASE,i=(e,t)=>t!==cf&&t!==uf&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,r));return s.is0()?void 0:s}toAffine(e){const{px:t,py:n,pz:i}=this,s=this.is0();null==e&&(e=s?r.ONE:r.inv(i));const o=r.mul(t,e),a=r.mul(n,e),c=r.mul(i,e);if(s)return{x:r.ZERO,y:r.ZERO};if(!r.eql(c,r.ONE))throw new Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){const{h:e,isTorsionFree:r}=t;if(e===uf)return!0;if(r)return r(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:r}=t;return e===uf?this:r?r(d,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),n(d,this,e)}toHex(e=!0){return Sh(this.toRawBytes(e))}}d.BASE=new d(t.Gx,t.Gy,r.ONE),d.ZERO=new d(r.ZERO,r.ONE,r.ZERO);const h=t.nBitLength,f=function(e,t){const r=(e,t)=>{const r=t.negate();return e?r:t},n=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:r,unsafeLadder(t,r){let n=e.ZERO,i=t;for(;r>tf;)r&rf&&(n=n.add(i)),i=i.double(),r>>=rf;return n},precomputeWindow(e,t){const{windows:r,windowSize:i}=n(t),s=[];let o=e,a=o;for(let e=0;e<r;e++){a=o,s.push(a);for(let e=1;e<i;e++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(t,i,s){const{windows:o,windowSize:a}=n(t);let c=e.ZERO,u=e.BASE;const l=BigInt(2**t-1),d=2**t,h=BigInt(t);for(let e=0;e<o;e++){const t=e*a;let n=Number(s&l);s>>=h,n>a&&(n-=d,s+=rf);const o=t,f=t+Math.abs(n)-1,p=e%2!=0,g=n<0;0===n?u=u.add(r(p,i[o])):c=c.add(r(g,i[f]))}return{p:c,f:u}},wNAFCached(e,t,r,n){const i=e._WINDOW_SIZE||1;let s=t.get(e);return s||(s=this.precomputeWindow(e,i),1!==i&&t.set(e,n(s))),this.wNAF(i,s,r)}}}(d,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:o}}({...t,toBytes(e,t,n){const i=t.toAffine(),s=r.toBytes(i.x),o=Nh;return n?o(Uint8Array.from([t.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,r.toBytes(i.y))},fromBytes(e){const t=e.length,n=e[0],o=e.subarray(1);if(t!==i||2!==n&&3!==n){if(t===s&&4===n)return{x:r.fromBytes(o.subarray(0,r.BYTES)),y:r.fromBytes(o.subarray(r.BYTES,2*r.BYTES))};throw new Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const e=Ph(o);if(!(cf<(a=e)&&a<r.ORDER))throw new Error("Point is not on curve");const t=l(e);let i=r.sqrt(t);return!(1&~n)!=((i&uf)===uf)&&(i=r.neg(i)),{x:e,y:i}}var a}}),h=e=>Sh(Ch(e,t.nByteLength));function f(e){return e>n>>uf}const p=(e,t,r)=>Ph(e.slice(t,r));class g{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){const r=t.nByteLength;return e=Th("compactSignature",e,2*r),new g(p(e,0,r),p(e,r,2*r))}static fromDER(e){const{r:t,s:r}=af.toSig(Th("DER",e));return new g(t,r)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:n,s:i,recovery:s}=this,u=w(Th("msgHash",e));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const l=2===s||3===s?n+t.n:n;if(l>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const d=1&s?"03":"02",f=c.fromHex(d+h(l)),p=a(l),g=o(-u*p),m=o(i*p),y=c.BASE.multiplyAndAddUnsafe(f,g,m);if(!y)throw new Error("point at infinify");return y.assertValidity(),y}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Rh(this.toDERHex())}toDERHex(){return af.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Rh(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const m={isValidPrivateKey(e){try{return u(e),!0}catch(e){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const e=Yh(t.n);return function(e,t,r=!1){const n=e.length,i=Qh(t),s=Yh(t);if(n<16||n<s||n>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${n}`);const o=$h(r?Ph(e):Ih(e),t-Uh)+Uh;return r?_h(o,i):Ch(o,i)}(t.randomBytes(e),t.n)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function y(e){const t=e instanceof Uint8Array,r="string"==typeof e,n=(t||r)&&e.length;return t?n===i||n===s:r?n===2*i||n===2*s:e instanceof c}const b=t.bits2int||function(e){const r=Ph(e),n=8*e.length-t.nBitLength;return n>0?r>>BigInt(n):r},w=t.bits2int_modN||function(e){return o(b(e))},v=xh(t.nBitLength);function E(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(cf<=e&&e<v))throw new Error(`bigint expected < 2^${t.nBitLength}`);return Ch(e,t.nByteLength)}const A={lowS:t.lowS,prehash:!1},S={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(y(e))throw new Error("first arg must be private key");if(!y(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(u(e)).toRawBytes(r)},sign:function(e,n,i=A){const{seed:s,k2sig:l}=function(e,n,i=A){if(["recovered","canonical"].some(e=>e in i))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:l}=t;let{lowS:h,prehash:p,extraEntropy:m}=i;null==h&&(h=!0),e=Th("msgHash",e),p&&(e=Th("prehashed msgHash",s(e)));const y=w(e),v=u(n),S=[E(v),E(y)];if(null!=m){const e=!0===m?l(r.BYTES):m;S.push(Th("extraEntropy",e))}const k=Nh(...S),R=y;return{seed:k,k2sig:function(e){const t=b(e);if(!d(t))return;const r=a(t),n=c.BASE.multiply(t).toAffine(),i=o(n.x);if(i===cf)return;const s=o(r*o(R+i*v));if(s===cf)return;let u=(n.x===i?0:2)|Number(n.y&uf),l=s;return h&&f(s)&&(l=function(e){return f(e)?o(-e):e}(s),u^=1),new g(i,l,u)}}}(e,n,i),h=t;return Mh(h.hash.outputLen,h.nByteLength,h.hmac)(s,l)},verify:function(e,r,n,i=S){const s=e;if(r=Th("msgHash",r),n=Th("publicKey",n),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:l}=i;let d,h;try{if("string"==typeof s||s instanceof Uint8Array)try{d=g.fromDER(s)}catch(e){if(!(e instanceof af.Err))throw e;d=g.fromCompact(s)}else{if("object"!=typeof s||"bigint"!=typeof s.r||"bigint"!=typeof s.s)throw new Error("PARSE");{const{r:e,s:t}=s;d=new g(e,t)}}h=c.fromHex(n)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&d.hasHighS())return!1;l&&(r=t.hash(r));const{r:f,s:p}=d,m=w(r),y=a(p),b=o(m*y),v=o(f*y),E=c.BASE.multiplyAndAddUnsafe(h,b,v)?.toAffine();return!!E&&o(E.x)===f},ProjectivePoint:c,Signature:g,utils:m}}function hf(e){return{hash:e,hmac:(t,...r)=>ef(e,t,function(...e){const t=new Uint8Array(e.reduce((e,t)=>e+t.length,0));let r=0;return e.forEach(e=>{if(!Ju(e))throw new Error("Uint8Array expected");t.set(e,r),r+=e.length}),t}(...r)),randomBytes:ol}}BigInt(4);const ff=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),pf=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),gf=BigInt(1),mf=BigInt(2),yf=(e,t)=>(e+t/mf)/t;const bf=function(e,t,r=!1,n={}){if(e<=Fh)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:s}=Zh(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=function(e){if(e%qh===zh){const t=(e+Uh)/qh;return function(e,r){const n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw new Error("Cannot find square root");return n}}if(e%Gh===Kh){const t=(e-Kh)/Gh;return function(e,r){const n=e.mul(r,jh),i=e.pow(n,t),s=e.mul(r,i),o=e.mul(e.mul(s,jh),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),r))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-Uh)/jh;let r,n,i;for(r=e-Uh,n=0;r%jh===Fh;r/=jh,n++);for(i=jh;i<e&&Vh(i,t,e)!==e-Uh;i++);if(1===n){const t=(e+Uh)/qh;return function(e,r){const n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw new Error("Cannot find square root");return n}}const s=(r+Uh)/jh;return function(e,o){if(e.pow(o,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=n,c=e.pow(e.mul(e.ONE,i),r),u=e.pow(o,s),l=e.pow(o,r);for(;!e.eql(l,e.ONE);){if(e.eql(l,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(l);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);const r=e.pow(c,Uh<<BigInt(a-t-1));c=e.sqr(r),u=e.mul(u,r),l=e.mul(l,c),a=t}return u}}(e)}(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:s,MASK:xh(i),ZERO:Fh,ONE:Uh,create:t=>$h(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return Fh<=t&&t<e},is0:e=>e===Fh,isOdd:e=>(e&Uh)===Uh,neg:t=>$h(-t,e),eql:(e,t)=>e===t,sqr:t=>$h(t*t,e),add:(t,r)=>$h(t+r,e),sub:(t,r)=>$h(t-r,e),mul:(t,r)=>$h(t*r,e),pow:(e,t)=>function(e,t,r){if(r<Fh)throw new Error("Expected power > 0");if(r===Fh)return e.ONE;if(r===Uh)return t;let n=e.ONE,i=t;for(;r>Fh;)r&Uh&&(n=e.mul(n,i)),i=e.sqr(i),r>>=Uh;return n}(a,e,t),div:(t,r)=>$h(t*Wh(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Wh(t,e),sqrt:n.sqrt||(e=>o(a,e)),invertBatch:e=>function(e,t){const r=new Array(t.length),n=t.reduce((t,n,i)=>e.is0(n)?t:(r[i]=t,e.mul(t,n)),e.ONE),i=e.inv(n);return t.reduceRight((t,n,i)=>e.is0(n)?t:(r[i]=e.mul(t,r[i]),e.mul(t,n)),i),r}(a,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>r?_h(e,s):Ch(e,s),fromBytes:e=>{if(e.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${e.length}`);return r?Ih(e):Ph(e)}});return Object.freeze(a)}(ff,void 0,void 0,{sqrt:function(e){const t=ff,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,l=u*u*e%t,d=Hh(l,r,t)*l%t,h=Hh(d,r,t)*l%t,f=Hh(h,mf,t)*u%t,p=Hh(f,i,t)*f%t,g=Hh(p,s,t)*p%t,m=Hh(g,a,t)*g%t,y=Hh(m,c,t)*m%t,b=Hh(y,a,t)*g%t,w=Hh(b,r,t)*l%t,v=Hh(w,o,t)*p%t,E=Hh(v,n,t)*u%t,A=Hh(E,mf,t);if(!bf.eql(bf.sqr(A),e))throw new Error("Cannot find square root");return A}}),wf=function(e,t){const r=t=>df({...e,...hf(t)});return Object.freeze({...r(t),create:r})}({a:BigInt(0),b:BigInt(7),Fp:bf,n:pf,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=pf,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-gf*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=yf(s*e,t),c=yf(-n*e,t);let u=$h(e-a*r-c*i,t),l=$h(-a*n-c*s,t);const d=u>o,h=l>o;if(d&&(u=t-u),h&&(l=t-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:d,k1:u,k2neg:h,k2:l}}}},bh);BigInt(0),wf.ProjectivePoint;const vf="0x0000000000000000000000000000000000000000000000000000000000000000",Ef=BigInt(0),Af=BigInt(1),Sf=BigInt(2),kf=BigInt(27),Rf=BigInt(28),Pf=BigInt(35),If=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Cf=If/Sf,_f=Symbol.for("nodejs.util.inspect.custom"),Tf={};function Nf(e){return ru(yu(e),32)}class xf{#g;#m;#y;#b;get r(){return this.#g}set r(e){Uc(32===Yc(e),"invalid r","value",e),this.#g=Zc(e)}get s(){return Uc(parseInt(this.#m.substring(0,3))<8,"non-canonical s; use ._s","s",this.#m),this.#m}set s(e){Uc(32===Yc(e),"invalid s","value",e),this.#m=Zc(e)}get _s(){return this.#m}isValid(){return BigInt(this.#m)<=Cf}get v(){return this.#y}set v(e){const t=pu(e,"value");Uc(27===t||28===t,"invalid v","v",e),this.#y=t}get networkV(){return this.#b}get legacyChainId(){const e=this.networkV;return null==e?null:xf.getChainId(e)}get yParity(){return 27===this.v?0:1}get yParityAndS(){const e=$c(this.s);return this.yParity&&(e[0]|=128),Zc(e)}get compactSerialized(){return Qc([this.r,this.yParityAndS])}get serialized(){return Qc([this.r,this.s,this.yParity?"0x1c":"0x1b"])}constructor(e,t,r,n){Kc(e,Tf,"Signature"),this.#g=t,this.#m=r,this.#y=n,this.#b=null}getCanonical(){if(this.isValid())return this;const e=If-BigInt(this._s),t=55-this.v,r=new xf(Tf,this.r,Nf(e),t);return this.networkV&&(r.#b=this.networkV),r}clone(){const e=new xf(Tf,this.r,this._s,this.v);return this.networkV&&(e.#b=this.networkV),e}toJSON(){const e=this.networkV;return{_type:"signature",networkV:null!=e?e.toString():null,r:this.r,s:this._s,v:this.v}}[_f](){return this.toString()}toString(){return this.isValid()?`Signature { r: ${this.r}, s: ${this._s}, v: ${this.v} }`:`Signature { r: ${this.r}, s: ${this._s}, v: ${this.v}, valid: false }`}static getChainId(e){const t=lu(e,"v");return t==kf||t==Rf?Ef:(Uc(t>=Pf,"invalid EIP-155 v","v",e),(t-Pf)/Sf)}static getChainIdV(e,t){return lu(e)*Sf+BigInt(35+t-27)}static getNormalizedV(e){const t=lu(e);return t===Ef||t===kf?27:t===Af||t===Rf?28:(Uc(t>=Pf,"invalid v","v",e),t&Af?27:28)}static from(e){function t(t,r){Uc(t,r,"signature",e)}if(null==e)return new xf(Tf,vf,vf,27);if("string"==typeof e){const r=$c(e,"signature");if(64===r.length){const e=Zc(r.slice(0,32)),t=r.slice(32,64),n=128&t[0]?28:27;return t[0]&=127,new xf(Tf,e,Zc(t),n)}if(65===r.length){const e=Zc(r.slice(0,32)),t=Zc(r.slice(32,64)),n=xf.getNormalizedV(r[64]);return new xf(Tf,e,t,n)}t(!1,"invalid raw signature length")}if(e instanceof xf)return e.clone();const r=e.r;t(null!=r,"missing r");const n=Nf(r),i=function(e,r){if(null!=e)return Nf(e);if(null!=r){t(Hc(r,32),"invalid yParityAndS");const e=$c(r);return e[0]&=127,Zc(e)}t(!1,"missing s")}(e.s,e.yParityAndS),{networkV:s,v:o}=function(e,r,n){if(null!=e){const t=lu(e);return{networkV:t>=Pf?t:void 0,v:xf.getNormalizedV(t)}}if(null!=r)return t(Hc(r,32),"invalid yParityAndS"),{v:128&$c(r)[0]?28:27};if(null!=n){switch(pu(n,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}t(!1,"invalid yParity")}t(!1,"missing v")}(e.v,e.yParityAndS,e.yParity),a=new xf(Tf,n,i,o);return s&&(a.#b=s),t(null==e.yParity||pu(e.yParity,"sig.yParity")===a.yParity,"yParity mismatch"),t(null==e.yParityAndS||e.yParityAndS===a.yParityAndS,"yParityAndS mismatch"),a}}class Of{#w;constructor(e){Uc(32===Yc(e),"invalid private key","privateKey","[REDACTED]"),this.#w=Zc(e)}get privateKey(){return this.#w}get publicKey(){return Of.computePublicKey(this.#w)}get compressedPublicKey(){return Of.computePublicKey(this.#w,!0)}sign(e){Uc(32===Yc(e),"invalid digest length","digest",e);const t=wf.sign(Vc(e),Vc(this.#w),{lowS:!0});return xf.from({r:mu(t.r,32),s:mu(t.s,32),v:t.recovery?28:27})}computeSharedSecret(e){const t=Of.computePublicKey(e);return Zc(wf.getSharedSecret(Vc(this.#w),$c(t),!1))}static computePublicKey(e,t){let r=$c(e,"key");if(32===r.length)return Zc(wf.getPublicKey(r,!!t));if(64===r.length){const e=new Uint8Array(65);e[0]=4,e.set(r,1),r=e}return Zc(wf.ProjectivePoint.fromHex(r).toRawBytes(t))}static recoverPublicKey(e,t){Uc(32===Yc(e),"invalid digest length","digest",e);const r=xf.from(t);let n=wf.Signature.fromCompact(Vc(Qc([r.r,r.s])));n=n.addRecoveryBit(r.yParity);const i=n.recoverPublicKey(Vc(e));return Uc(null!=i,"invalid signature for digest","signature",t),"0x"+i.toHex(!1)}static addPoints(e,t,r){const n=wf.ProjectivePoint.fromHex(Of.computePublicKey(e).substring(2)),i=wf.ProjectivePoint.fromHex(Of.computePublicKey(t).substring(2));return"0x"+n.add(i).toHex(!!r)}}function Df(e){let t;return t="string"==typeof e?Of.computePublicKey(e,!1):e.publicKey,Ol(Rl("0x"+t.substring(4)).substring(26))}function Mf(e,t){return Df(Of.recoverPublicKey(e,t))}const Bf=new Uint8Array(32);Bf.fill(0);const Lf=BigInt(-1),Ff=BigInt(0),Uf=BigInt(1),jf=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),zf=mu(Uf,32),qf=mu(Ff,32),Kf={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},Gf=["name","version","chainId","verifyingContract","salt"];function $f(e){return function(t){return Uc("string"==typeof t,`invalid domain value for ${JSON.stringify(e)}`,`domain.${e}`,t),t}}const Vf={name:$f("name"),version:$f("version"),chainId:function(e){const t=lu(e,"domain.chainId");return Uc(t>=0,"invalid chain ID","domain.chainId",e),Number.isSafeInteger(t)?Number(t):bu(t)},verifyingContract:function(e){try{return Ol(e).toLowerCase()}catch(e){}Uc(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",e)},salt:function(e){const t=$c(e,"domain.salt");return Uc(32===t.length,'invalid domain value "salt"',"domain.salt",e),Zc(t)}};function Hf(e){{const t=e.match(/^(u?)int(\d+)$/);if(t){const r=""===t[1],n=parseInt(t[2]);Uc(n%8==0&&0!==n&&n<=256&&t[2]===String(n),"invalid numeric width","type",e);const i=uu(jf,r?n-1:n),s=r?(i+Uf)*Lf:Ff;return function(t){const n=lu(t,"value");return Uc(n>=s&&n<=i,`value out-of-bounds for ${e}`,"value",n),mu(r?cu(n,256):n,32)}}}{const t=e.match(/^bytes(\d+)$/);if(t){const r=parseInt(t[1]);return Uc(0!==r&&r<=32&&t[1]===String(r),"invalid bytes width","type",e),function(t){return Uc($c(t).length===r,`invalid length for ${e}`,"value",t),function(e){const t=$c(e),r=t.length%32;return r?Qc([t,Bf.slice(r)]):Zc(t)}(t)}}}switch(e){case"address":return function(e){return ru(Ol(e),32)};case"bool":return function(e){return e?zf:qf};case"bytes":return function(e){return Rl(e)};case"string":return function(e){return ud(e)}}return null}function Wf(e,t){return`${e}(${t.map(({name:e,type:t})=>t+" "+e).join(",")})`}function Jf(e){const t=e.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return t?{base:t[1],index:t[2]+t[4],array:{base:t[1],prefix:t[1]+t[2],count:t[5]?parseInt(t[5]):-1}}:{base:e}}class Zf{primaryType;#v;get types(){return JSON.parse(this.#v)}#E;#A;constructor(e){this.#E=new Map,this.#A=new Map;const t=new Map,r=new Map,n=new Map,i={};Object.keys(e).forEach(s=>{i[s]=e[s].map(({name:t,type:r})=>{let{base:n,index:i}=Jf(r);return"int"!==n||e.int||(n="int256"),"uint"!==n||e.uint||(n="uint256"),{name:t,type:n+(i||"")}}),t.set(s,new Set),r.set(s,[]),n.set(s,new Set)}),this.#v=JSON.stringify(i);for(const n in i){const s=new Set;for(const o of i[n]){Uc(!s.has(o.name),`duplicate variable name ${JSON.stringify(o.name)} in ${JSON.stringify(n)}`,"types",e),s.add(o.name);const i=Jf(o.type).base;Uc(i!==n,`circular type reference to ${JSON.stringify(i)}`,"types",e),Hf(i)||(Uc(r.has(i),`unknown type ${JSON.stringify(i)}`,"types",e),r.get(i).push(n),t.get(n).add(i))}}const s=Array.from(r.keys()).filter(e=>0===r.get(e).length);Uc(0!==s.length,"missing primary type","types",e),Uc(1===s.length,`ambiguous primary types or unused types: ${s.map(e=>JSON.stringify(e)).join(", ")}`,"types",e),Oc(this,{primaryType:s[0]}),function i(s,o){Uc(!o.has(s),`circular type reference to ${JSON.stringify(s)}`,"types",e),o.add(s);for(const e of t.get(s))if(r.has(e)){i(e,o);for(const t of o)n.get(t).add(e)}o.delete(s)}(this.primaryType,new Set);for(const[e,t]of n){const r=Array.from(t);r.sort(),this.#E.set(e,Wf(e,i[e])+r.map(e=>Wf(e,i[e])).join(""))}}getEncoder(e){let t=this.#A.get(e);return t||(t=this.#S(e),this.#A.set(e,t)),t}#S(e){{const t=Hf(e);if(t)return t}const t=Jf(e).array;if(t){const e=t.prefix,r=this.getEncoder(e);return n=>{Uc(-1===t.count||t.count===n.length,`array length mismatch; expected length ${t.count}`,"value",n);let i=n.map(r);return this.#E.has(e)&&(i=i.map(Rl)),Rl(Qc(i))}}const r=this.types[e];if(r){const t=ud(this.#E.get(e));return e=>{const n=r.map(({name:t,type:r})=>{const n=this.getEncoder(r)(e[t]);return this.#E.has(r)?Rl(n):n});return n.unshift(t),Qc(n)}}Uc(!1,`unknown type: ${e}`,"type",e)}encodeType(e){const t=this.#E.get(e);return Uc(t,`unknown type: ${JSON.stringify(e)}`,"name",e),t}encodeData(e,t){return this.getEncoder(e)(t)}hashStruct(e,t){return Rl(this.encodeData(e,t))}encode(e){return this.encodeData(this.primaryType,e)}hash(e){return this.hashStruct(this.primaryType,e)}_visit(e,t,r){if(Hf(e))return r(e,t);const n=Jf(e).array;if(n)return Uc(-1===n.count||n.count===t.length,`array length mismatch; expected length ${n.count}`,"value",t),t.map(e=>this._visit(n.prefix,e,r));const i=this.types[e];if(i)return i.reduce((e,{name:n,type:i})=>(e[n]=this._visit(i,t[n],r),e),{});Uc(!1,`unknown type: ${e}`,"type",e)}visit(e,t){return this._visit(this.primaryType,e,t)}static from(e){return new Zf(e)}static getPrimaryType(e){return Zf.from(e).primaryType}static hashStruct(e,t,r){return Zf.from(t).hashStruct(e,r)}static hashDomain(e){const t=[];for(const r in e){if(null==e[r])continue;const n=Kf[r];Uc(n,`invalid typed-data domain key: ${JSON.stringify(r)}`,"domain",e),t.push({name:r,type:n})}return t.sort((e,t)=>Gf.indexOf(e.name)-Gf.indexOf(t.name)),Zf.hashStruct("EIP712Domain",{EIP712Domain:t},e)}static encode(e,t,r){return Qc(["0x1901",Zf.hashDomain(e),Zf.from(t).hash(r)])}static hash(e,t,r){return Rl(Zf.encode(e,t,r))}static async resolveNames(e,t,r,n){e=Object.assign({},e);for(const t in e)null==e[t]&&delete e[t];const i={};e.verifyingContract&&!Hc(e.verifyingContract,20)&&(i[e.verifyingContract]="0x");const s=Zf.from(t);s.visit(r,(e,t)=>("address"!==e||Hc(t,20)||(i[t]="0x"),t));for(const e in i)i[e]=await n(e);return e.verifyingContract&&i[e.verifyingContract]&&(e.verifyingContract=i[e.verifyingContract]),{domain:e,value:r=s.visit(r,(e,t)=>"address"===e&&i[t]?i[t]:t)}}static getPayload(e,t,r){Zf.hashDomain(e);const n={},i=[];Gf.forEach(t=>{const r=e[t];null!=r&&(n[t]=Vf[t](r),i.push({name:t,type:Kf[t]}))});const s=Zf.from(t);t=s.types;const o=Object.assign({},t);return Uc(null==o.EIP712Domain,"types must not contain EIP712Domain type","types.EIP712Domain",t),o.EIP712Domain=i,s.encode(r),{types:o,domain:n,primaryType:s.primaryType,message:s.visit(r,(e,t)=>{if(e.match(/^bytes(\d*)/))return Zc($c(t));if(e.match(/^u?int/))return lu(t).toString();switch(e){case"address":return t.toLowerCase();case"bool":return!!t;case"string":return Uc("string"==typeof t,"invalid string","value",t),t}Uc(!1,"unsupported type","type",e)})}}}function Qf(e,t,r,n){return Mf(Zf.hash(e,t,r),n)}function Yf(e,t){return{address:Ol(e),storageKeys:t.map((e,t)=>(Uc(Hc(e,32),"invalid slot",`storageKeys[${t}]`,e),e.toLowerCase()))}}function Xf(e){if(Array.isArray(e))return e.map((t,r)=>Array.isArray(t)?(Uc(2===t.length,"invalid slot set",`value[${r}]`,t),Yf(t[0],t[1])):(Uc(null!=t&&"object"==typeof t,"invalid address-slot set","value",e),Yf(t.address,t.storageKeys)));Uc(null!=e&&"object"==typeof e,"invalid access list","value",e);const t=Object.keys(e).map(t=>{const r=e[t].reduce((e,t)=>(e[t]=!0,e),{});return Yf(t,Object.keys(r).sort())});return t.sort((e,t)=>e.address.localeCompare(t.address)),t}function ep(e){return{address:Ol(e.address),nonce:lu(null!=e.nonce?e.nonce:0),chainId:lu(null!=e.chainId?e.chainId:0),signature:xf.from(e.signature)}}function tp(e){e=atob(e);const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return $c(t)}function rp(e){const t=$c(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return btoa(r)}function np(e){return async function(t,r){Fc(null==r||!r.cancelled,"request cancelled before sending","CANCELLED");const n=t.url.split(":")[0].toLowerCase();Fc("http"===n||"https"===n,`unsupported protocol ${n}`,"UNSUPPORTED_OPERATION",{info:{protocol:n},operation:"request"}),Fc("https"===n||!t.credentials||t.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let i=null;const s=new AbortController,o=setTimeout(()=>{i=Lc("request timeout","TIMEOUT"),s.abort()},t.timeout);r&&r.addListener(()=>{i=Lc("request cancelled","CANCELLED"),s.abort()});const a=Object.assign({},e,{method:t.method,headers:new Headers(Array.from(t)),body:t.body||void 0,signal:s.signal});let c;try{c=await fetch(t.url,a)}catch(e){if(clearTimeout(o),i)throw i;throw e}clearTimeout(o);const u={};c.headers.forEach((e,t)=>{u[t.toLowerCase()]=e});const l=await c.arrayBuffer(),d=null==l?null:new Uint8Array(l);return{statusCode:c.status,statusMessage:c.statusText,headers:u,body:d}}}np({});let ip=np();const sp=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),op=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let ap=!1;async function cp(e,t){try{const t=e.match(sp);if(!t)throw new Error("invalid data");return new gp(200,"OK",{"content-type":t[1]||"text/plain"},t[2]?tp(t[3]):id(t[3].replace(/%([0-9a-f][0-9a-f])/gi,(e,t)=>String.fromCharCode(parseInt(t,16)))))}catch(t){return new gp(599,"BAD REQUEST (invalid data: URI)",{},null,new pp(e))}}function up(e){return async function(t,r){try{const r=t.match(op);if(!r)throw new Error("invalid link");return new pp(`${e}${r[2]}`)}catch(e){return new gp(599,"BAD REQUEST (invalid IPFS URI)",{},null,new pp(t))}}}const lp={data:cp,ipfs:up("https://gateway.ipfs.io/ipfs/")},dp=new WeakMap;class hp{#k;#R;constructor(e){this.#k=[],this.#R=!1,dp.set(e,()=>{if(!this.#R){this.#R=!0;for(const e of this.#k)setTimeout(()=>{e()},0);this.#k=[]}})}addListener(e){Fc(!this.#R,"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),this.#k.push(e)}get cancelled(){return this.#R}checkSignal(){Fc(!this.cancelled,"cancelled","CANCELLED",{})}}function fp(e){if(null==e)throw new Error("missing signal; should not happen");return e.checkSignal(),e}class pp{#P;#I;#C;#_;#T;#N;#x;#O;#D;#M;#B;#L;#F;#U;#j;get url(){return this.#N}set url(e){this.#N=String(e)}get body(){return null==this.#x?null:new Uint8Array(this.#x)}set body(e){if(null==e)this.#x=void 0,this.#O=void 0;else if("string"==typeof e)this.#x=id(e),this.#O="text/plain";else if(e instanceof Uint8Array)this.#x=e,this.#O="application/octet-stream";else{if("object"!=typeof e)throw new Error("invalid body");this.#x=id(JSON.stringify(e)),this.#O="application/json"}}hasBody(){return null!=this.#x}get method(){return this.#_?this.#_:this.hasBody()?"POST":"GET"}set method(e){null==e&&(e=""),this.#_=String(e).toUpperCase()}get headers(){const e=Object.assign({},this.#C);return this.#D&&(e.authorization=`Basic ${rp(id(this.#D))}`),this.allowGzip&&(e["accept-encoding"]="gzip"),null==e["content-type"]&&this.#O&&(e["content-type"]=this.#O),this.body&&(e["content-length"]=String(this.body.length)),e}getHeader(e){return this.headers[e.toLowerCase()]}setHeader(e,t){this.#C[String(e).toLowerCase()]=String(t)}clearHeaders(){this.#C={}}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let r=0;return{next:()=>{if(r<t.length){const n=t[r++];return{value:[n,e[n]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return this.#D||null}setCredentials(e,t){Uc(!e.match(/:/),"invalid basic authentication username","username","[REDACTED]"),this.#D=`${e}:${t}`}get allowGzip(){return this.#I}set allowGzip(e){this.#I=!!e}get allowInsecureAuthentication(){return!!this.#P}set allowInsecureAuthentication(e){this.#P=!!e}get timeout(){return this.#T}set timeout(e){Uc(e>=0,"timeout must be non-zero","timeout",e),this.#T=e}get preflightFunc(){return this.#M||null}set preflightFunc(e){this.#M=e}get processFunc(){return this.#B||null}set processFunc(e){this.#B=e}get retryFunc(){return this.#L||null}set retryFunc(e){this.#L=e}get getUrlFunc(){return this.#j||ip}set getUrlFunc(e){this.#j=e}constructor(e){this.#N=String(e),this.#P=!1,this.#I=!0,this.#C={},this.#_="",this.#T=3e5,this.#U={slotInterval:250,maxAttempts:12},this.#j=null}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${this.#x?Zc(this.#x):"null"}>`}setThrottleParams(e){null!=e.slotInterval&&(this.#U.slotInterval=e.slotInterval),null!=e.maxAttempts&&(this.#U.maxAttempts=e.maxAttempts)}async#z(e,t,r,n,i){if(e>=this.#U.maxAttempts)return i.makeServerError("exceeded maximum retry limit");Fc(mp()<=t,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:n}),r>0&&await function(e){return new Promise(t=>setTimeout(t,e))}(r);let s=this.clone();const o=(s.url.split(":")[0]||"").toLowerCase();if(o in lp){const e=await lp[o](s.url,fp(n.#F));if(e instanceof gp){let t=e;if(this.processFunc){fp(n.#F);try{t=await this.processFunc(s,t)}catch(e){null!=e.throttle&&"number"==typeof e.stall||t.makeServerError("error in post-processing function",e).assertOk()}}return t}s=e}this.preflightFunc&&(s=await this.preflightFunc(s));const a=await this.getUrlFunc(s,fp(n.#F));let c=new gp(a.statusCode,a.statusMessage,a.headers,a.body,n);if(301===c.statusCode||302===c.statusCode){try{const r=c.headers.location||"";return s.redirect(r).#z(e+1,t,0,n,c)}catch(e){}return c}if(429===c.statusCode&&(null==this.retryFunc||await this.retryFunc(s,c,e))){const r=c.headers["retry-after"];let i=this.#U.slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return"string"==typeof r&&r.match(/^[1-9][0-9]*$/)&&(i=parseInt(r)),s.clone().#z(e+1,t,i,n,c)}if(this.processFunc){fp(n.#F);try{c=await this.processFunc(s,c)}catch(r){null!=r.throttle&&"number"==typeof r.stall||c.makeServerError("error in post-processing function",r).assertOk();let i=this.#U.slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return r.stall>=0&&(i=r.stall),s.clone().#z(e+1,t,i,n,c)}}return c}send(){return Fc(null==this.#F,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),this.#F=new hp(this),this.#z(0,mp()+this.timeout,0,this,new gp(0,"",{},null,this))}cancel(){Fc(null!=this.#F,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const e=dp.get(this);if(!e)throw new Error("missing signal; should not happen");e()}redirect(e){const t=this.url.split(":")[0].toLowerCase(),r=e.split(":")[0].toLowerCase();Fc("GET"===this.method&&("https"!==t||"http"!==r)&&e.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(e)})`});const n=new pp(e);return n.method="GET",n.allowGzip=this.allowGzip,n.timeout=this.timeout,n.#C=Object.assign({},this.#C),this.#x&&(n.#x=new Uint8Array(this.#x)),n.#O=this.#O,n}clone(){const e=new pp(this.url);return e.#_=this.#_,this.#x&&(e.#x=this.#x),e.#O=this.#O,e.#C=Object.assign({},this.#C),e.#D=this.#D,this.allowGzip&&(e.allowGzip=!0),e.timeout=this.timeout,this.allowInsecureAuthentication&&(e.allowInsecureAuthentication=!0),e.#M=this.#M,e.#B=this.#B,e.#L=this.#L,e.#U=Object.assign({},this.#U),e.#j=this.#j,e}static lockConfig(){ap=!0}static getGateway(e){return lp[e.toLowerCase()]||null}static registerGateway(e,t){if("http"===(e=e.toLowerCase())||"https"===e)throw new Error(`cannot intercept ${e}; use registerGetUrl`);if(ap)throw new Error("gateways locked");lp[e]=t}static registerGetUrl(e){if(ap)throw new Error("gateways locked");ip=e}static createGetUrlFunc(e){return np(e)}static createDataGateway(){return cp}static createIpfsGatewayFunc(e){return up(e)}}class gp{#q;#K;#C;#x;#G;#$;toString(){return`<FetchResponse status=${this.statusCode} body=${this.#x?Zc(this.#x):"null"}>`}get statusCode(){return this.#q}get statusMessage(){return this.#K}get headers(){return Object.assign({},this.#C)}get body(){return null==this.#x?null:new Uint8Array(this.#x)}get bodyText(){try{return null==this.#x?"":sd(this.#x)}catch(e){Fc(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch(e){Fc(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let r=0;return{next:()=>{if(r<t.length){const n=t[r++];return{value:[n,e[n]],done:!1}}return{value:void 0,done:!0}}}}constructor(e,t,r,n,i){this.#q=e,this.#K=t,this.#C=Object.keys(r).reduce((e,t)=>(e[t.toLowerCase()]=String(r[t]),e),{}),this.#x=null==n?null:new Uint8Array(n),this.#G=i||null,this.#$={message:""}}makeServerError(e,t){let r;r=e?`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${e})`:`CLIENT ESCALATED SERVER ERROR (${e=`${this.statusCode} ${this.statusMessage}`})`;const n=new gp(599,r,this.headers,this.body,this.#G||void 0);return n.#$={message:e,error:t},n}throwThrottleError(e,t){null==t?t=-1:Uc(Number.isInteger(t)&&t>=0,"invalid stall timeout","stall",t);const r=new Error(e||"throttling requests");throw Oc(r,{stall:t,throttle:!0}),r}getHeader(e){return this.headers[e.toLowerCase()]}hasBody(){return null!=this.#x}get request(){return this.#G}ok(){return""===this.#$.message&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:e,error:t}=this.#$;""===e&&(e=`server response ${this.statusCode} ${this.statusMessage}`);let r=null;this.request&&(r=this.request.url);let n=null;try{this.#x&&(n=sd(this.#x))}catch(e){}Fc(!1,e,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:t,info:{requestUrl:r,responseBody:n,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}}function mp(){return(new Date).getTime()}const yp="0x0000000000000000000000000000000000000000";class bp{fragment;name;signature;topic;args;constructor(e,t,r){const n=e.name,i=e.format();Oc(this,{fragment:e,name:n,signature:i,topic:t,args:r})}}class wp{fragment;name;args;signature;selector;value;constructor(e,t,r,n){const i=e.name,s=e.format();Oc(this,{fragment:e,name:i,args:r,signature:s,selector:t,value:n})}}class vp{fragment;name;args;signature;selector;constructor(e,t,r){const n=e.name,i=e.format();Oc(this,{fragment:e,name:n,args:r,signature:i,selector:t})}}class Ep{hash;_isIndexed;static isIndexed(e){return!(!e||!e._isIndexed)}constructor(e){Oc(this,{hash:e,_isIndexed:!0})}}const Ap={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},Sp={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:e=>`reverted with reason string ${JSON.stringify(e)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:e=>{let t="unknown panic code";return e>=0&&e<=255&&Ap[e.toString()]&&(t=Ap[e.toString()]),`reverted with panic code 0x${e.toString(16)} (${t})`}}};class kp{fragments;deploy;fallback;receive;#V;#H;#W;#J;constructor(e){let t=[];t="string"==typeof e?JSON.parse(e):e,this.#W=new Map,this.#V=new Map,this.#H=new Map;const r=[];for(const e of t)try{r.push(Vd.from(e))}catch(t){console.log(`[Warning] Invalid Fragment ${JSON.stringify(e)}:`,t.message)}Oc(this,{fragments:Object.freeze(r)});let n=null,i=!1;this.#J=this.getAbiCoder(),this.fragments.forEach((e,t)=>{let r;switch(e.type){case"constructor":return this.deploy?void console.log("duplicate definition - constructor"):void Oc(this,{deploy:e});case"fallback":return void(0===e.inputs.length?i=!0:(Uc(!n||e.payable!==n.payable,"conflicting fallback fragments",`fragments[${t}]`,e),n=e,i=n.payable));case"function":r=this.#W;break;case"event":r=this.#H;break;case"error":r=this.#V;break;default:return}const s=e.format();r.has(s)||r.set(s,e)}),this.deploy||Oc(this,{deploy:Qd.from("constructor()")}),Oc(this,{fallback:n,receive:i})}format(e){const t=e?"minimal":"full",r=this.fragments.map(e=>e.format(t));return r}formatJson(){const e=this.fragments.map(e=>e.format("json"));return JSON.stringify(e.map(e=>JSON.parse(e)))}getAbiCoder(){return oh.defaultAbiCoder()}#Z(e,t,r){if(Hc(e)){const t=e.toLowerCase();for(const e of this.#W.values())if(t===e.selector)return e;return null}if(-1===e.indexOf("(")){const n=[];for(const[t,r]of this.#W)t.split("(")[0]===e&&n.push(r);if(t){const e=t.length>0?t[t.length-1]:null;let r=t.length,i=!0;Ul.isTyped(e)&&"overrides"===e.type&&(i=!1,r--);for(let e=n.length-1;e>=0;e--){const t=n[e].inputs.length;t===r||i&&t===r-1||n.splice(e,1)}for(let e=n.length-1;e>=0;e--){const r=n[e].inputs;for(let i=0;i<t.length;i++)if(Ul.isTyped(t[i])){if(i>=r.length){if("overrides"===t[i].type)continue;n.splice(e,1);break}if(t[i].type!==r[i].baseType){n.splice(e,1);break}}}}if(1===n.length&&t&&t.length!==n[0].inputs.length){const e=t[t.length-1];(null==e||Array.isArray(e)||"object"!=typeof e)&&n.splice(0,1)}return 0===n.length?null:(n.length>1&&r&&Uc(!1,`ambiguous function description (i.e. matches ${n.map(e=>JSON.stringify(e.format())).join(", ")})`,"key",e),n[0])}return this.#W.get(Xd.from(e).format())||null}getFunctionName(e){const t=this.#Z(e,null,!1);return Uc(t,"no matching function","key",e),t.name}hasFunction(e){return!!this.#Z(e,null,!1)}getFunction(e,t){return this.#Z(e,t||null,!0)}forEachFunction(e){const t=Array.from(this.#W.keys());t.sort((e,t)=>e.localeCompare(t));for(let r=0;r<t.length;r++){const n=t[r];e(this.#W.get(n),r)}}#Q(e,t,r){if(Hc(e)){const t=e.toLowerCase();for(const e of this.#H.values())if(t===e.topicHash)return e;return null}if(-1===e.indexOf("(")){const n=[];for(const[t,r]of this.#H)t.split("(")[0]===e&&n.push(r);if(t){for(let e=n.length-1;e>=0;e--)n[e].inputs.length<t.length&&n.splice(e,1);for(let e=n.length-1;e>=0;e--){const r=n[e].inputs;for(let i=0;i<t.length;i++)if(Ul.isTyped(t[i])&&t[i].type!==r[i].baseType){n.splice(e,1);break}}}return 0===n.length?null:(n.length>1&&r&&Uc(!1,`ambiguous event description (i.e. matches ${n.map(e=>JSON.stringify(e.format())).join(", ")})`,"key",e),n[0])}return this.#H.get(Zd.from(e).format())||null}getEventName(e){const t=this.#Q(e,null,!1);return Uc(t,"no matching event","key",e),t.name}hasEvent(e){return!!this.#Q(e,null,!1)}getEvent(e,t){return this.#Q(e,t||null,!0)}forEachEvent(e){const t=Array.from(this.#H.keys());t.sort((e,t)=>e.localeCompare(t));for(let r=0;r<t.length;r++){const n=t[r];e(this.#H.get(n),r)}}getError(e,t){if(Hc(e)){const t=e.toLowerCase();if(Sp[t])return Jd.from(Sp[t].signature);for(const e of this.#V.values())if(t===e.selector)return e;return null}if(-1===e.indexOf("(")){const t=[];for(const[r,n]of this.#V)r.split("(")[0]===e&&t.push(n);return 0===t.length?"Error"===e?Jd.from("error Error(string)"):"Panic"===e?Jd.from("error Panic(uint256)"):null:(t.length>1&&Uc(!1,`ambiguous error description (i.e. ${t.map(e=>JSON.stringify(e.format())).join(", ")})`,"name",e),t[0])}if("Error(string)"===(e=Jd.from(e).format()))return Jd.from("error Error(string)");if("Panic(uint256)"===e)return Jd.from("error Panic(uint256)");return this.#V.get(e)||null}forEachError(e){const t=Array.from(this.#V.keys());t.sort((e,t)=>e.localeCompare(t));for(let r=0;r<t.length;r++){const n=t[r];e(this.#V.get(n),r)}}_decodeParams(e,t){return this.#J.decode(e,t)}_encodeParams(e,t){return this.#J.encode(e,t)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeErrorResult(e,t){if("string"==typeof e){const t=this.getError(e);Uc(t,"unknown error","fragment",e),e=t}return Uc(Xc(t,0,4)===e.selector,`data signature does not match error ${e.name}.`,"data",t),this._decodeParams(e.inputs,Xc(t,4))}encodeErrorResult(e,t){if("string"==typeof e){const t=this.getError(e);Uc(t,"unknown error","fragment",e),e=t}return Qc([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionData(e,t){if("string"==typeof e){const t=this.getFunction(e);Uc(t,"unknown function","fragment",e),e=t}return Uc(Xc(t,0,4)===e.selector,`data signature does not match function ${e.name}.`,"data",t),this._decodeParams(e.inputs,Xc(t,4))}encodeFunctionData(e,t){if("string"==typeof e){const t=this.getFunction(e);Uc(t,"unknown function","fragment",e),e=t}return Qc([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionResult(e,t){if("string"==typeof e){const t=this.getFunction(e);Uc(t,"unknown function","fragment",e),e=t}let r="invalid length for result data";const n=Vc(t);if(n.length%32==0)try{return this.#J.decode(e.outputs,n)}catch(e){r="could not decode result data"}Fc(!1,r,"BAD_DATA",{value:Zc(n),info:{method:e.name,signature:e.format()}})}makeError(e,t){const r=$c(e,"data"),n=oh.getBuiltinCallException("call",t,r);if(n.message.startsWith("execution reverted (unknown custom error)")){const e=Zc(r.slice(0,4)),t=this.getError(e);if(t)try{const e=this.#J.decode(t.inputs,r.slice(4));n.revert={name:t.name,signature:t.format(),args:e},n.reason=n.revert.signature,n.message=`execution reverted: ${n.reason}`}catch(e){n.message="execution reverted (coult not decode custom error)"}}const i=this.parseTransaction(t);return i&&(n.invocation={method:i.name,signature:i.signature,args:i.args}),n}encodeFunctionResult(e,t){if("string"==typeof e){const t=this.getFunction(e);Uc(t,"unknown function","fragment",e),e=t}return Zc(this.#J.encode(e.outputs,t||[]))}encodeFilterTopics(e,t){if("string"==typeof e){const t=this.getEvent(e);Uc(t,"unknown event","eventFragment",e),e=t}Fc(t.length<=e.inputs.length,`too many arguments for ${e.format()}`,"UNEXPECTED_ARGUMENT",{count:t.length,expectedCount:e.inputs.length});const r=[];e.anonymous||r.push(e.topicHash);const n=(e,t)=>"string"===e.type?ud(t):"bytes"===e.type?Rl(Zc(t)):("bool"===e.type&&"boolean"==typeof t?t=t?"0x01":"0x00":e.type.match(/^u?int/)?t=mu(t):e.type.match(/^bytes/)?t=nu(t,32):"address"===e.type&&this.#J.encode(["address"],[t]),ru(Zc(t),32));for(t.forEach((t,i)=>{const s=e.inputs[i];s.indexed?null==t?r.push(null):"array"===s.baseType||"tuple"===s.baseType?Uc(!1,"filtering with tuples or arrays not supported","contract."+s.name,t):Array.isArray(t)?r.push(t.map(e=>n(s,e))):r.push(n(s,t)):Uc(null==t,"cannot filter non-indexed parameters; must be null","contract."+s.name,t)});r.length&&null===r[r.length-1];)r.pop();return r}encodeEventLog(e,t){if("string"==typeof e){const t=this.getEvent(e);Uc(t,"unknown event","eventFragment",e),e=t}const r=[],n=[],i=[];return e.anonymous||r.push(e.topicHash),Uc(t.length===e.inputs.length,"event arguments/values mismatch","values",t),e.inputs.forEach((e,s)=>{const o=t[s];if(e.indexed)if("string"===e.type)r.push(ud(o));else if("bytes"===e.type)r.push(Rl(o));else{if("tuple"===e.baseType||"array"===e.baseType)throw new Error("not implemented");r.push(this.#J.encode([e.type],[o]))}else n.push(e),i.push(o)}),{data:this.#J.encode(n,i),topics:r}}decodeEventLog(e,t,r){if("string"==typeof e){const t=this.getEvent(e);Uc(t,"unknown event","eventFragment",e),e=t}if(null!=r&&!e.anonymous){const t=e.topicHash;Uc(Hc(r[0],32)&&r[0].toLowerCase()===t,"fragment/topic mismatch","topics[0]",r[0]),r=r.slice(1)}const n=[],i=[],s=[];e.inputs.forEach((e,t)=>{e.indexed?"string"===e.type||"bytes"===e.type||"tuple"===e.baseType||"array"===e.baseType?(n.push($d.from({type:"bytes32",name:e.name})),s.push(!0)):(n.push(e),s.push(!1)):(i.push(e),s.push(!1))});const o=null!=r?this.#J.decode(n,Qc(r)):null,a=this.#J.decode(i,t,!0),c=[],u=[];let l=0,d=0;return e.inputs.forEach((e,t)=>{let r=null;if(e.indexed)if(null==o)r=new Ep(null);else if(s[t])r=new Ep(o[d++]);else try{r=o[d++]}catch(e){r=e}else try{r=a[l++]}catch(e){r=e}c.push(r),u.push(e.name||null)}),Cu.fromItems(c,u)}parseTransaction(e){const t=$c(e.data,"tx.data"),r=lu(null!=e.value?e.value:0,"tx.value"),n=this.getFunction(Zc(t.slice(0,4)));if(!n)return null;const i=this.#J.decode(n.inputs,t.slice(4));return new wp(n,n.selector,i,r)}parseCallResult(e){throw new Error("@TODO")}parseLog(e){const t=this.getEvent(e.topics[0]);return!t||t.anonymous?null:new bp(t,t.topicHash,this.decodeEventLog(t,e.data,e.topics))}parseError(e){const t=Zc(e),r=this.getError(Xc(t,0,4));if(!r)return null;const n=this.#J.decode(r.inputs,Xc(t,4));return new vp(r,r.selector,n)}static from(e){return e instanceof kp?e:"string"==typeof e?new kp(JSON.parse(e)):"function"==typeof e.formatJson?new kp(e.formatJson()):"function"==typeof e.format?new kp(e.format("json")):new kp(e)}}const Rp=BigInt(0);function Pp(e){return null==e?null:e}function Ip(e){return null==e?null:e.toString()}class Cp{gasPrice;maxFeePerGas;maxPriorityFeePerGas;constructor(e,t,r){Oc(this,{gasPrice:Pp(e),maxFeePerGas:Pp(t),maxPriorityFeePerGas:Pp(r)})}toJSON(){const{gasPrice:e,maxFeePerGas:t,maxPriorityFeePerGas:r}=this;return{_type:"FeeData",gasPrice:Ip(e),maxFeePerGas:Ip(t),maxPriorityFeePerGas:Ip(r)}}}function _p(e){const t={};e.to&&(t.to=e.to),e.from&&(t.from=e.from),e.data&&(t.data=Zc(e.data));const r="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const n of r)n in e&&null!=e[n]&&(t[n]=lu(e[n],`request.${n}`));const n="type,nonce".split(/,/);for(const r of n)r in e&&null!=e[r]&&(t[r]=pu(e[r],`request.${r}`));return e.accessList&&(t.accessList=Xf(e.accessList)),e.authorizationList&&(t.authorizationList=e.authorizationList.slice()),"blockTag"in e&&(t.blockTag=e.blockTag),"enableCcipRead"in e&&(t.enableCcipRead=!!e.enableCcipRead),"customData"in e&&(t.customData=e.customData),"blobVersionedHashes"in e&&e.blobVersionedHashes&&(t.blobVersionedHashes=e.blobVersionedHashes.slice()),"kzg"in e&&(t.kzg=e.kzg),"blobWrapperVersion"in e&&(t.blobWrapperVersion=e.blobWrapperVersion),"blobs"in e&&e.blobs&&(t.blobs=e.blobs.map(e=>Wc(e)?Zc(e):Object.assign({},e))),t}class Tp{provider;number;hash;timestamp;parentHash;parentBeaconBlockRoot;nonce;difficulty;gasLimit;gasUsed;stateRoot;receiptsRoot;blobGasUsed;excessBlobGas;miner;prevRandao;extraData;baseFeePerGas;#Y;constructor(e,t){this.#Y=e.transactions.map(e=>"string"!=typeof e?new Op(e,t):e),Oc(this,{provider:t,hash:Pp(e.hash),number:e.number,timestamp:e.timestamp,parentHash:e.parentHash,parentBeaconBlockRoot:e.parentBeaconBlockRoot,nonce:e.nonce,difficulty:e.difficulty,gasLimit:e.gasLimit,gasUsed:e.gasUsed,blobGasUsed:e.blobGasUsed,excessBlobGas:e.excessBlobGas,miner:e.miner,prevRandao:Pp(e.prevRandao),extraData:e.extraData,baseFeePerGas:Pp(e.baseFeePerGas),stateRoot:e.stateRoot,receiptsRoot:e.receiptsRoot})}get transactions(){return this.#Y.map(e=>"string"==typeof e?e:e.hash)}get prefetchedTransactions(){const e=this.#Y.slice();return 0===e.length?[]:(Fc("object"==typeof e[0],"transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),e)}toJSON(){const{baseFeePerGas:e,difficulty:t,extraData:r,gasLimit:n,gasUsed:i,hash:s,miner:o,prevRandao:a,nonce:c,number:u,parentHash:l,parentBeaconBlockRoot:d,stateRoot:h,receiptsRoot:f,timestamp:p,transactions:g}=this;return{_type:"Block",baseFeePerGas:Ip(e),difficulty:Ip(t),extraData:r,gasLimit:Ip(n),gasUsed:Ip(i),blobGasUsed:Ip(this.blobGasUsed),excessBlobGas:Ip(this.excessBlobGas),hash:s,miner:o,prevRandao:a,nonce:c,number:u,parentHash:l,timestamp:p,parentBeaconBlockRoot:d,stateRoot:h,receiptsRoot:f,transactions:g}}[Symbol.iterator](){let e=0;const t=this.transactions;return{next:()=>e<this.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}get length(){return this.#Y.length}get date(){return null==this.timestamp?null:new Date(1e3*this.timestamp)}async getTransaction(e){let t;if("number"==typeof e)t=this.#Y[e];else{const r=e.toLowerCase();for(const e of this.#Y){if("string"==typeof e){if(e!==r)continue;t=e;break}if(e.hash===r){t=e;break}}}if(null==t)throw new Error("no such tx");return"string"==typeof t?await this.provider.getTransaction(t):t}getPrefetchedTransaction(e){const t=this.prefetchedTransactions;if("number"==typeof e)return t[e];e=e.toLowerCase();for(const r of t)if(r.hash===e)return r;Uc(!1,"no matching transaction","indexOrHash",e)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return{orphan:"drop-block",hash:this.hash,number:this.number}}}class Np{provider;transactionHash;blockHash;blockNumber;removed;address;data;topics;index;transactionIndex;constructor(e,t){this.provider=t;const r=Object.freeze(e.topics.slice());Oc(this,{transactionHash:e.transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,removed:e.removed,address:e.address,data:e.data,topics:r,index:e.index,transactionIndex:e.transactionIndex})}toJSON(){const{address:e,blockHash:t,blockNumber:r,data:n,index:i,removed:s,topics:o,transactionHash:a,transactionIndex:c}=this;return{_type:"log",address:e,blockHash:t,blockNumber:r,data:n,index:i,removed:s,topics:o,transactionHash:a,transactionIndex:c}}async getBlock(){const e=await this.provider.getBlock(this.blockHash);return Fc(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransaction(){const e=await this.provider.getTransaction(this.transactionHash);return Fc(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransactionReceipt(){const e=await this.provider.getTransactionReceipt(this.transactionHash);return Fc(!!e,"failed to find transaction receipt","UNKNOWN_ERROR",{}),e}removedEvent(){return{orphan:"drop-log",log:{transactionHash:(e=this).transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,address:e.address,data:e.data,topics:Object.freeze(e.topics.slice()),index:e.index}};var e}}class xp{provider;to;from;contractAddress;hash;index;blockHash;blockNumber;logsBloom;gasUsed;blobGasUsed;cumulativeGasUsed;gasPrice;blobGasPrice;type;status;root;#X;constructor(e,t){this.#X=Object.freeze(e.logs.map(e=>new Np(e,t)));let r=Rp;null!=e.effectiveGasPrice?r=e.effectiveGasPrice:null!=e.gasPrice&&(r=e.gasPrice),Oc(this,{provider:t,to:e.to,from:e.from,contractAddress:e.contractAddress,hash:e.hash,index:e.index,blockHash:e.blockHash,blockNumber:e.blockNumber,logsBloom:e.logsBloom,gasUsed:e.gasUsed,cumulativeGasUsed:e.cumulativeGasUsed,blobGasUsed:e.blobGasUsed,gasPrice:r,blobGasPrice:e.blobGasPrice,type:e.type,status:e.status,root:e.root})}get logs(){return this.#X}toJSON(){const{to:e,from:t,contractAddress:r,hash:n,index:i,blockHash:s,blockNumber:o,logsBloom:a,logs:c,status:u,root:l}=this;return{_type:"TransactionReceipt",blockHash:s,blockNumber:o,contractAddress:r,cumulativeGasUsed:Ip(this.cumulativeGasUsed),from:t,gasPrice:Ip(this.gasPrice),blobGasUsed:Ip(this.blobGasUsed),blobGasPrice:Ip(this.blobGasPrice),gasUsed:Ip(this.gasUsed),hash:n,index:i,logs:c,logsBloom:a,root:l,status:u,to:e}}get length(){return this.logs.length}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.logs[e++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const e=await this.provider.getBlock(this.blockHash);if(null==e)throw new Error("TODO");return e}async getTransaction(){const e=await this.provider.getTransaction(this.hash);if(null==e)throw new Error("TODO");return e}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return Mp(this)}reorderedEvent(e){return Fc(!e||e.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),Dp(this,e)}}class Op{provider;blockNumber;blockHash;index;hash;type;to;from;nonce;gasLimit;gasPrice;maxPriorityFeePerGas;maxFeePerGas;maxFeePerBlobGas;data;value;chainId;signature;accessList;blobVersionedHashes;authorizationList;#ee;constructor(e,t){this.provider=t,this.blockNumber=null!=e.blockNumber?e.blockNumber:null,this.blockHash=null!=e.blockHash?e.blockHash:null,this.hash=e.hash,this.index=e.index,this.type=e.type,this.from=e.from,this.to=e.to||null,this.gasLimit=e.gasLimit,this.nonce=e.nonce,this.data=e.data,this.value=e.value,this.gasPrice=e.gasPrice,this.maxPriorityFeePerGas=null!=e.maxPriorityFeePerGas?e.maxPriorityFeePerGas:null,this.maxFeePerGas=null!=e.maxFeePerGas?e.maxFeePerGas:null,this.maxFeePerBlobGas=null!=e.maxFeePerBlobGas?e.maxFeePerBlobGas:null,this.chainId=e.chainId,this.signature=e.signature,this.accessList=null!=e.accessList?e.accessList:null,this.blobVersionedHashes=null!=e.blobVersionedHashes?e.blobVersionedHashes:null,this.authorizationList=null!=e.authorizationList?e.authorizationList:null,this.#ee=-1}toJSON(){const{blockNumber:e,blockHash:t,index:r,hash:n,type:i,to:s,from:o,nonce:a,data:c,signature:u,accessList:l,blobVersionedHashes:d}=this;return{_type:"TransactionResponse",accessList:l,blockNumber:e,blockHash:t,blobVersionedHashes:d,chainId:Ip(this.chainId),data:c,from:o,gasLimit:Ip(this.gasLimit),gasPrice:Ip(this.gasPrice),hash:n,maxFeePerGas:Ip(this.maxFeePerGas),maxPriorityFeePerGas:Ip(this.maxPriorityFeePerGas),maxFeePerBlobGas:Ip(this.maxFeePerBlobGas),nonce:a,signature:u,to:s,index:r,type:i,value:Ip(this.value)}}async getBlock(){let e=this.blockNumber;if(null==e){const t=await this.getTransaction();t&&(e=t.blockNumber)}if(null==e)return null;const t=this.provider.getBlock(e);if(null==t)throw new Error("TODO");return t}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(null==this.blockNumber){const{tx:e,blockNumber:t}=await xc({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return null==e||null==e.blockNumber?0:t-e.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(e,t){const r=null==e?1:e,n=null==t?0:t;let i=this.#ee,s=-1,o=-1===i;const a=async()=>{if(o)return null;const{blockNumber:e,nonce:t}=await xc({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(t<this.nonce)return void(i=e);if(o)return null;const n=await this.getTransaction();if(!n||null==n.blockNumber)for(-1===s&&(s=i-3,s<this.#ee&&(s=this.#ee));s<=e;){if(o)return null;const t=await this.provider.getBlock(s,!0);if(null==t)return;for(const e of t)if(e===this.hash)return;for(let n=0;n<t.length;n++){const s=await t.getTransaction(n);if(s.from===this.from&&s.nonce===this.nonce){if(o)return null;const t=await this.provider.getTransactionReceipt(s.hash);if(null==t)return;if(e-t.blockNumber+1<r)return;let n="replaced";s.data===this.data&&s.to===this.to&&s.value===this.value?n="repriced":"0x"===s.data&&s.from===s.to&&s.value===Rp&&(n="cancelled"),Fc(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:"replaced"===n||"cancelled"===n,reason:n,replacement:s.replaceableTransaction(i),hash:s.hash,receipt:t})}}s++}},c=e=>{if(null==e||0!==e.status)return e;Fc(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:e.to,from:e.from,data:""},receipt:e})},u=await this.provider.getTransactionReceipt(this.hash);if(0===r)return c(u);if(u){if(1===r||await u.confirmations()>=r)return c(u)}else if(await a(),0===r)return null;const l=new Promise((e,t)=>{const s=[],u=()=>{s.forEach(e=>e())};if(s.push(()=>{o=!0}),n>0){const e=setTimeout(()=>{u(),t(Lc("wait for transaction timeout","TIMEOUT"))},n);s.push(()=>{clearTimeout(e)})}const l=async n=>{if(await n.confirmations()>=r){u();try{e(c(n))}catch(e){t(e)}}};if(s.push(()=>{this.provider.off(this.hash,l)}),this.provider.on(this.hash,l),i>=0){const e=async()=>{try{await a()}catch(e){if(Mc(e,"TRANSACTION_REPLACED"))return u(),void t(e)}o||this.provider.once("block",e)};s.push(()=>{this.provider.off("block",e)}),this.provider.once("block",e)}});return await l}isMined(){return null!=this.blockHash}isLegacy(){return 0===this.type}isBerlin(){return 1===this.type}isLondon(){return 2===this.type}isCancun(){return 3===this.type}removedEvent(){return Fc(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Mp(this)}reorderedEvent(e){return Fc(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Fc(!e||e.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Dp(this,e)}replaceableTransaction(e){Uc(Number.isInteger(e)&&e>=0,"invalid startBlock","startBlock",e);const t=new Op(this,this.provider);return t.#ee=e,t}}function Dp(e,t){return{orphan:"reorder-transaction",tx:e,other:t}}function Mp(e){return{orphan:"drop-transaction",tx:e}}class Bp{filter;emitter;#te;constructor(e,t,r){this.#te=t,Oc(this,{emitter:e,filter:r})}async removeListener(){null!=this.#te&&await this.emitter.off(this.filter,this.#te)}}class Lp extends Np{interface;fragment;args;constructor(e,t,r){super(e,e.provider),Oc(this,{args:t.decodeEventLog(r,e.data,e.topics),fragment:r,interface:t})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class Fp extends Np{error;constructor(e,t){super(e,e.provider),Oc(this,{error:t})}}class Up extends xp{#re;constructor(e,t,r){super(r,t),this.#re=e}get logs(){return super.logs.map(e=>{const t=e.topics.length?this.#re.getEvent(e.topics[0]):null;if(t)try{return new Lp(e,this.#re,t)}catch(t){return new Fp(e,t)}return e})}}class jp extends Op{#re;constructor(e,t,r){super(r,t),this.#re=e}async wait(e,t){const r=await super.wait(e,t);return null==r?null:new Up(this.#re,this.provider,r)}}class zp extends Bp{log;constructor(e,t,r,n){super(e,t,r),Oc(this,{log:n})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class qp extends zp{constructor(e,t,r,n,i){super(e,t,r,new Lp(i,e.interface,n)),Oc(this,{args:e.interface.decodeEventLog(n,this.log.data,this.log.topics),fragment:n})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const Kp=BigInt(0);function Gp(e){return e&&"function"==typeof e.call}function $p(e){return e&&"function"==typeof e.estimateGas}function Vp(e){return e&&"function"==typeof e.resolveName}function Hp(e){return e&&"function"==typeof e.sendTransaction}function Wp(e){if(null!=e){if(Vp(e))return e;if(e.provider)return e.provider}}class Jp{#ne;fragment;constructor(e,t,r){if(Oc(this,{fragment:t}),t.inputs.length<r.length)throw new Error("too many arguments");const n=Zp(e.runner,"resolveName"),i=Vp(n)?n:null;this.#ne=async function(){const n=await Promise.all(t.inputs.map((e,t)=>null==r[t]?null:e.walkAsync(r[t],(e,t)=>"address"===e?Array.isArray(t)?Promise.all(t.map(e=>lh(e,i))):lh(t,i):t)));return e.interface.encodeFilterTopics(t,n)}()}getTopicFilter(){return this.#ne}}function Zp(e,t){return null==e?null:"function"==typeof e[t]?e:e.provider&&"function"==typeof e.provider[t]?e.provider:null}function Qp(e){return null==e?null:e.provider||null}async function Yp(e,t){const r=Ul.dereference(e,"overrides");Uc("object"==typeof r,"invalid overrides parameter","overrides",e);const n=_p(r);return Uc(null==n.to||(t||[]).indexOf("to")>=0,"cannot override to","overrides.to",n.to),Uc(null==n.data||(t||[]).indexOf("data")>=0,"cannot override data","overrides.data",n.data),n.from&&(n.from=n.from),n}async function Xp(e,t,r){const n=Zp(e,"resolveName"),i=Vp(n)?n:null;return await Promise.all(t.map((e,t)=>e.walkAsync(r[t],(e,t)=>(t=Ul.dereference(t,e),"address"===e?lh(t,i):t))))}function eg(e){const t=async function(t){const r=await Yp(t,["data"]);r.to=await e.getAddress(),r.from&&(r.from=await lh(r.from,Wp(e.runner)));const n=e.interface,i=lu(r.value||Kp,"overrides.value")===Kp,s="0x"===(r.data||"0x");return!n.fallback||n.fallback.payable||!n.receive||s||i||Uc(!1,"cannot send data to receive or send value to non-payable fallback","overrides",t),Uc(n.fallback||s,"cannot send data to receive-only contract","overrides.data",r.data),Uc(n.receive||n.fallback&&n.fallback.payable||i,"cannot send value to non-payable fallback","overrides.value",r.value),Uc(n.fallback||s,"cannot send data to receive-only contract","overrides.data",r.data),r},r=async function(r){const n=e.runner;Fc(Hp(n),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const i=await n.sendTransaction(await t(r)),s=Qp(e.runner);return new jp(e.interface,s,i)},n=async e=>await r(e);return Oc(n,{_contract:e,estimateGas:async function(r){const n=Zp(e.runner,"estimateGas");return Fc($p(n),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await n.estimateGas(await t(r))},populateTransaction:t,send:r,staticCall:async function(r){const n=Zp(e.runner,"call");Fc(Gp(n),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const i=await t(r);try{return await n.call(i)}catch(t){if(Bc(t)&&t.data)throw e.interface.makeError(t.data,i);throw t}}}),n}const tg=Symbol.for("_ethersInternal_contract"),rg=new WeakMap;function ng(e){return rg.get(e[tg])}async function ig(e,t){let r,n=null;if(Array.isArray(t)){const n=function(t){if(Hc(t,32))return t;const r=e.interface.getEvent(t);return Uc(r,"unknown fragment","name",t),r.topicHash};r=t.map(e=>null==e?null:Array.isArray(e)?e.map(n):n(e))}else"*"===t?r=[null]:"string"==typeof t?Hc(t,32)?r=[t]:(n=e.interface.getEvent(t),Uc(n,"unknown fragment","event",t),r=[n.topicHash]):(i=t)&&"object"==typeof i&&"getTopicFilter"in i&&"function"==typeof i.getTopicFilter&&i.fragment?r=await t.getTopicFilter():"fragment"in t?(n=t.fragment,r=[n.topicHash]):Uc(!1,"unknown event name","event",t);var i;return r=r.map(e=>{if(null==e)return null;if(Array.isArray(e)){const t=Array.from(new Set(e.map(e=>e.toLowerCase())).values());return 1===t.length?t[0]:(t.sort(),t)}return e.toLowerCase()}),{fragment:n,tag:r.map(e=>null==e?"null":Array.isArray(e)?e.join("|"):e).join("&"),topics:r}}async function sg(e,t){const{subs:r}=ng(e);return r.get((await ig(e,t)).tag)||null}async function og(e,t,r){const n=Qp(e.runner);Fc(n,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:t});const{fragment:i,tag:s,topics:o}=await ig(e,r),{addr:a,subs:c}=ng(e);let u=c.get(s);if(!u){const t={address:a||e,topics:o},l=t=>{let n=i;if(null==n)try{n=e.interface.getEvent(t.topics[0])}catch(e){}if(n){const s=n,o=i?e.interface.decodeEventLog(i,t.data,t.topics):[];cg(e,r,o,n=>new qp(e,n,r,s,t))}else cg(e,r,[],n=>new zp(e,n,r,t))};let d=[];u={tag:s,listeners:[],start:()=>{d.length||d.push(n.on(t,l))},stop:async()=>{if(0==d.length)return;let e=d;d=[],await Promise.all(e),n.off(t,l)}},c.set(s,u)}return u}let ag=Promise.resolve();async function cg(e,t,r,n){try{await ag}catch(e){}const i=async function(e,t,r,n){await ag;const i=await sg(e,t);if(!i)return!1;const s=i.listeners.length;return i.listeners=i.listeners.filter(({listener:t,once:i})=>{const s=Array.from(r);n&&s.push(n(i?null:t));try{t.call(e,...s)}catch(e){}return!i}),0===i.listeners.length&&(i.stop(),ng(e).subs.delete(i.tag)),s>0}(e,t,r,n);return ag=i,await i}const ug=["then"];class lg{target;interface;runner;filters;[tg];fallback;constructor(e,t,r,n){Uc("string"==typeof e||ah(e),"invalid value for Contract target","target",e),null==r&&(r=null);const i=kp.from(t);let s;Oc(this,{target:e,runner:r,interface:i}),Object.defineProperty(this,tg,{value:{}});let o=null,a=null;if(n){const e=Qp(r);a=new jp(this.interface,e,n)}let c=new Map;if("string"==typeof e)if(Hc(e))o=e,s=Promise.resolve(e);else{const t=Zp(r,"resolveName");if(!Vp(t))throw Lc("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});s=t.resolveName(e).then(t=>{if(null==t)throw Lc("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:e});return ng(this).addr=t,t})}else s=e.getAddress().then(e=>{if(null==e)throw new Error("TODO");return ng(this).addr=e,e});var u;u={addrPromise:s,addr:o,deployTx:a,subs:c},rg.set(this[tg],u);const l=new Proxy({},{get:(e,t,r)=>{if("symbol"==typeof t||ug.indexOf(t)>=0)return Reflect.get(e,t,r);try{return this.getEvent(t)}catch(e){if(!Mc(e,"INVALID_ARGUMENT")||"key"!==e.argument)throw e}},has:(e,t)=>ug.indexOf(t)>=0?Reflect.has(e,t):Reflect.has(e,t)||this.interface.hasEvent(String(t))});return Oc(this,{filters:l}),Oc(this,{fallback:i.receive||i.fallback?eg(this):null}),new Proxy(this,{get:(e,t,r)=>{if("symbol"==typeof t||t in e||ug.indexOf(t)>=0)return Reflect.get(e,t,r);try{return e.getFunction(t)}catch(e){if(!Mc(e,"INVALID_ARGUMENT")||"key"!==e.argument)throw e}},has:(e,t)=>"symbol"==typeof t||t in e||ug.indexOf(t)>=0?Reflect.has(e,t):e.interface.hasFunction(t)})}connect(e){return new lg(this.target,this.interface,e)}attach(e){return new lg(e,this.interface,this.runner)}async getAddress(){return await ng(this).addrPromise}async getDeployedCode(){const e=Qp(this.runner);Fc(e,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const t=await e.getCode(await this.getAddress());return"0x"===t?null:t}async waitForDeployment(){const e=this.deploymentTransaction();if(e)return await e.wait(),this;if(null!=await this.getDeployedCode())return this;const t=Qp(this.runner);return Fc(null!=t,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((e,r)=>{const n=async()=>{try{if(null!=await this.getDeployedCode())return e(this);t.once("block",n)}catch(e){r(e)}};n()})}deploymentTransaction(){return ng(this).deployTx}getFunction(e){"string"!=typeof e&&(e=e.format());const t=function(e,t){const r=function(...r){const n=e.interface.getFunction(t,r);return Fc(n,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t,args:r}}),n},n=async function(...t){const n=r(...t);let i={};if(n.inputs.length+1===t.length&&(i=await Yp(t.pop()),i.from&&(i.from=await lh(i.from,Wp(e.runner)))),n.inputs.length!==t.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const s=await Xp(e.runner,n.inputs,t);return Object.assign({},i,await xc({to:e.getAddress(),data:e.interface.encodeFunctionData(n,s)}))},i=async function(...e){const t=await o(...e);return 1===t.length?t[0]:t},s=async function(...t){const r=e.runner;Fc(Hp(r),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const i=await r.sendTransaction(await n(...t)),s=Qp(e.runner);return new jp(e.interface,s,i)},o=async function(...t){const i=Zp(e.runner,"call");Fc(Gp(i),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const s=await n(...t);let o="0x";try{o=await i.call(s)}catch(t){if(Bc(t)&&t.data)throw e.interface.makeError(t.data,s);throw t}const a=r(...t);return e.interface.decodeFunctionResult(a,o)},a=async(...e)=>r(...e).constant?await i(...e):await s(...e);return Oc(a,{name:e.interface.getFunctionName(t),_contract:e,_key:t,getFragment:r,estimateGas:async function(...t){const r=Zp(e.runner,"estimateGas");return Fc($p(r),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await r.estimateGas(await n(...t))},populateTransaction:n,send:s,staticCall:i,staticCallResult:o}),Object.defineProperty(a,"fragment",{configurable:!1,enumerable:!0,get:()=>{const r=e.interface.getFunction(t);return Fc(r,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t}}),r}}),a}(this,e);return t}getEvent(e){return"string"!=typeof e&&(e=e.format()),function(e,t){const r=function(...r){const n=e.interface.getEvent(t,r);return Fc(n,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t,args:r}}),n},n=function(...t){return new Jp(e,r(...t),t)};return Oc(n,{name:e.interface.getEventName(t),_contract:e,_key:t,getFragment:r}),Object.defineProperty(n,"fragment",{configurable:!1,enumerable:!0,get:()=>{const r=e.interface.getEvent(t);return Fc(r,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t}}),r}}),n}(this,e)}async queryTransaction(e){throw new Error("@TODO")}async queryFilter(e,t,r){null==t&&(t=0),null==r&&(r="latest");const{addr:n,addrPromise:i}=ng(this),s=n||await i,{fragment:o,topics:a}=await ig(this,e),c={address:s,topics:a,fromBlock:t,toBlock:r},u=Qp(this.runner);return Fc(u,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await u.getLogs(c)).map(e=>{let t=o;if(null==t)try{t=this.interface.getEvent(e.topics[0])}catch(e){}if(t)try{return new Lp(e,this.interface,t)}catch(t){return new Fp(e,t)}return new Np(e,u)})}async on(e,t){const r=await og(this,"on",e);return r.listeners.push({listener:t,once:!1}),r.start(),this}async once(e,t){const r=await og(this,"once",e);return r.listeners.push({listener:t,once:!0}),r.start(),this}async emit(e,...t){return await cg(this,e,t,null)}async listenerCount(e){if(e){const t=await sg(this,e);return t?t.listeners.length:0}const{subs:t}=ng(this);let r=0;for(const{listeners:e}of t.values())r+=e.length;return r}async listeners(e){if(e){const t=await sg(this,e);return t?t.listeners.map(({listener:e})=>e):[]}const{subs:t}=ng(this);let r=[];for(const{listeners:e}of t.values())r=r.concat(e.map(({listener:e})=>e));return r}async off(e,t){const r=await sg(this,e);if(!r)return this;if(t){const e=r.listeners.map(({listener:e})=>e).indexOf(t);e>=0&&r.listeners.splice(e,1)}return null!=t&&0!==r.listeners.length||(r.stop(),ng(this).subs.delete(r.tag)),this}async removeAllListeners(e){if(e){const t=await sg(this,e);if(!t)return this;t.stop(),ng(this).subs.delete(t.tag)}else{const{subs:e}=ng(this);for(const{tag:t,stop:r}of e.values())r(),e.delete(t)}return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return await this.off(e,t)}static buildClass(e){return class extends lg{constructor(t,r=null){super(t,e,r)}}}static from(e,t,r){return null==r&&(r=null),new this(e,t,r)}}class dg extends(function(){return lg}()){}var hg="AEEUdwmgDS8BxQKKAP4BOgDjATAAngDUAIMAoABoAOAAagCOAEQAhABMAHIAOwA9ACsANgAmAGIAHgAuACgAJwAXAC0AGgAjAB8ALwAUACkAEgAeAAkAGwARABkAFgA5ACgALQArADcAFQApABAAHgAiABAAGgAeABMAGAUhBe8BFxREN8sF2wC5AK5HAW8ArQkDzQCuhzc3NzcBP68NEfMABQdHBuw5BV8FYAA9MzkI9r4ZBg7QyQAWA9CeOwLNCjcCjqkChuA/lm+RAsXTAoP6ASfnEQDytQFJAjWVCkeXAOsA6godAB/cwdAUE0WlBCN/AQUCQRjFD/MRBjHxDQSJbw0jBzUAswBxme+tnIcAYwabAysG8QAjAEMMmxcDqgPKQyDXCMMxA7kUQwD3NXOrAKmFIAAfBC0D3x4BJQDBGdUFAhEgVD8JnwmQJiNWYUzrg0oAGwAUAB0AFnNcACkAFgBP9h3gPfsDOWDKneY2ChglX1UDYD30ABsAFAAdABZzIGRAnwDD8wAjAEEMzRbDqgMB2sAFYwXqAtCnAsS4AwpUJKRtFHsadUz9AMMVbwLpABM1NJEX0ZkCgYMBEyMAxRVvAukAEzUBUFAtmUwSAy4DBTER33EftQHfSwB5MxJ/AjkWKQLzL8E/cwBB6QH9LQDPDtO9ASNriQC5DQANAwCK21EFI91zHwCoL9kBqQcHBwcHKzUDowBvAQohPvU3fAQgHwCyAc8CKQMA5zMSezr7ULgFmDp/LzVQBgEGAi8FYQVgt8AFcTtlQhpCWEmfe5tmZ6IAExsDzQ8t+X8rBKtTAltbAn0jsy8Bl6utPWMDTR8Ei2kRANkDBrNHNysDBzECQWUAcwFpJ3kAiyUhAJ0BUb8AL3EfAbfNAz81KUsFWwF3YQZtAm0A+VEfAzEJDQBRSQCzAQBlAHsAM70GD/v3IZWHBwARKQAxALsjTwHZAeMPEzmXgIHwABIAGQA8AEUAQDt3gdvIEGcQZAkGTRFMdEIVEwK0D64L7REdDNkq09PgADSxB/MDWwfzA1sDWwfzB/MDWwfzA1sDWwNbA1scEvAi28gQZw9QBHUFlgWTBN4IiyZREYkHMAjaVBV0JhxPA00BBCMtSSQ7mzMTJUpMFE0LCAQ2SmyvfUADTzGzVP2QqgPTMlc5dAkGHnkSqAAyD3skNb1OhnpPcagKU0+2tYdJak5vAsY6sEAACikJm2/Dd1YGRRAfJ6kQ+ww3AbkBPw3xS9wE9QY/BM0fgRkdD9GVoAipLeEM8SbnLqWAXiP5KocF8Uv4POELUVFsD10LaQnnOmeBUgMlAREijwrhDT0IcRD3Cs1vDekRSQc9A9lJngCpBwULFR05FbkmFGKwCw05ewb/GvoLkyazEy17AAXXGiUGUQEtGwMA0y7rhbRaNVwgT2MGBwspI8sUrFAkDSlAu3hMGh8HGSWtApVDdEqLUToelyH6PEENai4XUYAH+TwJGVMLhTyiRq9FEhHWPpE9TCJNTDAEOYMsMyePCdMPiQy9fHYBXQklCbUMdRM1ERs3yQg9Bx0xlygnGQglRplgngT7owP3E9UDDwVDCUUHFwO5HDETMhUtBRGBKNsC9zbZLrcCk1aEARsFzw8pH+MQVEfkDu0InwJpA4cl7wAxFSUAGyKfCEdnAGOP3FMJLs8Iy2pwI3gDaxTrZRF3B5UOWwerHDcVwxzlcMxeD4YMKKezCV8BeQmdAWME5wgNNV+MpCBFZ1eLXBifIGVBQ14AAjUMaRWjRMGHfAKPD28SHwE5AXcHPQ0FAnsR8RFvEJkI74YINbkz/DopBFMhhyAVCisDU2zSCysm/Qz8bQGnEmYDEDRBd/Jnr2C6KBgBBx0yyUFkIfULlk/RDKAaxRhGVDIZ6AfDA/ca9yfuQVsGAwOnBxc6UTPyBMELbQiPCUMATQ6nGwfbGG4KdYzUATWPAbudA1uVhwJzkwY7Bw8Aaw+LBX3pACECqwinAAkA0wNbAD0CsQehAB0AiUUBQQMrMwEl6QKTA5cINc8BmTMB9y0EH8cMGQD7O25OAsO1AoBuZqYF4VwCkgJNOQFRKQQJUktVA7N15QDfAE8GF+NLARmvTs8e50cB43MvAMsA/wAJOQcJRQHRAfdxALsBYws1Caa3uQFR7S0AhwAZbwHbAo0A4QA5AIP1AVcAUQVd/QXXAlNNARU1HC9bZQG/AyMBNwERAH0Gz5GpzQsjBHEH1wIQHxXlAu8yB7kFAyLjE9FCyQK94lkAMhoKPAqrCqpgX2Q3CjV2PVQAEh+sPss/UgVVO1c7XDtXO1w7VztcO1c7XDtXO1wDm8Pmw+YKcF9JYe8Mqg3YRMw6TRPfYFVgNhPMLbsUxRXSJVoZQRrAJwkl6FUNDwgt12Y0CDA0eRfAAEMpbINFY4oeNApPHOtTlVT8LR8AtUumM7MNsBsZREQFS3XxYi4WEgomAmSFAmJGX1GzAV83JAKh+wJonAJmDQKfiDgfDwJmPwJmKgRyBIMDfxcDfpY5Cjl7GzmGOicnAmwhAjI6OA4CbcsCbbLzjgM3a0kvAWsA4gDlAE4JB5wMkQECD8YAEbkCdzMCdqZDAnlPRwJ4viFg30WyRvcCfEMCeswCfQ0CfPRIBEiBZygALxlJXEpfGRtK0ALRBQLQ0EsrA4hTA4fqRMmRNgLypV0HAwOyS9JMMSkH001QTbMCi0MCitzFHwshR2sJuwKOOwKOYESbhQKO3QKOYHxRuFM5AQ5S2FSJApP/ApMQAO0AIFUiVbNV1AosHymZijLleGpFPz0Cl6MC77ZYJawAXSkClpMCloCgAK1ZsFoNhVEAPwKWuQKWUlxIXNUCmc8CmWhczl0LHQKcnznGOqECnBoCn58CnryOACETNS4TAp31Ap6WALlBYThh8wKe1wKgcgGtAp6jIwKeUqljzGQrKS8CJ7MCJoICoP8CoFDbAqYzAqXSAqgDAIECp/ZogGi1AAdNaiBq1QKs5wKssgKtawKtBgJXIQJV4AKx5dsDH1JsmwKywRECsuwbbORtZ21MYwMl0QK2YD9DbpQDKUkCuGICuUsZArkue3A6cOUCvR0DLbYDMhUCvoxyBgMzdQK+HnMmc1MCw88CwwhzhnRPOUl05AM8qwEDPJ4DPcMCxYACxksCxhSNAshtVQLISALJUwLJMgJkoQLd1nh9ZXiyeSlL1AMYp2cGAmH4GfeVKHsPXpZevxUCz28Cz3AzT1fW9xejAMqxAs93AS3uA04Wfk8JAtwrAtuOAtJTA1JgA1NjAQUDVZCAjUMEzxrxZEl5A4LSg5EC2ssC2eKEFIRNp0ADhqkAMwNkEoZ1Xf0AWQLfaQLevHd7AuIz7RgB8zQrAfSfAfLWiwLr9wLpdH0DAur9AuroAP1LAb0C7o0C66CWrpcHAu5DA4XkmH1w5HGlAvMHAG0DjhqZlwL3FwORcgOSiwL3nAL53QL4apogmq+/O5siA52HAv7+AR8APZ8gAZ+3AwWRA6ZuA6bdANXJAwZuoYyiCQ0DDE0BEwEjB3EGZb1rCQC/BG/DFY8etxEAG3k9ACcDNxJRA42DAWcrJQCM8wAlAOanC6OVCLsGI6fJBgCvBRnDBvElRUYFFoAFcD9GSDNCKUK8X3kZX8QAls0FOgCQVCGbwTsuYDoZutcONxjOGJHJ/gVfBWAFXwVgBWsFYAVfBWAFXwVgBV8FYAVfBWBOHQjfjW8KCgoKbF7xMwTRA7kGN8PDAMMEr8MA70gxFroFTj5xPnhCR0K+X30/X/AAWBkzswCNBsxzzASm70aCRS4rDDMeLz49fnXfcsH5GcoscQFz13Y4HwVnBXLJycnACNdRYwgICAqEXoWTxgA7P4kACxbZBu21Kw0AjMsTAwkVAOVtJUUsJ1JCuULESUArXy9gPi9AKwnJRQYKTD9LPoA+iT54PnkCkULEUUpDX9NWV3JVEjQAc1w3A3IBE3YnX+g7QiMJb6MKaiszRCUuQrNCxDPMCcwEX9EWJzYREBEEBwIHKn6l33JCNVIfybPJtAltydPUCmhBZw/tEKsZAJOVJU1CLRuxbUHOQAo7P0s+eEJHHA8SJVRPdGM0NVrpvBoKhfUlM0JHHGUQUhEWO1xLSj8MO0ucNAqJIzVCRxv9EFsqKyA4OQgNj2nwZgp5ZNFgE2A1K3YHS2AhQQojJmC7DgpzGG1WYFUZCQYHZO9gHWCdYIVgu2BTYJlwFh8GvRbcXbG8YgtDHrMBwzPVyQonHQgkCyYBgQJ0Ajc4nVqIAwGSCsBPIgDsK3SWEtIVBa5N8gGjAo+kVwVIZwD/AEUSCDweX4ITrRQsJ8K3TwBXFDwEAB0TvzVcAtoTS20RIwDgVgZ9BBImYgA5AL4Coi8LFnezOkCnIQFjAY4KBAPh9RcGsgZSBsEAJctdsWIRu2kTkQstRw7DAcMBKgpPBGIGMDAwKCYnKTQaLg4AKRSVAFwCdl+YUZ0JdicFD3lPAdt1F9ZZKCGxuE3yBxkFVGcA/wBFEgiCBwAOLHQSjxOtQDg1z7deFRMAZ8QTAGtKb1ApIiPHADkAvgKiLy1DFtYCmBiDAlDDWNB0eo7fpaMO/aEVRRv0ATEQZBIODyMEAc8JQhCbDRgzFD4TAEMAu9YBCgCsAOkAm5I3ABwAYxvONnR+MhXJAxgKQyxL2+kkJhMbhQKDBMkSsvF0AD9BNQ6uQC7WqSQHwxEAEEIu1hkhAH2z4iQPwyJPHNWpdyYBRSpnJALzoBAEVPPsH20MxA0CCEQKRgAFyAtFAlMNwwjEDUQJRArELtapMg7DDZgJIw+TGukEIwvDFkMAqAtDEMMMBhioe+QAO3MMRAACrgnEBSPY9Q0FDnbSBoMAB8MSYxkSxAEJAPIJAAB8FWMOFtMc/HcXwxhDAC7DAvOowwAewwJdKDKHAAHDAALrFUQVwwAbwyvzpWMWv8wA/ABpAy++bcYDUKPD0KhDCwKmJ1MAAmMA5+UZwxAagwipBRL/eADfw6fDGOMCGsOjk3l6BwOpo4sAEsMOGxMAA5sAbcMOAAvDp0MJGkMDwgipnNIPAwfIqUMGAOGDAAPzABXDAAcDAAnDAGmTABrDAA7DChjDjnEWAwABYwAOcwAuUyYABsMAF8MIKQANUgC6wy4AA8MADqMq8wCyYgAcIwAB8wqpAAXOCx0V4wAHowBCwwEKAGnDAAuDAB3DAAjDCakABdIAbqcZ3QCZCCkABdIAAAFDAAfjAB2jCCkABqIACYMAGzMAbSMA5sOIAAhjAAhDABTDBAkpAAbSAOOTAAlDC6kOzPtnAAdDAG6kQFAATwAKwwwAA0MACbUDPwAHIwAZgwACE6cDAAojAApDAAoDp/MGwwAJIwADEwAQQwgAFEMAEXMAD5MADfMADcMAGRMOFiMAFUMAbqMWuwHDAMIAE0MLAGkzEgDhUwACQwAEWgAXgwUjAAbYABjDBSYBgzBaAEFNALcQBxUMegAwMngBrA0IZgJ0KxQHBREPd1N0ZzKRJwaIHAZqNT4DqQq8BwngAB4DAwt2AX56T1ocKQNXAh1GATQGC3tOxYNagkgAMQA5CQADAQEAWxLjAIOYNAEzAH7tFRk6TglSAF8NAAlYAQ+S1ACAQwQorQBiAN4dAJ1wPyeTANVzuQDX3AIeEMp9eyMgXiUAEdkBkJizKltbVVAaRMqRAAEAhyQ/SDEz6BmfVwB6ATEsOClKIRcDOF0E/832AFNt5AByAnkCRxGCOs94NjXdAwINGBonDBwPALW2AwICAgAAAAAAAAYDBQMDARrUAwAtAAAAAgEGBgYGBgYFBQUFBQUEBQYHCAkEBQUFBQQAAAICAAAAIgCNAJAAlT0A6gC7ANwApEQAwgCyAK0AqADuAKYA2gCjAOcBCAEDAMcAgQBiANIA1AEDAN4A8gCQAKkBMQDqAN8A3AsBCQ8yO9ra2tq8xuLT1tRJOB0BUgFcNU0BWgFpAWgBWwFMUUlLbhMBUxsNEAs6PhMOACcUKy0vMj5AQENDQ0RFFEYGJFdXV1dZWVhZL1pbXVxcI2NnZ2ZoZypsbnZ1eHh4eHh4enp6enp6enp6enp8fH18e2IARPIASQCaAHgAMgBm+ACOAFcAVwA3AnbvAIsABfj4AGQAk/IAnwBPAGIAZP//sACFAIUAaQBWALEAJAC2AIMCQAJDAPwA5wD+AP4A6AD/AOkA6QDoAOYALwJ7AVEBQAE+AVQBPgE+AT4BOQE4ATgBOAEcAVgXADEQCAEAUx8SHgsdHhYAjgCWAKYAUQBqIAIxAHYAbwCXAxUDJzIDIUlGTzEAkQJPAMcCVwKkAMAClgKWApYClgKWApYCiwKWApYClgKWApYClgKVApUCmAKgApcClgKWApQClAKUApQCkgKVAnUB1AKXAp8ClgKWApUeAIETBQD+DQOfAmECOh8BVBg9AuIZEjMbAU4/G1WZAXusRAFpYQEFA0FPAQYAmTEeIJdyADFoAHEANgCRA5zMk/C2jGINwjMWygIZCaXdfDILBCs5dAE7YnQBugDlhoiHhoiGiYqKhouOjIaNkI6Ij4qQipGGkoaThpSSlYaWhpeKmIaZhpqGm4aci52QnoqfhuIC4XTpAt90AIp0LHSoAIsAdHQEQwRABEIERQRDBEkERgRBBEcESQRIBEQERgRJAJ5udACrA490ALxuAQ10ANFZdHQA13QCFHQA/mJ0AP4BIQD+APwA/AD9APwDhGZ03ASMK23HAP4A/AD8AP0A/CR0dACRYnQA/gCRASEA/gCRAvQA/gCRA4RmdNwEjCttxyR0AP9idAEhAP4A/gD8APwA/QD8AP8A/AD8AP0A/AOEZnTcBIwrbcckdHQAkWJ0ASEA/gCRAP4AkQL0AP4AkQOEZnTcBIwrbcckdAJLAT50AlIBQXQCU8l0dAJfdHQDpgL0A6YDpgOnA6cDpwOnA4RmdNwEjCttxyR0dACRYnQBIQOmAJEDpgCRAvQDpgCRA4RmdNwEjCttxyR0BDh0AJEEOQCRDpU5dSgCADR03gV2CwArdAEFAM5iCnR0AF1iAAYcOgp0dACRCnQAXAEIwWZ0CnRmdHQAkWZ0CnRmdEXgAFF03gp0dEY0tlT2u3SOAQTwscwhjZZKrhYcBSfFp9XNbKiVDOD2b+cpe4/Z17mQnbtzzhaeQtE2GGj0IDNTjRUSyTxxw/RPHW/+vS7d1NfRt9z9QPZg4X7QFfhCnkvgNPIItOsC2eV6hPannZNHlZ9xrwZXIMOlu3jSoQSq78WEjwLjw1ELSlF1aBvfzwk5ZX7AUvQzjPQKbDuQ+sm4wNOp4A6AdVuRS0t1y/DZpg4R6m7FNjM9HgvW7Bi88zaMjOo6lM8wtBBdj8LP4ylv3zCXPhebMKJc066o9sF71oFW/8JXu86HJbwDID5lzw5GWLR/LhT0Qqnp2JQxNZNfcbLIzPy+YypqRm/lBmGmex+82+PisxUumSeJkALIT6rJezxMH+CTJmQtt5uwTVbL3ptmjDUQzlSIvWi8Tl7ng1NpuRn1Ng4n14Qc+3Iil7OwkvNWogLSPkn3pihIFytyIGmMhOe3n1tWsuMy9BdKyqF4Z3v2SgggTL9KVvMXPnCbRe+oOuFFP3HejBG/w9gvmfNYvg6JuWia2lcSSN1uIjBktzoIazOHPJZ7kKHPz8mRWVdW3lA8WGF9dQF6Bm673boov3BUWDU2JNcahR23GtfHKLOz/viZ+rYnZFaIznXO67CYEJ1fXuTRpZhYZkKe54xeoagkNGLs+NTZHE0rX45/XvQ2RGADX6vcAvdxIUBV27wxGm2zjZo4X3ILgAlrOFheuZ6wtsvaIj4yLY7qqawlliaIcrz2G+c3vscAnCkCuMzMmZvMfu9lLwTvfX+3cVSyPdN9ZwgDZhfjRgNJcLiJ67b9xx8JHswprbiE3v9UphotAPIgnXVIN5KmMc0piXhc6cChPnN+MRhG9adtdttQTTwSIpl8I4/j//d3sz1326qTBTpPRM/Hgh3kzqEXs8ZAk4ErQhNO8hzrQ0DLkWMA/N+91tn2MdOJnWC2FCZehkQrwzwbKOjhvZsbM95QoeL9skYyMf4srVPVJSgg7pOLUtr/n9eT99oe9nLtFRpjA9okV2Kj8h9k5HaC0oivRD8VyXkJ81tcd4fHNXPCfloIQasxsuO18/46dR2jgul/UIet2G0kRvnyONMKhHs6J26FEoqSqd+rfYjeEGwHWVDpX1fh1jBBcKGMqRepju9Y00mDVHC+Xdij/j44rKfvfjGinNs1jO/0F3jB83XCDINN/HB84axlP+3E/klktRo+vl3U/aiyMJbIodE1XSsDn6UAzIoMtUObY2+k/4gY/l+AkZJ5Sj2vQrkyLm3FoxjhDX+31UXBFf9XrAH31fFqoBmDEZvhvvpnZ87N+oZEu7U9O/nnk+QWj3x8uyoRbEnf+O5UMr9i0nHP38IF5AvzrBW8YWBUR0mIAzIvndQq9N3v/Jto3aPjPXUPl8ASdPPyAp7jENf8bk7VMM9ol9XGmlBmeDMuGqt+WzuL6CXAxXjIhCPM5vACchgMJ/8XBGLO/D1isVvGhwwHHr1DLaI5mn2Jr/b1pUD90uciDaS8cXNDzCWvNmT/PhQe5e8nTnnnkt8Ds/SIjibcum/fqDhKopxAY8AkSrPn+IGDEKOO+U3XOP6djFs2H5N9+orhOahiQk5KnEUWa+CzkVzhp8bMHRbg81qhjjXuIKbHjSLSIBKWqockGtKinY+z4/RdBUF6pcc3JmnlxVcNgrI4SEzKUZSwcD2QCyxzKve+gAmg6ZuSRkpPFa6mfThu7LJNu3H5K42uCpNvPAsoedolKV/LHe/eJ+BbaG5MG0NaSGVPRUmNFMFFSSpXEcXwbVh7UETOZZtoVNRGOIbbkig3McEtR68cG0RZAoJevWYo7Dg/lZ1CQzblWeUvVHmr8fY4Nqd9JJiH/zEX24mJviH60fAyFr0A3c4bC1j3yZU60VgJxXn8JgJXLUIsiBnmKmMYz+7yBQFBvqb2eYnuW59joZBf56/wXvWIR4R8wTmV80i1mZy+S4+BUES+hzjk0uXpC///z/IlqHZ1monzlXp8aCfhGKMti73FI1KbL1q6IKO4fuBuZ59gagjn5xU79muMpHXg6S+e+gDM/U9BKLHbl9l6o8czQKl4RUkJJiqftQG2i3BMg/TQlUYFkJDYBOOvAugYuzYSDnZbDDd/aSd9x0Oe6F+bJcHfl9+gp6L5/TgA+BdFFovbfCrQ40s5vMPw8866pNX8zyFGeFWdxIpPVp9Rg1UPOVFbFZrvaFq/YAzHQgqMWpahMYfqHpmwXfHL1/kpYmGuHFwT55mQu0dylfNuq2Oq0hTMCPwqfxnuBIPLXfci4Y1ANy+1CUipQxld/izVh16WyG2Q0CQQ9NqtAnx1HCHwDj7sYxOSB0wopZSnOzxQOcExmxrVTF2BkOthVpGfuhaGECfCJpJKpjnihY+xOT2QJxN61+9K6QSqtv2Shr82I3jgJrqBg0wELFZPjvHpvzTtaJnLK6Vb97Yn933koO/saN7fsjwNKzp4l2lJVx2orjCGzC/4ZL4zCver6aQYtC5sdoychuFE6ufOiog+VWi5UDkbmvmtah/3aArEBIi39s5ILUnlFLgilcGuz9CQshEY7fw2ouoILAYPVT/gyAIq3TFAIwVsl+ktkRz/qGfnCDGrm5gsl/l9QdvCWGsjPz3dU7XuqKfdUrr/6XIgjp4rey6AJBmCmUJMjITHVdFb5m1p+dLMCL8t55zD42cmftmLEJC0Da04YiRCVUBLLa8D071/N5UBNBXDh0LFsmhV/5B5ExOB4j3WVG/S3lfK5o+V6ELHvy6RR9n4ac+VsK4VE4yphPvV+kG9FegTBH4ZRXL2HytUHCduJazB/KykjfetYxOXTLws267aGOd+I+JhKP//+VnXmS90OD/jvLcVu0asyqcuYN1mSb6XTlCkqv1vigZPIYwNF/zpWcT1GR/6aEIRjkh0yhg4LXJfaGobYJTY4JI58KiAKgmmgAKWdl5nYCeLqavRJGQNuYuZtZFGx+IkI4w4NS2xwbetNMunOjBu/hmKCI/w7tfiiyUd//4rbTeWt4izBY8YvGIN6vyKYmP/8X8wHKCeN+WRcKM70+tXKNGyevU9H2Dg5BsljnTf8YbsJ1TmMs74Ce2XlHisleguhyeg44rQOHZuw/6HTkhnnurK2d62q6yS7210SsAIaR+jXMQA+svkrLpsUY+F30Uw89uOdGAR6vo4FIME0EfVVeHTu6eKicfhSqOeXJhbftcd08sWEnNUL1C9fnprTgd83IMut8onVUF0hvqzZfHduPjbjwEXIcoYmy+P6tcJZHmeOv6VrvEdkHDJecjHuHeWANe79VG662qTjA/HCvumVv3qL+LrOcpqGps2ZGwQdFJ7PU4iuyRlBrwfO+xnPyr47s2cXVbWzAyznDiBGjCM3ksxjjqM62GE9C8f5U38kB3VjtabKp/nRdvMESPGDG90bWRLAt1Qk5DyLuazRR1YzdC1c+hZXvAWV8xA72S4A8B67vjVhbba3MMop293FeEXpe7zItMWrJG/LOH9ByOXmYnNJfjmfuX9KbrpgLOba4nZ+fl8Gbdv/ihv+6wFGKHCYrVwmhFC0J3V2bn2tIB1wCc1CST3d3X2OyxhguXcs4sm679UngzofuSeBewMFJboIQHbUh/m2JhW2hG9DIvG2t7yZIzKBTz9wBtnNC+2pCRYhSIuQ1j8xsz5VvqnyUIthvuoyyu7fNIrg/KQUVmGQaqkqZk/Vx5b33/gsEs8yX7SC1J+NV4icz6bvIE7C5G6McBaI8rVg56q5QBJWxn/87Q1sPK4+sQa8fLU5gXo4paaq4cOcQ4wR0VBHPGjKh+UlPCbA1nLXyEUX45qZ8J7/Ln4FPJE2TdzD0Z8MLSNQiykMMmSyOCiFfy84Rq60emYB2vD09KjYwsoIpeDcBDTElBbXxND72yhd9pC/1CMid/5HUMvAL27OtcIJDzNKpRPNqPOpyt2aPGz9QWIs9hQ9LiX5s8m9hjTUu/f7MyIatjjd+tSfQ3ufZxPpmJhTaBtZtKLUcfOCUqADuO+QoH8B9v6U+P0HV1GLQmtoNFTb3s74ivZgjES0qfK+8RdGgBbcCMSy8eBvh98+et1KIFqSe1KQPyXULBMTsIYnysIwiZBJYdI20vseV+wuJkcqGemehKjaAb9L57xZm3g2zX0bZ2xk/fU+bCo7TlnbW7JuF1YdURo/2Gw7VclDG1W7LOtas2LX4upifZ/23rzpsnY/ALfRgrcWP5hYmV9VxVOQA1fZvp9F2UNU+7d7xRyVm5wiLp3/0dlV7vdw1PMiZrbDAYzIVqEjRY2YU03sJhPnlwIPcZUG5ltL6S8XCxU1eYS5cjr34veBmXAvy7yN4ZjArIG0dfD/5UpBNlX1ZPoxJOwyqRi3wQWtOzd4oNKh0LkoTm8cwqgIfKhqqGOhwo71I+zXnMemTv2B2AUzABWyFztGgGULjDDzWYwJUVBTjKCn5K2QGMK1CQT7SzziOjo+BhAmqBjzuc3xYym2eedGeOIRJVyTwDw37iCMe4g5Vbnsb5ZBdxOAnMT7HU4DHpxWGuQ7GeiY30Cpbvzss55+5Km1YsbD5ea3NI9QNYIXol5apgSu9dZ8f8xS5dtHpido5BclDuLWY4lhik0tbJa07yJhH0BOyEut/GRbYTS6RfiTYWGMCkNpfSHi7HvdiTglEVHKZXaVhezH4kkXiIvKopYAlPusftpE4a5IZwvw1x/eLvoDIh/zpo9FiQInsTb2SAkKHV42XYBjpJDg4374XiVb3ws4qM0s9eSQ5HzsMU4OZJKuopFjBM+dAZEl8RUMx5uU2N486Kr141tVsGQfGjORYMCJAMsxELeNT4RmWjRcpdTGBwcx6XN9drWqPmJzcrGrH4+DRc7+n1w3kPZwu0BkNr6hQrqgo7JTB9A5kdJ/H7P4cWBMwsmuixAzJB3yrQpnGIq90lxAXLzDCdn1LPibsRt7rHNjgQBklRgPZ8vTbjXdgXrTWQsK5MdrXXQVPp0Rinq3frzZKJ0qD6Qhc40VzAraUXlob1gvkhK3vpmHgI6FRlQZNx6eRqkp0zy4AQlX813fAPtL3jMRaitGFFjo0zmErloC+h+YYdVQ6k4F/epxAoF0BmqEoKNTt6j4vQZNQ2BoqF9Vj53TOIoNmDiu9Xp15RkIgQIGcoLpfoIbenzpGUAtqFJp5W+LLnx38jHeECTJ/navKY1NWfN0sY1T8/pB8kIH3DU3DX+u6W3YwpypBMYOhbSxGjq84RZ84fWJow8pyHqn4S/9J15EcCMsXqrfwyd9mhiu3+rEo9pPpoJkdZqHjra4NvzFwuThNKy6hao/SlLw3ZADUcUp3w3SRVfW2rhl80zOgTYnKE0Hs2qp1J6H3xqPqIkvUDRMFDYyRbsFI3M9MEyovPk8rlw7/0a81cDVLmBsR2ze2pBuKb23fbeZC0uXoIvDppfTwIDxk1Oq2dGesGc+oJXWJLGkOha3CX+DUnzgAp9HGH9RsPZN63Hn4RMA5eSVhPHO+9RcRb/IOgtW31V1Q5IPGtoxPjC+MEJbVlIMYADd9aHYWUIQKopuPOHmoqSkubnAKnzgKHqgIOfW5RdAgotN6BN+O2ZYHkuemLnvQ8U9THVrS1RtLmKbcC7PeeDsYznvqzeg6VCNwmr0Yyx1wnLjyT84BZz3EJyCptD3yeueAyDWIs0L2qs/VQ3HUyqfrja0V1LdDzqAikeWuV4sc7RLIB69jEIBjCkyZedoUHqCrOvShVzyd73OdrJW0hPOuQv2qOoHDc9xVb6Yu6uq3Xqp2ZaH46A7lzevbxQEmfrzvAYSJuZ4WDk1Hz3QX1LVdiUK0EvlAGAYlG3Md30r7dcPN63yqBCIj25prpvZP0nI4+EgWoFG95V596CurXpKRBGRjQlHCvy5Ib/iW8nZJWwrET3mgd6mEhfP4KCuaLjopWs7h+MdXFdIv8dHQJgg1xi1eYqB0uDYjxwVmri0Sv5XKut/onqapC+FQiC2C1lvYJ9MVco6yDYsS3AANUfMtvtbYI2hfwZatiSsnoUeMZd34GVjkMMKA+XnjJpXgRW2SHTZplVowPmJsvXy6w3cfO1AK2dvtZEKTkC/TY9LFiKHCG0DnrMQdGm2lzlBHM9iEYynH2UcVMhUEjsc0oDBTgo2ZSQ1gzkAHeWeBXYFjYLuuf8yzTCy7/RFR81WDjXMbq2BOH5dURnxo6oivmxL3cKzKInlZkD31nvpHB9Kk7GfcfE1t+1V64b9LtgeJGlpRFxQCAqWJ5DoY77ski8gsOEOr2uywZaoO/NGa0X0y1pNQHBi3b2SUGNpcZxDT7rLbBf1FSnQ8guxGW3W+36BW0gBje4DOz6Ba6SVk0xiKgt+q2JOFyr4SYfnu+Ic1QZYIuwHBrgzr6UvOcSCzPTOo7D6IC4ISeS7zkl4h+2VoeHpnG/uWR3+ysNgPcOIXQbv0n4mr3BwQcdKJxgPSeyuP/z1Jjg4e9nUvoXegqQVIE30EHx5GHv+FAVUNTowYDJgyFhf5IvlYmEqRif6+WN1MkEJmDcQITx9FX23a4mxy1AQRsOHO/+eImX9l8EMJI3oPWzVXxSOeHU1dUWYr2uAA7AMb+vAEZSbU3qob9ibCyXeypEMpZ6863o6QPqlqGHZkuWABSTVNd4cOh9hv3qEpSx2Zy/DJMP6cItEmiBJ5PFqQnDEIt3NrA3COlOSgz43D7gpNFNJ5MBh4oFzhDPiglC2ypsNU4ISywY2erkyb1NC3Qh/IfWj0eDgZI4/ln8WPfBsT3meTjq1Uqt1E7Zl/qftqkx6aM9KueMCekSnMrcHj1CqTWWzEzPsZGcDe3Ue4Ws+XFYVxNbOFF8ezkvQGR6ZOtOLU2lQEnMBStx47vE6Pb7AYMBRj2OOfZXfisjJnpTfSNjo6sZ6qSvNxZNmDeS7Gk3yYyCk1HtKN2UnhMIjOXUzAqDv90lx9O/q/AT1ZMnit5XQe9wmQxnE/WSH0CqZ9/2Hy+Sfmpeg8RwsHI5Z8kC8H293m/LHVVM/BA7HaTJYg5Enk7M/xWpq0192ACfBai2LA/qrCjCr6Dh1BIMzMXINBmX96MJ5Hn2nxln/RXPFhwHxUmSV0EV2V0jm86/dxxuYSU1W7sVkEbN9EzkG0QFwPhyHKyb3t+Fj5WoUUTErcazE/N6EW6Lvp0d//SDPj7EV9UdJN+Amnf3Wwk3A0SlJ9Z00yvXZ7n3z70G47Hfsow8Wq1JXcfwnA+Yxa5mFsgV464KKP4T31wqIgzFPd3eCe3j5ory5fBF2hgCFyVFrLzI9eetNXvM7oQqyFgDo4CTp/hDV9NMX9JDHQ/nyHTLvZLNLF6ftn2OxjGm8+PqOwhxnPHWipkE/8wbtyri80Sr7pMNkQGMfo4ZYK9OcCC4ESVFFbLMIvlxSoRqWie0wxqnLfcLSXMSpMMQEJYDVObYsXIQNv4TGNwjq1kvT1UOkicTrG3IaBZ3XdScS3u8sgeZPVpOLkbiF940FjbCeNRINNvDbd01EPBrTCPpm12m43ze1bBB59Ia6Ovhnur/Nvx3IxwSWol+3H2qfCJR8df6aQf4v6WiONxkK+IqT4pKQrZK/LplgDI/PJZbOep8dtbV7oCr6CgfpWa8NczOkPx81iSHbsNhVSJBOtrLIMrL31LK9TqHqAbAHe0RLmmV806kRLDLNEhUEJfm9u0sxpkL93Zgd6rw+tqBfTMi59xqXHLXSHwSbSBl0EK0+loECOPtrl+/nsaFe197di4yUgoe4jKoAJDXc6DGDjrQOoFDWZJ9HXwt8xDrQP+7aRwWKWI1GF8s8O4KzxWBBcwnl3vnl1Oez3oh6Ea1vjR7/z7DDTrFtqU2W/KAEzAuXDNZ7MY73MF216dzdSbWmUp4lcm7keJfWaMHgut9x5C9mj66Z0lJ+yhsjVvyiWrfk1lzPOTdhG15Y7gQlXtacvI7qv/XNSscDwqkgwHT/gUsD5yB7LdRRvJxQGYINn9hTpodKFVSTPrtGvyQw+HlRFXIkodErAGu9Iy1YpfSPc3jkFh5CX3lPxv7aqjE/JAfTIpEjGb/H7MO0e2vsViSW1qa/Lmi4/n4DEI3g7lYrcanspDfEpKkdV1OjSLOy0BCUqVoECaB55vs06rXl4jqmLsPsFM/7vYJ0vrBhDCm/00A/H81l1uekJ/6Lml3Hb9+NKiLqATJmDpyzfYZFHumEjC662L0Bwkxi7E9U4cQA0XMVDuMYAIeLMPgQaMVOd8fmt5SflFIfuBoszeAw7ow5gXPE2Y/yBc/7jExARUf/BxIHQBF5Sn3i61w4z5xJdCyO1F1X3+3ax+JSvMeZ7S6QSKp1Fp/sjYz6Z+VgCZzibGeEoujryfMulH7Rai5kAft9ebcW50DyJr2uo2z97mTWIu45YsSnNSMrrNUuG1XsYBtD9TDYzQffKB87vWbkM4EbPAFgoBV4GQS+vtFDUqOFAoi1nTtmIOvg38N4hT2Sn8r8clmBCXspBlMBYTnrqFJGBT3wZOzAyJDre9dHH7+x7qaaKDOB4UQALD5ecS0DE4obubQEiuJZ0EpBVpLuYcce8Aa4PYd/V4DLDAJBYKQPCWTcrEaZ5HYbJi11Gd6hjGom1ii18VHYnG28NKpkz2UKVPxlhYSp8uZr367iOmoy7zsxehW9wzcy2zG0a80PBMCRQMb32hnaHeOR8fnNDzZhaNYhkOdDsBUZ3loDMa1YP0uS0cjUP3b/6DBlqmZOeNABDsLl5BI5QJups8uxAuWJdkUB/pO6Zax6tsg7fN5mjjDgMGngO+DPcKqiHIDbFIGudxtPTIyDi9SFMKBDcfdGQRv41q1AqmxgkVfJMnP8w/Bc7N9/TR6C7mGObFqFkIEom8sKi2xYqJLTCHK7cxzaZvqODo22c3wisBCP4HeAgcRbNPAsBkNRhSmD48dHupdBRw4mIvtS5oeF6zeT1KMCyhMnmhpkFAGWnGscoNkwvQ8ZM5lE/vgTHFYL99OuNxdFBxTEDd5v2qLR8y9WkXsWgG6kZNndFG+pO/UAkOCipqIhL3hq7cRSdrCq7YhUsTocEcnaFa6nVkhnSeRYUA1YO0z5itF9Sly3VlxYDw239TJJH6f3EUfYO5lb7bcFcz8Bp7Oo8QmnsUHOz/fagVUBtKEw1iT88j+aKkv8cscKNkMxjYr8344D1kFoZ7/td1W6LCNYN594301tUGRmFjAzeRg5vyoM1F6+bJZ/Q54jN/k8SFd3DxPTYaAUsivsBfgTn7Mx8H2SpPt4GOdYRnEJOH6jHM2p6SgB0gzIRq6fHxGMmSmqaPCmlfwxiuloaVIitLGN8wie2CDWhkzLoCJcODh7KIOAqbHEvXdUxaS4TTTs07Clzj/6GmVs9kiZDerMxEnhUB6QQPlcfqkG9882RqHoLiHGBoHfQuXIsAG8GTAtao2KVwRnvvam8jo1e312GQAKWEa4sUVEAMG4G6ckcONDwRcg1e2D3+ohXgY4UAWF8wHKQMrSnzCgfFpsxh+aHXMGtPQroQasRY4U6UdG0rz1Vjbka0MekOGRZQEvqQFlxseFor8zWFgHek3v29+WqN6gaK5gZOTOMZzpQIC1201LkMCXild3vWXSc5UX9xcFYfbRPzGFa1FDcPfPB/jUEq/FeGt419CI3YmBlVoHsa4KdcwQP5ZSwHHhFJ7/Ph/Rap/4vmG91eDwPP0lDfCDRCLszTqfzM71xpmiKi2HwS4WlqvGNwtvwF5Dqpn6KTq8ax00UMPkxDcZrEEEsIvHiUXXEphdb4GB4FymlPwBz4Gperqq5pW7TQ6/yNRhW8VT5NhuP0udlxo4gILq5ZxAZk8ZGh3g4CqxJlPKY7AQxupfUcVpWT5VItp1+30UqoyP4wWsRo3olRRgkWZZ2ZN6VC3OZFeXB8NbnUrSdikNptD1QiGuKkr8EmSR/AK9Rw+FF3s5uwuPbvHGiPeFOViltMK7AUaOsq9+x9cndk3iJEE5LKZRlWJbKOZweROzmPNVPkjE3K/TyA57Rs68TkZ3MR8akKpm7cFjnjPd/DdkWjgYoKHSr5Wu5ssoBYU4acRs5g2DHxUmdq8VXOXRbunD8QN0LhgkssgahcdoYsNvuXGUK/KXD/7oFb+VGdhqIn02veuM5bLudJOc2Ky0GMaG4W/xWBxIJcL7yliJOXOpx0AkBqUgzlDczmLT4iILXDxxtRR1oZa2JWFgiAb43obrJnG/TZC2KSK2wqOzRZTXavZZFMb1f3bXvVaNaK828w9TO610gk8JNf3gMfETzXXsbcvRGCG9JWQZ6+cDPqc4466Yo2RcKH+PILeKOqtnlbInR3MmBeGG3FH10yzkybuqEC2HSQwpA0An7d9+73BkDUTm30bZmoP/RGbgFN+GrCOfADgqr0WbI1a1okpFms8iHYw9hm0zUvlEMivBRxModrbJJ+9/p3jUdQQ9BCtQdxnOGrT5dzRUmw0593/mbRSdBg0nRvRZM5/E16m7ZHmDEtWhwvfdZCZ8J8M12W0yRMszXamWfQTwIZ4ayYktrnscQuWr8idp3PjT2eF/jmtdhIfcpMnb+IfZY2FebW6UY/AK3jP4u3Tu4zE4qlnQgLFbM19EBIsNf7KhjdbqQ/D6yiDb+NlEi2SKD+ivXVUK8ib0oBo366gXkR8ZxGjpJIDcEgZPa9TcYe0TIbiPl/rPUQDu3XBJ9X/GNq3FAUsKsll57DzaGMrjcT+gctp+9MLYXCq+sqP81eVQ0r9lt+gcQfZbACRbEjvlMskztZG8gbC8Qn9tt26Q7y7nDrbZq/LEz7kR6Jc6pg3N9rVX8Y5MJrGlML9p9lU4jbTkKqCveeZUJjHB03m2KRKR2TytoFkTXOLg7keU1s1lrPMQJpoOKLuAAC+y1HlJucU6ysB5hsXhvSPPLq5J7JtnqHKZ4vYjC4Vy8153QY+6780xDuGARsGbOs1WqzH0QS765rnSKEbbKlkO8oI/VDwUd0is13tKpqILu1mDJFNy/iJAWcvDgjxvusIT+PGz3ST/J9r9Mtfd0jpaGeiLYIqXc7DiHSS8TcjFVksi66PEkxW1z6ujbLLUGNNYnzOWpH8BZGK4bCK7iR+MbIv8ncDAz1u4StN3vTTzewr9IQjk9wxFxn+6N1ddKs0vffJiS08N3a4G1SVrlZ97Q/M+8G9fe5AP6d9/Qq4WRnORVhofPIKEdCr3llspUfE0oKIIYoByBRPh+bX1HLS3JWGJRhIvE1aW4NTd8ePi4Z+kXb+Z8snYfSNcqijhAgVsx4RCM54cXUiYkjeBmmC4ajOHrChoELscJJC7+9jjMjw5BagZKlgRMiSNYz7h7vvZIoQqbtQmspc0cUk1G/73iXtSpROl5wtLgQi0mW2Ex8i3WULhcggx6E1LMVHUsdc9GHI1PH3U2Ko0PyGdn9KdVOLm7FPBui0i9a0HpA60MsewVE4z8CAt5d401Gv6zXlIT5Ybit1VIA0FCs7wtvYreru1fUyW3oLAZ/+aTnZrOcYRNVA8spoRtlRoWflsRClFcgzkqiHOrf0/SVw+EpVaFlJ0g4Kxq1MMOmiQdpMNpte8lMMQqm6cIFXlnGbfJllysKDi+0JJMotkqgIxOSQgU9dn/lWkeVf8nUm3iwX2Nl3WDw9i6AUK3vBAbZZrcJpDQ/N64AVwjT07Jef30GSSmtNu2WlW7YoyW2FlWfZFQUwk867EdLYKk9VG6JgEnBiBxkY7LMo4YLQJJlAo9l/oTvJkSARDF/XtyAzM8O2t3eT/iXa6wDN3WewNmQHdPfsxChU/KtLG2Mn8i4ZqKdSlIaBZadxJmRzVS/o4yA65RTSViq60oa395Lqw0pzY4SipwE0SXXsKV+GZraGSkr/RW08wPRvqvSUkYBMA9lPx4m24az+IHmCbXA+0faxTRE9wuGeO06DIXa6QlKJ3puIyiuAVfPr736vzo2pBirS+Vxel3TMm3JKhz9o2ZoRvaFVpIkykb0Hcm4oHFBMcNSNj7/4GJt43ogonY2Vg4nsDQIWxAcorpXACzgBqQPjYsE/VUpXpwNManEru4NwMCFPkXvMoqvoeLN3qyu/N1eWEHttMD65v19l/0kH2mR35iv/FI+yjoHJ9gPMz67af3Mq/BoWXqu3rphiWMXVkmnPSEkpGpUI2h1MThideGFEOK6YZHPwYzMBvpNC7+ZHxPb7epfefGyIB4JzO9DTNEYnDLVVHdQyvOEVefrk6Uv5kTQYVYWWdqrdcIl7yljwwIWdfQ/y+2QB3eR/qxYObuYyB4gTbo2in4PzarU1sO9nETkmj9/AoxDA+JM3GMqQtJR4jtduHtnoCLxd1gQUscHRB/MoRYIEsP2pDZ9KvHgtlk1iTbWWbHhohwFEYX7y51fUV2nuUmnoUcqnWIQAAgl9LTVX+Bc0QGNEhChxHR4YjfE51PUdGfsSFE6ck7BL3/hTf9jLq4G1IafINxOLKeAtO7quulYvH5YOBc+zX7CrMgWnW47/jfRsWnJjYYoE7xMfWV2HN2iyIqLI";const fg=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),pg=4;function gg(e){return function(e){let t=0;return()=>e[t++]}(function(e){let t=0;function r(){return e[t++]<<8|e[t++]}let n=r(),i=1,s=[0,1];for(let e=1;e<n;e++)s.push(i+=r());let o=r(),a=t;t+=o;let c=0,u=0;function l(){return 0==c&&(u=u<<8|e[t++],c=8),u>>--c&1}const d=2**31,h=d>>>1,f=h>>1,p=d-1;let g=0;for(let e=0;e<31;e++)g=g<<1|l();let m=[],y=0,b=d;for(;;){let e=Math.floor(((g-y+1)*i-1)/b),t=0,r=n;for(;r-t>1;){let n=t+r>>>1;e<s[n]?r=n:t=n}if(0==t)break;m.push(t);let o=y+Math.floor(b*s[t]/i),a=y+Math.floor(b*s[t+1]/i)-1;for(;0==((o^a)&h);)g=g<<1&p|l(),o=o<<1&p,a=a<<1&p|1;for(;o&~a&f;)g=g&h|g<<1&p>>>1|l(),o=o<<1^h,a=(a^h)<<1|h|1;y=o,b=1+a-o}let w=n-4;return m.map(t=>{switch(t-w){case 3:return w+65792+(e[a++]<<16|e[a++]<<8|e[a++]);case 2:return w+256+(e[a++]<<8|e[a++]);case 1:return w+e[a++];default:return t-1}})}(function(e){let t=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((e,r)=>t[e.charCodeAt(0)]=r);let r=e.length,n=new Uint8Array(6*r>>3);for(let i=0,s=0,o=0,a=0;i<r;i++)a=a<<6|t[e.charCodeAt(i)],o+=6,o>=8&&(n[s++]=a>>(o-=8));return n}(e)))}function mg(e){return 1&e?~e>>1:e>>1}function yg(e,t){let r=Array(e);for(let n=0,i=0;n<e;n++)r[n]=i+=mg(t());return r}function bg(e,t=0){let r=[];for(;;){let n=e(),i=e();if(!i)break;t+=n;for(let e=0;e<i;e++)r.push(t+e);t+=i+1}return r}function wg(e){return Eg(()=>{let t=bg(e);if(t.length)return t})}function vg(e){let t=[];for(;;){let r=e();if(0==r)break;t.push(Sg(r,e))}for(;;){let r=e()-1;if(r<0)break;t.push(kg(r,e))}return t.flat()}function Eg(e){let t=[];for(;;){let r=e(t.length);if(!r)break;t.push(r)}return t}function Ag(e,t,r){let n=Array(e).fill().map(()=>[]);for(let i=0;i<t;i++)yg(e,r).forEach((e,t)=>n[t].push(e));return n}function Sg(e,t){let r=1+t(),n=t(),i=Eg(t);return Ag(i.length,1+e,t).flatMap((e,t)=>{let[s,...o]=e;return Array(i[t]).fill().map((e,t)=>{let i=t*n;return[s+t*r,o.map(e=>e+i)]})})}function kg(e,t){return Ag(1+t(),1+e,t).map(e=>[e[0],e.slice(1)])}function Rg(e){return`{${function(e){return e.toString(16).toUpperCase().padStart(2,"0")}(e)}}`}function Pg(e){let t=e.length;if(t<4096)return String.fromCodePoint(...e);let r=[];for(let n=0;n<t;)r.push(String.fromCodePoint(...e.slice(n,n+=4096)));return r.join("")}function Ig(e,t){let r=e.length,n=r-t.length;for(let i=0;0==n&&i<r;i++)n=e[i]-t[i];return n}var Cg="AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g";const _g=44032,Tg=4352,Ng=4449,xg=4519,Og=28,Dg=21*Og,Mg=_g+19*Dg,Bg=Tg+19,Lg=Ng+21,Fg=xg+Og;function Ug(e){return e>>24&255}function jg(e){return 16777215&e}let zg,qg,Kg,Gg;function $g(e){return e>=_g&&e<Mg}function Vg(e,t){if(e>=Tg&&e<Bg&&t>=Ng&&t<Lg)return _g+(e-Tg)*Dg+(t-Ng)*Og;if($g(e)&&t>xg&&t<Fg&&(e-_g)%Og==0)return e+(t-xg);{let r=Gg.get(e);return r&&(r=r.get(t),r)?r:-1}}function Hg(e){zg||function(){let e=gg(Cg);zg=new Map(wg(e).flatMap((e,t)=>e.map(e=>[e,t+1<<24]))),qg=new Set(bg(e)),Kg=new Map,Gg=new Map;for(let[t,r]of vg(e)){if(!qg.has(t)&&2==r.length){let[e,n]=r,i=Gg.get(e);i||(i=new Map,Gg.set(e,i)),i.set(n,t)}Kg.set(t,r.reverse())}}();let t=[],r=[],n=!1;function i(e){let r=zg.get(e);r&&(n=!0,e|=r),t.push(e)}for(let n of e)for(;;){if(n<128)t.push(n);else if($g(n)){let e=n-_g,t=e%Dg/Og|0,r=e%Og;i(Tg+(e/Dg|0)),i(Ng+t),r>0&&i(xg+r)}else{let e=Kg.get(n);e?r.push(...e):i(n)}if(!r.length)break;n=r.pop()}if(n&&t.length>1){let e=Ug(t[0]);for(let r=1;r<t.length;r++){let n=Ug(t[r]);if(0==n||e<=n){e=n;continue}let i=r-1;for(;;){let r=t[i+1];if(t[i+1]=t[i],t[i]=r,!i)break;if(e=Ug(t[--i]),e<=n)break}e=Ug(t[r])}}return t}function Wg(e){return Hg(e).map(jg)}function Jg(e){return function(e){let t=[],r=[],n=-1,i=0;for(let s of e){let e=Ug(s),o=jg(s);if(-1==n)0==e?n=o:t.push(o);else if(i>0&&i>=e)0==e?(t.push(n,...r),r.length=0,n=o):r.push(o),i=e;else{let s=Vg(n,o);s>=0?n=s:0==i&&0==e?(t.push(n),n=o):(r.push(o),i=e)}}return n>=0&&t.push(n,...r),t}(Hg(e))}const Zg=45,Qg=".",Yg=65039,Xg=1,em=e=>Array.from(e);function tm(e,t){return e.P.has(t)||e.Q.has(t)}class rm extends Array{get is_emoji(){return!0}}let nm,im,sm,om,am,cm,um,lm,dm,hm,fm,pm;function gm(){if(nm)return;let e=gg(hg);const t=()=>bg(e),r=()=>new Set(t()),n=(e,t)=>t.forEach(t=>e.add(t));nm=new Map(vg(e)),im=r(),sm=t(),om=new Set(t().map(e=>sm[e])),sm=new Set(sm),am=r(),cm=r();let i=wg(e),s=e();const o=()=>{let e=new Set;return t().forEach(t=>n(e,i[t])),n(e,t()),e};um=Eg(t=>{let r=Eg(e).map(e=>e+96);if(r.length){let n=t>=s;return r[0]-=32,r=Pg(r),n&&(r=`Restricted[${r}]`),{N:r,P:o(),Q:o(),M:!e(),R:n}}}),lm=r(),dm=new Map;let a=t().concat(em(lm)).sort((e,t)=>e-t);a.forEach((t,r)=>{let n=e(),i=a[r]=n?a[r-n]:{V:[],M:new Map};i.V.push(t),lm.has(t)||dm.set(t,i)});for(let{V:e,M:t}of new Set(dm.values())){let r=[];for(let t of e){let e=um.filter(e=>tm(e,t)),i=r.find(({G:t})=>e.some(e=>t.has(e)));i||(i={G:new Set,V:[]},r.push(i)),i.V.push(t),n(i.G,e)}let i=r.flatMap(e=>em(e.G));for(let{G:e,V:n}of r){let r=new Set(i.filter(t=>!e.has(t)));for(let e of n)t.set(e,r)}}hm=new Set;let c=new Set;const u=e=>hm.has(e)?c.add(e):hm.add(e);for(let e of um){for(let t of e.P)u(t);for(let t of e.Q)u(t)}for(let e of hm)dm.has(e)||c.has(e)||dm.set(e,Xg);n(hm,Wg(hm)),fm=function(e){let t=[],r=bg(e);return function e({S:r,B:n},i,s){if(!(4&r&&s===i[i.length-1])){2&r&&(s=i[i.length-1]),1&r&&t.push(i);for(let t of n)for(let r of t.Q)e(t,[...i,r],s)}}(function t(n){return{S:e(),B:Eg(()=>{let n=bg(e).map(e=>r[e]);if(n.length)return t(n)}),Q:n}}([]),[]),t}(e).map(e=>rm.from(e)).sort(Ig),pm=new Map;for(let e of fm){let t=[pm];for(let r of e){let e=t.map(e=>{let t=e.get(r);return t||(t=new Map,e.set(r,t)),t});r===Yg?t.push(...e):t=e}for(let r of t)r.V=e}}function mm(e){return(wm(e)?"":`${ym(bm([e]))} `)+Rg(e)}function ym(e){return`"${e}"`}function bm(e,t=1/0,r=Rg){let n=[];var i;i=e[0],gm(),sm.has(i)&&n.push(""),e.length>t&&(t>>=1,e=[...e.slice(0,t),8230,...e.slice(-t)]);let s=0,o=e.length;for(let t=0;t<o;t++){let i=e[t];wm(i)&&(n.push(Pg(e.slice(s,t))),n.push(r(i)),s=t+1)}return n.push(Pg(e.slice(s,o))),n.join("")}function wm(e){return gm(),am.has(e)}function vm(e,t,r){if(!e)return[];gm();let n=0;return e.split(Qg).map(e=>{let i=function(e){let t=[];for(let r=0,n=e.length;r<n;){let n=e.codePointAt(r);r+=n<65536?1:2,t.push(n)}return t}(e),s={input:i,offset:n};n+=i.length+1;try{let e,n=s.tokens=function(e,t,r){let n=[],i=[];for(e=e.slice().reverse();e.length;){let s=Rm(e);if(s)i.length&&(n.push(t(i)),i=[]),n.push(r(s));else{let t=e.pop();if(hm.has(t))i.push(t);else{let e=nm.get(t);if(e)i.push(...e);else if(!im.has(t))throw Em(t)}}}return i.length&&n.push(t(i)),n}(i,t,r),o=n.length;if(!o)throw new Error("empty label");let a=s.output=n.flat();if(function(e){for(let t=e.lastIndexOf(95);t>0;)if(95!==e[--t])throw new Error("underscore allowed only at start")}(a),!(s.emoji=o>1||n[0].is_emoji)&&a.every(e=>e<128))!function(e){if(e.length>=4&&e[2]==Zg&&e[3]==Zg)throw new Error(`invalid label extension: "${Pg(e.slice(0,4))}"`)}(a),e="ASCII";else{let t=n.flatMap(e=>e.is_emoji?[]:e);if(t.length){if(sm.has(a[0]))throw Sm("leading combining mark");for(let e=1;e<o;e++){let t=n[e];if(!t.is_emoji&&sm.has(t[0]))throw Sm(`emoji + combining mark: "${Pg(n[e-1])} + ${bm([t[0]])}"`)}!function(e){let t=e[0],r=fg.get(t);if(r)throw Sm(`leading ${r}`);let n=e.length,i=-1;for(let s=1;s<n;s++){t=e[s];let n=fg.get(t);if(n){if(i==s)throw Sm(`${r} + ${n}`);i=s+1,r=n}}if(i==n)throw Sm(`trailing ${r}`)}(a);let r=em(new Set(t)),[i]=function(e){let t=um;for(let r of e){let e=t.filter(e=>tm(e,r));if(!e.length)throw um.some(e=>tm(e,r))?Am(t[0],r):Em(r);if(t=e,1==e.length)break}return t}(r);!function(e,t){for(let r of t)if(!tm(e,r))throw Am(e,r);if(e.M){let e=Wg(t);for(let t=1,r=e.length;t<r;t++)if(om.has(e[t])){let n=t+1;for(let i;n<r&&om.has(i=e[n]);n++)for(let r=t;r<n;r++)if(e[r]==i)throw new Error(`duplicate non-spacing marks: ${mm(i)}`);if(n-t>pg)throw new Error(`excessive non-spacing marks: ${ym(bm(e.slice(t-1,n)))} (${n-t}/${pg})`);t=n}}}(i,t),function(e,t){let r,n=[];for(let e of t){let t=dm.get(e);if(t===Xg)return;if(t){let n=t.M.get(e);if(r=r?r.filter(e=>n.has(e)):em(n),!r.length)return}else n.push(e)}if(r)for(let t of r)if(n.every(e=>tm(t,e)))throw new Error(`whole-script confusable: ${e.N}/${t.N}`)}(i,r),e=i.N}else e="Emoji"}s.type=e}catch(e){s.error=e}return s})}function Em(e){return new Error(`disallowed character: ${mm(e)}`)}function Am(e,t){let r=mm(t),n=um.find(e=>e.P.has(t));return n&&(r=`${n.N} ${r}`),new Error(`illegal mixture: ${e.N} + ${r}`)}function Sm(e){return new Error(`illegal placement: ${e}`)}function km(e){return e.filter(e=>e!=Yg)}function Rm(e,t){let r,n=pm,i=e.length;for(;i&&(n=n.get(e[--i]),n);){let{V:s}=n;s&&(r=s,t&&t.push(...e.slice(i).reverse()),e.length=i)}return r}const Pm=new Uint8Array(32);function Im(e){return Uc(0!==e.length,"invalid ENS name; empty component","comp",e),e}function Cm(e){const t=id(_m(e)),r=[];if(0===e.length)return r;let n=0;for(let e=0;e<t.length;e++)46===t[e]&&(r.push(Im(t.slice(n,e))),n=e+1);return Uc(n<t.length,"invalid ENS name; empty component","name",e),r.push(Im(t.slice(n))),r}function _m(e){try{if(0===e.length)throw new Error("empty label");return function(e){return function(e){return e.map(({input:t,error:r,output:n})=>{if(r){let n=r.message;throw new Error(1==e.length?n:`Invalid label ${ym(bm(t,63))}: ${n}`)}return Pg(n)}).join(Qg)}(vm(e,Jg,km))}(e)}catch(t){Uc(!1,`invalid ENS name (${t.message})`,"name",e)}}function Tm(e){try{return 0!==Cm(e).length}catch(e){}return!1}function Nm(e){Uc("string"==typeof e,"invalid ENS name; not a string","name",e),Uc(e.length,"invalid ENS name (empty label)","name",e);let t=Pm;const r=Cm(e);for(;r.length;)t=Rl(Qc([t,Rl(r.pop())]));return Zc(t)}function xm(e,t){const r=null!=t?t:63;return Uc(r<=255,"DNS encoded label cannot exceed 255","length",r),Zc(Qc(Cm(e).map(t=>{Uc(t.length<=r,`label ${JSON.stringify(e)} exceeds ${r} bytes`,"name",e);const n=new Uint8Array(t.length+1);return n.set(t,1),n[0]=n.length-1,n})))+"00"}function Om(e,t,r,n){const{c:i,dkLen:s,DK:o,PRF:a,PRFSalt:c}=function(e,t,r,n){Bu(e);const i=il({dkLen:32,asyncTick:10},n),{c:s,dkLen:o,asyncTick:a}=i;if(Du(s),Du(o),Du(a),s<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const c=tl(t),u=tl(r),l=new Uint8Array(o),d=ef.create(e,c),h=d._cloneInto().update(u);return{c:s,dkLen:o,asyncTick:a,DK:l,PRF:d,PRFSalt:h}}(e,t,r,n);let u;const l=new Uint8Array(4),d=Qu(l),h=new Uint8Array(a.outputLen);for(let e=1,t=0;t<s;e++,t+=a.outputLen){const r=o.subarray(t,t+a.outputLen);d.setInt32(0,e,!1),(u=c._cloneInto(u)).update(l).digestInto(h),r.set(h.subarray(0,r.length));for(let e=1;e<i;e++){a._cloneInto(u).update(h).digestInto(h);for(let e=0;e<r.length;e++)r[e]^=h[e]}}return function(e,t,r,n,i){return e.destroy(),t.destroy(),n&&n.destroy(),i.fill(0),r}(a,c,o,u,h)}Pm.fill(0);const[Dm,Mm]=(()=>Hu.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))))(),Bm=new Uint32Array(80),Lm=new Uint32Array(80);class Fm extends dh{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:i,Cl:s,Dh:o,Dl:a,Eh:c,El:u,Fh:l,Fl:d,Gh:h,Gl:f,Hh:p,Hl:g}=this;return[e,t,r,n,i,s,o,a,c,u,l,d,h,f,p,g]}set(e,t,r,n,i,s,o,a,c,u,l,d,h,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|c,this.El=0|u,this.Fh=0|l,this.Fl=0|d,this.Gh=0|h,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)Bm[r]=e.getUint32(t),Lm[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|Bm[e-15],r=0|Lm[e-15],n=Hu.rotrSH(t,r,1)^Hu.rotrSH(t,r,8)^Hu.shrSH(t,r,7),i=Hu.rotrSL(t,r,1)^Hu.rotrSL(t,r,8)^Hu.shrSL(t,r,7),s=0|Bm[e-2],o=0|Lm[e-2],a=Hu.rotrSH(s,o,19)^Hu.rotrBH(s,o,61)^Hu.shrSH(s,o,6),c=Hu.rotrSL(s,o,19)^Hu.rotrBL(s,o,61)^Hu.shrSL(s,o,6),u=Hu.add4L(i,c,Lm[e-7],Lm[e-16]),l=Hu.add4H(u,n,a,Bm[e-7],Bm[e-16]);Bm[e]=0|l,Lm[e]=0|u}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:o,Cl:a,Dh:c,Dl:u,Eh:l,El:d,Fh:h,Fl:f,Gh:p,Gl:g,Hh:m,Hl:y}=this;for(let e=0;e<80;e++){const t=Hu.rotrSH(l,d,14)^Hu.rotrSH(l,d,18)^Hu.rotrBH(l,d,41),b=Hu.rotrSL(l,d,14)^Hu.rotrSL(l,d,18)^Hu.rotrBL(l,d,41),w=l&h^~l&p,v=d&f^~d&g,E=Hu.add5L(y,b,v,Mm[e],Lm[e]),A=Hu.add5H(E,m,t,w,Dm[e],Bm[e]),S=0|E,k=Hu.rotrSH(r,n,28)^Hu.rotrBH(r,n,34)^Hu.rotrBH(r,n,39),R=Hu.rotrSL(r,n,28)^Hu.rotrBL(r,n,34)^Hu.rotrBL(r,n,39),P=r&i^r&o^i&o,I=n&s^n&a^s&a;m=0|p,y=0|g,p=0|h,g=0|f,h=0|l,f=0|d,({h:l,l:d}=Hu.add(0|c,0|u,0|A,0|S)),c=0|o,u=0|a,o=0|i,a=0|s,i=0|r,s=0|n;const C=Hu.add3L(S,R,I);r=Hu.add3H(C,A,k,P),n=0|C}({h:r,l:n}=Hu.add(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=Hu.add(0|this.Bh,0|this.Bl,0|i,0|s)),({h:o,l:a}=Hu.add(0|this.Ch,0|this.Cl,0|o,0|a)),({h:c,l:u}=Hu.add(0|this.Dh,0|this.Dl,0|c,0|u)),({h:l,l:d}=Hu.add(0|this.Eh,0|this.El,0|l,0|d)),({h,l:f}=Hu.add(0|this.Fh,0|this.Fl,0|h,0|f)),({h:p,l:g}=Hu.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:y}=Hu.add(0|this.Hh,0|this.Hl,0|m,0|y)),this.set(r,n,i,s,o,a,c,u,l,d,h,f,p,g,m,y)}roundClean(){Bm.fill(0),Lm.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Um=sl(()=>new Fm),jm=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}(),zm=jm.crypto||jm.msCrypto;function qm(e){switch(e){case"sha256":return bh.create();case"sha512":return Um.create()}Uc(!1,"invalid hashing algorithm name","algorithm",e)}const Km=function(e){return qm("sha256").update(e).digest()},Gm=function(e){return qm("sha512").update(e).digest()};let $m=Km,Vm=Gm,Hm=!1,Wm=!1;function Jm(e){const t=$c(e,"data");return Zc($m(t))}function Zm(e){const t=$c(e,"data");return Zc(Vm(t))}function Qm(e){let t=e.toString(16);for(;t.length<2;)t="0"+t;return"0x"+t}function Ym(e,t,r){let n=0;for(let i=0;i<r;i++)n=256*n+e[t+i];return n}function Xm(e,t,r,n){const i=[];for(;r<t+1+n;){const s=ey(e,r);i.push(s.result),Fc((r+=s.consumed)<=t+1+n,"child data too short","BUFFER_OVERRUN",{buffer:e,length:n,offset:t})}return{consumed:1+n,result:i}}function ey(e,t){Fc(0!==e.length,"data too short","BUFFER_OVERRUN",{buffer:e,length:0,offset:1});const r=t=>{Fc(t<=e.length,"data short segment too short","BUFFER_OVERRUN",{buffer:e,length:e.length,offset:t})};if(e[t]>=248){const n=e[t]-247;r(t+1+n);const i=Ym(e,t+1,n);return r(t+1+n+i),Xm(e,t,t+1+n,n+i)}if(e[t]>=192){const n=e[t]-192;return r(t+1+n),Xm(e,t,t+1,n)}if(e[t]>=184){const n=e[t]-183;r(t+1+n);const i=Ym(e,t+1,n);return r(t+1+n+i),{consumed:1+n+i,result:Zc(e.slice(t+1+n,t+1+n+i))}}if(e[t]>=128){const n=e[t]-128;return r(t+1+n),{consumed:1+n,result:Zc(e.slice(t+1,t+1+n))}}return{consumed:1,result:Qm(e[t])}}function ty(e){const t=$c(e,"data"),r=ey(t,0);return Uc(r.consumed===t.length,"unexpected junk after rlp payload","data",e),r.result}function ry(e){const t=[];for(;e;)t.unshift(255&e),e>>=8;return t}function ny(e){if(Array.isArray(e)){let t=[];if(e.forEach(function(e){t=t.concat(ny(e))}),t.length<=55)return t.unshift(192+t.length),t;const r=ry(t.length);return r.unshift(247+r.length),r.concat(t)}const t=Array.prototype.slice.call($c(e,"object"));if(1===t.length&&t[0]<=127)return t;if(t.length<=55)return t.unshift(128+t.length),t;const r=ry(t.length);return r.unshift(183+r.length),r.concat(t)}Jm._=Km,Jm.lock=function(){Hm=!0},Jm.register=function(e){if(Hm)throw new Error("sha256 is locked");$m=e},Object.freeze(Jm),Zm._=Gm,Zm.lock=function(){Wm=!0},Zm.register=function(e){if(Wm)throw new Error("sha512 is locked");Vm=e},Object.freeze(Jm);const iy="0123456789abcdef";function sy(e){let t="0x";for(const r of ny(e))t+=iy[r>>4],t+=iy[15&r];return t}const oy=BigInt(0),ay=BigInt(2),cy=BigInt(27),uy=BigInt(28),ly=BigInt(35),dy=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),hy=Symbol.for("nodejs.util.inspect.custom"),fy=131072,py=128;function gy(e,t){let r=e.toString(16);for(;r.length<2;)r="0"+r;return r+=Jm(t).substring(4),"0x"+r}function my(e){return"0x"===e?null:Ol(e)}function yy(e,t){try{return Xf(e)}catch(r){Uc(!1,r.message,t,e)}}function by(e,t){try{if(!Array.isArray(e))throw new Error("authorizationList: invalid array");const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(!Array.isArray(n))throw new Error(`authorization[${r}]: invalid array`);if(6!==n.length)throw new Error(`authorization[${r}]: wrong length`);if(!n[1])throw new Error(`authorization[${r}]: null address`);t.push({address:my(n[1]),nonce:vy(n[2],"nonce"),chainId:vy(n[0],"chainId"),signature:xf.from({yParity:wy(n[3],"yParity"),r:ru(n[4],32),s:ru(n[5],32)})})}return t}catch(r){Uc(!1,r.message,t,e)}}function wy(e,t){return"0x"===e?0:pu(e,t)}function vy(e,t){if("0x"===e)return oy;const r=lu(e,t);return Uc(r<=dy,"value exceeds uint size",t,r),r}function Ey(e,t){const r=lu(e,"value"),n=yu(r);return Uc(n.length<=32,"value too large",`tx.${t}`,r),n}function Ay(e){return Xf(e).map(e=>[e.address,e.storageKeys])}function Sy(e,t){Uc(Array.isArray(e),`invalid ${t}`,"value",e);for(let t=0;t<e.length;t++)Uc(Hc(e[t],32),"invalid ${ param } hash",`value[${t}]`,e[t]);return e}function ky(e,t){let r;try{if(r=wy(t[0],"yParity"),0!==r&&1!==r)throw new Error("bad yParity")}catch(e){Uc(!1,"invalid yParity","yParity",t[0])}const n=ru(t[1],32),i=ru(t[2],32),s=xf.from({r:n,s:i,yParity:r});e.signature=s}class Ry{#ie;#se;#t;#oe;#ae;#ce;#ue;#le;#de;#he;#fe;#pe;#ge;#me;#ye;#be;#we;#ve;get type(){return this.#ie}set type(e){switch(e){case null:this.#ie=null;break;case 0:case"legacy":this.#ie=0;break;case 1:case"berlin":case"eip-2930":this.#ie=1;break;case 2:case"london":case"eip-1559":this.#ie=2;break;case 3:case"cancun":case"eip-4844":this.#ie=3;break;case 4:case"pectra":case"eip-7702":this.#ie=4;break;default:Uc(!1,"unsupported transaction type","type",e)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){const e=this.#se;return null==e&&3===this.type?yp:e}set to(e){this.#se=null==e?null:Ol(e)}get nonce(){return this.#oe}set nonce(e){this.#oe=pu(e,"value")}get gasLimit(){return this.#ae}set gasLimit(e){this.#ae=lu(e)}get gasPrice(){const e=this.#ce;return null!=e||0!==this.type&&1!==this.type?e:oy}set gasPrice(e){this.#ce=null==e?null:lu(e,"gasPrice")}get maxPriorityFeePerGas(){const e=this.#ue;return null==e?2===this.type||3===this.type?oy:null:e}set maxPriorityFeePerGas(e){this.#ue=null==e?null:lu(e,"maxPriorityFeePerGas")}get maxFeePerGas(){const e=this.#le;return null==e?2===this.type||3===this.type?oy:null:e}set maxFeePerGas(e){this.#le=null==e?null:lu(e,"maxFeePerGas")}get data(){return this.#t}set data(e){this.#t=Zc(e)}get value(){return this.#de}set value(e){this.#de=lu(e,"value")}get chainId(){return this.#he}set chainId(e){this.#he=lu(e)}get signature(){return this.#fe||null}set signature(e){this.#fe=null==e?null:xf.from(e)}isValid(){const e=this.signature;if(e&&!e.isValid())return!1;const t=this.authorizationList;if(t)for(const e of t)if(!e.signature.isValid())return!1;return!0}get accessList(){const e=this.#pe||null;return null==e?1===this.type||2===this.type||3===this.type?[]:null:e}set accessList(e){this.#pe=null==e?null:Xf(e)}get authorizationList(){const e=this.#we||null;return null==e&&4===this.type?[]:e}set authorizationList(e){this.#we=null==e?null:e.map(e=>ep(e))}get maxFeePerBlobGas(){const e=this.#ge;return null==e&&3===this.type?oy:e}set maxFeePerBlobGas(e){this.#ge=null==e?null:lu(e,"maxFeePerBlobGas")}get blobVersionedHashes(){let e=this.#me;return null==e&&3===this.type?[]:e}set blobVersionedHashes(e){if(null!=e){Uc(Array.isArray(e),"blobVersionedHashes must be an Array","value",e),e=e.slice();for(let t=0;t<e.length;t++)Uc(Hc(e[t],32),"invalid blobVersionedHash",`value[${t}]`,e[t])}this.#me=e}get blobs(){return null==this.#be?null:this.#be.map(e=>Object.assign({},e))}set blobs(e){if(null==e)return void(this.#be=null);const t=[],r=[];for(let n=0;n<e.length;n++){const i=e[n];if(Wc(i)){Fc(this.#ye,"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let e=$c(i);if(Uc(e.length<=fy,"blob is too large",`blobs[${n}]`,i),e.length!==fy){const t=new Uint8Array(fy);t.set(e),e=t}const s=this.#ye.blobToKzgCommitment(e),o=Zc(this.#ye.computeBlobKzgProof(e,s));t.push({data:Zc(e),commitment:Zc(s),proof:o}),r.push(gy(1,s))}else{const e=Zc(i.data),n=Zc(i.commitment),s=Zc(i.proof);t.push({data:e,commitment:n,proof:s}),r.push(gy(1,n))}}this.#be=t,this.#me=r}get kzg(){return this.#ye}set kzg(e){this.#ye=null==e?null:function(e){return{blobToKzgCommitment:t=>{if("computeBlobProof"in e){if("blobToKzgCommitment"in e&&"function"==typeof e.blobToKzgCommitment)return $c(e.blobToKzgCommitment(Zc(t)))}else if("blobToKzgCommitment"in e&&"function"==typeof e.blobToKzgCommitment)return $c(e.blobToKzgCommitment(t));if("blobToKZGCommitment"in e&&"function"==typeof e.blobToKZGCommitment)return $c(e.blobToKZGCommitment(Zc(t)));Uc(!1,"unsupported KZG library","kzg",e)},computeBlobKzgProof:(t,r)=>"computeBlobProof"in e&&"function"==typeof e.computeBlobProof?$c(e.computeBlobProof(Zc(t),Zc(r))):"computeBlobKzgProof"in e&&"function"==typeof e.computeBlobKzgProof?e.computeBlobKzgProof(t,r):"computeBlobKZGProof"in e&&"function"==typeof e.computeBlobKZGProof?$c(e.computeBlobKZGProof(Zc(t),Zc(r))):void Uc(!1,"unsupported KZG library","kzg",e)}}(e)}get blobWrapperVersion(){return this.#ve}set blobWrapperVersion(e){this.#ve=e}constructor(){this.#ie=null,this.#se=null,this.#oe=0,this.#ae=oy,this.#ce=null,this.#ue=null,this.#le=null,this.#t="0x",this.#de=oy,this.#he=oy,this.#fe=null,this.#pe=null,this.#ge=null,this.#me=null,this.#ye=null,this.#be=null,this.#we=null,this.#ve=null}get hash(){return null==this.signature?null:Rl(this.#Ee(!0,!1))}get unsignedHash(){return Rl(this.unsignedSerialized)}get from(){return null==this.signature?null:Mf(this.unsignedHash,this.signature.getCanonical())}get fromPublicKey(){return null==this.signature?null:Of.recoverPublicKey(this.unsignedHash,this.signature.getCanonical())}isSigned(){return null!=this.signature}#Ee(e,t){Fc(!e||null!=this.signature,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const r=e?this.signature:null;switch(this.inferType()){case 0:return function(e,t){const r=[Ey(e.nonce,"nonce"),Ey(e.gasPrice||0,"gasPrice"),Ey(e.gasLimit,"gasLimit"),e.to||"0x",Ey(e.value,"value"),e.data];let n=oy;if(e.chainId!=oy)n=lu(e.chainId,"tx.chainId"),Uc(!t||null==t.networkV||t.legacyChainId===n,"tx.chainId/sig.v mismatch","sig",t);else if(e.signature){const t=e.signature.legacyChainId;null!=t&&(n=t)}if(!t)return n!==oy&&(r.push(yu(n)),r.push("0x"),r.push("0x")),sy(r);let i=BigInt(27+t.yParity);return n!==oy?i=xf.getChainIdV(n,t.v):BigInt(t.v)!==i&&Uc(!1,"tx.chainId/sig.v mismatch","sig",t),r.push(yu(i)),r.push(yu(t.r)),r.push(yu(t._s)),sy(r)}(this,r);case 1:return function(e,t){const r=[Ey(e.chainId,"chainId"),Ey(e.nonce,"nonce"),Ey(e.gasPrice||0,"gasPrice"),Ey(e.gasLimit,"gasLimit"),e.to||"0x",Ey(e.value,"value"),e.data,Ay(e.accessList||[])];return t&&(r.push(Ey(t.yParity,"recoveryParam")),r.push(yu(t.r)),r.push(yu(t.s))),Qc(["0x01",sy(r)])}(this,r);case 2:return function(e,t){const r=[Ey(e.chainId,"chainId"),Ey(e.nonce,"nonce"),Ey(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),Ey(e.maxFeePerGas||0,"maxFeePerGas"),Ey(e.gasLimit,"gasLimit"),e.to||"0x",Ey(e.value,"value"),e.data,Ay(e.accessList||[])];return t&&(r.push(Ey(t.yParity,"yParity")),r.push(yu(t.r)),r.push(yu(t.s))),Qc(["0x02",sy(r)])}(this,r);case 3:return function(e,t,r){const n=[Ey(e.chainId,"chainId"),Ey(e.nonce,"nonce"),Ey(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),Ey(e.maxFeePerGas||0,"maxFeePerGas"),Ey(e.gasLimit,"gasLimit"),e.to||yp,Ey(e.value,"value"),e.data,Ay(e.accessList||[]),Ey(e.maxFeePerBlobGas||0,"maxFeePerBlobGas"),Sy(e.blobVersionedHashes||[],"blobVersionedHashes")];if(t&&(n.push(Ey(t.yParity,"yParity")),n.push(yu(t.r)),n.push(yu(t.s)),r)){if(null!=e.blobWrapperVersion){const t=yu(e.blobWrapperVersion),i=[];for(const{proof:e}of r){const t=$c(e),r=t.length/py;for(let e=0;e<t.length;e+=r)i.push(t.subarray(e,e+r))}return Qc(["0x03",sy([n,t,r.map(e=>e.data),r.map(e=>e.commitment),i])])}return Qc(["0x03",sy([n,r.map(e=>e.data),r.map(e=>e.commitment),r.map(e=>e.proof)])])}return Qc(["0x03",sy(n)])}(this,r,t?this.blobs:null);case 4:return function(e,t){const r=[Ey(e.chainId,"chainId"),Ey(e.nonce,"nonce"),Ey(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),Ey(e.maxFeePerGas||0,"maxFeePerGas"),Ey(e.gasLimit,"gasLimit"),e.to||"0x",Ey(e.value,"value"),e.data,Ay(e.accessList||[]),(n=e.authorizationList||[],n.map(e=>[Ey(e.chainId,"chainId"),e.address,Ey(e.nonce,"nonce"),Ey(e.signature.yParity,"yParity"),yu(e.signature.r),yu(e.signature._s)]))];var n;return t&&(r.push(Ey(t.yParity,"yParity")),r.push(yu(t.r)),r.push(yu(t.s))),Qc(["0x04",sy(r)])}(this,r)}Fc(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})}get serialized(){return this.#Ee(!0,!0)}get unsignedSerialized(){return this.#Ee(!1,!1)}inferType(){const e=this.inferTypes();return e.indexOf(2)>=0?2:e.pop()}inferTypes(){const e=null!=this.gasPrice,t=null!=this.maxFeePerGas||null!=this.maxPriorityFeePerGas,r=null!=this.accessList,n=null!=this.#ge||this.#me;null!=this.maxFeePerGas&&null!=this.maxPriorityFeePerGas&&Fc(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),Fc(!t||0!==this.type&&1!==this.type,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),Fc(0!==this.type||!r,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const i=[];return null!=this.type?i.push(this.type):this.authorizationList&&this.authorizationList.length?i.push(4):t?i.push(2):e?(i.push(1),r||i.push(0)):r?(i.push(1),i.push(2)):(n&&this.to||(i.push(0),i.push(1),i.push(2)),i.push(3)),i.sort(),i}isLegacy(){return 0===this.type}isBerlin(){return 1===this.type}isLondon(){return 2===this.type}isCancun(){return 3===this.type}clone(){return Ry.from(this)}toJSON(){const e=e=>null==e?null:e.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:e(this.gasLimit),gasPrice:e(this.gasPrice),maxPriorityFeePerGas:e(this.maxPriorityFeePerGas),maxFeePerGas:e(this.maxFeePerGas),value:e(this.value),chainId:e(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}[hy](){return this.toString()}toString(){const e=[],t=t=>{let r=this[t];"string"==typeof r&&(r=JSON.stringify(r)),e.push(`${t}: ${r}`)};this.type&&t("type"),t("to"),t("data"),t("nonce"),t("gasLimit"),t("value"),null!=this.chainId&&t("chainId"),this.signature&&(t("from"),e.push(`signature: ${this.signature.toString()}`));const r=this.authorizationList;if(r){const t=[];for(const e of r){const r=[];r.push(`address: ${JSON.stringify(e.address)}`),null!=e.nonce&&r.push(`nonce: ${e.nonce}`),null!=e.chainId&&r.push(`chainId: ${e.chainId}`),e.signature&&r.push(`signature: ${e.signature.toString()}`),t.push(`Authorization { ${r.join(", ")} }`)}e.push(`authorizations: [ ${t.join(", ")} ]`)}return`Transaction { ${e.join(", ")} }`}static from(e){if(null==e)return new Ry;if("string"==typeof e){const t=$c(e);if(t[0]>=127)return Ry.from(function(e){const t=ty(e);Uc(Array.isArray(t)&&(9===t.length||6===t.length),"invalid field count for legacy transaction","data",e);const r={type:0,nonce:wy(t[0],"nonce"),gasPrice:vy(t[1],"gasPrice"),gasLimit:vy(t[2],"gasLimit"),to:my(t[3]),value:vy(t[4],"value"),data:Zc(t[5]),chainId:oy};if(6===t.length)return r;const n=vy(t[6],"v"),i=vy(t[7],"r"),s=vy(t[8],"s");if(i===oy&&s===oy)r.chainId=n;else{let e=(n-ly)/ay;e<oy&&(e=oy),r.chainId=e,Uc(e!==oy||n===cy||n===uy,"non-canonical legacy v","v",t[6]),r.signature=xf.from({r:ru(t[7],32),s:ru(t[8],32),v:n})}return r}(t));switch(t[0]){case 1:return Ry.from(function(e){const t=ty($c(e).slice(1));Uc(Array.isArray(t)&&(8===t.length||11===t.length),"invalid field count for transaction type: 1","data",Zc(e));const r={type:1,chainId:vy(t[0],"chainId"),nonce:wy(t[1],"nonce"),gasPrice:vy(t[2],"gasPrice"),gasLimit:vy(t[3],"gasLimit"),to:my(t[4]),value:vy(t[5],"value"),data:Zc(t[6]),accessList:yy(t[7],"accessList")};return 8===t.length||ky(r,t.slice(8)),r}(t));case 2:return Ry.from(function(e){const t=ty($c(e).slice(1));Uc(Array.isArray(t)&&(9===t.length||12===t.length),"invalid field count for transaction type: 2","data",Zc(e));const r={type:2,chainId:vy(t[0],"chainId"),nonce:wy(t[1],"nonce"),maxPriorityFeePerGas:vy(t[2],"maxPriorityFeePerGas"),maxFeePerGas:vy(t[3],"maxFeePerGas"),gasPrice:null,gasLimit:vy(t[4],"gasLimit"),to:my(t[5]),value:vy(t[6],"value"),data:Zc(t[7]),accessList:yy(t[8],"accessList")};return 9===t.length||ky(r,t.slice(9)),r}(t));case 3:return Ry.from(function(e){let t=ty($c(e).slice(1)),r="3",n=null,i=null;if(4===t.length&&Array.isArray(t[0])){r="3 (network format)";const e=t[1],n=t[2],s=t[3];Uc(Array.isArray(e),"invalid network format: blobs not an array","fields[1]",e),Uc(Array.isArray(n),"invalid network format: commitments not an array","fields[2]",n),Uc(Array.isArray(s),"invalid network format: proofs not an array","fields[3]",s),Uc(e.length===n.length,"invalid network format: blobs/commitments length mismatch","fields",t),Uc(e.length===s.length,"invalid network format: blobs/proofs length mismatch","fields",t),i=[];for(let r=0;r<t[1].length;r++)i.push({data:e[r],commitment:n[r],proof:s[r]});t=t[0]}else if(5===t.length&&Array.isArray(t[0])){r="3 (EIP-7594 network format)",n=pu(t[1]);const e=t[2],s=t[3],o=t[4];Uc(1===n,`unsupported EIP-7594 network format version: ${n}`,"fields[1]",n),Uc(Array.isArray(e),"invalid EIP-7594 network format: blobs not an array","fields[2]",e),Uc(Array.isArray(s),"invalid EIP-7594 network format: commitments not an array","fields[3]",s),Uc(Array.isArray(o),"invalid EIP-7594 network format: proofs not an array","fields[4]",o),Uc(e.length===s.length,"invalid network format: blobs/commitments length mismatch","fields",t),Uc(e.length*py===o.length,"invalid network format: blobs/proofs length mismatch","fields",t),i=[];for(let t=0;t<e.length;t++){const r=[];for(let e=0;e<py;e++)r.push(o[t*py+e]);i.push({data:e[t],commitment:s[t],proof:Qc(r)})}t=t[0]}Uc(Array.isArray(t)&&(11===t.length||14===t.length),`invalid field count for transaction type: ${r}`,"data",Zc(e));const s={type:3,chainId:vy(t[0],"chainId"),nonce:wy(t[1],"nonce"),maxPriorityFeePerGas:vy(t[2],"maxPriorityFeePerGas"),maxFeePerGas:vy(t[3],"maxFeePerGas"),gasPrice:null,gasLimit:vy(t[4],"gasLimit"),to:my(t[5]),value:vy(t[6],"value"),data:Zc(t[7]),accessList:yy(t[8],"accessList"),maxFeePerBlobGas:vy(t[9],"maxFeePerBlobGas"),blobVersionedHashes:t[10],blobWrapperVersion:n};i&&(s.blobs=i),Uc(null!=s.to,`invalid address for transaction type: ${r}`,"data",e),Uc(Array.isArray(s.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",e);for(let t=0;t<s.blobVersionedHashes.length;t++)Uc(Hc(s.blobVersionedHashes[t],32),`invalid blobVersionedHash at index ${t}: must be length 32`,"data",e);return 11===t.length||ky(s,t.slice(11)),s}(t));case 4:return Ry.from(function(e){const t=ty($c(e).slice(1));Uc(Array.isArray(t)&&(10===t.length||13===t.length),"invalid field count for transaction type: 4","data",Zc(e));const r={type:4,chainId:vy(t[0],"chainId"),nonce:wy(t[1],"nonce"),maxPriorityFeePerGas:vy(t[2],"maxPriorityFeePerGas"),maxFeePerGas:vy(t[3],"maxFeePerGas"),gasPrice:null,gasLimit:vy(t[4],"gasLimit"),to:my(t[5]),value:vy(t[6],"value"),data:Zc(t[7]),accessList:yy(t[8],"accessList"),authorizationList:by(t[9],"authorizationList")};return 10===t.length||ky(r,t.slice(10)),r}(t))}Fc(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const t=new Ry;return null!=e.type&&(t.type=e.type),null!=e.to&&(t.to=e.to),null!=e.nonce&&(t.nonce=e.nonce),null!=e.gasLimit&&(t.gasLimit=e.gasLimit),null!=e.gasPrice&&(t.gasPrice=e.gasPrice),null!=e.maxPriorityFeePerGas&&(t.maxPriorityFeePerGas=e.maxPriorityFeePerGas),null!=e.maxFeePerGas&&(t.maxFeePerGas=e.maxFeePerGas),null!=e.maxFeePerBlobGas&&(t.maxFeePerBlobGas=e.maxFeePerBlobGas),null!=e.data&&(t.data=e.data),null!=e.value&&(t.value=e.value),null!=e.chainId&&(t.chainId=e.chainId),null!=e.signature&&(t.signature=xf.from(e.signature)),null!=e.accessList&&(t.accessList=e.accessList),null!=e.authorizationList&&(t.authorizationList=e.authorizationList),null!=e.blobVersionedHashes&&(t.blobVersionedHashes=e.blobVersionedHashes),null!=e.kzg&&(t.kzg=e.kzg),null!=e.blobWrapperVersion&&(t.blobWrapperVersion=e.blobWrapperVersion),null!=e.blobs&&(t.blobs=e.blobs),null!=e.hash&&(Uc(t.isSigned(),"unsigned transaction cannot define '.hash'","tx",e),Uc(t.hash===e.hash,"hash mismatch","tx",e)),null!=e.from&&(Uc(t.isSigned(),"unsigned transaction cannot define '.from'","tx",e),Uc(t.from.toLowerCase()===(e.from||"").toLowerCase(),"from mismatch","tx",e)),t}}const Py="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";let Iy=null;function Cy(e){if(null==Iy){Iy={};for(let e=0;e<Py.length;e++)Iy[Py[e]]=BigInt(e)}const t=Iy[e];return Uc(null!=t,"invalid base58 value","letter",e),t}const _y=BigInt(0),Ty=BigInt(58);function Ny(e){const t=$c(e);let r=fu(t),n="";for(;r;)n=Py[Number(r%Ty)]+n,r/=Ty;for(let e=0;e<t.length&&!t[e];e++)n=Py[0]+n;return n}function xy(e){let t=_y;for(let r=0;r<e.length;r++)t*=Ty,t+=Cy(e[r]);return t}function Oy(e){return e.match(/^ipfs:\/\/ipfs\//i)?e=e.substring(12):e.match(/^ipfs:\/\//i)?e=e.substring(7):Uc(!1,"unsupported IPFS format","link",e),`https://gateway.ipfs.io/ipfs/${e}`}class Dy{name;constructor(e){Oc(this,{name:e})}connect(e){return this}supportsCoinType(e){return!1}async encodeAddress(e,t){throw new Error("unsupported coin")}async decodeAddress(e,t){throw new Error("unsupported coin")}}const My=new RegExp("^(ipfs)://(.*)$","i"),By=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),My,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];class Ly{provider;address;name;#Ae;#Se;constructor(e,t,r){Oc(this,{provider:e,address:t,name:r}),this.#Ae=null,this.#Se=new dg(t,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],e)}async supportsWildcard(){return null==this.#Ae&&(this.#Ae=(async()=>{try{return await this.#Se.supportsInterface("0x9061b923")}catch(e){if(Mc(e,"CALL_EXCEPTION"))return!1;throw this.#Ae=null,e}})()),await this.#Ae}async#ke(e,t){t=(t||[]).slice();const r=this.#Se.interface;t.unshift(Nm(this.name));let n=null;await this.supportsWildcard()&&(n=r.getFunction(e),Fc(n,"missing fragment","UNKNOWN_ERROR",{info:{funcName:e}}),t=[xm(this.name,255),r.encodeFunctionData(n,t)],e="resolve(bytes,bytes)"),t.push({enableCcipRead:!0});try{const i=await this.#Se[e](...t);return n?r.decodeFunctionResult(n,i)[0]:i}catch(e){if(!Mc(e,"CALL_EXCEPTION"))throw e}return null}async getAddress(e){if(null==e&&(e=60),60===e)try{const e=await this.#ke("addr(bytes32)");return null==e||e===yp?null:e}catch(e){if(Mc(e,"CALL_EXCEPTION"))return null;throw e}if(e>=0&&e<2147483648){let t=e+2147483648;const r=await this.#ke("addr(bytes32,uint)",[t]);if(Hc(r,20))return Ol(r)}let t=null;for(const r of this.provider.plugins)if(r instanceof Dy&&r.supportsCoinType(e)){t=r;break}if(null==t)return null;const r=await this.#ke("addr(bytes32,uint)",[e]);if(null==r||"0x"===r)return null;const n=await t.decodeAddress(e,r);if(null!=n)return n;Fc(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${e})`,info:{coinType:e,data:r}})}async getText(e){const t=await this.#ke("text(bytes32,string)",[e]);return null==t||"0x"===t?null:t}async getContentHash(){const e=await this.#ke("contenthash(bytes32)");if(null==e||"0x"===e)return null;const t=e.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(t){const e="e3010170"===t[1]?"ipfs":"ipns",r=parseInt(t[4],16);if(t[5].length===2*r)return`${e}://${Ny("0x"+t[2])}`}const r=e.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(r&&64===r[1].length)return`bzz://${r[1]}`;Fc(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:e}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const e=[{type:"name",value:this.name}];try{const t=await this.getText("avatar");if(null==t)return e.push({type:"!avatar",value:""}),{url:null,linkage:e};e.push({type:"avatar",value:t});for(let r=0;r<By.length;r++){const n=t.match(By[r]);if(null==n)continue;const i=n[1].toLowerCase();switch(i){case"https":case"data":return e.push({type:"url",value:t}),{linkage:e,url:t};case"ipfs":{const r=Oy(t);return e.push({type:"ipfs",value:t}),e.push({type:"url",value:r}),{linkage:e,url:r}}case"erc721":case"erc1155":{const r="erc721"===i?"tokenURI(uint256)":"uri(uint256)";e.push({type:i,value:t});const s=await this.getAddress();if(null==s)return e.push({type:"!owner",value:""}),{url:null,linkage:e};const o=(n[2]||"").split("/");if(2!==o.length)return e.push({type:`!${i}caip`,value:n[2]||""}),{url:null,linkage:e};const a=o[1],c=new dg(o[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if("erc721"===i){const t=await c.ownerOf(a);if(s!==t)return e.push({type:"!owner",value:t}),{url:null,linkage:e};e.push({type:"owner",value:t})}else if("erc1155"===i){const t=await c.balanceOf(s,a);if(!t)return e.push({type:"!balance",value:"0"}),{url:null,linkage:e};e.push({type:"balance",value:t.toString()})}let u=await c[r](a);if(null==u||"0x"===u)return e.push({type:"!metadata-url",value:""}),{url:null,linkage:e};e.push({type:"metadata-url-base",value:u}),"erc1155"===i&&(u=u.replace("{id}",mu(a,32).substring(2)),e.push({type:"metadata-url-expanded",value:u})),u.match(/^ipfs:/i)&&(u=Oy(u)),e.push({type:"metadata-url",value:u});let l={};const d=await new pp(u).send();d.assertOk();try{l=d.bodyJson}catch(t){try{e.push({type:"!metadata",value:d.bodyText})}catch(t){const r=d.body;return r&&e.push({type:"!metadata",value:Zc(r)}),{url:null,linkage:e}}return{url:null,linkage:e}}if(!l)return e.push({type:"!metadata",value:""}),{url:null,linkage:e};e.push({type:"metadata",value:JSON.stringify(l)});let h=l.image;if("string"!=typeof h)return e.push({type:"!imageUrl",value:""}),{url:null,linkage:e};if(h.match(/^(https:\/\/|data:)/i));else{if(null==h.match(My))return e.push({type:"!imageUrl-ipfs",value:h}),{url:null,linkage:e};e.push({type:"imageUrl-ipfs",value:h}),h=Oy(h)}return e.push({type:"url",value:h}),{linkage:e,url:h}}}}}catch(e){}return{linkage:e,url:null}}static async getEnsAddress(e){const t=await e.getNetwork(),r=t.getPlugin("org.ethers.plugins.network.Ens");return Fc(r,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:t}}),r.address}static async#Re(e,t){const r=await Ly.getEnsAddress(e);try{const n=new dg(r,["function resolver(bytes32) view returns (address)"],e),i=await n.resolver(Nm(t),{enableCcipRead:!0});return i===yp?null:i}catch(e){throw e}}static async fromName(e,t){let r=t;for(;;){if(""===r||"."===r)return null;if("eth"!==t&&"eth"===r)return null;const n=await Ly.#Re(e,r);if(null!=n){const i=new Ly(e,n,t);return r===t||await i.supportsWildcard()?i:null}r=r.split(".").slice(1).join(".")}}}function Fy(e){const t=Ol(e.from);let r=lu(e.nonce,"tx.nonce").toString(16);return r="0"===r?"0x":r.length%2?"0x0"+r:"0x"+r,Ol(Xc(Rl(sy([t,r])),12))}function Uy(e,t,r){const n=Ol(e),i=$c(t,"salt"),s=$c(r,"initCodeHash");return Uc(32===i.length,"salt must be 32 bytes","salt",t),Uc(32===s.length,"initCodeHash must be 32 bytes","initCodeHash",r),Ol(Xc(Rl(Qc(["0xff",n,i,s])),12))}const jy=BigInt(0);function zy(e,t){return function(r){return null==r?t:e(r)}}function qy(e,t){return r=>{if(t&&null==r)return null;if(!Array.isArray(r))throw new Error("not an array");return r.map(t=>e(t))}}function Ky(e,t){return r=>{const n={};for(const i in e){let s=i;if(t&&i in t&&!(s in r))for(const e of t[i])if(e in r){s=e;break}try{const t=e[i](r[s]);void 0!==t&&(n[i]=t)}catch(e){Fc(!1,`invalid value for value.${i} (${e instanceof Error?e.message:"not-an-error"})`,"BAD_DATA",{value:r})}}return n}}function Gy(e){return Uc(Hc(e,!0),"invalid data","value",e),e}function $y(e){return Uc(Hc(e,32),"invalid hash","value",e),e}const Vy=Ky({address:Ol,blockHash:$y,blockNumber:pu,data:Gy,index:pu,removed:zy(function(e){switch(e){case!0:case"true":return!0;case!1:case"false":return!1}Uc(!1,`invalid boolean; ${JSON.stringify(e)}`,"value",e)},!1),topics:qy($y),transactionHash:$y,transactionIndex:pu},{index:["logIndex"]}),Hy=Ky({hash:zy($y),parentHash:$y,parentBeaconBlockRoot:zy($y,null),number:pu,timestamp:pu,nonce:zy(Gy),difficulty:lu,gasLimit:lu,gasUsed:lu,stateRoot:zy($y,null),receiptsRoot:zy($y,null),blobGasUsed:zy(lu,null),excessBlobGas:zy(lu,null),miner:zy(Ol),prevRandao:zy($y,null),extraData:Gy,baseFeePerGas:zy(lu)},{prevRandao:["mixHash"]}),Wy=Ky({transactionIndex:pu,blockNumber:pu,transactionHash:$y,address:Ol,topics:qy($y),data:Gy,index:pu,blockHash:$y},{index:["logIndex"]}),Jy=Ky({to:zy(Ol,null),from:zy(Ol,null),contractAddress:zy(Ol,null),index:pu,root:zy(Zc),gasUsed:lu,blobGasUsed:zy(lu,null),logsBloom:zy(Gy),blockHash:$y,hash:$y,logs:qy(function(e){return Wy(e)}),blockNumber:pu,cumulativeGasUsed:lu,effectiveGasPrice:zy(lu),blobGasPrice:zy(lu,null),status:zy(pu),type:zy(pu,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function Zy(e){e.to&&lu(e.to)===jy&&(e.to="0x0000000000000000000000000000000000000000");const t=Ky({hash:$y,index:zy(pu,void 0),type:e=>"0x"===e||null==e?0:pu(e),accessList:zy(Xf,null),blobVersionedHashes:zy(qy($y,!0),null),authorizationList:zy(qy(e=>{let t;if(e.signature)t=e.signature;else{let r=e.yParity;"0x1b"===r?r=0:"0x1c"===r&&(r=1),t=Object.assign({},e,{yParity:r})}return{address:Ol(e.address),chainId:lu(e.chainId),nonce:lu(e.nonce),signature:xf.from(t)}},!1),null),blockHash:zy($y,null),blockNumber:zy(pu,null),transactionIndex:zy(pu,null),from:Ol,gasPrice:zy(lu),maxPriorityFeePerGas:zy(lu),maxFeePerGas:zy(lu),maxFeePerBlobGas:zy(lu,null),gasLimit:lu,to:zy(Ol,null),value:lu,nonce:pu,data:Gy,creates:zy(Ol,null),chainId:zy(lu,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(e);if(null==t.to&&null==t.creates&&(t.creates=Fy(t)),1!==e.type&&2!==e.type||null!=e.accessList||(t.accessList=[]),e.signature?t.signature=xf.from(e.signature):t.signature=xf.from(e),null==t.chainId){const e=t.signature.legacyChainId;null!=e&&(t.chainId=e)}return t.blockHash&&lu(t.blockHash)===jy&&(t.blockHash=null),t}class Qy{name;constructor(e){Oc(this,{name:e})}clone(){return new Qy(this.name)}}class Yy extends Qy{effectiveBlock;txBase;txCreate;txDataZero;txDataNonzero;txAccessListStorageKey;txAccessListAddress;constructor(e,t){null==e&&(e=0),super(`org.ethers.network.plugins.GasCost#${e||0}`);const r={effectiveBlock:e};function n(e,n){let i=(t||{})[e];null==i&&(i=n),Uc("number"==typeof i,`invalud value for ${e}`,"costs",t),r[e]=i}n("txBase",21e3),n("txCreate",32e3),n("txDataZero",4),n("txDataNonzero",16),n("txAccessListStorageKey",1900),n("txAccessListAddress",2400),Oc(this,r)}clone(){return new Yy(this.effectiveBlock,this)}}class Xy extends Qy{address;targetNetwork;constructor(e,t){super("org.ethers.plugins.network.Ens"),Oc(this,{address:e||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",targetNetwork:null==t?1:t})}clone(){return new Xy(this.address,this.targetNetwork)}}class eb extends Qy{#Pe;get feeDataFunc(){return this.#Pe}constructor(e){super("org.ethers.plugins.network.FeeData"),this.#Pe=e}async getFeeData(e){return await this.#Pe(e)}clone(){return new eb(this.#Pe)}}class tb extends Qy{#N;#Ie;get url(){return this.#N}get processFunc(){return this.#Ie}constructor(e,t){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin"),this.#N=e,this.#Ie=t}clone(){return this}}const rb=new Map;class nb{#Ce;#he;#_e;constructor(e,t){this.#Ce=e,this.#he=lu(t),this.#_e=new Map}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return this.#Ce}set name(e){this.#Ce=e}get chainId(){return this.#he}set chainId(e){this.#he=lu(e,"chainId")}matches(e){if(null==e)return!1;if("string"==typeof e){try{return this.chainId===lu(e)}catch(e){}return this.name===e}if("number"==typeof e||"bigint"==typeof e){try{return this.chainId===lu(e)}catch(e){}return!1}if("object"==typeof e){if(null!=e.chainId){try{return this.chainId===lu(e.chainId)}catch(e){}return!1}return null!=e.name&&this.name===e.name}return!1}get plugins(){return Array.from(this.#_e.values())}attachPlugin(e){if(this.#_e.get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return this.#_e.set(e.name,e.clone()),this}getPlugin(e){return this.#_e.get(e)||null}getPlugins(e){return this.plugins.filter(t=>t.name.split("#")[0]===e)}clone(){const e=new nb(this.name,this.chainId);return this.plugins.forEach(t=>{e.attachPlugin(t.clone())}),e}computeIntrinsicGas(e){const t=this.getPlugin("org.ethers.plugins.network.GasCost")||new Yy;let r=t.txBase;if(null==e.to&&(r+=t.txCreate),e.data)for(let n=2;n<e.data.length;n+=2)"00"===e.data.substring(n,n+2)?r+=t.txDataZero:r+=t.txDataNonzero;if(e.accessList){const n=Xf(e.accessList);for(const e in n)r+=t.txAccessListAddress+t.txAccessListStorageKey*n[e].storageKeys.length}return r}static from(e){if(function(){function e(e,t,r){const n=function(){const n=new nb(e,t);return null!=r.ensNetwork&&n.attachPlugin(new Xy(null,r.ensNetwork)),n.attachPlugin(new Yy),(r.plugins||[]).forEach(e=>{n.attachPlugin(e)}),n};nb.register(e,n),nb.register(t,n),r.altNames&&r.altNames.forEach(e=>{nb.register(e,n)})}ob||(ob=!0,e("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),e("ropsten",3,{ensNetwork:3}),e("rinkeby",4,{ensNetwork:4}),e("goerli",5,{ensNetwork:5}),e("kovan",42,{ensNetwork:42}),e("sepolia",11155111,{ensNetwork:11155111}),e("holesky",17e3,{ensNetwork:17e3}),e("classic",61,{}),e("classicKotti",6,{}),e("arbitrum",42161,{ensNetwork:1}),e("arbitrum-goerli",421613,{}),e("arbitrum-sepolia",421614,{}),e("base",8453,{ensNetwork:1}),e("base-goerli",84531,{}),e("base-sepolia",84532,{}),e("bnb",56,{ensNetwork:1}),e("bnbt",97,{}),e("filecoin",314,{}),e("filecoin-calibration",314159,{}),e("linea",59144,{ensNetwork:1}),e("linea-goerli",59140,{}),e("linea-sepolia",59141,{}),e("matic",137,{ensNetwork:1,plugins:[sb("https://gasstation.polygon.technology/v2")]}),e("matic-amoy",80002,{}),e("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[sb("https://gasstation-testnet.polygon.technology/v2")]}),e("optimism",10,{ensNetwork:1,plugins:[]}),e("optimism-goerli",420,{}),e("optimism-sepolia",11155420,{}),e("xdai",100,{ensNetwork:1}))}(),null==e)return nb.from("mainnet");if("number"==typeof e&&(e=BigInt(e)),"string"==typeof e||"bigint"==typeof e){const t=rb.get(e);if(t)return t();if("bigint"==typeof e)return new nb("unknown",e);Uc(!1,"unknown network","network",e)}if("function"==typeof e.clone)return e.clone();if("object"==typeof e){Uc("string"==typeof e.name&&"number"==typeof e.chainId,"invalid network object name or chainId","network",e);const t=new nb(e.name,e.chainId);return(e.ensAddress||null!=e.ensNetwork)&&t.attachPlugin(new Xy(e.ensAddress,e.ensNetwork)),t}Uc(!1,"invalid network","network",e)}static register(e,t){"number"==typeof e&&(e=BigInt(e));const r=rb.get(e);r&&Uc(!1,`conflicting network for ${JSON.stringify(r.name)}`,"nameOrChainId",e),rb.set(e,t)}}function ib(e,t){const r=String(e);if(!r.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${e}`);const n=r.split(".");if(1===n.length&&n.push(""),2!==n.length)throw new Error(`invalid gwei value: ${e}`);for(;n[1].length<t;)n[1]+="0";if(n[1].length>9){let e=BigInt(n[1].substring(0,9));n[1].substring(9).match(/^0+$/)||e++,n[1]=e.toString()}return BigInt(n[0]+n[1])}function sb(e){return new tb(e,async(e,t,r)=>{let n;r.setHeader("User-Agent","ethers");try{const[t,i]=await Promise.all([r.send(),e()]);n=t;const s=n.bodyJson.standard;return{gasPrice:i.gasPrice,maxFeePerGas:ib(s.maxFee,9),maxPriorityFeePerGas:ib(s.maxPriorityFee,9)}}catch(e){Fc(!1,`error encountered with polygon gas station (${JSON.stringify(r.url)})`,"SERVER_ERROR",{request:r,response:n,error:e})}})}let ob=!1;function ab(e){return JSON.parse(JSON.stringify(e))}class cb{#Te;#Ne;#xe;#Oe;constructor(e){this.#Te=e,this.#Ne=null,this.#xe=4e3,this.#Oe=-2}get pollingInterval(){return this.#xe}set pollingInterval(e){this.#xe=e}async#De(){try{const e=await this.#Te.getBlockNumber();if(-2===this.#Oe)return void(this.#Oe=e);if(e!==this.#Oe){for(let t=this.#Oe+1;t<=e;t++){if(null==this.#Ne)return;await this.#Te.emit("block",t)}this.#Oe=e}}catch(e){}null!=this.#Ne&&(this.#Ne=this.#Te._setTimeout(this.#De.bind(this),this.#xe))}start(){this.#Ne||(this.#Ne=this.#Te._setTimeout(this.#De.bind(this),this.#xe),this.#De())}stop(){this.#Ne&&(this.#Te._clearTimeout(this.#Ne),this.#Ne=null)}pause(e){this.stop(),e&&(this.#Oe=-2)}resume(){this.start()}}class ub{#Te;#De;#Me;constructor(e){this.#Te=e,this.#Me=!1,this.#De=e=>{this._poll(e,this.#Te)}}async _poll(e,t){throw new Error("sub-classes must override this")}start(){this.#Me||(this.#Me=!0,this.#De(-2),this.#Te.on("block",this.#De))}stop(){this.#Me&&(this.#Me=!1,this.#Te.off("block",this.#De))}pause(e){this.stop()}resume(){this.start()}}class lb extends ub{#Be;#Le;constructor(e,t){super(e),this.#Be=t,this.#Le=-2}pause(e){e&&(this.#Le=-2),super.pause(e)}async _poll(e,t){const r=await t.getBlock(this.#Be);null!=r&&(-2===this.#Le?this.#Le=r.number:r.number>this.#Le&&(t.emit(this.#Be,r.number),this.#Le=r.number))}}class db extends ub{#ne;constructor(e,t){super(e),this.#ne=ab(t)}async _poll(e,t){throw new Error("@TODO")}}class hb extends ub{#Fe;constructor(e,t){super(e),this.#Fe=t}async _poll(e,t){const r=await t.getTransactionReceipt(this.#Fe);r&&t.emit(this.#Fe,r)}}class fb{#Te;#ne;#Ne;#Me;#Oe;constructor(e,t){this.#Te=e,this.#ne=ab(t),this.#Ne=this.#De.bind(this),this.#Me=!1,this.#Oe=-2}async#De(e){if(-2===this.#Oe)return;const t=ab(this.#ne);t.fromBlock=this.#Oe+1,t.toBlock=e;const r=await this.#Te.getLogs(t);if(0!==r.length)for(const e of r)this.#Te.emit(this.#ne,e),this.#Oe=e.blockNumber;else this.#Oe<e-60&&(this.#Oe=e-60)}start(){this.#Me||(this.#Me=!0,-2===this.#Oe&&this.#Te.getBlockNumber().then(e=>{this.#Oe=e}),this.#Te.on("block",this.#Ne))}stop(){this.#Me&&(this.#Me=!1,this.#Te.off("block",this.#Ne))}pause(e){this.stop(),e&&(this.#Oe=-2)}resume(){this.start()}}const pb=BigInt(2);function gb(e){return e&&"function"==typeof e.then}function mb(e,t){return e+":"+JSON.stringify(t,(e,t)=>{if(null==t)return"null";if("bigint"==typeof t)return`bigint:${t.toString()}`;if("string"==typeof t)return t.toLowerCase();if("object"==typeof t&&!Array.isArray(t)){const e=Object.keys(t);return e.sort(),e.reduce((e,r)=>(e[r]=t[r],e),{})}return t})}class yb{name;constructor(e){Oc(this,{name:e})}start(){}stop(){}pause(e){}resume(){}}function bb(e){return(e=Array.from(new Set(e).values())).sort(),e}async function wb(e,t){if(null==e)throw new Error("invalid event");if(Array.isArray(e)&&(e={topics:e}),"string"==typeof e)switch(e){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:e,tag:e}}if(Hc(e,32)){const t=e.toLowerCase();return{type:"transaction",tag:mb("tx",{hash:t}),hash:t}}if(e.orphan){const t=e;return{type:"orphan",tag:mb("orphan",t),filter:(r=t,JSON.parse(JSON.stringify(r)))}}var r;if(e.address||e.topics){const r=e,n={topics:(r.topics||[]).map(e=>null==e?null:Array.isArray(e)?bb(e.map(e=>e.toLowerCase())):e.toLowerCase())};if(r.address){const e=[],i=[],s=r=>{Hc(r)?e.push(r):i.push((async()=>{e.push(await lh(r,t))})())};Array.isArray(r.address)?r.address.forEach(s):s(r.address),i.length&&await Promise.all(i),n.address=bb(e.map(e=>e.toLowerCase()))}return{filter:n,tag:mb("event",n),type:"event"}}Uc(!1,"unknown ProviderEvent","event",e)}function vb(){return(new Date).getTime()}const Eb={cacheTimeout:250,pollingInterval:4e3};class Ab{#Ue;#_e;#je;#ze;#qe;#Ke;#Ge;#$e;#Ve;#He;#We;#l;constructor(e,t){if(this.#l=Object.assign({},Eb,t||{}),"any"===e)this.#Ke=!0,this.#qe=null;else if(e){const t=nb.from(e);this.#Ke=!1,this.#qe=Promise.resolve(t),setTimeout(()=>{this.emit("network",t,null)},0)}else this.#Ke=!1,this.#qe=null;this.#$e=-1,this.#Ge=new Map,this.#Ue=new Map,this.#_e=new Map,this.#je=null,this.#ze=!1,this.#Ve=1,this.#He=new Map,this.#We=!1}get pollingInterval(){return this.#l.pollingInterval}get provider(){return this}get plugins(){return Array.from(this.#_e.values())}attachPlugin(e){if(this.#_e.get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return this.#_e.set(e.name,e.connect(this)),this}getPlugin(e){return this.#_e.get(e)||null}get disableCcipRead(){return this.#We}set disableCcipRead(e){this.#We=!!e}async#Je(e){const t=this.#l.cacheTimeout;if(t<0)return await this._perform(e);const r=mb(e.method,e);let n=this.#Ge.get(r);return n||(n=this._perform(e),this.#Ge.set(r,n),setTimeout(()=>{this.#Ge.get(r)===n&&this.#Ge.delete(r)},t)),await n}async ccipReadFetch(e,t,r){if(this.disableCcipRead||0===r.length||null==e.to)return null;const n=e.to.toLowerCase(),i=t.toLowerCase(),s=[];for(let t=0;t<r.length;t++){const o=r[t],a=o.replace("{sender}",n).replace("{data}",i),c=new pp(a);-1===o.indexOf("{data}")&&(c.body={data:i,sender:n}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:c,index:t,urls:r});let u,l="unknown error";try{u=await c.send()}catch(e){s.push(e.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:c,result:{error:e}});continue}try{const e=u.bodyJson;if(e.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:c,result:e}),e.data;e.message&&(l=e.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:c,result:e})}catch(e){}Fc(u.statusCode<400||u.statusCode>=500,`response not found during CCIP fetch: ${l}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:e,info:{url:o,errorMessage:l}}),s.push(l)}Fc(!1,`error encountered during CCIP fetch: ${s.map(e=>JSON.stringify(e)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:e,info:{urls:r,errorMessages:s}})}_wrapBlock(e,t){return new Tp(function(e){const t=Hy(e);return t.transactions=e.transactions.map(e=>"string"==typeof e?e:Zy(e)),t}(e),this)}_wrapLog(e,t){return new Np(function(e){return Vy(e)}(e),this)}_wrapTransactionReceipt(e,t){return new xp(function(e){return Jy(e)}(e),this)}_wrapTransactionResponse(e,t){return new Op(Zy(e),this)}_detectNetwork(){Fc(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(e){Fc(!1,`unsupported method: ${e.method}`,"UNSUPPORTED_OPERATION",{operation:e.method,info:e})}async getBlockNumber(){const e=pu(await this.#Je({method:"getBlockNumber"}),"%response");return this.#$e>=0&&(this.#$e=e),e}_getAddress(e){return lh(e,this)}_getBlockTag(e){if(null==e)return"latest";switch(e){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return e}return Hc(e)?Hc(e,32)?e:bu(e):("bigint"==typeof e&&(e=pu(e,"blockTag")),"number"==typeof e?e>=0?bu(e):this.#$e>=0?bu(this.#$e+e):this.getBlockNumber().then(t=>bu(t+e)):void Uc(!1,"invalid blockTag","blockTag",e))}_getFilter(e){const t=(e.topics||[]).map(e=>null==e?null:Array.isArray(e)?bb(e.map(e=>e.toLowerCase())):e.toLowerCase()),r="blockHash"in e?e.blockHash:void 0,n=(e,n,i)=>{let s;switch(e.length){case 0:break;case 1:s=e[0];break;default:e.sort(),s=e}if(r&&(null!=n||null!=i))throw new Error("invalid filter");const o={};return s&&(o.address=s),t.length&&(o.topics=t),n&&(o.fromBlock=n),i&&(o.toBlock=i),r&&(o.blockHash=r),o};let i,s,o=[];if(e.address)if(Array.isArray(e.address))for(const t of e.address)o.push(this._getAddress(t));else o.push(this._getAddress(e.address));return"fromBlock"in e&&(i=this._getBlockTag(e.fromBlock)),"toBlock"in e&&(s=this._getBlockTag(e.toBlock)),o.filter(e=>"string"!=typeof e).length||null!=i&&"string"!=typeof i||null!=s&&"string"!=typeof s?Promise.all([Promise.all(o),i,s]).then(e=>n(e[0],e[1],e[2])):n(o,i,s)}_getTransactionRequest(e){const t=_p(e),r=[];if(["to","from"].forEach(e=>{if(null==t[e])return;const n=lh(t[e],this);gb(n)?r.push(async function(){t[e]=await n}()):t[e]=n}),null!=t.blockTag){const e=this._getBlockTag(t.blockTag);gb(e)?r.push(async function(){t.blockTag=await e}()):t.blockTag=e}return r.length?async function(){return await Promise.all(r),t}():t}async getNetwork(){if(null==this.#qe){const e=(async()=>{try{const e=await this._detectNetwork();return this.emit("network",e,null),e}catch(t){throw this.#qe===e&&(this.#qe=null),t}})();return this.#qe=e,(await e).clone()}const e=this.#qe,[t,r]=await Promise.all([e,this._detectNetwork()]);return t.chainId!==r.chainId&&(this.#Ke?(this.emit("network",r,t),this.#qe===e&&(this.#qe=Promise.resolve(r))):Fc(!1,`network changed: ${t.chainId} => ${r.chainId} `,"NETWORK_ERROR",{event:"changed"})),t.clone()}async getFeeData(){const e=await this.getNetwork(),t=async()=>{const{_block:t,gasPrice:r,priorityFee:n}=await xc({_block:this.#Ze("latest",!1),gasPrice:(async()=>{try{return lu(await this.#Je({method:"getGasPrice"}),"%response")}catch(e){}return null})(),priorityFee:(async()=>{try{return lu(await this.#Je({method:"getPriorityFee"}),"%response")}catch(e){}return null})()});let i=null,s=null;const o=this._wrapBlock(t,e);return o&&o.baseFeePerGas&&(s=null!=n?n:BigInt("1000000000"),i=o.baseFeePerGas*pb+s),new Cp(r,i,s)},r=e.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(r){const e=new pp(r.url),n=await r.processFunc(t,this,e);return new Cp(n.gasPrice,n.maxFeePerGas,n.maxPriorityFeePerGas)}return await t()}async estimateGas(e){let t=this._getTransactionRequest(e);return gb(t)&&(t=await t),lu(await this.#Je({method:"estimateGas",transaction:t}),"%response")}async#Qe(e,t,r){Fc(r<10,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},e,{blockTag:t,enableCcipRead:!0})});const n=_p(e);try{return Zc(await this._perform({method:"call",transaction:n,blockTag:t}))}catch(e){if(!this.disableCcipRead&&Bc(e)&&e.data&&r>=0&&"latest"===t&&null!=n.to&&"0x556f1830"===Xc(e.data,0,4)){const i=e.data,s=await lh(n.to,this);let o;try{o=function(e){const t={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};Fc(Yc(e)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const r=Xc(e,0,32);Fc(Xc(r,0,12)===Xc(_b,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),t.sender=Xc(r,12);try{const r=[],n=pu(Xc(e,32,64)),i=pu(Xc(e,n,n+32)),s=Xc(e,n+32);for(let e=0;e<i;e++){const t=Sb(s,32*e);if(null==t)throw new Error("abort");r.push(t)}t.urls=r}catch(e){Fc(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const r=kb(e,64);if(null==r)throw new Error("abort");t.calldata=r}catch(e){Fc(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}Fc(Xc(e,100,128)===Xc(_b,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),t.selector=Xc(e,96,100);try{const r=kb(e,128);if(null==r)throw new Error("abort");t.extraData=r}catch(e){Fc(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return t.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(e=>t[e]),t}(Xc(e.data,4))}catch(e){Fc(!1,e.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:n,info:{data:i}})}Fc(o.sender.toLowerCase()===s.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:i,reason:"OffchainLookup",transaction:n,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:o.errorArgs}});const a=await this.ccipReadFetch(n,o.calldata,o.urls);Fc(null!=a,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:n,info:{data:e.data,errorArgs:o.errorArgs}});const c={to:s,data:Qc([o.selector,Cb([a,o.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:c});try{const e=await this.#Qe(c,t,r+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},c),result:e}),e}catch(e){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},c),error:e}),e}}throw e}}async#Ye(e){const{value:t}=await xc({network:this.getNetwork(),value:e});return t}async call(e){const{tx:t,blockTag:r}=await xc({tx:this._getTransactionRequest(e),blockTag:this._getBlockTag(e.blockTag)});return await this.#Ye(this.#Qe(t,r,e.enableCcipRead?0:-1))}async#Xe(e,t,r){let n=this._getAddress(t),i=this._getBlockTag(r);return"string"==typeof n&&"string"==typeof i||([n,i]=await Promise.all([n,i])),await this.#Ye(this.#Je(Object.assign(e,{address:n,blockTag:i})))}async getBalance(e,t){return lu(await this.#Xe({method:"getBalance"},e,t),"%response")}async getTransactionCount(e,t){return pu(await this.#Xe({method:"getTransactionCount"},e,t),"%response")}async getCode(e,t){return Zc(await this.#Xe({method:"getCode"},e,t))}async getStorage(e,t,r){const n=lu(t,"position");return Zc(await this.#Xe({method:"getStorage",position:n},e,r))}async broadcastTransaction(e){const{blockNumber:t,hash:r,network:n}=await xc({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:e}),network:this.getNetwork()}),i=Ry.from(e);if(i.hash!==r)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(i,n).replaceableTransaction(t)}async#Ze(e,t){if(Hc(e,32))return await this.#Je({method:"getBlock",blockHash:e,includeTransactions:t});let r=this._getBlockTag(e);return"string"!=typeof r&&(r=await r),await this.#Je({method:"getBlock",blockTag:r,includeTransactions:t})}async getBlock(e,t){const{network:r,params:n}=await xc({network:this.getNetwork(),params:this.#Ze(e,!!t)});return null==n?null:this._wrapBlock(n,r)}async getTransaction(e){const{network:t,params:r}=await xc({network:this.getNetwork(),params:this.#Je({method:"getTransaction",hash:e})});return null==r?null:this._wrapTransactionResponse(r,t)}async getTransactionReceipt(e){const{network:t,params:r}=await xc({network:this.getNetwork(),params:this.#Je({method:"getTransactionReceipt",hash:e})});if(null==r)return null;if(null==r.gasPrice&&null==r.effectiveGasPrice){const t=await this.#Je({method:"getTransaction",hash:e});if(null==t)throw new Error("report this; could not find tx or effectiveGasPrice");r.effectiveGasPrice=t.gasPrice}return this._wrapTransactionReceipt(r,t)}async getTransactionResult(e){const{result:t}=await xc({network:this.getNetwork(),result:this.#Je({method:"getTransactionResult",hash:e})});return null==t?null:Zc(t)}async getLogs(e){let t=this._getFilter(e);gb(t)&&(t=await t);const{network:r,params:n}=await xc({network:this.getNetwork(),params:this.#Je({method:"getLogs",filter:t})});return n.map(e=>this._wrapLog(e,r))}_getProvider(e){Fc(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(e){return await Ly.fromName(this,e)}async getAvatar(e){const t=await this.getResolver(e);return t?await t.getAvatar():null}async resolveName(e){const t=await this.getResolver(e);return t?await t.getAddress():null}async lookupAddress(e){const t=Nm((e=Ol(e)).substring(2).toLowerCase()+".addr.reverse");try{const r=await Ly.getEnsAddress(this),n=new dg(r,["function resolver(bytes32) view returns (address)"],this),i=await n.resolver(t);if(null==i||i===yp)return null;const s=new dg(i,["function name(bytes32) view returns (string)"],this),o=await s.name(t);return await this.resolveName(o)!==e?null:o}catch(e){if(Mc(e,"BAD_DATA")&&"0x"===e.value)return null;if(Mc(e,"CALL_EXCEPTION"))return null;throw e}}async waitForTransaction(e,t,r){const n=null!=t?t:1;return 0===n?this.getTransactionReceipt(e):new Promise(async(t,i)=>{let s=null;const o=async r=>{try{const i=await this.getTransactionReceipt(e);if(null!=i&&r-i.blockNumber+1>=n)return t(i),void(s&&(clearTimeout(s),s=null))}catch(e){console.log("EEE",e)}this.once("block",o)};null!=r&&(s=setTimeout(()=>{null!=s&&(s=null,this.off("block",o),i(Lc("timeout","TIMEOUT",{reason:"timeout"})))},r)),o(await this.getBlockNumber())})}async waitForBlock(e){Fc(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(e){const t=this.#He.get(e);t&&(t.timer&&clearTimeout(t.timer),this.#He.delete(e))}_setTimeout(e,t){null==t&&(t=0);const r=this.#Ve++,n=()=>{this.#He.delete(r),e()};if(this.paused)this.#He.set(r,{timer:null,func:n,time:t});else{const e=setTimeout(n,t);this.#He.set(r,{timer:e,func:n,time:vb()})}return r}_forEachSubscriber(e){for(const t of this.#Ue.values())e(t.subscriber)}_getSubscriber(e){switch(e.type){case"debug":case"error":case"network":return new yb(e.type);case"block":{const e=new cb(this);return e.pollingInterval=this.pollingInterval,e}case"safe":case"finalized":return new lb(this,e.type);case"event":return new fb(this,e.filter);case"transaction":return new hb(this,e.hash);case"orphan":return new db(this,e.filter)}throw new Error(`unsupported event: ${e.type}`)}_recoverSubscriber(e,t){for(const r of this.#Ue.values())if(r.subscriber===e){r.started&&r.subscriber.stop(),r.subscriber=t,r.started&&t.start(),null!=this.#je&&t.pause(this.#je);break}}async#et(e,t){let r=await wb(e,this);return"event"===r.type&&t&&t.length>0&&!0===t[0].removed&&(r=await wb({orphan:"drop-log",log:t[0]},this)),this.#Ue.get(r.tag)||null}async#tt(e){const t=await wb(e,this),r=t.tag;let n=this.#Ue.get(r);return n||(n={subscriber:this._getSubscriber(t),tag:r,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},this.#Ue.set(r,n)),n}async on(e,t){const r=await this.#tt(e);return r.listeners.push({listener:t,once:!1}),r.started||(r.subscriber.start(),r.started=!0,null!=this.#je&&r.subscriber.pause(this.#je)),this}async once(e,t){const r=await this.#tt(e);return r.listeners.push({listener:t,once:!0}),r.started||(r.subscriber.start(),r.started=!0,null!=this.#je&&r.subscriber.pause(this.#je)),this}async emit(e,...t){const r=await this.#et(e,t);if(!r||0===r.listeners.length)return!1;const n=r.listeners.length;return r.listeners=r.listeners.filter(({listener:r,once:n})=>{const i=new Bp(this,n?null:r,e);try{r.call(this,...t,i)}catch(e){}return!n}),0===r.listeners.length&&(r.started&&r.subscriber.stop(),this.#Ue.delete(r.tag)),n>0}async listenerCount(e){if(e){const t=await this.#et(e);return t?t.listeners.length:0}let t=0;for(const{listeners:e}of this.#Ue.values())t+=e.length;return t}async listeners(e){if(e){const t=await this.#et(e);return t?t.listeners.map(({listener:e})=>e):[]}let t=[];for(const{listeners:e}of this.#Ue.values())t=t.concat(e.map(({listener:e})=>e));return t}async off(e,t){const r=await this.#et(e);if(!r)return this;if(t){const e=r.listeners.map(({listener:e})=>e).indexOf(t);e>=0&&r.listeners.splice(e,1)}return t&&0!==r.listeners.length||(r.started&&r.subscriber.stop(),this.#Ue.delete(r.tag)),this}async removeAllListeners(e){if(e){const{tag:t,started:r,subscriber:n}=await this.#tt(e);r&&n.stop(),this.#Ue.delete(t)}else for(const[e,{started:t,subscriber:r}]of this.#Ue)t&&r.stop(),this.#Ue.delete(e);return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return this.off(e,t)}get destroyed(){return this.#ze}destroy(){this.removeAllListeners();for(const e of this.#He.keys())this._clearTimeout(e);this.#ze=!0}get paused(){return null!=this.#je}set paused(e){!!e!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(e){if(this.#$e=-1,null!=this.#je){if(this.#je==!!e)return;Fc(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(t=>t.pause(e)),this.#je=!!e;for(const e of this.#He.values())e.timer&&clearTimeout(e.timer),e.time=vb()-e.time}resume(){if(null!=this.#je){this._forEachSubscriber(e=>e.resume()),this.#je=null;for(const e of this.#He.values()){let t=e.time;t<0&&(t=0),e.time=vb(),setTimeout(e.func,t)}}}}function Sb(e,t){try{const r=kb(e,t);if(r)return sd(r)}catch(e){}return null}function kb(e,t){if("0x"===e)return null;try{const r=pu(Xc(e,t,t+32)),n=pu(Xc(e,r,r+32));return Xc(e,r+32,r+32+n)}catch(e){}return null}function Rb(e){const t=yu(e);if(t.length>32)throw new Error("internal; should not happen");const r=new Uint8Array(32);return r.set(t,32-t.length),r}function Pb(e){if(e.length%32==0)return e;const t=new Uint8Array(32*Math.ceil(e.length/32));return t.set(e),t}const Ib=new Uint8Array([]);function Cb(e){const t=[];let r=0;for(let n=0;n<e.length;n++)t.push(Ib),r+=32;for(let n=0;n<e.length;n++){const i=$c(e[n]);t[n]=Rb(r),t.push(Rb(i.length)),t.push(Pb(i)),r+=32+32*Math.ceil(i.length/32)}return Qc(t)}const _b="0x0000000000000000000000000000000000000000000000000000000000000000";function Tb(e,t){if(e.provider)return e.provider;Fc(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:t})}async function Nb(e,t){let r=_p(t);if(null!=r.to&&(r.to=lh(r.to,e)),null!=r.from){const t=r.from;r.from=Promise.all([e.getAddress(),lh(t,e)]).then(([e,t])=>(Uc(e.toLowerCase()===t.toLowerCase(),"transaction from mismatch","tx.from",t),e))}else r.from=e.getAddress();return await xc(r)}class xb{provider;constructor(e){Oc(this,{provider:e||null})}async getNonce(e){return Tb(this,"getTransactionCount").getTransactionCount(await this.getAddress(),e)}async populateCall(e){return await Nb(this,e)}async populateTransaction(e){const t=Tb(this,"populateTransaction"),r=await Nb(this,e);null==r.nonce&&(r.nonce=await this.getNonce("pending")),null==r.gasLimit&&(r.gasLimit=await this.estimateGas(r));const n=await this.provider.getNetwork();null!=r.chainId?Uc(lu(r.chainId)===n.chainId,"transaction chainId mismatch","tx.chainId",e.chainId):r.chainId=n.chainId;const i=null!=r.maxFeePerGas||null!=r.maxPriorityFeePerGas;if(null==r.gasPrice||2!==r.type&&!i?0!==r.type&&1!==r.type||!i||Uc(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",e):Uc(!1,"eip-1559 transaction do not support gasPrice","tx",e),2!==r.type&&null!=r.type||null==r.maxFeePerGas||null==r.maxPriorityFeePerGas)if(0===r.type||1===r.type){const e=await t.getFeeData();Fc(null!=e.gasPrice,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),null==r.gasPrice&&(r.gasPrice=e.gasPrice)}else{const e=await t.getFeeData();if(null==r.type)if(null!=e.maxFeePerGas&&null!=e.maxPriorityFeePerGas)if(r.authorizationList&&r.authorizationList.length?r.type=4:r.type=2,null!=r.gasPrice){const e=r.gasPrice;delete r.gasPrice,r.maxFeePerGas=e,r.maxPriorityFeePerGas=e}else null==r.maxFeePerGas&&(r.maxFeePerGas=e.maxFeePerGas),null==r.maxPriorityFeePerGas&&(r.maxPriorityFeePerGas=e.maxPriorityFeePerGas);else null!=e.gasPrice?(Fc(!i,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),null==r.gasPrice&&(r.gasPrice=e.gasPrice),r.type=0):Fc(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else 2!==r.type&&3!==r.type&&4!==r.type||(null==r.maxFeePerGas&&(r.maxFeePerGas=e.maxFeePerGas),null==r.maxPriorityFeePerGas&&(r.maxPriorityFeePerGas=e.maxPriorityFeePerGas))}else r.type=2;return await xc(r)}async populateAuthorization(e){const t=Object.assign({},e);return null==t.chainId&&(t.chainId=(await Tb(this,"getNetwork").getNetwork()).chainId),null==t.nonce&&(t.nonce=await this.getNonce()),t}async estimateGas(e){return Tb(this,"estimateGas").estimateGas(await this.populateCall(e))}async call(e){return Tb(this,"call").call(await this.populateCall(e))}async resolveName(e){const t=Tb(this,"resolveName");return await t.resolveName(e)}async sendTransaction(e){const t=Tb(this,"sendTransaction"),r=await this.populateTransaction(e);delete r.from;const n=Ry.from(r);return await t.broadcastTransaction(await this.signTransaction(n))}authorize(e){Fc(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}class Ob extends xb{address;constructor(e,t){super(t),Oc(this,{address:e})}async getAddress(){return this.address}connect(e){return new Ob(this.address,e)}#rt(e,t){Fc(!1,`VoidSigner cannot sign ${e}`,"UNSUPPORTED_OPERATION",{operation:t})}async signTransaction(e){this.#rt("transactions","signTransaction")}async signMessage(e){this.#rt("messages","signMessage")}async signTypedData(e,t,r){this.#rt("typed-data","signTypedData")}}class Db{#Te;#nt;#Ne;#Me;#it;#st;constructor(e){this.#Te=e,this.#nt=null,this.#Ne=this.#De.bind(this),this.#Me=!1,this.#it=null,this.#st=!1}_subscribe(e){throw new Error("subclasses must override this")}_emitResults(e,t){throw new Error("subclasses must override this")}_recover(e){throw new Error("subclasses must override this")}async#De(e){try{null==this.#nt&&(this.#nt=this._subscribe(this.#Te));let e=null;try{e=await this.#nt}catch(e){if(!Mc(e,"UNSUPPORTED_OPERATION")||"eth_newFilter"!==e.operation)throw e}if(null==e)return this.#nt=null,void this.#Te._recoverSubscriber(this,this._recover(this.#Te));const t=await this.#Te.getNetwork();if(this.#it||(this.#it=t),this.#it.chainId!==t.chainId)throw new Error("chaid changed");if(this.#st)return;const r=await this.#Te.send("eth_getFilterChanges",[e]);await this._emitResults(this.#Te,r)}catch(e){console.log("@TODO",e)}this.#Te.once("block",this.#Ne)}#ot(){const e=this.#nt;e&&(this.#nt=null,e.then(e=>{this.#Te.destroyed||this.#Te.send("eth_uninstallFilter",[e])}))}start(){this.#Me||(this.#Me=!0,this.#De(-2))}stop(){this.#Me&&(this.#Me=!1,this.#st=!0,this.#ot(),this.#Te.off("block",this.#Ne))}pause(e){e&&this.#ot(),this.#Te.off("block",this.#Ne)}resume(){this.start()}}class Mb extends Db{#at;constructor(e,t){var r;super(e),this.#at=(r=t,JSON.parse(JSON.stringify(r)))}_recover(e){return new fb(e,this.#at)}async _subscribe(e){return await e.send("eth_newFilter",[this.#at])}async _emitResults(e,t){for(const r of t)e.emit(this.#at,e._wrapLog(r,e._network))}}class Bb extends Db{async _subscribe(e){return await e.send("eth_newPendingTransactionFilter",[])}async _emitResults(e,t){for(const r of t)e.emit("pending",r)}}const Lb="bigint,boolean,function,number,string,symbol".split(/,/g);function Fb(e){if(null==e||Lb.indexOf(typeof e)>=0)return e;if("function"==typeof e.getAddress)return e;if(Array.isArray(e))return e.map(Fb);if("object"==typeof e)return Object.keys(e).reduce((t,r)=>(t[r]=e[r],t),{});throw new Error(`should not happen: ${e} (${typeof e})`)}function Ub(e){return new Promise(t=>{setTimeout(t,e)})}function jb(e){return e?e.toLowerCase():e}function zb(e){return e&&"number"==typeof e.pollingInterval}const qb={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class Kb extends xb{address;constructor(e,t){super(e),Oc(this,{address:t=Ol(t)})}connect(e){Fc(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(e){return await this.populateCall(e)}async sendUncheckedTransaction(e){const t=Fb(e),r=[];if(t.from){const n=t.from;r.push((async()=>{const r=await lh(n,this.provider);Uc(null!=r&&r.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",e),t.from=r})())}else t.from=this.address;if(null==t.gasLimit&&r.push((async()=>{t.gasLimit=await this.provider.estimateGas({...t,from:this.address})})()),null!=t.to){const e=t.to;r.push((async()=>{t.to=await lh(e,this.provider)})())}r.length&&await Promise.all(r);const n=this.provider.getRpcTransaction(t);return this.provider.send("eth_sendTransaction",[n])}async sendTransaction(e){const t=await this.provider.getBlockNumber(),r=await this.sendUncheckedTransaction(e);return await new Promise((e,n)=>{const i=[1e3,100];let s=0;const o=async()=>{try{const n=await this.provider.getTransaction(r);if(null!=n)return void e(n.replaceableTransaction(t))}catch(e){if(Mc(e,"CANCELLED")||Mc(e,"BAD_DATA")||Mc(e,"NETWORK_ERROR")||Mc(e,"UNSUPPORTED_OPERATION"))return null==e.info&&(e.info={}),e.info.sendTransactionHash=r,void n(e);if(Mc(e,"INVALID_ARGUMENT")&&(s++,null==e.info&&(e.info={}),e.info.sendTransactionHash=r,s>10))return void n(e);this.provider.emit("error",Lc("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:e}))}this.provider._setTimeout(()=>{o()},i.pop()||4e3)};o()})}async signTransaction(e){const t=Fb(e);if(t.from){const r=await lh(t.from,this.provider);Uc(null!=r&&r.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",e),t.from=r}else t.from=this.address;const r=this.provider.getRpcTransaction(t);return await this.provider.send("eth_signTransaction",[r])}async signMessage(e){const t="string"==typeof e?id(e):e;return await this.provider.send("personal_sign",[Zc(t),this.address.toLowerCase()])}async signTypedData(e,t,r){const n=Fb(r),i=await Zf.resolveNames(e,t,n,async e=>{const t=await lh(e);return Uc(null!=t,"TypedData does not support null address","value",e),t});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(Zf.getPayload(i.domain,t,i.value))])}async unlock(e){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),e,null])}async _legacySignMessage(e){const t="string"==typeof e?id(e):e;return await this.provider.send("eth_sign",[this.address.toLowerCase(),Zc(t)])}}class Gb extends Ab{#l;#ct;#ut;#lt;#dt;#it;#ht;#ft(){if(this.#lt)return;const e=1===this._getOption("batchMaxCount")?0:this._getOption("batchStallTime");this.#lt=setTimeout(()=>{this.#lt=null;const e=this.#ut;for(this.#ut=[];e.length;){const t=[e.shift()];for(;e.length&&t.length!==this.#l.batchMaxCount;)if(t.push(e.shift()),JSON.stringify(t.map(e=>e.payload)).length>this.#l.batchMaxSize){e.unshift(t.pop());break}(async()=>{const e=1===t.length?t[0].payload:t.map(e=>e.payload);this.emit("debug",{action:"sendRpcPayload",payload:e});try{const r=await this._send(e);this.emit("debug",{action:"receiveRpcResult",result:r});for(const{resolve:e,reject:n,payload:i}of t){if(this.destroyed){n(Lc("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:i.method}));continue}const t=r.filter(e=>e.id===i.id)[0];if(null==t){const e=Lc("missing response for request","BAD_DATA",{value:r,info:{payload:i}});this.emit("error",e),n(e);continue}"error"in t?n(this.getRpcError(i,t)):e(t.result)}}catch(e){this.emit("debug",{action:"receiveRpcError",error:e});for(const{reject:r}of t)r(e)}})()}},e)}constructor(e,t){super(e,t),this.#ct=1,this.#l=Object.assign({},qb,t||{}),this.#ut=[],this.#lt=null,this.#it=null,this.#ht=null;{let e=null;const t=new Promise(t=>{e=t});this.#dt={promise:t,resolve:e}}const r=this._getOption("staticNetwork");"boolean"==typeof r?(Uc(!r||"any"!==e,"staticNetwork cannot be used on special network 'any'","options",t),r&&null!=e&&(this.#it=nb.from(e))):r&&(Uc(null==e||r.matches(e),"staticNetwork MUST match network object","options",t),this.#it=r)}_getOption(e){return this.#l[e]}get _network(){return Fc(this.#it,"network is not available yet","NETWORK_ERROR"),this.#it}async _perform(e){if("call"===e.method||"estimateGas"===e.method){let t=e.transaction;if(t&&null!=t.type&&lu(t.type)&&null==t.maxFeePerGas&&null==t.maxPriorityFeePerGas){const r=await this.getFeeData();null==r.maxFeePerGas&&null==r.maxPriorityFeePerGas&&(e=Object.assign({},e,{transaction:Object.assign({},t,{type:void 0})}))}}const t=this.getRpcRequest(e);return null!=t?await this.send(t.method,t.args):super._perform(e)}async _detectNetwork(){const e=this._getOption("staticNetwork");if(e){if(!0!==e)return e;if(this.#it)return this.#it}return this.#ht?await this.#ht:this.ready?(this.#ht=(async()=>{try{const e=nb.from(lu(await this.send("eth_chainId",[])));return this.#ht=null,e}catch(e){throw this.#ht=null,e}})(),await this.#ht):(this.#ht=(async()=>{const e={id:this.#ct++,method:"eth_chainId",params:[],jsonrpc:"2.0"};let t;this.emit("debug",{action:"sendRpcPayload",payload:e});try{t=(await this._send(e))[0],this.#ht=null}catch(e){throw this.#ht=null,this.emit("debug",{action:"receiveRpcError",error:e}),e}if(this.emit("debug",{action:"receiveRpcResult",result:t}),"result"in t)return nb.from(lu(t.result));throw this.getRpcError(e,t)})(),await this.#ht)}_start(){null!=this.#dt&&null!=this.#dt.resolve&&(this.#dt.resolve(),this.#dt=null,(async()=>{for(;null==this.#it&&!this.destroyed;)try{this.#it=await this._detectNetwork()}catch(e){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",Lc("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:e}})),await Ub(1e3)}this.#ft()})())}async _waitUntilReady(){if(null!=this.#dt)return await this.#dt.promise}_getSubscriber(e){return"pending"===e.type?new Bb(this):"event"===e.type?this._getOption("polling")?new fb(this,e.filter):new Mb(this,e.filter):"orphan"===e.type&&"drop-log"===e.filter.orphan?new yb("orphan"):super._getSubscriber(e)}get ready(){return null==this.#dt}getRpcTransaction(e){const t={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(r=>{if(null==e[r])return;let n=r;"gasLimit"===r&&(n="gas"),t[n]=bu(lu(e[r],`tx.${r}`))}),["from","to","data"].forEach(r=>{null!=e[r]&&(t[r]=Zc(e[r]))}),e.accessList&&(t.accessList=Xf(e.accessList)),e.blobVersionedHashes&&(t.blobVersionedHashes=e.blobVersionedHashes.map(e=>e.toLowerCase())),e.authorizationList&&(t.authorizationList=e.authorizationList.map(e=>{const t=ep(e);return{address:t.address,nonce:bu(t.nonce),chainId:bu(t.chainId),yParity:bu(t.signature.yParity),r:bu(t.signature.r),s:bu(t.signature.s)}})),t}getRpcRequest(e){switch(e.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[jb(e.address),e.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[jb(e.address),e.blockTag]};case"getCode":return{method:"eth_getCode",args:[jb(e.address),e.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[jb(e.address),"0x"+e.position.toString(16),e.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[e.signedTransaction]};case"getBlock":if("blockTag"in e)return{method:"eth_getBlockByNumber",args:[e.blockTag,!!e.includeTransactions]};if("blockHash"in e)return{method:"eth_getBlockByHash",args:[e.blockHash,!!e.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[e.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[e.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(e.transaction),e.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(e.transaction)]};case"getLogs":return e.filter&&null!=e.filter.address&&(Array.isArray(e.filter.address)?e.filter.address=e.filter.address.map(jb):e.filter.address=jb(e.filter.address)),{method:"eth_getLogs",args:[e.filter]}}return null}getRpcError(e,t){const{method:r}=e,{error:n}=t;if("eth_estimateGas"===r&&n.message){const t=n.message;if(!t.match(/revert/i)&&t.match(/insufficient funds/i))return Lc("insufficient funds","INSUFFICIENT_FUNDS",{transaction:e.params[0],info:{payload:e,error:n}});if(t.match(/nonce/i)&&t.match(/too low/i))return Lc("nonce has already been used","NONCE_EXPIRED",{transaction:e.params[0],info:{payload:e,error:n}})}if("eth_call"===r||"eth_estimateGas"===r){const t=Hb(n),i=oh.getBuiltinCallException("eth_call"===r?"call":"estimateGas",e.params[0],t?t.data:null);return i.info={error:n,payload:e},i}const i=JSON.stringify(function(e){const t=[];return Wb(e,t),t}(n));if("string"==typeof n.message&&n.message.match(/user denied|ethers-user-denied/i))return Lc("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[r]||"unknown",reason:"rejected",info:{payload:e,error:n}});if("eth_sendRawTransaction"===r||"eth_sendTransaction"===r){const t=e.params[0];if(i.match(/insufficient funds|base fee exceeds gas limit/i))return Lc("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:t,info:{error:n}});if(i.match(/nonce/i)&&i.match(/too low/i))return Lc("nonce has already been used","NONCE_EXPIRED",{transaction:t,info:{error:n}});if(i.match(/replacement transaction/i)&&i.match(/underpriced/i))return Lc("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:t,info:{error:n}});if(i.match(/only replay-protected/i))return Lc("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:r,info:{transaction:t,info:{error:n}}})}let s=!!i.match(/the method .* does not exist/i);return s||n&&n.details&&n.details.startsWith("Unauthorized method:")&&(s=!0),s?Lc("unsupported operation","UNSUPPORTED_OPERATION",{operation:e.method,info:{error:n,payload:e}}):Lc("could not coalesce error","UNKNOWN_ERROR",{error:n,payload:e})}send(e,t){if(this.destroyed)return Promise.reject(Lc("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:e}));const r=this.#ct++,n=new Promise((n,i)=>{this.#ut.push({resolve:n,reject:i,payload:{method:e,params:t,id:r,jsonrpc:"2.0"}})});return this.#ft(),n}async getSigner(e){null==e&&(e=0);const t=this.send("eth_accounts",[]);if("number"==typeof e){const r=await t;if(e>=r.length)throw new Error("no such account");return new Kb(this,r[e])}const{accounts:r}=await xc({network:this.getNetwork(),accounts:t});e=Ol(e);for(const t of r)if(Ol(t)===e)return new Kb(this,e);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(e=>new Kb(this,e))}destroy(){this.#lt&&(clearTimeout(this.#lt),this.#lt=null);for(const{payload:e,reject:t}of this.#ut)t(Lc("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:e.method}));this.#ut=[],super.destroy()}}class $b extends Gb{#pt;constructor(e,t){super(e,t);let r=this._getOption("pollingInterval");null==r&&(r=qb.pollingInterval),this.#pt=r}_getSubscriber(e){const t=super._getSubscriber(e);return zb(t)&&(t.pollingInterval=this.#pt),t}get pollingInterval(){return this.#pt}set pollingInterval(e){if(!Number.isInteger(e)||e<0)throw new Error("invalid interval");this.#pt=e,this._forEachSubscriber(e=>{zb(e)&&(e.pollingInterval=this.#pt)})}}class Vb extends $b{#gt;constructor(e,t,r){null==e&&(e="http://localhost:8545"),super(t,r),this.#gt="string"==typeof e?new pp(e):e.clone()}_getConnection(){return this.#gt.clone()}async send(e,t){return await this._start(),await super.send(e,t)}async _send(e){const t=this._getConnection();t.body=JSON.stringify(e),t.setHeader("content-type","application/json");const r=await t.send();r.assertOk();let n=r.bodyJson;return Array.isArray(n)||(n=[n]),n}}function Hb(e){if(null==e)return null;if("string"==typeof e.message&&e.message.match(/revert/i)&&Hc(e.data))return{message:e.message,data:e.data};if("object"==typeof e){for(const t in e){const r=Hb(e[t]);if(r)return r}return null}if("string"==typeof e)try{return Hb(JSON.parse(e))}catch(e){}return null}function Wb(e,t){if(null!=e){if("string"==typeof e.message&&t.push(e.message),"object"==typeof e)for(const r in e)Wb(e[r],t);if("string"==typeof e)try{return Wb(JSON.parse(e),t)}catch(e){}}}const Jb=BigInt("1"),Zb=BigInt("2");function Qb(){return(new Date).getTime()}function Yb(e){return JSON.stringify(e,(e,t)=>"bigint"==typeof t?{type:"bigint",value:t.toString()}:t)}const Xb={stallTimeout:400,priority:1,weight:1},ew={blockNumber:-2,requests:0,lateResponses:0,errorResponses:0,outOfSync:-1,unsupportedEvents:0,rollingDuration:0,score:0,_network:null,_updateNumber:null,_totalTime:0,_lastFatalError:null,_lastFatalErrorTimestamp:0};function tw(e){if(null==e)return"null";if(Array.isArray(e))return"["+e.map(tw).join(",")+"]";if("object"==typeof e&&"function"==typeof e.toJSON)return tw(e.toJSON());switch(typeof e){case"boolean":case"symbol":return e.toString();case"bigint":case"number":return BigInt(e).toString();case"string":return JSON.stringify(e);case"object":{const t=Object.keys(e);return t.sort(),"{"+t.map(t=>`${JSON.stringify(t)}:${tw(e[t])}`).join(",")+"}"}}throw console.log("Could not serialize",e),new Error("Hmm...")}function rw(e,t){if("error"in t){const e=t.error;let r;return r=Mc(e,"CALL_EXCEPTION")?tw(Object.assign({},e,{shortMessage:void 0,reason:void 0,info:void 0})):tw(e),{tag:r,value:e}}const r=t.result;return{tag:tw(r),value:r}}function nw(e,t){const r=new Map;for(const{value:e,tag:n,weight:i}of t){const t=r.get(n)||{value:e,weight:0};t.weight+=i,r.set(n,t)}let n=null;for(const t of r.values())t.weight>=e&&(!n||t.weight>n.weight)&&(n=t);if(n)return n.value}function iw(e,t){let r=0;const n=new Map;let i=null;const s=[];for(const{value:e,tag:o,weight:a}of t)if(e instanceof Error){const t=n.get(o)||{value:e,weight:0};t.weight+=a,n.set(o,t),(null==i||t.weight>i.weight)&&(i=t)}else s.push(BigInt(e)),r+=a;if(r<e)return i&&i.weight>=e?i.value:void 0;s.sort((e,t)=>e<t?-1:t>e?1:0);const o=Math.floor(s.length/2);return s.length%2?s[o]:(s[o-1]+s[o]+Jb)/Zb}function sw(e,t){const r=nw(e,t);if(void 0!==r)return r;for(const e of t)if(e.value)return e.value}class ow extends Ab{quorum;eventQuorum;eventWorkers;#mt;#yt;#bt;constructor(e,t,r){super(t,r),this.#mt=e.map(e=>e instanceof Ab?Object.assign({provider:e},Xb,ew):Object.assign({},Xb,e,ew)),this.#yt=-2,this.#bt=null,r&&null!=r.quorum?this.quorum=r.quorum:this.quorum=Math.ceil(this.#mt.reduce((e,t)=>e+t.weight,0)/2),this.eventQuorum=1,this.eventWorkers=1,Uc(this.quorum<=this.#mt.reduce((e,t)=>e+t.weight,0),"quorum exceed provider weight","quorum",this.quorum)}get providerConfigs(){return this.#mt.map(e=>{const t=Object.assign({},e);for(const e in t)"_"===e[0]&&delete t[e];return t})}async _detectNetwork(){return nb.from(lu(await this._perform({method:"chainId"})))}async _translatePerform(e,t){switch(t.method){case"broadcastTransaction":return await e.broadcastTransaction(t.signedTransaction);case"call":return await e.call(Object.assign({},t.transaction,{blockTag:t.blockTag}));case"chainId":return(await e.getNetwork()).chainId;case"estimateGas":return await e.estimateGas(t.transaction);case"getBalance":return await e.getBalance(t.address,t.blockTag);case"getBlock":{const r="blockHash"in t?t.blockHash:t.blockTag;return await e.getBlock(r,t.includeTransactions)}case"getBlockNumber":return await e.getBlockNumber();case"getCode":return await e.getCode(t.address,t.blockTag);case"getGasPrice":return(await e.getFeeData()).gasPrice;case"getPriorityFee":return(await e.getFeeData()).maxPriorityFeePerGas;case"getLogs":return await e.getLogs(t.filter);case"getStorage":return await e.getStorage(t.address,t.position,t.blockTag);case"getTransaction":return await e.getTransaction(t.hash);case"getTransactionCount":return await e.getTransactionCount(t.address,t.blockTag);case"getTransactionReceipt":return await e.getTransactionReceipt(t.hash);case"getTransactionResult":return await e.getTransactionResult(t.hash)}}#wt(e){const t=Array.from(e).map(e=>e.config),r=this.#mt.slice();!function(e){for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[r],e[r]=n}}(r),r.sort((e,t)=>e.priority-t.priority);for(const e of r)if(!e._lastFatalError&&-1===t.indexOf(e))return e;return null}#vt(e,t){const r=this.#wt(e);if(null==r)return null;const n={config:r,result:null,didBump:!1,perform:null,staller:null},i=Qb();return n.perform=(async()=>{try{r.requests++;const e=await this._translatePerform(r.provider,t);n.result={result:e}}catch(e){r.errorResponses++,n.result={error:e}}const e=Qb()-i;r._totalTime+=e,r.rollingDuration=.95*r.rollingDuration+.05*e,n.perform=null})(),n.staller=(async()=>{await function(e){return new Promise(t=>{setTimeout(t,e)})}(r.stallTimeout),n.staller=null})(),e.add(n),n}async#Et(){let e=this.#bt;if(!e){const t=[];this.#mt.forEach(e=>{t.push((async()=>{await async function(e){for(;(e.blockNumber<0||e.blockNumber<0)&&(e._updateNumber||(e._updateNumber=(async()=>{try{const t=await e.provider.getBlockNumber();t>e.blockNumber&&(e.blockNumber=t)}catch(t){e.blockNumber=-2,e._lastFatalError=t,e._lastFatalErrorTimestamp=Qb()}e._updateNumber=null})()),await e._updateNumber,e.outOfSync++,!e._lastFatalError););}(e),e._lastFatalError||(e._network=await e.provider.getNetwork())})())}),this.#bt=e=(async()=>{await Promise.all(t);let e=null;for(const t of this.#mt){if(t._lastFatalError)continue;const r=t._network;null==e?e=r.chainId:r.chainId!==e&&Fc(!1,"cannot mix providers on different networks","UNSUPPORTED_OPERATION",{operation:"new FallbackProvider"})}})()}await e}async#At(e,t){const r=[];for(const n of e)if(null!=n.result){const{tag:e,value:i}=rw(t.method,n.result);r.push({tag:e,value:i,weight:n.config.weight})}if(!(r.reduce((e,t)=>e+t.weight,0)<this.quorum)){switch(t.method){case"getBlockNumber":{-2===this.#yt&&(this.#yt=Math.ceil(pu(iw(this.quorum,this.#mt.filter(e=>!e._lastFatalError).map(e=>({value:e.blockNumber,tag:pu(e.blockNumber).toString(),weight:e.weight}))))));const e=function(e,t){if(1===e)return pu(iw(e,t),"%internal");const r=new Map,n=(e,t)=>{const n=r.get(e)||{result:e,weight:0};n.weight+=t,r.set(e,n)};for(const{weight:e,value:r}of t){const t=pu(r);n(t-1,e),n(t,e),n(t+1,e)}let i,s=0;for(const{weight:t,result:n}of r.values())t>=e&&(t>s||null!=i&&t===s&&n>i)&&(s=t,i=n);return i}(this.quorum,r);if(void 0===e)return;return e>this.#yt&&(this.#yt=e),this.#yt}case"getGasPrice":case"getPriorityFee":case"estimateGas":return iw(this.quorum,r);case"getBlock":return"blockTag"in t&&"pending"===t.blockTag?sw(this.quorum,r):nw(this.quorum,r);case"call":case"chainId":case"getBalance":case"getTransactionCount":case"getCode":case"getStorage":case"getTransaction":case"getTransactionReceipt":case"getLogs":return nw(this.quorum,r);case"broadcastTransaction":return sw(this.quorum,r)}Fc(!1,"unsupported method","UNSUPPORTED_OPERATION",{operation:`_perform(${Yb(t.method)})`})}}async#St(e,t){if(0===e.size)throw new Error("no runners?!");const r=[];let n=0;for(const t of e)t.perform&&r.push(t.perform),t.staller?r.push(t.staller):t.didBump||(t.didBump=!0,n++);const i=await this.#At(e,t);if(void 0!==i){if(i instanceof Error)throw i;return i}for(let r=0;r<n;r++)this.#vt(e,t);return Fc(r.length>0,"quorum not met","SERVER_ERROR",{request:"%sub-requests",info:{request:t,results:Array.from(e).map(e=>Yb(e.result))}}),await Promise.race(r),await this.#St(e,t)}async _perform(e){if("broadcastTransaction"===e.method){const t=this.#mt.map(e=>null),r=this.#mt.map(async({provider:r,weight:n},i)=>{try{const s=await r._perform(e);t[i]=Object.assign(rw(e.method,{result:s}),{weight:n})}catch(r){t[i]=Object.assign(rw(e.method,{error:r}),{weight:n})}});for(;;){const e=t.filter(e=>null!=e);for(const{value:t}of e)if(!(t instanceof Error))return t;const n=nw(this.quorum,t.filter(e=>null!=e));if(Mc(n,"INSUFFICIENT_FUNDS"))throw n;const i=r.filter((e,r)=>null==t[r]);if(0===i.length)break;await Promise.race(i)}const n=sw(this.quorum,t);if(Fc(void 0!==n,"problem multi-broadcasting","SERVER_ERROR",{request:"%sub-requests",info:{request:e,results:t.map(Yb)}}),n instanceof Error)throw n;return n}await this.#Et();const t=new Set;let r=0;for(;;){const n=this.#vt(t,e);if(null==n)break;if(r+=n.config.weight,r>=this.quorum)break}const n=await this.#St(t,e);for(const e of t)e.perform&&null==e.result&&e.config.lateResponses++;return n}async destroy(){for(const{provider:e}of this.#mt)e.destroy();super.destroy()}}const aw=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),cw=BigInt("1000000000000000000"),uw=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),lw=BigInt("0x8000000000000000000000000000000000000000000000000000000000000000")*BigInt(-1),dw=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),hw="",fw="Ethereum Signed Message:\n";function pw(e){return"string"==typeof e&&(e=id(e)),Rl(Qc([id(fw),id(String(e.length)),e]))}function gw(e,t){return Mf(pw(e),t)}function mw(e){return Uc("string"==typeof e.address,"invalid address for hashAuthorization","auth.address",e),Rl(Qc(["0x05",sy([null!=e.chainId?yu(e.chainId):"0x",Ol(e.address),null!=e.nonce?yu(e.nonce):"0x"])]))}function yw(e,t){return Mf(mw(e),t)}class bw extends xb{address;#kt;constructor(e,t){super(t),Uc(e&&"function"==typeof e.sign,"invalid private key","privateKey","[ REDACTED ]"),this.#kt=e,Oc(this,{address:Df(this.signingKey.publicKey)})}get signingKey(){return this.#kt}get privateKey(){return this.signingKey.privateKey}async getAddress(){return this.address}connect(e){return new bw(this.#kt,e)}async signTransaction(e){e=_p(e);const{to:t,from:r}=await xc({to:e.to?lh(e.to,this):void 0,from:e.from?lh(e.from,this):void 0});null!=t&&(e.to=t),null!=r&&(e.from=r),null!=e.from&&(Uc(Ol(e.from)===this.address,"transaction from address mismatch","tx.from",e.from),delete e.from);const n=Ry.from(e);return n.signature=this.signingKey.sign(n.unsignedHash),n.serialized}async signMessage(e){return this.signMessageSync(e)}signMessageSync(e){return this.signingKey.sign(pw(e)).serialized}authorizeSync(e){Uc("string"==typeof e.address,"invalid address for authorizeSync","auth.address",e);const t=this.signingKey.sign(mw(e));return Object.assign({},{address:Ol(e.address),nonce:lu(e.nonce||0),chainId:lu(e.chainId||0)},{signature:t})}async authorize(e){return e=Object.assign({},e,{address:await lh(e.address,this)}),this.authorizeSync(await this.populateAuthorization(e))}async signTypedData(e,t,r){const n=await Zf.resolveNames(e,t,r,async e=>{Fc(null!=this.provider,"cannot resolve ENS names without a provider","UNSUPPORTED_OPERATION",{operation:"resolveName",info:{name:e}});const t=await this.provider.resolveName(e);return Fc(null!=t,"unconfigured ENS name","UNCONFIGURED_NAME",{value:e}),t});return this.signingKey.sign(Zf.hash(n.domain,t,n.value)).serialized}}let ww=!1;const vw=function(e,t,r){return function(e,t){const r={sha256:bh,sha512:Um}[e];return Uc(null!=r,"invalid hmac algorithm","algorithm",e),ef.create(r,t)}(e,t).update(r).digest()};let Ew=vw;function Aw(e,t,r){const n=$c(t,"key"),i=$c(r,"data");return Zc(Ew(e,n,i))}Aw._=vw,Aw.lock=function(){ww=!0},Aw.register=function(e){if(ww)throw new Error("computeHmac is locked");Ew=e},Object.freeze(Aw);const Sw=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),kw=Uint8Array.from({length:16},(e,t)=>t);let Rw=[kw],Pw=[kw.map(e=>(9*e+5)%16)];for(let e=0;e<4;e++)for(let t of[Rw,Pw])t.push(t[e].map(e=>Sw[e]));const Iw=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(e=>new Uint8Array(e)),Cw=Rw.map((e,t)=>e.map(e=>Iw[t][e])),_w=Pw.map((e,t)=>e.map(e=>Iw[t][e])),Tw=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),Nw=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),xw=(e,t)=>e<<t|e>>>32-t;function Ow(e,t,r,n){return 0===e?t^r^n:1===e?t&r|~t&n:2===e?(t|~r)^n:3===e?t&n|r&~n:t^(r|~n)}const Dw=new Uint32Array(16);class Mw extends dh{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:r,h3:n,h4:i}=this;return[e,t,r,n,i]}set(e,t,r,n,i){this.h0=0|e,this.h1=0|t,this.h2=0|r,this.h3=0|n,this.h4=0|i}process(e,t){for(let r=0;r<16;r++,t+=4)Dw[r]=e.getUint32(t,!0);let r=0|this.h0,n=r,i=0|this.h1,s=i,o=0|this.h2,a=o,c=0|this.h3,u=c,l=0|this.h4,d=l;for(let e=0;e<5;e++){const t=4-e,h=Tw[e],f=Nw[e],p=Rw[e],g=Pw[e],m=Cw[e],y=_w[e];for(let t=0;t<16;t++){const n=xw(r+Ow(e,i,o,c)+Dw[p[t]]+h,m[t])+l|0;r=l,l=c,c=0|xw(o,10),o=i,i=n}for(let e=0;e<16;e++){const r=xw(n+Ow(t,s,a,u)+Dw[g[e]]+f,y[e])+d|0;n=d,d=u,u=0|xw(a,10),a=s,s=r}}this.set(this.h1+o+u|0,this.h2+c+d|0,this.h3+l+n|0,this.h4+r+s|0,this.h0+i+a|0)}roundClean(){Dw.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const Bw=sl(()=>new Mw);let Lw=!1;const Fw=function(e){return Bw(e)};let Uw=Fw;function jw(e){const t=$c(e,"data");return Zc(Uw(t))}jw._=Fw,jw.lock=function(){Lw=!0},jw.register=function(e){if(Lw)throw new TypeError("ripemd160 is locked");Uw=e},Object.freeze(jw);let zw=!1;const qw=function(e){return new Uint8Array(function(e){Fc(null!=zm,"platform does not support secure random numbers","UNSUPPORTED_OPERATION",{operation:"randomBytes"}),Uc(Number.isInteger(e)&&e>0&&e<=1024,"invalid length","length",e);const t=new Uint8Array(e);return zm.getRandomValues(t),t}(e))};let Kw=qw;function Gw(e){return Kw(e)}Gw._=qw,Gw.lock=function(){zw=!0},Gw.register=function(e){if(zw)throw new Error("randomBytes is locked");Kw=e},Object.freeze(Gw);const $w=/^[a-z]*$/i;function Vw(e,t){let r=97;return e.reduce((e,n)=>(n===t?r++:n.match($w)?e.push(String.fromCharCode(r)+n):(r=97,e.push(n)),e),[])}function Hw(e){return Uc("0"===e[0],"unsupported auwl data","data",e),function(e,t){for(let r=28;r>=0;r--)e=e.split(" !#$%&'()*+,-./<=>?@[]^_`{|}~"[r]).join(t.substring(2*r,2*r+2));const r=[],n=e.replace(/(:|([0-9])|([A-Z][a-z]*))/g,(e,t,n,i)=>{if(n)for(let e=parseInt(n);e>=0;e--)r.push(";");else r.push(t.toLowerCase());return""});if(n)throw new Error(`leftovers: ${JSON.stringify(n)}`);return Vw(Vw(r,";"),":")}(e.substring(59),e.substring(1,59))}class Ww{locale;constructor(e){Oc(this,{locale:e})}split(e){return e.toLowerCase().split(/\s+/g)}join(e){return e.join(" ")}}class Jw extends Ww{#t;#Rt;constructor(e,t,r){super(e),this.#t=t,this.#Rt=r,this.#Pt=null}get _data(){return this.#t}_decodeWords(){return Hw(this.#t)}#Pt;#It(){if(null==this.#Pt){const e=this._decodeWords();if(ud(e.join("\n")+"\n")!==this.#Rt)throw new Error(`BIP39 Wordlist for ${this.locale} FAILED`);this.#Pt=e}return this.#Pt}getWord(e){const t=this.#It();return Uc(e>=0&&e<t.length,`invalid word index: ${e}`,"index",e),t[e]}getWordIndex(e){return this.#It().indexOf(e)}}let Zw=null;class Qw extends Jw{constructor(){super("en","0erleonalorenseinceregesticitStanvetearctssi#ch2Athck&tneLl0And#Il.yLeOutO=S|S%b/ra@SurdU'0Ce[Cid|CountCu'Hie=IdOu,-Qui*Ro[TT]T%T*[Tu$0AptDD-tD*[Ju,M.UltV<)Vi)0Rob-0FairF%dRaid0A(EEntRee0Ead0MRRp%tS!_rmBumCoholErtI&LLeyLowMo,O}PhaReadySoT Ways0A>urAz(gOngOuntU'd0Aly,Ch%Ci|G G!GryIm$K!Noun)Nu$O` Sw T&naTiqueXietyY1ArtOlogyPe?P!Pro=Ril1ChCt-EaEnaGueMMedM%MyOundR<+Re,Ri=RowTTefa@Ti,Tw%k0KPe@SaultSetSi,SumeThma0H!>OmTa{T&dT.udeTra@0Ct]D.Gu,NtTh%ToTumn0Era+OcadoOid0AkeA*AyEsomeFulKw?d0Is:ByChel%C#D+GL<)Lc#y~MbooN<aNn RRelyRga(R*lSeS-SketTt!3A^AnAutyCau'ComeEfF%eG(Ha=H(dLie=LowLtN^Nef./TrayTt Twe&Y#d3Cyc!DKeNdOlogyRdR`Tt _{AdeAmeAnketA,EakE[IndOodO[omOu'UeUrUsh_rdAtDyIlMbNeNusOkO,Rd R(gRrowSsTtomUn)XY_{etA(AndA[A=EadEezeI{Id+IefIghtIngIskOccoliOk&OnzeOomO` OwnUsh2Bb!DdyD+tFf$oIldLbLkL!tNd!Nk Rd&Rg R,SS(e[SyTt Y Zz:Bba+B(B!CtusGeKe~LmM aMpNN$N)lNdyNn#NoeNvasNy#Pab!P.$Pta(RRb#RdRgoRpetRryRtSeShS(o/!Su$TT$ogT^Teg%yTt!UghtU'Ut]Ve3Il(gL yM|NsusNturyRe$Rta(_irAlkAmp]An+AosApt Ar+A'AtEapE{Ee'EfErryE,I{&IefIldIm}yOi)Oo'R#-U{!UnkUrn0G?Nnam#Rc!Tiz&TyVil_imApArifyAwAyE<ErkEv I{I|IffImbIn-IpO{OgO'O`OudOwnUbUmpU, Ut^_^A,C#utDeFfeeIlInL!@L%LumnMb(eMeMf%tM-Mm#Mp<yNc tNdu@NfirmNg*[N}@Nsid NtrolNv()OkOlPp PyR$ReRnR*@/Tt#U^UntryUp!Ur'Us(V Yo>_{Ad!AftAmA}AshAt AwlAzyEamEd.EekEwI{etImeIspIt-OpO[Ou^OwdUci$UelUi'Umb!Un^UshYY,$2BeLtu*PPbo?dRiousRr|Rta(R=Sh]/omTe3C!:DMa+MpN)Ng R(gShUght WnY3AlBa>BrisCadeCemb CideCl(eC%a>C*a'ErF&'F(eFyG*eLayLiv M<dMi'Ni$Nti,NyP?tP&dPos.P`PutyRi=ScribeS tSignSkSpair/royTailTe@VelopVi)Vo>3AgramAlAm#dAryCeE'lEtFf G.$Gn.yLemmaNn NosaurRe@RtSag*eScov Sea'ShSmi[S%d Splay/<)V tVideV%)Zzy5Ct%Cum|G~Lph(Ma(Na>NkeyN%OrSeUb!Ve_ftAg#AmaA,-AwEamE[IftIllInkIpI=OpUmY2CkMbNeR(g/T^Ty1Arf1Nam-:G G!RlyRnR`Sily/Sy1HoOlogyOnomy0GeItUca>1F%t0G1GhtTh 2BowD E@r-Eg<tEm|Eph<tEvat%I>Se0B?kBodyBra)Er+Ot]PloyPow Pty0Ab!A@DD![D%'EmyErgyF%)Ga+G(eH<)JoyLi,OughR-hRollSu*T Ti*TryVelope1Isode0U$Uip0AA'OdeOs]R%Upt0CapeSayS&)Ta>0Ern$H-s1Id&)IlOkeOl=1A@Amp!Ce[Ch<+C.eCludeCu'Ecu>Erci'Hau,Hib.I!I,ItOt-P<dPe@Pi*Pla(Po'P*[T&dTra0EEbrow:Br-CeCultyDeIntI`~L'MeMilyMousNNcyNtasyRmSh]TT$Th TigueUltV%.e3Atu*Bru?yD $EEdElMa!N)/iv$T^V W3B Ct]EldGu*LeLmLt N$NdNeNg NishReRmR,Sc$ShTT}[X_gAmeAshAtAv%EeIghtIpOatO{O%Ow UidUshY_mCusGIlLd~owOdOtR)Re,R+tRkRtu}RumRw?dSsil/ UndX_gi!AmeEqu|EshI&dIn+OgOntO,OwnOz&U.2ElNNnyRna)RyTu*:D+tInLaxy~ yMePRa+Rba+Rd&Rl-Rm|SSpTeTh U+Ze3N $NiusN*Nt!Nu(e/u*2O,0AntFtGg!Ng RaffeRlVe_dAn)A*A[IdeImp'ObeOomOryO=OwUe_tDde[LdOdO'RillaSpelSsipV nWn_bA)A(AntApeA[Av.yEatE&IdIefItOc yOupOwUnt_rdE[IdeIltIt?N3M:B.IrLfMm M, NdPpyRb%RdRshR=,TVeWkZ?d3AdAl`ArtAvyD+hogIght~oLmetLpNRo3Dd&Gh~NtPRe/%y5BbyCkeyLdLeLiday~owMeNeyOdPeRnRr%R'Sp.$/TelUrV 5BGeM<Mb!M%Nd*dNgryNtRd!RryRtSb<d3Brid:1EOn0EaEntifyLe2N%e4LLeg$L}[0A+Ita>M&'Mu}Pa@Po'Pro=Pul'0ChCludeComeC*a'DexD-a>Do%Du,ryF<tFl-tF%mHa!H .Iti$Je@JuryMa>N Noc|PutQuiryS<eSe@SideSpi*/$lTa@T e,ToVe,V.eVol=3On0L<dOla>Sue0Em1Ory:CketGu?RZz3AlousAns~yWel9BInKeUr}yY5D+I)MpNg!Ni%Nk/:Ng?oo3EnEpT^upY3CkDD}yNdNgdomSsTT^&TeTt&Wi4EeIfeO{Ow:BBelB%Dd DyKeMpNgua+PtopR+T T(UghUndryVaWWnWsu.Y Zy3Ad AfArnA=Ctu*FtGG$G&dIsu*M#NdNg`NsOp?dSs#Tt Vel3ArB tyBr?yC&'FeFtGhtKeMbM.NkOnQuid/Tt!VeZ?d5AdAnB, C$CkG-NelyNgOpTt yUdUn+VeY$5CkyGga+Mb N?N^Xury3R-s:Ch(eDG-G}tIdIlInJ%KeMm$NNa+Nda>NgoNs]Nu$P!Rb!R^Rg(R(eRketRria+SkSs/ T^T i$ThTrixTt XimumZe3AdowAnAsu*AtCh<-D$DiaLodyLtMb M%yNt]NuRcyR+R.RryShSsa+T$Thod3Dd!DnightLk~]M-NdNimumN%Nu>Rac!Rr%S ySs/akeXXedXtu*5Bi!DelDifyMM|N.%NkeyN, N`OnR$ReRn(gSqu.oTh T]T%Unta(U'VeVie5ChFf(LeLtiplySc!SeumShroomS-/Tu$3Self/ yTh:I=MePk(Rrow/yT]Tu*3ArCkEdGati=G!@I` PhewR=/TTw%kUtr$V WsXt3CeGht5B!I'M(eeOd!Rm$R`SeTab!TeTh(gTi)VelW5C!?Mb R'T:K0EyJe@Li+Scu*S =Ta(Vious0CurE<Tob 0Or1FF Fi)T&2L1Ay0DI=Ymp-0It0CeEI#L(eLy1EnEraIn]Po'T]1An+B.Ch?dD D(?yG<I|Ig($Ph<0Tr-h0H 0Tdo%T TputTside0AlEnEr0NN 0Yg&0/ 0O}:CtDd!GeIrLa)LmNdaNelN-N` P RadeR|RkRrotRtySsT^ThTi|TrolTt nU'VeYm|3A)AnutArAs<tL-<NN$tyNcilOp!Pp Rfe@Rm.Rs#T2O}OtoRa'Ys-$0AnoCn-Ctu*E)GGe#~LotNkO} Pe/olT^Zza_)A}tA,-A>AyEa'Ed+U{UgUn+2EmEtIntL?LeLi)NdNyOlPul?Rt]S.]Ssib!/TatoTt yV tyWd W _@i)Ai'Ed-tEf Epa*Es|EttyEv|I)IdeIm?yIntI%.yIs#Iva>IzeOb!mO)[Odu)Of.OgramOje@Omo>OofOp tyOsp O>@OudOvide2Bl-Dd(g~LpL'Mpk(N^PilPpyR^a'R.yRpo'R'ShTZz!3Ramid:99Al.yAntumArt E,]I{ItIzO>:Bb.Cco#CeCkD?DioIlInI'~yMpN^NdomN+PidReTeTh V&WZ%3AdyAlAs#BelBuildC$lCei=CipeC%dCyc!Du)F!@F%mFu'G]G*tGul?Je@LaxLea'LiefLyMa(Memb M(dMo=Nd NewNtOp&PairPeatPla)P%tQui*ScueSemb!Si,Sour)Sp#'SultTi*T*atTurnUn]Ve$ViewW?d2Y`m0BBb#CeChDeD+F!GhtGidNgOtPp!SkTu$V$V 5AdA,BotBu,CketM<)OfOkieOmSeTa>UghUndU>Y$5Bb DeGLeNNwayR$:DDd!D}[FeIlLadLm#L#LtLu>MeMp!NdTisfyToshiU)Usa+VeY1A!AnA*Att E}HemeHoolI&)I[%sOrp]OutRapRe&RiptRub1AAr^As#AtC#dC*tCt]Cur.yEdEkGm|Le@~M(?Ni%N'Nt&)RiesRvi)Ss]Tt!TupV&_dowAftAllowA*EdEllEriffIeldIftI}IpIv O{OeOotOpOrtOuld O=RimpRugUff!Y0Bl(gCkDeE+GhtGnL|Lk~yLv Mil?Mp!N)NgR&/ Tua>XZe1A>Et^IIllInIrtUll0AbAmEepEnd I)IdeIghtImOg<OtOwUsh0AllArtI!OkeOo`0A{AkeApIffOw0ApCc Ci$CkDaFtL?Ldi LidLut]L=Me#eNgOnRryRtUlUndUpUr)U`0A)A*Ati$AwnEakEci$EedEllEndH eI)Id IkeInIr.L.OilOns%O#OrtOtRayReadR(gY0Ua*UeezeUir*l_b!AdiumAffA+AirsAmpAndArtA>AyEakEelEmEpE*oI{IllIngO{Oma^O}OolOryO=Ra>gyReetRikeR#gRugg!Ud|UffUmb!Y!0Bje@Bm.BwayC)[ChDd&Ff G?G+,ItMm NNnyN'tP PplyP*meReRfa)R+Rpri'RroundR=ySpe@/a(1AllowAmpApArmE?EetIftImIngIt^Ord1MbolMptomRup/em:B!Ck!GIlL|LkNkPeR+tSk/eTtooXi3A^Am~NN<tNnisNtRm/Xt_nkAtEmeEnE%yE*EyIngIsOughtReeRi=RowUmbUnd 0CketDeG LtMb MeNyPRedSsueT!5A,BaccoDayDdl EGe` I!tK&MatoM%rowNeNgueNightOlO`PP-Pp!R^RnadoRtoi'SsT$Uri,W?dW WnY_{AdeAff-Ag-A(Ansf ApAshA=lAyEatEeEndI$IbeI{Igg ImIpOphyOub!U{UeUlyUmpetU,U`Y2BeIt]Mb!NaN}lRkeyRnRt!1El=EntyI)InI,O1PeP-$:5Ly5B*lla0Ab!Awa*C!Cov D DoFairFoldHappyIf%mIqueItIv 'KnownLo{TilUsu$Veil1Da>GradeHoldOnP Set1B<Ge0A+EEdEfulE![U$0Il.y:C<tCuumGueLidL!yL=NNishP%Rious/Ult3H-!L=tNd%Ntu*NueRbRifyRs]RyS'lT <3Ab!Br<tCiousCt%yDeoEw~a+Nta+Ol(Rtu$RusSaS.Su$T$Vid5C$I)IdLc<oLumeTeYa+:GeG#ItLk~LnutNtRfa*RmRri%ShSp/eT VeY3Al`Ap#ArA'lA` BDd(gEk&dIrdLcome/T_!AtEatEelEnE*IpIsp 0DeD`FeLd~NNdowNeNgNkNn Nt ReSdomSeShT}[5LfM<Nd OdOlRdRkRldRryR`_pE{E,!I,I>Ong::Rd3Ar~ow9UUngU`:3BraRo9NeO","0x3c8acc1e7b08d8e76f9fda015ef48dc8c710a73cb7e0f77b2c18a9b5a7adde60")}static wordlist(){return null==Zw&&(Zw=new Qw),Zw}}let Yw=!1;const Xw=function(e,t,r,n,i){return function(e,t,r,n,i){const s={sha256:bh,sha512:Um}[i];return Uc(null!=s,"invalid pbkdf2 algorithm","algorithm",i),Om(s,e,t,{c:r,dkLen:n})}(e,t,r,n,i)};let ev=Xw;function tv(e,t,r,n,i){const s=$c(e,"password"),o=$c(t,"salt");return Zc(ev(s,o,r,n,i))}function rv(e){return(1<<e)-1<<8-e&255}function nv(e){return(1<<e)-1&255}function iv(e,t){qc("NFKD"),null==t&&(t=Qw.wordlist());const r=t.split(e);Uc(r.length%3==0&&r.length>=12&&r.length<=24,"invalid mnemonic length","mnemonic","[ REDACTED ]");const n=new Uint8Array(Math.ceil(11*r.length/8));let i=0;for(let e=0;e<r.length;e++){let s=t.getWordIndex(r[e].normalize("NFKD"));Uc(s>=0,`invalid mnemonic word at index ${e}`,"mnemonic","[ REDACTED ]");for(let e=0;e<11;e++)s&1<<10-e&&(n[i>>3]|=1<<7-i%8),i++}const s=32*r.length/3,o=rv(r.length/3);return Uc(($c(Jm(n.slice(0,s/8)))[0]&o)===(n[n.length-1]&o),"invalid mnemonic checksum","mnemonic","[ REDACTED ]"),Zc(n.slice(0,s/8))}function sv(e,t){Uc(e.length%4==0&&e.length>=16&&e.length<=32,"invalid entropy size","entropy","[ REDACTED ]"),null==t&&(t=Qw.wordlist());const r=[0];let n=11;for(let t=0;t<e.length;t++)n>8?(r[r.length-1]<<=8,r[r.length-1]|=e[t],n-=8):(r[r.length-1]<<=n,r[r.length-1]|=e[t]>>8-n,r.push(e[t]&nv(8-n)),n+=3);const i=e.length/4,s=parseInt(Jm(e).substring(2,4),16)&rv(i);return r[r.length-1]<<=i,r[r.length-1]|=s>>8-i,t.join(r.map(e=>t.getWord(e)))}tv._=Xw,tv.lock=function(){Yw=!0},tv.register=function(e){if(Yw)throw new Error("pbkdf2 is locked");ev=e},Object.freeze(tv);const ov={};class av{phrase;password;wordlist;entropy;constructor(e,t,r,n,i){null==n&&(n=""),null==i&&(i=Qw.wordlist()),Kc(e,ov,"Mnemonic"),Oc(this,{phrase:r,password:n,wordlist:i,entropy:t})}computeSeed(){const e=id("mnemonic"+this.password,"NFKD");return tv(id(this.phrase,"NFKD"),e,2048,64,"sha512")}static fromPhrase(e,t,r){const n=iv(e,r);return e=sv($c(n),r),new av(ov,n,e,t,r)}static fromEntropy(e,t,r){const n=$c(e,"entropy"),i=sv(n,r);return new av(ov,Zc(n),i,t,r)}static entropyToPhrase(e,t){return sv($c(e,"entropy"),t)}static phraseToEntropy(e,t){return iv(e,t)}static isValidMnemonic(e,t){try{return iv(e,t),!0}catch(e){}return!1}}var cv,uv,lv,dv=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},hv=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const fv={16:10,24:12,32:14},pv=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],gv=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],mv=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],yv=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],bv=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],wv=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],vv=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],Ev=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],Av=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],Sv=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],kv=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],Rv=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Pv=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],Iv=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Cv=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function _v(e){const t=[];for(let r=0;r<e.length;r+=4)t.push(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]);return t}class Tv{get key(){return dv(this,cv,"f").slice()}constructor(e){if(cv.set(this,void 0),uv.set(this,void 0),lv.set(this,void 0),!(this instanceof Tv))throw Error("AES must be instanitated with `new`");hv(this,cv,new Uint8Array(e),"f");const t=fv[this.key.length];if(null==t)throw new TypeError("invalid key size (must be 16, 24 or 32 bytes)");hv(this,lv,[],"f"),hv(this,uv,[],"f");for(let e=0;e<=t;e++)dv(this,lv,"f").push([0,0,0,0]),dv(this,uv,"f").push([0,0,0,0]);const r=4*(t+1),n=this.key.length/4,i=_v(this.key);let s;for(let e=0;e<n;e++)s=e>>2,dv(this,lv,"f")[s][e%4]=i[e],dv(this,uv,"f")[t-s][e%4]=i[e];let o,a=0,c=n;for(;c<r;){if(o=i[n-1],i[0]^=gv[o>>16&255]<<24^gv[o>>8&255]<<16^gv[255&o]<<8^gv[o>>24&255]^pv[a]<<24,a+=1,8!=n)for(let e=1;e<n;e++)i[e]^=i[e-1];else{for(let e=1;e<n/2;e++)i[e]^=i[e-1];o=i[n/2-1],i[n/2]^=gv[255&o]^gv[o>>8&255]<<8^gv[o>>16&255]<<16^gv[o>>24&255]<<24;for(let e=n/2+1;e<n;e++)i[e]^=i[e-1]}let e,s,u=0;for(;u<n&&c<r;)e=c>>2,s=c%4,dv(this,lv,"f")[e][s]=i[u],dv(this,uv,"f")[t-e][s]=i[u++],c++}for(let e=1;e<t;e++)for(let t=0;t<4;t++)o=dv(this,uv,"f")[e][t],dv(this,uv,"f")[e][t]=Rv[o>>24&255]^Pv[o>>16&255]^Iv[o>>8&255]^Cv[255&o]}encrypt(e){if(16!=e.length)throw new TypeError("invalid plaintext size (must be 16 bytes)");const t=dv(this,lv,"f").length-1,r=[0,0,0,0];let n=_v(e);for(let e=0;e<4;e++)n[e]^=dv(this,lv,"f")[0][e];for(let e=1;e<t;e++){for(let t=0;t<4;t++)r[t]=yv[n[t]>>24&255]^bv[n[(t+1)%4]>>16&255]^wv[n[(t+2)%4]>>8&255]^vv[255&n[(t+3)%4]]^dv(this,lv,"f")[e][t];n=r.slice()}const i=new Uint8Array(16);let s=0;for(let e=0;e<4;e++)s=dv(this,lv,"f")[t][e],i[4*e]=255&(gv[n[e]>>24&255]^s>>24),i[4*e+1]=255&(gv[n[(e+1)%4]>>16&255]^s>>16),i[4*e+2]=255&(gv[n[(e+2)%4]>>8&255]^s>>8),i[4*e+3]=255&(gv[255&n[(e+3)%4]]^s);return i}decrypt(e){if(16!=e.length)throw new TypeError("invalid ciphertext size (must be 16 bytes)");const t=dv(this,uv,"f").length-1,r=[0,0,0,0];let n=_v(e);for(let e=0;e<4;e++)n[e]^=dv(this,uv,"f")[0][e];for(let e=1;e<t;e++){for(let t=0;t<4;t++)r[t]=Ev[n[t]>>24&255]^Av[n[(t+3)%4]>>16&255]^Sv[n[(t+2)%4]>>8&255]^kv[255&n[(t+1)%4]]^dv(this,uv,"f")[e][t];n=r.slice()}const i=new Uint8Array(16);let s=0;for(let e=0;e<4;e++)s=dv(this,uv,"f")[t][e],i[4*e]=255&(mv[n[e]>>24&255]^s>>24),i[4*e+1]=255&(mv[n[(e+3)%4]>>16&255]^s>>16),i[4*e+2]=255&(mv[n[(e+2)%4]>>8&255]^s>>8),i[4*e+3]=255&(mv[255&n[(e+1)%4]]^s);return i}}cv=new WeakMap,uv=new WeakMap,lv=new WeakMap;class Nv{constructor(e,t,r){if(r&&!(this instanceof r))throw new Error(`${e} must be instantiated with "new"`);Object.defineProperties(this,{aes:{enumerable:!0,value:new Tv(t)},name:{enumerable:!0,value:e}})}}var xv,Ov,Dv=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},Mv=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class Bv extends Nv{constructor(e,t){if(super("ECC",e,Bv),xv.set(this,void 0),Ov.set(this,void 0),t){if(t.length%16)throw new TypeError("invalid iv size (must be 16 bytes)");Dv(this,xv,new Uint8Array(t),"f")}else Dv(this,xv,new Uint8Array(16),"f");Dv(this,Ov,this.iv,"f")}get iv(){return new Uint8Array(Mv(this,xv,"f"))}encrypt(e){if(e.length%16)throw new TypeError("invalid plaintext size (must be multiple of 16 bytes)");const t=new Uint8Array(e.length);for(let r=0;r<e.length;r+=16){for(let t=0;t<16;t++)Mv(this,Ov,"f")[t]^=e[r+t];Dv(this,Ov,this.aes.encrypt(Mv(this,Ov,"f")),"f"),t.set(Mv(this,Ov,"f"),r)}return t}decrypt(e){if(e.length%16)throw new TypeError("invalid ciphertext size (must be multiple of 16 bytes)");const t=new Uint8Array(e.length);for(let r=0;r<e.length;r+=16){const n=this.aes.decrypt(e.subarray(r,r+16));for(let i=0;i<16;i++)t[r+i]=n[i]^Mv(this,Ov,"f")[i],Mv(this,Ov,"f")[i]=e[r+i]}return t}}xv=new WeakMap,Ov=new WeakMap;new WeakMap,new WeakMap,new WeakSet;var Lv,Fv,Uv,jv=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},zv=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class qv extends Nv{constructor(e,t){super("CTR",e,qv),Lv.set(this,void 0),Fv.set(this,void 0),Uv.set(this,void 0),jv(this,Uv,new Uint8Array(16),"f"),zv(this,Uv,"f").fill(0),jv(this,Lv,zv(this,Uv,"f"),"f"),jv(this,Fv,16,"f"),null==t&&(t=1),"number"==typeof t?this.setCounterValue(t):this.setCounterBytes(t)}get counter(){return new Uint8Array(zv(this,Uv,"f"))}setCounterValue(e){if(!Number.isInteger(e)||e<0||e>Number.MAX_SAFE_INTEGER)throw new TypeError("invalid counter initial integer value");for(let t=15;t>=0;--t)zv(this,Uv,"f")[t]=e%256,e=Math.floor(e/256)}setCounterBytes(e){if(16!==e.length)throw new TypeError("invalid counter initial Uint8Array value length");zv(this,Uv,"f").set(e)}increment(){for(let e=15;e>=0;e--){if(255!==zv(this,Uv,"f")[e]){zv(this,Uv,"f")[e]++;break}zv(this,Uv,"f")[e]=0}}encrypt(e){var t,r;const n=new Uint8Array(e);for(let e=0;e<n.length;e++)16===zv(this,Fv,"f")&&(jv(this,Lv,this.aes.encrypt(zv(this,Uv,"f")),"f"),jv(this,Fv,0,"f"),this.increment()),n[e]^=zv(this,Lv,"f")[(jv(this,Fv,(r=zv(this,Fv,"f"),t=r++,r),"f"),t)];return n}decrypt(e){return this.encrypt(e)}}Lv=new WeakMap,Fv=new WeakMap,Uv=new WeakMap,new WeakMap,new WeakMap,new WeakMap;const Kv=(e,t)=>e<<t|e>>>32-t;function Gv(e,t,r,n,i,s){let o=e[t++]^r[n++],a=e[t++]^r[n++],c=e[t++]^r[n++],u=e[t++]^r[n++],l=e[t++]^r[n++],d=e[t++]^r[n++],h=e[t++]^r[n++],f=e[t++]^r[n++],p=e[t++]^r[n++],g=e[t++]^r[n++],m=e[t++]^r[n++],y=e[t++]^r[n++],b=e[t++]^r[n++],w=e[t++]^r[n++],v=e[t++]^r[n++],E=e[t++]^r[n++],A=o,S=a,k=c,R=u,P=l,I=d,C=h,_=f,T=p,N=g,x=m,O=y,D=b,M=w,B=v,L=E;for(let e=0;e<8;e+=2)P^=Kv(A+D|0,7),T^=Kv(P+A|0,9),D^=Kv(T+P|0,13),A^=Kv(D+T|0,18),N^=Kv(I+S|0,7),M^=Kv(N+I|0,9),S^=Kv(M+N|0,13),I^=Kv(S+M|0,18),B^=Kv(x+C|0,7),k^=Kv(B+x|0,9),C^=Kv(k+B|0,13),x^=Kv(C+k|0,18),R^=Kv(L+O|0,7),_^=Kv(R+L|0,9),O^=Kv(_+R|0,13),L^=Kv(O+_|0,18),S^=Kv(A+R|0,7),k^=Kv(S+A|0,9),R^=Kv(k+S|0,13),A^=Kv(R+k|0,18),C^=Kv(I+P|0,7),_^=Kv(C+I|0,9),P^=Kv(_+C|0,13),I^=Kv(P+_|0,18),O^=Kv(x+N|0,7),T^=Kv(O+x|0,9),N^=Kv(T+O|0,13),x^=Kv(N+T|0,18),D^=Kv(L+B|0,7),M^=Kv(D+L|0,9),B^=Kv(M+D|0,13),L^=Kv(B+M|0,18);i[s++]=o+A|0,i[s++]=a+S|0,i[s++]=c+k|0,i[s++]=u+R|0,i[s++]=l+P|0,i[s++]=d+I|0,i[s++]=h+C|0,i[s++]=f+_|0,i[s++]=p+T|0,i[s++]=g+N|0,i[s++]=m+x|0,i[s++]=y+O|0,i[s++]=b+D|0,i[s++]=w+M|0,i[s++]=v+B|0,i[s++]=E+L|0}function $v(e,t,r,n,i){let s=n+0,o=n+16*i;for(let n=0;n<16;n++)r[o+n]=e[t+16*(2*i-1)+n];for(let n=0;n<i;n++,s+=16,t+=16)Gv(r,o,e,t,r,s),n>0&&(o+=16),Gv(r,s,e,t+=16,r,o)}function Vv(e,t,r){const n=il({dkLen:32,asyncTick:10,maxmem:1073742848},r),{N:i,r:s,p:o,dkLen:a,asyncTick:c,maxmem:u,onProgress:l}=n;if(Du(i),Du(s),Du(o),Du(a),Du(c),Du(u),void 0!==l&&"function"!=typeof l)throw new Error("progressCb should be function");const d=128*s,h=d/4;if(i<=1||i&i-1||i>=2**(d/8)||i>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(o<0||o>137438953440/d)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(a<0||a>137438953440)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");const f=d*(i+o);if(f>u)throw new Error(`Scrypt: parameters too large, ${f} (128 * r * (N + p)) > ${u} (maxmem)`);const p=Om(bh,e,t,{c:1,dkLen:d*o}),g=Zu(p),m=Zu(new Uint8Array(d*i)),y=Zu(new Uint8Array(d));let b=()=>{};if(l){const e=2*i*o,t=Math.max(Math.floor(e/1e4),1);let r=0;b=()=>{r++,!l||r%t&&r!==e||l(r/e)}}return{N:i,r:s,p:o,dkLen:a,blockSize32:h,V:m,B32:g,B:p,tmp:y,blockMixCb:b,asyncTick:c}}function Hv(e,t,r,n,i){const s=Om(bh,e,r,{c:1,dkLen:t});return r.fill(0),n.fill(0),i.fill(0),s}let Wv=!1,Jv=!1;const Zv=async function(e,t,r,n,i,s,o){return await async function(e,t,r){const{N:n,r:i,p:s,dkLen:o,blockSize32:a,V:c,B32:u,B:l,tmp:d,blockMixCb:h,asyncTick:f}=Vv(e,t,r);for(let e=0;e<s;e++){const t=a*e;for(let e=0;e<a;e++)c[e]=u[t+e];let r=0;await el(n-1,f,()=>{$v(c,r,c,r+=a,i),h()}),$v(c,(n-1)*a,u,t,i),h(),await el(n,f,()=>{const e=u[t+a-16]%n;for(let r=0;r<a;r++)d[r]=u[t+r]^c[e*a+r];$v(d,0,u,t,i),h()})}return Hv(e,o,l,c,d)}(e,t,{N:r,r:n,p:i,dkLen:s,onProgress:o})},Qv=function(e,t,r,n,i,s){return function(e,t,r){const{N:n,r:i,p:s,dkLen:o,blockSize32:a,V:c,B32:u,B:l,tmp:d,blockMixCb:h}=Vv(e,t,r);for(let e=0;e<s;e++){const t=a*e;for(let e=0;e<a;e++)c[e]=u[t+e];for(let e=0,t=0;e<n-1;e++)$v(c,t,c,t+=a,i),h();$v(c,(n-1)*a,u,t,i),h();for(let e=0;e<n;e++){const e=u[t+a-16]%n;for(let r=0;r<a;r++)d[r]=u[t+r]^c[e*a+r];$v(d,0,u,t,i),h()}}return Hv(e,o,l,c,d)}(e,t,{N:r,r:n,p:i,dkLen:s})};let Yv=Zv,Xv=Qv;async function eE(e,t,r,n,i,s,o){const a=$c(e,"passwd"),c=$c(t,"salt");return Zc(await Yv(a,c,r,n,i,s,o))}function tE(e,t,r,n,i,s){const o=$c(e,"passwd"),a=$c(t,"salt");return Zc(Xv(o,a,r,n,i,s))}function rE(e){const t=$c(e,"randomBytes");t[6]=15&t[6]|64,t[8]=63&t[8]|128;const r=Zc(t);return[r.substring(2,10),r.substring(10,14),r.substring(14,18),r.substring(18,22),r.substring(22,34)].join("-")}function nE(e){return"string"!=typeof e||e.startsWith("0x")||(e="0x"+e),Vc(e)}function iE(e,t){for(e=String(e);e.length<t;)e="0"+e;return e}function sE(e){return"string"==typeof e?id(e,"NFKC"):Vc(e)}function oE(e,t){const r=t.match(/^([a-z0-9$_.-]*)(:([a-z]+))?(!)?$/i);Uc(null!=r,"invalid path","path",t);const n=r[1],i=r[3],s="!"===r[4];let o=e;for(const e of n.toLowerCase().split(".")){if(Array.isArray(o)){if(!e.match(/^[0-9]+$/))break;o=o[parseInt(e)]}else if("object"==typeof o){let t=null;for(const r in o)if(r.toLowerCase()===e){t=o[r];break}o=t}else o=null;if(null==o)break}if(Uc(!s||null!=o,"missing required value","path",n),i&&null!=o){if("int"===i){if("string"==typeof o&&o.match(/^-?[0-9]+$/))return parseInt(o);if(Number.isSafeInteger(o))return o}if("number"===i&&"string"==typeof o&&o.match(/^-?[0-9.]*$/))return parseFloat(o);if("data"===i&&"string"==typeof o)return nE(o);if("array"===i&&Array.isArray(o))return o;if(i===typeof o)return o;Uc(!1,`wrong type found for ${i} `,"path",n)}return o}eE._=Zv,eE.lock=function(){Jv=!0},eE.register=function(e){if(Jv)throw new Error("scrypt is locked");Yv=e},Object.freeze(eE),tE._=Qv,tE.lock=function(){Wv=!0},tE.register=function(e){if(Wv)throw new Error("scryptSync is locked");Xv=e},Object.freeze(tE);const aE="m/44'/60'/0'/0/0";function cE(e){try{const t=JSON.parse(e);if(3===(null!=t.version?parseInt(t.version):0))return!0}catch(e){}return!1}function uE(e,t){const r=$c(t),n=oE(e,"crypto.ciphertext:data!");Uc(Zc(Rl(Qc([r.slice(16,32),n]))).substring(2)===oE(e,"crypto.mac:string!").toLowerCase(),"incorrect password","password","[ REDACTED ]");const i=function(e,t,r){if("aes-128-ctr"===oE(e,"crypto.cipher:string")){const n=oE(e,"crypto.cipherparams.iv:data!");return Zc(new qv(t,n).decrypt(r))}Fc(!1,"unsupported cipher","UNSUPPORTED_OPERATION",{operation:"decrypt"})}(e,r.slice(0,16),n),s=Df(i);if(e.address){let t=e.address.toLowerCase();t.startsWith("0x")||(t="0x"+t),Uc(Ol(t)===s,"keystore address/privateKey mismatch","address",e.address)}const o={address:s,privateKey:i};if("0.1"===oE(e,"x-ethers.version:string")){const t=r.slice(32,64),n=oE(e,"x-ethers.mnemonicCiphertext:data!"),i=oE(e,"x-ethers.mnemonicCounter:data!"),s=new qv(t,i);o.mnemonic={path:oE(e,"x-ethers.path:string")||aE,locale:oE(e,"x-ethers.locale:string")||"en",entropy:Zc($c(s.decrypt(n)))}}return o}function lE(e){const t=oE(e,"crypto.kdf:string");if(t&&"string"==typeof t){if("scrypt"===t.toLowerCase()){const r=oE(e,"crypto.kdfparams.salt:data!"),n=oE(e,"crypto.kdfparams.n:int!"),i=oE(e,"crypto.kdfparams.r:int!"),s=oE(e,"crypto.kdfparams.p:int!");Uc(n>0&&!(n&n-1),"invalid kdf.N","kdf.N",n),Uc(i>0&&s>0,"invalid kdf","kdf",t);const o=oE(e,"crypto.kdfparams.dklen:int!");return Uc(32===o,"invalid kdf.dklen","kdf.dflen",o),{name:"scrypt",salt:r,N:n,r:i,p:s,dkLen:64}}if("pbkdf2"===t.toLowerCase()){const t=oE(e,"crypto.kdfparams.salt:data!"),r=oE(e,"crypto.kdfparams.prf:string!"),n=r.split("-").pop();Uc("sha256"===n||"sha512"===n,"invalid kdf.pdf","kdf.pdf",r);const i=oE(e,"crypto.kdfparams.c:int!"),s=oE(e,"crypto.kdfparams.dklen:int!");return Uc(32===s,"invalid kdf.dklen","kdf.dklen",s),{name:"pbkdf2",salt:t,count:i,dkLen:s,algorithm:n}}}Uc(!1,"unsupported key-derivation function","kdf",t)}function dE(e,t){const r=JSON.parse(e),n=sE(t),i=lE(r);if("pbkdf2"===i.name){const{salt:e,count:t,dkLen:s,algorithm:o}=i;return uE(r,tv(n,e,t,s,o))}Fc("scrypt"===i.name,"cannot be reached","UNKNOWN_ERROR",{params:i});const{salt:s,N:o,r:a,p:c,dkLen:u}=i;return uE(r,tE(n,s,o,a,c,u))}function hE(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}async function fE(e,t,r){const n=JSON.parse(e),i=sE(t),s=lE(n);if("pbkdf2"===s.name){r&&(r(0),await hE(0));const{salt:e,count:t,dkLen:o,algorithm:a}=s,c=tv(i,e,t,o,a);return r&&(r(1),await hE(0)),uE(n,c)}Fc("scrypt"===s.name,"cannot be reached","UNKNOWN_ERROR",{params:s});const{salt:o,N:a,r:c,p:u,dkLen:l}=s;return uE(n,await eE(i,o,a,c,u,l,r))}function pE(e){const t=null!=e.salt?$c(e.salt,"options.salt"):Gw(32);let r=1<<17,n=8,i=1;return e.scrypt&&(e.scrypt.N&&(r=e.scrypt.N),e.scrypt.r&&(n=e.scrypt.r),e.scrypt.p&&(i=e.scrypt.p)),Uc("number"==typeof r&&r>0&&Number.isSafeInteger(r)&&(BigInt(r)&BigInt(r-1))===BigInt(0),"invalid scrypt N parameter","options.N",r),Uc("number"==typeof n&&n>0&&Number.isSafeInteger(n),"invalid scrypt r parameter","options.r",n),Uc("number"==typeof i&&i>0&&Number.isSafeInteger(i),"invalid scrypt p parameter","options.p",i),{name:"scrypt",dkLen:32,salt:t,N:r,r:n,p:i}}function gE(e,t,r,n){const i=$c(r.privateKey,"privateKey"),s=null!=n.iv?$c(n.iv,"options.iv"):Gw(16);Uc(16===s.length,"invalid options.iv length","options.iv",n.iv);const o=null!=n.uuid?$c(n.uuid,"options.uuid"):Gw(16);Uc(16===o.length,"invalid options.uuid length","options.uuid",n.iv);const a=e.slice(0,16),c=e.slice(16,32),u=$c(new qv(a,s).encrypt(i)),l=Rl(Qc([c,u])),d={address:r.address.substring(2).toLowerCase(),id:rE(o),version:3,Crypto:{cipher:"aes-128-ctr",cipherparams:{iv:Zc(s).substring(2)},ciphertext:Zc(u).substring(2),kdf:"scrypt",kdfparams:{salt:Zc(t.salt).substring(2),n:t.N,dklen:32,p:t.p,r:t.r},mac:l.substring(2)}};if(r.mnemonic){const t=null!=n.client?n.client:`ethers/${Tc}`,i=r.mnemonic.path||aE,s=r.mnemonic.locale||"en",o=e.slice(32,64),a=$c(r.mnemonic.entropy,"account.mnemonic.entropy"),c=Gw(16),u=$c(new qv(o,c).encrypt(a)),l=new Date,h="UTC--"+l.getUTCFullYear()+"-"+iE(l.getUTCMonth()+1,2)+"-"+iE(l.getUTCDate(),2)+"T"+iE(l.getUTCHours(),2)+"-"+iE(l.getUTCMinutes(),2)+"-"+iE(l.getUTCSeconds(),2)+".0Z--"+d.address;d["x-ethers"]={client:t,gethFilename:h,path:i,locale:s,mnemonicCounter:Zc(c).substring(2),mnemonicCiphertext:Zc(u).substring(2),version:"0.1"}}return JSON.stringify(d)}function mE(e,t,r){null==r&&(r={});const n=sE(t),i=pE(r);return gE($c(tE(n,i.salt,i.N,i.r,i.p,64)),i,e,r)}async function yE(e,t,r){null==r&&(r={});const n=sE(t),i=pE(r);return gE($c(await eE(n,i.salt,i.N,i.r,i.p,64,r.progressCallback)),i,e,r)}const bE="m/44'/60'/0'/0/0",wE=new Uint8Array([66,105,116,99,111,105,110,32,115,101,101,100]),vE=2147483648,EE=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141");function AE(e,t){let r="";for(;e;)r="0123456789abcdef"[e%16]+r,e=Math.trunc(e/16);for(;r.length<2*t;)r="0"+r;return"0x"+r}function SE(e){const t=$c(e);return Ny(Qc([t,Xc(Jm(Jm(t)),0,4)]))}const kE={};function RE(e,t,r,n){const i=new Uint8Array(37);e&vE?(Fc(null!=n,"cannot derive child of neutered node","UNSUPPORTED_OPERATION",{operation:"deriveChild"}),i.set($c(n),1)):i.set($c(r));for(let t=24;t>=0;t-=8)i[33+(t>>3)]=e>>24-t&255;const s=$c(Aw("sha512",t,i));return{IL:s.slice(0,32),IR:s.slice(32)}}function PE(e,t){const r=t.split("/");Uc(r.length>0,"invalid path","path",t),"m"===r[0]&&(Uc(0===e.depth,`cannot derive root path (i.e. path starting with "m/") for a node at non-zero depth ${e.depth}`,"path",t),r.shift());let n=e;for(let e=0;e<r.length;e++){const t=r[e];if(t.match(/^[0-9]+'$/)){const r=parseInt(t.substring(0,t.length-1));Uc(r<vE,"invalid path index",`path[${e}]`,t),n=n.deriveChild(vE+r)}else if(t.match(/^[0-9]+$/)){const r=parseInt(t);Uc(r<vE,"invalid path index",`path[${e}]`,t),n=n.deriveChild(r)}else Uc(!1,"invalid path component",`path[${e}]`,t)}return n}class IE extends bw{publicKey;fingerprint;parentFingerprint;mnemonic;chainCode;path;index;depth;constructor(e,t,r,n,i,s,o,a,c){super(t,c),Kc(e,kE,"HDNodeWallet"),Oc(this,{publicKey:t.compressedPublicKey}),Oc(this,{parentFingerprint:r,fingerprint:Xc(jw(Jm(this.publicKey)),0,4),chainCode:n,path:i,index:s,depth:o}),Oc(this,{mnemonic:a})}connect(e){return new IE(kE,this.signingKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,this.mnemonic,e)}#Ct(){const e={address:this.address,privateKey:this.privateKey},t=this.mnemonic;return this.path&&t&&"en"===t.wordlist.locale&&""===t.password&&(e.mnemonic={path:this.path,locale:"en",entropy:t.entropy}),e}async encrypt(e,t){return await yE(this.#Ct(),e,{progressCallback:t})}encryptSync(e){return mE(this.#Ct(),e)}get extendedKey(){return Fc(this.depth<256,"Depth too deep","UNSUPPORTED_OPERATION",{operation:"extendedKey"}),SE(Qc(["0x0488ADE4",AE(this.depth,1),this.parentFingerprint,AE(this.index,4),this.chainCode,Qc(["0x00",this.privateKey])]))}hasPath(){return null!=this.path}neuter(){return new CE(kE,this.address,this.publicKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,this.provider)}deriveChild(e){const t=pu(e,"index");Uc(t<=4294967295,"invalid index","index",t);let r=this.path;r&&(r+="/"+(t&~vE),t&vE&&(r+="'"));const{IR:n,IL:i}=RE(t,this.chainCode,this.publicKey,this.privateKey),s=new Of(mu((fu(i)+BigInt(this.privateKey))%EE,32));return new IE(kE,s,this.fingerprint,Zc(n),r,t,this.depth+1,this.mnemonic,this.provider)}derivePath(e){return PE(this,e)}static#_t(e,t){Uc(Wc(e),"invalid seed","seed","[REDACTED]");const r=$c(e,"seed");Uc(r.length>=16&&r.length<=64,"invalid seed","seed","[REDACTED]");const n=$c(Aw("sha512",wE,r)),i=new Of(Zc(n.slice(0,32)));return new IE(kE,i,"0x00000000",Zc(n.slice(32)),"m",0,0,t,null)}static fromExtendedKey(e){const t=yu(xy(e));Uc(82===t.length||SE(t.slice(0,78))===e,"invalid extended key","extendedKey","[ REDACTED ]");const r=t[4],n=Zc(t.slice(5,9)),i=parseInt(Zc(t.slice(9,13)).substring(2),16),s=Zc(t.slice(13,45)),o=t.slice(45,78);switch(Zc(t.slice(0,4))){case"0x0488b21e":case"0x043587cf":{const e=Zc(o);return new CE(kE,Df(e),e,n,s,null,i,r,null)}case"0x0488ade4":case"0x04358394 ":if(0!==o[0])break;return new IE(kE,new Of(o.slice(1)),n,s,null,i,r,null,null)}Uc(!1,"invalid extended key prefix","extendedKey","[ REDACTED ]")}static createRandom(e,t,r){null==e&&(e=""),null==t&&(t=bE),null==r&&(r=Qw.wordlist());const n=av.fromEntropy(Gw(16),e,r);return IE.#_t(n.computeSeed(),n).derivePath(t)}static fromMnemonic(e,t){return t||(t=bE),IE.#_t(e.computeSeed(),e).derivePath(t)}static fromPhrase(e,t,r,n){null==t&&(t=""),null==r&&(r=bE),null==n&&(n=Qw.wordlist());const i=av.fromPhrase(e,t,n);return IE.#_t(i.computeSeed(),i).derivePath(r)}static fromSeed(e){return IE.#_t(e,null)}}class CE extends Ob{publicKey;fingerprint;parentFingerprint;chainCode;path;index;depth;constructor(e,t,r,n,i,s,o,a,c){super(t,c),Kc(e,kE,"HDNodeVoidWallet"),Oc(this,{publicKey:r}),Oc(this,{publicKey:r,fingerprint:Xc(jw(Jm(r)),0,4),parentFingerprint:n,chainCode:i,path:s,index:o,depth:a})}connect(e){return new CE(kE,this.address,this.publicKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,e)}get extendedKey(){return Fc(this.depth<256,"Depth too deep","UNSUPPORTED_OPERATION",{operation:"extendedKey"}),SE(Qc(["0x0488B21E",AE(this.depth,1),this.parentFingerprint,AE(this.index,4),this.chainCode,this.publicKey]))}hasPath(){return null!=this.path}deriveChild(e){const t=pu(e,"index");Uc(t<=4294967295,"invalid index","index",t);let r=this.path;r&&(r+="/"+(t&~vE),t&vE&&(r+="'"));const{IR:n,IL:i}=RE(t,this.chainCode,this.publicKey,null),s=Of.addPoints(i,this.publicKey,!0),o=Df(s);return new CE(kE,o,s,this.fingerprint,Zc(n),r,t,this.depth+1,this.provider)}derivePath(e){return PE(this,e)}}function _E(e){const t=pu(e,"index");return Uc(t>=0&&t<vE,"invalid account index","index",t),`m/44'/60'/${t}'/0/0`}function TE(e){const t=pu(e,"index");return Uc(t>=0&&t<vE,"invalid account index","index",t),`m/44'/60'/0'/0/${t}`}function NE(e){try{if(JSON.parse(e).encseed)return!0}catch(e){}return!1}function xE(e,t){const r=JSON.parse(e),n=sE(t),i=Ol(oE(r,"ethaddr:string!")),s=nE(oE(r,"encseed:string!"));Uc(s&&s.length%16==0,"invalid encseed","json",e);const o=$c(tv(n,n,2e3,32,"sha256")).slice(0,16),a=s.slice(0,16),c=s.slice(16),u=function(e){if(e.length<16)throw new TypeError("PKCS#7 invalid length");const t=e[e.length-1];if(t>16)throw new TypeError("PKCS#7 padding byte out of range");const r=e.length-t;for(let n=0;n<t;n++)if(e[r+n]!==t)throw new TypeError("PKCS#7 invalid padding byte");return new Uint8Array(e.subarray(0,r))}($c(new Bv(o,a).decrypt(c)));let l="";for(let e=0;e<u.length;e++)l+=String.fromCharCode(u[e]);return{address:i,privateKey:ud(l)}}function OE(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}class DE extends bw{constructor(e,t){"string"!=typeof e||e.startsWith("0x")||(e="0x"+e),super("string"==typeof e?new Of(e):e,t)}connect(e){return new DE(this.signingKey,e)}async encrypt(e,t){const r={address:this.address,privateKey:this.privateKey};return await yE(r,e,{progressCallback:t})}encryptSync(e){return mE({address:this.address,privateKey:this.privateKey},e)}static#Tt(e){if(Uc(e,"invalid JSON wallet","json","[ REDACTED ]"),"mnemonic"in e&&e.mnemonic&&"en"===e.mnemonic.locale){const t=av.fromEntropy(e.mnemonic.entropy),r=IE.fromMnemonic(t,e.mnemonic.path);if(r.address===e.address&&r.privateKey===e.privateKey)return r;console.log("WARNING: JSON mismatch address/privateKey != mnemonic; fallback onto private key")}const t=new DE(e.privateKey);return Uc(t.address===e.address,"address/privateKey mismatch","json","[ REDACTED ]"),t}static async fromEncryptedJson(e,t,r){let n=null;return cE(e)?n=await fE(e,t,r):NE(e)&&(r&&(r(0),await OE(0)),n=xE(e,t),r&&(r(1),await OE(0))),DE.#Tt(n)}static fromEncryptedJsonSync(e,t){let r=null;return cE(e)?r=dE(e,t):NE(e)?r=xE(e,t):Uc(!1,"invalid JSON wallet","json","[ REDACTED ]"),DE.#Tt(r)}static createRandom(e){const t=IE.createRandom();return e?t.connect(e):t}static fromPhrase(e,t){const r=IE.fromPhrase(e);return t?r.connect(t):r}}class ME extends $b{#G;#Nt;constructor(e,t,r){const n=Object.assign({},null!=r?r:{},{batchMaxCount:1});Uc(e&&e.request,"invalid EIP-1193 provider","ethereum",e),super(t,n),this.#Nt=null,r&&r.providerInfo&&(this.#Nt=r.providerInfo),this.#G=async(t,r)=>{const n={method:t,params:r};this.emit("debug",{action:"sendEip1193Request",payload:n});try{const t=await e.request(n);return this.emit("debug",{action:"receiveEip1193Result",result:t}),t}catch(e){const t=new Error(e.message);throw t.code=e.code,t.data=e.data,t.payload=n,this.emit("debug",{action:"receiveEip1193Error",error:t}),t}}}get providerInfo(){return this.#Nt}async send(e,t){return await this._start(),await super.send(e,t)}async _send(e){Uc(!Array.isArray(e),"EIP-1193 does not support batch request","payload",e);try{const t=await this.#G(e.method,e.params||[]);return[{id:e.id,result:t}]}catch(t){return[{id:e.id,error:{code:t.code,data:t.data,message:t.message}}]}}getRpcError(e,t){switch((t=JSON.parse(JSON.stringify(t))).error.code||-1){case 4001:t.error.message=`ethers-user-denied: ${t.error.message}`;break;case 4200:t.error.message=`ethers-unsupported: ${t.error.message}`}return super.getRpcError(e,t)}async hasSigner(e){null==e&&(e=0);const t=await this.send("eth_accounts",[]);return"number"==typeof e?t.length>e:(e=e.toLowerCase(),0!==t.filter(t=>t.toLowerCase()===e).length)}async getSigner(e){if(null==e&&(e=0),!await this.hasSigner(e))try{await this.#G("eth_requestAccounts",[])}catch(e){const t=e.payload;throw this.getRpcError(t,{id:t.id,error:e})}return await super.getSigner(e)}static async discover(e){if(null==e&&(e={}),e.provider)return new ME(e.provider);const t=e.window?e.window:"undefined"!=typeof window?window:null;if(null==t)return null;const r=e.anyProvider;if(r&&t.ethereum)return new ME(t.ethereum);if(!("addEventListener"in t&&"dispatchEvent"in t&&"removeEventListener"in t))return null;const n=e.timeout?e.timeout:300;return 0===n?null:await new Promise((i,s)=>{let o=[];const a=e=>{o.push(e.detail),r&&c()},c=()=>{if(clearTimeout(u),o.length)if(e&&e.filter){const t=e.filter(o.map(e=>Object.assign({},e.info)));if(null==t)i(null);else if(t instanceof ME)i(t);else{let e=null;if(t.uuid){const r=o.filter(e=>t.uuid===e.info.uuid);e=r[0]}if(e){const{provider:t,info:r}=e;i(new ME(t,void 0,{providerInfo:r}))}else s(Lc("filter returned unknown info","UNSUPPORTED_OPERATION",{value:t}))}}else{const{provider:e,info:t}=o[0];i(new ME(e,void 0,{providerInfo:t}))}else i(null);t.removeEventListener("eip6963:announceProvider",a)},u=setTimeout(()=>{c()},n);t.addEventListener("eip6963:announceProvider",a),t.dispatchEvent(new Event("eip6963:requestProvider"))})}}const BE=BigInt(-1),LE=BigInt(0),FE=BigInt(1),UE=BigInt(5),jE={};let zE="0000";for(;zE.length<80;)zE+=zE;function qE(e){let t=zE;for(;t.length<e;)t+=t;return BigInt("1"+t.substring(0,e))}function KE(e,t,r){const n=BigInt(t.width);if(t.signed){const t=FE<<n-FE;Fc(null==r||e>=-t&&e<t,"overflow","NUMERIC_FAULT",{operation:r,fault:"overflow",value:e}),e=e>LE?au(uu(e,n),n):-au(uu(-e,n),n)}else{const t=FE<<n;Fc(null==r||e>=0&&e<t,"overflow","NUMERIC_FAULT",{operation:r,fault:"overflow",value:e}),e=(e%t+t)%t&t-FE}return e}function GE(e){"number"==typeof e&&(e=`fixed128x${e}`);let t=!0,r=128,n=18;if("string"==typeof e)if("fixed"===e);else if("ufixed"===e)t=!1;else{const i=e.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);Uc(i,"invalid fixed format","format",e),t="u"!==i[1],r=parseInt(i[2]),n=parseInt(i[3])}else if(e){const i=e,s=(e,t,r)=>null==i[e]?r:(Uc(typeof i[e]===t,"invalid fixed format ("+e+" not "+t+")","format."+e,i[e]),i[e]);t=s("signed","boolean",t),r=s("width","number",r),n=s("decimals","number",n)}return Uc(r%8==0,"invalid FixedNumber width (not byte aligned)","format.width",r),Uc(n<=80,"invalid FixedNumber decimals (too large)","format.decimals",n),{signed:t,width:r,decimals:n,name:(t?"":"u")+"fixed"+String(r)+"x"+String(n)}}class $E{format;#xt;#Ot;#Dt;_value;constructor(e,t,r){Kc(e,jE,"FixedNumber"),this.#Ot=t,this.#xt=r;const n=function(e,t){let r="";e<LE&&(r="-",e*=BE);let n=e.toString();if(0===t)return r+n;for(;n.length<=t;)n=zE+n;const i=n.length-t;for(n=n.substring(0,i)+"."+n.substring(i);"0"===n[0]&&"."!==n[1];)n=n.substring(1);for(;"0"===n[n.length-1]&&"."!==n[n.length-2];)n=n.substring(0,n.length-1);return r+n}(t,r.decimals);Oc(this,{format:r.name,_value:n}),this.#Dt=qE(r.decimals)}get signed(){return this.#xt.signed}get width(){return this.#xt.width}get decimals(){return this.#xt.decimals}get value(){return this.#Ot}#Mt(e){Uc(this.format===e.format,"incompatible format; use fixedNumber.toFormat","other",e)}#Bt(e,t){return e=KE(e,this.#xt,t),new $E(jE,e,this.#xt)}#Lt(e,t){return this.#Mt(e),this.#Bt(this.#Ot+e.#Ot,t)}addUnsafe(e){return this.#Lt(e)}add(e){return this.#Lt(e,"add")}#Ft(e,t){return this.#Mt(e),this.#Bt(this.#Ot-e.#Ot,t)}subUnsafe(e){return this.#Ft(e)}sub(e){return this.#Ft(e,"sub")}#Ut(e,t){return this.#Mt(e),this.#Bt(this.#Ot*e.#Ot/this.#Dt,t)}mulUnsafe(e){return this.#Ut(e)}mul(e){return this.#Ut(e,"mul")}mulSignal(e){this.#Mt(e);const t=this.#Ot*e.#Ot;return Fc(t%this.#Dt===LE,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),this.#Bt(t/this.#Dt,"mulSignal")}#jt(e,t){return Fc(e.#Ot!==LE,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#Mt(e),this.#Bt(this.#Ot*this.#Dt/e.#Ot,t)}divUnsafe(e){return this.#jt(e)}div(e){return this.#jt(e,"div")}divSignal(e){Fc(e.#Ot!==LE,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#Mt(e);const t=this.#Ot*this.#Dt;return Fc(t%e.#Ot===LE,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),this.#Bt(t/e.#Ot,"divSignal")}cmp(e){let t=this.value,r=e.value;const n=this.decimals-e.decimals;return n>0?r*=qE(n):n<0&&(t*=qE(-n)),t<r?-1:t>r?1:0}eq(e){return 0===this.cmp(e)}lt(e){return this.cmp(e)<0}lte(e){return this.cmp(e)<=0}gt(e){return this.cmp(e)>0}gte(e){return this.cmp(e)>=0}floor(){let e=this.#Ot;return this.#Ot<LE&&(e-=this.#Dt-FE),e=this.#Ot/this.#Dt*this.#Dt,this.#Bt(e,"floor")}ceiling(){let e=this.#Ot;return this.#Ot>LE&&(e+=this.#Dt-FE),e=this.#Ot/this.#Dt*this.#Dt,this.#Bt(e,"ceiling")}round(e){if(null==e&&(e=0),e>=this.decimals)return this;const t=this.decimals-e,r=UE*qE(t-1);let n=this.value+r;const i=qE(t);return n=n/i*i,KE(n,this.#xt,"round"),new $E(jE,n,this.#xt)}isZero(){return this.#Ot===LE}isNegative(){return this.#Ot<LE}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(e){return $E.fromString(this.toString(),e)}static fromValue(e,t,r){const n=null==t?0:pu(t),i=GE(r);let s=lu(e,"value");const o=n-i.decimals;if(o>0){const t=qE(o);Fc(s%t===LE,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:e}),s/=t}else o<0&&(s*=qE(-o));return KE(s,i,"fromValue"),new $E(jE,s,i)}static fromString(e,t){const r=e.match(/^(-?)([0-9]*)\.?([0-9]*)$/);Uc(r&&r[2].length+r[3].length>0,"invalid FixedNumber string value","value",e);const n=GE(t);let i=r[2]||"0",s=r[3]||"";for(;s.length<n.decimals;)s+=zE;Fc(s.substring(n.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:e}),s=s.substring(0,n.decimals);const o=BigInt(r[1]+i+s);return KE(o,n,"fromString"),new $E(jE,o,n)}static fromBytes(e,t){let r=fu($c(e,"value"));const n=GE(t);return n.signed&&(r=au(r,n.width)),KE(r,n,"fromBytes"),new $E(jE,r,n)}}const VE=["wei","kwei","mwei","gwei","szabo","finney","ether"];function HE(e,t){let r=18;if("string"==typeof t){const e=VE.indexOf(t);Uc(e>=0,"invalid unit","unit",t),r=3*e}else null!=t&&(r=pu(t,"unit"));return $E.fromValue(e,r,{decimals:r,width:512}).toString()}function WE(e,t){Uc("string"==typeof e,"value must be a string","value",e);let r=18;if("string"==typeof t){const e=VE.indexOf(t);Uc(e>=0,"invalid unit","unit",t),r=3*e}else null!=t&&(r=pu(t,"unit"));return $E.fromString(e,{decimals:r,width:512}).value}function JE(e){return HE(e,18)}function ZE(e){return WE(e,18)}var QE=r(4062),YE=r(165),XE=r.n(YE),eA=r(8917),tA=r.n(eA),rA=r(9971),nA=r.n(rA);const iA=Symbol.for("protobuf-ts/message-type");function sA(e){let t=!1;const r=[];for(let n=0;n<e.length;n++){let i=e.charAt(n);"_"==i?t=!0:/\d/.test(i)?(r.push(i),t=!0):t?(r.push(i.toUpperCase()),t=!1):0==n?r.push(i.toLowerCase()):r.push(i)}return r.join("")}var oA,aA,cA;function uA(e){var t,r,n,i;return e.localName=null!==(t=e.localName)&&void 0!==t?t:sA(e.name),e.jsonName=null!==(r=e.jsonName)&&void 0!==r?r:sA(e.name),e.repeat=null!==(n=e.repeat)&&void 0!==n?n:cA.NO,e.opt=null!==(i=e.opt)&&void 0!==i?i:!e.repeat&&!e.oneof&&"message"==e.kind,e}function lA(e){if("object"!=typeof e||null===e||!e.hasOwnProperty("oneofKind"))return!1;switch(typeof e.oneofKind){case"string":return void 0!==e[e.oneofKind]&&2==Object.keys(e).length;case"undefined":return 1==Object.keys(e).length;default:return!1}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(oA||(oA={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"}(aA||(aA={})),function(e){e[e.NO=0]="NO",e[e.PACKED=1]="PACKED",e[e.UNPACKED=2]="UNPACKED"}(cA||(cA={}));class dA{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}prepare(){if(this.data)return;const e=[],t=[],r=[];for(let n of this.fields)if(n.oneof)r.includes(n.oneof)||(r.push(n.oneof),e.push(n.oneof),t.push(n.oneof));else switch(t.push(n.localName),n.kind){case"scalar":case"enum":n.opt&&!n.repeat||e.push(n.localName);break;case"message":n.repeat&&e.push(n.localName);break;case"map":e.push(n.localName)}this.data={req:e,known:t,oneofs:Object.values(r)}}is(e,t,r=!1){if(t<0)return!0;if(null==e||"object"!=typeof e)return!1;this.prepare();let n=Object.keys(e),i=this.data;if(n.length<i.req.length||i.req.some(e=>!n.includes(e)))return!1;if(!r&&n.some(e=>!i.known.includes(e)))return!1;if(t<1)return!0;for(const n of i.oneofs){const i=e[n];if(!lA(i))return!1;if(void 0===i.oneofKind)continue;const s=this.fields.find(e=>e.localName===i.oneofKind);if(!s)return!1;if(!this.field(i[i.oneofKind],s,r,t))return!1}for(const n of this.fields)if(void 0===n.oneof&&!this.field(e[n.localName],n,r,t))return!1;return!0}field(e,t,r,n){let i=t.repeat;switch(t.kind){case"scalar":return void 0===e?t.opt:i?this.scalars(e,t.T,n,t.L):this.scalar(e,t.T,t.L);case"enum":return void 0===e?t.opt:i?this.scalars(e,oA.INT32,n):this.scalar(e,oA.INT32);case"message":return void 0===e||(i?this.messages(e,t.T(),r,n):this.message(e,t.T(),r,n));case"map":if("object"!=typeof e||null===e)return!1;if(n<2)return!0;if(!this.mapKeys(e,t.K,n))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,n,t.V.L);case"enum":return this.scalars(Object.values(e),oA.INT32,n);case"message":return this.messages(Object.values(e),t.V.T(),r,n)}}return!0}message(e,t,r,n){return r?t.isAssignable(e,n):t.is(e,n)}messages(e,t,r,n){if(!Array.isArray(e))return!1;if(n<2)return!0;if(r){for(let r=0;r<e.length&&r<n;r++)if(!t.isAssignable(e[r],n-1))return!1}else for(let r=0;r<e.length&&r<n;r++)if(!t.is(e[r],n-1))return!1;return!0}scalar(e,t,r){let n=typeof e;switch(t){case oA.UINT64:case oA.FIXED64:case oA.INT64:case oA.SFIXED64:case oA.SINT64:switch(r){case aA.BIGINT:return"bigint"==n;case aA.NUMBER:return"number"==n&&!isNaN(e);default:return"string"==n}case oA.BOOL:return"boolean"==n;case oA.STRING:return"string"==n;case oA.BYTES:return e instanceof Uint8Array;case oA.DOUBLE:case oA.FLOAT:return"number"==n&&!isNaN(e);default:return"number"==n&&Number.isInteger(e)}}scalars(e,t,r,n){if(!Array.isArray(e))return!1;if(r<2)return!0;if(Array.isArray(e))for(let i=0;i<e.length&&i<r;i++)if(!this.scalar(e[i],t,n))return!1;return!0}mapKeys(e,t,r){let n=Object.keys(e);switch(t){case oA.INT32:case oA.FIXED32:case oA.SFIXED32:case oA.SINT32:case oA.UINT32:return this.scalars(n.slice(0,r).map(e=>parseInt(e)),t,r);case oA.BOOL:return this.scalars(n.slice(0,r).map(e=>"true"==e||"false"!=e&&e),t,r);default:return this.scalars(n,t,r,aA.STRING)}}}function hA(e){let t=typeof e;if("object"==t){if(Array.isArray(e))return"array";if(null===e)return"null"}return t}function fA(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}let pA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),gA=[];for(let e=0;e<pA.length;e++)gA[pA[e].charCodeAt(0)]=e;function mA(){let e=0,t=0;for(let r=0;r<28;r+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<r,!(128&n))return this.assertBounds(),[e,t]}let r=this.buf[this.pos++];if(e|=(15&r)<<28,t=(112&r)>>4,!(128&r))return this.assertBounds(),[e,t];for(let r=3;r<=31;r+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<r,!(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function yA(e,t,r){for(let n=0;n<28;n+=7){const i=e>>>n,s=!(i>>>7==0&&0==t),o=255&(s?128|i:i);if(r.push(o),!s)return}const n=e>>>28&15|(7&t)<<4,i=!!(t>>3);if(r.push(255&(i?128|n:n)),i){for(let e=3;e<31;e+=7){const n=t>>>e,i=!(n>>>7==0),s=255&(i?128|n:n);if(r.push(s),!i)return}r.push(t>>>31&1)}}gA["-".charCodeAt(0)]=pA.indexOf("+"),gA["_".charCodeAt(0)]=pA.indexOf("/");const bA=4294967296;function wA(e){let t="-"==e[0];t&&(e=e.slice(1));const r=1e6;let n=0,i=0;function s(t,s){const o=Number(e.slice(t,s));i*=r,n=n*r+o,n>=bA&&(i+=n/bA|0,n%=bA)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),[t,n,i]}function vA(e,t){if(t>>>0<=2097151)return""+(bA*t+(e>>>0));let r=(e>>>24|t<<8)>>>0&16777215,n=t>>16&65535,i=(16777215&e)+6777216*r+6710656*n,s=r+8147497*n,o=2*n,a=1e7;function c(e,t){let r=e?String(e):"";return t?"0000000".slice(r.length)+r:r}return i>=a&&(s+=Math.floor(i/a),i%=a),s>=a&&(o+=Math.floor(s/a),s%=a),c(o,0)+c(s,o)+c(i,1)}function EA(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let r=0;r<9;r++)t.push(127&e|128),e>>=7;t.push(1)}}function AA(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;128&e&&t<10;t++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}let SA;function kA(e){if(!e)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}!function(){const e=new DataView(new ArrayBuffer(8)),t=void 0!==globalThis.BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64;SA=t?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:e}:void 0}();const RA=/^-?[0-9]+$/,PA=4294967296,IA=2147483648;class CA{constructor(e,t){this.lo=0|e,this.hi=0|t}isZero(){return 0==this.lo&&0==this.hi}toNumber(){let e=this.hi*PA+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class _A extends CA{static from(e){if(SA)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=SA.C(e);case"number":if(0===e)return this.ZERO;e=SA.C(e);case"bigint":if(!e)return this.ZERO;if(e<SA.UMIN)throw new Error("signed value for ulong");if(e>SA.UMAX)throw new Error("ulong too large");return SA.V.setBigUint64(0,e,!0),new _A(SA.V.getInt32(0,!0),SA.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!RA.test(e))throw new Error("string is no integer");let[t,r,n]=wA(e);if(t)throw new Error("signed value for ulong");return new _A(r,n);case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new _A(e,e/PA)}throw new Error("unknown value "+typeof e)}toString(){return SA?this.toBigInt().toString():vA(this.lo,this.hi)}toBigInt(){return kA(SA),SA.V.setInt32(0,this.lo,!0),SA.V.setInt32(4,this.hi,!0),SA.V.getBigUint64(0,!0)}}_A.ZERO=new _A(0,0);class TA extends CA{static from(e){if(SA)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=SA.C(e);case"number":if(0===e)return this.ZERO;e=SA.C(e);case"bigint":if(!e)return this.ZERO;if(e<SA.MIN)throw new Error("signed long too small");if(e>SA.MAX)throw new Error("signed long too large");return SA.V.setBigInt64(0,e,!0),new TA(SA.V.getInt32(0,!0),SA.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!RA.test(e))throw new Error("string is no integer");let[t,r,n]=wA(e);if(t){if(n>IA||n==IA&&0!=r)throw new Error("signed long too small")}else if(n>=IA)throw new Error("signed long too large");let i=new TA(r,n);return t?i.negate():i;case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new TA(e,e/PA):new TA(-e,-e/PA).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return 0!==(this.hi&IA)}negate(){let e=~this.hi,t=this.lo;return t?t=1+~t:e+=1,new TA(t,e)}toString(){if(SA)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+vA(e.lo,e.hi)}return vA(this.lo,this.hi)}toBigInt(){return kA(SA),SA.V.setInt32(0,this.lo,!0),SA.V.setInt32(4,this.hi,!0),SA.V.getBigInt64(0,!0)}}function NA(e,t){if(!e)throw new Error(t)}function xA(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function OA(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function DA(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}function MA(e,t){switch(t){case aA.BIGINT:return e.toBigInt();case aA.NUMBER:return e.toNumber();default:return e.toString()}}TA.ZERO=new TA(0,0);class BA{constructor(e){this.info=e}prepare(){var e;if(void 0===this.fMap){this.fMap={};const t=null!==(e=this.info.fields)&&void 0!==e?e:[];for(const e of t)this.fMap[e.name]=e,this.fMap[e.jsonName]=e,this.fMap[e.localName]=e}}assert(e,t,r){if(!e){let e=hA(r);throw"number"!=e&&"boolean"!=e||(e=r.toString()),new Error(`Cannot parse JSON ${e} for ${this.info.typeName}#${t}`)}}read(e,t,r){this.prepare();const n=[];for(const[i,s]of Object.entries(e)){const e=this.fMap[i];if(!e){if(!r.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${i}`);continue}const o=e.localName;let a;if(e.oneof){if(null===s&&("enum"!==e.kind||"google.protobuf.NullValue"!==e.T()[0]))continue;if(n.includes(e.oneof))throw new Error(`Multiple members of the oneof group "${e.oneof}" of ${this.info.typeName} are present in JSON.`);n.push(e.oneof),a=t[e.oneof]={oneofKind:o}}else a=t;if("map"==e.kind){if(null===s)continue;this.assert(fA(s),e.name,s);const t=a[o];for(const[n,i]of Object.entries(s)){let s;switch(this.assert(null!==i,e.name+" map value",null),e.V.kind){case"message":s=e.V.T().internalJsonRead(i,r);break;case"enum":if(s=this.enum(e.V.T(),i,e.name,r.ignoreUnknownFields),!1===s)continue;break;case"scalar":s=this.scalar(i,e.V.T,e.V.L,e.name)}this.assert(void 0!==s,e.name+" map value",i);let o=n;e.K==oA.BOOL&&(o="true"==o||"false"!=o&&o),o=this.scalar(o,e.K,aA.STRING,e.name).toString(),t[o]=s}}else if(e.repeat){if(null===s)continue;this.assert(Array.isArray(s),e.name,s);const t=a[o];for(const n of s){let i;switch(this.assert(null!==n,e.name,null),e.kind){case"message":i=e.T().internalJsonRead(n,r);break;case"enum":if(i=this.enum(e.T(),n,e.name,r.ignoreUnknownFields),!1===i)continue;break;case"scalar":i=this.scalar(n,e.T,e.L,e.name)}this.assert(void 0!==i,e.name,s),t.push(i)}}else switch(e.kind){case"message":if(null===s&&"google.protobuf.Value"!=e.T().typeName){this.assert(void 0===e.oneof,e.name+" (oneof member)",null);continue}a[o]=e.T().internalJsonRead(s,r,a[o]);break;case"enum":if(null===s)continue;let t=this.enum(e.T(),s,e.name,r.ignoreUnknownFields);if(!1===t)continue;a[o]=t;break;case"scalar":if(null===s)continue;a[o]=this.scalar(s,e.T,e.L,e.name)}}}enum(e,t,r,n){if("google.protobuf.NullValue"==e[0]&&NA(null===t||"NULL_VALUE"===t,`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} only accepts null.`),null===t)return 0;switch(typeof t){case"number":return NA(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${r}, enum can only be integral number, got ${t}.`),t;case"string":let i=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(i=t.substring(e[2].length));let s=e[1][i];return(void 0!==s||!n)&&(NA("number"==typeof s,`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} has no value for "${t}".`),s)}NA(!1,`Unable to parse field ${this.info.typeName}#${r}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,r,n){let i;try{switch(t){case oA.DOUBLE:case oA.FLOAT:if(null===e)return 0;if("NaN"===e)return Number.NaN;if("Infinity"===e)return Number.POSITIVE_INFINITY;if("-Infinity"===e)return Number.NEGATIVE_INFINITY;if(""===e){i="empty string";break}if("string"==typeof e&&e.trim().length!==e.length){i="extra whitespace";break}if("string"!=typeof e&&"number"!=typeof e)break;let n=Number(e);if(Number.isNaN(n)){i="not a number";break}if(!Number.isFinite(n)){i="too large or small";break}return t==oA.FLOAT&&DA(n),n;case oA.INT32:case oA.FIXED32:case oA.SFIXED32:case oA.SINT32:case oA.UINT32:if(null===e)return 0;let s;if("number"==typeof e?s=e:""===e?i="empty string":"string"==typeof e&&(e.trim().length!==e.length?i="extra whitespace":s=Number(e)),void 0===s)break;return t==oA.UINT32?OA(s):xA(s),s;case oA.INT64:case oA.SFIXED64:case oA.SINT64:if(null===e)return MA(TA.ZERO,r);if("number"!=typeof e&&"string"!=typeof e)break;return MA(TA.from(e),r);case oA.FIXED64:case oA.UINT64:if(null===e)return MA(_A.ZERO,r);if("number"!=typeof e&&"string"!=typeof e)break;return MA(_A.from(e),r);case oA.BOOL:if(null===e)return!1;if("boolean"!=typeof e)break;return e;case oA.STRING:if(null===e)return"";if("string"!=typeof e){i="extra whitespace";break}try{encodeURIComponent(e)}catch(i){i="invalid UTF8";break}return e;case oA.BYTES:if(null===e||""===e)return new Uint8Array(0);if("string"!=typeof e)break;return function(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let r,n=new Uint8Array(t),i=0,s=0,o=0;for(let t=0;t<e.length;t++){if(r=gA[e.charCodeAt(t)],void 0===r)switch(e[t]){case"=":s=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=r,s=1;break;case 1:n[i++]=o<<2|(48&r)>>4,o=r,s=2;break;case 2:n[i++]=(15&o)<<4|(60&r)>>2,o=r,s=3;break;case 3:n[i++]=(3&o)<<6|r,s=0}}if(1==s)throw Error("invalid base64 string.");return n.subarray(0,i)}(e)}}catch(e){i=e.message}this.assert(!1,n+(i?" - "+i:""),e)}}class LA{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}write(e,t){const r={},n=e;for(const e of this.fields){if(!e.oneof){let i=this.field(e,n[e.localName],t);void 0!==i&&(r[t.useProtoFieldName?e.name:e.jsonName]=i);continue}const i=n[e.oneof];if(i.oneofKind!==e.localName)continue;const s="scalar"==e.kind||"enum"==e.kind?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t;let o=this.field(e,i[e.localName],s);NA(void 0!==o),r[t.useProtoFieldName?e.name:e.jsonName]=o}return r}field(e,t,r){let n;if("map"==e.kind){NA("object"==typeof t&&null!==t);const i={};switch(e.V.kind){case"scalar":for(const[r,n]of Object.entries(t)){const t=this.scalar(e.V.T,n,e.name,!1,!0);NA(void 0!==t),i[r.toString()]=t}break;case"message":const n=e.V.T();for(const[s,o]of Object.entries(t)){const t=this.message(n,o,e.name,r);NA(void 0!==t),i[s.toString()]=t}break;case"enum":const s=e.V.T();for(const[n,o]of Object.entries(t)){NA(void 0===o||"number"==typeof o);const t=this.enum(s,o,e.name,!1,!0,r.enumAsInteger);NA(void 0!==t),i[n.toString()]=t}}(r.emitDefaultValues||Object.keys(i).length>0)&&(n=i)}else if(e.repeat){NA(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let r=0;r<t.length;r++){const n=this.scalar(e.T,t[r],e.name,e.opt,!0);NA(void 0!==n),i.push(n)}break;case"enum":const n=e.T();for(let s=0;s<t.length;s++){NA(void 0===t[s]||"number"==typeof t[s]);const o=this.enum(n,t[s],e.name,e.opt,!0,r.enumAsInteger);NA(void 0!==o),i.push(o)}break;case"message":const s=e.T();for(let n=0;n<t.length;n++){const o=this.message(s,t[n],e.name,r);NA(void 0!==o),i.push(o)}}(r.emitDefaultValues||i.length>0||r.emitDefaultValues)&&(n=i)}else switch(e.kind){case"scalar":n=this.scalar(e.T,t,e.name,e.opt,r.emitDefaultValues);break;case"enum":n=this.enum(e.T(),t,e.name,e.opt,r.emitDefaultValues,r.enumAsInteger);break;case"message":n=this.message(e.T(),t,e.name,r)}return n}enum(e,t,r,n,i,s){if("google.protobuf.NullValue"==e[0])return i||n?null:void 0;if(void 0!==t){if(0!==t||i||n)return NA("number"==typeof t),NA(Number.isInteger(t)),s||!e[1].hasOwnProperty(t)?t:e[2]?e[2]+e[1][t]:e[1][t]}else NA(n)}message(e,t,r,n){return void 0===t?n.emitDefaultValues?null:void 0:e.internalJsonWrite(t,n)}scalar(e,t,r,n,i){if(void 0===t)return void NA(n);const s=i||n;switch(e){case oA.INT32:case oA.SFIXED32:case oA.SINT32:return 0===t?s?0:void 0:(xA(t),t);case oA.FIXED32:case oA.UINT32:return 0===t?s?0:void 0:(OA(t),t);case oA.FLOAT:DA(t);case oA.DOUBLE:return 0===t?s?0:void 0:(NA("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t);case oA.STRING:return""===t?s?"":void 0:(NA("string"==typeof t),t);case oA.BOOL:return!1===t?!s&&void 0:(NA("boolean"==typeof t),t);case oA.UINT64:case oA.FIXED64:NA("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let e=_A.from(t);if(e.isZero()&&!s)return;return e.toString();case oA.INT64:case oA.SFIXED64:case oA.SINT64:NA("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let r=TA.from(t);if(r.isZero()&&!s)return;return r.toString();case oA.BYTES:return NA(t instanceof Uint8Array),t.byteLength?function(e){let t,r="",n=0,i=0;for(let s=0;s<e.length;s++)switch(t=e[s],n){case 0:r+=pA[t>>2],i=(3&t)<<4,n=1;break;case 1:r+=pA[i|t>>4],i=(15&t)<<2,n=2;break;case 2:r+=pA[i|t>>6],r+=pA[63&t],n=0}return n&&(r+=pA[i],r+="=",1==n&&(r+="=")),r}(t):s?"":void 0}}}var FA,UA;function jA(e,t){return Object.assign(Object.assign({},e),t)}function zA(e,t=aA.STRING){switch(e){case oA.BOOL:return!1;case oA.UINT64:case oA.FIXED64:return MA(_A.ZERO,t);case oA.INT64:case oA.SFIXED64:case oA.SINT64:return MA(TA.ZERO,t);case oA.DOUBLE:case oA.FLOAT:return 0;case oA.BYTES:return new Uint8Array(0);case oA.STRING:return"";default:return 0}}!function(e){e.symbol=Symbol.for("protobuf-ts/unknown"),e.onRead=(r,n,i,s,o)=>{(t(n)?n[e.symbol]:n[e.symbol]=[]).push({no:i,wireType:s,data:o})},e.onWrite=(t,r,n)=>{for(let{no:t,wireType:i,data:s}of e.list(r))n.tag(t,i).raw(s)},e.list=(r,n)=>{if(t(r)){let t=r[e.symbol];return n?t.filter(e=>e.no==n):t}return[]},e.last=(t,r)=>e.list(t,r).slice(-1)[0];const t=t=>t&&Array.isArray(t[e.symbol])}(FA||(FA={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(UA||(UA={}));class qA{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const t=null!==(e=this.info.fields)&&void 0!==e?e:[];this.fieldNoToField=new Map(t.map(e=>[e.no,e]))}}read(e,t,r,n){this.prepare();const i=void 0===n?e.len:e.pos+n;for(;e.pos<i;){const[n,i]=e.tag(),s=this.fieldNoToField.get(n);if(!s){let s=r.readUnknownField;if("throw"==s)throw new Error(`Unknown field ${n} (wire type ${i}) for ${this.info.typeName}`);let o=e.skip(i);!1!==s&&(!0===s?FA.onRead:s)(this.info.typeName,t,n,i,o);continue}let o=t,a=s.repeat,c=s.localName;switch(s.oneof&&(o=o[s.oneof],o.oneofKind!==c&&(o=t[s.oneof]={oneofKind:c})),s.kind){case"scalar":case"enum":let t="enum"==s.kind?oA.INT32:s.T,n="scalar"==s.kind?s.L:void 0;if(a){let r=o[c];if(i==UA.LengthDelimited&&t!=oA.STRING&&t!=oA.BYTES){let i=e.uint32()+e.pos;for(;e.pos<i;)r.push(this.scalar(e,t,n))}else r.push(this.scalar(e,t,n))}else o[c]=this.scalar(e,t,n);break;case"message":if(a){let t=o[c],n=s.T().internalBinaryRead(e,e.uint32(),r);t.push(n)}else o[c]=s.T().internalBinaryRead(e,e.uint32(),r,o[c]);break;case"map":let[u,l]=this.mapEntry(s,e,r);o[c][u]=l}}}mapEntry(e,t,r){let n,i,s=t.uint32(),o=t.pos+s;for(;t.pos<o;){let[s,o]=t.tag();switch(s){case 1:n=e.K==oA.BOOL?t.bool().toString():this.scalar(t,e.K,aA.STRING);break;case 2:switch(e.V.kind){case"scalar":i=this.scalar(t,e.V.T,e.V.L);break;case"enum":i=t.int32();break;case"message":i=e.V.T().internalBinaryRead(t,t.uint32(),r)}break;default:throw new Error(`Unknown field ${s} (wire type ${o}) in map entry for ${this.info.typeName}#${e.name}`)}}if(void 0===n){let t=zA(e.K);n=e.K==oA.BOOL?t.toString():t}if(void 0===i)switch(e.V.kind){case"scalar":i=zA(e.V.T,e.V.L);break;case"enum":i=0;break;case"message":i=e.V.T().create()}return[n,i]}scalar(e,t,r){switch(t){case oA.INT32:return e.int32();case oA.STRING:return e.string();case oA.BOOL:return e.bool();case oA.DOUBLE:return e.double();case oA.FLOAT:return e.float();case oA.INT64:return MA(e.int64(),r);case oA.UINT64:return MA(e.uint64(),r);case oA.FIXED64:return MA(e.fixed64(),r);case oA.FIXED32:return e.fixed32();case oA.BYTES:return e.bytes();case oA.UINT32:return e.uint32();case oA.SFIXED32:return e.sfixed32();case oA.SFIXED64:return MA(e.sfixed64(),r);case oA.SINT32:return e.sint32();case oA.SINT64:return MA(e.sint64(),r)}}}class KA{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort((e,t)=>e.no-t.no)}}write(e,t,r){this.prepare();for(const n of this.fields){let i,s,o=n.repeat,a=n.localName;if(n.oneof){const t=e[n.oneof];if(t.oneofKind!==a)continue;i=t[a],s=!0}else i=e[a],s=!1;switch(n.kind){case"scalar":case"enum":let e="enum"==n.kind?oA.INT32:n.T;if(o)if(NA(Array.isArray(i)),o==cA.PACKED)this.packed(t,e,n.no,i);else for(const r of i)this.scalar(t,e,n.no,r,!0);else void 0===i?NA(n.opt):this.scalar(t,e,n.no,i,s||n.opt);break;case"message":if(o){NA(Array.isArray(i));for(const e of i)this.message(t,r,n.T(),n.no,e)}else this.message(t,r,n.T(),n.no,i);break;case"map":NA("object"==typeof i&&null!==i);for(const[e,s]of Object.entries(i))this.mapEntry(t,r,n,e,s)}}let n=r.writeUnknownFields;!1!==n&&(!0===n?FA.onWrite:n)(this.info.typeName,e,t)}mapEntry(e,t,r,n,i){e.tag(r.no,UA.LengthDelimited),e.fork();let s=n;switch(r.K){case oA.INT32:case oA.FIXED32:case oA.UINT32:case oA.SFIXED32:case oA.SINT32:s=Number.parseInt(n);break;case oA.BOOL:NA("true"==n||"false"==n),s="true"==n}switch(this.scalar(e,r.K,1,s,!0),r.V.kind){case"scalar":this.scalar(e,r.V.T,2,i,!0);break;case"enum":this.scalar(e,oA.INT32,2,i,!0);break;case"message":this.message(e,t,r.V.T(),2,i)}e.join()}message(e,t,r,n,i){void 0!==i&&(r.internalBinaryWrite(i,e.tag(n,UA.LengthDelimited).fork(),t),e.join())}scalar(e,t,r,n,i){let[s,o,a]=this.scalarInfo(t,n);a&&!i||(e.tag(r,s),e[o](n))}packed(e,t,r,n){if(!n.length)return;NA(t!==oA.BYTES&&t!==oA.STRING),e.tag(r,UA.LengthDelimited),e.fork();let[,i]=this.scalarInfo(t);for(let t=0;t<n.length;t++)e[i](n[t]);e.join()}scalarInfo(e,t){let r,n=UA.Varint,i=void 0===t,s=0===t;switch(e){case oA.INT32:r="int32";break;case oA.STRING:s=i||!t.length,n=UA.LengthDelimited,r="string";break;case oA.BOOL:s=!1===t,r="bool";break;case oA.UINT32:r="uint32";break;case oA.DOUBLE:n=UA.Bit64,r="double";break;case oA.FLOAT:n=UA.Bit32,r="float";break;case oA.INT64:s=i||TA.from(t).isZero(),r="int64";break;case oA.UINT64:s=i||_A.from(t).isZero(),r="uint64";break;case oA.FIXED64:s=i||_A.from(t).isZero(),n=UA.Bit64,r="fixed64";break;case oA.BYTES:s=i||!t.byteLength,n=UA.LengthDelimited,r="bytes";break;case oA.FIXED32:n=UA.Bit32,r="fixed32";break;case oA.SFIXED32:n=UA.Bit32,r="sfixed32";break;case oA.SFIXED64:s=i||TA.from(t).isZero(),n=UA.Bit64,r="sfixed64";break;case oA.SINT32:r="sint32";break;case oA.SINT64:s=i||TA.from(t).isZero(),r="sint64"}return[n,r,i||s]}}function GA(e,t,r){let n,i,s=r;for(let r of e.fields){let e=r.localName;if(r.oneof){const o=s[r.oneof];if(null==(null==o?void 0:o.oneofKind))continue;if(n=o[e],i=t[r.oneof],i.oneofKind=o.oneofKind,null==n){delete i[e];continue}}else if(n=s[e],i=t,null==n)continue;switch(r.repeat&&(i[e].length=n.length),r.kind){case"scalar":case"enum":if(r.repeat)for(let t=0;t<n.length;t++)i[e][t]=n[t];else i[e]=n;break;case"message":let t=r.T();if(r.repeat)for(let r=0;r<n.length;r++)i[e][r]=t.create(n[r]);else void 0===i[e]?i[e]=t.create(n):t.mergePartial(i[e],n);break;case"map":switch(r.V.kind){case"scalar":case"enum":Object.assign(i[e],n);break;case"message":let t=r.V.T();for(let r of Object.keys(n))i[e][r]=t.create(n[r])}}}}const $A={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},VA={ignoreUnknownFields:!1};function HA(e){return e?Object.assign(Object.assign({},$A),e):$A}function WA(e,t){var r,n;let i=Object.assign(Object.assign({},e),t);return i.typeRegistry=[...null!==(r=null==e?void 0:e.typeRegistry)&&void 0!==r?r:[],...null!==(n=null==t?void 0:t.typeRegistry)&&void 0!==n?n:[]],i}const JA=Object.values;function ZA(e,t,r){if(t===r)return!0;if(e!==oA.BYTES)return!1;let n=t,i=r;if(n.length!==i.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!=i[e])return!1;return!0}function QA(e,t,r){if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!ZA(e,t[n],r[n]))return!1;return!0}function YA(e,t,r){if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!e.equals(t[n],r[n]))return!1;return!0}const XA={writeUnknownFields:!0,writerFactory:()=>new eS};class eS{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),r=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],r),r+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(OA(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return xA(e),EA(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){DA(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){OA(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){xA(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return xA(e),EA(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),n=TA.from(e);return r.setInt32(0,n.lo,!0),r.setInt32(4,n.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),n=_A.from(e);return r.setInt32(0,n.lo,!0),r.setInt32(4,n.hi,!0),this.raw(t)}int64(e){let t=TA.from(e);return yA(t.lo,t.hi,this.buf),this}sint64(e){let t=TA.from(e),r=t.hi>>31;return yA(t.lo<<1^r,(t.hi<<1|t.lo>>>31)^r,this.buf),this}uint64(e){let t=_A.from(e);return yA(t.lo,t.hi,this.buf),this}}const tS={readUnknownField:!0,readerFactory:e=>new rS(e)};class rS{constructor(e,t){this.varint64=mA,this.uint32=AA,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,r=7&e;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e){let t=this.pos;switch(e){case UA.Varint:for(;128&this.buf[this.pos++];);break;case UA.Bit64:this.pos+=4;case UA.Bit32:this.pos+=4;break;case UA.LengthDelimited:let t=this.uint32();this.pos+=t;break;case UA.StartGroup:let r;for(;(r=this.tag()[1])!==UA.EndGroup;)this.skip(r);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return new TA(...this.varint64())}uint64(){return new _A(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(1&e);return e=(e>>>1|(1&t)<<31)^r,t=t>>>1^r,new TA(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new _A(this.sfixed32(),this.sfixed32())}sfixed64(){return new TA(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}const nS=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({})),iS=nS[iA]={};class sS{constructor(e,t,r){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map(uA),this.options=null!=r?r:{},iS.value=this,this.messagePrototype=Object.create(null,nS),this.refTypeCheck=new dA(this),this.refJsonReader=new BA(this),this.refJsonWriter=new LA(this),this.refBinReader=new qA(this),this.refBinWriter=new KA(this)}create(e){let t=function(e){const t=e.messagePrototype?Object.create(e.messagePrototype):Object.defineProperty({},iA,{value:e});for(let r of e.fields){let e=r.localName;if(!r.opt)if(r.oneof)t[r.oneof]={oneofKind:void 0};else if(r.repeat)t[e]=[];else switch(r.kind){case"scalar":t[e]=zA(r.T,r.L);break;case"enum":t[e]=0;break;case"map":t[e]={}}}return t}(this);return void 0!==e&&GA(this,t,e),t}clone(e){let t=this.create();return GA(this,t,e),t}equals(e,t){return function(e,t,r){if(t===r)return!0;if(!t||!r)return!1;for(let n of e.fields){let e=n.localName,i=n.oneof?t[n.oneof][e]:t[e],s=n.oneof?r[n.oneof][e]:r[e];switch(n.kind){case"enum":case"scalar":let e="enum"==n.kind?oA.INT32:n.T;if(!(n.repeat?QA(e,i,s):ZA(e,i,s)))return!1;break;case"map":if(!("message"==n.V.kind?YA(n.V.T(),JA(i),JA(s)):QA("enum"==n.V.kind?oA.INT32:n.V.T,JA(i),JA(s))))return!1;break;case"message":let t=n.T();if(!(n.repeat?YA(t,i,s):t.equals(i,s)))return!1}}return!0}(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){GA(this,e,t)}fromBinary(e,t){let r=function(e){return e?Object.assign(Object.assign({},tS),e):tS}(t);return this.internalBinaryRead(r.readerFactory(e),e.byteLength,r)}fromJson(e,t){return this.internalJsonRead(e,function(e){return e?Object.assign(Object.assign({},VA),e):VA}(t))}fromJsonString(e,t){let r=JSON.parse(e);return this.fromJson(r,t)}toJson(e,t){return this.internalJsonWrite(e,HA(t))}toJsonString(e,t){var r;let n=this.toJson(e,t);return JSON.stringify(n,null,null!==(r=null==t?void 0:t.prettySpaces)&&void 0!==r?r:0)}toBinary(e,t){let r=function(e){return e?Object.assign(Object.assign({},XA),e):XA}(t);return this.internalBinaryWrite(e,r.writerFactory(),r).finish()}internalJsonRead(e,t,r){if(null!==e&&"object"==typeof e&&!Array.isArray(e)){let n=null!=r?r:this.create();return this.refJsonReader.read(e,n,t),n}throw new Error(`Unable to parse message ${this.typeName} from JSON ${hA(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,r){return this.refBinWriter.write(e,t,r),t}internalBinaryRead(e,t,r,n){let i=null!=n?n:this.create();return this.refBinReader.read(e,i,r,t),i}}class oS{constructor(e,t,r){this.typeName=e,this.methods=t.map(e=>function(e,t){var r,n,i;let s=e;return s.service=t,s.localName=null!==(r=s.localName)&&void 0!==r?r:sA(s.name),s.serverStreaming=!!s.serverStreaming,s.clientStreaming=!!s.clientStreaming,s.options=null!==(n=s.options)&&void 0!==n?n:{},s.idempotency=null!==(i=s.idempotency)&&void 0!==i?i:void 0,s}(e,this)),this.options=null!=r?r:{}}}function aS(e,t,r,n,i){var s,o,a,c;if("unary"==e){let e=(e,r,n)=>t.unary(e,r,n);for(const t of(null!==(s=n.interceptors)&&void 0!==s?s:[]).filter(e=>e.interceptUnary).reverse()){const r=e;e=(e,n,i)=>t.interceptUnary(r,e,n,i)}return e(r,i,n)}if("serverStreaming"==e){let e=(e,r,n)=>t.serverStreaming(e,r,n);for(const t of(null!==(o=n.interceptors)&&void 0!==o?o:[]).filter(e=>e.interceptServerStreaming).reverse()){const r=e;e=(e,n,i)=>t.interceptServerStreaming(r,e,n,i)}return e(r,i,n)}if("clientStreaming"==e){let e=(e,r)=>t.clientStreaming(e,r);for(const t of(null!==(a=n.interceptors)&&void 0!==a?a:[]).filter(e=>e.interceptClientStreaming).reverse()){const r=e;e=(e,n)=>t.interceptClientStreaming(r,e,n)}return e(r,n)}if("duplex"==e){let e=(e,r)=>t.duplex(e,r);for(const t of(null!==(c=n.interceptors)&&void 0!==c?c:[]).filter(e=>e.interceptDuplex).reverse()){const r=e;e=(e,n)=>t.interceptDuplex(r,e,n)}return e(r,n)}!function(e){throw new Error("Unexpected object: "+e)}(e)}const cS={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let uS;const lS=new Uint8Array(16),dS=[];for(let e=0;e<256;++e)dS.push((e+256).toString(16).slice(1));const hS=function(e,t,r){if(cS.randomUUID&&!t&&!e)return cS.randomUUID();const n=(e=e||{}).random??e.rng?.()??function(){if(!uS){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");uS=crypto.getRandomValues.bind(crypto)}return uS(lS)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((r=r||0)<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return(dS[e[t+0]]+dS[e[t+1]]+dS[e[t+2]]+dS[e[t+3]]+"-"+dS[e[t+4]]+dS[e[t+5]]+"-"+dS[e[t+6]]+dS[e[t+7]]+"-"+dS[e[t+8]]+dS[e[t+9]]+"-"+dS[e[t+10]]+dS[e[t+11]]+dS[e[t+12]]+dS[e[t+13]]+dS[e[t+14]]+dS[e[t+15]]).toLowerCase()}(n)};function fS(e,t){if(!e)return;let r=t;for(let[t,n]of Object.entries(e))n instanceof Date?r[t]=new Date(n.getTime()):Array.isArray(n)?r[t]=n.concat():r[t]=n}var pS;!function(e){e[e.PENDING=0]="PENDING",e[e.REJECTED=1]="REJECTED",e[e.RESOLVED=2]="RESOLVED"}(pS||(pS={}));class gS{constructor(e=!0){this._state=pS.PENDING,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t}),e&&this._promise.catch(e=>{})}get state(){return this._state}get promise(){return this._promise}resolve(e){if(this.state!==pS.PENDING)throw new Error(`cannot resolve ${pS[this.state].toLowerCase()}`);this._resolve(e),this._state=pS.RESOLVED}reject(e){if(this.state!==pS.PENDING)throw new Error(`cannot reject ${pS[this.state].toLowerCase()}`);this._reject(e),this._state=pS.REJECTED}resolvePending(e){this._state===pS.PENDING&&this.resolve(e)}rejectPending(e){this._state===pS.PENDING&&this.reject(e)}}var mS;class yS{constructor(e,t,r,n,i,s,o){this.method=e,this.requestHeaders=t,this.request=r,this.headers=n,this.response=i,this.status=s,this.trailers=o}then(e,t){return this.promiseFinished().then(t=>e?Promise.resolve(e(t)):t,e=>t?Promise.resolve(t(e)):Promise.reject(e))}promiseFinished(){return e=this,t=void 0,n=function*(){let[e,t,r,n]=yield Promise.all([this.headers,this.response,this.status,this.trailers]);return{method:this.method,requestHeaders:this.requestHeaders,request:this.request,headers:e,response:t,status:r,trailers:n}},new((r=void 0)||(r=Promise))(function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((n=n.apply(e,t||[])).next())});var e,t,r,n}}class bS extends Error{constructor(e,t="UNKNOWN",r){super(e),this.name="RpcError",Object.setPrototypeOf(this,new.target.prototype),this.code=t,this.meta=null!=r?r:{}}toString(){const e=[this.name+": "+this.message];this.code&&(e.push(""),e.push("Code: "+this.code)),this.serviceName&&this.methodName&&e.push("Method: "+this.serviceName+"/"+this.methodName);let t=Object.entries(this.meta);if(t.length){e.push(""),e.push("Meta:");for(let[r,n]of t)e.push(`  ${r}: ${n}`)}return e.join("\n")}}!function(e){e.RPC_TIMEOUT="RPC_TIMEOUT",e.RPC_REQUEST="RPC_REQUEST",e.RPC_SERVER_ERROR="RPC_SERVER_ERROR",e.RPC_CLIENT_ERROR="RPC_CLIENT_ERROR",e.NOT_IMPLEMENTED="NOT_IMPLEMENTED",e.UNKNOWN_RPC_METHOD="UNKNOWN_RPC_METHOD",e.FAILED_TO_PARSE="FAILED_TO_PARSE",e.FAILED_TO_SERIALIZE="FAILED_TO_SERIALIZE",e.DISCONNECTED="DISCONNECTED"}(mS||(mS={}));class wS extends Error{code;originalError;constructor(e,t,r){super(t),this.code=e,this.originalError=r}}class vS extends wS{constructor(e,t){super(mS.RPC_TIMEOUT,e,t)}}class ES extends wS{constructor(e,t){super(mS.RPC_REQUEST,e,t)}}class AS extends wS{errorClassName;errorCode;constructor(e,t,r){super(mS.RPC_SERVER_ERROR,e),this.errorClassName=t,this.errorCode=r}}class SS extends wS{constructor(e,t){super(mS.NOT_IMPLEMENTED,e,t)}}let kS=class extends wS{constructor(e,t){super(mS.UNKNOWN_RPC_METHOD,e,t)}};class RS extends wS{constructor(e,t){super(mS.FAILED_TO_PARSE,e,t)}}var PS=Object.freeze({__proto__:null,Disconnected:class extends wS{constructor(e,t){super(mS.DISCONNECTED,e,t)}},get ErrorCode(){return mS},FailedToParse:RS,FailedToSerialize:class extends wS{constructor(e,t){super(mS.FAILED_TO_SERIALIZE,e,t)}},NotImplemented:SS,RpcClientError:class extends wS{constructor(e,t){super(mS.RPC_CLIENT_ERROR,e,t)}},RpcRequest:ES,RpcServerError:AS,RpcTimeout:vS,UnknownRpcMethod:kS});const IS=new class extends sS{constructor(){super("google.protobuf.Any",[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}])}pack(e,t){return{typeUrl:this.typeNameToUrl(t.typeName),value:t.toBinary(e)}}unpack(e,t,r){if(!this.contains(e,t))throw new Error("Cannot unpack google.protobuf.Any with typeUrl '"+e.typeUrl+"' as "+t.typeName+".");return t.fromBinary(e.value,r)}contains(e,t){return!!e.typeUrl.length&&("string"==typeof t?t:t.typeName)===this.typeUrlToName(e.typeUrl)}internalJsonWrite(e,t){if(""===e.typeUrl)return{};let r=this.typeUrlToName(e.typeUrl),n=HA(t),i=n.typeRegistry?.find(e=>e.typeName===r);if(!i)throw new globalThis.Error("Unable to convert google.protobuf.Any with typeUrl '"+e.typeUrl+"' to JSON. The specified type "+r+" is not available in the type registry.");let s=i.fromBinary(e.value,{readUnknownField:!1}),o=i.internalJsonWrite(s,n);return!r.startsWith("google.protobuf.")&&fA(o)||(o={value:o}),o["@type"]=e.typeUrl,o}internalJsonRead(e,t,r){if(!fA(e))throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON "+hA(e)+".");if("string"!=typeof e["@type"]||""==e["@type"])return this.create();let n,i=this.typeUrlToName(e["@type"]),s=t?.typeRegistry?.find(e=>e.typeName==i);if(!s)throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON. The specified type "+i+" is not available in the type registry.");if(i.startsWith("google.protobuf.")&&e.hasOwnProperty("value"))n=s.fromJson(e.value,t);else{let r=Object.assign({},e);delete r["@type"],n=s.fromJson(r,t)}return void 0===r&&(r=this.create()),r.typeUrl=e["@type"],r.value=s.toBinary(n),r}typeNameToUrl(e){if(!e.length)throw new Error("invalid type name: "+e);return"type.googleapis.com/"+e}typeUrlToName(e){if(!e.length)throw new Error("invalid type url: "+e);let t=e.lastIndexOf("/"),r=t>0?e.substring(t+1):e;if(!r.length)throw new Error("invalid type url: "+e);return r}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.typeUrl="",t.value=new Uint8Array(0),void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();switch(t){case 1:i.typeUrl=e.string();break;case 2:i.value=e.bytes();break;default:let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){""!==e.typeUrl&&t.tag(1,UA.LengthDelimited).string(e.typeUrl),e.value.length&&t.tag(2,UA.LengthDelimited).bytes(e.value);let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}},CS=new Ta("ClientTransport");class _S extends zr{static objectCount=0;objectId;defaultOptions;constructor(e=5e3){super(),this.objectId=_S.objectCount++,this.defaultOptions={timeout:e,clientId:this.objectId}}mergeOptions(e){return function(e,t){if(!t)return e;let r={};fS(e,r),fS(t,r);for(let n of Object.keys(t)){let i=t[n];switch(n){case"jsonOptions":r.jsonOptions=WA(e.jsonOptions,r.jsonOptions);break;case"binaryOptions":r.binaryOptions=jA(e.binaryOptions,r.binaryOptions);break;case"meta":r.meta={},fS(e.meta,r.meta),fS(t.meta,r.meta);break;case"interceptors":r.interceptors=e.interceptors?e.interceptors.concat(i):i.concat()}}return r}(this.defaultOptions,e)}static createRequestHeaders(e,t){return{method:e.localName,request:"request",notification:t?"notification":void 0}}unary(e,t,r){if(!r?.isProtoRpc)throw new Error("ProtoRpc ClientTransport can only be used with ProtoRpcClients. Please convert your protobuf-ts generated client to a ProtoRpcClient by calling toProtoRpcclient(yourClient).");const n=IS.pack(t,e.I),i={header:_S.createRequestHeaders(e,r.notification),body:n,requestId:hS()},s=new gS,o=new gS,a=new gS,c=new gS,u=new yS(e,{},t,s.promise,o.promise,a.promise,c.promise),l={message:o,header:s,trailer:c,status:a,messageParser:t=>e.O.fromBinary(t)};return CS.trace(`New rpc ${r.notification?"notification":"request"}, ${i.requestId}`),this.emit("rpcRequest",i,r,l),u}clientStreaming(e){const t=new bS("Client streaming is not supported by DhtTransport");throw t.methodName=e.name,t.serviceName=e.service.typeName,t}duplex(e){const t=new bS("Duplex streaming is not supported by DhtTransport");throw t.methodName=e.name,t.serviceName=e.service.typeName,t}serverStreaming(e){const t=new bS("Server streaming is not supported by DhtTransport");throw t.methodName=e.name,t.serviceName=e.service.typeName,t}stop(){this.removeAllListeners()}}const TS=new class extends sS{constructor(){super("google.protobuf.Empty",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();{let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}};var NS;!function(e){e[e.SERVER_TIMEOUT=0]="SERVER_TIMEOUT",e[e.CLIENT_TIMEOUT=1]="CLIENT_TIMEOUT",e[e.UNKNOWN_RPC_METHOD=2]="UNKNOWN_RPC_METHOD",e[e.CLIENT_ERROR=3]="CLIENT_ERROR",e[e.SERVER_ERROR=4]="SERVER_ERROR"}(NS||(NS={}));const xS=new class extends sS{constructor(){super("protorpc.RpcMessage",[{no:1,name:"header",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:2,name:"body",kind:"message",T:()=>IS},{no:3,name:"requestId",kind:"scalar",T:9},{no:4,name:"errorType",kind:"enum",opt:!0,T:()=>["protorpc.RpcErrorType",NS]},{no:5,name:"errorClassName",kind:"scalar",opt:!0,T:9},{no:6,name:"errorCode",kind:"scalar",opt:!0,T:9},{no:7,name:"errorMessage",kind:"scalar",opt:!0,T:9}])}};function OS(e,t){const r=new Promise((r,n)=>{const i=setTimeout(()=>{n(new vS("Timed out in "+e+"ms."))},e);t.finally(()=>clearTimeout(i)).catch(()=>null)});return Promise.race([t,r])}new class extends sS{constructor(){super("protorpc.Mnfo2uhnf92hvqi2nviouq2hv9puhq",[{no:1,name:"empty",kind:"message",T:()=>TS}])}};class DS{method=void 0;headers=void 0;deadline=void 0;trailers=void 0;status=void 0;sendResponseHeaders(e){throw new SS("Method not implemented.")}cancelled=void 0;onCancel(e){throw new SS("Method not implemented.")}notification}var MS=kS;const BS=e=>({timeout:e.timeout??1e3}),LS=new Ta("ServerRegistry");function FS(e){try{return e()}catch(e){throw new RS("Could not parse binary to JSON-object",e)}}class US{methods=new Map;notifications=new Map;getImplementation(e,t){if(!e?.header?.method)throw new MS('Header "method" missing from RPC message');if(!t.has(e.header.method))throw new MS(`RPC Method ${e.header.method} is not provided`);return t.get(e.header.method)}async handleRequest(e,t){LS.trace(`Server processing RPC call ${e.requestId}`);const r=this.getImplementation(e,this.methods),n=r.options.timeout;return await OS(n,r.fn(e.body,t??new DS))}async handleNotification(e,t){LS.trace(`Server processing RPC notification ${e.requestId}`);const r=this.getImplementation(e,this.notifications),n=r.options.timeout;await OS(n,r.fn(e.body,t??new DS))}registerRpcMethod(e,t,r,n,i={}){const s={fn:async(r,i)=>{const s=FS(()=>IS.unpack(r,e)),o=await n(s,i);return IS.pack(o,t)},options:BS(i)};this.methods.set(r,s)}registerRpcNotification(e,t,r,n={}){const i={fn:async(t,n)=>{const i=FS(()=>IS.unpack(t,e));await r(i,n)},options:BS(n)};this.notifications.set(t,i)}}var jS;!function(e){e.OK="OK",e.STOPPED="STOPPED",e.DEADLINE_EXCEEDED="DEADLINE_EXCEEDED",e.SERVER_ERROR="SERVER_ERROR"}(jS||(jS={}));class zS{deferredPromises;callContext;timeoutRef;constructor(e,t,r){this.deferredPromises=e,this.callContext=t,r&&(this.timeoutRef=setTimeout(()=>{const e=new vS("Rpc request timed out",new Error);this.rejectDeferredPromises(e,jS.DEADLINE_EXCEEDED),r.onTimeout()},r.timeout))}resolveRequest(e){this.timeoutRef&&clearTimeout(this.timeoutRef),this.resolveDeferredPromises(e)}resolveNotification(){this.timeoutRef&&clearTimeout(this.timeoutRef),this.deferredPromises.message.state===pS.PENDING&&(this.deferredPromises.message.resolve({}),this.deferredPromises.header.resolve({}),this.deferredPromises.status.resolve({code:jS.OK,detail:""}),this.deferredPromises.trailer.resolve({}))}rejectRequest(e,t){this.timeoutRef&&clearTimeout(this.timeoutRef),this.rejectDeferredPromises(e,t)}resolveDeferredPromises(e){if(this.deferredPromises.message.state===pS.PENDING)try{const t=this.deferredPromises.messageParser(e.body.value);this.deferredPromises.message.resolve(t),this.deferredPromises.header.resolve({}),this.deferredPromises.status.resolve({code:jS.OK,detail:""}),this.deferredPromises.trailer.resolve({})}catch(e){qS.debug("Could not parse response, received message is likely ");const t=new RS("Failed to parse received response, network protocol version likely is likely incompatible",e);this.rejectDeferredPromises(t,jS.SERVER_ERROR)}}rejectDeferredPromises(e,t){this.deferredPromises.message.state===pS.PENDING&&(this.deferredPromises.message.reject(e),this.deferredPromises.header.reject(e),this.deferredPromises.status.reject({code:t,detail:e.message}),this.deferredPromises.trailer.reject(e))}fulfillsPredicate(e){return e(this)}getCallContext(){return this.callContext}}const qS=new Ta("RpcCommunicator");class KS{stopped=!1;rpcClientTransport;rpcServerRegistry;ongoingRequests;rpcRequestTimeout;outgoingMessageListener;constructor(e){this.rpcRequestTimeout=e?.rpcRequestTimeout??5e3,this.rpcClientTransport=new _S(this.rpcRequestTimeout),this.rpcServerRegistry=new US,this.ongoingRequests=new Map,this.rpcClientTransport.on("rpcRequest",(e,t,r)=>{this.onOutgoingMessage(e,t,r)})}async handleIncomingMessage(e,t){if(!this.stopped)return this.onIncomingMessage(e,t)}registerRpcMethod(e,t,r,n,i={}){this.rpcServerRegistry.registerRpcMethod(e,t,r,n,i)}registerRpcNotification(e,t,r,n={}){this.rpcServerRegistry.registerRpcNotification(e,t,r,n)}getRpcClientTransport(){return this.rpcClientTransport}stop(){this.stopped=!0,this.ongoingRequests.forEach(e=>{e.rejectRequest(new Error("stopped"),jS.STOPPED)}),this.ongoingRequests.clear(),this.rpcClientTransport.stop()}onOutgoingMessage(e,t,r){if(this.stopped)return void(r&&new zS(r,t).rejectRequest(new Error("stopped"),jS.STOPPED));const n=this.rpcClientTransport.mergeOptions(t);!r||t&&t.notification||this.registerRequest(e.requestId,r,t,n.timeout),qS.trace(`onOutGoingMessage, messageId: ${e.requestId}`),this.outgoingMessageListener?this.outgoingMessageListener(e,e.requestId,t).catch(n=>{r&&(this.ongoingRequests.has(e.requestId)?this.handleClientError(e.requestId,n):new zS(r,t).rejectRequest(n,jS.SERVER_ERROR))}).then(()=>{r&&!this.ongoingRequests.has(e.requestId)&&new zS(r,t).resolveNotification()}):r&&!this.ongoingRequests.has(e.requestId)&&new zS(r,t).resolveNotification()}async onIncomingMessage(e,t){qS.trace(`onIncomingMessage, requestId: ${e.requestId}`),e.header.response&&this.ongoingRequests.has(e.requestId)?void 0!==e.errorType?this.rejectOngoingRequest(e):this.resolveOngoingRequest(e):e.header.request&&e.header.method&&(e.header.notification?await this.handleNotification(e,t):await this.handleRequest(e,t))}async handleRequest(e,t){if(this.stopped)return;let r;try{const n=await this.rpcServerRegistry.handleRequest(e,t);r=this.createResponseRpcMessage({request:e,body:n})}catch(t){const n={request:e};t.code===mS.UNKNOWN_RPC_METHOD?n.errorType=NS.UNKNOWN_RPC_METHOD:t.code===mS.RPC_TIMEOUT?n.errorType=NS.SERVER_TIMEOUT:(n.errorType=NS.SERVER_ERROR,t.className&&(n.errorClassName=t.className),t.code&&(n.errorCode=t.code),t.message&&(n.errorMessage=t.message)),r=this.createResponseRpcMessage(n)}this.onOutgoingMessage(r,t,void 0)}async handleNotification(e,t){if(!this.stopped)try{await this.rpcServerRegistry.handleNotification(e,t)}catch(e){qS.debug("error",{err:e})}}registerRequest(e,t,r,n=this.rpcRequestTimeout){if(this.stopped)return;const i=new zS(t,r,{timeout:n,onTimeout:()=>this.ongoingRequests.delete(e)});this.ongoingRequests.set(e,i)}resolveOngoingRequest(e){this.stopped||(this.ongoingRequests.get(e.requestId).resolveRequest(e),this.ongoingRequests.delete(e.requestId))}rejectOngoingRequest(e){if(this.stopped)return;const t=this.ongoingRequests.get(e.requestId);let r;r=e.errorType===NS.SERVER_TIMEOUT?new vS("Server timed out on request"):e.errorType===NS.UNKNOWN_RPC_METHOD?new kS(`Server does not implement method ${e.header.method}`):e.errorType===NS.SERVER_ERROR?new AS(e.errorMessage,e.errorClassName,e.errorCode):new ES("Unknown RPC Error"),t.rejectRequest(r,jS.SERVER_ERROR),this.ongoingRequests.delete(e.requestId)}handleClientError(e,t){if(this.stopped)return;const r=this.ongoingRequests.get(e);r&&(r.rejectRequest(t,jS.SERVER_ERROR),this.ongoingRequests.delete(e))}setOutgoingMessageListener(e){this.outgoingMessageListener=e}getRequestIds(e){return Array.from(this.ongoingRequests.entries()).filter(([t,r])=>r.fulfillsPredicate(e)).map(([e])=>e)}createResponseRpcMessage({request:e,body:t,errorType:r,errorClassName:n,errorCode:i,errorMessage:s}){return{body:t,header:{response:"response",method:e.header.method},requestId:e.requestId,errorType:r,errorClassName:n,errorCode:i,errorMessage:s}}}function GS(e){const t={};return Object.assign(t,e),e.methods.forEach(r=>{r.O.typeName===TS.typeName?t[r.name]=(...t)=>(async(e,t,r)=>{r.length<2?r.push({}):r[1]??={},r[1].isProtoRpc=!0,r[1].notification=!0,await t[e].apply(t,r)})(r.name,e,t):t[r.name]=(...t)=>((e,t,r)=>(r.length<2?r.push({}):r[1]??={},r[1].isProtoRpc=!0,t[e].apply(t,r)))(r.name,e,t).response}),t}const $S=[xS];var VS=r(640),HS=r.n(VS),WS=r(952),JS=r(6049),ZS=r.n(JS),QS=function(e,t){return QS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},QS(e,t)};function YS(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}QS(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}"function"==typeof SuppressedError&&SuppressedError;var XS=function(){function e(e,t,r){void 0===r&&(r=1),this.t=void 0,this.i=void 0,this.h=void 0,this.u=e,this.o=t,this.l=r}return e.prototype.v=function(){var e=this,t=e.h.h===e;if(t&&1===e.l)e=e.i;else if(e.t)for(e=e.t;e.i;)e=e.i;else{if(t)return e.h;for(var r=e.h;r.t===e;)r=(e=r).h;e=r}return e},e.prototype.p=function(){var e=this;if(e.i){for(e=e.i;e.t;)e=e.t;return e}for(var t=e.h;t.i===e;)t=(e=t).h;return e.i!==t?t:e},e.prototype.T=function(){var e=this.h,t=this.i,r=t.t;return e.h===this?e.h=t:e.t===this?e.t=t:e.i=t,t.h=e,t.t=this,this.h=t,this.i=r,r&&(r.h=this),t},e.prototype.I=function(){var e=this.h,t=this.t,r=t.i;return e.h===this?e.h=t:e.t===this?e.t=t:e.i=t,t.h=e,t.i=this,this.h=t,this.t=r,r&&(r.h=this),t},e}(),ek=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.O=1,t}return YS(t,e),t.prototype.T=function(){var t=e.prototype.T.call(this);return this.M(),t.M(),t},t.prototype.I=function(){var t=e.prototype.I.call(this);return this.M(),t.M(),t},t.prototype.M=function(){this.O=1,this.t&&(this.O+=this.t.O),this.i&&(this.O+=this.i.O)},t}(XS),tk=function(){function e(e){void 0===e&&(e=0),this.iteratorType=e}return e.prototype.equals=function(e){return this.C===e.C},e}();function rk(){throw new RangeError("Iterator access denied!")}var nk=function(e){function t(t,r){void 0===t&&(t=function(e,t){return e<t?-1:e>t?1:0}),void 0===r&&(r=!1);var n=e.call(this)||this;return n.N=void 0,n.g=t,n.enableIndex=r,n.S=r?ek:XS,n.A=new n.S,n}return YS(t,e),t.prototype.m=function(e,t){for(var r=this.A;e;){var n=this.g(e.u,t);if(n<0)e=e.i;else{if(!(n>0))return e;r=e,e=e.t}}return r},t.prototype.B=function(e,t){for(var r=this.A;e;)this.g(e.u,t)<=0?e=e.i:(r=e,e=e.t);return r},t.prototype.j=function(e,t){for(var r=this.A;e;){var n=this.g(e.u,t);if(n<0)r=e,e=e.i;else{if(!(n>0))return e;e=e.t}}return r},t.prototype.k=function(e,t){for(var r=this.A;e;)this.g(e.u,t)<0?(r=e,e=e.i):e=e.t;return r},t.prototype.R=function(e){for(;;){var t,r=e.h;if(r===this.A)return;if(1===e.l)return void(e.l=0);if(e===r.t)if(1===(t=r.i).l)t.l=0,r.l=1,r===this.N?this.N=r.T():r.T();else{if(t.i&&1===t.i.l)return t.l=r.l,r.l=0,t.i.l=0,void(r===this.N?this.N=r.T():r.T());t.t&&1===t.t.l?(t.l=1,t.t.l=0,t.I()):(t.l=1,e=r)}else if(1===(t=r.t).l)t.l=0,r.l=1,r===this.N?this.N=r.I():r.I();else{if(t.t&&1===t.t.l)return t.l=r.l,r.l=0,t.t.l=0,void(r===this.N?this.N=r.I():r.I());t.i&&1===t.i.l?(t.l=1,t.i.l=0,t.T()):(t.l=1,e=r)}}},t.prototype.G=function(e){if(1!==this._){for(var t=e;t.t||t.i;){if(t.i)for(t=t.i;t.t;)t=t.t;else t=t.t;var r=e.u;e.u=t.u,t.u=r;var n=e.o;e.o=t.o,t.o=n,e=t}this.A.t===t?this.A.t=t.h:this.A.i===t&&(this.A.i=t.h),this.R(t);var i=t.h;if(t===i.t?i.t=void 0:i.i=void 0,this._-=1,this.N.l=0,this.enableIndex)for(;i!==this.A;)i.O-=1,i=i.h}else this.clear()},t.prototype.P=function(e){for(var t="number"==typeof e?e:void 0,r="function"==typeof e?e:void 0,n=void 0===e?[]:void 0,i=0,s=this.N,o=[];o.length||s;)if(s)o.push(s),s=s.t;else{if(s=o.pop(),i===t)return s;n&&n.push(s),r&&r(s,i,this),i+=1,s=s.i}return n},t.prototype.q=function(e){for(;;){var t=e.h;if(0===t.l)return;var r=t.h;if(t===r.t){if((n=r.i)&&1===n.l){if(n.l=t.l=0,r===this.N)return;r.l=1,e=r;continue}if(e!==t.i)return t.l=0,r===this.N?this.N=r.I():r.I(),void(r.l=1);e.l=0,e.t&&(e.t.h=t),e.i&&(e.i.h=r),t.i=e.t,r.t=e.i,e.t=t,e.i=r,r===this.N?(this.N=e,this.A.h=e):(i=r.h).t===r?i.t=e:i.i=e,e.h=r.h,t.h=e,r.h=e,r.l=1}else{var n,i;if((n=r.t)&&1===n.l){if(n.l=t.l=0,r===this.N)return;r.l=1,e=r;continue}if(e!==t.t)return t.l=0,r===this.N?this.N=r.T():r.T(),void(r.l=1);e.l=0,e.t&&(e.t.h=r),e.i&&(e.i.h=t),r.i=e.t,t.t=e.i,e.t=r,e.i=t,r===this.N?(this.N=e,this.A.h=e):(i=r.h).t===r?i.t=e:i.i=e,e.h=r.h,t.h=e,r.h=e,r.l=1}return void(this.enableIndex&&(t.M(),r.M(),e.M()))}},t.prototype.D=function(e,t,r){if(void 0===this.N)return this._+=1,this.N=new this.S(e,t,0),this.N.h=this.A,this.A.h=this.A.t=this.A.i=this.N,this._;var n,i=this.A.t,s=this.g(i.u,e);if(0===s)return i.o=t,this._;if(s>0)i.t=new this.S(e,t),i.t.h=i,n=i.t,this.A.t=n;else{var o=this.A.i,a=this.g(o.u,e);if(0===a)return o.o=t,this._;if(a<0)o.i=new this.S(e,t),o.i.h=o,n=o.i,this.A.i=n;else{if(void 0!==r){var c=r.C;if(c!==this.A){var u=this.g(c.u,e);if(0===u)return c.o=t,this._;if(u>0){var l=c.v(),d=this.g(l.u,e);if(0===d)return l.o=t,this._;d<0&&(n=new this.S(e,t),void 0===l.i?(l.i=n,n.h=l):(c.t=n,n.h=c))}}}if(void 0===n)for(n=this.N;;){var h=this.g(n.u,e);if(h>0){if(void 0===n.t){n.t=new this.S(e,t),n.t.h=n,n=n.t;break}n=n.t}else{if(!(h<0))return n.o=t,this._;if(void 0===n.i){n.i=new this.S(e,t),n.i.h=n,n=n.i;break}n=n.i}}}}if(this.enableIndex)for(var f=n.h;f!==this.A;)f.O+=1,f=f.h;return this.q(n),this._+=1,this._},t.prototype.F=function(e,t){for(;e;){var r=this.g(e.u,t);if(r<0)e=e.i;else{if(!(r>0))return e;e=e.t}}return e||this.A},t.prototype.clear=function(){this._=0,this.N=void 0,this.A.h=void 0,this.A.t=this.A.i=void 0},t.prototype.updateKeyByIterator=function(e,t){var r=e.C;if(r===this.A&&rk(),1===this._)return r.u=t,!0;var n=r.p().u;if(r===this.A.t)return this.g(n,t)>0&&(r.u=t,!0);var i=r.v().u;return r===this.A.i?this.g(i,t)<0&&(r.u=t,!0):!(this.g(i,t)>=0||this.g(n,t)<=0||(r.u=t,0))},t.prototype.eraseElementByPos=function(e){if(e<0||e>this._-1)throw new RangeError;var t=this.P(e);return this.G(t),this._},t.prototype.eraseElementByKey=function(e){if(0===this._)return!1;var t=this.F(this.N,e);return t!==this.A&&(this.G(t),!0)},t.prototype.eraseElementByIterator=function(e){var t=e.C;t===this.A&&rk();var r=void 0===t.i;return 0===e.iteratorType?r&&e.next():r&&void 0!==t.t||e.next(),this.G(t),e},t.prototype.getHeight=function(){return 0===this._?0:function e(t){return t?Math.max(e(t.t),e(t.i))+1:0}(this.N)},t}(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return YS(t,e),t}(function(){function e(){this._=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this._},enumerable:!1,configurable:!0}),e.prototype.size=function(){return this._},e.prototype.empty=function(){return 0===this._},e}())),ik=function(e){function t(t,r,n){var i=e.call(this,n)||this;return i.C=t,i.A=r,0===i.iteratorType?(i.pre=function(){return this.C===this.A.t&&rk(),this.C=this.C.v(),this},i.next=function(){return this.C===this.A&&rk(),this.C=this.C.p(),this}):(i.pre=function(){return this.C===this.A.i&&rk(),this.C=this.C.p(),this},i.next=function(){return this.C===this.A&&rk(),this.C=this.C.v(),this}),i}return YS(t,e),Object.defineProperty(t.prototype,"index",{get:function(){var e=this.C,t=this.A.h;if(e===this.A)return t?t.O-1:0;var r=0;for(e.t&&(r+=e.t.O);e!==t;){var n=e.h;e===n.i&&(r+=1,n.t&&(r+=n.t.O)),e=n}return r},enumerable:!1,configurable:!0}),t.prototype.isAccessible=function(){return this.C!==this.A},t}(tk),sk=function(e){function t(t,r,n,i){var s=e.call(this,t,r,i)||this;return s.container=n,s}return YS(t,e),Object.defineProperty(t.prototype,"pointer",{get:function(){this.C===this.A&&rk();var e=this;return new Proxy([],{get:function(t,r){return"0"===r?e.C.u:"1"===r?e.C.o:(t[0]=e.C.u,t[1]=e.C.o,t[r])},set:function(t,r,n){if("1"!==r)throw new TypeError("prop must be 1");return e.C.o=n,!0}})},enumerable:!1,configurable:!0}),t.prototype.copy=function(){return new t(this.C,this.A,this.container,this.iteratorType)},t}(ik),ok=function(e){function t(t,r,n){void 0===t&&(t=[]);var i=e.call(this,r,n)||this,s=i;return t.forEach(function(e){s.setElement(e[0],e[1])}),i}return YS(t,e),t.prototype.begin=function(){return new sk(this.A.t||this.A,this.A,this)},t.prototype.end=function(){return new sk(this.A,this.A,this)},t.prototype.rBegin=function(){return new sk(this.A.i||this.A,this.A,this,1)},t.prototype.rEnd=function(){return new sk(this.A,this.A,this,1)},t.prototype.front=function(){if(0!==this._){var e=this.A.t;return[e.u,e.o]}},t.prototype.back=function(){if(0!==this._){var e=this.A.i;return[e.u,e.o]}},t.prototype.lowerBound=function(e){var t=this.m(this.N,e);return new sk(t,this.A,this)},t.prototype.upperBound=function(e){var t=this.B(this.N,e);return new sk(t,this.A,this)},t.prototype.reverseLowerBound=function(e){var t=this.j(this.N,e);return new sk(t,this.A,this)},t.prototype.reverseUpperBound=function(e){var t=this.k(this.N,e);return new sk(t,this.A,this)},t.prototype.forEach=function(e){this.P(function(t,r,n){e([t.u,t.o],r,n)})},t.prototype.setElement=function(e,t,r){return this.D(e,t,r)},t.prototype.getElementByPos=function(e){if(e<0||e>this._-1)throw new RangeError;var t=this.P(e);return[t.u,t.o]},t.prototype.find=function(e){var t=this.F(this.N,e);return new sk(t,this.A,this)},t.prototype.getElementByKey=function(e){return this.F(this.N,e).o},t.prototype.union=function(e){var t=this;return e.forEach(function(e){t.setElement(e[0],e[1])}),this._},t.prototype[Symbol.iterator]=function(){var e,t,r,n;return function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return c([e,t])}}function c(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}(this,function(i){switch(i.label){case 0:e=this._,t=this.P(),r=0,i.label=1;case 1:return r<e?[4,[(n=t[r]).u,n.o]]:[3,4];case 2:i.sent(),i.label=3;case 3:return++r,[3,1];case 4:return[2]}})},t}(nk),ak=r(8090),ck=r.n(ak),uk=r(121),lk=r.n(uk),dk="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,hk=new Set,fk="object"==typeof process&&process?process:{},pk=(e,t,r,n)=>{"function"==typeof fk.emitWarning?fk.emitWarning(e,t,r,n):console.error(`[${r}] ${t}: ${e}`)},gk=globalThis.AbortController,mk=globalThis.AbortSignal;if(typeof gk>"u"){mk=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(e,t){this._onabort.push(t)}},gk=class{constructor(){t()}signal=new mk;abort(e){if(!this.signal.aborted){this.signal.reason=e,this.signal.aborted=!0;for(let t of this.signal._onabort)t(e);this.signal.onabort?.(e)}}};let e="1"!==fk.env?.LRU_CACHE_IGNORE_AC_WARNING,t=()=>{e&&(e=!1,pk("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}Symbol("type");var yk=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),bk=e=>yk(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?wk:null:null,wk=class extends Array{constructor(e){super(e),this.fill(0)}},vk=class e{heap;length;static#zt=!1;static create(t){let r=bk(t);if(!r)return[];e.#zt=!0;let n=new e(t,r);return e.#zt=!1,n}constructor(t,r){if(!e.#zt)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new r(t),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},Ek=class e{#zt;#qt;#Kt;#Gt;#$t;#Vt;#Ht;#Wt;get perf(){return this.#Wt}ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#Jt;#Zt;#m;#Qt;#Yt;#Xt;#er;#tr;#rr;#nr;#g;#ir;#sr;#or;#ar;#cr;#y;#ur;#lr;static unsafeExposeInternals(e){return{starts:e.#sr,ttls:e.#or,autopurgeTimers:e.#ar,sizes:e.#ir,keyMap:e.#m,keyList:e.#Qt,valList:e.#Yt,next:e.#Xt,prev:e.#er,get head(){return e.#tr},get tail(){return e.#rr},free:e.#nr,isBackgroundFetch:t=>e.#dr(t),backgroundFetch:(t,r,n,i)=>e.#hr(t,r,n,i),moveToTail:t=>e.#fr(t),indexes:t=>e.#pr(t),rindexes:t=>e.#gr(t),isStale:t=>e.#mr(t)}}get max(){return this.#zt}get maxSize(){return this.#qt}get calculatedSize(){return this.#Zt}get size(){return this.#Jt}get fetchMethod(){return this.#Vt}get memoMethod(){return this.#Ht}get dispose(){return this.#Kt}get onInsert(){return this.#Gt}get disposeAfter(){return this.#$t}constructor(t){let{max:r=0,ttl:n,ttlResolution:i=1,ttlAutopurge:s,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:c,dispose:u,onInsert:l,disposeAfter:d,noDisposeOnSet:h,noUpdateTTL:f,maxSize:p=0,maxEntrySize:g=0,sizeCalculation:m,fetchMethod:y,memoMethod:b,noDeleteOnFetchRejection:w,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:E,allowStaleOnFetchAbort:A,ignoreFetchAbort:S,perf:k}=t;if(void 0!==k&&"function"!=typeof k?.now)throw new TypeError("perf option must have a now() method if specified");if(this.#Wt=k??dk,0!==r&&!yk(r))throw new TypeError("max option must be a nonnegative integer");let R=r?bk(r):Array;if(!R)throw new Error("invalid max value: "+r);if(this.#zt=r,this.#qt=p,this.maxEntrySize=g||this.#qt,this.sizeCalculation=m,this.sizeCalculation){if(!this.#qt&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==b&&"function"!=typeof b)throw new TypeError("memoMethod must be a function if defined");if(this.#Ht=b,void 0!==y&&"function"!=typeof y)throw new TypeError("fetchMethod must be a function if specified");if(this.#Vt=y,this.#y=!!y,this.#m=new Map,this.#Qt=new Array(r).fill(void 0),this.#Yt=new Array(r).fill(void 0),this.#Xt=new R(r),this.#er=new R(r),this.#tr=0,this.#rr=0,this.#nr=vk.create(r),this.#Jt=0,this.#Zt=0,"function"==typeof u&&(this.#Kt=u),"function"==typeof l&&(this.#Gt=l),"function"==typeof d?(this.#$t=d,this.#g=[]):(this.#$t=void 0,this.#g=void 0),this.#cr=!!this.#Kt,this.#lr=!!this.#Gt,this.#ur=!!this.#$t,this.noDisposeOnSet=!!h,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!w,this.allowStaleOnFetchRejection=!!E,this.allowStaleOnFetchAbort=!!A,this.ignoreFetchAbort=!!S,0!==this.maxEntrySize){if(0!==this.#qt&&!yk(this.#qt))throw new TypeError("maxSize must be a positive integer if specified");if(!yk(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#yr()}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=yk(i)||0===i?i:1,this.ttlAutopurge=!!s,this.ttl=n||0,this.ttl){if(!yk(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#br()}if(0===this.#zt&&0===this.ttl&&0===this.#qt)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#zt&&!this.#qt){let t="LRU_CACHE_UNBOUNDED";(e=>!hk.has(e))(t)&&(hk.add(t),pk("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",t,e))}}getRemainingTTL(e){return this.#m.has(e)?1/0:0}#br(){let e=new wk(this.#zt),t=new wk(this.#zt);this.#or=e,this.#sr=t;let r=this.ttlAutopurge?new Array(this.#zt):void 0;this.#ar=r,this.#wr=(n,i,s=this.#Wt.now())=>{if(t[n]=0!==i?s:0,e[n]=i,r?.[n]&&(clearTimeout(r[n]),r[n]=void 0),0!==i&&r){let e=setTimeout(()=>{this.#mr(n)&&this.#vr(this.#Qt[n],"expire")},i+1);e.unref&&e.unref(),r[n]=e}},this.#Er=r=>{t[r]=0!==e[r]?this.#Wt.now():0},this.#Ar=(r,s)=>{if(e[s]){let o=e[s],a=t[s];if(!o||!a)return;r.ttl=o,r.start=a,r.now=n||i();let c=r.now-a;r.remainingTTL=o-c}};let n=0,i=()=>{let e=this.#Wt.now();if(this.ttlResolution>0){n=e;let t=setTimeout(()=>n=0,this.ttlResolution);t.unref&&t.unref()}return e};this.getRemainingTTL=r=>{let s=this.#m.get(r);if(void 0===s)return 0;let o=e[s],a=t[s];return o&&a?o-((n||i())-a):1/0},this.#mr=r=>{let s=t[r],o=e[r];return!!o&&!!s&&(n||i())-s>o}}#Er=()=>{};#Ar=()=>{};#wr=()=>{};#mr=()=>!1;#yr(){let e=new wk(this.#zt);this.#Zt=0,this.#ir=e,this.#Sr=t=>{this.#Zt-=e[t],e[t]=0},this.#kr=(e,t,r,n)=>{if(this.#dr(t))return 0;if(!yk(r)){if(!n)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof n)throw new TypeError("sizeCalculation must be a function");if(r=n(t,e),!yk(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return r},this.#Rr=(t,r,n)=>{if(e[t]=r,this.#qt){let r=this.#qt-e[t];for(;this.#Zt>r;)this.#Pr(!0)}this.#Zt+=e[t],n&&(n.entrySize=r,n.totalCalculatedSize=this.#Zt)}}#Sr=e=>{};#Rr=(e,t,r)=>{};#kr=(e,t,r,n)=>{if(r||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#pr({allowStale:e=this.allowStale}={}){if(this.#Jt)for(let t=this.#rr;this.#Ir(t)&&((e||!this.#mr(t))&&(yield t),t!==this.#tr);)t=this.#er[t]}*#gr({allowStale:e=this.allowStale}={}){if(this.#Jt)for(let t=this.#tr;this.#Ir(t)&&((e||!this.#mr(t))&&(yield t),t!==this.#rr);)t=this.#Xt[t]}#Ir(e){return void 0!==e&&this.#m.get(this.#Qt[e])===e}*entries(){for(let e of this.#pr())void 0!==this.#Yt[e]&&void 0!==this.#Qt[e]&&!this.#dr(this.#Yt[e])&&(yield[this.#Qt[e],this.#Yt[e]])}*rentries(){for(let e of this.#gr())void 0!==this.#Yt[e]&&void 0!==this.#Qt[e]&&!this.#dr(this.#Yt[e])&&(yield[this.#Qt[e],this.#Yt[e]])}*keys(){for(let e of this.#pr()){let t=this.#Qt[e];void 0!==t&&!this.#dr(this.#Yt[e])&&(yield t)}}*rkeys(){for(let e of this.#gr()){let t=this.#Qt[e];void 0!==t&&!this.#dr(this.#Yt[e])&&(yield t)}}*values(){for(let e of this.#pr())void 0!==this.#Yt[e]&&!this.#dr(this.#Yt[e])&&(yield this.#Yt[e])}*rvalues(){for(let e of this.#gr())void 0!==this.#Yt[e]&&!this.#dr(this.#Yt[e])&&(yield this.#Yt[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(let r of this.#pr()){let n=this.#Yt[r],i=this.#dr(n)?n.__staleWhileFetching:n;if(void 0!==i&&e(i,this.#Qt[r],this))return this.get(this.#Qt[r],t)}}forEach(e,t=this){for(let r of this.#pr()){let n=this.#Yt[r],i=this.#dr(n)?n.__staleWhileFetching:n;void 0!==i&&e.call(t,i,this.#Qt[r],this)}}rforEach(e,t=this){for(let r of this.#gr()){let n=this.#Yt[r],i=this.#dr(n)?n.__staleWhileFetching:n;void 0!==i&&e.call(t,i,this.#Qt[r],this)}}purgeStale(){let e=!1;for(let t of this.#gr({allowStale:!0}))this.#mr(t)&&(this.#vr(this.#Qt[t],"expire"),e=!0);return e}info(e){let t=this.#m.get(e);if(void 0===t)return;let r=this.#Yt[t],n=this.#dr(r)?r.__staleWhileFetching:r;if(void 0===n)return;let i={value:n};if(this.#or&&this.#sr){let e=this.#or[t],r=this.#sr[t];if(e&&r){let t=e-(this.#Wt.now()-r);i.ttl=t,i.start=Date.now()}}return this.#ir&&(i.size=this.#ir[t]),i}dump(){let e=[];for(let t of this.#pr({allowStale:!0})){let r=this.#Qt[t],n=this.#Yt[t],i=this.#dr(n)?n.__staleWhileFetching:n;if(void 0===i||void 0===r)continue;let s={value:i};if(this.#or&&this.#sr){s.ttl=this.#or[t];let e=this.#Wt.now()-this.#sr[t];s.start=Math.floor(Date.now()-e)}this.#ir&&(s.size=this.#ir[t]),e.unshift([r,s])}return e}load(e){this.clear();for(let[t,r]of e){if(r.start){let e=Date.now()-r.start;r.start=this.#Wt.now()-e}this.set(t,r.value,r)}}set(e,t,r={}){if(void 0===t)return this.delete(e),this;let{ttl:n=this.ttl,start:i,noDisposeOnSet:s=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:a}=r,{noUpdateTTL:c=this.noUpdateTTL}=r,u=this.#kr(e,t,r.size||0,o);if(this.maxEntrySize&&u>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.#vr(e,"set"),this;let l=0===this.#Jt?void 0:this.#m.get(e);if(void 0===l)l=0===this.#Jt?this.#rr:0!==this.#nr.length?this.#nr.pop():this.#Jt===this.#zt?this.#Pr(!1):this.#Jt,this.#Qt[l]=e,this.#Yt[l]=t,this.#m.set(e,l),this.#Xt[this.#rr]=l,this.#er[l]=this.#rr,this.#rr=l,this.#Jt++,this.#Rr(l,u,a),a&&(a.set="add"),c=!1,this.#lr&&this.#Gt?.(t,e,"add");else{this.#fr(l);let r=this.#Yt[l];if(t!==r){if(this.#y&&this.#dr(r)){r.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:t}=r;void 0!==t&&!s&&(this.#cr&&this.#Kt?.(t,e,"set"),this.#ur&&this.#g?.push([t,e,"set"]))}else s||(this.#cr&&this.#Kt?.(r,e,"set"),this.#ur&&this.#g?.push([r,e,"set"]));if(this.#Sr(l),this.#Rr(l,u,a),this.#Yt[l]=t,a){a.set="replace";let e=r&&this.#dr(r)?r.__staleWhileFetching:r;void 0!==e&&(a.oldValue=e)}}else a&&(a.set="update");this.#lr&&this.onInsert?.(t,e,t===r?"update":"replace")}if(0!==n&&!this.#or&&this.#br(),this.#or&&(c||this.#wr(l,n,i),a&&this.#Ar(a,l)),!s&&this.#ur&&this.#g){let e,t=this.#g;for(;e=t?.shift();)this.#$t?.(...e)}return this}pop(){try{for(;this.#Jt;){let e=this.#Yt[this.#tr];if(this.#Pr(!0),this.#dr(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(void 0!==e)return e}}finally{if(this.#ur&&this.#g){let e,t=this.#g;for(;e=t?.shift();)this.#$t?.(...e)}}}#Pr(e){let t=this.#tr,r=this.#Qt[t],n=this.#Yt[t];return this.#y&&this.#dr(n)?n.__abortController.abort(new Error("evicted")):(this.#cr||this.#ur)&&(this.#cr&&this.#Kt?.(n,r,"evict"),this.#ur&&this.#g?.push([n,r,"evict"])),this.#Sr(t),this.#ar?.[t]&&(clearTimeout(this.#ar[t]),this.#ar[t]=void 0),e&&(this.#Qt[t]=void 0,this.#Yt[t]=void 0,this.#nr.push(t)),1===this.#Jt?(this.#tr=this.#rr=0,this.#nr.length=0):this.#tr=this.#Xt[t],this.#m.delete(r),this.#Jt--,t}has(e,t={}){let{updateAgeOnHas:r=this.updateAgeOnHas,status:n}=t,i=this.#m.get(e);if(void 0!==i){let e=this.#Yt[i];if(this.#dr(e)&&void 0===e.__staleWhileFetching)return!1;if(!this.#mr(i))return r&&this.#Er(i),n&&(n.has="hit",this.#Ar(n,i)),!0;n&&(n.has="stale",this.#Ar(n,i))}else n&&(n.has="miss");return!1}peek(e,t={}){let{allowStale:r=this.allowStale}=t,n=this.#m.get(e);if(void 0===n||!r&&this.#mr(n))return;let i=this.#Yt[n];return this.#dr(i)?i.__staleWhileFetching:i}#hr(e,t,r,n){let i=void 0===t?void 0:this.#Yt[t];if(this.#dr(i))return i;let s=new gk,{signal:o}=r;o?.addEventListener("abort",()=>s.abort(o.reason),{signal:s.signal});let a={signal:s.signal,options:r,context:n},c=(n,i=!1)=>{let{aborted:o}=s.signal,c=r.ignoreFetchAbort&&void 0!==n,d=r.ignoreFetchAbort||!(!r.allowStaleOnFetchAbort||void 0===n);if(r.status&&(o&&!i?(r.status.fetchAborted=!0,r.status.fetchError=s.signal.reason,c&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),o&&!c&&!i)return u(s.signal.reason,d);let h=l,f=this.#Yt[t];return(f===l||c&&i&&void 0===f)&&(void 0===n?void 0!==h.__staleWhileFetching?this.#Yt[t]=h.__staleWhileFetching:this.#vr(e,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(e,n,a.options))),n},u=(n,i)=>{let{aborted:o}=s.signal,a=o&&r.allowStaleOnFetchAbort,c=a||r.allowStaleOnFetchRejection,u=c||r.noDeleteOnFetchRejection,d=l;if(this.#Yt[t]===l&&(!u||!i&&void 0===d.__staleWhileFetching?this.#vr(e,"fetch"):a||(this.#Yt[t]=d.__staleWhileFetching)),c)return r.status&&void 0!==d.__staleWhileFetching&&(r.status.returnedStale=!0),d.__staleWhileFetching;if(d.__returned===d)throw n};r.status&&(r.status.fetchDispatched=!0);let l=new Promise((t,n)=>{let o=this.#Vt?.(e,i,a);o&&o instanceof Promise&&o.then(e=>t(void 0===e?void 0:e),n),s.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(t(void 0),r.allowStaleOnFetchAbort&&(t=e=>c(e,!0)))})}).then(c,e=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=e),u(e,!1))),d=Object.assign(l,{__abortController:s,__staleWhileFetching:i,__returned:void 0});return void 0===t?(this.set(e,d,{...a.options,status:void 0}),t=this.#m.get(e)):this.#Yt[t]=d,d}#dr(e){if(!this.#y)return!1;let t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof gk}async fetch(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:s=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:a=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:l=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:d=this.allowStaleOnFetchRejection,ignoreFetchAbort:h=this.ignoreFetchAbort,allowStaleOnFetchAbort:f=this.allowStaleOnFetchAbort,context:p,forceRefresh:g=!1,status:m,signal:y}=t;if(!this.#y)return m&&(m.fetch="get"),this.get(e,{allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,status:m});let b={allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,ttl:s,noDisposeOnSet:o,size:a,sizeCalculation:c,noUpdateTTL:u,noDeleteOnFetchRejection:l,allowStaleOnFetchRejection:d,allowStaleOnFetchAbort:f,ignoreFetchAbort:h,status:m,signal:y},w=this.#m.get(e);if(void 0===w){m&&(m.fetch="miss");let t=this.#hr(e,w,b,p);return t.__returned=t}{let t=this.#Yt[w];if(this.#dr(t)){let e=r&&void 0!==t.__staleWhileFetching;return m&&(m.fetch="inflight",e&&(m.returnedStale=!0)),e?t.__staleWhileFetching:t.__returned=t}let i=this.#mr(w);if(!g&&!i)return m&&(m.fetch="hit"),this.#fr(w),n&&this.#Er(w),m&&this.#Ar(m,w),t;let s=this.#hr(e,w,b,p),o=void 0!==s.__staleWhileFetching&&r;return m&&(m.fetch=i?"stale":"refresh",o&&i&&(m.returnedStale=!0)),o?s.__staleWhileFetching:s.__returned=s}}async forceFetch(e,t={}){let r=await this.fetch(e,t);if(void 0===r)throw new Error("fetch() returned undefined");return r}memo(e,t={}){let r=this.#Ht;if(!r)throw new Error("no memoMethod provided to constructor");let{context:n,forceRefresh:i,...s}=t,o=this.get(e,s);if(!i&&void 0!==o)return o;let a=r(e,o,{options:s,context:n});return this.set(e,a,s),a}get(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:s}=t,o=this.#m.get(e);if(void 0!==o){let t=this.#Yt[o],a=this.#dr(t);return s&&this.#Ar(s,o),this.#mr(o)?(s&&(s.get="stale"),a?(s&&r&&void 0!==t.__staleWhileFetching&&(s.returnedStale=!0),r?t.__staleWhileFetching:void 0):(i||this.#vr(e,"expire"),s&&r&&(s.returnedStale=!0),r?t:void 0)):(s&&(s.get="hit"),a?t.__staleWhileFetching:(this.#fr(o),n&&this.#Er(o),t))}s&&(s.get="miss")}#Cr(e,t){this.#er[t]=e,this.#Xt[e]=t}#fr(e){e!==this.#rr&&(e===this.#tr?this.#tr=this.#Xt[e]:this.#Cr(this.#er[e],this.#Xt[e]),this.#Cr(this.#rr,e),this.#rr=e)}delete(e){return this.#vr(e,"delete")}#vr(e,t){let r=!1;if(0!==this.#Jt){let n=this.#m.get(e);if(void 0!==n)if(this.#ar?.[n]&&(clearTimeout(this.#ar?.[n]),this.#ar[n]=void 0),r=!0,1===this.#Jt)this.#_r(t);else{this.#Sr(n);let r=this.#Yt[n];if(this.#dr(r)?r.__abortController.abort(new Error("deleted")):(this.#cr||this.#ur)&&(this.#cr&&this.#Kt?.(r,e,t),this.#ur&&this.#g?.push([r,e,t])),this.#m.delete(e),this.#Qt[n]=void 0,this.#Yt[n]=void 0,n===this.#rr)this.#rr=this.#er[n];else if(n===this.#tr)this.#tr=this.#Xt[n];else{let e=this.#er[n];this.#Xt[e]=this.#Xt[n];let t=this.#Xt[n];this.#er[t]=this.#er[n]}this.#Jt--,this.#nr.push(n)}}if(this.#ur&&this.#g?.length){let e,t=this.#g;for(;e=t?.shift();)this.#$t?.(...e)}return r}clear(){return this.#_r("delete")}#_r(e){for(let t of this.#gr({allowStale:!0})){let r=this.#Yt[t];if(this.#dr(r))r.__abortController.abort(new Error("deleted"));else{let n=this.#Qt[t];this.#cr&&this.#Kt?.(r,n,e),this.#ur&&this.#g?.push([r,n,e])}}if(this.#m.clear(),this.#Yt.fill(void 0),this.#Qt.fill(void 0),this.#or&&this.#sr){this.#or.fill(0),this.#sr.fill(0);for(let e of this.#ar??[])void 0!==e&&clearTimeout(e);this.#ar?.fill(void 0)}if(this.#ir&&this.#ir.fill(0),this.#tr=0,this.#rr=0,this.#nr.length=0,this.#Zt=0,this.#Jt=0,this.#ur&&this.#g){let e,t=this.#g;for(;e=t?.shift();)this.#$t?.(...e)}}},Ak=r(1031),Sk=r.n(Ak);const kk={JFK:[100,40.639447,-73.779317],LGA:[200,40.777199,-73.872597],EWR:[300,40.692501,-74.168701],BUF:[400,42.94049835,-78.73220062],BFI:[500,47.529999,-122.302002],SEA:[600,47.449162,-122.311134],PDX:[700,45.58869934,-122.5979996],HIO:[800,45.540401,-122.949997],SMF:[900,38.69540023803711,-121.59100341796875],SFO:[1e3,37.61899948120117,-122.375],PAO:[1100,37.461101532,-122.114997864],SJC:[1200,37.362452,-121.929188],WVI:[1300,36.9356994629,-121.790000916],BUR:[1400,34.197703,-118.356378],LAX:[1500,33.942501,-118.407997],SAN:[1600,32.7336006165,-117.190002441],LAS:[1700,36.083361,-115.151817],PHX:[1800,33.435302,-112.005905],ABQ:[1900,35.040199,-106.609001],DEN:[2e3,39.861698150635,-104.672996521],SLC:[2100,40.785749,-111.979746],STP:[2200,44.93479,-93.060036],MSP:[2300,44.882,-93.221802],FSD:[2400,43.585463,-96.741152],OMA:[2500,41.3032,-95.894096],MCI:[2600,39.2976,-94.713898],OKC:[2700,35.393101,-97.6007],ADS:[2800,32.9686012268,-96.8364028931],DFW:[2900,32.896801,-97.038002],IAH:[3e3,29.984399795532227,-95.34140014648438],AUS:[3100,30.197535,-97.662015],SAT:[3200,29.533701,-98.469803],MFE:[3300,26.176141,-98.237965],HNL:[3400,21.32062,-157.924228],ANC:[3500,61.1744,-149.996002],BOS:[3600,42.3643,-71.005203],BGR:[3700,44.8074,-68.828102],YTO:[3800,43.6772,-79.6306],YYZ:[3900,43.6772,-79.6306],YOW:[4e3,45.322498,-75.669197],YUL:[4100,45.4706,-73.740799],YHZ:[4200,44.8807983398,-63.5085983276],YVR:[4300,49.193901062,-123.183998108],YYC:[4400,51.113899231,-114.019996643],YXE:[4500,52.170799255371094,-106.69999694824219],YWG:[4600,49.909999847399995,-97.2398986816],KEF:[4700,63.985001,-22.6056],DUB:[4800,53.428713,-6.262121],ORK:[4900,51.841301,-8.49111],MAN:[5e3,53.349375,-2.279521],LHR:[5100,51.4706,-.461941],LON:[5200,51.4706,-.461941],LCY:[5300,51.505299,.055278],EDI:[5400,55.950145,-3.372288],BRU:[5500,50.901402,4.48444],AMS:[5600,52.308601,4.76389],DUS:[5700,51.289501,6.76678],FRA:[5800,50.036521,8.561268],WIE:[5900,50.049800872802734,8.325400352478027],STR:[6e3,48.689899,9.22196],MUC:[6100,48.353802,11.7861],TXL:[6200,52.362247,13.500672],HAM:[6300,53.630402,9.98823],LUX:[6400,49.6233333,6.2044444],DLP:[6500,49.012798,2.55],CDG:[6600,49.012798,2.55],PAR:[6700,49.012798,2.55],BOD:[6800,44.8283,-.715556],MRS:[6900,43.438088,5.2125],LYS:[7e3,45.725556,5.081111],GVA:[7100,46.238098,6.10895],ZRH:[7200,47.458056,8.548056],MXP:[7300,45.6306,8.72811],LIN:[7400,45.445099,9.27674],FCO:[7500,41.804532,12.251998],PMO:[7600,38.175999,13.091],PRG:[7700,50.103514,14.256992],CPH:[7800,55.617900848389,12.656000137329],OSL:[7900,60.193901,11.1004],ARN:[8e3,59.651901245117,17.918600082397],BMA:[8100,59.354400634765625,17.941699981689453],GOT:[8200,57.662799835205,12.279800415039],RIX:[8300,56.923599,23.9711],TLL:[8400,59.41329956049999,24.832799911499997],HEL:[8500,60.3172,24.963301],LED:[8600,59.80030059814453,30.262500762939453],KLD:[8700,56.82469940185547,35.7577018737793],DME:[8800,55.40879821777344,37.90629959106445],SVX:[8900,56.743099212646,60.802700042725],KJA:[9e3,56.173077,92.492437],KHV:[9100,48.528338,135.188588],MSQ:[9200,53.888071,28.039964],VNO:[9300,54.634102,25.285801],WAW:[9400,52.1656990051,20.967100143399996],KBP:[9500,50.345001,30.894699],KIV:[9600,46.9277,28.931],OTP:[9700,44.572127,26.103396],IST:[9800,41.261297,28.741951],ADB:[9900,38.2924,27.157],ATH:[1e4,37.936401,23.9445],SKG:[10100,40.51928,22.970009],SOF:[10200,42.696357,23.417671],TIA:[10300,41.4147,19.7206],BEG:[10400,44.818401,20.309099],BUD:[10500,47.43018,19.262393],BTS:[10600,48.1702,17.2127],VIE:[10700,48.110298,16.5697],ZAG:[10800,45.742901,16.0688],TUN:[10900,36.851002,10.2272],AAE:[11e3,36.826781,7.81334],ALG:[11100,36.693886,3.214531],ORN:[11200,35.623901,-.621183],MAD:[11300,40.471926,-3.56264],BCN:[11400,41.2971,2.07846],LIS:[11500,38.7813,-9.13592],CMN:[11600,33.3675,-7.58997],DKR:[11700,14.7397,-17.4902],OUA:[11800,12.3532,-1.51242],ACC:[11900,5.605189800262451,-.16678600013256073],LOS:[12e3,6.5773701667785645,3.321160078048706],FIH:[12100,-4.38575,15.4446],LAD:[12200,-8.85837,13.2312],CPT:[12300,-33.9648017883,18.6016998291],DUR:[12400,-29.6144444444,31.1197222222],JNB:[12500,-26.1392,28.246],MPM:[12600,-25.920799,32.572601],GBE:[12700,-24.555201,25.9182],HRE:[12800,-17.931801,31.0928],TNR:[12900,-18.7969,47.478802],RUN:[13e3,-20.890087,55.518894],MRU:[13100,-20.430201,57.683601],DAR:[13200,-6.87811,39.202599],MBA:[13300,-4.03483,39.5942],NBO:[13400,-1.31923997402,36.9277992249],KGL:[13500,-1.96863,30.1395],JIB:[13600,11.5473,43.1595],CAI:[13700,30.111534,31.396694],TLV:[13800,32.011398,34.8867],HFA:[13900,32.80939865112305,35.04309844970703],ZDM:[14e3,31.91123,35.20756],AMM:[14100,31.7226009369,35.9931983948],BEY:[14200,33.820899963378906,35.488399505615234],LCA:[14300,34.875099,33.624901],EVN:[14400,40.1473007202,44.3959007263],TBS:[14500,41.669201,44.9547],GYD:[14600,40.467498779296875,50.04669952392578],LLK:[14700,38.757919,48.807042],EBL:[14800,36.23759841918945,43.963199615478516],ISU:[14900,35.5617485046,45.316738128699996],BGW:[15e3,33.262501,44.2346],NJF:[15100,31.989853,44.404317],XNH:[15200,30.935801,46.090099],BSR:[15300,30.549101,47.662102],KWI:[15400,29.226601,47.968899],RUH:[15500,24.9576,46.698799],DMM:[15600,26.471200942993164,49.79790115356445],JED:[15700,21.6796,39.156502],BAH:[15800,26.267295,50.63764],DOH:[15900,25.273056,51.608056],DXB:[16e3,25.2527999878,55.3643989563],FJR:[16100,25.1122,56.324001],MCT:[16200,23.593299865722656,58.284400939941406],MLE:[16300,4.191830158233643,73.52909851074219],CMB:[16400,7.180759906768799,79.88410186767578],MAA:[16500,12.990005,80.169296],BLR:[16600,13.1979,77.706299],HYD:[16700,17.231318,78.429855],NAG:[16800,21.092199,79.047203],BBI:[16900,20.244400024399997,85.8178024292],CCU:[17e3,22.654699325561523,88.44670104980469],AMD:[17100,23.0772,72.634697],BOM:[17200,19.0886993408,72.8678970337],PNQ:[17300,18.5821,73.919701],CNN:[17400,11.918614,75.547211],COK:[17500,10.152,76.401901],PAT:[17600,25.591299,85.087997],KNU:[17700,26.404301,80.410103],DEL:[17800,28.55563,77.09519],IXC:[17900,30.6735,76.788498],JSR:[18e3,23.1838,89.160797],CGP:[18100,22.249599,91.813301],DAC:[18200,23.843347,90.397783],PBH:[18300,27.4032,89.424599],KTM:[18400,27.6966,85.3591],LHE:[18500,31.521601,74.403603],ISB:[18600,33.549,72.82566],KHI:[18700,24.9065,67.160797],TAS:[18800,41.257900238,69.2811965942],ALA:[18900,43.354267,77.042828],ULN:[19e3,47.843102,106.766998],ICN:[19100,37.46910095214844,126.45099639892578],TYO:[19200,35.764702,140.386002],NRT:[19300,35.764702,140.386002],HND:[19400,35.552299,139.779999],ITM:[19500,34.785499572753906,135.43800354003906],KIX:[19600,34.427299,135.244003],FUK:[19700,33.585899353027344,130.4510040283203],OKA:[19800,26.195801,127.646004],GUM:[19900,13.4834,144.796005],CGY:[2e4,8.612203,124.456496],CEB:[20100,10.309261,123.97974],MNL:[20200,14.5086,121.019997],BWN:[20300,4.9442,114.928001],SGN:[20400,10.8188,106.652],HAN:[20500,21.221201,105.806999],PNH:[20600,11.5466,104.844002],VTE:[20700,17.988300323500003,102.56300354],MFM:[20800,22.149599,113.592003],HKG:[20900,22.308901,113.915001],KHH:[21e3,22.577101,120.349998],TPE:[21100,25.0777,121.233002],FOC:[21200,25.934669,119.66318],HYN:[21300,28.562201,121.429001],HGH:[21400,30.23609,120.428865],SHA:[21500,31.198104,121.33426],CZX:[21600,31.919701,119.778999],WHU:[21700,31.3906,118.408997],KHN:[21800,28.864815,115.90271],CGD:[21900,28.9189,111.639999],KWE:[22e3,26.541466,106.803331],KMG:[22100,25.110313,102.936743],LHW:[22200,36.515202,103.620003],ZHY:[22300,37.573125,105.154454],SJW:[22400,38.280701,114.696999],PKX:[22500,39.509945,116.41092],BJS:[22600,40.080101013183594,116.58499908447266],TSN:[22700,39.124401092499994,117.346000671],TNA:[22800,36.857201,117.216003],TAO:[22900,36.361953,120.088171],HAK:[23e3,19.9349,110.459],FUO:[23100,23.0833,113.07],ZGN:[23200,23.392401,113.299004],CAN:[23300,23.392401,113.299004],SZX:[23400,22.639299,113.810997],MDL:[23500,21.702199935913086,95.97789764404297],RGN:[23600,16.907300949099998,96.1332015991],CNX:[23700,18.766799926799997,98.962600708],BKK:[23800,13.681099891662598,100.74700164794922],URT:[23900,9.13259983063,99.135597229],KUL:[24e3,2.74558,101.709999],JHB:[24100,1.64131,103.669998],QPG:[24200,1.36042,103.910004],SIN:[24300,1.35019,103.994003],CGK:[24400,-6.1255698204,106.65599823],JOG:[24500,-7.78818,110.431999],DPS:[24600,-8.74817,115.167],DEX:[24700,-4.8557,139.482006],PER:[24800,-31.94029998779297,115.96700286865234],ADL:[24900,-34.947512,138.533393],MEL:[25e3,-37.673302,144.843002],HBA:[25100,-42.836101532,147.509994507],CBR:[25200,-35.3069,149.195007],SYD:[25300,-33.94609832763672,151.177001953125],BNE:[25400,-27.384199142456055,153.11700439453125],CHC:[25500,-43.48939895629883,172.53199768066406],WLG:[25600,-41.3272018433,174.804992676],AKL:[25700,-37.01199,174.786331],NOU:[25800,-22.014601,166.212997],SUV:[25900,-18.04330062866211,178.5590057373047],PPT:[26e3,-17.553699,-149.606995],GDL:[26100,20.52504,-103.301557],QRO:[26200,20.6173,-100.185997],MEX:[26300,19.435433,-99.082432],GUA:[26400,14.5833,-90.527496],TGU:[26500,14.0609,-87.217201],SJO:[26600,9.99386,-84.208801],PTY:[26700,9.0713596344,-79.3834991455],MDE:[26800,6.16454,-75.4231],BOG:[26900,4.70159,-74.1469],UIO:[27e3,-.125399,-78.354306],GYE:[27100,-2.15742,-79.883598],LIM:[27200,-12.0219,-77.114305],ARI:[27300,-18.348499,-70.338699],SCL:[27400,-33.393001556396484,-70.78579711914062],COR:[27500,-31.323601,-64.208],NQN:[27600,-38.949001,-68.155701],EZE:[27700,-34.8222,-58.5358],ASU:[27800,-25.240156,-57.519227],CGB:[27900,-15.6529,-56.116699],GYN:[28e3,-16.632,-49.220699],BSB:[28100,-15.869167,-47.920834],UDI:[28200,-18.883579,-48.225936],SJP:[28300,-20.817113,-49.406963],RAO:[28400,-21.134314,-47.774053],VCP:[28500,-23.007404,-47.134502],SOD:[28600,-23.478001,-47.490002],GRU:[28700,-23.431944,-46.467778],QWJ:[28800,-23.431944,-46.467778],SJK:[28900,-23.2292,-45.8615],GIG:[29e3,-22.809999,-43.250557],CNF:[29100,-19.63571,-43.966928],CAW:[29200,-21.698299,-41.301701],VIX:[29300,-20.258,-40.285],SSA:[29400,-12.908611,-38.322498],REC:[29500,-8.125984,-34.923316],JDO:[29600,-7.21932,-39.269096],FOR:[29700,-3.775833,-38.532222],BEL:[29800,-1.379279,-48.476207],MAO:[29900,-3.03861,-60.049702],POA:[3e4,-29.994712,-51.166592],FLN:[30100,-27.670279,-48.552502],ITJ:[30200,-26.879431,-48.650979],NVT:[30300,-26.879431,-48.650979],BNU:[30400,-26.831661,-49.093569],JOI:[30500,-26.224501,-48.797401],CWB:[30600,-25.5285,-49.1758],CFC:[30700,-26.787423,-50.939942],XAP:[30800,-27.134199,-52.656601],PBM:[30900,5.45283,-55.187801],GEO:[31e3,6.49855,-58.254101],BGI:[31100,13.0746,-59.4925],GND:[31200,12.0042,-61.786201],CUR:[31300,12.1889,-68.959801],SDQ:[31400,18.42970085144,-69.668899536133],STI:[31500,19.406099319458008,-70.60469818115234],KIN:[31600,17.935699462890625,-76.7874984741211],MIA:[31700,25.79319953918457,-80.29060363769531],TPA:[31800,27.975500106811523,-82.533203125],GNV:[31900,29.6900997162,-82.2717971802],JAX:[32e3,30.49410057067871,-81.68789672851562],TLH:[32100,30.3965,-84.350304],MGM:[32200,32.300598,-86.393997],ATL:[32300,33.6367,-84.428101],PDK:[32400,33.8755989075,-84.3020019531],BNA:[32500,36.1245002746582,-86.6781997680664],MEM:[32600,35.04240036010742,-89.97669982910156],STL:[32700,38.748697,-90.370003],IND:[32800,39.7173,-86.294403],CHI:[32900,41.9786,-87.9048],ORD:[33e3,41.9786,-87.9048],DTW:[33100,42.212398529052734,-83.35340118408203],CLE:[33200,41.411701,-81.8498],PIT:[33300,40.49150085,-80.23290253],CMH:[33400,39.998001,-82.891899],LCK:[33500,39.813801,-82.927803],CLT:[33600,35.2140007019043,-80.94309997558594],RDU:[33700,35.877602,-78.787498],ORF:[33800,36.8946,-76.201202],RIC:[33900,37.50519943237305,-77.3197021484375],IAD:[34e3,38.9445,-77.455803],DCA:[34100,38.8521,-77.037697],PHL:[34200,39.87189865112305,-75.24109649658203],NYC:[34300,40.639447,-73.779317]},Rk=new Ta("fetchAirportCodeFromCdn"),Pk=async(e,t,r)=>(await Va(fetch(e,{method:"HEAD"}),r)).headers.get(t),Ik=new Ta("getLocalRegion");let Ck,_k;const Tk=async()=>{let e;return e=await(async()=>{let e;try{e=await(async()=>{try{return await(async()=>{const e=await Pk("https://d47ahk2wrqweh.cloudfront.net/cdn-location","X-Amz-Cf-Pop",2e3);if(!e||e.length<3)throw new Error("Could not get airport code from Amazon");return e.substring(0,3)})()}catch(e){Rk.warn(e)}try{return await(async()=>{const e=await Pk("https://www.fastly.com","X-Served-By",2e3);if(!e||e.length<3)throw new Error("Could not get airport code from Fastly");return e.substring(e.length-3)})()}catch(e){Rk.warn(e)}try{return await(async()=>{const e=await Pk("https://www.cloudflare.com","CF-RAY",2e3);if(!e||e.length<3)throw new Error("Could not get airport code from Cloudflare");return e.substring(e.length-3)})()}catch(e){Rk.warn(e)}throw new Error("Could not get airport code from any CDN")})()}catch{return}return e})(),void 0!==e&&kk[e]?kk[e][0]:(()=>{const e=Object.keys(kk),t=e[Math.floor(Math.random()*e.length)],r=kk[t][0]+99;return Ik.warn(`Could not get airport code, using random region: ${r}`),r})()};r(5731);const Nk=(e,t)=>nA().distance(e,t),xk=e=>fo(e),Ok=e=>po(e),Dk=e=>xk(e.nodeId),Mk=(e,t)=>go(e.nodeId,t.nodeId),Bk=()=>xk(Er(20));class Lk extends zr{options;contactsById=new Map;contactIds=[];constructor(e){super(),this.options=e,this.compareIds=this.compareIds.bind(this)}getClosestContactId(){return this.contactIds[0]}getContactIds(){return this.contactIds}addContact(e){const t=e.getNodeId();if(!this.options.excludedNodeIds?.has(t)&&!(!this.options.allowToContainReferenceId&&this.options.referenceId===t||void 0!==this.options.nodeIdDistanceLimit&&this.compareIds(this.options.nodeIdDistanceLimit,t)<0||this.contactsById.has(t)))if(void 0===this.options.maxSize||this.contactIds.length<this.options.maxSize){this.contactsById.set(t,e);const r=tA()(this.contactIds,t,e=>this.distanceToReferenceId(e));this.contactIds.splice(r,0,t),this.hasEventListeners()&&this.emit("contactAdded",e)}else if(this.compareIds(this.contactIds[this.options.maxSize-1],t)>0){const r=this.contactIds.pop(),n=this.contactsById.get(r);this.contactsById.delete(r),this.contactsById.set(t,e);const i=tA()(this.contactIds,t,e=>this.distanceToReferenceId(e));this.contactIds.splice(i,0,t),this.hasEventListeners()&&(this.emit("contactRemoved",n),this.emit("contactAdded",e))}}addContacts(e){e.forEach(e=>this.addContact(e))}getContact(e){return this.contactsById.get(e)}has(e){return this.contactsById.has(e)}getClosestContacts(e){return(void 0===e?this.contactIds:this.contactIds.slice(0,Math.max(e,0))).map(e=>this.contactsById.get(e))}getFurthestContacts(e){const t=[...this.getClosestContacts()].reverse();return void 0===e?t:t.slice(0,Math.max(e,0))}compareIds(e,t){return this.distanceToReferenceId(e)-this.distanceToReferenceId(t)}distanceToReferenceId(e){return Nk(Ok(this.options.referenceId),Ok(e))}removeContact(e){if(this.contactsById.has(e)){const t=this.contactsById.get(e),r=this.contactIds.findIndex(t=>t===e);return this.contactIds.splice(r,1),this.contactsById.delete(e),this.hasEventListeners()&&this.emit("contactRemoved",t),!0}return!1}getAllContactsInUndefinedOrder(){return this.contactsById.values()}getSize(e){let t=0;if(void 0!==e)for(const r of e)this.has(r)&&t++;return this.contactIds.length-t}clear(){this.contactsById.clear(),this.contactIds=[]}stop(){this.removeAllListeners(),this.clear()}hasEventListeners(){return this.eventNames().length>0}}class Fk{values=new Set;queue=[];maxItemCount;constructor(e){this.maxItemCount=e}add(e){if(this.values.add(e),this.queue.push(e),this.queue.length>this.maxItemCount){const e=this.queue.shift();this.values.delete(e)}}isMostLikelyDuplicate(e){return this.values.has(e)}size(){return this.values.size}clear(){this.values.clear(),this.queue=[]}}var Uk;!function(e){e.CONNECTION_FAILED="CONNECTION_FAILED",e.COULD_NOT_ROUTE="COULD_NOT_ROUTE",e.STARTING_WEBSOCKET_SERVER_FAILED="STARTING_WEBSOCKET_SERVER_FAILED",e.WEBSOCKET_CONNECTION_REQUEST_REJECTED="WEBSOCKET_CONNECTION_REQUEST_REJECTED",e.COULD_NOT_START="COULD_NOT_START",e.COULD_NOT_STOP="COULD_NOT_STOP",e.CANNOT_CONNECT_TO_SELF="CANNOT_CONNECT_TO_SELF",e.NOT_IMPLEMENTED="NOT_IMPLEMENTED",e.ILLEGAL_RTC_PEER_CONNECTION_STATE="ILLEGAL_RTC_PEER_CONNECTION_STATE",e.ILLEGAL_ARGUMENTS="ILLEGAL_ARGUMENTS",e.CONNECTIVITY_RESPONSE_NOT_RECEIVED_BEFORE_TIMEOUT="CONNECTIVITY_RESPONSE_NOT_RECEIVED_BEFORE_TIMEOUT",e.CONNECTION_LOCKER="CONNECTION_LOCKER",e.DHT_JOIN_TIMEOUT="DHT_JOIN_TIMEOUT",e.SEND_FAILED="SEND_FAILED",e.GETTING_DATA_FAILED="GETTING_DATA_FAILED",e.CONNECTION_NOT_OPEN="CONNECTION_NOT_OPEN"}(Uk||(Uk={}));class jk extends Error{code;originalError;constructor(e,t,r){super(t),this.code=e,this.originalError=r}}class zk extends jk{constructor(e,t){super(Uk.CONNECTION_FAILED,e,t)}}class qk extends jk{constructor(e,t){super(Uk.STARTING_WEBSOCKET_SERVER_FAILED,e,t)}}class Kk extends jk{constructor(e,t){super(Uk.COULD_NOT_START,e,t)}}class Gk extends jk{constructor(e,t){super(Uk.CANNOT_CONNECT_TO_SELF,e,t)}}class $k extends jk{constructor(e,t){super(Uk.CONNECTIVITY_RESPONSE_NOT_RECEIVED_BEFORE_TIMEOUT,e,t)}}class Vk extends jk{constructor(e,t){super(Uk.SEND_FAILED,e,t)}}const Hk=new class extends sS{constructor(){super("google.protobuf.Empty",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();{let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}},Wk=new class extends sS{constructor(){super("google.protobuf.Any",[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}])}pack(e,t){return{typeUrl:this.typeNameToUrl(t.typeName),value:t.toBinary(e)}}unpack(e,t,r){if(!this.contains(e,t))throw new Error("Cannot unpack google.protobuf.Any with typeUrl '"+e.typeUrl+"' as "+t.typeName+".");return t.fromBinary(e.value,r)}contains(e,t){return!!e.typeUrl.length&&("string"==typeof t?t:t.typeName)===this.typeUrlToName(e.typeUrl)}internalJsonWrite(e,t){if(""===e.typeUrl)return{};let r=this.typeUrlToName(e.typeUrl),n=HA(t),i=n.typeRegistry?.find(e=>e.typeName===r);if(!i)throw new globalThis.Error("Unable to convert google.protobuf.Any with typeUrl '"+e.typeUrl+"' to JSON. The specified type "+r+" is not available in the type registry.");let s=i.fromBinary(e.value,{readUnknownField:!1}),o=i.internalJsonWrite(s,n);return!r.startsWith("google.protobuf.")&&fA(o)||(o={value:o}),o["@type"]=e.typeUrl,o}internalJsonRead(e,t,r){if(!fA(e))throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON "+hA(e)+".");if("string"!=typeof e["@type"]||""==e["@type"])return this.create();let n,i=this.typeUrlToName(e["@type"]),s=t?.typeRegistry?.find(e=>e.typeName==i);if(!s)throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON. The specified type "+i+" is not available in the type registry.");if(i.startsWith("google.protobuf.")&&e.hasOwnProperty("value"))n=s.fromJson(e.value,t);else{let r=Object.assign({},e);delete r["@type"],n=s.fromJson(r,t)}return void 0===r&&(r=this.create()),r.typeUrl=e["@type"],r.value=s.toBinary(n),r}typeNameToUrl(e){if(!e.length)throw new Error("invalid type name: "+e);return"type.googleapis.com/"+e}typeUrlToName(e){if(!e.length)throw new Error("invalid type url: "+e);let t=e.lastIndexOf("/"),r=t>0?e.substring(t+1):e;if(!r.length)throw new Error("invalid type url: "+e);return r}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.typeUrl="",t.value=new Uint8Array(0),void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();switch(t){case 1:i.typeUrl=e.string();break;case 2:i.value=e.bytes();break;default:let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){""!==e.typeUrl&&t.tag(1,UA.LengthDelimited).string(e.typeUrl),e.value.length&&t.tag(2,UA.LengthDelimited).bytes(e.value);let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}};var Jk;!function(e){e[e.SERVER_TIMEOUT=0]="SERVER_TIMEOUT",e[e.CLIENT_TIMEOUT=1]="CLIENT_TIMEOUT",e[e.UNKNOWN_RPC_METHOD=2]="UNKNOWN_RPC_METHOD",e[e.CLIENT_ERROR=3]="CLIENT_ERROR",e[e.SERVER_ERROR=4]="SERVER_ERROR"}(Jk||(Jk={}));const Zk=new class extends sS{constructor(){super("protorpc.RpcMessage",[{no:1,name:"header",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:2,name:"body",kind:"message",T:()=>Wk},{no:3,name:"requestId",kind:"scalar",T:9},{no:4,name:"errorType",kind:"enum",opt:!0,T:()=>["protorpc.RpcErrorType",Jk]},{no:5,name:"errorClassName",kind:"scalar",opt:!0,T:9},{no:6,name:"errorCode",kind:"scalar",opt:!0,T:9},{no:7,name:"errorMessage",kind:"scalar",opt:!0,T:9}])}};new class extends sS{constructor(){super("protorpc.Mnfo2uhnf92hvqi2nviouq2hv9puhq",[{no:1,name:"empty",kind:"message",T:()=>Hk}])}};const Qk=new class extends sS{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3,L:2},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const e=this.create(),t=Date.now();return e.seconds=TA.from(Math.floor(t/1e3)).toNumber(),e.nanos=t%1e3*1e6,e}toDate(e){return new Date(1e3*TA.from(e.seconds).toNumber()+Math.ceil(e.nanos/1e6))}fromDate(e){const t=this.create(),r=e.getTime();return t.seconds=TA.from(Math.floor(r/1e3)).toNumber(),t.nanos=1e6*(r%1e3+(r<0&&r%1e3!=0?1e3:0)),t}internalJsonWrite(e,t){let r=1e3*TA.from(e.seconds).toNumber();if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let n="Z";if(e.nanos>0){let t=(e.nanos+1e9).toString().substring(1);n="000000"===t.substring(3)?"."+t.substring(0,3)+"Z":"000"===t.substring(6)?"."+t.substring(0,6)+"Z":"."+t+"Z"}return new Date(r).toISOString().replace(".000Z",n)}internalJsonRead(e,t,r){if("string"!=typeof e)throw new Error("Unable to parse Timestamp from JSON "+hA(e)+".");let n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return r||(r=this.create()),r.seconds=TA.from(i/1e3).toNumber(),r.nanos=0,n[7]&&(r.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),r}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.seconds=0,t.nanos=0,void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();switch(t){case 1:i.seconds=e.int64().toNumber();break;case 2:i.nanos=e.int32();break;default:let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){0!==e.seconds&&t.tag(1,UA.Varint).int64(e.seconds),0!==e.nanos&&t.tag(2,UA.Varint).int32(e.nanos);let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}};var Yk,Xk,eR,tR,rR,nR;!function(e){e[e.FIND_CLOSEST_NODES=0]="FIND_CLOSEST_NODES",e[e.FETCH_DATA=1]="FETCH_DATA",e[e.DELETE_DATA=2]="DELETE_DATA"}(Yk||(Yk={})),function(e){e[e.NODEJS=0]="NODEJS",e[e.BROWSER=1]="BROWSER"}(Xk||(Xk={})),function(e){e[e.SERVER_TIMOUT=0]="SERVER_TIMOUT",e[e.CLIENT_TIMEOUT=1]="CLIENT_TIMEOUT",e[e.SERVER_ERROR=2]="SERVER_ERROR",e[e.UNKNOWN_RPC_METHOD=3]="UNKNOWN_RPC_METHOD"}(eR||(eR={})),function(e){e[e.NO_TARGETS=0]="NO_TARGETS",e[e.DUPLICATE=1]="DUPLICATE",e[e.STOPPED=2]="STOPPED"}(tR||(tR={})),function(e){e[e.DUPLICATE_CONNECTION=0]="DUPLICATE_CONNECTION",e[e.INVALID_TARGET_PEER_DESCRIPTOR=1]="INVALID_TARGET_PEER_DESCRIPTOR",e[e.UNSUPPORTED_PROTOCOL_VERSION=2]="UNSUPPORTED_PROTOCOL_VERSION"}(rR||(rR={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.LEAVING=1]="LEAVING"}(nR||(nR={}));const iR=new class extends sS{constructor(){super("dht.StoreDataRequest",[{no:1,name:"key",kind:"scalar",T:12},{no:2,name:"data",kind:"message",T:()=>Wk},{no:3,name:"creator",kind:"scalar",T:12},{no:4,name:"createdAt",kind:"message",T:()=>Qk},{no:5,name:"ttl",kind:"scalar",T:13}])}},sR=new class extends sS{constructor(){super("dht.StoreDataResponse",[])}},oR=new class extends sS{constructor(){super("dht.ExternalStoreDataRequest",[{no:1,name:"key",kind:"scalar",T:12},{no:2,name:"data",kind:"message",T:()=>Wk}])}},aR=new class extends sS{constructor(){super("dht.ExternalStoreDataResponse",[{no:1,name:"storers",kind:"message",repeat:2,T:()=>wR}])}},cR=new class extends sS{constructor(){super("dht.ReplicateDataRequest",[{no:1,name:"entry",kind:"message",T:()=>uR}])}},uR=new class extends sS{constructor(){super("dht.DataEntry",[{no:1,name:"key",kind:"scalar",T:12},{no:2,name:"data",kind:"message",T:()=>Wk},{no:3,name:"creator",kind:"scalar",T:12},{no:4,name:"createdAt",kind:"message",T:()=>Qk},{no:5,name:"storedAt",kind:"message",T:()=>Qk},{no:6,name:"ttl",kind:"scalar",T:13},{no:7,name:"stale",kind:"scalar",T:8},{no:8,name:"deleted",kind:"scalar",T:8}])}},lR=new class extends sS{constructor(){super("dht.ClosestPeersRequest",[{no:1,name:"nodeId",kind:"scalar",T:12},{no:2,name:"requestId",kind:"scalar",T:9}])}},dR=new class extends sS{constructor(){super("dht.ClosestPeersResponse",[{no:1,name:"peers",kind:"message",repeat:2,T:()=>wR},{no:2,name:"requestId",kind:"scalar",T:9}])}},hR=new class extends sS{constructor(){super("dht.ClosestRingPeersRequest",[{no:1,name:"ringId",kind:"scalar",T:12},{no:2,name:"requestId",kind:"scalar",T:9}])}},fR=new class extends sS{constructor(){super("dht.ClosestRingPeersResponse",[{no:1,name:"leftPeers",kind:"message",repeat:2,T:()=>wR},{no:2,name:"rightPeers",kind:"message",repeat:2,T:()=>wR},{no:3,name:"requestId",kind:"scalar",T:9}])}},pR=new class extends sS{constructor(){super("dht.RecursiveOperationRequest",[{no:1,name:"sessionId",kind:"scalar",T:9},{no:2,name:"operation",kind:"enum",T:()=>["dht.RecursiveOperation",Yk]}])}},gR=new class extends sS{constructor(){super("dht.RecursiveOperationResponse",[{no:1,name:"closestConnectedNodes",kind:"message",repeat:2,T:()=>wR},{no:2,name:"dataEntries",kind:"message",repeat:2,T:()=>uR},{no:3,name:"noCloserNodesFound",kind:"scalar",T:8},{no:4,name:"routingPath",kind:"message",repeat:2,T:()=>wR}])}},mR=new class extends sS{constructor(){super("dht.PingRequest",[{no:1,name:"requestId",kind:"scalar",T:9}])}},yR=new class extends sS{constructor(){super("dht.PingResponse",[{no:1,name:"requestId",kind:"scalar",T:9}])}},bR=new class extends sS{constructor(){super("dht.LeaveNotice",[])}},wR=new class extends sS{constructor(){super("dht.PeerDescriptor",[{no:1,name:"nodeId",kind:"scalar",T:12},{no:2,name:"type",kind:"enum",T:()=>["dht.NodeType",Xk]},{no:3,name:"udp",kind:"message",T:()=>vR},{no:4,name:"tcp",kind:"message",T:()=>vR},{no:5,name:"websocket",kind:"message",T:()=>vR},{no:6,name:"region",kind:"scalar",opt:!0,T:13},{no:7,name:"ipAddress",kind:"scalar",opt:!0,T:13},{no:8,name:"publicKey",kind:"scalar",opt:!0,T:12},{no:9,name:"signature",kind:"scalar",opt:!0,T:12}])}},vR=new class extends sS{constructor(){super("dht.ConnectivityMethod",[{no:1,name:"port",kind:"scalar",T:13},{no:2,name:"host",kind:"scalar",T:9},{no:3,name:"tls",kind:"scalar",T:8}])}},ER=new class extends sS{constructor(){super("dht.RouteMessageWrapper",[{no:1,name:"requestId",kind:"scalar",T:9},{no:2,name:"sourcePeer",kind:"message",T:()=>wR},{no:3,name:"target",kind:"scalar",T:12},{no:4,name:"message",kind:"message",T:()=>IR},{no:5,name:"reachableThrough",kind:"message",repeat:2,T:()=>wR},{no:6,name:"routingPath",kind:"message",repeat:2,T:()=>wR},{no:7,name:"parallelRootNodeIds",kind:"scalar",repeat:2,T:9}])}},AR=new class extends sS{constructor(){super("dht.RouteMessageAck",[{no:1,name:"requestId",kind:"scalar",T:9},{no:2,name:"error",kind:"enum",opt:!0,T:()=>["dht.RouteMessageError",tR]}])}},SR=new class extends sS{constructor(){super("dht.ConnectivityRequest",[{no:1,name:"port",kind:"scalar",T:13},{no:2,name:"tls",kind:"scalar",T:8},{no:3,name:"host",kind:"scalar",opt:!0,T:9},{no:4,name:"allowSelfSignedCertificate",kind:"scalar",T:8}])}},kR=new class extends sS{constructor(){super("dht.ConnectivityResponse",[{no:1,name:"host",kind:"scalar",T:9},{no:2,name:"natType",kind:"scalar",T:9},{no:3,name:"websocket",kind:"message",T:()=>vR},{no:4,name:"ipAddress",kind:"scalar",T:13},{no:5,name:"protocolVersion",kind:"scalar",T:9},{no:6,name:"latitude",kind:"scalar",opt:!0,T:1},{no:7,name:"longitude",kind:"scalar",opt:!0,T:1}])}},RR=new class extends sS{constructor(){super("dht.HandshakeRequest",[{no:1,name:"sourcePeerDescriptor",kind:"message",T:()=>wR},{no:2,name:"targetPeerDescriptor",kind:"message",T:()=>wR},{no:3,name:"protocolVersion",kind:"scalar",T:9},{no:4,name:"applicationVersion",kind:"scalar",T:9}])}},PR=new class extends sS{constructor(){super("dht.HandshakeResponse",[{no:1,name:"sourcePeerDescriptor",kind:"message",T:()=>wR},{no:2,name:"error",kind:"enum",opt:!0,T:()=>["dht.HandshakeError",rR]},{no:3,name:"protocolVersion",kind:"scalar",T:9},{no:4,name:"applicationVersion",kind:"scalar",T:9}])}},IR=new class extends sS{constructor(){super("dht.Message",[{no:1,name:"messageId",kind:"scalar",T:9},{no:2,name:"sourceDescriptor",kind:"message",T:()=>wR},{no:3,name:"targetDescriptor",kind:"message",T:()=>wR},{no:4,name:"serviceId",kind:"scalar",T:9},{no:5,name:"rpcMessage",kind:"message",oneof:"body",T:()=>Zk},{no:6,name:"connectivityRequest",kind:"message",oneof:"body",T:()=>SR},{no:7,name:"connectivityResponse",kind:"message",oneof:"body",T:()=>kR},{no:8,name:"handshakeRequest",kind:"message",oneof:"body",T:()=>RR},{no:9,name:"handshakeResponse",kind:"message",oneof:"body",T:()=>PR},{no:10,name:"recursiveOperationRequest",kind:"message",oneof:"body",T:()=>pR}])}},CR=new class extends sS{constructor(){super("dht.WebsocketConnectionRequest",[])}},_R=new class extends sS{constructor(){super("dht.WebrtcConnectionRequest",[])}},TR=new class extends sS{constructor(){super("dht.RtcOffer",[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"connectionId",kind:"scalar",T:9}])}},NR=new class extends sS{constructor(){super("dht.RtcAnswer",[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"connectionId",kind:"scalar",T:9}])}},xR=new class extends sS{constructor(){super("dht.IceCandidate",[{no:1,name:"candidate",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"connectionId",kind:"scalar",T:9}])}},OR=new class extends sS{constructor(){super("dht.LockRequest",[{no:1,name:"lockId",kind:"scalar",T:9}])}},DR=new class extends sS{constructor(){super("dht.UnlockRequest",[{no:1,name:"lockId",kind:"scalar",T:9}])}},MR=new class extends sS{constructor(){super("dht.LockResponse",[{no:1,name:"accepted",kind:"scalar",T:8}])}},BR=new class extends sS{constructor(){super("dht.DisconnectNotice",[{no:1,name:"disconnectMode",kind:"enum",T:()=>["dht.DisconnectMode",nR]}])}},LR=new class extends sS{constructor(){super("dht.SetPrivateRequest",[{no:1,name:"isPrivate",kind:"scalar",T:8}])}},FR=new class extends sS{constructor(){super("dht.ExternalFetchDataRequest",[{no:1,name:"key",kind:"scalar",T:12}])}},UR=new class extends sS{constructor(){super("dht.ExternalFetchDataResponse",[{no:1,name:"entries",kind:"message",repeat:2,T:()=>uR}])}},jR=new class extends sS{constructor(){super("dht.ExternalFindClosestNodesRequest",[{no:1,name:"nodeId",kind:"scalar",T:12}])}},zR=new class extends sS{constructor(){super("dht.ExternalFindClosestNodesResponse",[{no:1,name:"closestNodes",kind:"message",repeat:2,T:()=>wR}])}},qR=new oS("dht.DhtNodeRpc",[{name:"getClosestPeers",options:{},I:lR,O:dR},{name:"getClosestRingPeers",options:{},I:hR,O:fR},{name:"ping",options:{},I:mR,O:yR},{name:"leaveNotice",options:{},I:bR,O:Hk}]),KR=new oS("dht.RouterRpc",[{name:"routeMessage",options:{},I:ER,O:AR},{name:"forwardMessage",options:{},I:ER,O:AR}]),GR=new oS("dht.RecursiveOperationRpc",[{name:"routeRequest",options:{},I:ER,O:AR}]),$R=new oS("dht.StoreRpc",[{name:"storeData",options:{},I:iR,O:sR},{name:"replicateData",options:{},I:cR,O:Hk}]),VR=new oS("dht.RecursiveOperationSessionRpc",[{name:"sendResponse",options:{},I:gR,O:Hk}]),HR=new oS("dht.WebsocketClientConnectorRpc",[{name:"requestConnection",options:{},I:CR,O:Hk}]),WR=new oS("dht.WebrtcConnectorRpc",[{name:"requestConnection",options:{},I:_R,O:Hk},{name:"rtcOffer",options:{},I:TR,O:Hk},{name:"rtcAnswer",options:{},I:NR,O:Hk},{name:"iceCandidate",options:{},I:xR,O:Hk}]),JR=new oS("dht.ConnectionLockRpc",[{name:"lockRequest",options:{},I:OR,O:MR},{name:"unlockRequest",options:{},I:DR,O:Hk},{name:"gracefulDisconnect",options:{},I:BR,O:Hk},{name:"setPrivate",options:{},I:LR,O:Hk}]),ZR=new oS("dht.ExternalApiRpc",[{name:"externalFetchData",options:{},I:FR,O:UR},{name:"externalStoreData",options:{},I:oR,O:aR},{name:"externalFindClosestNodes",options:{},I:jR,O:zR}]);class QR{_transport;typeName=qR.typeName;methods=qR.methods;options=qR.options;constructor(e){this._transport=e}getClosestPeers(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}getClosestRingPeers(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}ping(e,t){const r=this.methods[2],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}leaveNotice(e,t){const r=this.methods[3],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class YR{_transport;typeName=KR.typeName;methods=KR.methods;options=KR.options;constructor(e){this._transport=e}routeMessage(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}forwardMessage(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class XR{_transport;typeName=GR.typeName;methods=GR.methods;options=GR.options;constructor(e){this._transport=e}routeRequest(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class eP{_transport;typeName=$R.typeName;methods=$R.methods;options=$R.options;constructor(e){this._transport=e}storeData(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}replicateData(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class tP{_transport;typeName=VR.typeName;methods=VR.methods;options=VR.options;constructor(e){this._transport=e}sendResponse(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class rP{_transport;typeName=HR.typeName;methods=HR.methods;options=HR.options;constructor(e){this._transport=e}requestConnection(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class nP{_transport;typeName=WR.typeName;methods=WR.methods;options=WR.options;constructor(e){this._transport=e}requestConnection(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}rtcOffer(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}rtcAnswer(e,t){const r=this.methods[2],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}iceCandidate(e,t){const r=this.methods[3],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class iP{_transport;typeName=JR.typeName;methods=JR.methods;options=JR.options;constructor(e){this._transport=e}lockRequest(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}unlockRequest(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}gracefulDisconnect(e,t){const r=this.methods[2],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}setPrivate(e,t){const r=this.methods[3],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class sP{_transport;typeName=ZR.typeName;methods=ZR.methods;options=ZR.options;constructor(e){this._transport=e}externalFetchData(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}externalStoreData(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}externalFindClosestNodes(e,t){const r=this.methods[2],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}const oP={connect:!0,sendIfStopped:!1,bufferWhileConnecting:!0};class aP extends DS{targetDescriptor;sourceDescriptor;clientId;connect;sendIfStopped;bufferWhileConnecting;incomingSourceDescriptor}class cP extends KS{ownServiceId;constructor(e,t,r){super(r),this.ownServiceId=e,this.setOutgoingMessageListener((e,r,n)=>{let i;i=n.targetDescriptor?n.targetDescriptor:n.incomingSourceDescriptor;const s={messageId:hS(),serviceId:this.ownServiceId,body:{oneofKind:"rpcMessage",rpcMessage:e},targetDescriptor:i},o=void 0!==e.header.response?{connect:!1,sendIfStopped:!0,bufferWhileConnecting:!0}:{connect:n?.connect??oP.connect,sendIfStopped:n?.sendIfStopped??oP.sendIfStopped,bufferWhileConnecting:n?.bufferWhileConnecting??oP.bufferWhileConnecting};return t(s,o)})}handleMessageFromPeer(e){if(e.serviceId===this.ownServiceId&&"rpcMessage"===e.body.oneofKind){const t=new aP;t.incomingSourceDescriptor=e.sourceDescriptor,this.handleIncomingMessage(e.body.rpcMessage,t)}}}class uP{localLocks=new Map;remoteLocks=new Map;weakLocks=new Map;remotePrivateConnections=new Set;getLocalLockedConnectionCount(){return this.localLocks.size}getRemoteLockedConnectionCount(){return this.remoteLocks.size}getWeakLockedConnectionCount(){return this.weakLocks.size}isLocalLocked(e,t){return void 0===t?this.localLocks.has(e):this.localLocks.has(e)&&this.localLocks.get(e).has(t)}isRemoteLocked(e,t){return void 0===t?this.remoteLocks.has(e):!(!this.remoteLocks.has(e)||!this.remoteLocks.get(e).has(t))}isWeakLocked(e){return this.weakLocks.has(e)}isLocked(e){return this.isLocalLocked(e)||this.isRemoteLocked(e)||this.isWeakLocked(e)}addLocalLocked(e,t){this.localLocks.has(e)||this.localLocks.set(e,new Set),this.localLocks.get(e).add(t)}addRemoteLocked(e,t){this.remoteLocks.has(e)||this.remoteLocks.set(e,new Set),this.remoteLocks.get(e).add(t)}addWeakLocked(e,t){this.weakLocks.has(e)||this.weakLocks.set(e,new Set),this.weakLocks.get(e).add(t)}removeLocalLocked(e,t){this.localLocks.has(e)&&(this.localLocks.get(e)?.delete(t),0===this.localLocks.get(e)?.size&&this.localLocks.delete(e))}removeRemoteLocked(e,t){this.remoteLocks.has(e)&&(this.remoteLocks.get(e)?.delete(t),0===this.remoteLocks.get(e)?.size&&this.remoteLocks.delete(e))}removeWeakLocked(e,t){this.weakLocks.has(e)&&(this.weakLocks.get(e)?.delete(t),0===this.weakLocks.get(e)?.size&&this.weakLocks.delete(e))}addPrivate(e){this.remotePrivateConnections.add(e)}removePrivate(e){this.remotePrivateConnections.delete(e)}getPrivateConnections(){return this.remotePrivateConnections}isPrivate(e){return this.remotePrivateConnections.has(e)}clearAllLocks(e){this.localLocks.delete(e),this.remoteLocks.delete(e),this.weakLocks.delete(e)}clear(){this.localLocks.clear(),this.remoteLocks.clear(),this.weakLocks.clear()}}const lP=e=>void 0!==e?Dk(e):"unknown",dP=()=>hS(),hP=new Ta("ManagedConnection");class fP extends zr{connection;connectionId;remotePeerDescriptor;lastUsedTimestamp=Date.now();replacedAsDuplicate=!1;stopped=!1;openedAt=Date.now();bytesSent=0;bytesReceived=0;messagesSent=0;messagesReceived=0;constructor(e,t){super(),this.connectionId=dP(),this.connection=t,t.on("data",e=>{this.lastUsedTimestamp=Date.now(),this.messagesReceived+=1,this.bytesReceived+=e.length,this.emit("managedData",e,this.getPeerDescriptor())}),t.on("disconnected",e=>this.onDisconnected(e)),this.lastUsedTimestamp=Date.now(),this.remotePeerDescriptor=e}onDisconnected(e){hP.trace(lP(this.remotePeerDescriptor)+" onDisconnected() "+e),this.replacedAsDuplicate||this.emit("disconnected",e),this.removeAllListeners()}replaceAsDuplicate(){hP.trace(lP(this.remotePeerDescriptor)+" replaceAsDuplicate"),this.replacedAsDuplicate=!0}send(e){if(this.stopped)throw new Vk("ManagedConnection is stopped");this.lastUsedTimestamp=Date.now(),this.messagesSent+=1,this.bytesSent+=e.length,this.connection.send(e)}async close(e){this.stopped||(await this.connection.close(e),this.removeAllListeners())}getNodeId(){return Dk(this.remotePeerDescriptor)}getLastUsedTimestamp(){return this.lastUsedTimestamp}getPeerDescriptor(){return this.remotePeerDescriptor}getDiagnosticInfo(){return{remotePeerDescriptor:this.remotePeerDescriptor,lastUsedTimestamp:this.lastUsedTimestamp,replacedAsDuplicate:this.replacedAsDuplicate,stopped:this.stopped,openedAt:this.openedAt,bytesSent:this.bytesSent,bytesReceived:this.bytesReceived,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived}}}var pP;!function(e){e.WEBSOCKET_SERVER="websocket-server",e.WEBSOCKET_CLIENT="websocket-client",e.WEBRTC="webrtc",e.SIMULATOR_SERVER="simulator-server",e.SIMULATOR_CLIENT="simulator-client"}(pP||(pP={}));const gP=["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","127.0.0.0/8"].map(e=>HS().parseCIDR(e));function mP(e){if(HS().IPv4.isValid(e)){const t=HS().IPv4.parse(e);for(const e of gP)if(t.match(e))return!0}return!1}const yP=e=>{const t="localhost"===e.host||mP(e.host);return e.tls||t},bP=(e,t)=>t.websocket&&(e.type!==Xk.BROWSER||yP(t.websocket))?pP.WEBSOCKET_CLIENT:e.websocket&&(t.type!==Xk.BROWSER||yP(e.websocket))?pP.WEBSOCKET_SERVER:pP.WEBRTC,wP=5e3,vP=(e,t)=>{const r=bP(e,t);return r===pP.WEBSOCKET_CLIENT?5e3:r===pP.WEBSOCKET_SERVER?7500:(pP.WEBRTC,1e4)};class EP{localPeerDescriptor;remotePeerDescriptor;client;timeout;constructor(e,t,r,n,i){this.localPeerDescriptor=e,this.remotePeerDescriptor=t,this.client=GS(new n(r.getRpcClientTransport())),this.timeout=i}getPeerDescriptor(){return this.remotePeerDescriptor}getLocalPeerDescriptor(){return this.localPeerDescriptor}getClient(){return this.client}formDhtRpcOptions(e){return{sourceDescriptor:this.localPeerDescriptor,targetDescriptor:this.remotePeerDescriptor,timeout:this.timeout??vP(this.localPeerDescriptor,this.remotePeerDescriptor),...e}}}const AP=new Ta("ConnectionLockRpcRemote");class SP extends EP{async lockRequest(e){AP.trace(`Requesting locked connection to ${Dk(this.getPeerDescriptor())}`);const t={lockId:e},r=this.formDhtRpcOptions();try{return(await this.getClient().lockRequest(t,r)).accepted}catch(e){return AP.debug("Connection lock rejected",{err:e}),!1}}unlockRequest(e){AP.trace(`Requesting connection to be unlocked from ${Dk(this.getPeerDescriptor())}`);const t={lockId:e},r=this.formDhtRpcOptions({notification:!0});this.getClient().unlockRequest(t,r).catch(e=>{AP.trace("failed to send unlockRequest")})}async gracefulDisconnect(e){AP.trace(`Notifying a graceful disconnect to ${Dk(this.getPeerDescriptor())}`);const t={disconnectMode:e},r=this.formDhtRpcOptions({connect:!1,sendIfStopped:!0,timeout:2e3});await this.getClient().gracefulDisconnect(t,r)}async setPrivate(e){AP.trace(`Setting isPrivate: ${e} for ${Dk(this.getPeerDescriptor())}`);const t={isPrivate:e},r=this.formDhtRpcOptions({connect:!1,notification:!0});await this.getClient().setPrivate(t,r)}}const kP=new Ta("ConnectionLockRpcLocal");class RP{options;constructor(e){this.options=e}async lockRequest(e,t){const r=t.incomingSourceDescriptor;if(Mk(r,this.options.getLocalPeerDescriptor()))return{accepted:!1};const n=Dk(r);return this.options.addRemoteLocked(n,e.lockId),{accepted:!0}}async unlockRequest(e,t){const r=t.incomingSourceDescriptor,n=Dk(r);return this.options.removeRemoteLocked(n,e.lockId),{}}async gracefulDisconnect(e,t){const r=t.incomingSourceDescriptor;return kP.trace(lP(r)+" received gracefulDisconnect notice"),e.disconnectMode===nR.LEAVING?await this.options.closeConnection(r,!0,"graceful leave notified"):await this.options.closeConnection(r,!1,"graceful disconnect notified"),{}}async setPrivate(e,t){const r=t.incomingSourceDescriptor,n=Dk(r);return this.options.setPrivate(n,e.isPrivate),{}}}const PP=(e,t)=>IP(e+","+t)<IP(t+","+e)?"local":"remote",IP=e=>ka(e).readInt32LE(0);class CP{buffer=[];deferredPromise=new Yi;push(e){return this.buffer.push(e),this.deferredPromise}getBuffer(){return this.buffer}resolve(){this.buffer.length=0,this.deferredPromise.resolve()}reject(){this.buffer.length=0,this.deferredPromise.reject(new Vk("Could not send buffered messages"))}}var _P;!function(e){e.OPEN_INTERNET="open_internet",e.UNKNOWN="unknown"}(_P||(_P={}));const TP=new Ta("ConnectionManager");var NP;!function(e){e.IDLE="idle",e.RUNNING="running",e.STOPPING="stopping",e.STOPPED="stopped"}(NP||(NP={}));const xP="system/connection-manager";class OP extends zr{options;metricsContext;duplicateMessageDetector=new Fk(1e4);metrics;locks=new uP;endpoints=new Map;connectorFacade;rpcCommunicator;disconnectorIntervalRef;state=NP.IDLE;privateClientMode=!1;constructor(e){super(),this.options=e,this.onData=this.onData.bind(this),this.send=this.send.bind(this),this.onNewConnection=this.onNewConnection.bind(this),this.metricsContext=this.options.metricsContext??new za,this.metrics={sendMessagesPerSecond:new ja,sendBytesPerSecond:new ja,receiveMessagesPerSecond:new ja,receiveBytesPerSecond:new ja,connectionAverageCount:new Fa(0),connectionTotalFailureCount:new Ma},this.metricsContext.addMetrics("node",this.metrics),this.connectorFacade=this.options.createConnectorFacade(),this.send=this.send.bind(this),this.rpcCommunicator=new cP(xP,this.send,{rpcRequestTimeout:1e4});const t=new RP({addRemoteLocked:(e,t)=>this.locks.addRemoteLocked(e,t),removeRemoteLocked:(e,t)=>this.locks.removeRemoteLocked(e,t),closeConnection:(e,t,r)=>this.closeConnection(e,t,r),getLocalPeerDescriptor:()=>this.getLocalPeerDescriptor(),setPrivate:(e,t)=>{this.options.allowIncomingPrivateConnections?t?this.locks.addPrivate(e):this.locks.removePrivate(e):TP.debug(`node ${e} attemted to set a connection as private, but it is not allowed`)}});this.rpcCommunicator.registerRpcMethod(OR,MR,"lockRequest",(e,r)=>t.lockRequest(e,r)),this.rpcCommunicator.registerRpcNotification(DR,"unlockRequest",(e,r)=>t.unlockRequest(e,r)),this.rpcCommunicator.registerRpcNotification(BR,"gracefulDisconnect",(e,r)=>t.gracefulDisconnect(e,r)),this.rpcCommunicator.registerRpcNotification(LR,"setPrivate",(e,r)=>t.setPrivate(e,r))}garbageCollectConnections(e,t){if(this.endpoints.size<=e)return;const r=new Lk({referenceId:Dk(this.getLocalPeerDescriptor()),maxSize:1e5,allowToContainReferenceId:!1});this.endpoints.forEach(e=>{if(e.connected){const n=e.connection,i=n.getNodeId();!this.locks.isLocked(i)&&!this.locks.isPrivate(i)&&Date.now()-n.getLastUsedTimestamp()>t&&(TP.trace("disconnecting in timeout interval: "+lP(n.getPeerDescriptor())),r.addContact(n))}});const n=r.getFurthestContacts(this.endpoints.size-e);for(const e of n){const t=e.getPeerDescriptor();TP.trace("garbageCollecting "+Dk(t)),this.gracefullyDisconnectAsync(t,nR.NORMAL).catch(e=>{})}}async start(){if(this.state===NP.RUNNING||this.state===NP.STOPPED)throw new Kk(`Cannot start already ${this.state} module`);this.state=NP.RUNNING,TP.trace("Starting ConnectionManager..."),await this.connectorFacade.start(e=>this.onNewConnection(e),e=>this.hasConnection(e),this),this.disconnectorIntervalRef=setInterval(()=>{TP.trace("disconnectorInterval"),this.garbageCollectConnections(this.options.maxConnections??80,2e4)},5e3)}async stop(){this.state!==NP.STOPPED&&this.state!==NP.STOPPING&&(this.state=NP.STOPPING,TP.trace("Stopping ConnectionManager"),this.disconnectorIntervalRef&&clearInterval(this.disconnectorIntervalRef),await Promise.all(Array.from(this.endpoints.values()).map(async e=>{if(e.connected)try{await this.gracefullyDisconnectAsync(e.connection.getPeerDescriptor(),nR.LEAVING)}catch(e){TP.error(e)}else{const t=e.connection;TP.trace("handshake of connection not completed, force-closing");const r=Ha(t,"disconnected",2e3);t.close(!0);try{await r,TP.trace("resolving after receiving disconnected event from non-handshaked connection")}catch(t){e.buffer.reject(),TP.trace("force-closing non-handshaked connection timed out "+t)}}})),await this.connectorFacade.stop(),this.state=NP.STOPPED,this.rpcCommunicator.stop(),this.duplicateMessageDetector.clear(),this.locks.clear(),this.removeAllListeners())}getLocalLockedConnectionCount(){return this.locks.getLocalLockedConnectionCount()}getRemoteLockedConnectionCount(){return this.locks.getRemoteLockedConnectionCount()}getWeakLockedConnectionCount(){return this.locks.getWeakLockedConnectionCount()}async send(e,t=oP){if((this.state===NP.STOPPED||this.state===NP.STOPPING)&&!t.sendIfStopped)return;const r=e.targetDescriptor;if(this.isConnectionToSelf(r))throw new Gk("Cannot send to self");const n=Dk(r);TP.trace(`Sending message to: ${n}`),e={...e,sourceDescriptor:this.getLocalPeerDescriptor()};let i=this.endpoints.get(n)?.connection;if(!i&&t.connect)i=this.connectorFacade.createConnection(r),this.onNewConnection(i);else if(!i||i&&!this.endpoints.get(n).connected&&!t.connect)throw new Vk("No connection to target, connect flag is false");const s=IR.toBinary(e);if(this.metrics.sendBytesPerSecond.record(s.byteLength),this.metrics.sendMessagesPerSecond.record(1),this.endpoints.get(n).connected)i.send(s);else if(t.bufferWhileConnecting)return this.endpoints.get(n).buffer.push(s)}isConnectionToSelf(e){return Mk(e,this.getLocalPeerDescriptor())||this.isOwnWebsocketServer(e)}isOwnWebsocketServer(e){const t=this.getLocalPeerDescriptor();return void 0!==e.websocket&&void 0!==t.websocket&&e.websocket.port===t.websocket.port&&e.websocket.host===t.websocket.host}getLocalPeerDescriptor(){return this.connectorFacade.getLocalPeerDescriptor()}hasConnection(e){return this.getConnections().some(t=>Dk(t)==e)}getConnectionCount(){return this.getConnections().length}hasLocalLockedConnection(e){return this.locks.isLocalLocked(e)}hasRemoteLockedConnection(e){return this.locks.isRemoteLocked(e)}handleMessage(e){const t=e.body.oneofKind;TP.trace("Received message of type "+t),"rpcMessage"===t?this.duplicateMessageDetector.isMostLikelyDuplicate(e.messageId)?TP.trace("handleMessage filtered duplicate "+Dk(e.sourceDescriptor)+" "+e.serviceId+" "+e.messageId):(this.duplicateMessageDetector.add(e.messageId),e.serviceId===xP?this.rpcCommunicator?.handleMessageFromPeer(e):(TP.trace('emit "message" '+Dk(e.sourceDescriptor)+" "+e.serviceId+" "+e.messageId),this.emit("message",e))):TP.trace("Filtered out non-RPC message of type "+t)}onData(e,t){if(this.state===NP.STOPPED)return;let r;this.metrics.receiveBytesPerSecond.record(e.byteLength),this.metrics.receiveMessagesPerSecond.record(1);try{r=IR.fromBinary(e)}catch(e){return void TP.debug(`Parsing incoming data into Message failed: ${e}`)}r.sourceDescriptor=t;try{this.handleMessage(r)}catch(e){TP.debug(`Handling incoming data failed: ${e}`)}}onConnected(e,t){const r=new fP(e,t);r.on("managedData",this.onData),r.once("disconnected",t=>this.onDisconnected(e,t));const n=Dk(e),i=this.endpoints.get(n),s=i.buffer,o=i.connection,a=s.getBuffer();for(;a.length>0;)TP.trace("emptying buffer"),r.send(a.shift());s.resolve(),o.destroy(),this.endpoints.set(n,{connected:!0,connection:r}),this.privateClientMode&&this.setPrivateForConnection(e,this.privateClientMode).catch(()=>{}),this.emit("connected",e),this.onConnectionCountChange()}onDisconnected(e,t){const r=Dk(e);TP.trace(r+" onDisconnected() gracefulLeave: "+t);const n=this.endpoints.get(r);n&&(this.locks.clearAllLocks(r),!1===n.connected&&n.buffer.reject(),this.endpoints.delete(r),TP.trace(r+" deleted connection in onDisconnected() gracefulLeave: "+t),this.emit("disconnected",e,t),this.onConnectionCountChange())}onNewConnection(e){return this.state!==NP.STOPPED&&(TP.trace("onNewConnection()"),!!this.acceptNewConnection(e)&&(e.once("connected",(e,t)=>this.onConnected(e,t)),e.once("disconnected",t=>this.onDisconnected(e.getPeerDescriptor(),t)),!0))}acceptNewConnection(e){const t=Dk(e.getPeerDescriptor());if(TP.trace(t+" acceptNewConnection()"),this.endpoints.has(t)){if("remote"===PP(Dk(this.getLocalPeerDescriptor()),t)){let r;const n=this.endpoints.get(t);this.endpoints.get(t).connected?(TP.debug("replacing connected connection",{nodeId:t}),r=new CP):r=n.buffer;const i=n.connection;return TP.trace("replaced: "+t),i.replaceAsDuplicate(),this.endpoints.set(t,{connected:!1,connection:e,buffer:r}),!0}return!1}return TP.trace(t+" added to connections at acceptNewConnection"),this.endpoints.set(t,{connected:!1,buffer:new CP,connection:e}),!0}async closeConnection(e,t,r){const n=Dk(e);if(TP.trace(n+" closeConnection() "+r),this.locks.clearAllLocks(n),this.endpoints.has(n)){const e=this.endpoints.get(n).connection;await e.close(t)}else TP.trace(n+" closeConnection() this.endpoints did not have the id"),this.emit("disconnected",e,!1)}lockConnection(e,t){if(this.state===NP.STOPPED||Mk(e,this.getLocalPeerDescriptor()))return;const r=Dk(e),n=new SP(this.getLocalPeerDescriptor(),e,this.rpcCommunicator,iP);this.locks.addLocalLocked(r,t),n.lockRequest(t).then(e=>TP.trace("LockRequest successful")).catch(e=>{TP.debug(e)})}unlockConnection(e,t){if(this.state===NP.STOPPED||Mk(e,this.getLocalPeerDescriptor()))return;const r=Dk(e);this.locks.removeLocalLocked(r,t);const n=new SP(this.getLocalPeerDescriptor(),e,this.rpcCommunicator,iP);this.endpoints.has(r)&&n.unlockRequest(t)}weakLockConnection(e,t){this.state!==NP.STOPPED&&e!==Dk(this.getLocalPeerDescriptor())&&this.locks.addWeakLocked(e,t)}weakUnlockConnection(e,t){this.state!==NP.STOPPED&&e!==Dk(this.getLocalPeerDescriptor())&&this.locks.removeWeakLocked(e,t)}async enablePrivateClientMode(){this.privateClientMode=!0,await Promise.all(this.getConnectedEndpoints().map(e=>{const t=e.connection.getPeerDescriptor();return this.setPrivateForConnection(t,!0)}))}async disablePrivateClientMode(){this.privateClientMode=!1,await Promise.all(this.getConnectedEndpoints().map(e=>{const t=e.connection.getPeerDescriptor();return this.setPrivateForConnection(t,!1)}))}getConnectedEndpoints(){return Array.from(this.endpoints.values()).filter(e=>e.connected)}isPrivateClientMode(){return this.privateClientMode}async setPrivateForConnection(e,t){const r=new SP(this.getLocalPeerDescriptor(),e,this.rpcCommunicator,iP);await r.setPrivate(t)}async gracefullyDisconnectAsync(e,t){const r=this.endpoints.get(Dk(e));if(r)if(r.connected){const n=r.connection,i=new Promise((e,t)=>{Ha(n,"disconnected",2e3).then(()=>{TP.trace("disconnected event received in gracefullyDisconnectAsync()")}).catch(e=>{TP.trace("force-closing connection after timeout "+e),n.close(!0)}).finally(()=>{TP.trace("resolving after receiving disconnected event"),e()})});await Promise.all([i,this.doGracefullyDisconnectAsync(e,t)])}else r.connection.close(!0);else TP.debug("gracefullyDisconnectedAsync() tried on a non-existing connection")}async doGracefullyDisconnectAsync(e,t){const r=Dk(e);TP.trace(r+" gracefullyDisconnectAsync()");const n=new SP(this.getLocalPeerDescriptor(),e,this.rpcCommunicator,iP);try{await n.gracefulDisconnect(t)}catch(e){TP.trace(r+" remote.gracefulDisconnect() failed"+e)}}getConnections(){return Array.from(this.endpoints.values()).map(e=>e).filter(e=>e.connected&&!this.locks.isPrivate(Dk(e.connection.getPeerDescriptor()))).map(e=>e.connection.getPeerDescriptor())}onConnectionCountChange(){this.metrics.connectionAverageCount.record(this.endpoints.size)}getDiagnosticInfo(){return{connections:Array.from(this.endpoints.values()).filter(e=>e.connected).map(e=>e.connection).map(e=>e.getDiagnosticInfo()),connectionCount:this.endpoints.size}}}[lR,dR,pR,gR,mR,yR,bR,wR,vR,BR,ER,AR,SR,kR,RR,PR,IR,CR,_R,TR,NR,xR,OR,DR,MR].concat($S),new Ta("SimulatorConnection");const DP="1.1",MP=e=>{const t=BP(DP).major,r=BP(e)?.major;return!(void 0===r||r<t)},BP=e=>{const t=e.split(".");if(2===t.length){const e=t.map(e=>Number(e));if(!e.some(e=>isNaN(e)))return{major:e[0],minor:e[1]}}};var LP="103.3.1";const FP=new Ta("Handshaker"),UP=(e,t,r,n)=>{const i=new qP(e,r),s=()=>{i.stop(),r.off("disconnected",u),r.off("connected",c),i.off("handshakeCompleted",a),i.off("handshakeFailed",o),t.off("disconnected",l)},o=e=>{e!==rR.INVALID_TARGET_PEER_DESCRIPTOR&&e!==rR.UNSUPPORTED_PROTOCOL_VERSION||(t.close(!1),s())},a=e=>{FP.trace("handshake completed for outgoing connection, "+Dk(e)),t.onHandshakeCompleted(r),s()},c=()=>i.sendHandshakeRequest(n),u=e=>{t.close(e),s()},l=()=>{r.close(!1),s()};return i.once("handshakeFailed",o),i.once("handshakeCompleted",a),r.once("connected",c),r.once("disconnected",u),t.once("disconnected",l),i},jP=(e,t,r,n)=>{r.sendHandshakeResponse(n),t.destroy(),e.destroy()},zP=(e,t,r)=>{e.sendHandshakeResponse(),t.onHandshakeCompleted(r)};class qP extends zr{static HANDSHAKER_SERVICE_ID="system/handshaker";localPeerDescriptor;connection;onDataListener;constructor(e,t){super(),this.localPeerDescriptor=e,this.connection=t,this.onDataListener=e=>this.onData(e),this.connection.on("data",this.onDataListener)}onData(e){try{const t=IR.fromBinary(e);if("handshakeRequest"===t.body.oneofKind){FP.trace("handshake request received");const e=t.body.handshakeRequest;this.emit("handshakeRequest",e.sourcePeerDescriptor,e.protocolVersion,e.targetPeerDescriptor)}if("handshakeResponse"===t.body.oneofKind){FP.trace("handshake response received");const e=t.body.handshakeResponse,r=MP(e.protocolVersion)?e.error:rR.UNSUPPORTED_PROTOCOL_VERSION;void 0!==r?this.emit("handshakeFailed",r):this.emit("handshakeCompleted",e.sourcePeerDescriptor)}}catch(e){FP.debug("error while parsing handshake message",e)}}sendHandshakeRequest(e){const t=((e,t)=>{const r={sourcePeerDescriptor:e,targetPeerDescriptor:t,protocolVersion:DP,applicationVersion:LP};return{serviceId:qP.HANDSHAKER_SERVICE_ID,messageId:hS(),body:{oneofKind:"handshakeRequest",handshakeRequest:r}}})(this.localPeerDescriptor,e);this.connection.send(IR.toBinary(t)),FP.trace("handshake request sent")}sendHandshakeResponse(e){const t=((e,t)=>{const r={sourcePeerDescriptor:e,error:t,protocolVersion:DP,applicationVersion:LP};return{serviceId:qP.HANDSHAKER_SERVICE_ID,messageId:hS(),body:{oneofKind:"handshakeResponse",handshakeResponse:r}}})(this.localPeerDescriptor,e);this.connection.send(IR.toBinary(t)),FP.trace("handshake response sent")}stop(){this.connection.off("data",this.onDataListener),this.removeAllListeners()}}const KP=new Ta("PendingConnection");class GP extends zr{connectingAbortController=new AbortController;remotePeerDescriptor;replacedAsDuplicate=!1;stopped=!1;constructor(e,t=15e3){super(),this.remotePeerDescriptor=e,Zi(()=>{this.close(!1)},t,this.connectingAbortController.signal)}replaceAsDuplicate(){KP.trace(lP(this.remotePeerDescriptor)+" replaceAsDuplicate"),this.replacedAsDuplicate=!0}onHandshakeCompleted(e){this.replacedAsDuplicate||this.emit("connected",this.remotePeerDescriptor,e)}close(e){this.stopped||(this.stopped=!0,this.connectingAbortController.abort(),this.replacedAsDuplicate||this.emit("disconnected",e))}destroy(){this.stopped||(this.stopped=!0,this.connectingAbortController.abort(),this.removeAllListeners())}getPeerDescriptor(){return this.remotePeerDescriptor}}new Ta("SimulatorConnector");class $P extends cP{transport;messageListener;disconnectedListener;constructor(e,t,r){super(e,(e,r)=>t.send(e,r),r),this.messageListener=e=>{this.handleMessageFromPeer(e)},this.disconnectedListener=e=>{this.getRequestIds(t=>Mk(e,t.getCallContext().targetDescriptor)).forEach(e=>this.handleClientError(e,new PS.Disconnected("Peer disconnected")))},this.transport=t,t.on("message",this.messageListener),t.on("disconnected",this.disconnectedListener)}destroy(){this.transport.off("message",this.messageListener),this.transport.off("disconnected",this.disconnectedListener),this.stop()}}var VP,HP;!function(e){e.OFFER="offer",e.ANSWER="answer"}(VP||(VP={})),function(e){e.DISCONNECTED="disconnected",e.FAILED="failed",e.CLOSED="closed"}(HP||(HP={}));const WP=new Ta("WebrtcConnection (browser)");class JP extends zr{connectionId;connectionType=pP.WEBRTC;lastState="connecting";iceServers;peerConnection;bufferThresholdHigh=2**17;bufferThresholdLow=32768;dataChannel;makingOffer=!1;isOffering=!1;closed=!1;earlyTimeout;messageQueue=[];constructor(e){super(),this.connectionId=dP(),this.iceServers=e.iceServers??[],this.earlyTimeout=setTimeout(()=>{this.doClose(!1,"timed out due to remote descriptor not being set")},5e3)}start(e){this.isOffering=e;const t=this.iceServers.map(({url:e,port:t,username:r,password:n})=>({urls:`${e}:${t}`,username:r,credential:n}));if(this.peerConnection=new RTCPeerConnection({iceServers:t}),this.peerConnection.onicecandidate=e=>{null!==e.candidate&&null!==e.candidate.sdpMid&&this.emit("localCandidate",e.candidate.candidate,e.candidate.sdpMid)},this.peerConnection.onicegatheringstatechange=()=>{WP.trace(`conn.onGatheringStateChange: ${this.peerConnection?.iceGatheringState}`)},this.peerConnection.onconnectionstatechange=()=>this.onStateChange(),e){this.peerConnection.onnegotiationneeded=async()=>{if(void 0!==this.peerConnection){this.makingOffer=!0;try{await this.peerConnection.setLocalDescription()}catch(e){WP.warn("Failed to set local description",{err:e})}null!==this.peerConnection.localDescription&&this.emit("localDescription",this.peerConnection.localDescription?.sdp,this.peerConnection.localDescription?.type)}this.makingOffer=!1};const e=this.peerConnection.createDataChannel("streamrDataChannel");this.setupDataChannel(e)}else this.peerConnection.ondatachannel=e=>{this.setupDataChannel(e.channel)}}async setRemoteDescription(e,t){const r=t.toLowerCase()===VP.OFFER&&(this.makingOffer||"stable"!=this.peerConnection?.signalingState);if(!this.isOffering||!r){try{await(this.peerConnection?.setRemoteDescription({sdp:e,type:t.toLowerCase()})),clearTimeout(this.earlyTimeout)}catch(e){WP.warn("Failed to set remote description",{err:e})}if(t.toLowerCase()===VP.OFFER&&void 0!==this.peerConnection){try{await this.peerConnection.setLocalDescription()}catch(e){WP.warn("Failed to set local description",{err:e})}null!==this.peerConnection.localDescription&&this.emit("localDescription",this.peerConnection.localDescription.sdp,this.peerConnection.localDescription.type)}}}addRemoteCandidate(e,t){this.peerConnection?.addIceCandidate({candidate:e,sdpMid:t}).catch(e=>{WP.warn("Failed to add ICE candidate",{err:e})})}isOpen(){return"connected"===this.lastState}async close(e,t){this.doClose(e,t)}doClose(e,t){if(!this.closed){if(this.closed=!0,this.lastState="closed",clearTimeout(this.earlyTimeout),this.stopListening(),this.emit("disconnected",e,void 0,t),this.removeAllListeners(),void 0!==this.dataChannel)try{this.dataChannel.close()}catch(e){WP.warn("Failed to close data channel",{err:e})}if(this.dataChannel=void 0,void 0!==this.peerConnection)try{this.peerConnection.close()}catch(e){WP.warn("Failed to close connection",{err:e})}this.peerConnection=void 0}}destroy(){this.removeAllListeners(),this.doClose(!1)}send(e){"connected"===this.lastState?this.dataChannel.bufferedAmount>this.bufferThresholdHigh?this.messageQueue.push(e):this.dataChannel?.send(e):WP.warn("Tried to send on a connection with last state "+this.lastState)}setupDataChannel(e){this.dataChannel=e,this.dataChannel.binaryType="arraybuffer",this.dataChannel.bufferedAmountLowThreshold=this.bufferThresholdLow,e.onopen=()=>{WP.trace("dc.onOpen"),this.onDataChannelOpen()},e.onclose=()=>{WP.trace("dc.onClosed"),this.doClose(!1)},e.onerror=e=>{WP.warn("Data channel error",{err:e})},e.onmessage=e=>{WP.trace("dc.onmessage"),this.emit("data",new Uint8Array(e.data))},e.onbufferedamountlow=()=>{for(WP.trace("dc.onBufferedAmountLow");this.messageQueue.length>0&&this.dataChannel.bufferedAmount<this.bufferThresholdHigh;){const e=this.messageQueue.shift();this.dataChannel.send(e)}}}stopListening(){void 0!==this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onclose=null,this.dataChannel.onerror=null,this.dataChannel.onbufferedamountlow=null,this.dataChannel.onmessage=null),void 0!==this.peerConnection&&(this.peerConnection.onconnectionstatechange=null,this.peerConnection.onicecandidate=null,this.peerConnection.onicegatheringstatechange=null,this.peerConnection.onnegotiationneeded=null,this.peerConnection.ondatachannel=null)}onDataChannelOpen(){this.lastState="connected",this.emit("connected")}onStateChange(){this.peerConnection.connectionState!==HP.CLOSED&&this.peerConnection.connectionState!==HP.DISCONNECTED&&this.peerConnection.connectionState!==HP.FAILED||this.doClose(!1)}setConnectionId(e){this.connectionId=e}}const ZP=new Ta("WebrtcConnectorRpcRemote");class QP extends EP{requestConnection(){const e=this.formDhtRpcOptions({notification:!0});this.getClient().requestConnection({},e).catch(e=>{ZP.trace("Failed to send requestConnection")})}sendRtcOffer(e,t){const r={connectionId:t,description:e},n=this.formDhtRpcOptions();this.getClient().rtcOffer(r,n).catch(e=>{ZP.trace("Failed to send rtcOffer")})}sendRtcAnswer(e,t){const r={connectionId:t,description:e},n=this.formDhtRpcOptions();this.getClient().rtcAnswer(r,n).catch(e=>{ZP.trace("Failed to send rtcAnswer")})}sendIceCandidate(e,t,r){const n={connectionId:r,mid:t,candidate:e},i=this.formDhtRpcOptions();this.getClient().iceCandidate(n,i).catch(e=>{ZP.trace("Failed to send iceCandidate")})}}const YP=new Ta("WebrtcConnectorRpcLocal");class XP{options;constructor(e){this.options=e}async requestConnection(e){const t=e.incomingSourceDescriptor;if(this.options.ongoingConnectAttempts.has(Dk(t)))return{};const r=this.options.connect(t,!1);return this.options.onNewConnection(r),{}}async rtcOffer(e,t){const r=t.incomingSourceDescriptor,n=Dk(r);let i,s;return this.options.ongoingConnectAttempts.has(n)?(s=this.options.ongoingConnectAttempts.get(n).managedConnection,i=this.options.ongoingConnectAttempts.get(n).connection):(s=this.options.connect(r,!0),i=this.options.ongoingConnectAttempts.get(n).connection,this.options.onNewConnection(s)),i.setConnectionId(e.connectionId),i.setRemoteDescription(e.description,"offer"),{}}async rtcAnswer(e,t){const r=t.incomingSourceDescriptor,n=Dk(r),i=this.options.ongoingConnectAttempts.get(n)?.connection;return i?i.connectionId!==e.connectionId?(YP.trace("Ignoring RTC answer due to connectionId mismatch"),{}):(i.setRemoteDescription(e.description,"answer"),{}):{}}async iceCandidate(e,t){const r=t.incomingSourceDescriptor,n=Dk(r),i=this.options.ongoingConnectAttempts.get(n)?.connection;return i?i.connectionId!==e.connectionId?(YP.trace("Ignoring remote candidate due to connectionId mismatch"),{}):(this.isIceCandidateAllowed(e.candidate)&&i.addRemoteCandidate(e.candidate,e.mid),{}):{}}isIceCandidateAllowed(e){if(!this.options.allowPrivateAddresses){const t=function(e){const t=e.split(" ").filter(e=>e.length>0);return t.length>=5&&HS().isValid(t[4])?t[4]:void 0}(e);if(void 0!==t&&mP(t))return!1}return!0}}const eI=new Ta("WebrtcConnector");class tI{static WEBRTC_CONNECTOR_SERVICE_ID="system/webrtc-connector";rpcCommunicator;ongoingConnectAttempts=new Map;localPeerDescriptor;stopped=!1;options;constructor(e){this.options=e,this.rpcCommunicator=new $P(tI.WEBRTC_CONNECTOR_SERVICE_ID,e.transport,{rpcRequestTimeout:15e3}),this.registerLocalRpcMethods(e)}registerLocalRpcMethods(e){const t=new XP({connect:(e,t)=>this.connect(e,t),onNewConnection:e=>this.options.onNewConnection(e),ongoingConnectAttempts:this.ongoingConnectAttempts,rpcCommunicator:this.rpcCommunicator,getLocalPeerDescriptor:()=>this.localPeerDescriptor,allowPrivateAddresses:e.allowPrivateAddresses??!0});this.rpcCommunicator.registerRpcNotification(_R,"requestConnection",async(e,r)=>this.stopped?{}:t.requestConnection(r)),this.rpcCommunicator.registerRpcNotification(TR,"rtcOffer",async(e,r)=>this.stopped?{}:t.rtcOffer(e,r)),this.rpcCommunicator.registerRpcNotification(NR,"rtcAnswer",async(e,r)=>this.stopped?{}:t.rtcAnswer(e,r)),this.rpcCommunicator.registerRpcNotification(xR,"iceCandidate",async(e,r)=>this.stopped?{}:t.iceCandidate(e,r))}connect(e,t){if(Mk(e,this.localPeerDescriptor))throw new Gk("Cannot open WebRTC Connection to self");eI.trace(`Opening WebRTC connection to ${Dk(e)}`);const r=Dk(e),n=this.ongoingConnectAttempts.get(r);if(n)return n.managedConnection;const i=this.createConnection(e),s=Dk(this.localPeerDescriptor),o=Dk(e),a="local"===PP(s,o);let c;const u=new QP(this.localPeerDescriptor,e,this.rpcCommunicator,nP),l=()=>{this.ongoingConnectAttempts.delete(r),i.off("disconnected",l),c.off("disconnected",l),c.off("connected",l)};if(a)c=new GP(e),UP(this.localPeerDescriptor,c,i,e),i.once("localDescription",e=>{eI.trace("Sending offer to remote peer"),u.sendRtcOffer(e,i.connectionId)});else{c=new GP(e);const t=((e,t,r)=>{const n=new qP(e,r),i=()=>{n.stop(),t.off("disconnected",s),r.off("disconnected",s)},s=e=>{t.close(e),i()};return n.on("handshakeRequest",()=>{i()}),r.once("disconnected",s),t.once("disconnected",()=>{r.close(!1),i()}),n})(this.localPeerDescriptor,c,i);i.once("localDescription",e=>{u.sendRtcAnswer(e,i.connectionId)}),t.on("handshakeRequest",(e,r)=>{MP(r)?zP(t,c,i):jP(c,i,t,rR.UNSUPPORTED_PROTOCOL_VERSION),l()})}return this.ongoingConnectAttempts.set(o,{managedConnection:c,connection:i}),i.on("disconnected",l),c.on("disconnected",l),c.on("connected",l),i.on("localCandidate",(e,t)=>{void 0!==this.options.externalIp&&(e=((e,t)=>{const r=e.split(" ");return"host"===r[7]&&(r[4]=t),r.join(" ")})(e,this.options.externalIp),eI.debug(`onLocalCandidate injected external ip ${e} ${t}`)),u.sendIceCandidate(e,t,i.connectionId)}),i.start(a),t||a||u.requestConnection(),c}createConnection(e){return new JP({remotePeerDescriptor:e,iceServers:this.options.iceServers,bufferThresholdLow:this.options.bufferThresholdLow,bufferThresholdHigh:this.options.bufferThresholdHigh,portRange:this.options.portRange})}setLocalPeerDescriptor(e){this.localPeerDescriptor=e}async stop(){eI.trace("stop()"),this.stopped=!0;const e=Array.from(this.ongoingConnectAttempts.values());await Promise.allSettled(e.map(async e=>{e.connection.destroy(),e.managedConnection.close(!1)})),this.rpcCommunicator.destroy()}}const rI=new Ta("AbstractWebsocketClientConnection");class nI extends zr{connectionId;connectionType=pP.WEBSOCKET_CLIENT;destroyed=!1;constructor(){super(),this.connectionId=dP()}send(e){this.destroyed?rI.debug("Tried to send() on stopped connection"):1===this.socket?.readyState?(rI.trace(`Sending data with size ${e.byteLength}`),this.socket?.send(e)):rI.debug("Tried to send data on a non-open connection",{id:this.connectionId,readyState:this.socket.readyState,destroyed:this.destroyed})}async close(e){this.emit("disconnected",e,void 0,"close() called"),this.removeAllListeners(),this.destroyed?rI.debug("Tried to close() a stopped connection",{id:this.connectionId}):(rI.trace(`Closing socket for connection ${this.connectionId}`),this.socket?.close(e?3001:void 0))}destroy(){rI.trace("destroy() a connection"),this.destroyed?rI.debug("Tried to destroy() a stopped connection"):(this.removeAllListeners(),this.socket&&(this.stopListening(),this.socket.close(),this.socket=void 0),this.destroyed=!0)}onOpen(){this.destroyed||(rI.trace("WebSocket Client Connected"),1===this.socket?.readyState&&this.emit("connected"))}onMessage(e){this.emit("data",e)}onClose(e,t){this.destroyed||(rI.trace("Websocket Closed"),this.doDisconnect(e,t))}onError(e){this.destroyed||(rI.trace("WebSocket Client error: "+e?.message,{error:e}),this.emit("error",e.name))}doDisconnect(e,t){this.destroyed=!0,this.stopListening(),this.socket=void 0;const r=1001===e||3001===e;this.emit("disconnected",r,e,t),this.removeAllListeners()}}const iI=new Ta("WebsocketClientConnection (browser)");class sI extends nI{socket;connect(e,t){this.destroyed?iI.debug("Tried to connect() a stopped connection"):(this.socket=new WS.w3cwebsocket(e,void 0,void 0,void 0,{rejectUnauthorized:!t}),this.socket.binaryType="arraybuffer",this.socket.onerror=e=>this.onError(e),this.socket.onopen=()=>this.onOpen(),this.socket.onclose=e=>this.onClose(e.code,e.reason),this.socket.onmessage=e=>{this.destroyed||("string"==typeof e.data?iI.debug("Received string data, only binary data is supported"):this.onMessage(new Uint8Array(e.data)))})}stopListening(){this.socket&&(this.socket.onopen=void 0,this.socket.onclose=void 0,this.socket.onerror=void 0,this.socket.onmessage=void 0)}}class oI{options;constructor(e){this.options=e}async requestConnection(e,t){if(this.options.abortSignal.aborted)return{};const r=t.incomingSourceDescriptor;if(!this.options.hasConnection(Dk(r))){const e=this.options.connect(r);this.options.onNewConnection(e)}return{}}}const aI=(e,t)=>(e.tls?"wss://":"ws://")+e.host+":"+e.port+(void 0!==t?"?action="+t:"");class cI{static WEBSOCKET_CONNECTOR_SERVICE_ID="system/websocket-connector";websocketServer;geoIpLocator;localPeerDescriptor;connectingConnections=new Map;abortController=new AbortController;options;constructor(e){this.options=e,this.registerLocalRpcMethods()}registerLocalRpcMethods(){const e=new oI({connect:e=>this.connect(e),hasConnection:e=>this.connectingConnections.has(e)||this.options.hasConnection(e),onNewConnection:e=>this.options.onNewConnection(e),abortSignal:this.abortController.signal});this.options.rpcCommunicator.registerRpcNotification(CR,"requestConnection",async(t,r)=>this.abortController.signal.aborted?{}:e.requestConnection(t,r))}isPossibleToFormConnection(e){return bP(this.localPeerDescriptor,e)===pP.WEBSOCKET_CLIENT}connect(e){const t=Dk(e),r=this.connectingConnections.get(t);if(r)return r;const n=new sI,i=aI(e.websocket),s=new GP(e);UP(this.localPeerDescriptor,s,n,e),this.connectingConnections.set(t,s);const o=()=>{this.connectingConnections.has(t)&&this.connectingConnections.delete(t),n.off("disconnected",o),s.off("disconnected",o),s.off("connected",o)};return n.on("disconnected",o),s.on("disconnected",o),s.on("connected",o),n.connect(i,!1),s}setLocalPeerDescriptor(e){this.localPeerDescriptor=e}async destroy(){this.abortController.abort(),Array.from(this.connectingConnections.values()).forEach(e=>e.close(!0)),await(this.websocketServer?.stop()),this.geoIpLocator?.stop()}}class uI extends zr{constructor(e){super()}async start(){throw new Error("WebsocketServer is not supported in browser environment")}async stop(){throw new Error("WebsocketServer is not supported in browser environment")}updateCertificate(e,t){throw new Error("WebsocketServer is not supported in browser environment")}}const lI=new Ta("AutoCertifierClientFacade");class dI{autoCertifierClient;rpcCommunicator;options;constructor(e){this.options=e,this.rpcCommunicator=new $P("system/auto-certificer",e.transport),this.autoCertifierClient=e.createClientFactory?e.createClientFactory():(()=>{throw new Error("AutoCertifierClient is not supported in browser environment")})(e.configFile,e.url,this.rpcCommunicator,e.wsServerPort)}async start(){this.autoCertifierClient.on("updatedCertificate",e=>{this.options.setHost(e.fqdn),this.options.updateCertificate(e.certificate,e.privateKey),lI.trace("Updated certificate")}),await Promise.all([Ha(this.autoCertifierClient,"updatedCertificate",6e4),this.autoCertifierClient.start()])}stop(){this.autoCertifierClient.stop(),this.rpcCommunicator.destroy()}}const hI=new Ta("connectivityChecker"),fI=async({url:e,allowSelfSignedCertificate:t,timeoutMs:r=1e3})=>{const n=new sI;let i;try{const s=Wa(n,["connected","error"],r);n.connect(e,t),i=await s}catch{throw new zk("WebSocket connection timed out")}if("error"===i.winnerName)throw new zk("Could not open WebSocket connection");return n},pI="system/connectivity-checker",gI=async(e,t)=>{let r;const n={host:t.websocket.host,port:t.websocket.port,tls:t.websocket.tls},i=aI(n,"connectivityRequest");hI.debug(`Attempting connectivity check with entrypoint ${i}`);try{r=await fI({url:i,allowSelfSignedCertificate:e.allowSelfSignedCertificate})}catch(e){throw new zk(`Failed to connect to entrypoint for connectivity check: ${i}`,e)}const s={serviceId:pI,messageId:hS(),body:{oneofKind:"connectivityRequest",connectivityRequest:e}};try{const e=new Promise((e,t)=>{const n=setTimeout(()=>{r.close(!1),t(new $k("timeout"))},5e3),i=s=>{r.close(!1);try{const o=IR.fromBinary(s);if("connectivityResponse"===o.body.oneofKind){hI.debug("ConnectivityResponse received: "+JSON.stringify(IR.toJson(o)));const s=o.body.connectivityResponse,a=s.protocolVersion;r.off("data",i),clearTimeout(n),MP(a)?e(s):t(`Unsupported version: ${a}`)}}catch(e){hI.trace("Could not parse message",{err:e})}};r.on("data",i)});return r.send(IR.toBinary(s)),hI.trace("ConnectivityRequest sent: "+JSON.stringify(IR.toJson(s))),await e}catch(e){throw hI.error("error getting connectivityresponse"),e}},mI=new Ta("connectivityRequestHandler"),yI=async(e,t,r)=>{let n,i;try{const s={host:r,port:e.port,tls:e.tls},o=aI(s,"connectivityProbe");mI.trace(`Attempting Connectivity Check to ${o}`),n=await fI({url:o,allowSelfSignedCertificate:e.allowSelfSignedCertificate}),mI.trace("Connectivity test produced positive result, communicating reply to the requester "+r+":"+e.port),i={host:r,natType:_P.OPEN_INTERNET,websocket:{host:r,port:e.port,tls:e.tls},ipAddress:uc(t),protocolVersion:DP}}catch(e){mI.debug("error",{err:e}),i={host:r,natType:_P.UNKNOWN,ipAddress:uc(t),protocolVersion:DP}}return n&&n.close(!1),i},bI=new Ta("WebsocketClientConnectorRpcRemote");class wI extends EP{async requestConnection(){bI.trace(`Requesting WebSocket connection from ${Dk(this.getLocalPeerDescriptor())}`);const e=this.formDhtRpcOptions();return this.getClient().requestConnection({},e)}}const vI=new Ta("WebsocketServerConnector");class EI{websocketServer;geoIpLocator;ongoingConnectRequests=new Map;host;autoCertifierClient;selectedPort;localPeerDescriptor;abortController=new AbortController;options;constructor(e){this.options=e,this.websocketServer=e.portRange?new uI({portRange:e.portRange,tlsCertificate:e.tlsCertificate,maxMessageSize:e.maxMessageSize,enableTls:e.serverEnableTls}):void 0,this.host=e.host}async start(){if(!this.abortController.signal.aborted&&this.websocketServer){if(this.websocketServer.on("connected",e=>{const t=e,r=new URLSearchParams(t.resourceURL.query??"").get("action");var n,i;vI.trace("WebSocket client connected",{action:r,remoteAddress:t.getRemoteIpAddress()}),"connectivityRequest"===r?(n=t,i=this.geoIpLocator,n.on("data",async e=>{mI.trace("server received data");try{const t=IR.fromBinary(e);if("connectivityRequest"===t.body.oneofKind){mI.trace("ConnectivityRequest received: "+JSON.stringify(IR.toJson(t)));try{await(async(e,t,r)=>{const n=t.host??e.getRemoteIpAddress(),i=e.getRemoteIpAddress();let s;if(0!==t.port?s=await yI(t,i,n):(mI.trace("ConnectivityRequest port is 0, replying without connectivityProbe"),s={host:n,natType:_P.UNKNOWN,ipAddress:uc(i),protocolVersion:DP}),void 0!==r){const e=r.lookup(i);void 0!==e&&(s.latitude=e.latitude,s.longitude=e.longitude)}const o={serviceId:pI,messageId:hS(),body:{oneofKind:"connectivityResponse",connectivityResponse:s}};e.send(IR.toBinary(o)),mI.trace("ConnectivityResponse sent: "+JSON.stringify(IR.toJson(o)))})(n,t.body.connectivityRequest,i),mI.trace("handleIncomingConnectivityRequest ok")}catch(e){mI.error("handleIncomingConnectivityRequest",{err:e})}}}catch(e){mI.trace("Could not parse message",{err:e})}})):"connectivityProbe"===r||(void 0!==this.localPeerDescriptor?this.attachHandshaker(e):(vI.trace("incoming Websocket connection before localPeerDescriptor was set, closing connection"),e.close(!1).catch(()=>{})))}),this.options.geoIpDatabaseFolder)try{this.geoIpLocator=await(()=>{throw new Error("GeoIpLocator is not supported in browser environment")})(this.options.geoIpDatabaseFolder)}catch(e){vI.error("Failed to start GeoIpLocator",{err:e})}const e=await this.websocketServer.start();this.selectedPort=e}}attachHandshaker(e){const t=new qP(this.localPeerDescriptor,e);t.once("handshakeRequest",(r,n,i)=>{this.onServerSocketHandshakeRequest(r,e,t,n,i)})}onServerSocketHandshakeRequest(e,t,r,n,i){const s=Dk(e);if(this.ongoingConnectRequests.has(s)){const{pendingConnection:e,delFunc:o}=this.ongoingConnectRequests.get(s);MP(n)?i&&!Mk(this.localPeerDescriptor,i)?(jP(e,t,r,rR.INVALID_TARGET_PEER_DESCRIPTOR),o()):zP(r,e,t):(jP(e,t,r,rR.UNSUPPORTED_PROTOCOL_VERSION),o())}else{const s=new GP(e);MP(n)?i&&!Mk(this.localPeerDescriptor,i)?jP(s,t,r,rR.INVALID_TARGET_PEER_DESCRIPTOR):this.options.onNewConnection(s)?zP(r,s,t):jP(s,t,r,rR.DUPLICATE_CONNECTION):jP(s,t,r,rR.UNSUPPORTED_PROTOCOL_VERSION)}}async checkConnectivity(e){if(this.abortController.signal.aborted)return{host:"127.0.0.1",natType:_P.UNKNOWN,ipAddress:uc("127.0.0.1"),protocolVersion:DP};if(!this.options.entrypoints||0===this.options.entrypoints.length)return{host:this.host,natType:_P.OPEN_INTERNET,websocket:{host:this.host,port:this.selectedPort,tls:void 0!==this.options.tlsCertificate},ipAddress:uc("127.0.0.1"),protocolVersion:DP};const t=ZS()(this.options.entrypoints);for(;t.length>0&&!this.abortController.signal.aborted;){const r=t[0];try{const t={port:this.selectedPort??0,host:this.host,tls:!!this.websocketServer&&this.options.serverEnableTls,allowSelfSignedCertificate:e};if(this.abortController.signal.aborted)throw new zk("ConnectivityChecker is destroyed");return await gI(t,r)}catch(e){const n=`Failed to connect to entrypoint with id ${Dk(r)} and URL ${aI(r.websocket)}`;vI.error(n,{err:e}),t.shift(),await Ga(2e3,this.abortController.signal)}}throw new qk(`Failed to connect to the entrypoints after ${this.options.entrypoints.length} attempts\nAttempted hosts: ${this.options.entrypoints.map(e=>`${e.websocket.host}:${e.websocket.port}`).join(", ")}`)}async autoCertify(){this.autoCertifierClient=new dI({configFile:this.options.autoCertifierConfigFile,transport:this.options.autoCertifierTransport,url:this.options.autoCertifierUrl,wsServerPort:this.selectedPort,setHost:e=>this.setHost(e),updateCertificate:(e,t)=>this.websocketServer.updateCertificate(e,t)}),vI.trace("AutoCertifying subdomain..."),await this.autoCertifierClient.start()}setHost(e){vI.trace(`Setting host name to ${e}`),this.host=e}connect(e){const t=Dk(e);return this.ongoingConnectRequests.has(t)?this.ongoingConnectRequests.get(t).pendingConnection:this.requestConnectionFromPeer(this.localPeerDescriptor,e)}requestConnectionFromPeer(e,t){setImmediate(()=>{new wI(e,t,this.options.rpcCommunicator,rP).requestConnection().then(()=>{vI.trace("Sent WebsocketConnectionRequest notification to peer",{targetPeerDescriptor:t})},e=>{vI.debug("Failed to send WebsocketConnectionRequest notification to peer ",{error:e,targetPeerDescriptor:t})})});const r=new GP(t),n=Dk(t),i=()=>{r.off("connected",i),r.off("disconnected",i),this.ongoingConnectRequests.delete(n)};return r.on("connected",i),r.on("disconnected",i),this.ongoingConnectRequests.set(n,{pendingConnection:r,delFunc:i}),r}isPossibleToFormConnection(e){return bP(this.localPeerDescriptor,e)===pP.WEBSOCKET_SERVER}setLocalPeerDescriptor(e){this.localPeerDescriptor=e}async destroy(){this.abortController.abort(),Array.from(this.ongoingConnectRequests.values()).forEach(e=>e.pendingConnection.close(!0)),await(this.websocketServer?.stop()),this.geoIpLocator?.stop()}}const AI=new Ta("ConnectorFacade");class SI{options;localPeerDescriptor;websocketConnectorRpcCommunicator;websocketClientConnector;websocketServerConnector;webrtcConnector;constructor(e){this.options=e}async start(e,t,r){AI.trace("Creating WebsocketConnectorRpcLocal"),this.websocketConnectorRpcCommunicator=new $P(cI.WEBSOCKET_CONNECTOR_SERVICE_ID,this.options.transport,{rpcRequestTimeout:15e3});const n={onNewConnection:e,hasConnection:t,rpcCommunicator:this.websocketConnectorRpcCommunicator};this.websocketClientConnector=new cI(n);const i={rpcCommunicator:this.websocketConnectorRpcCommunicator,onNewConnection:e,hasConnection:t,portRange:this.options.websocketPortRange,host:this.options.websocketHost,entrypoints:this.options.entryPoints,tlsCertificate:this.options.tlsCertificate,serverEnableTls:this.options.websocketServerEnableTls,autoCertifierUrl:this.options.autoCertifierUrl,autoCertifierConfigFile:this.options.autoCertifierConfigFile,autoCertifierTransport:r,maxMessageSize:this.options.maxMessageSize,geoIpDatabaseFolder:this.options.geoIpDatabaseFolder};this.websocketServerConnector=new EI(i),this.webrtcConnector=new tI({onNewConnection:e,transport:this.options.transport,iceServers:this.options.iceServers,allowPrivateAddresses:this.options.webrtcAllowPrivateAddresses,bufferThresholdLow:this.options.webrtcDatachannelBufferThresholdLow,bufferThresholdHigh:this.options.webrtcDatachannelBufferThresholdHigh,externalIp:this.options.externalIp,portRange:this.options.webrtcPortRange,maxMessageSize:this.options.maxMessageSize}),await this.websocketServerConnector.start();const s=!this.options.tlsCertificate&&!0===this.options.websocketServerEnableTls,o=await this.websocketServerConnector.checkConnectivity(s),a=await this.options.createLocalPeerDescriptor(o);if(this.setLocalPeerDescriptor(a),a.websocket&&!this.options.tlsCertificate&&this.options.websocketServerEnableTls)try{await this.websocketServerConnector.autoCertify();const e=await this.websocketServerConnector.checkConnectivity(!1),t=await this.options.createLocalPeerDescriptor(e);void 0!==t.websocket?this.setLocalPeerDescriptor(t):(AI.warn("Connectivity check failed after auto-certification, disabling WebSocket server TLS"),await this.restartWebsocketServerConnector({...i,serverEnableTls:!1}))}catch(e){AI.warn("Failed to auto-certify, disabling WebSocket server TLS",{err:e}),await this.restartWebsocketServerConnector({...i,serverEnableTls:!1})}}setLocalPeerDescriptor(e){this.localPeerDescriptor=e,this.websocketServerConnector.setLocalPeerDescriptor(e),this.websocketClientConnector.setLocalPeerDescriptor(e),this.webrtcConnector.setLocalPeerDescriptor(e)}async restartWebsocketServerConnector(e){await this.websocketServerConnector.destroy(),this.websocketServerConnector=new EI(e),await this.websocketServerConnector.start();const t=await this.websocketServerConnector.checkConnectivity(!1),r=await this.options.createLocalPeerDescriptor(t);this.setLocalPeerDescriptor(r)}createConnection(e){return this.websocketClientConnector.isPossibleToFormConnection(e)?this.websocketClientConnector.connect(e):this.websocketServerConnector.isPossibleToFormConnection(e)?this.websocketServerConnector.connect(e):this.webrtcConnector.connect(e,!1)}getLocalPeerDescriptor(){return this.localPeerDescriptor}async stop(){this.websocketConnectorRpcCommunicator.destroy(),await this.websocketServerConnector.destroy(),await this.websocketClientConnector.destroy(),await this.webrtcConnector.stop()}}function kI(e){const t=Buffer.alloc(4);return t.writeUInt32BE(e),t}const RI=new Ac;class PI{peerDescriptor;constructor(e){this.peerDescriptor=e}getPeerDescriptor(){return this.peerDescriptor}getNodeId(){return Dk(this.peerDescriptor)}}const II=(e,t,r)=>{const n=new Lk({referenceId:e,allowToContainReferenceId:!0,excludedNodeIds:r?.excludedNodeIds,maxSize:r?.maxCount});for(const e of t)n.addContact(new PI(e));return n.getClosestContacts().map(e=>e.getPeerDescriptor())},CI=new Ta("DhtNodeRpcLocal");class _I{options;constructor(e){this.options=e}async getClosestPeers(e,t){return this.options.addContact(t.incomingSourceDescriptor),{peers:II(xk(e.nodeId),this.options.getNeighbors(),{maxCount:this.options.peerDiscoveryQueryBatchSize}),requestId:e.requestId}}async getClosestRingPeers(e,t){this.options.addContact(t.incomingSourceDescriptor);const r=this.options.getClosestRingContactsTo(e.ringId,this.options.peerDiscoveryQueryBatchSize);return{leftPeers:r.left,rightPeers:r.right,requestId:e.requestId}}async ping(e,t){return CI.trace("received ping request: "+Dk(t.incomingSourceDescriptor)),setImmediate(()=>{this.options.addContact(t.incomingSourceDescriptor)}),{requestId:e.requestId}}async leaveNotice(e){const t=e.incomingSourceDescriptor,r=Dk(t);return CI.trace("received leave notice: "+r),this.options.removeContact(r),{}}}const TI=new Ta("DhtNodeRpcRemote");class NI extends EP{static counter=0;vectorClock;id;serviceId;constructor(e,t,r,n,i){super(e,t,n,QR,i),this.id=this.getPeerDescriptor().nodeId,this.vectorClock=NI.counter++,this.serviceId=r}async getClosestPeers(e){TI.trace(`Requesting getClosestPeers on ${this.serviceId} from ${this.getNodeId()}`);const t={nodeId:Ok(e),requestId:hS()};try{return(await this.getClient().getClosestPeers(t,this.formDhtRpcOptions())).peers}catch(e){throw TI.trace(`getClosestPeers error ${this.serviceId}`,{err:e}),e}}async getClosestRingPeers(e){TI.trace(`Requesting getClosestRingPeers on ${this.serviceId} from ${this.getNodeId()}`);const t={ringId:e,requestId:hS()};try{const e=await this.getClient().getClosestRingPeers(t,this.formDhtRpcOptions());return{left:e.leftPeers??[],right:e.rightPeers??[]}}catch(e){throw TI.trace(`getClosestRingPeers error ${this.serviceId}`,{err:e}),e}}async ping(){TI.trace(`Requesting ping on ${this.serviceId} from ${this.getNodeId()}`);const e={requestId:hS()},t=this.formDhtRpcOptions();try{if((await this.getClient().ping(e,t)).requestId===e.requestId)return!0}catch(e){TI.trace(`ping failed on ${this.serviceId} to ${this.getNodeId()}`,{err:e})}return!1}leaveNotice(){TI.trace(`Sending leaveNotice on ${this.serviceId} from ${this.getNodeId()}`);const e=this.formDhtRpcOptions({notification:!0});this.getClient().leaveNotice({},e).catch(e=>{TI.trace("Failed to send leaveNotice"+e)})}getNodeId(){return Dk(this.getPeerDescriptor())}}class xI{options;constructor(e){this.options=e}async externalFetchData(e,t){const r=t.incomingSourceDescriptor,n=await this.options.executeRecursiveOperation(xk(e.key),Yk.FETCH_DATA,Dk(r));return UR.create({entries:n.dataEntries??[]})}async externalStoreData(e,t){const r=t.incomingSourceDescriptor,n=await this.options.storeDataToDht(xk(e.key),e.data,Dk(r));return aR.create({storers:n})}async externalFindClosestNodes(e,t){const r=t.incomingSourceDescriptor,n=await this.options.executeRecursiveOperation(xk(e.nodeId),Yk.FIND_CLOSEST_NODES,Dk(r));return zR.create({closestNodes:n.closestNodes})}}const OI=1e4;class DI extends EP{async externalFetchData(e){const t={key:Ok(e)},r=this.formDhtRpcOptions({timeout:OI});try{return(await this.getClient().externalFetchData(t,r)).entries}catch{return[]}}async storeData(e,t){const r={key:Ok(e),data:t},n=this.formDhtRpcOptions({timeout:OI});try{return(await this.getClient().externalStoreData(r,n)).storers}catch{return[]}}async externalFindClosestNode(e){const t={nodeId:Ok(e)},r=this.formDhtRpcOptions({timeout:OI});try{return(await this.getClient().externalFindClosestNodes(t,r)).closestNodes}catch{return[]}}}class MI extends zr{contactsById=new Map;contactIds=[];localNodeId;maxSize;constructor(e,t){super(),this.localNodeId=e,this.maxSize=t}getContact(e){return this.contactsById.get(e)}getSize(){return this.contactIds.length}clear(){this.contactsById.clear(),this.contactIds=[]}stop(){this.removeAllListeners(),this.clear()}}class BI extends MI{randomness;constructor(e,t,r=.2){super(e,t),this.randomness=r}addContact(e){if(this.localNodeId!==e.getNodeId()&&!this.contactsById.has(e.getNodeId())&&Math.random()<this.randomness){if(this.getSize()===this.maxSize&&this.getSize()>0){const e=this.contactIds[0];this.removeContact(e)}this.contactIds.push(e.getNodeId()),this.contactsById.set(e.getNodeId(),e),this.emit("contactAdded",e)}}removeContact(e){if(this.contactsById.has(e)){const t=this.contactsById.get(e),r=this.contactIds.findIndex(t=>t===e);return this.contactIds.splice(r,1),this.contactsById.delete(e),this.emit("contactRemoved",t),!0}return!1}getContacts(e){return(void 0===e?this.contactIds:this.contactIds.slice(0,Math.max(e,0))).map(e=>this.contactsById.get(e))}}const LI=2**120-1,FI=e=>e.reduce((e,t)=>e<<BigInt(8)|BigInt(t),BigInt(0)),UI=e=>Number(FI(e)),jI=e=>{const t=Buffer.alloc(4);t.writeUInt32BE(e.region??0,0);const r=Buffer.alloc(4);r.writeUInt32BE(e.ipAddress??0,0);const n=[t,r,Buffer.from(e.nodeId.subarray(e.nodeId.length-7,e.nodeId.length))],i=Buffer.concat(n);return new Uint8Array(i)},zI=e=>{const t=jI(e);return Number(FI(t))},qI=(e,t)=>{const r=Math.abs(e-t);return e>t?r:LI-r},KI=(e,t)=>{const r=Math.abs(e-t);return e>t?LI-r:r};class GI extends zr{numNeighborsPerSide=5;referenceId;excludedIds;leftNeighbors;rightNeighbors;constructor(e,t){super(),this.referenceId=UI(e),this.excludedIds=t??new Set,this.leftNeighbors=new ok,this.rightNeighbors=new ok}addContact(e){const t=zI(e.getPeerDescriptor());if(t===this.referenceId||this.excludedIds.has(Dk(e.getPeerDescriptor())))return;let r=!1,n=!1;const i=qI(this.referenceId,t),s=this.leftNeighbors.back();(void 0===s||i<s[0])&&(this.leftNeighbors.setElement(i,e),r=!0,this.leftNeighbors.size()>this.numNeighborsPerSide&&(this.leftNeighbors.eraseElementByIterator(this.leftNeighbors.rBegin()),n=!0));const o=KI(this.referenceId,t),a=this.rightNeighbors.back();(void 0===a||o<a[0])&&(this.rightNeighbors.setElement(o,e),r=!0,this.rightNeighbors.size()>this.numNeighborsPerSide&&(this.rightNeighbors.eraseElementByIterator(this.rightNeighbors.rBegin()),n=!0)),this.hasEventListeners()&&(r||n)&&(r&&this.emit("contactAdded",e),n&&this.emit("contactRemoved",e))}removeContact(e){if(void 0===e)return;const t=zI(e.getPeerDescriptor()),r=qI(this.referenceId,t),n=KI(this.referenceId,t);let i=!1;this.leftNeighbors.eraseElementByKey(r)&&(i=!0),this.rightNeighbors.eraseElementByKey(n)&&(i=!0),this.hasEventListeners()&&i&&this.emit("contactRemoved",e)}getContact(e){const t=zI(e),r=qI(this.referenceId,t),n=KI(this.referenceId,t);return this.leftNeighbors.getElementByKey(r)?this.leftNeighbors.getElementByKey(r):this.rightNeighbors.getElementByKey(n)?this.rightNeighbors.getElementByKey(n):void 0}getClosestContacts(e){const t=[],r=[];let n=0;for(const r of this.leftNeighbors){if(null!=e&&n>=e)break;t.push(r[1]),n++}let i=0;for(const t of this.rightNeighbors){if(null!=e&&i>=e)break;r.push(t[1]),i++}return{left:t,right:r}}getAllContacts(){const e=[];for(const t of this.leftNeighbors)e.push(t[1]);for(const t of this.rightNeighbors)e.push(t[1]);return e}hasEventListeners(){return this.eventNames().length>0}}const $I=new Ta("PeerManager");class VI extends zr{neighbors;nearbyContacts;activeContacts;ringContacts;randomContacts;stopped=!1;options;constructor(e){super(),this.options=e,this.neighbors=new(nA())({localNodeId:Ok(this.options.localNodeId),numberOfNodesPerKBucket:this.options.numberOfNodesPerKBucket,numberOfNodesToPing:this.options.numberOfNodesPerKBucket}),this.ringContacts=new GI(jI(this.options.localPeerDescriptor)),this.ringContacts.on("contactAdded",e=>{this.emit("ringContactAdded",e.getPeerDescriptor())}),this.ringContacts.on("contactRemoved",e=>{this.emit("ringContactRemoved",e.getPeerDescriptor())}),this.neighbors.on("ping",(e,t)=>this.onKBucketPing(e,t)),this.neighbors.on("removed",e=>this.onKBucketRemoved(Dk(e.getPeerDescriptor()))),this.neighbors.on("added",e=>this.onKBucketAdded(e)),this.neighbors.on("updated",()=>{}),this.nearbyContacts=new Lk({referenceId:this.options.localNodeId,maxSize:this.options.maxContactCount,allowToContainReferenceId:!1}),this.nearbyContacts.on("contactRemoved",e=>{this.stopped||(this.emit("nearbyContactRemoved",e.getPeerDescriptor()),this.randomContacts.addContact(this.options.createDhtNodeRpcRemote(e.getPeerDescriptor())))}),this.nearbyContacts.on("contactAdded",e=>this.emit("nearbyContactAdded",e.getPeerDescriptor())),this.activeContacts=new Set,this.randomContacts=new BI(this.options.localNodeId,this.options.maxContactCount),this.randomContacts.on("contactRemoved",e=>this.emit("randomContactRemoved",e.getPeerDescriptor())),this.randomContacts.on("contactAdded",e=>this.emit("randomContactAdded",e.getPeerDescriptor()))}onKBucketPing(e,t){if(this.stopped)return;const r=new Lk({referenceId:this.options.localNodeId,allowToContainReferenceId:!1});r.addContacts(e);const n=r.getFurthestContacts(1)[0].getNodeId();this.options.connectionLocker?.weakUnlockConnection(n,this.options.lockId),this.neighbors.remove(Ok(n)),this.neighbors.add(t)}onKBucketRemoved(e){this.stopped||(this.options.connectionLocker?.weakUnlockConnection(e,this.options.lockId),$I.trace(`Removed contact ${e}`),0===this.neighbors.count()&&this.emit("kBucketEmpty"))}onKBucketAdded(e){if(!this.stopped&&e.getNodeId()!==this.options.localNodeId){const t=e.getPeerDescriptor(),r=Dk(t);this.options.connectionLocker?.weakLockConnection(r,this.options.lockId),this.options.hasConnection(e.getNodeId())||void 0!==this.options.neighborPingLimit&&this.neighbors.count()>this.options.neighborPingLimit?$I.trace(`Added new contact ${r}`):($I.trace("starting ping "+r),e.ping().then(e=>{e?$I.trace(`Added new contact ${r}`):($I.trace("ping failed "+r),this.options.connectionLocker?.weakUnlockConnection(r,this.options.lockId),this.removeContact(r),this.addNearbyContactToNeighbors())}).catch(e=>{this.options.connectionLocker?.weakUnlockConnection(r,this.options.lockId),this.removeContact(r),this.addNearbyContactToNeighbors()}))}}addNearbyContactToNeighbors(){if(this.stopped)return;const e=this.getNearbyActiveContactNotInNeighbors();e&&this.addContact(e.getPeerDescriptor())}getNearbyActiveContactNotInNeighbors(){for(const e of this.nearbyContacts.getContactIds())if(!this.neighbors.get(Ok(e))&&this.activeContacts.has(e))return this.nearbyContacts.getContact(e)}removeContact(e){this.stopped||($I.trace(`Removing contact ${e}`),this.ringContacts.removeContact(this.nearbyContacts.getContact(e)),this.neighbors.remove(Ok(e)),this.nearbyContacts.removeContact(e),this.activeContacts.delete(e),this.randomContacts.removeContact(e))}removeNeighbor(e){this.neighbors.remove(Ok(e))}async pruneOfflineNodes(e){$I.trace("Pruning offline nodes",{nodes:e.length});const t=await(async(e,t)=>{const r=[];return await Promise.allSettled(e.map(async e=>{await e.ping()?t.add(e.getNodeId()):(t.delete(e.getNodeId()),r.push(e.getPeerDescriptor()))})),r})(e,this.activeContacts);t.forEach(e=>{$I.trace("Removing offline node",{node:Dk(e)}),this.removeContact(Dk(e))})}stop(){this.stopped=!0,this.neighbors.toArray().forEach(e=>{e.leaveNotice(),this.neighbors.remove(e.id)}),this.neighbors.removeAllListeners(),this.ringContacts.getAllContacts().forEach(e=>{e.leaveNotice(),this.ringContacts.removeContact(e)}),this.nearbyContacts.stop(),this.randomContacts.stop()}getNearbyContacts(){return this.nearbyContacts}getClosestRingContactsTo(e,t,r){const n=new GI(e,r);return this.ringContacts.getAllContacts().map(e=>n.addContact(e)),n.getClosestContacts(t??8)}getRandomContacts(){return this.randomContacts}getRingContacts(){return this.ringContacts}getNearbyContactCount(e){return this.nearbyContacts.getSize(e)}getNeighborCount(){return this.neighbors.count()}getNeighbors(){return this.neighbors.toArray()}setContactActive(e){this.activeContacts.add(e)}addContact(e){if(this.stopped)return;const t=Dk(e);if(t!==this.options.localNodeId){$I.trace(`Adding new contact ${t}`);const r=this.options.createDhtNodeRpcRemote(e),n=null!==this.neighbors.get(e.nodeId),i=void 0!==this.nearbyContacts.getContact(t),s=void 0!==this.ringContacts.getContact(e);(n||i)&&this.randomContacts.addContact(r),n||this.neighbors.add(r),i||this.nearbyContacts.addContact(r),s||this.ringContacts.addContact(r)}}}const HI=new Ta("DiscoverySession");class WI{id=hS();noProgressCounter=0;ongoingRequests=new Set;doneGate=new rc(!1);options;constructor(e){this.options=e}addContacts(e){if(!this.options.abortSignal.aborted&&!this.doneGate.isOpen())for(const t of e)this.options.peerManager.addContact(t)}async fetchClosestNeighborsFromRemote(e){if(this.options.abortSignal.aborted||this.doneGate.isOpen())return[];const t=Dk(e);HI.trace(`Getting closest neighbors from remote: ${t}`),this.options.contactedPeers.add(t);const r=this.options.createDhtNodeRpcRemote(e),n=await r.getClosestPeers(this.options.targetId);return this.options.peerManager.setContactActive(t),n}onRequestSucceeded(e,t){if(!this.ongoingRequests.has(e))return;this.ongoingRequests.delete(e);const r=Ok(this.options.targetId),n=this.getClosestNeighbor(),i=Nk(r,n.nodeId);this.addContacts(t);const s=this.getClosestNeighbor();Nk(r,s.nodeId)>=i&&this.noProgressCounter++}getClosestNeighbor(){return II(this.options.targetId,this.options.peerManager.getNeighbors().map(e=>e.getPeerDescriptor()),{maxCount:1})[0]}onRequestFailed(e){this.ongoingRequests.has(e)&&(this.ongoingRequests.delete(e),this.options.peerManager.removeContact(e))}findMoreContacts(){if(this.options.abortSignal.aborted||this.doneGate.isOpen())return;const e=II(this.options.targetId,Array.from(this.options.peerManager.getNearbyContacts().getAllContactsInUndefinedOrder(),e=>e.getPeerDescriptor()),{maxCount:this.options.parallelism,excludedNodeIds:this.options.contactedPeers});if(0===e.length&&0===this.ongoingRequests.size||this.noProgressCounter>=this.options.noProgressLimit)this.doneGate.open();else for(const t of e){if(this.ongoingRequests.size>=this.options.parallelism)break;const e=Dk(t);this.ongoingRequests.add(e),this.fetchClosestNeighborsFromRemote(t).then(t=>this.onRequestSucceeded(e,t)).catch(()=>this.onRequestFailed(e)).finally(()=>{this.findMoreContacts()})}}async findClosestNodes(e){0!==this.options.peerManager.getNearbyContactCount(this.options.contactedPeers)&&(setImmediate(()=>{this.findMoreContacts()}),await Va(this.doneGate.waitUntilOpen(),e,"discovery session timed out",this.options.abortSignal))}}const JI=new Ta("RingDiscoverySession");class ZI{id=hS();noProgressCounter=0;ongoingRequests=new Set;doneGate=new rc(!1);options;numContactedPeers=0;targetIdAsRingId;constructor(e){this.options=e,this.targetIdAsRingId=UI(this.options.targetId)}addContacts(e){if(!this.options.abortSignal.aborted&&!this.doneGate.isOpen())for(const t of e)this.options.peerManager.addContact(t)}async fetchClosestContactsFromRemote(e){if(this.options.abortSignal.aborted||this.doneGate.isOpen())return{left:[],right:[]};JI.trace(`Getting closest ring peers from contact: ${Dk(e.getPeerDescriptor())}`),this.numContactedPeers++,this.options.contactedPeers.add(e.getNodeId());const t=await e.getClosestRingPeers(this.options.targetId);return this.options.peerManager.setContactActive(e.getNodeId()),t}onRequestSucceeded(e,t){if(!this.ongoingRequests.has(e))return;this.ongoingRequests.delete(e);const r=this.options.peerManager.getClosestRingContactsTo(this.options.targetId,1),n=qI(this.targetIdAsRingId,zI(r.left[0].getPeerDescriptor())),i=qI(this.targetIdAsRingId,zI(r.right[0].getPeerDescriptor()));this.addContacts(t.left.concat(t.right));const s=this.options.peerManager.getClosestRingContactsTo(this.options.targetId,1),o=qI(this.targetIdAsRingId,zI(s.left[0].getPeerDescriptor())),a=qI(this.targetIdAsRingId,zI(s.right[0].getPeerDescriptor()));o>=n&&a>=i&&this.noProgressCounter++}onRequestFailed(e){this.ongoingRequests.has(e.getNodeId())&&(this.ongoingRequests.delete(e.getNodeId()),this.options.peerManager.removeContact(e.getNodeId()))}findMoreContacts(){if(this.options.abortSignal.aborted||this.doneGate.isOpen())return;const e=this.options.peerManager.getClosestRingContactsTo(this.options.targetId,this.options.parallelism,this.options.contactedPeers);if(0===e.left.length&&0===e.right.length||this.noProgressCounter>=this.options.noProgressLimit)return void this.doneGate.open();const t=[],r=new Set,n=Math.max(e.left.length,e.right.length);for(let i=0;i<n;i++)i<e.left.length&&(r.has(e.left[i].getNodeId())||(t.push(e.left[i]),r.add(e.left[i].getNodeId()))),i<e.right.length&&(r.has(e.right[i].getNodeId())||(t.push(e.right[i]),r.add(e.right[i].getNodeId())));for(const e of t){if(this.ongoingRequests.size>=this.options.parallelism)break;this.ongoingRequests.add(e.getNodeId()),this.fetchClosestContactsFromRemote(e).then(t=>this.onRequestSucceeded(e.getNodeId(),t)).catch(()=>this.onRequestFailed(e)).finally(()=>{this.findMoreContacts()})}}async findClosestNodes(e){0!==this.options.peerManager.getNearbyContactCount(this.options.contactedPeers)&&(setImmediate(()=>{this.findMoreContacts()}),await Va(this.doneGate.waitUntilOpen(),e,"discovery session timed out",this.options.abortSignal))}}const QI="layer0",YI=new Ta("PeerDiscovery");class XI{ongoingDiscoverySessions=new Map;ongoingRingDiscoverySessions=new Map;rejoinOngoing=!1;joinCalled=!1;recoveryIntervalStarted=!1;options;constructor(e){this.options=e}async joinDht(e,t=!0,r=!0){const n=new Set,i=t?{enabled:!0,contactedPeers:new Set}:{enabled:!1};await Promise.all(e.map(e=>this.joinThroughEntryPoint(e,n,i,r)))}async joinThroughEntryPoint(e,t,r,n=!0){if(this.isStopped())return;if(this.joinCalled=!0,YI.debug("Joining "+(this.options.serviceId===QI?"The Streamr Network":`Control Layer for ${this.options.serviceId}`)+` via entrypoint ${Dk(e)}`),Mk(e,this.options.localPeerDescriptor))return;this.options.connectionLocker?.lockConnection(e,`${this.options.serviceId}::joinDht`),this.options.peerManager.addContact(e);const i=Dk(this.options.localPeerDescriptor),s=[this.createSession(i,t)];r.enabled&&s.push(this.createSession((e=>{const t=Ok(e).map(e=>~e);return xk(t)})(i),r.contactedPeers)),await this.runSessions(s,e,n),this.options.connectionLocker?.unlockConnection(e,`${this.options.serviceId}::joinDht`)}async joinRing(){const e=new Set,t=[this.createRingSession(jI(this.options.localPeerDescriptor),e)];await this.runRingSessions(t)}createSession(e,t){const r={targetId:e,parallelism:this.options.parallelism,noProgressLimit:this.options.joinNoProgressLimit,peerManager:this.options.peerManager,contactedPeers:t,abortSignal:this.options.abortSignal,createDhtNodeRpcRemote:this.options.createDhtNodeRpcRemote};return new WI(r)}createRingSession(e,t){const r={targetId:e,parallelism:this.options.parallelism,noProgressLimit:this.options.joinNoProgressLimit,peerManager:this.options.peerManager,contactedPeers:t,abortSignal:this.options.abortSignal,createDhtNodeRpcRemote:this.options.createDhtNodeRpcRemote};return new ZI(r)}async runSessions(e,t,r){try{for(const t of e)this.ongoingDiscoverySessions.set(t.id,t),await t.findClosestNodes(this.options.joinTimeout)}catch(e){YI.debug(`DHT join on ${this.options.serviceId} timed out`)}finally{this.isStopped()||(0===this.options.peerManager.getNeighborCount()?r&&Zi(()=>this.rejoinDht(t),1e3,this.options.abortSignal):await this.ensureRecoveryIntervalIsRunning()),e.forEach(e=>this.ongoingDiscoverySessions.delete(e.id))}}async runRingSessions(e){try{for(const t of e)this.ongoingRingDiscoverySessions.set(t.id,t),await t.findClosestNodes(this.options.joinTimeout)}catch(e){YI.debug(`Ring join on ${this.options.serviceId} timed out`)}finally{e.forEach(e=>this.ongoingDiscoverySessions.delete(e.id))}}async rejoinDht(e,t=new Set,r=new Set){if(!this.isStopped()&&!this.rejoinOngoing){YI.debug(`Rejoining DHT ${this.options.serviceId}`),this.rejoinOngoing=!0;try{await this.joinThroughEntryPoint(e,t,{enabled:!0,contactedPeers:r}),YI.debug(`Rejoined DHT successfully ${this.options.serviceId}!`)}catch{YI.warn(`Rejoining DHT ${this.options.serviceId} failed`),this.isStopped()||Zi(()=>this.rejoinDht(e),5e3,this.options.abortSignal)}finally{this.rejoinOngoing=!1}}}async ensureRecoveryIntervalIsRunning(){this.recoveryIntervalStarted||(this.recoveryIntervalStarted=!0,await Ka(()=>this.fetchClosestAndRandomNeighbors(),6e4,!0,this.options.abortSignal))}async fetchClosestAndRandomNeighbors(){if(this.isStopped())return;const e=Dk(this.options.localPeerDescriptor),t=this.getClosestNeighbors(e,this.options.parallelism),r=this.getClosestNeighbors(Bk(),1);await Promise.allSettled([...t.map(async t=>{const r=this.options.createDhtNodeRpcRemote(t),n=await r.getClosestPeers(e);for(const e of n)this.options.peerManager.addContact(e)}),...r.map(async e=>{const t=this.options.createDhtNodeRpcRemote(e),r=await t.getClosestPeers(Bk());for(const e of r)this.options.peerManager.addContact(e)})])}getClosestNeighbors(e,t){return II(e,this.options.peerManager.getNeighbors().map(e=>e.getPeerDescriptor()),{maxCount:t})}isJoinOngoing(){return!this.joinCalled||this.ongoingDiscoverySessions.size>0}isJoinCalled(){return this.joinCalled}isStopped(){return this.options.abortSignal.aborted}}const eC=e=>ck()(e.routingPath),tC=new Ta("RouterRpcRemote");class rC extends EP{async routeMessage(e){const t={target:e.target,sourcePeer:e.sourcePeer,message:e.message,requestId:e.requestId??hS(),reachableThrough:e.reachableThrough??[],routingPath:e.routingPath,parallelRootNodeIds:e.parallelRootNodeIds},r=this.formDhtRpcOptions({connect:!1});try{const n=await this.getClient().routeMessage(t,r);if(n.error===tR.DUPLICATE&&go(e.target,this.getPeerDescriptor().nodeId))return!0;if(void 0!==n.error)return!1}catch(t){const r=eC(e),n=Dk(r||e.sourcePeer),i=Dk(this.getPeerDescriptor());return tC.trace(`Failed to send routeMessage from ${n} to ${i}`,{err:t}),!1}return!0}async forwardMessage(e){const t={target:e.target,sourcePeer:e.sourcePeer,message:e.message,requestId:e.requestId??hS(),reachableThrough:e.reachableThrough??[],routingPath:e.routingPath,parallelRootNodeIds:e.parallelRootNodeIds},r=this.formDhtRpcOptions({connect:!1});try{if(void 0!==(await this.getClient().forwardMessage(t,r)).error)return!1}catch(t){const r=eC(e),n=Dk(r||e.sourcePeer),i=Dk(this.getPeerDescriptor());return tC.trace(`Failed to send forwardMessage from ${n} to ${i}`,{err:t}),!1}return!0}}const nC=new Ta("RecursiveOperationRpcRemote");class iC extends EP{async routeRequest(e){const t={target:e.target,sourcePeer:e.sourcePeer,message:e.message,requestId:e.requestId??hS(),reachableThrough:e.reachableThrough??[],routingPath:e.routingPath,parallelRootNodeIds:e.parallelRootNodeIds},r=this.formDhtRpcOptions({connect:!1});try{const e=await this.getClient().routeRequest(t,r);if(void 0!==e.error)return nC.trace("Next hop responded with error "+e.error),!1}catch(t){const r=eC(e),n=Dk(r||e.sourcePeer),i=Dk(this.getPeerDescriptor());return nC.debug(`Failed to send routeRequest message from ${n} to ${i}`,{err:t}),!1}return!0}}const sC=new Ta("RoutingSession");class oC extends PI{routerRpcRemote;recursiveOperationRpcRemote;constructor(e,t,r){super(e),this.routerRpcRemote=new rC(t,e,r,YR,2e3),this.recursiveOperationRpcRemote=new iC(t,e,r,XR,2e3)}getRouterRpcRemote(){return this.routerRpcRemote}getRecursiveOperationRpcRemote(){return this.recursiveOperationRpcRemote}}var aC;!function(e){e[e.ROUTE=0]="ROUTE",e[e.FORWARD=1]="FORWARD",e[e.RECURSIVE=2]="RECURSIVE"}(aC||(aC={}));class cC extends zr{sessionId=hS();ongoingRequests=new Set;contactedPeers=new Set;failedHopCounter=0;successfulHopCounter=0;stopped=!1;options;constructor(e){super(),this.options=e}onRequestFailed(e){if(sC.trace("onRequestFailed() sessionId: "+this.sessionId),this.stopped)return;if(this.ongoingRequests.has(e)&&this.ongoingRequests.delete(e),this.deleteParallelRootIfSource(e),this.failedHopCounter+=1,this.failedHopCounter>=2)return sC.trace(`Stopping routing after 2 failed attempts for sessionId: ${this.sessionId}`),void this.emitFailure();const t=this.updateAndGetRoutablePeers();0===t.length&&0===this.ongoingRequests.size?(sC.trace("routing failed, emitting routingFailed sessionId: "+this.sessionId),this.emitFailure()):(sC.trace("routing failed, retrying to route sessionId: "+this.sessionId+" failedHopCounter: "+this.failedHopCounter),this.sendMoreRequests(t))}emitFailure(){this.successfulHopCounter>=1?this.emit("partialSuccess"):this.emit("routingFailed")}onRequestSucceeded(){if(sC.trace("onRequestSucceeded() sessionId: "+this.sessionId),this.stopped)return;if(this.successfulHopCounter+=1,this.successfulHopCounter>=this.options.parallelism)return void this.emit("routingSucceeded");const e=this.updateAndGetRoutablePeers();0===e.length?this.emit("routingSucceeded"):e.length>0&&0===this.ongoingRequests.size&&this.sendMoreRequests(e)}async sendRouteMessageRequest(e){if(this.stopped)return!1;const t={...this.options.routedMessage,routingPath:this.options.routedMessage.routingPath.concat([this.options.localPeerDescriptor])};return this.options.mode===aC.FORWARD?e.getRouterRpcRemote().forwardMessage(t):this.options.mode===aC.RECURSIVE?e.getRecursiveOperationRpcRemote().routeRequest(t):e.getRouterRpcRemote().routeMessage(t)}updateAndGetRoutablePeers(){sC.trace("getRoutablePeers() sessionId: "+this.sessionId);const e=eC(this.options.routedMessage),t=e?Dk(e):void 0,r=xk(this.options.routedMessage.target);let n;if(this.options.routingTablesCache.has(r,t)&&this.options.routingTablesCache.get(r,t).getSize()>0)n=this.options.routingTablesCache.get(r,t);else{n=new Lk({referenceId:xk(this.options.routedMessage.target),maxSize:5,allowToContainReferenceId:!0,nodeIdDistanceLimit:t});const e=this.options.getConnections().map(e=>new oC(e,this.options.localPeerDescriptor,this.options.rpcCommunicator));n.addContacts(e),this.options.routingTablesCache.set(r,n,t)}return n.getClosestContacts().filter(e=>!this.contactedPeers.has(e.getNodeId())&&!this.options.excludedNodeIds.has(e.getNodeId()))}sendMoreRequests(e){if(sC.trace("sendMoreRequests() sessionId: "+this.sessionId),!this.stopped)if(0!==e.length)for(;this.ongoingRequests.size<this.options.parallelism&&e.length>0&&!this.stopped;){const t=e.shift();sC.trace(`Sending routeMessage request to contact: ${Dk(t.getPeerDescriptor())} (sessionId=${this.sessionId})`),this.contactedPeers.add(t.getNodeId()),this.ongoingRequests.add(t.getNodeId()),this.addParallelRootIfSource(t.getNodeId()),setImmediate(async()=>{try{await this.sendRouteMessageRequest(t)?this.onRequestSucceeded():this.onRequestFailed(t.getNodeId())}catch(e){sC.debug("Unable to route message ",{err:e})}finally{sC.trace("sendRouteMessageRequest returned")}})}else this.emitFailure()}addParallelRootIfSource(e){this.options.mode===aC.RECURSIVE&&Mk(this.options.localPeerDescriptor,this.options.routedMessage.sourcePeer)&&this.options.routedMessage.parallelRootNodeIds.push(e)}deleteParallelRootIfSource(e){this.options.mode===aC.RECURSIVE&&Mk(this.options.localPeerDescriptor,this.options.routedMessage.sourcePeer)&&lk()(this.options.routedMessage.parallelRootNodeIds,e)}stop(){this.stopped=!0,this.emit("stopped"),this.removeAllListeners()}}const uC=new Ta("RecursiveOperationSessionRpcRemote");class lC extends EP{sendResponse(e,t,r,n){const i={routingPath:e,closestConnectedNodes:t,dataEntries:r,noCloserNodesFound:n};this.getClient().sendResponse(i,this.formDhtRpcOptions()).catch(e=>{uC.trace("Failed to send RecursiveOperationResponse")})}}const dC=new Ta("RecursiveOperationSessionRpcLocal");class hC{options;constructor(e){this.options=e}async sendResponse(e,t){const r=Dk(t.incomingSourceDescriptor);return dC.trace("RecursiveOperationResponse arrived: "+JSON.stringify(e)),this.options.onResponseReceived(r,e.routingPath,e.closestConnectedNodes,e.dataEntries,e.noCloserNodesFound),{}}}const fC=1e4;class pC extends zr{id=hS();rpcCommunicator;results;foundData=new Map;allKnownHops=new Set;reportedHops=new Set;timeoutTask;completionEventEmitted=!1;noCloserNodesReceivedCounter=0;noCloserNodesReceivedFrom=new Set;options;constructor(e){super(),this.options=e,this.results=new Lk({referenceId:e.targetId,maxSize:10,allowToContainReferenceId:!0}),this.rpcCommunicator=new $P(this.id,e.transport,{rpcRequestTimeout:fC}),this.registerLocalRpcMethods()}registerLocalRpcMethods(){const e=new hC({onResponseReceived:(e,t,r,n,i)=>{this.onResponseReceived(e,t,r,n,i)}});this.rpcCommunicator.registerRpcNotification(gR,"sendResponse",(t,r)=>e.sendResponse(t,r))}start(e){const t=this.wrapRequest(e);this.options.doRouteRequest(t)}wrapRequest(e){const t={sessionId:this.getId(),operation:this.options.operation};return{message:{messageId:hS(),serviceId:e,body:{oneofKind:"recursiveOperationRequest",recursiveOperationRequest:t}},requestId:hS(),target:Ok(this.options.targetId),sourcePeer:this.options.localPeerDescriptor,reachableThrough:[],routingPath:[],parallelRootNodeIds:[]}}isCompleted(){const e=new Set(this.allKnownHops);return this.reportedHops.forEach(t=>{e.delete(t)}),this.noCloserNodesReceivedCounter>=1&&0===e.size&&(!(this.options.operation!==Yk.FETCH_DATA||!(this.hasNonStaleData()||this.noCloserNodesReceivedCounter>=this.options.waitedRoutingPathCompletions))||this.options.operation!==Yk.FETCH_DATA)}hasNonStaleData(){return Array.from(this.foundData.values()).some(e=>!1===e.stale)}onResponseReceived(e,t,r,n,i){this.addKnownHops(t),t.length>=1&&this.setHopAsReported(t[t.length-1]),r.forEach(e=>{this.results.addContact(new PI(e))}),this.processFoundData(n),(i||this.noCloserNodesReceivedFrom.has(e))&&this.onNoCloserPeersFound(e)}addKnownHops(e){const t=Dk(this.options.localPeerDescriptor);e.forEach(e=>{const r=Dk(e);t!==r&&this.allKnownHops.add(r)})}setHopAsReported(e){const t=Dk(this.options.localPeerDescriptor),r=Dk(e);t!==r&&this.reportedHops.add(r),this.isCompleted()&&!this.completionEventEmitted&&this.isCompleted()&&(this.timeoutTask&&(clearTimeout(this.timeoutTask),this.timeoutTask=void 0),this.emit("completed"),this.completionEventEmitted=!0)}processFoundData(e){e.forEach(e=>{const t=xk(e.creator),r=this.foundData.get(t);(!r||r.createdAt<e.createdAt||r.createdAt<=e.createdAt&&e.deleted)&&this.foundData.set(t,e)})}onNoCloserPeersFound(e){this.noCloserNodesReceivedCounter+=1,this.noCloserNodesReceivedFrom.add(e),this.isCompleted()?(this.emit("completed"),this.completionEventEmitted=!0,this.timeoutTask&&(clearTimeout(this.timeoutTask),this.timeoutTask=void 0)):this.timeoutTask||this.completionEventEmitted||(this.timeoutTask=setTimeout(()=>{this.completionEventEmitted||(this.emit("completed"),this.completionEventEmitted=!0)},4e3))}getResults(){return{closestNodes:this.results.getClosestContacts().map(e=>e.getPeerDescriptor()),dataEntries:Array.from(this.foundData.values())}}getId(){return this.id}stop(){this.timeoutTask&&(clearTimeout(this.timeoutTask),this.timeoutTask=void 0),this.rpcCommunicator.destroy(),this.emit("completed")}}const gC=new Ta("RouterRpcLocal"),mC=(e,t)=>({requestId:e.requestId,error:t});class yC{options;constructor(e){this.options=e}async routeMessage(e){return this.options.duplicateRequestDetector.isMostLikelyDuplicate(e.requestId)?(gC.trace(`Routing message ${e.requestId} from ${Dk(e.sourcePeer)} to ${xk(e.target)} is likely a duplicate`),mC(e,tR.DUPLICATE)):(gC.trace(`Processing received routeMessage ${e.requestId}`),this.options.duplicateRequestDetector.add(e.requestId),go(this.options.localPeerDescriptor.nodeId,e.target)?(gC.trace(`routing message targeted to self ${e.requestId}`),this.options.setForwardingEntries(e),this.options.handleMessage(e.message),mC(e)):this.options.doRouteMessage(e))}async forwardMessage(e){return this.options.duplicateRequestDetector.isMostLikelyDuplicate(e.requestId)?(gC.trace(`Forwarding message ${e.requestId} from ${Dk(e.sourcePeer)} to ${xk(e.target)} is likely a duplicate`),mC(e,tR.DUPLICATE)):(gC.trace(`Processing received forward routeMessage ${e.requestId}`),this.options.duplicateRequestDetector.add(e.requestId),go(this.options.localPeerDescriptor.nodeId,e.target)?this.forwardToDestination(e):this.options.doRouteMessage(e,aC.FORWARD))}forwardToDestination(e){gC.trace(`Forwarding found message targeted to self ${e.requestId}`);const t=e.message;return Mk(this.options.localPeerDescriptor,t.targetDescriptor)?(this.options.handleMessage(t),mC(e)):this.options.doRouteMessage({...e,requestId:hS(),target:t.targetDescriptor.nodeId})}}const bC=new Ta("RecursiveOperationRpcLocal");class wC{options;constructor(e){this.options=e}async routeRequest(e){if(this.options.isMostLikelyDuplicate(e.requestId))return mC(e,tR.DUPLICATE);const t=Dk(eC(e)??e.sourcePeer);return bC.trace(`Received routeRequest call from ${t}`),this.options.addToDuplicateDetector(e.requestId),this.options.doRouteRequest(e)}}const vC=new Ta("RecursiveOperationManager");class EC{ongoingSessions=new Map;stopped=!1;options;constructor(e){this.options=e,this.registerLocalRpcMethods()}registerLocalRpcMethods(){const e=new wC({doRouteRequest:e=>this.doRouteRequest(e),addContact:e=>this.options.addContact(e),isMostLikelyDuplicate:e=>this.options.router.isMostLikelyDuplicate(e),addToDuplicateDetector:e=>this.options.router.addToDuplicateDetector(e)});this.options.rpcCommunicator.registerRpcMethod(ER,AR,"routeRequest",async t=>this.stopped?mC(t,tR.STOPPED):e.routeRequest(t))}async execute(e,t,r,n=!0){if(this.stopped)return{closestNodes:[]};const i=new pC({transport:this.options.sessionTransport,targetId:e,localPeerDescriptor:this.options.localPeerDescriptor,waitedRoutingPathCompletions:this.options.connectionsView.getConnectionCount()>1?2:1,operation:t,doRouteRequest:e=>this.doRouteRequest(e,r)});if(0===this.options.connectionsView.getConnectionCount()){const t=Array.from(this.options.localDataStore.values(e));return i.onResponseReceived(Dk(this.options.localPeerDescriptor),[this.options.localPeerDescriptor],[this.options.localPeerDescriptor],t,!0),i.getResults()}if(this.ongoingSessions.set(i.getId(),i),!0===n)try{const e=Ha(i,"completed",fC);i.start(this.options.serviceId),await e}catch(e){vC.debug("start failed",{err:e})}else i.start(this.options.serviceId),await Ga(50);if(t===Yk.FETCH_DATA){const t=Array.from(this.options.localDataStore.values(e));t.length>0&&this.sendResponse([this.options.localPeerDescriptor],this.options.localPeerDescriptor,i.getId(),[],t,!0)}else t===Yk.DELETE_DATA&&this.options.localDataStore.markAsDeleted(e,Dk(this.options.localPeerDescriptor));return this.ongoingSessions.delete(i.getId()),i.stop(),i.getResults()}sendResponse(e,t,r,n,i,s=!1){if(Mk(this.options.localPeerDescriptor,t)&&this.ongoingSessions.has(r))this.ongoingSessions.get(r).onResponseReceived(Dk(this.options.localPeerDescriptor),e,n,i,s);else{const o=new $P(r,this.options.sessionTransport,{rpcRequestTimeout:fC});new lC(this.options.localPeerDescriptor,t,o,tP,1e4).sendResponse(e,n,i,s),o.destroy()}}doRouteRequest(e,t){if(this.stopped)return mC(e,tR.STOPPED);const r=xk(e.target),n=e.message.body.recursiveOperationRequest,i=this.getClosestConnectedNodes(r,5),s=n.operation===Yk.FETCH_DATA?Array.from(this.options.localDataStore.values(r)):[];if(n.operation===Yk.DELETE_DATA&&this.options.localDataStore.markAsDeleted(r,Dk(e.sourcePeer)),go(this.options.localPeerDescriptor.nodeId,e.target))return this.sendResponse(e.routingPath,e.sourcePeer,n.sessionId,i,s,!0),mC(e);{const o=this.options.router.doRouteMessage(e,aC.RECURSIVE,t);if(void 0===o.error||o.error===tR.NO_TARGETS){const t=o.error===tR.NO_TARGETS||i.length>0&&eC(e)&&!this.isPeerCloserToIdThanSelf(i[0],r);this.sendResponse(e.routingPath,e.sourcePeer,n.sessionId,i,s,t)}return o}}getClosestConnectedNodes(e,t){const r=this.options.connectionsView.getConnections().map(e=>this.options.createDhtNodeRpcRemote(e)),n=new Lk({referenceId:e,maxSize:t,allowToContainReferenceId:!0});return n.addContacts(r),n.getClosestContacts(t).map(e=>e.getPeerDescriptor())}isPeerCloserToIdThanSelf(e,t){const r=Ok(t);return Nk(e.nodeId,r)<Nk(this.options.localPeerDescriptor.nodeId,r)}stop(){this.stopped=!0,this.ongoingSessions.forEach((e,t)=>{e.stop()}),this.ongoingSessions.clear()}}const AC=(e,t)=>e+(t??""),SC={max:1e3,maxAge:15e3};class kC{tables=new Ek(SC);get(e,t){return this.tables.get(AC(e,t))}set(e,t,r){this.tables.set(AC(e,r),t)}has(e,t){return this.tables.has(AC(e,t))}onNodeDisconnected(e){this.tables.forEach(t=>t.removeContact(e))}onNodeConnected(e){this.tables.forEach(t=>t.addContact(e))}reset(){this.tables.forEach(e=>e.stop()),this.tables.clear()}}const RC=new Ta("Router");class PC{forwardingTable=new Map;routingTablesCache=new kC;ongoingRoutingSessions=new Map;duplicateRequestDetector=new Fk(1e4);stopped=!1;options;messagesRouted=0;messagesSent=0;constructor(e){this.options=e,this.registerLocalRpcMethods()}registerLocalRpcMethods(){const e=new yC({doRouteMessage:(e,t)=>this.doRouteMessage(e,t),setForwardingEntries:e=>this.setForwardingEntries(e),duplicateRequestDetector:this.duplicateRequestDetector,localPeerDescriptor:this.options.localPeerDescriptor,handleMessage:this.options.handleMessage});this.options.rpcCommunicator.registerRpcMethod(ER,AR,"routeMessage",async t=>this.stopped?mC(t,tR.STOPPED):e.routeMessage(t)),this.options.rpcCommunicator.registerRpcMethod(ER,AR,"forwardMessage",async t=>this.stopped?mC(t,tR.STOPPED):e.forwardMessage(t))}send(e,t){e.sourceDescriptor=this.options.localPeerDescriptor;const r=e.targetDescriptor,n=this.forwardingTable.get(Dk(r));if(n&&n.peerDescriptors.length>0){const r={message:e,requestId:hS(),target:n.peerDescriptors[0].nodeId,sourcePeer:this.options.localPeerDescriptor,reachableThrough:t,routingPath:[],parallelRootNodeIds:[]},i=this.doRouteMessage(r,aC.FORWARD);if(void 0!==i.error){const e="Could not forward message with error "+i.error;throw RC.debug(e),new Error(e)}}else{const n={message:e,requestId:hS(),target:r.nodeId,sourcePeer:this.options.localPeerDescriptor,reachableThrough:t,routingPath:[],parallelRootNodeIds:[]},i=this.doRouteMessage(n,aC.ROUTE);if(void 0!==i.error){const e="Could not route message with error "+i.error;throw RC.debug(e),new Error(e)}}this.messagesSent+=1}doRouteMessage(e,t=aC.ROUTE,r){if(this.stopped)return mC(e,tR.STOPPED);RC.trace(`Routing message ${e.requestId} from ${Dk(e.sourcePeer)} to ${xk(e.target)}`);const n=this.createRoutingSession(e,t,r),i=n.updateAndGetRoutablePeers();if(i.length>0){this.addRoutingSession(n),RC.trace("starting to raceForEvent from routingSession: "+n.sessionId);const t=Wa(n,["routingSucceeded","partialSuccess","routingFailed","stopped"],1e4);return setImmediate(async()=>{try{await t,RC.trace("raceForEvent ended from routingSession: "+n.sessionId)}catch{RC.trace("raceForEvent timed out for routingSession "+n.sessionId)}n.stop(),this.removeRoutingSession(n.sessionId)}),n.sendMoreRequests(i),this.messagesRouted+=1,mC(e)}return RC.trace("no targets",{sessionId:n.sessionId}),mC(e,tR.NO_TARGETS)}createRoutingSession(e,t,r){const n=new Set(e.routingPath.map(e=>Dk(e)));return r&&n.add(r),e.parallelRootNodeIds.forEach(e=>{n.add(e)}),new cC({rpcCommunicator:this.options.rpcCommunicator,localPeerDescriptor:this.options.localPeerDescriptor,routedMessage:e,parallelism:Mk(this.options.localPeerDescriptor,e.sourcePeer)?2:1,mode:t,excludedNodeIds:n,routingTablesCache:this.routingTablesCache,getConnections:this.options.getConnections})}isMostLikelyDuplicate(e){return this.duplicateRequestDetector.isMostLikelyDuplicate(e)}addToDuplicateDetector(e){this.duplicateRequestDetector.add(e)}addRoutingSession(e){this.ongoingRoutingSessions.set(e.sessionId,e)}removeRoutingSession(e){this.ongoingRoutingSessions.delete(e)}onNodeConnected(e){const t=new oC(e,this.options.localPeerDescriptor,this.options.rpcCommunicator);this.routingTablesCache.onNodeConnected(t)}onNodeDisconnected(e){this.routingTablesCache.onNodeDisconnected(Dk(e))}resetCache(){this.routingTablesCache.reset()}stop(){this.stopped=!0,this.ongoingRoutingSessions.forEach((e,t)=>{e.stop()}),this.ongoingRoutingSessions.clear(),this.forwardingTable.forEach(e=>{clearTimeout(e.timeout)}),this.forwardingTable.clear(),this.duplicateRequestDetector.clear(),this.routingTablesCache.reset()}getDiagnosticInfo(){return{messagesRouted:this.messagesRouted,messagesSent:this.messagesSent}}setForwardingEntries(e){const t=e.reachableThrough.filter(e=>!Mk(e,this.options.localPeerDescriptor));if(t.length>0){const r=Dk(e.sourcePeer);if(this.forwardingTable.has(r)){const e=this.forwardingTable.get(r);clearTimeout(e.timeout),this.forwardingTable.delete(r)}const n={peerDescriptors:t,timeout:setTimeout(()=>{this.forwardingTable.delete(r)},1e4)};this.forwardingTable.set(r,n)}}}class IC{maxTtl;constructor(e){this.maxTtl=e}store=new Map;storeEntry(e){const t=xk(e.key),r=xk(e.creator);if(this.store.has(t)||this.store.set(t,new lc(e=>Math.min(e.ttl,this.maxTtl))),this.store.get(t).has(r)){const n=1e3*e.createdAt.seconds+e.createdAt.nanos/1e6,i=this.store.get(t).get(r);if(1e3*i.createdAt.seconds+i.createdAt.nanos/1e6>=n)return!1}return this.store.get(t).set(r,e),!0}markAsDeleted(e,t){const r=this.store.get(e);return!!r?.has(t)&&(r.get(t).deleted=!0,!0)}*values(e){if(void 0!==e){const t=this.store.get(e);void 0!==t&&(yield*t.values())}else for(const e of this.store.values())yield*e.values()}keys(){return this.store.keys()}setAllEntriesAsStale(e){this.store.get(e)?.forEach(e=>{e.stale=!0})}deleteEntry(e,t){const r=this.store.get(e)?.get(t);r&&(this.store.get(e)?.delete(t),0===this.store.get(e)?.size()&&this.store.delete(e))}clear(){this.store.forEach(e=>e.clear()),this.store.clear()}}const CC=new Ta("StoreRpcLocal");class _C{options;constructor(e){this.options=e}async storeData(e){CC.trace("storeData()");const t=xk(e.key),r=this.isLocalNodeStorer(t);return this.options.localDataStore.storeEntry({key:e.key,data:e.data,creator:e.creator,createdAt:e.createdAt,storedAt:Qk.now(),ttl:e.ttl,stale:!r,deleted:!1}),r||this.options.localDataStore.setAllEntriesAsStale(t),{}}async replicateData(e,t){CC.trace("server-side replicateData()");const r=e.entry;this.options.localDataStore.storeEntry(r)&&this.replicateDataToNeighbors(t.incomingSourceDescriptor,e.entry);const n=xk(r.key);return this.isLocalNodeStorer(n)||this.options.localDataStore.setAllEntriesAsStale(n),CC.trace("server-side replicateData() at end"),{}}isLocalNodeStorer(e){return this.options.getStorers(e).some(e=>Mk(e,this.options.localPeerDescriptor))}replicateDataToNeighbors(e,t){const r=xk(t.key),n=this.options.getStorers(r);(Mk(n[0],this.options.localPeerDescriptor)?n:[n[0]]).filter(t=>!Mk(t,e)&&!Mk(t,this.options.localPeerDescriptor)).forEach(e=>{setImmediate(()=>{ac(()=>this.options.replicateDataToContact(t,e))})})}}const TC=new Ta("StoreManager");class NC{options;constructor(e){this.options=e,this.registerLocalRpcMethods()}registerLocalRpcMethods(){const e=new _C({localPeerDescriptor:this.options.localPeerDescriptor,localDataStore:this.options.localDataStore,replicateDataToContact:(e,t)=>this.replicateDataToContact(e,t),getStorers:e=>this.getStorers(e)});this.options.rpcCommunicator.registerRpcMethod(iR,sR,"storeData",t=>e.storeData(t)),this.options.rpcCommunicator.registerRpcNotification(cR,"replicateData",(t,r)=>e.replicateData(t,r))}onContactAdded(e){for(const t of this.options.localDataStore.keys())this.replicateAndUpdateStaleState(t,e)}replicateAndUpdateStaleState(e,t){const r=this.getStorers(e),n=r.filter(e=>!Mk(e,t));Mk(n[0],this.options.localPeerDescriptor)?r.some(e=>Mk(e,t))&&setImmediate(async()=>{const r=Array.from(this.options.localDataStore.values(e));await Promise.all(r.map(async e=>this.replicateDataToContact(e,t)))}):r.some(e=>Mk(e,this.options.localPeerDescriptor))||this.options.localDataStore.setAllEntriesAsStale(e)}async replicateDataToContact(e,t){const r=this.options.createRpcRemote(t);try{await r.replicateData({entry:e},!0)}catch(e){TC.trace("replicateData() threw an exception "+e)}}async storeDataToDht(e,t,r){TC.debug(`Storing data to DHT ${this.options.serviceId}`);const n=(await this.options.recursiveOperationManager.execute(e,Yk.FIND_CLOSEST_NODES)).closestNodes,i=[],s=this.options.highestTtl,o=Qk.now();for(let a=0;a<n.length&&i.length<this.options.redundancyFactor;a++){const c=Ok(e),u=Ok(r);if(Mk(this.options.localPeerDescriptor,n[a])){this.options.localDataStore.storeEntry({key:c,data:t,creator:u,createdAt:o,storedAt:Qk.now(),ttl:s,stale:!1,deleted:!1}),i.push(n[a]);continue}const l=this.options.createRpcRemote(n[a]);try{await l.storeData({key:c,data:t,creator:u,createdAt:o,ttl:s}),i.push(n[a]),TC.trace("remote.storeData() success")}catch(e){TC.trace("remote.storeData() threw an exception "+e)}}return i}async replicateDataToClosestNodes(){const e=Array.from(this.options.localDataStore.values());await Promise.all(e.map(async e=>{const t=xk(e.key),r=II(t,this.options.getNeighbors(),{maxCount:this.options.redundancyFactor});await Promise.all(r.map(async t=>{const r=this.options.createRpcRemote(t);try{await r.replicateData({entry:e},!1)}catch(e){TC.trace("Failed to replicate data in replicateDataToClosestNodes",{err:e})}}))}))}getStorers(e,t){return II(e,[...this.options.getNeighbors(),this.options.localPeerDescriptor],{maxCount:this.options.redundancyFactor,excludedNodeIds:void 0!==t?new Set([Dk(t)]):void 0})}async destroy(){await this.replicateDataToClosestNodes()}}class xC extends EP{async storeData(e){const t=this.formDhtRpcOptions();try{await this.getClient().storeData(e,t)}catch(e){const t=Dk(this.getPeerDescriptor()),r=Dk(this.getLocalPeerDescriptor());throw new Error(`Could not store data to ${t} from ${r} ${e}`)}}async replicateData(e,t){const r=this.formDhtRpcOptions({timeout:wP,notification:!0,connect:t});return this.getClient().replicateData(e,r)}}const OC=new Ta("DhtNode");class DC extends zr{options;rpcCommunicator;transport;localPeerDescriptor;router;storeManager;localDataStore;recursiveOperationManager;peerDiscovery;peerManager;connectionsView;connectionLocker;started=!1;abortController=new AbortController;constructor(e){super(),this.options=ec({serviceId:QI,joinParallelism:3,maxContactCount:200,numberOfNodesPerKBucket:8,joinNoProgressLimit:5,dhtJoinTimeout:6e4,peerDiscoveryQueryBatchSize:5,maxConnections:80,storeHighestTtl:6e4,storeMaxTtl:6e4,networkConnectivityTimeout:1e4,storageRedundancyFactor:5,metricsContext:new za},e),this.validateOptions(),this.localDataStore=new IC(this.options.storeMaxTtl),this.send=this.send.bind(this)}validateOptions(){if(void 0!==this.options.nodeId){if(!/^[0-9a-fA-F]+$/.test(this.options.nodeId))throw new Error("Invalid nodeId, the nodeId should be a hex string");if(40!==this.options.nodeId.length)throw new Error("Invalid nodeId, the length of the nodeId should be 40")}if(void 0!==this.options.peerDescriptor&&20!==this.options.peerDescriptor.nodeId.length)throw new Error("Invalid peerDescriptor, the length of the nodeId should be 20 bytes");if(void 0!==this.options.transport&&void 0===this.options.connectionsView)throw new Error("connectionsView is required when transport is given")}async start(){if(this.started||this.abortController.signal.aborted)return;if(OC.trace(`Starting new Streamr Network DHT Node with serviceId ${this.options.serviceId}`),this.started=!0,this.options.websocketPortRange=void 0,this.options.peerDescriptor&&(this.options.peerDescriptor.websocket=void 0),this.options.transport)this.transport=this.options.transport,this.connectionsView=this.options.connectionsView,this.connectionLocker=this.options.connectionLocker,this.localPeerDescriptor=this.transport.getLocalPeerDescriptor();else{const e={transport:this,entryPoints:this.options.entryPoints,iceServers:this.options.iceServers,webrtcAllowPrivateAddresses:this.options.webrtcAllowPrivateAddresses,webrtcDatachannelBufferThresholdLow:this.options.webrtcDatachannelBufferThresholdLow,webrtcDatachannelBufferThresholdHigh:this.options.webrtcDatachannelBufferThresholdHigh,webrtcPortRange:this.options.webrtcPortRange,maxMessageSize:this.options.maxMessageSize,websocketServerEnableTls:this.options.websocketServerEnableTls,tlsCertificate:this.options.tlsCertificate,externalIp:this.options.externalIp,autoCertifierUrl:this.options.autoCertifierUrl,autoCertifierConfigFile:this.options.autoCertifierConfigFile,geoIpDatabaseFolder:this.options.geoIpDatabaseFolder,createLocalPeerDescriptor:e=>this.generatePeerDescriptorCallBack(e)};this.options.peerDescriptor?.websocket?(e.websocketHost=this.options.peerDescriptor.websocket.host,e.websocketPortRange={min:this.options.peerDescriptor.websocket.port,max:this.options.peerDescriptor.websocket.port}):this.options.websocketPortRange&&(e.websocketHost=this.options.websocketHost,e.websocketPortRange=this.options.websocketPortRange);const t=new OP({createConnectorFacade:()=>new SI(e),maxConnections:this.options.maxConnections,metricsContext:this.options.metricsContext,allowIncomingPrivateConnections:this.options.allowIncomingPrivateConnections??!1});await t.start(),this.connectionsView=t,this.connectionLocker=t,this.transport=t}this.rpcCommunicator=new cP(this.options.serviceId,(e,t)=>this.transport.send(e,t),{rpcRequestTimeout:this.options.rpcRequestTimeout}),Xa(this.transport,"message",e=>this.handleMessageFromTransport(e),this.abortController.signal),this.initPeerManager(),this.peerDiscovery=new XI({localPeerDescriptor:this.localPeerDescriptor,joinNoProgressLimit:this.options.joinNoProgressLimit,joinTimeout:this.options.dhtJoinTimeout,serviceId:this.options.serviceId,parallelism:this.options.joinParallelism,connectionLocker:this.connectionLocker,peerManager:this.peerManager,abortSignal:this.abortController.signal,createDhtNodeRpcRemote:e=>this.createDhtNodeRpcRemote(e)}),this.router=new PC({rpcCommunicator:this.rpcCommunicator,localPeerDescriptor:this.localPeerDescriptor,handleMessage:e=>this.handleMessageFromRouter(e),getConnections:()=>this.connectionsView.getConnections()}),this.recursiveOperationManager=new EC({rpcCommunicator:this.rpcCommunicator,router:this.router,sessionTransport:this,connectionsView:this.connectionsView,localPeerDescriptor:this.localPeerDescriptor,serviceId:this.options.serviceId,localDataStore:this.localDataStore,addContact:e=>this.peerManager.addContact(e),createDhtNodeRpcRemote:e=>this.createDhtNodeRpcRemote(e)}),this.storeManager=new NC({rpcCommunicator:this.rpcCommunicator,recursiveOperationManager:this.recursiveOperationManager,localPeerDescriptor:this.localPeerDescriptor,serviceId:this.options.serviceId,highestTtl:this.options.storeHighestTtl,redundancyFactor:this.options.storageRedundancyFactor,localDataStore:this.localDataStore,getNeighbors:()=>this.peerManager.getNeighbors().map(e=>e.getPeerDescriptor()),createRpcRemote:e=>new xC(this.localPeerDescriptor,e,this.rpcCommunicator,eP,this.options.rpcRequestTimeout)}),this.on("nearbyContactAdded",e=>{this.storeManager.onContactAdded(e)}),this.bindRpcLocalMethods();const e=[];!0===this.options.periodicallyPingNeighbors&&e.push(()=>this.peerManager.getNeighbors().map(e=>this.createDhtNodeRpcRemote(e.getPeerDescriptor()))),!0===this.options.periodicallyPingRingContacts&&e.push(()=>this.peerManager.getRingContacts().getAllContacts());for(const t of e)await Ka(async()=>{const e=t();await this.peerManager.pruneOfflineNodes(e)},6e4,!1,this.abortController.signal)}initPeerManager(){this.peerManager=new VI({numberOfNodesPerKBucket:this.options.numberOfNodesPerKBucket,maxContactCount:this.options.maxContactCount,localNodeId:this.getNodeId(),localPeerDescriptor:this.localPeerDescriptor,connectionLocker:this.connectionLocker,lockId:this.options.serviceId,createDhtNodeRpcRemote:e=>this.createDhtNodeRpcRemote(e),hasConnection:e=>this.connectionsView.hasConnection(e),neighborPingLimit:this.options.neighborPingLimit}),this.peerManager.on("nearbyContactRemoved",e=>{this.emit("nearbyContactRemoved",e)}),this.peerManager.on("nearbyContactAdded",e=>this.emit("nearbyContactAdded",e)),this.peerManager.on("randomContactRemoved",e=>this.emit("randomContactRemoved",e)),this.peerManager.on("randomContactAdded",e=>this.emit("randomContactAdded",e)),this.peerManager.on("ringContactRemoved",e=>{this.emit("ringContactRemoved",e)}),this.peerManager.on("ringContactAdded",e=>{this.emit("ringContactAdded",e)}),this.peerManager.on("kBucketEmpty",()=>{this.peerDiscovery.isJoinOngoing()||(this.options.entryPoints&&this.options.entryPoints.length>0?setImmediate(async()=>{const e=new Set,t=new Set;await Promise.all(this.options.entryPoints.map(r=>this.peerDiscovery.rejoinDht(r,e,t)))}):this.emit("manualRejoinRequired"))}),Xa(this.transport,"connected",e=>{this.router.onNodeConnected(e),this.emit("connected",e)},this.abortController.signal),Xa(this.transport,"disconnected",(e,t)=>{if(void 0!==this.connectionLocker){const r=Dk(e);t?this.peerManager.removeContact(r):this.peerManager.removeNeighbor(r)}this.router.onNodeDisconnected(e),this.emit("disconnected",e,t)},this.abortController.signal)}bindRpcLocalMethods(){if(!this.started||this.abortController.signal.aborted)return;const e=new _I({peerDiscoveryQueryBatchSize:this.options.peerDiscoveryQueryBatchSize,getNeighbors:()=>this.peerManager.getNeighbors().map(e=>e.getPeerDescriptor()),getClosestRingContactsTo:(e,t)=>this.getClosestRingContactsTo(e,t),addContact:e=>this.peerManager.addContact(e),removeContact:e=>this.removeContact(e)});this.rpcCommunicator.registerRpcMethod(lR,dR,"getClosestPeers",(t,r)=>e.getClosestPeers(t,r)),this.rpcCommunicator.registerRpcMethod(hR,fR,"getClosestRingPeers",(t,r)=>e.getClosestRingPeers(t,r)),this.rpcCommunicator.registerRpcMethod(mR,yR,"ping",(t,r)=>e.ping(t,r)),this.rpcCommunicator.registerRpcNotification(bR,"leaveNotice",(t,r)=>e.leaveNotice(r));const t=new xI({executeRecursiveOperation:(e,t,r)=>this.recursiveOperationManager.execute(e,t,r),storeDataToDht:(e,t,r)=>this.storeDataToDht(e,t,r)});this.rpcCommunicator.registerRpcMethod(FR,UR,"externalFetchData",(e,r)=>t.externalFetchData(e,r),{timeout:1e4}),this.rpcCommunicator.registerRpcMethod(oR,aR,"externalStoreData",(e,r)=>t.externalStoreData(e,r),{timeout:1e4})}handleMessageFromTransport(e){e.serviceId===this.options.serviceId&&this.rpcCommunicator?.handleMessageFromPeer(e)}handleMessageFromRouter(e){e.serviceId===this.options.serviceId?this.rpcCommunicator?.handleMessageFromPeer(e):this.emit("message",e)}async generatePeerDescriptorCallBack(e){if(void 0!==this.options.peerDescriptor)this.localPeerDescriptor=this.options.peerDescriptor;else{let t;void 0!==this.options.region?(t=this.options.region,OC.debug(`Using region ${t} from options when generating local PeerDescriptor`)):void 0!==e.latitude&&void 0!==e.longitude?(t=((e,t)=>{const r=[];return Object.keys(kk).forEach(n=>{const i=kk[n],s=Sk()({latitude:e,longitude:t},{latitude:i[1],longitude:i[2]});r.push([i[0],s])}),r.sort((e,t)=>e[1]-t[1]),r[0][0]})(e.latitude,e.longitude),OC.debug(`Using region ${t} from GeoIP when generating local PeerDescriptor`)):(t=await(async(e=36e5)=>{if(void 0===Ck||void 0===_k||Date.now()-_k>e){const e=await Tk();return Ck=e,_k=Date.now(),e}return Ck})(),OC.debug(`Using region ${t} from CDN when generating local PeerDescriptor`)),this.localPeerDescriptor=await(async(e,t,r)=>{const n=Er(32),i=Er(20);let s;s=void 0!==r?Ok(r):await(async(e,t)=>{const r=Buffer.alloc(4);r.writeUInt32BE(e);const n=RI.keccakHash(r),i=await RI.createSignature(r,t);return Buffer.concat([n.subarray(n.length-13,n.length),i.subarray(i.length-7,i.length)])})(e.ipAddress,n);const o={nodeId:s,type:Xk.BROWSER,ipAddress:e.ipAddress,region:t,publicKey:i};return e.websocket&&(o.websocket={host:e.websocket.host,port:e.websocket.port,tls:e.websocket.tls}),o.signature=await RI.createSignature((e=>{const t=Buffer.from(","),r=[void 0!==e.type?kI(e.type):new Uint8Array(0),t,void 0!==e.udp?vR.toBinary(e.udp):new Uint8Array(0),t,void 0!==e.tcp?vR.toBinary(e.tcp):new Uint8Array(0),t,void 0!==e.websocket?vR.toBinary(e.websocket):new Uint8Array(0),t,void 0!==e.region?kI(e.region):new Uint8Array(0),t,void 0!==e.ipAddress?kI(e.ipAddress):new Uint8Array(0),t,void 0!==e.publicKey?Buffer.from(e.publicKey):new Uint8Array(0)];return Buffer.concat(r)})(o),n),o})(e,t,this.options.nodeId)}return this.localPeerDescriptor}getClosestContacts(e){return this.peerManager.getNearbyContacts().getClosestContacts(e).map(e=>e.getPeerDescriptor())}getRandomContacts(e){return this.peerManager.getRandomContacts().getContacts(e).map(e=>e.getPeerDescriptor())}getRingContacts(){const e=this.peerManager.getRingContacts().getClosestContacts();return{left:e.left.map(e=>e.getPeerDescriptor()),right:e.right.map(e=>e.getPeerDescriptor())}}getClosestRingContactsTo(e,t){const r=this.peerManager.getClosestRingContactsTo(e,t);return{left:r.left.map(e=>e.getPeerDescriptor()),right:r.right.map(e=>e.getPeerDescriptor())}}getNodeId(){return Dk(this.localPeerDescriptor)}getNeighborCount(){return this.peerManager.getNeighborCount()}removeContact(e){this.started&&this.peerManager.removeContact(e)}async send(e){if(!this.started||this.abortController.signal.aborted)return;const t=this.peerDiscovery.isJoinOngoing()?this.getConnectedEntryPoints():[];this.router.send(e,t)}getConnectedEntryPoints(){return void 0!==this.options.entryPoints?this.options.entryPoints.filter(e=>this.connectionsView.hasConnection(Dk(e))):[]}async joinDht(e,t,r){if(!this.started)throw new Error("Cannot join DHT before calling start() on DhtNode");await this.peerDiscovery.joinDht(e,t,r)}async joinRing(){if(!this.started)throw new Error("Cannot join ring before calling start() on DhtNode");await this.peerDiscovery.joinRing()}async storeDataToDht(e,t,r){return this.executeRecursiveOperation(()=>this.storeManager.storeDataToDht(e,t,r??this.getNodeId()),r=>this.storeDataToDhtViaPeer(e,t,r))}async storeDataToDhtViaPeer(e,t,r){const n=new DI(this.localPeerDescriptor,r,this.rpcCommunicator,sP);return await n.storeData(e,t)}async fetchDataFromDht(e){return this.executeRecursiveOperation(async()=>(await this.recursiveOperationManager.execute(e,Yk.FETCH_DATA)).dataEntries??[],t=>this.fetchDataFromDhtViaPeer(e,t))}async fetchDataFromDhtViaPeer(e,t){const r=new DI(this.localPeerDescriptor,t,this.rpcCommunicator,sP);return await r.externalFetchData(e)}async executeRecursiveOperation(e,t){const r=this.getConnectedEntryPoints();return this.peerDiscovery.isJoinOngoing()&&r.length>0?t(Cc()(r)):e()}async deleteDataFromDht(e,t){this.abortController.signal.aborted||await this.recursiveOperationManager.execute(e,Yk.DELETE_DATA,void 0,t)}async findClosestNodesFromDht(e){return this.executeRecursiveOperation(async()=>(await this.recursiveOperationManager.execute(e,Yk.FIND_CLOSEST_NODES)).closestNodes,t=>this.findClosestNodesViaPeer(e,t))}async findClosestNodesViaPeer(e,t){const r=new DI(this.localPeerDescriptor,t,this.rpcCommunicator,sP);return await r.externalFindClosestNode(e)}getTransport(){return this.transport}getLocalPeerDescriptor(){return this.localPeerDescriptor}getNeighbors(){return this.started?this.peerManager.getNeighbors().map(e=>e.getPeerDescriptor()):[]}getConnectionsView(){return this.connectionsView}getLocalLockedConnectionCount(){return this.connectionLocker.getLocalLockedConnectionCount()}getRemoteLockedConnectionCount(){return this.connectionLocker.getRemoteLockedConnectionCount()}getWeakLockedConnectionCount(){return this.connectionLocker.getWeakLockedConnectionCount()}async waitForNetworkConnectivity(){await Qa(()=>this.connectionsView.getConnectionCount()>0,this.options.networkConnectivityTimeout,100,this.abortController.signal)}hasJoined(){return this.peerDiscovery.isJoinCalled()}getDiagnosticInfo(){return{localPeerDescriptor:this.localPeerDescriptor,transport:this.transport.getDiagnosticInfo(),router:this.router.getDiagnosticInfo(),neighborCount:this.getNeighborCount(),nearbyContactCount:Array.from(this.peerManager.getNearbyContacts().getAllContactsInUndefinedOrder()).length,randomContactCount:this.peerManager.getRandomContacts().getSize()}}async stop(){!this.abortController.signal.aborted&&this.started&&(OC.trace("stop()"),this.abortController.abort(),await this.storeManager.destroy(),this.localDataStore.clear(),this.peerManager?.stop(),this.rpcCommunicator.stop(),this.router.stop(),this.recursiveOperationManager.stop(),void 0===this.options.transport&&await this.transport.stop(),this.transport=void 0,this.connectionLocker=void 0,this.removeAllListeners())}createDhtNodeRpcRemote(e){return new NI(this.localPeerDescriptor,e,this.options.serviceId,this.rpcCommunicator,this.options.rpcRequestTimeout)}}var MC,BC;!function(e){e[e.eu_central_1=0]="eu_central_1",e[e.eu_west_1=1]="eu_west_1",e[e.eu_west_2=2]="eu_west_2",e[e.eu_west_3=3]="eu_west_3",e[e.eu_north_1=4]="eu_north_1",e[e.us_east_1=5]="us_east_1",e[e.us_east_2=6]="us_east_2",e[e.us_west_1=7]="us_west_1",e[e.us_west_2=8]="us_west_2",e[e.ca_central_1=9]="ca_central_1",e[e.ap_south_1=10]="ap_south_1",e[e.ap_northeast_2=11]="ap_northeast_2",e[e.ap_southeast_1=12]="ap_southeast_1",e[e.ap_southeast_2=13]="ap_southeast_2",e[e.ap_northeast_1=14]="ap_northeast_1",e[e.sa_east_1=15]="sa_east_1"}(MC||(MC={})),new Ta("Simulator"),function(e){e.NONE="NONE",e.RANDOM="RANDOM",e.REAL="REAL",e.FIXED="FIXED"}(BC||(BC={}));var LC=r(3441),FC=r.n(LC);class UC{tail;head;length=0;static create(e=[]){return new UC(e)}constructor(e=[]){for(const t of e)this.push(t)}*[Symbol.iterator](){for(let e=this.head;e;e=e.next)yield e.value}removeNode(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");const t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),this.length--,e.next=void 0,e.prev=void 0,e.list=void 0,t}unshiftNode(e){if(e===this.head)return;e.list&&e.list.removeNode(e);const t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}pushNode(e){if(e===this.tail)return;e.list&&e.list.removeNode(e);const t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}push(...e){for(let t=0,r=e.length;t<r;t++)zC(this,e[t]);return this.length}unshift(...e){for(var t=0,r=e.length;t<r;t++)qC(this,e[t]);return this.length}pop(){if(!this.tail)return;const e=this.tail.value,t=this.tail;return this.tail=this.tail.prev,this.tail?this.tail.next=void 0:this.head=void 0,t.list=void 0,this.length--,e}shift(){if(!this.head)return;const e=this.head.value,t=this.head;return this.head=this.head.next,this.head?this.head.prev=void 0:this.tail=void 0,t.list=void 0,this.length--,e}forEach(e,t){t=t||this;for(let r=this.head,n=0;r;n++)e.call(t,r.value,n,this),r=r.next}forEachReverse(e,t){t=t||this;for(let r=this.tail,n=this.length-1;r;n--)e.call(t,r.value,n,this),r=r.prev}get(e){let t=0,r=this.head;for(;r&&t<e;t++)r=r.next;if(t===e&&r)return r.value}getReverse(e){let t=0,r=this.tail;for(;r&&t<e;t++)r=r.prev;if(t===e&&r)return r.value}map(e,t){t=t||this;const r=new UC;for(let n=this.head;n;)r.push(e.call(t,n.value,this)),n=n.next;return r}mapReverse(e,t){t=t||this;var r=new UC;for(let n=this.tail;n;)r.push(e.call(t,n.value,this)),n=n.prev;return r}reduce(e,t){let r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var i=0;n;i++)r=e(r,n.value,i),n=n.next;return r}reduceReverse(e,t){let r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(let t=this.length-1;n;t--)r=e(r,n.value,t),n=n.prev;return r}toArray(){const e=new Array(this.length);for(let t=0,r=this.head;r;t++)e[t]=r.value,r=r.next;return e}toArrayReverse(){const e=new Array(this.length);for(let t=0,r=this.tail;r;t++)e[t]=r.value,r=r.prev;return e}slice(e=0,t=this.length){t<0&&(t+=this.length),e<0&&(e+=this.length);const r=new UC;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);let n=this.head,i=0;for(i=0;n&&i<e;i++)n=n.next;for(;n&&i<t;i++,n=n.next)r.push(n.value);return r}sliceReverse(e=0,t=this.length){t<0&&(t+=this.length),e<0&&(e+=this.length);const r=new UC;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);let n=this.length,i=this.tail;for(;i&&n>t;n--)i=i.prev;for(;i&&n>e;n--,i=i.prev)r.push(i.value);return r}splice(e,t=0,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);let n=this.head;for(let t=0;n&&t<e;t++)n=n.next;const i=[];for(let e=0;n&&e<t;e++)i.push(n.value),n=this.removeNode(n);n?n!==this.tail&&(n=n.prev):n=this.tail;for(const e of r)n=jC(this,n,e);return i}reverse(){const e=this.head,t=this.tail;for(let t=e;t;t=t.prev){const e=t.prev;t.prev=t.next,t.next=e}return this.head=t,this.tail=e,this}}function jC(e,t,r){const n=t,i=t?t.next:e.head,s=new KC(r,n,i,e);return void 0===s.next&&(e.tail=s),void 0===s.prev&&(e.head=s),e.length++,s}function zC(e,t){e.tail=new KC(t,e.tail,void 0,e),e.head||(e.head=e.tail),e.length++}function qC(e,t){e.head=new KC(t,void 0,e.head,e),e.tail||(e.tail=e.head),e.length++}class KC{list;next;prev;value;constructor(e,t,r,n){this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=void 0,r?(r.prev=this,this.next=r):this.next=void 0}}class GC{rpcCommunicator;constructor(e){this.rpcCommunicator=new $P("external-network-service",e)}registerRpcMethod(e,t,r,n){this.rpcCommunicator.registerRpcMethod(e,t,r,n)}createRpcClient(e){return GS(new e(this.rpcCommunicator.getRpcClientTransport()))}destroy(){this.rpcCommunicator.destroy()}}const $C=new class extends sS{constructor(){super("google.protobuf.Any",[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}])}pack(e,t){return{typeUrl:this.typeNameToUrl(t.typeName),value:t.toBinary(e)}}unpack(e,t,r){if(!this.contains(e,t))throw new Error("Cannot unpack google.protobuf.Any with typeUrl '"+e.typeUrl+"' as "+t.typeName+".");return t.fromBinary(e.value,r)}contains(e,t){return!!e.typeUrl.length&&("string"==typeof t?t:t.typeName)===this.typeUrlToName(e.typeUrl)}internalJsonWrite(e,t){if(""===e.typeUrl)return{};let r=this.typeUrlToName(e.typeUrl),n=HA(t),i=n.typeRegistry?.find(e=>e.typeName===r);if(!i)throw new globalThis.Error("Unable to convert google.protobuf.Any with typeUrl '"+e.typeUrl+"' to JSON. The specified type "+r+" is not available in the type registry.");let s=i.fromBinary(e.value,{readUnknownField:!1}),o=i.internalJsonWrite(s,n);return!r.startsWith("google.protobuf.")&&fA(o)||(o={value:o}),o["@type"]=e.typeUrl,o}internalJsonRead(e,t,r){if(!fA(e))throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON "+hA(e)+".");if("string"!=typeof e["@type"]||""==e["@type"])return this.create();let n,i=this.typeUrlToName(e["@type"]),s=t?.typeRegistry?.find(e=>e.typeName==i);if(!s)throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON. The specified type "+i+" is not available in the type registry.");if(i.startsWith("google.protobuf.")&&e.hasOwnProperty("value"))n=s.fromJson(e.value,t);else{let r=Object.assign({},e);delete r["@type"],n=s.fromJson(r,t)}return void 0===r&&(r=this.create()),r.typeUrl=e["@type"],r.value=s.toBinary(n),r}typeNameToUrl(e){if(!e.length)throw new Error("invalid type name: "+e);return"type.googleapis.com/"+e}typeUrlToName(e){if(!e.length)throw new Error("invalid type url: "+e);let t=e.lastIndexOf("/"),r=t>0?e.substring(t+1):e;if(!r.length)throw new Error("invalid type url: "+e);return r}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.typeUrl="",t.value=new Uint8Array(0),void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();switch(t){case 1:i.typeUrl=e.string();break;case 2:i.value=e.bytes();break;default:let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){""!==e.typeUrl&&t.tag(1,UA.LengthDelimited).string(e.typeUrl),e.value.length&&t.tag(2,UA.LengthDelimited).bytes(e.value);let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}},VC=new Ta("PeerDescriptorStoreManager");class HC{abortController;options;isLocalNodeStored_=!1;constructor(e){this.options=e,this.abortController=new AbortController}async fetchNodes(){VC.trace("Fetch data",{key:this.options.key});try{return(await this.options.fetchDataFromDht(this.options.key)).filter(e=>!e.deleted).map(e=>$C.unpack(e.data,wR))}catch{return[]}}async storeAndKeepLocalNode(){this.abortController.signal.aborted||(this.isLocalNodeStored_=!0,await this.storeLocalNode(),await this.keepLocalNode())}async storeLocalNode(){const e=this.options.localPeerDescriptor,t=$C.pack(e,wR);try{await this.options.storeDataToDht(this.options.key,t)}catch{VC.warn("Failed to store local node",{key:this.options.key})}}async keepLocalNode(){await Ka(async()=>{VC.trace("Attempting to keep local node",{key:this.options.key});try{const e=await this.fetchNodes();(e.length<8||e.some(e=>Mk(e,this.options.localPeerDescriptor)))&&await this.storeLocalNode()}catch{VC.debug("Failed to keep local node",{key:this.options.key})}},this.options.storeInterval??6e4,!1,this.abortController.signal)}isLocalNodeStored(){return this.isLocalNodeStored_}async destroy(){this.abortController.abort(),await this.options.deleteDataFromDht(this.options.key,!1)}}const WC=new Ta("StreamPartNetworkSplitAvoidance");class JC{abortController;options;excludedNodes=new Set;running=!1;constructor(e){this.options=e,this.abortController=new AbortController}async avoidNetworkSplit(){this.running=!0,await(async(e,t,r,n=500,i=6)=>{for(let s=1;s<=i;s++){if(r.aborted)return;const i=n*2**s;try{await e()}catch{WC.trace(`${t} failed, retrying in ${i} ms`)}try{await Ga(i,r)}catch(e){WC.trace(`${e}`)}}})(async()=>{const e=(await this.options.discoverEntryPoints()).filter(e=>!this.excludedNodes.has(Dk(e)));if(await this.options.discoveryLayerNode.joinDht(e,!1,!1),this.options.discoveryLayerNode.getNeighborCount()<4)throw e.filter(e=>!this.options.discoveryLayerNode.getNeighbors().some(t=>Mk(t,e))).map(e=>Dk(e)).forEach(e=>this.excludedNodes.add(e)),new Error("Network split is still possible")},"avoid network split",this.abortController.signal,this.options.exponentialRunOfBaseDelay),this.running=!1,this.excludedNodes.clear(),WC.trace("Network split avoided")}isRunning(){return this.running}destroy(){this.abortController.abort()}}class ZC{abortController;discoveryLayerNode;peerDescriptorStoreManager;constructor(e,t){this.discoveryLayerNode=e,this.peerDescriptorStoreManager=t}async reconnect(e=3e4){this.abortController=new AbortController,await Ka(async()=>{const e=await this.peerDescriptorStoreManager.fetchNodes();await this.discoveryLayerNode.joinDht(e),!this.peerDescriptorStoreManager.isLocalNodeStored()&&e.length<8&&await this.peerDescriptorStoreManager.storeAndKeepLocalNode(),this.discoveryLayerNode.getNeighborCount()>0&&this.abortController.abort()},e,!0,this.abortController.signal)}isRunning(){return!!this.abortController&&!this.abortController.signal.aborted}destroy(){this.abortController?.abort()}}const QC=new class extends sS{constructor(){super("google.protobuf.Empty",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();{let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}};var YC;!function(e){e[e.SERVER_TIMEOUT=0]="SERVER_TIMEOUT",e[e.CLIENT_TIMEOUT=1]="CLIENT_TIMEOUT",e[e.UNKNOWN_RPC_METHOD=2]="UNKNOWN_RPC_METHOD",e[e.CLIENT_ERROR=3]="CLIENT_ERROR",e[e.SERVER_ERROR=4]="SERVER_ERROR"}(YC||(YC={}));const XC=new class extends sS{constructor(){super("protorpc.RpcMessage",[{no:1,name:"header",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:2,name:"body",kind:"message",T:()=>$C},{no:3,name:"requestId",kind:"scalar",T:9},{no:4,name:"errorType",kind:"enum",opt:!0,T:()=>["protorpc.RpcErrorType",YC]},{no:5,name:"errorClassName",kind:"scalar",opt:!0,T:9},{no:6,name:"errorCode",kind:"scalar",opt:!0,T:9},{no:7,name:"errorMessage",kind:"scalar",opt:!0,T:9}])}};new class extends sS{constructor(){super("protorpc.Mnfo2uhnf92hvqi2nviouq2hv9puhq",[{no:1,name:"empty",kind:"message",T:()=>QC}])}};const e_=new class extends sS{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3,L:2},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const e=this.create(),t=Date.now();return e.seconds=TA.from(Math.floor(t/1e3)).toNumber(),e.nanos=t%1e3*1e6,e}toDate(e){return new Date(1e3*TA.from(e.seconds).toNumber()+Math.ceil(e.nanos/1e6))}fromDate(e){const t=this.create(),r=e.getTime();return t.seconds=TA.from(Math.floor(r/1e3)).toNumber(),t.nanos=1e6*(r%1e3+(r<0&&r%1e3!=0?1e3:0)),t}internalJsonWrite(e,t){let r=1e3*TA.from(e.seconds).toNumber();if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let n="Z";if(e.nanos>0){let t=(e.nanos+1e9).toString().substring(1);n="000000"===t.substring(3)?"."+t.substring(0,3)+"Z":"000"===t.substring(6)?"."+t.substring(0,6)+"Z":"."+t+"Z"}return new Date(r).toISOString().replace(".000Z",n)}internalJsonRead(e,t,r){if("string"!=typeof e)throw new Error("Unable to parse Timestamp from JSON "+hA(e)+".");let n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return r||(r=this.create()),r.seconds=TA.from(i/1e3).toNumber(),r.nanos=0,n[7]&&(r.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),r}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.seconds=0,t.nanos=0,void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();switch(t){case 1:i.seconds=e.int64().toNumber();break;case 2:i.nanos=e.int32();break;default:let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){0!==e.seconds&&t.tag(1,UA.Varint).int64(e.seconds),0!==e.nanos&&t.tag(2,UA.Varint).int32(e.nanos);let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}};var t_,r_,n_,i_,s_,o_;!function(e){e[e.FIND_CLOSEST_NODES=0]="FIND_CLOSEST_NODES",e[e.FETCH_DATA=1]="FETCH_DATA",e[e.DELETE_DATA=2]="DELETE_DATA"}(t_||(t_={})),function(e){e[e.NODEJS=0]="NODEJS",e[e.BROWSER=1]="BROWSER"}(r_||(r_={})),function(e){e[e.SERVER_TIMOUT=0]="SERVER_TIMOUT",e[e.CLIENT_TIMEOUT=1]="CLIENT_TIMEOUT",e[e.SERVER_ERROR=2]="SERVER_ERROR",e[e.UNKNOWN_RPC_METHOD=3]="UNKNOWN_RPC_METHOD"}(n_||(n_={})),function(e){e[e.NO_TARGETS=0]="NO_TARGETS",e[e.DUPLICATE=1]="DUPLICATE",e[e.STOPPED=2]="STOPPED"}(i_||(i_={})),function(e){e[e.DUPLICATE_CONNECTION=0]="DUPLICATE_CONNECTION",e[e.INVALID_TARGET_PEER_DESCRIPTOR=1]="INVALID_TARGET_PEER_DESCRIPTOR",e[e.UNSUPPORTED_PROTOCOL_VERSION=2]="UNSUPPORTED_PROTOCOL_VERSION"}(s_||(s_={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.LEAVING=1]="LEAVING"}(o_||(o_={}));const a_=new class extends sS{constructor(){super("dht.StoreDataRequest",[{no:1,name:"key",kind:"scalar",T:12},{no:2,name:"data",kind:"message",T:()=>$C},{no:3,name:"creator",kind:"scalar",T:12},{no:4,name:"createdAt",kind:"message",T:()=>e_},{no:5,name:"ttl",kind:"scalar",T:13}])}},c_=new class extends sS{constructor(){super("dht.StoreDataResponse",[])}},u_=new class extends sS{constructor(){super("dht.ExternalStoreDataRequest",[{no:1,name:"key",kind:"scalar",T:12},{no:2,name:"data",kind:"message",T:()=>$C}])}},l_=new class extends sS{constructor(){super("dht.ExternalStoreDataResponse",[{no:1,name:"storers",kind:"message",repeat:2,T:()=>A_}])}},d_=new class extends sS{constructor(){super("dht.ReplicateDataRequest",[{no:1,name:"entry",kind:"message",T:()=>h_}])}},h_=new class extends sS{constructor(){super("dht.DataEntry",[{no:1,name:"key",kind:"scalar",T:12},{no:2,name:"data",kind:"message",T:()=>$C},{no:3,name:"creator",kind:"scalar",T:12},{no:4,name:"createdAt",kind:"message",T:()=>e_},{no:5,name:"storedAt",kind:"message",T:()=>e_},{no:6,name:"ttl",kind:"scalar",T:13},{no:7,name:"stale",kind:"scalar",T:8},{no:8,name:"deleted",kind:"scalar",T:8}])}},f_=new class extends sS{constructor(){super("dht.ClosestPeersRequest",[{no:1,name:"nodeId",kind:"scalar",T:12},{no:2,name:"requestId",kind:"scalar",T:9}])}},p_=new class extends sS{constructor(){super("dht.ClosestPeersResponse",[{no:1,name:"peers",kind:"message",repeat:2,T:()=>A_},{no:2,name:"requestId",kind:"scalar",T:9}])}},g_=new class extends sS{constructor(){super("dht.ClosestRingPeersRequest",[{no:1,name:"ringId",kind:"scalar",T:12},{no:2,name:"requestId",kind:"scalar",T:9}])}},m_=new class extends sS{constructor(){super("dht.ClosestRingPeersResponse",[{no:1,name:"leftPeers",kind:"message",repeat:2,T:()=>A_},{no:2,name:"rightPeers",kind:"message",repeat:2,T:()=>A_},{no:3,name:"requestId",kind:"scalar",T:9}])}},y_=new class extends sS{constructor(){super("dht.RecursiveOperationRequest",[{no:1,name:"sessionId",kind:"scalar",T:9},{no:2,name:"operation",kind:"enum",T:()=>["dht.RecursiveOperation",t_]}])}},b_=new class extends sS{constructor(){super("dht.RecursiveOperationResponse",[{no:1,name:"closestConnectedNodes",kind:"message",repeat:2,T:()=>A_},{no:2,name:"dataEntries",kind:"message",repeat:2,T:()=>h_},{no:3,name:"noCloserNodesFound",kind:"scalar",T:8},{no:4,name:"routingPath",kind:"message",repeat:2,T:()=>A_}])}},w_=new class extends sS{constructor(){super("dht.PingRequest",[{no:1,name:"requestId",kind:"scalar",T:9}])}},v_=new class extends sS{constructor(){super("dht.PingResponse",[{no:1,name:"requestId",kind:"scalar",T:9}])}},E_=new class extends sS{constructor(){super("dht.LeaveNotice",[])}},A_=new class extends sS{constructor(){super("dht.PeerDescriptor",[{no:1,name:"nodeId",kind:"scalar",T:12},{no:2,name:"type",kind:"enum",T:()=>["dht.NodeType",r_]},{no:3,name:"udp",kind:"message",T:()=>S_},{no:4,name:"tcp",kind:"message",T:()=>S_},{no:5,name:"websocket",kind:"message",T:()=>S_},{no:6,name:"region",kind:"scalar",opt:!0,T:13},{no:7,name:"ipAddress",kind:"scalar",opt:!0,T:13},{no:8,name:"publicKey",kind:"scalar",opt:!0,T:12},{no:9,name:"signature",kind:"scalar",opt:!0,T:12}])}},S_=new class extends sS{constructor(){super("dht.ConnectivityMethod",[{no:1,name:"port",kind:"scalar",T:13},{no:2,name:"host",kind:"scalar",T:9},{no:3,name:"tls",kind:"scalar",T:8}])}},k_=new class extends sS{constructor(){super("dht.RouteMessageWrapper",[{no:1,name:"requestId",kind:"scalar",T:9},{no:2,name:"sourcePeer",kind:"message",T:()=>A_},{no:3,name:"target",kind:"scalar",T:12},{no:4,name:"message",kind:"message",T:()=>T_},{no:5,name:"reachableThrough",kind:"message",repeat:2,T:()=>A_},{no:6,name:"routingPath",kind:"message",repeat:2,T:()=>A_},{no:7,name:"parallelRootNodeIds",kind:"scalar",repeat:2,T:9}])}},R_=new class extends sS{constructor(){super("dht.RouteMessageAck",[{no:1,name:"requestId",kind:"scalar",T:9},{no:2,name:"error",kind:"enum",opt:!0,T:()=>["dht.RouteMessageError",i_]}])}},P_=new class extends sS{constructor(){super("dht.ConnectivityRequest",[{no:1,name:"port",kind:"scalar",T:13},{no:2,name:"tls",kind:"scalar",T:8},{no:3,name:"host",kind:"scalar",opt:!0,T:9},{no:4,name:"allowSelfSignedCertificate",kind:"scalar",T:8}])}},I_=new class extends sS{constructor(){super("dht.ConnectivityResponse",[{no:1,name:"host",kind:"scalar",T:9},{no:2,name:"natType",kind:"scalar",T:9},{no:3,name:"websocket",kind:"message",T:()=>S_},{no:4,name:"ipAddress",kind:"scalar",T:13},{no:5,name:"protocolVersion",kind:"scalar",T:9},{no:6,name:"latitude",kind:"scalar",opt:!0,T:1},{no:7,name:"longitude",kind:"scalar",opt:!0,T:1}])}},C_=new class extends sS{constructor(){super("dht.HandshakeRequest",[{no:1,name:"sourcePeerDescriptor",kind:"message",T:()=>A_},{no:2,name:"targetPeerDescriptor",kind:"message",T:()=>A_},{no:3,name:"protocolVersion",kind:"scalar",T:9},{no:4,name:"applicationVersion",kind:"scalar",T:9}])}},__=new class extends sS{constructor(){super("dht.HandshakeResponse",[{no:1,name:"sourcePeerDescriptor",kind:"message",T:()=>A_},{no:2,name:"error",kind:"enum",opt:!0,T:()=>["dht.HandshakeError",s_]},{no:3,name:"protocolVersion",kind:"scalar",T:9},{no:4,name:"applicationVersion",kind:"scalar",T:9}])}},T_=new class extends sS{constructor(){super("dht.Message",[{no:1,name:"messageId",kind:"scalar",T:9},{no:2,name:"sourceDescriptor",kind:"message",T:()=>A_},{no:3,name:"targetDescriptor",kind:"message",T:()=>A_},{no:4,name:"serviceId",kind:"scalar",T:9},{no:5,name:"rpcMessage",kind:"message",oneof:"body",T:()=>XC},{no:6,name:"connectivityRequest",kind:"message",oneof:"body",T:()=>P_},{no:7,name:"connectivityResponse",kind:"message",oneof:"body",T:()=>I_},{no:8,name:"handshakeRequest",kind:"message",oneof:"body",T:()=>C_},{no:9,name:"handshakeResponse",kind:"message",oneof:"body",T:()=>__},{no:10,name:"recursiveOperationRequest",kind:"message",oneof:"body",T:()=>y_}])}},N_=new class extends sS{constructor(){super("dht.WebsocketConnectionRequest",[])}},x_=new class extends sS{constructor(){super("dht.WebrtcConnectionRequest",[])}},O_=new class extends sS{constructor(){super("dht.RtcOffer",[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"connectionId",kind:"scalar",T:9}])}},D_=new class extends sS{constructor(){super("dht.RtcAnswer",[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"connectionId",kind:"scalar",T:9}])}},M_=new class extends sS{constructor(){super("dht.IceCandidate",[{no:1,name:"candidate",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"connectionId",kind:"scalar",T:9}])}},B_=new class extends sS{constructor(){super("dht.LockRequest",[{no:1,name:"lockId",kind:"scalar",T:9}])}},L_=new class extends sS{constructor(){super("dht.UnlockRequest",[{no:1,name:"lockId",kind:"scalar",T:9}])}},F_=new class extends sS{constructor(){super("dht.LockResponse",[{no:1,name:"accepted",kind:"scalar",T:8}])}},U_=new class extends sS{constructor(){super("dht.DisconnectNotice",[{no:1,name:"disconnectMode",kind:"enum",T:()=>["dht.DisconnectMode",o_]}])}},j_=new class extends sS{constructor(){super("dht.SetPrivateRequest",[{no:1,name:"isPrivate",kind:"scalar",T:8}])}},z_=new class extends sS{constructor(){super("dht.ExternalFetchDataRequest",[{no:1,name:"key",kind:"scalar",T:12}])}},q_=new class extends sS{constructor(){super("dht.ExternalFetchDataResponse",[{no:1,name:"entries",kind:"message",repeat:2,T:()=>h_}])}},K_=new class extends sS{constructor(){super("dht.ExternalFindClosestNodesRequest",[{no:1,name:"nodeId",kind:"scalar",T:12}])}},G_=new class extends sS{constructor(){super("dht.ExternalFindClosestNodesResponse",[{no:1,name:"closestNodes",kind:"message",repeat:2,T:()=>A_}])}};var $_,V_,H_,W_,J_;new oS("dht.DhtNodeRpc",[{name:"getClosestPeers",options:{},I:f_,O:p_},{name:"getClosestRingPeers",options:{},I:g_,O:m_},{name:"ping",options:{},I:w_,O:v_},{name:"leaveNotice",options:{},I:E_,O:QC}]),new oS("dht.RouterRpc",[{name:"routeMessage",options:{},I:k_,O:R_},{name:"forwardMessage",options:{},I:k_,O:R_}]),new oS("dht.RecursiveOperationRpc",[{name:"routeRequest",options:{},I:k_,O:R_}]),new oS("dht.StoreRpc",[{name:"storeData",options:{},I:a_,O:c_},{name:"replicateData",options:{},I:d_,O:QC}]),new oS("dht.RecursiveOperationSessionRpc",[{name:"sendResponse",options:{},I:b_,O:QC}]),new oS("dht.WebsocketClientConnectorRpc",[{name:"requestConnection",options:{},I:N_,O:QC}]),new oS("dht.WebrtcConnectorRpc",[{name:"requestConnection",options:{},I:x_,O:QC},{name:"rtcOffer",options:{},I:O_,O:QC},{name:"rtcAnswer",options:{},I:D_,O:QC},{name:"iceCandidate",options:{},I:M_,O:QC}]),new oS("dht.ConnectionLockRpc",[{name:"lockRequest",options:{},I:B_,O:F_},{name:"unlockRequest",options:{},I:L_,O:QC},{name:"gracefulDisconnect",options:{},I:U_,O:QC},{name:"setPrivate",options:{},I:j_,O:QC}]),new oS("dht.ExternalApiRpc",[{name:"externalFetchData",options:{},I:z_,O:q_},{name:"externalStoreData",options:{},I:u_,O:l_},{name:"externalFindClosestNodes",options:{},I:K_,O:G_}]),function(e){e[e.JSON=0]="JSON",e[e.BINARY=1]="BINARY"}($_||($_={})),function(e){e[e.NONE=0]="NONE",e[e.AES=1]="AES"}(V_||(V_={})),function(e){e[e.RSA=0]="RSA",e[e.ML_KEM=1]="ML_KEM"}(H_||(H_={})),function(e){e[e.ECDSA_SECP256K1_LEGACY=0]="ECDSA_SECP256K1_LEGACY",e[e.ECDSA_SECP256K1_EVM=1]="ECDSA_SECP256K1_EVM",e[e.ERC_1271=2]="ERC_1271",e[e.ML_DSA_87=3]="ML_DSA_87",e[e.ECDSA_SECP256R1=4]="ECDSA_SECP256R1"}(W_||(W_={})),function(e){e[e.PUBLISH=0]="PUBLISH",e[e.SUBSCRIBE=1]="SUBSCRIBE"}(J_||(J_={}));const Z_=new class extends sS{constructor(){super("MessageID",[{no:1,name:"streamId",kind:"scalar",T:9},{no:2,name:"streamPartition",kind:"scalar",T:5},{no:3,name:"timestamp",kind:"scalar",T:3,L:2},{no:4,name:"sequenceNumber",kind:"scalar",T:5},{no:5,name:"publisherId",kind:"scalar",T:12},{no:6,name:"messageChainId",kind:"scalar",T:9}])}},Q_=new class extends sS{constructor(){super("MessageRef",[{no:1,name:"timestamp",kind:"scalar",T:3,L:2},{no:2,name:"sequenceNumber",kind:"scalar",T:5}])}},Y_=new class extends sS{constructor(){super("StreamMessage",[{no:1,name:"messageId",kind:"message",T:()=>Z_},{no:2,name:"previousMessageRef",kind:"message",T:()=>Q_},{no:3,name:"signature",kind:"scalar",T:12},{no:4,name:"signatureType",kind:"enum",T:()=>["SignatureType",W_]},{no:5,name:"contentMessage",kind:"message",oneof:"body",T:()=>X_},{no:6,name:"groupKeyRequest",kind:"message",oneof:"body",T:()=>eT},{no:7,name:"groupKeyResponse",kind:"message",oneof:"body",T:()=>tT}])}},X_=new class extends sS{constructor(){super("ContentMessage",[{no:1,name:"content",kind:"scalar",T:12},{no:2,name:"contentType",kind:"enum",T:()=>["ContentType",$_]},{no:3,name:"encryptionType",kind:"enum",T:()=>["EncryptionType",V_]},{no:4,name:"groupKeyId",kind:"scalar",opt:!0,T:9},{no:5,name:"newGroupKey",kind:"message",T:()=>rT}])}},eT=new class extends sS{constructor(){super("GroupKeyRequest",[{no:1,name:"requestId",kind:"scalar",T:9},{no:2,name:"recipientId",kind:"scalar",T:12},{no:3,name:"publicKey",kind:"scalar",T:12},{no:4,name:"groupKeyIds",kind:"scalar",repeat:2,T:9},{no:5,name:"encryptionType",kind:"enum",T:()=>["AsymmetricEncryptionType",H_]}])}},tT=new class extends sS{constructor(){super("GroupKeyResponse",[{no:1,name:"requestId",kind:"scalar",T:9},{no:2,name:"recipientId",kind:"scalar",T:12},{no:3,name:"groupKeys",kind:"message",repeat:2,T:()=>rT},{no:4,name:"encryptionType",kind:"enum",T:()=>["AsymmetricEncryptionType",H_]}])}},rT=new class extends sS{constructor(){super("EncryptedGroupKey",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"data",kind:"scalar",T:12}])}},nT=new class extends sS{constructor(){super("StreamPartHandshakeRequest",[{no:1,name:"streamPartId",kind:"scalar",T:9},{no:2,name:"requestId",kind:"scalar",T:9},{no:3,name:"concurrentHandshakeNodeId",kind:"scalar",opt:!0,T:12},{no:4,name:"neighborNodeIds",kind:"scalar",repeat:2,T:12},{no:5,name:"interleaveNodeId",kind:"scalar",opt:!0,T:12}])}},iT=new class extends sS{constructor(){super("StreamPartHandshakeResponse",[{no:1,name:"accepted",kind:"scalar",T:8},{no:2,name:"requestId",kind:"scalar",T:9},{no:3,name:"interleaveTargetDescriptor",kind:"message",T:()=>A_}])}},sT=new class extends sS{constructor(){super("InterleaveRequest",[{no:1,name:"interleaveTargetDescriptor",kind:"message",T:()=>A_}])}},oT=new class extends sS{constructor(){super("InterleaveResponse",[{no:1,name:"accepted",kind:"scalar",T:8}])}},aT=new class extends sS{constructor(){super("LeaveStreamPartNotice",[{no:1,name:"streamPartId",kind:"scalar",T:9},{no:2,name:"isEntryPoint",kind:"scalar",T:8}])}},cT=new class extends sS{constructor(){super("NeighborUpdate",[{no:1,name:"streamPartId",kind:"scalar",T:9},{no:2,name:"removeMe",kind:"scalar",T:8},{no:3,name:"neighborDescriptors",kind:"message",repeat:2,T:()=>A_}])}},uT=new class extends sS{constructor(){super("ProxyConnectionRequest",[{no:1,name:"direction",kind:"enum",opt:!0,T:()=>["ProxyDirection",J_]},{no:2,name:"userId",kind:"scalar",T:12}])}},lT=new class extends sS{constructor(){super("ProxyConnectionResponse",[{no:1,name:"accepted",kind:"scalar",T:8}])}},dT=new class extends sS{constructor(){super("TemporaryConnectionRequest",[])}},hT=new class extends sS{constructor(){super("TemporaryConnectionResponse",[{no:1,name:"accepted",kind:"scalar",T:8}])}},fT=new class extends sS{constructor(){super("CloseTemporaryConnection",[])}},pT=new class extends sS{constructor(){super("StreamPartitionInfo",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"controlLayerNeighbors",kind:"message",repeat:2,T:()=>A_},{no:3,name:"deprecatedContentDeliveryLayerNeighbors",kind:"message",repeat:2,T:()=>A_},{no:4,name:"contentDeliveryLayerNeighbors",kind:"message",repeat:2,T:()=>gT}])}},gT=new class extends sS{constructor(){super("ContentDeliveryLayerNeighborInfo",[{no:1,name:"peerDescriptor",kind:"message",T:()=>A_},{no:2,name:"rtt",kind:"scalar",opt:!0,T:5}])}},mT=new class extends sS{constructor(){super("ControlLayerInfo",[{no:1,name:"neighbors",kind:"message",repeat:2,T:()=>A_},{no:2,name:"connections",kind:"message",repeat:2,T:()=>A_}])}},yT=new class extends sS{constructor(){super("NodeInfoRequest",[])}},bT=new class extends sS{constructor(){super("NodeInfoResponse",[{no:1,name:"peerDescriptor",kind:"message",T:()=>A_},{no:2,name:"streamPartitions",kind:"message",repeat:2,T:()=>pT},{no:3,name:"controlLayer",kind:"message",T:()=>mT},{no:4,name:"applicationVersion",kind:"scalar",T:9}])}},wT=new class extends sS{constructor(){super("PauseNeighborRequest",[{no:1,name:"messageChainId",kind:"scalar",T:9}])}},vT=new class extends sS{constructor(){super("ResumeNeighborRequest",[{no:1,name:"messageChainId",kind:"scalar",T:9},{no:2,name:"fromTimestamp",kind:"scalar",T:3,L:2}])}},ET=new oS("ContentDeliveryRpc",[{name:"sendStreamMessage",options:{},I:Y_,O:QC},{name:"leaveStreamPartNotice",options:{},I:aT,O:QC}]),AT=new oS("ProxyConnectionRpc",[{name:"requestConnection",options:{},I:uT,O:lT}]),ST=new oS("HandshakeRpc",[{name:"handshake",options:{},I:nT,O:iT},{name:"interleaveRequest",options:{},I:sT,O:oT}]),kT=new oS("NeighborUpdateRpc",[{name:"neighborUpdate",options:{},I:cT,O:cT}]),RT=new oS("TemporaryConnectionRpc",[{name:"openConnection",options:{},I:dT,O:hT},{name:"closeConnection",options:{},I:fT,O:QC}]),PT=new oS("NodeInfoRpc",[{name:"getInfo",options:{},I:yT,O:bT}]),IT=new oS("PlumtreeRpc",[{name:"pauseNeighbor",options:{},I:wT,O:QC},{name:"resumeNeighbor",options:{},I:vT,O:QC},{name:"sendMetadata",options:{},I:Z_,O:QC}]);class CT{_transport;typeName=ET.typeName;methods=ET.methods;options=ET.options;constructor(e){this._transport=e}sendStreamMessage(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}leaveStreamPartNotice(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class _T{_transport;typeName=AT.typeName;methods=AT.methods;options=AT.options;constructor(e){this._transport=e}requestConnection(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class TT{_transport;typeName=ST.typeName;methods=ST.methods;options=ST.options;constructor(e){this._transport=e}handshake(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}interleaveRequest(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class NT{_transport;typeName=kT.typeName;methods=kT.methods;options=kT.options;constructor(e){this._transport=e}neighborUpdate(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class xT{_transport;typeName=RT.typeName;methods=RT.methods;options=RT.options;constructor(e){this._transport=e}openConnection(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}closeConnection(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class OT{_transport;typeName=PT.typeName;methods=PT.methods;options=PT.options;constructor(e){this._transport=e}getInfo(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}class DT{_transport;typeName=IT.typeName;methods=IT.methods;options=IT.options;constructor(e){this._transport=e}pauseNeighbor(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}resumeNeighbor(e,t){const r=this.methods[1],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}sendMetadata(e,t){const r=this.methods[2],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}const MT=new Ta("ContentDeliveryRpcRemote");class BT extends EP{rtt;async sendStreamMessage(e,t){const r=this.formDhtRpcOptions({notification:!0,bufferWhileConnecting:t});this.getClient().sendStreamMessage(e,r).catch(()=>{MT.trace("Failed to sendStreamMessage")})}leaveStreamPartNotice(e,t){const r={streamPartId:e,isEntryPoint:t},n=this.formDhtRpcOptions({notification:!0});this.getClient().leaveStreamPartNotice(r,n).catch(()=>{MT.debug("Failed to send leaveStreamPartNotice")})}setRtt(e){this.rtt=e}getRtt(){return this.rtt}}const LT=new Ta("HandshakeRpcLocal");class FT{options;constructor(e){this.options=e}async handshake(e,t){return this.handleRequest(e,t)}handleRequest(e,t){const r=t.incomingSourceDescriptor,n=Dk(r);return this.options.ongoingInterleaves.has(n)?this.rejectHandshake(e):this.options.neighbors.has(n)||this.options.ongoingHandshakes.has(n)||this.options.neighbors.size()+this.options.ongoingHandshakes.size<this.options.maxNeighborCount?this.acceptHandshake(e,r):this.options.neighbors.size(void 0!==e.interleaveNodeId?[xk(e.interleaveNodeId)]:[])-this.options.ongoingInterleaves.size>=2&&this.options.neighbors.size()<=this.options.maxNeighborCount?this.acceptHandshakeWithInterleaving(e,r):this.rejectHandshake(e)}acceptHandshake(e,t){const r={requestId:e.requestId,accepted:!0};return this.options.neighbors.add(this.options.createContentDeliveryRpcRemote(t)),r}rejectHandshake(e){return{requestId:e.requestId,accepted:!1}}acceptHandshakeWithInterleaving(e,t){const r=[];e.neighborNodeIds.forEach(e=>r.push(xk(e))),this.options.ongoingInterleaves.forEach(e=>r.push(e)),r.push(Dk(t)),void 0!==e.interleaveNodeId&&r.push(xk(e.interleaveNodeId));const n=this.options.neighbors.getLast(r),i=n?n.getPeerDescriptor():void 0;if(n){const e=Dk(n.getPeerDescriptor()),r=this.options.createRpcRemote(n.getPeerDescriptor());this.options.ongoingInterleaves.add(e),r.interleaveRequest(t).then(e=>{e.accepted&&this.options.neighbors.remove(Dk(i))}).catch(()=>{}).finally(()=>{this.options.ongoingInterleaves.delete(e)})}return this.options.neighbors.add(this.options.createContentDeliveryRpcRemote(t)),{requestId:e.requestId,accepted:!0,interleaveTargetDescriptor:i}}async interleaveRequest(e,t){const r=t.incomingSourceDescriptor,n=Dk(r);try{return await this.options.handshakeWithInterleaving(e.interleaveTargetDescriptor,n),this.options.neighbors.remove(n),{accepted:!0}}catch(t){return LT.debug(`interleaveRequest to ${Dk(e.interleaveTargetDescriptor)} failed`,{err:t}),{accepted:!1}}}}const UT=new Ta("HandshakeRpcRemote");class jT extends EP{async handshake(e,t,r,n){const i={streamPartId:e,requestId:hS(),neighborNodeIds:t.map(e=>Ok(e)),concurrentHandshakeNodeId:void 0!==r?Ok(r):void 0,interleaveNodeId:void 0!==n?Ok(n):void 0};try{const e=await this.getClient().handshake(i,this.formDhtRpcOptions());return{accepted:e.accepted,interleaveTargetDescriptor:e.interleaveTargetDescriptor}}catch(e){return UT.debug(`handshake to ${Dk(this.getPeerDescriptor())} failed`,{err:e}),{accepted:!1}}}async interleaveRequest(e){const t={interleaveTargetDescriptor:e},r=this.formDhtRpcOptions({connect:!1,timeout:1e4});try{return{accepted:(await this.getClient().interleaveRequest(t,r)).accepted}}catch(e){return UT.debug(`interleaveRequest to ${Dk(this.getPeerDescriptor())} failed`,{err:e}),{accepted:!1}}}}const zT=new Ta("Handshaker");class qT{options;rpcLocal;constructor(e){this.options=e,this.rpcLocal=new FT({streamPartId:this.options.streamPartId,neighbors:this.options.neighbors,ongoingHandshakes:this.options.ongoingHandshakes,ongoingInterleaves:new Set,maxNeighborCount:this.options.maxNeighborCount,handshakeWithInterleaving:(e,t)=>this.handshakeWithInterleaving(e,t),createRpcRemote:e=>this.createRpcRemote(e),createContentDeliveryRpcRemote:e=>this.createContentDeliveryRpcRemote(e)}),this.options.rpcCommunicator.registerRpcMethod(sT,oT,"interleaveRequest",(e,t)=>this.rpcLocal.interleaveRequest(e,t),{timeout:1e4}),this.options.rpcCommunicator.registerRpcMethod(nT,iT,"handshake",(e,t)=>this.rpcLocal.handshake(e,t))}async attemptHandshakesOnContacts(e){return this.options.neighbors.size()+this.options.ongoingHandshakes.size<this.options.maxNeighborCount-2?(zT.trace("Attempting parallel handshakes with 2 targets"),this.selectParallelTargetsAndHandshake(e)):this.options.neighbors.size()+this.options.ongoingHandshakes.size<this.options.maxNeighborCount?(zT.trace("Attempting handshake with new target"),this.selectNewTargetAndHandshake(e)):e}async selectParallelTargetsAndHandshake(e){const t=e.concat(this.options.neighbors.getIds()),r=this.selectParallelTargets(t);return r.forEach(e=>this.options.ongoingHandshakes.add(Dk(e.getPeerDescriptor()))),this.doParallelHandshakes(r,t)}selectParallelTargets(e){const t=new Map,r=()=>[...e,...Array.from(t.keys())];if(0===this.options.neighbors.size()){const e=this.options.nearbyNodeView.getFirst(r(),!0);if(e){const r=Dk(e.getPeerDescriptor());t.set(r,e)}}const n=this.options.leftNodeView.getFirst(r()),i=this.options.rightNodeView.getFirst(r());if(n&&t.set(Dk(n.getPeerDescriptor()),n),i&&t.set(Dk(i.getPeerDescriptor()),i),t.size<2){const e=this.options.nearbyNodeView.getFirst(r());e&&t.set(Dk(e.getPeerDescriptor()),e)}for(;t.size<2;){const e=this.options.randomNodeView.getRandom(r());if(!e)break;t.set(Dk(e.getPeerDescriptor()),e)}return Array.from(t.values()).map(e=>this.createRpcRemote(e.getPeerDescriptor()))}async doParallelHandshakes(e,t){return(await Promise.allSettled(Array.from(e.values()).map(async(t,r)=>{const n=0===r?e[1]:e[0],i=n?Dk(n.getPeerDescriptor()):void 0;return this.handshakeWithTarget(t,i)}))).forEach((r,n)=>{"fulfilled"===r.status&&r.value||t.push(Dk(e[n].getPeerDescriptor()))}),t}async selectNewTargetAndHandshake(e){const t=e.concat(this.options.neighbors.getIds()),r=this.options.leftNodeView.getFirst(t)??this.options.rightNodeView.getFirst(t)??this.options.nearbyNodeView.getFirst(t)??this.options.randomNodeView.getRandom(t);return r&&(await this.handshakeWithTarget(this.createRpcRemote(r.getPeerDescriptor()))||e.push(Dk(r.getPeerDescriptor()))),e}async handshakeWithTarget(e,t){const r=Dk(e.getPeerDescriptor());this.options.ongoingHandshakes.add(r);const n=await e.handshake(this.options.streamPartId,this.options.neighbors.getIds(),t);return n.accepted&&this.options.neighbors.add(this.createContentDeliveryRpcRemote(e.getPeerDescriptor())),n.interleaveTargetDescriptor&&await this.handshakeWithInterleaving(n.interleaveTargetDescriptor,r),this.options.ongoingHandshakes.delete(r),n.accepted}async handshakeWithInterleaving(e,t){const r=this.createRpcRemote(e),n=Dk(r.getPeerDescriptor());this.options.ongoingHandshakes.add(n);const i=await r.handshake(this.options.streamPartId,this.options.neighbors.getIds(),void 0,t);return i.accepted&&this.options.neighbors.add(this.createContentDeliveryRpcRemote(r.getPeerDescriptor())),this.options.ongoingHandshakes.delete(n),i.accepted}createRpcRemote(e){return new jT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,TT,this.options.rpcRequestTimeout)}createContentDeliveryRpcRemote(e){return new BT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,CT,this.options.rpcRequestTimeout)}getOngoingHandshakes(){return this.options.ongoingHandshakes}}const KT=new Ta("NeighborFinder");class GT{abortController;options;running=!1;constructor(e){this.options=e,this.abortController=new AbortController}async findNeighbors(e){if(!this.running)return;const t=await this.options.doFindNeighbors(e),r=new Set([...this.options.nearbyNodeView.getIds(),...this.options.leftNodeView.getIds(),...this.options.rightNodeView.getIds(),...this.options.randomNodeView.getIds()]).size;this.options.neighbors.size()<this.options.minCount&&t.length<r?Zi(()=>this.findNeighbors(t),250,this.abortController.signal):0===this.options.neighbors.size()&&r>0?(KT.debug("No neighbors found yet contacts are available, restarting handshaking process"),Zi(()=>this.findNeighbors([]),250,this.abortController.signal)):this.running=!1}isRunning(){return this.running}start(e=[]){this.running||(this.running=!0,Zi(async()=>{await Promise.all([this.findNeighbors(e),this.findNeighbors(e)])},100,this.abortController.signal))}stop(){this.running&&(this.running=!1,this.abortController.abort())}}class $T{options;constructor(e){this.options=e}updateContacts(e){const t=Dk(this.options.localPeerDescriptor);e.filter(e=>{const r=Dk(e);return r!==t&&!this.options.neighbors.getIds().includes(r)}).forEach(e=>this.options.nearbyNodeView.add(new BT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,CT)))}createResponse(e){return{streamPartId:this.options.streamPartId,neighborDescriptors:this.options.neighbors.getAll().map(e=>e.getPeerDescriptor()),removeMe:e}}async neighborUpdate(e,t){const r=t.incomingSourceDescriptor,n=Dk(r);if(this.updateContacts(e.neighborDescriptors),this.options.neighbors.has(n)||this.options.ongoingHandshakes.has(n)){const t=this.options.neighbors.size()>this.options.neighborTargetCount&&e.neighborDescriptors.length>this.options.neighborTargetCount;return t?this.options.neighbors.remove(n):this.options.neighborFinder.start(),this.createResponse(t)}return this.createResponse(!0)}}const VT=new Ta("NeighborUpdateRpcRemote");class HT extends EP{async updateNeighbors(e,t){const r={streamPartId:e,neighborDescriptors:t,removeMe:!1};try{const e=await this.getClient().neighborUpdate(r,this.formDhtRpcOptions());return{peerDescriptors:e.neighborDescriptors,removeMe:e.removeMe}}catch(e){return VT.debug(`updateNeighbors to ${Dk(this.getPeerDescriptor())} failed`,{err:e}),{peerDescriptors:[],removeMe:!0}}}}const WT=new Ta("NeighborUpdateManager");class JT{abortController;options;rpcLocal;constructor(e){this.abortController=new AbortController,this.rpcLocal=new $T(e),this.options=e,this.options.rpcCommunicator.registerRpcMethod(cT,cT,"neighborUpdate",(e,t)=>this.rpcLocal.neighborUpdate(e,t))}async start(){await Ka(()=>this.updateNeighborInfo(),this.options.neighborUpdateInterval,!1,this.abortController.signal)}stop(){this.abortController.abort()}async updateNeighborInfo(){WT.trace("Updating neighbor info to nodes");const e=this.options.neighbors.getAll().map(e=>e.getPeerDescriptor()),t=Date.now();await Promise.allSettled(this.options.neighbors.getAll().map(async r=>{const n=await this.createRemote(r.getPeerDescriptor()).updateNeighbors(this.options.streamPartId,e),i=Dk(r.getPeerDescriptor());this.options.neighbors.get(i).setRtt(Date.now()-t),n.removeMe&&(this.options.neighbors.remove(i),this.options.neighborFinder.start([i]))}))}createRemote(e){return new HT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,NT)}}class ZT{options;constructor(e){this.options=e}async sendStreamMessage(e,t){const r=t.incomingSourceDescriptor,n=Dk(r);return this.options.markForInspection(n,e.messageId),void 0===this.options.plumtreeManager?this.options.markAndCheckDuplicate(e.messageId,e.previousMessageRef)&&this.options.broadcast(e,n):this.options.markAndCheckDuplicate(e.messageId,e.previousMessageRef)?this.options.plumtreeManager.broadcast(e,n):await this.options.plumtreeManager.pauseNeighbor(r,e.messageId.messageChainId),QC}async leaveStreamPartNotice(e,t){if(e.streamPartId===this.options.streamPartId){const r=t.incomingSourceDescriptor,n=Dk(r);this.options.onLeaveNotice(n,e.isEntryPoint)}return QC}}class QT{a;b;constructor(e,t){this.a=e,this.b=t}greaterThanOrEqual(e){return this.greaterThan(e)||this.equalTo(e)}greaterThan(e){return 1===this.compareTo(e)}equalTo(e){return 0===this.compareTo(e)}compareTo(e){return this.a>e.a?1:this.a<e.a?-1:this.b>e.b?1:this.b<e.b?-1:0}toString(){return`${this.a}|${this.b}`}}class YT extends Error{constructor(){super("pre-condition: previousNumber < number")}}class XT extends Error{constructor(e,t,r){super(`pre-condition: gap overlap in given numbers: previousNumber=${t.toString()}, number=${r.toString()}, state=${e}`)}}class eN{maxGapCount;gaps;constructor(e=1e4){this.maxGapCount=e,this.gaps=[]}markAndCheck(e,t){if(e?.greaterThanOrEqual(t))throw new YT;if(0===this.gaps.length)return this.gaps.push([t,new QT(1/0,1/0)]),!0;if(null===e)return!!t.greaterThan(this.gaps[this.gaps.length-1][0])&&(this.gaps[this.gaps.length-1][0]=t,!0);for(let r=this.gaps.length-1;r>=0;--r){const[n,i]=this.gaps[r];if(e.greaterThanOrEqual(i))return!1;if(e.greaterThanOrEqual(n)){if(t.greaterThan(i))throw new XT(this.toString(),e,t);return e.equalTo(n)?t.equalTo(i)?this.gaps.splice(r,1):this.gaps[r]=[t,i]:t.equalTo(i)?this.gaps[r]=[n,e]:this.gaps.splice(r,1,[n,e],[t,i]),this.dropLowestGapIfOverMaxGapCount(),!0}if(t.greaterThan(n))throw new XT(this.toString(),e,t)}return!1}dropLowestGapIfOverMaxGapCount(){this.gaps.length>this.maxGapCount&&this.gaps.shift()}toString(){return this.gaps.map(([e,t])=>`(${e.toString()}, ${t.toString()}]`).join(", ")}}const tN=(e,t,r)=>{const n=`${yc(t.publisherId)}-${t.messageChainId}`,i=r?new QT(Number(r.timestamp),r.sequenceNumber):null,s=new QT(Number(t.timestamp),t.sequenceNumber);return e.has(n)||e.set(n,new eN),e.get(n).markAndCheck(i,s)},rN=new Ta("ContentDeliveryLayerNode");class nN extends zr{started=!1;duplicateDetectors;options;contentDeliveryRpcLocal;abortController=new AbortController;messagesPropagated=0;constructor(e){super(),this.options=e,this.duplicateDetectors=new Map,this.contentDeliveryRpcLocal=new ZT({localPeerDescriptor:this.options.localPeerDescriptor,streamPartId:this.options.streamPartId,rpcCommunicator:this.options.rpcCommunicator,markAndCheckDuplicate:(e,t)=>tN(this.duplicateDetectors,e,t),broadcast:(e,t)=>this.broadcast(e,t),onLeaveNotice:(e,t)=>{this.abortController.signal.aborted||((this.options.nearbyNodeView.get(e)??this.options.randomNodeView.get(e)??this.options.neighbors.get(e)??this.options.proxyConnectionRpcLocal?.getConnection(e)?.remote)&&(this.options.discoveryLayerNode.removeContact(e),this.options.neighbors.remove(e),this.options.nearbyNodeView.remove(e),this.options.randomNodeView.remove(e),this.options.leftNodeView.remove(e),this.options.rightNodeView.remove(e),this.options.neighborFinder.start([e]),this.options.proxyConnectionRpcLocal?.removeConnection(e)),t&&this.emit("entryPointLeaveDetected"))},markForInspection:(e,t)=>this.options.inspector.markMessage(e,t),plumtreeManager:this.options.plumtreeManager})}async start(){this.started=!0,this.registerDefaultServerMethods(),Xa(this.options.discoveryLayerNode,"nearbyContactAdded",()=>this.onNearbyContactAdded(),this.abortController.signal),Xa(this.options.discoveryLayerNode,"nearbyContactRemoved",()=>this.onNearbyContactRemoved(),this.abortController.signal),Xa(this.options.discoveryLayerNode,"randomContactAdded",()=>this.onRandomContactAdded(),this.abortController.signal),Xa(this.options.discoveryLayerNode,"randomContactRemoved",()=>this.onRandomContactRemoved(),this.abortController.signal),Xa(this.options.discoveryLayerNode,"ringContactAdded",()=>this.onRingContactsUpdated(),this.abortController.signal),Xa(this.options.discoveryLayerNode,"ringContactRemoved",()=>this.onRingContactsUpdated(),this.abortController.signal),Xa(this.options.transport,"disconnected",e=>this.onNodeDisconnected(e),this.abortController.signal),Xa(this.options.neighbors,"nodeAdded",(e,t)=>{this.options.propagation.onNeighborJoined(e),this.options.connectionLocker.weakLockConnection(Dk(t.getPeerDescriptor()),this.options.streamPartId),this.emit("neighborConnected",e)},this.abortController.signal),Xa(this.options.neighbors,"nodeRemoved",(e,t)=>{this.options.connectionLocker.weakUnlockConnection(Dk(t.getPeerDescriptor()),this.options.streamPartId)},this.abortController.signal),void 0!==this.options.proxyConnectionRpcLocal&&Xa(this.options.proxyConnectionRpcLocal,"newConnection",e=>this.options.propagation.onNeighborJoined(e),this.abortController.signal),this.options.plumtreeManager&&Xa(this.options.plumtreeManager,"message",e=>this.emit("message",e),this.abortController.signal),this.options.neighborFinder.start(),await this.options.neighborUpdateManager.start()}registerDefaultServerMethods(){this.options.rpcCommunicator.registerRpcNotification(Y_,"sendStreamMessage",(e,t)=>this.contentDeliveryRpcLocal.sendStreamMessage(e,t)),this.options.rpcCommunicator.registerRpcNotification(aT,"leaveStreamPartNotice",(e,t)=>this.contentDeliveryRpcLocal.leaveStreamPartNotice(e,t)),this.options.rpcCommunicator.registerRpcMethod(dT,hT,"openConnection",(e,t)=>this.options.temporaryConnectionRpcLocal.openConnection(e,t)),this.options.rpcCommunicator.registerRpcNotification(fT,"closeConnection",(e,t)=>this.options.temporaryConnectionRpcLocal.closeConnection(e,t))}onRingContactsUpdated(){if(rN.trace("onRingContactsUpdated"),this.isStopped())return;const e=this.options.discoveryLayerNode.getRingContacts();this.options.leftNodeView.replaceAll(e.left.map(e=>new BT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,CT,this.options.rpcRequestTimeout))),this.options.rightNodeView.replaceAll(e.right.map(e=>new BT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,CT,this.options.rpcRequestTimeout)))}onNearbyContactAdded(){if(rN.trace("New nearby contact found"),this.isStopped())return;const e=this.options.discoveryLayerNode.getClosestContacts();this.updateNearbyNodeView(e),this.options.neighbors.size()<this.options.neighborTargetCount&&this.options.neighborFinder.start()}onNearbyContactRemoved(){if(rN.trace("Nearby contact removed"),this.isStopped())return;const e=this.options.discoveryLayerNode.getClosestContacts();this.updateNearbyNodeView(e)}updateNearbyNodeView(e){this.options.nearbyNodeView.replaceAll(Array.from(e).map(e=>new BT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,CT,this.options.rpcRequestTimeout)));for(const e of this.options.discoveryLayerNode.getNeighbors()){if(this.options.nearbyNodeView.size()>=this.options.nodeViewSize)break;this.options.nearbyNodeView.add(new BT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,CT,this.options.rpcRequestTimeout))}}onRandomContactAdded(){if(this.isStopped())return;const e=this.options.discoveryLayerNode.getRandomContacts(this.options.nodeViewSize);this.options.randomNodeView.replaceAll(e.map(e=>new BT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,CT,this.options.rpcRequestTimeout))),this.options.neighbors.size()<this.options.neighborTargetCount&&this.options.neighborFinder.start()}onRandomContactRemoved(){if(rN.trace("New random contact removed"),this.isStopped())return;const e=this.options.discoveryLayerNode.getRandomContacts(this.options.nodeViewSize);this.options.randomNodeView.replaceAll(e.map(e=>new BT(this.options.localPeerDescriptor,e,this.options.rpcCommunicator,CT,this.options.rpcRequestTimeout)))}onNodeDisconnected(e){const t=Dk(e);this.options.neighbors.has(t)&&(this.options.neighbors.remove(t),this.options.neighborFinder.start([t]),this.options.temporaryConnectionRpcLocal.removeNode(t))}hasProxyConnection(e){return!!this.options.proxyConnectionRpcLocal&&this.options.proxyConnectionRpcLocal.hasConnection(e)}stop(){this.started&&(this.abortController.abort(),this.options.proxyConnectionRpcLocal?.stop(),this.options.neighbors.getAll().map(e=>{e.leaveStreamPartNotice(this.options.streamPartId,this.options.isLocalNodeEntryPoint()),this.options.connectionLocker.weakUnlockConnection(Dk(e.getPeerDescriptor()),this.options.streamPartId)}),this.options.rpcCommunicator.destroy(),this.removeAllListeners(),this.options.plumtreeManager?.stop(),this.options.nearbyNodeView.stop(),this.options.neighbors.stop(),this.options.randomNodeView.stop(),this.options.neighborFinder.stop(),this.options.neighborUpdateManager.stop(),this.options.inspector.stop())}broadcast(e,t){t||tN(this.duplicateDetectors,e.messageId,e.previousMessageRef),this.emit("message",e);const r=void 0!==t&&!this.options.temporaryConnectionRpcLocal.hasNode(t);this.options.propagation.feedUnseenMessage(e,this.getPropagationTargets(e),r?t:null),this.messagesPropagated+=1}inspect(e){return this.options.inspector.inspect(e)}getPropagationTargets(e){let t=this.options.neighbors.getIds();return this.options.proxyConnectionRpcLocal&&(t=t.concat(this.options.proxyConnectionRpcLocal.getPropagationTargets(e))),t=t.concat(this.options.temporaryConnectionRpcLocal.getNodes().getIds()),t}getOwnNodeId(){return Dk(this.options.localPeerDescriptor)}getOutgoingHandshakeCount(){return this.options.handshaker.getOngoingHandshakes().size}getNeighbors(){return!this.started&&this.isStopped()?[]:this.options.neighbors.getAll().map(e=>e.getPeerDescriptor())}getInfos(){return this.options.neighbors.getAll().map(e=>({peerDescriptor:e.getPeerDescriptor(),rtt:e.getRtt()}))}getNearbyNodeView(){return this.options.nearbyNodeView}getDiagnosticInfo(){return{neighborCount:this.options.neighbors.size(),nearbyNodeViewCount:this.options.nearbyNodeView.size(),randomNodeViewCount:this.options.randomNodeView.size(),leftNodeViewCount:this.options.leftNodeView.size(),rightNodeViewCount:this.options.rightNodeView.size(),messagesPropagated:this.messagesPropagated}}isStopped(){return this.abortController.signal.aborted}}const iN=(e,t,r=!1)=>(r?Array.from(e.entries()).filter(([e,t])=>void 0!==t.getPeerDescriptor().websocket):Array.from(e.entries())).filter(([e])=>!t.includes(e)).map(([e,t])=>t);class sN extends zr{nodes;limit;ownId;constructor(e,t){super(),this.nodes=new Map,this.limit=t,this.ownId=e}add(e){const t=Dk(e.getPeerDescriptor());if(this.ownId!==t&&this.nodes.size<this.limit){const r=this.nodes.has(t);this.nodes.set(t,e),r||this.emit("nodeAdded",t,e)}}remove(e){if(this.nodes.has(e)){const t=this.nodes.get(e);this.nodes.delete(e),this.emit("nodeRemoved",e,t)}}has(e){return this.nodes.has(e)}replaceAll(e){this.nodes.clear(),e.splice(0,this.limit).forEach(e=>{this.add(e)})}getIds(){return Array.from(this.nodes.keys())}get(e){return this.nodes.get(e)}size(e=[]){return Array.from(this.nodes.keys()).filter(t=>!e.includes(t)).length}getRandom(e){return Cc()(iN(this.nodes,e))}getFirst(e,t=!1){return iN(this.nodes,e,t)[0]}getFirstAndLast(e){const t=iN(this.nodes,e);return 0===t.length?[]:t.length>1?[this.getFirst(e),this.getLast(e)]:[this.getFirst(e)]}getLast(e){const t=iN(this.nodes,e);return t[t.length-1]}getAll(){return Array.from(this.nodes.values())}stop(){this.nodes.forEach(e=>this.remove(Dk(e.getPeerDescriptor()))),this.removeAllListeners()}}class oN{items=new Map;dropQueue=UC.create();ttlInMs;maxSize;onItemDropped;timeProvider;constructor({ttlInMs:e,maxSize:t,onItemDropped:r=()=>{},timeProvider:n=Date.now}){if(e<0)throw new Error(`ttlInMs (${e}) cannot be < 0`);if(t<0)throw new Error(`maxSize (${t}) cannot be < 0`);this.ttlInMs=e,this.maxSize=t,this.onItemDropped=r,this.timeProvider=n}set(e,t){if(0===this.maxSize)return;if(this.items.size>this.maxSize)throw new Error("assertion error: maximum size exceeded");if(this.delete(e),this.items.size===this.maxSize){const e=this.dropQueue.shift();if(void 0===e)throw new Error("assertion error: queue empty but still have items");this.items.delete(e),this.onItemDropped(e)}const r=new KC(e);this.dropQueue.pushNode(r),this.items.set(e,{value:t,dropQueueNode:r,expiresAt:this.timeProvider()+this.ttlInMs})}delete(e){const t=this.items.get(e);void 0!==t&&(this.items.delete(e),this.dropQueue.removeNode(t.dropQueueNode),this.onItemDropped(e))}get(e){const t=this.items.get(e);if(void 0!==t){if(!(t.expiresAt<=this.timeProvider()))return t.value;this.delete(e)}}values(){const e=[...this.items.keys()],t=[];for(const r of e){const e=this.get(r);void 0!==e&&t.push(e)}return t}}class aN{tasks;constructor(e,t){this.tasks=new oN({ttlInMs:e,maxSize:t})}get(){return this.tasks.values()}add(e){const t=e.message.messageId;this.tasks.set(t,e)}delete(e){this.tasks.delete(e)}}class cN{sendToNeighbor;minPropagationTargets;activeTaskStore;constructor({sendToNeighbor:e,minPropagationTargets:t,maxMessages:r,ttl:n}){this.sendToNeighbor=e,this.minPropagationTargets=t,this.activeTaskStore=new aN(n,r)}feedUnseenMessage(e,t,r){const n={message:e,source:r,handledNeighbors:new Set};this.activeTaskStore.add(n);for(const e of t)this.sendAndAwaitThenMark(n,e)}onNeighborJoined(e){const t=this.activeTaskStore.get();for(const r of t)this.sendAndAwaitThenMark(r,e)}sendAndAwaitThenMark({message:e,source:t,handledNeighbors:r},n){r.has(n)||n===t||(async()=>{try{await this.sendToNeighbor(n,e)}catch{return}r.add(n),r.size>=this.minPropagationTargets&&this.activeTaskStore.delete(e.messageId)})()}}const uN=new Ta("ProxyConnectionRpcLocal");class lN extends zr{options;connections=new Map;constructor(e){super(),this.options=e,this.options.rpcCommunicator.registerRpcMethod(uT,lT,"requestConnection",(e,t)=>this.requestConnection(e,t))}getConnection(e){return this.connections.get(e)}hasConnection(e){return this.connections.has(e)}removeConnection(e){this.connections.delete(e)}stop(){this.connections.forEach(e=>e.remote.leaveStreamPartNotice(this.options.streamPartId,!1)),this.connections.clear(),this.removeAllListeners()}getPropagationTargets(e){if("groupKeyRequest"!==e.body.oneofKind)return this.getSubscribers();try{const t=e.body.groupKeyRequest.recipientId;return this.getNodeIdsForUserId(yc(t))}catch(e){return uN.trace("Could not parse GroupKeyRequest",{err:e}),[]}}getNodeIdsForUserId(e){return Array.from(this.connections.keys()).filter(t=>this.connections.get(t).userId===e)}getSubscribers(){return Array.from(this.connections.keys()).filter(e=>{const t=this.connections.get(e).direction;return void 0===t||t===J_.SUBSCRIBE})}async requestConnection(e,t){const r=t.incomingSourceDescriptor,n=Dk(r);return this.connections.set(n,{direction:e.direction,userId:yc(e.userId),remote:new BT(this.options.localPeerDescriptor,r,this.options.rpcCommunicator,CT)}),uN.trace(`Accepted connection request from ${n} to ${this.options.streamPartId}`),this.emit("newConnection",n),{accepted:!0}}}const dN=new Ta("TemporaryConnectionRpcRemote");class hN extends EP{async openConnection(){try{return(await this.getClient().openConnection({},this.formDhtRpcOptions())).accepted}catch(e){return dN.debug(`temporaryConnection to ${Dk(this.getPeerDescriptor())} failed`,{err:e}),!1}}async closeConnection(){try{await this.getClient().closeConnection({},this.formDhtRpcOptions({connect:!1,notification:!0}))}catch(e){dN.trace(`closeConnection to ${Dk(this.getPeerDescriptor())} failed`,{err:e})}}}class fN extends zr{inspectionMessages=new Map;inspectedNode;constructor(e){super(),this.inspectedNode=e.inspectedNode}markMessage(e,t){const r=(e=>`${yc(e.publisherId)}:${e.messageChainId}:${e.timestamp}:${e.sequenceNumber}`)(t);this.inspectionMessages.has(r)?(this.inspectionMessages.has(r)&&!1===this.inspectionMessages.get(r)&&e===this.inspectedNode||this.inspectionMessages.has(r)&&!0===this.inspectionMessages.get(r))&&this.emit("done"):this.inspectionMessages.set(r,e===this.inspectedNode)}getInspectedMessageCount(){return this.inspectionMessages.size}onlyMarkedByInspectedNode(){return Array.from(this.inspectionMessages.values()).every(e=>!0===e)}stop(){this.emit("done")}}const pN=new Ta("Inspector");class gN{sessions=new Map;streamPartId;localPeerDescriptor;rpcCommunicator;connectionLocker;inspectionTimeout;openInspectConnection;closeInspectConnection;constructor(e){this.streamPartId=e.streamPartId,this.localPeerDescriptor=e.localPeerDescriptor,this.rpcCommunicator=e.rpcCommunicator,this.connectionLocker=e.connectionLocker,this.inspectionTimeout=e.inspectionTimeout??6e4,this.openInspectConnection=e.openInspectConnection??this.defaultOpenInspectConnection,this.closeInspectConnection=e.closeInspectConnection??this.defaultCloseInspectConnection}async defaultOpenInspectConnection(e,t){const r=new hN(this.localPeerDescriptor,e,this.rpcCommunicator,xT);await r.openConnection(),this.connectionLocker.weakLockConnection(Dk(e),t)}async defaultCloseInspectConnection(e,t){const r=new hN(this.localPeerDescriptor,e,this.rpcCommunicator,xT);await r.closeConnection(),this.connectionLocker.weakUnlockConnection(Dk(e),t)}async inspect(e){const t=Dk(e),r=new fN({inspectedNode:t}),n=`inspector-${this.streamPartId}`;this.sessions.set(t,r),await this.openInspectConnection(e,n);let i=!1;try{await Ha(r,"done",this.inspectionTimeout),i=!0}catch{pN.trace("Inspect session timed out, removing")}finally{await this.closeInspectConnection(e,n),this.sessions.delete(t)}return i||r.getInspectedMessageCount()<1||r.onlyMarkedByInspectedNode()}markMessage(e,t){this.sessions.forEach(r=>r.markMessage(e,t))}isInspected(e){return this.sessions.has(e)}stop(){this.sessions.forEach(e=>{e.stop()}),this.sessions.clear()}}class mN{options;temporaryNodes;lockId;constructor(e){this.options=e,this.temporaryNodes=new sN(Dk(e.localPeerDescriptor),10),this.lockId="system/content-delivery/temporary-connection/"+e.streamPartId}getNodes(){return this.temporaryNodes}hasNode(e){return this.temporaryNodes.has(e)}removeNode(e){this.temporaryNodes.remove(e),this.options.connectionLocker.weakUnlockConnection(e,this.lockId)}async openConnection(e,t){const r=t.incomingSourceDescriptor,n=new BT(this.options.localPeerDescriptor,r,this.options.rpcCommunicator,CT);return this.temporaryNodes.add(n),this.options.connectionLocker.weakLockConnection(Dk(r),this.lockId),{accepted:!0}}async closeConnection(e,t){const r=Dk(t.incomingSourceDescriptor);return this.removeNode(r),{}}}const yN=e=>`stream-part-delivery-${e}`;class bN{neighbors;pausedNodes;onMetadataCb;sendBuffer;constructor(e,t,r,n){this.neighbors=e,this.pausedNodes=t,this.onMetadataCb=r,this.sendBuffer=n}async sendMetadata(e,t){const r=t.incomingSourceDescriptor;return await this.onMetadataCb(e,r),QC}async pauseNeighbor(e,t){const r=Dk(t.incomingSourceDescriptor);return this.neighbors.has(r)&&this.pausedNodes.add(r,e.messageChainId),QC}async resumeNeighbor(e,t){const r=t.incomingSourceDescriptor;return this.pausedNodes.delete(Dk(r),e.messageChainId),await this.sendBuffer(e.fromTimestamp,e.messageChainId,r),QC}}class wN extends EP{async sendMetadata(e){const t=this.formDhtRpcOptions({notification:!0});await this.getClient().sendMetadata(e,t)}async pauseNeighbor(e){const t=this.formDhtRpcOptions({notification:!0});await this.getClient().pauseNeighbor({messageChainId:e},t)}async resumeNeighbor(e,t){const r=this.formDhtRpcOptions({notification:!0});await this.getClient().resumeNeighbor({fromTimestamp:e,messageChainId:t},r)}}class vN{pausedNeighbors;limit;constructor(e){this.pausedNeighbors=new Map,this.limit=e}add(e,t){this.pausedNeighbors.has(t)||this.pausedNeighbors.set(t,new Set),this.pausedNeighbors.get(t).size>=this.limit||this.pausedNeighbors.get(t).add(e)}delete(e,t){this.pausedNeighbors.get(t)?.delete(e),0===this.pausedNeighbors.get(t)?.size&&this.pausedNeighbors.delete(t)}deleteAll(e){this.pausedNeighbors.forEach((t,r)=>{t.delete(e),0===t.size&&this.pausedNeighbors.delete(r)})}isPaused(e,t){return!!this.pausedNeighbors.has(t)&&this.pausedNeighbors.get(t).has(e)}forEach(e){this.pausedNeighbors.forEach((t,r)=>{e(t,r)})}size(e){return this.pausedNeighbors.get(e)?.size??0}}const EN=new Ta("PlumtreeManager");class AN extends zr{neighbors;localPeerDescriptor;localPausedNeighbors;remotePausedNeighbors;rpcLocal;latestMessages=new Map;rpcCommunicator;metadataTimestampsAheadOfRealData=new Map;maxPausedNeighbors;constructor(e){super(),this.neighbors=e.neighbors,this.maxPausedNeighbors=e.maxPausedNeighbors??3,this.localPeerDescriptor=e.localPeerDescriptor,this.localPausedNeighbors=new vN(e.maxPausedNeighbors??3),this.remotePausedNeighbors=new vN(e.maxPausedNeighbors??3),this.rpcLocal=new bN(this.neighbors,this.localPausedNeighbors,(e,t)=>this.onMetadata(e,t),(e,t,r)=>this.sendBuffer(e,t,r)),this.neighbors.on("nodeRemoved",e=>this.onNeighborRemoved(e)),this.rpcCommunicator=e.rpcCommunicator,this.rpcCommunicator.registerRpcNotification(Z_,"sendMetadata",(e,t)=>this.rpcLocal.sendMetadata(e,t)),this.rpcCommunicator.registerRpcNotification(wT,"pauseNeighbor",(e,t)=>this.rpcLocal.pauseNeighbor(e,t)),this.rpcCommunicator.registerRpcNotification(vT,"resumeNeighbor",(e,t)=>this.rpcLocal.resumeNeighbor(e,t))}async pauseNeighbor(e,t){if(this.neighbors.has(Dk(e))&&!this.remotePausedNeighbors.isPaused(Dk(e),t)&&this.remotePausedNeighbors.size(t)<this.maxPausedNeighbors){EN.debug(`Pausing neighbor ${Dk(e)}`),this.remotePausedNeighbors.add(Dk(e),t);const r=this.createRemote(e);await r.pauseNeighbor(t)}}async resumeNeighbor(e,t,r){if(this.remotePausedNeighbors.isPaused(Dk(e),t)){EN.debug(`Resuming neighbor ${Dk(e)}`),this.remotePausedNeighbors.delete(Dk(e),t);const n=this.createRemote(e);await n.resumeNeighbor(r,t)}}onNeighborRemoved(e){this.localPausedNeighbors.deleteAll(e),this.remotePausedNeighbors.deleteAll(e),this.neighbors.size()>0&&this.remotePausedNeighbors.forEach((e,t)=>{if(e.size>=this.neighbors.size()){EN.debug("All neighbors are paused, resuming first neighbor");const e=this.neighbors.getFirst([]).getPeerDescriptor();setImmediate(()=>this.resumeNeighbor(e,t,this.getLatestMessageTimestamp(t)))}})}getLatestMessageTimestamp(e){return this.latestMessages.has(e)&&0!==this.latestMessages.get(e).length?this.latestMessages.get(e)[this.latestMessages.get(e).length-1].messageId.timestamp:0}async sendBuffer(e,t,r){const n=new BT(this.localPeerDescriptor,r,this.rpcCommunicator,CT),i=this.latestMessages.get(t)?.filter(t=>t.messageId.timestamp>e)??[];await Promise.all(i.map(e=>n.sendStreamMessage(e)))}async onMetadata(e,t){this.getLatestMessageTimestamp(e.messageChainId)<e.timestamp&&(this.metadataTimestampsAheadOfRealData.has(e.messageChainId)||this.metadataTimestampsAheadOfRealData.set(e.messageChainId,new Set),this.metadataTimestampsAheadOfRealData.get(e.messageChainId).add(e.timestamp),this.metadataTimestampsAheadOfRealData.get(e.messageChainId).size>1&&(await this.resumeNeighbor(t,e.messageChainId,this.getLatestMessageTimestamp(e.messageChainId)),this.metadataTimestampsAheadOfRealData.get(e.messageChainId).forEach(t=>{this.metadataTimestampsAheadOfRealData.get(e.messageChainId).delete(t)})))}createRemote(e){return new wN(this.localPeerDescriptor,e,this.rpcCommunicator,DT)}broadcast(e,t){const r=e.messageId.messageChainId;this.latestMessages.has(r)||this.latestMessages.set(r,[]),this.latestMessages.get(r).length<20||this.latestMessages.get(r).shift(),this.latestMessages.get(r).push(e),this.metadataTimestampsAheadOfRealData.has(e.messageId.messageChainId)&&this.metadataTimestampsAheadOfRealData.get(e.messageId.messageChainId).delete(e.messageId.timestamp),this.emit("message",e);const n=this.neighbors.getAll().filter(e=>Dk(e.getPeerDescriptor())!==t);for(const t of n)if(this.localPausedNeighbors.isPaused(Dk(t.getPeerDescriptor()),e.messageId.messageChainId)){const r=this.createRemote(t.getPeerDescriptor());setImmediate(()=>r.sendMetadata(e.messageId))}else setImmediate(()=>t.sendStreamMessage(e))}isNeighborPaused(e,t){return this.localPausedNeighbors.isPaused(Dk(e),t)||this.remotePausedNeighbors.isPaused(Dk(e),t)}stop(){this.neighbors.off("nodeRemoved",this.onNeighborRemoved)}}const SN=new Ta("ProxyConnectionRpcRemote");class kN extends EP{async requestConnection(e,t){const r={direction:t,userId:bc(e)},n=this.formDhtRpcOptions({timeout:wP});try{return(await this.getClient().requestConnection(r,n)).accepted}catch(e){return SN.debug("ProxyConnectionRequest failed with error",{err:e}),!1}}}const RN=new Ta("ProxyClient"),PN="system/proxy-client";class IN extends zr{rpcCommunicator;contentDeliveryRpcLocal;options;duplicateDetectors=new Map;definition;connections=new Map;propagation;neighbors;abortController;constructor(e){super(),this.options=e,this.rpcCommunicator=new $P(yN(e.streamPartId),e.transport),this.neighbors=new sN(Dk(this.options.localPeerDescriptor),1e3),this.contentDeliveryRpcLocal=new ZT({localPeerDescriptor:this.options.localPeerDescriptor,streamPartId:this.options.streamPartId,markAndCheckDuplicate:(e,t)=>tN(this.duplicateDetectors,e,t),broadcast:(e,t)=>this.broadcast(e,t),onLeaveNotice:e=>{const t=this.neighbors.get(e);t&&setImmediate(()=>this.onNodeDisconnected(t.getPeerDescriptor()))},rpcCommunicator:this.rpcCommunicator,markForInspection:()=>{}}),this.propagation=new cN({minPropagationTargets:e.minPropagationTargets,maxMessages:e.maxPropagationBufferSize,ttl:e.propagationBufferTtl,sendToNeighbor:async(e,t)=>{const r=this.neighbors.get(e);if(!r)throw new Error("Propagation target not found");await r.sendStreamMessage(t)}}),this.abortController=new AbortController}registerDefaultServerMethods(){this.rpcCommunicator.registerRpcNotification(Y_,"sendStreamMessage",(e,t)=>this.contentDeliveryRpcLocal.sendStreamMessage(e,t)),this.rpcCommunicator.registerRpcNotification(aT,"leaveStreamPartNotice",(e,t)=>this.contentDeliveryRpcLocal.leaveStreamPartNotice(e,t))}async setProxies(e,t,r,n){if(RN.trace("Setting proxies",{streamPartId:this.options.streamPartId,peerDescriptors:e,direction:r,userId:t,connectionCount:n}),void 0!==n&&n>e.length)throw new Error("Cannot set connectionCount above the size of the configured array of nodes");const i=new Map;e.forEach(e=>{i.set(Dk(e),e)}),this.definition={nodes:i,userId:t,direction:r,connectionCount:n??e.length},await this.updateConnections()}async updateConnections(){await Promise.all(this.getInvalidConnections().map(async e=>{await this.closeConnection(e)}));const e=this.definition.connectionCount-this.connections.size;e>0?await this.openRandomConnections(e):e<0&&await this.closeRandomConnections(-e)}getInvalidConnections(){return Array.from(this.connections.keys()).filter(e=>!this.definition.nodes.has(e)||this.definition.direction!==this.connections.get(e).direction)}async openRandomConnections(e){const t=FC()(Array.from(this.definition.nodes.keys()).filter(e=>!this.connections.has(e)),e);await Promise.all(t.map(e=>this.attemptConnection(e,this.definition.userId,this.definition.direction)))}async attemptConnection(e,t,r){const n=this.definition.nodes.get(e),i=new kN(this.options.localPeerDescriptor,n,this.rpcCommunicator,_T);if(await i.requestConnection(t,r)){this.options.connectionLocker.lockConnection(n,PN),this.connections.set(e,{peerDescriptor:n,direction:r});const t=new BT(this.options.localPeerDescriptor,n,this.rpcCommunicator,CT);this.neighbors.add(t),this.propagation.onNeighborJoined(e),RN.info("Open proxy connection",{nodeId:e,streamPartId:this.options.streamPartId})}else RN.warn("Unable to open proxy connection",{nodeId:e,streamPartId:this.options.streamPartId})}async closeRandomConnections(e){const t=FC()(Array.from(this.connections.keys()),e);await Promise.allSettled(t.map(e=>this.closeConnection(e)))}async closeConnection(e){if(this.connections.has(e)){RN.info("Close proxy connection",{nodeId:e});const t=this.neighbors.get(e);t?.leaveStreamPartNotice(this.options.streamPartId,!1),this.removeConnection(this.connections.get(e).peerDescriptor)}}removeConnection(e){const t=Dk(e);this.connections.delete(t),this.neighbors.remove(t),this.options.connectionLocker.unlockConnection(e,PN)}broadcast(e,t){t||tN(this.duplicateDetectors,e.messageId,e.previousMessageRef),this.emit("message",e),this.propagation.feedUnseenMessage(e,this.neighbors.getIds(),t??null)}hasConnection(e,t){return this.connections.has(e)&&this.connections.get(e).direction===t}getDirection(){return this.definition.direction}async onNodeDisconnected(e){const t=Dk(e);this.connections.has(t)&&(this.options.connectionLocker.unlockConnection(e,PN),this.removeConnection(e),await(async(e,t,r,n=1e4)=>{for(;;){try{return await e()}catch{RN.warn(`Failed ${t} (retrying after delay)`,{delayInMs:n})}await Ga(n,r)}})(()=>this.updateConnections(),"updating proxy connections",this.abortController.signal))}async start(){this.registerDefaultServerMethods(),Xa(this.options.transport,"disconnected",e=>this.onNodeDisconnected(e),this.abortController.signal)}getDiagnosticInfo(){return{neighbors:this.neighbors.getAll().map(e=>e.getPeerDescriptor())}}stop(){this.neighbors.getAll().forEach(e=>{this.options.connectionLocker.unlockConnection(e.getPeerDescriptor(),PN),e.leaveStreamPartNotice(this.options.streamPartId,!1)}),this.neighbors.stop(),this.rpcCommunicator.destroy(),this.connections.clear(),this.abortController.abort()}}const CN=new Ta("ContentDeliveryManager"),_N=e=>{return xk((t=e,Buffer.from(Pe(ho(t)))));var t};class TN extends zr{transport;connectionLocker;controlLayerNode;metricsContext;metrics;options;streamParts;knownStreamPartEntryPoints=new Map;started=!1;destroyed=!1;constructor(e){super(),this.options=e,this.streamParts=new Map,this.metricsContext=e.metricsContext??new za,this.metrics={broadcastMessagesPerSecond:new ja,broadcastBytesPerSecond:new ja},this.metricsContext.addMetrics("node",this.metrics)}async start(e,t,r){this.started||this.destroyed||(this.started=!0,this.controlLayerNode=e,this.transport=t,this.connectionLocker=r)}async destroy(){this.started&&!this.destroyed&&(CN.trace("Destroying ContentDeliveryManager"),this.destroyed=!0,await Promise.all(Array.from(this.streamParts.values()).map(e=>e.stop())),this.streamParts.clear(),this.removeAllListeners(),this.controlLayerNode=void 0,this.transport=void 0,this.connectionLocker=void 0)}broadcast(e,t){const r=pc(e.messageId.streamId,e.messageId.streamPartition);CN.debug(`Broadcasting to stream part ${r}`),this.joinStreamPart(r,t),this.streamParts.get(r).broadcast(e),"contentMessage"===e.body.oneofKind&&(this.metrics.broadcastMessagesPerSecond.record(1),this.metrics.broadcastBytesPerSecond.record(e.body.contentMessage.content.length))}async leaveStreamPart(e){const t=this.streamParts.get(e);t&&(await t.stop(),this.streamParts.delete(e))}joinStreamPart(e,t){let r=this.streamParts.get(e);if(void 0!==r)return;CN.debug(`Join stream part ${e}`);const n=this.createDiscoveryLayerNode(e,this.knownStreamPartEntryPoints.get(e)??[]),i=new HC({key:_N(e),localPeerDescriptor:this.getPeerDescriptor(),fetchDataFromDht:e=>this.controlLayerNode.fetchDataFromDht(e),storeDataToDht:(e,t)=>this.controlLayerNode.storeDataToDht(e,t),deleteDataFromDht:async(e,t)=>this.controlLayerNode.deleteDataFromDht(e,t)}),s=new JC({discoveryLayerNode:n,discoverEntryPoints:async()=>i.fetchNodes()}),o=this.createContentDeliveryLayerNode(e,n,()=>i.isLocalNodeStored(),t),a=new ZC(n,i);r={proxied:!1,discoveryLayerNode:n,node:o,networkSplitAvoidance:s,broadcast:e=>o.broadcast(e),stop:async()=>{a.destroy(),s.destroy(),await i.destroy(),o.stop(),await n.stop()},getDiagnosticInfo:()=>o.getDiagnosticInfo()},this.streamParts.set(e,r),o.on("message",e=>{this.emit("newMessage",e)});const c=async()=>{this.destroyed||i.isLocalNodeStored()||this.knownStreamPartEntryPoints.has(e)||(await i.fetchNodes()).length<8&&await i.storeAndKeepLocalNode()};n.on("manualRejoinRequired",async()=>{a.isRunning()||s.isRunning()||(CN.debug("Manual rejoin required for stream part",{streamPartId:e}),await a.reconnect())}),o.on("entryPointLeaveDetected",()=>c()),setImmediate(async()=>{try{await this.startLayersAndJoinDht(e,i)}catch(t){CN.warn(`Failed to join to stream part ${e}`,{err:t})}})}async startLayersAndJoinDht(e,t){CN.debug(`Start layers and join DHT for stream part ${e}`);const r=this.streamParts.get(e);if(void 0===r||r.proxied)return;this.transport.isPrivateClientMode()&&await this.transport.disablePrivateClientMode(),await r.discoveryLayerNode.start(),await r.node.start();const n=this.knownStreamPartEntryPoints.get(e);if(void 0!==n)await Promise.all([r.discoveryLayerNode.joinDht(n),r.discoveryLayerNode.joinRing()]);else{const e=await t.fetchNodes();await Promise.all([r.discoveryLayerNode.joinDht(FC()(e,4)),r.discoveryLayerNode.joinRing()]),e.length<8&&(await t.storeAndKeepLocalNode(),r.discoveryLayerNode.getNeighborCount()<4&&setImmediate(()=>r.networkSplitAvoidance.avoidNetworkSplit()))}}createDiscoveryLayerNode(e,t){return new DC({transport:this.controlLayerNode,connectionsView:this.controlLayerNode.getConnectionsView(),serviceId:"layer1::"+e,peerDescriptor:this.controlLayerNode.getLocalPeerDescriptor(),entryPoints:t,numberOfNodesPerKBucket:4,rpcRequestTimeout:wP,dhtJoinTimeout:2e4,periodicallyPingNeighbors:!0,periodicallyPingRingContacts:!0,neighborPingLimit:16})}createContentDeliveryLayerNode(e,t,r,n){return i={streamPartId:e,transport:this.transport,discoveryLayerNode:t,connectionLocker:this.connectionLocker,localPeerDescriptor:this.controlLayerNode.getLocalPeerDescriptor(),minPropagationTargets:this.options.streamPartitionMinPropagationTargets,neighborTargetCount:this.options.streamPartitionNeighborTargetCount,maxPropagationBufferSize:this.options.streamPartitionMaxPropagationBufferSize,acceptProxyConnections:this.options.acceptProxyConnections,rpcRequestTimeout:this.options.rpcRequestTimeout,neighborUpdateInterval:this.options.neighborUpdateInterval,isLocalNodeEntryPoint:r,bufferWhileConnecting:this.options.bufferWhileConnecting,plumtreeOptimization:n?.plumtreeOptimization?.enabled,plumtreeMaxPausedNeighbors:!0===n?.plumtreeOptimization?.enabled?n?.plumtreeOptimization?.maxPausedNeighbors:void 0},new nN((e=>{const t=Dk(e.localPeerDescriptor),r=e.rpcCommunicator??new $P(yN(e.streamPartId),e.transport),n=e.neighborTargetCount??4,i=e.maxContactCount??20,s=e.acceptProxyConnections??!1,o=e.neighborUpdateInterval??1e4,a=e.minPropagationTargets??2,c=e.maxPropagationBufferSize??150,u=e.neighbors??new sN(t,i),l=e.leftNodeView??new sN(t,i),d=e.rightNodeView??new sN(t,i),h=e.nearbyNodeView??new sN(t,i),f=e.randomNodeView??new sN(t,i),p=new Set,g=new mN({rpcCommunicator:r,localPeerDescriptor:e.localPeerDescriptor,streamPartId:e.streamPartId,connectionLocker:e.connectionLocker}),m=s?new lN({localPeerDescriptor:e.localPeerDescriptor,streamPartId:e.streamPartId,rpcCommunicator:r}):void 0,y=e.plumtreeOptimization?new AN({neighbors:u,localPeerDescriptor:e.localPeerDescriptor,rpcCommunicator:r,maxPausedNeighbors:e.plumtreeMaxPausedNeighbors}):void 0,b=e.propagation??new cN({minPropagationTargets:a,maxMessages:c,ttl:1e4,sendToNeighbor:async(t,r)=>{const n=u.get(t)??g.getNodes().get(t),i=m?.getConnection(t);if(n)await n.sendStreamMessage(r,e.bufferWhileConnecting);else{if(!i)throw new Error("Propagation target not found");await i.remote.sendStreamMessage(r)}}}),w=e.handshaker??new qT({localPeerDescriptor:e.localPeerDescriptor,streamPartId:e.streamPartId,rpcCommunicator:r,neighbors:u,leftNodeView:l,rightNodeView:d,nearbyNodeView:h,randomNodeView:f,maxNeighborCount:n,rpcRequestTimeout:e.rpcRequestTimeout,ongoingHandshakes:p}),v=e.neighborFinder??new GT({neighbors:u,leftNodeView:l,rightNodeView:d,nearbyNodeView:h,randomNodeView:f,doFindNeighbors:e=>w.attemptHandshakesOnContacts(e),minCount:n}),E=e.neighborUpdateManager??new JT({neighbors:u,nearbyNodeView:h,localPeerDescriptor:e.localPeerDescriptor,neighborFinder:v,streamPartId:e.streamPartId,rpcCommunicator:r,neighborUpdateInterval:o,neighborTargetCount:n,ongoingHandshakes:p}),A=e.inspector??new gN({localPeerDescriptor:e.localPeerDescriptor,rpcCommunicator:r,streamPartId:e.streamPartId,connectionLocker:e.connectionLocker});return{...e,neighbors:u,leftNodeView:l,rightNodeView:d,nearbyNodeView:h,randomNodeView:f,rpcCommunicator:r,handshaker:w,neighborFinder:v,neighborUpdateManager:E,propagation:b,neighborTargetCount:n,nodeViewSize:i,proxyConnectionRpcLocal:m,inspector:A,temporaryConnectionRpcLocal:g,plumtreeManager:y}})(i));var i}async setProxies(e,t,r,n,i){if(this.options.acceptProxyConnections)throw new Error("cannot set proxies when acceptProxyConnections=true");if(t.length>0&&(void 0===i||i>0)){let s;this.isProxiedStreamPart(e)?s=this.streamParts.get(e).client:(s=this.createProxyClient(e),this.streamParts.set(e,{proxied:!0,client:s,broadcast:e=>s.broadcast(e),stop:async()=>s.stop(),getDiagnosticInfo:()=>s.getDiagnosticInfo()}),s.on("message",e=>{this.emit("newMessage",e)}),Array.from(this.streamParts.values()).every(e=>e.proxied)&&await this.transport.enablePrivateClientMode(),await s.start()),await s.setProxies(t,r,n,i)}else await(this.streamParts.get(e)?.stop()),this.streamParts.delete(e)}createProxyClient(e){return new IN({transport:this.transport,localPeerDescriptor:this.controlLayerNode.getLocalPeerDescriptor(),streamPartId:e,connectionLocker:this.connectionLocker,minPropagationTargets:this.options.streamPartitionMinPropagationTargets??2,maxPropagationBufferSize:this.options.streamPartitionMaxPropagationBufferSize??150,propagationBufferTtl:1e4})}async inspect(e,t){const r=this.streamParts.get(t);return void 0!==r&&!r.proxied&&r.node.inspect(e)}getNodeInfo(){return Array.from(this.streamParts.entries()).filter(([e,t])=>!1===t.proxied).map(([e])=>{const t=this.streamParts.get(e);return{id:e,controlLayerNeighbors:t.discoveryLayerNode.getNeighbors(),deprecatedContentDeliveryLayerNeighbors:[],contentDeliveryLayerNeighbors:t.node.getInfos()}})}setStreamPartEntryPoints(e,t){this.knownStreamPartEntryPoints.set(e,t)}isProxiedStreamPart(e,t){const r=this.streamParts.get(e);return void 0!==r&&r.proxied&&(void 0===t||r.client.getDirection()===t)}getStreamPartDelivery(e){return this.streamParts.get(e)}hasStreamPart(e){return this.streamParts.has(e)}getPeerDescriptor(){return this.controlLayerNode.getLocalPeerDescriptor()}getNodeId(){return Dk(this.controlLayerNode.getLocalPeerDescriptor())}getNeighbors(e){const t=this.streamParts.get(e);return!1===t?.proxied?t.node.getNeighbors().map(e=>Dk(e)):[]}getStreamParts(){return Array.from(this.streamParts.keys()).map(e=>gc.parse(e))}getDiagnosticInfo(){return{streamParts:this.getStreamParts().map(e=>({id:e,info:this.getStreamPartDelivery(e).getDiagnosticInfo()}))}}}class NN extends EP{async getInfo(){return this.getClient().getInfo({},this.formDhtRpcOptions())}}class xN{ownPeerDescriptor;rpcCommunicator;constructor(e,t){this.ownPeerDescriptor=e,this.rpcCommunicator=t}async getInfo(e){return new NN(this.ownPeerDescriptor,e,this.rpcCommunicator,OT).getInfo()}}class ON{stack;rpcCommunicator;constructor(e,t){this.stack=e,this.rpcCommunicator=t,this.registerDefaultServerMethods()}registerDefaultServerMethods(){this.rpcCommunicator.registerRpcMethod(yT,bT,"getInfo",()=>this.getInfo())}async getInfo(){return this.stack.createNodeInfo()}}const DN=new Ta("NetworkStack"),MN=[],BN=async()=>{const e=[...MN];await Promise.all(e.map(e=>e.stop()))};"object"==typeof process&&"function"==typeof process?.on&&["exit","SIGINT","SIGUSR1","SIGUSR2","uncaughtException","unhandledRejection","SIGTERM"].forEach(e=>{process.on(e,async t=>{const r="uncaughtException"===e||"unhandledRejection"===e;r&&DN.error(`exit event: ${e}`,t),await BN(),process.exit(r?1:0)})}),"object"==typeof window&&window.addEventListener("unload",async()=>{await BN()});class LN{controlLayerNode;contentDeliveryManager;stopped=!1;metricsContext;options;nodeInfoRpcLocal;nodeInfoClient;constructor(e){this.options=e,this.metricsContext=e.metricsContext??new za,this.controlLayerNode=new DC({...e.layer0,metricsContext:this.metricsContext,allowIncomingPrivateConnections:e.networkNode?.acceptProxyConnections}),this.contentDeliveryManager=new TN({...e.networkNode,metricsContext:this.metricsContext}),MN.push(this)}async joinStreamPart(e,t,r){if(this.getContentDeliveryManager().isProxiedStreamPart(e))throw new Error(`Cannot join to ${e} as proxy connections have been set`);await this.ensureConnectedToControlLayer(),this.getContentDeliveryManager().joinStreamPart(e,r),void 0!==t&&await Qa(()=>this.getContentDeliveryManager().getNeighbors(e).length>=t.minCount,t.timeout)}async broadcast(e,t){const r=pc(e.messageId.streamId,e.messageId.streamPartition);if(this.getContentDeliveryManager().isProxiedStreamPart(r,J_.SUBSCRIBE)&&"contentMessage"===e.body.oneofKind)throw new Error(`Cannot broadcast to ${r} as proxy subscribe connections have been set`);this.contentDeliveryManager.isProxiedStreamPart(r)||await this.ensureConnectedToControlLayer(),this.getContentDeliveryManager().broadcast(e,t)}async start(e=!0){DN.info("Starting a Streamr Network Node"),await this.controlLayerNode.start(),DN.info(`Node id is ${Dk(this.controlLayerNode.getLocalPeerDescriptor())}`);const t=this.controlLayerNode.getTransport();if(this.options.layer0?.entryPoints?.some(e=>Mk(e,this.controlLayerNode.getLocalPeerDescriptor()))?await(this.controlLayerNode?.joinDht(this.options.layer0.entryPoints)):e&&await this.ensureConnectedToControlLayer(),await(this.contentDeliveryManager?.start(this.controlLayerNode,t,t)),this.contentDeliveryManager){const e=new $P("system/node-info-rpc",this.getConnectionManager());this.nodeInfoRpcLocal=new ON(this,e),this.nodeInfoClient=new xN(this.controlLayerNode.getLocalPeerDescriptor(),e)}}async ensureConnectedToControlLayer(){this.controlLayerNode.hasJoined()||(setImmediate(async()=>{void 0!==this.options.layer0?.entryPoints&&await(this.controlLayerNode?.joinDht(this.options.layer0.entryPoints))}),await this.controlLayerNode.waitForNetworkConnectivity())}getContentDeliveryManager(){return this.contentDeliveryManager}getControlLayerNode(){return this.controlLayerNode}getMetricsContext(){return this.metricsContext}async fetchNodeInfo(e){return Mk(e,this.getControlLayerNode().getLocalPeerDescriptor())?this.createNodeInfo():this.nodeInfoClient.getInfo(e)}createNodeInfo(){return{peerDescriptor:this.getControlLayerNode().getLocalPeerDescriptor(),controlLayer:{connections:this.getControlLayerNode().getConnectionsView().getConnections(),neighbors:this.getControlLayerNode().getNeighbors()},streamPartitions:this.getContentDeliveryManager().getNodeInfo(),applicationVersion:"103.3.1"}}getOptions(){return this.options}getConnectionManager(){return this.controlLayerNode.getTransport()}async stop(){this.stopped||(this.stopped=!0,lk()(MN,this),await this.contentDeliveryManager.destroy(),await this.controlLayerNode.stop(),this.contentDeliveryManager=void 0,this.controlLayerNode=void 0)}}class FN{stack;stopped=!1;externalNetworkRpc;constructor(e){this.stack=e}async start(e){await this.stack.start(e),this.externalNetworkRpc=new GC(this.stack.getControlLayerNode().getTransport())}async inspect(e,t){return this.stack.getContentDeliveryManager().inspect(e,t)}async broadcast(e,t){await this.stack.broadcast(e,t)}async join(e,t,r){await this.stack.joinStreamPart(e,t,r)}async setProxies(e,t,r,n,i){await this.stack.getContentDeliveryManager().setProxies(e,t,r,n,i)}isProxiedStreamPart(e){return this.stack.getContentDeliveryManager().isProxiedStreamPart(e)}addMessageListener(e){this.stack.getContentDeliveryManager().on("newMessage",e)}setStreamPartEntryPoints(e,t){this.stack.getContentDeliveryManager().setStreamPartEntryPoints(e,t)}removeMessageListener(e){this.stack.getContentDeliveryManager().off("newMessage",e)}async leave(e){this.stopped||await this.stack.getContentDeliveryManager().leaveStreamPart(e)}getNeighbors(e){return this.stack.getContentDeliveryManager().getNeighbors(e)}hasStreamPart(e){return this.stack.getContentDeliveryManager().hasStreamPart(e)}async stop(){this.stopped=!0,this.externalNetworkRpc.destroy(),await this.stack.stop()}getPeerDescriptor(){return this.stack.getControlLayerNode().getLocalPeerDescriptor()}getMetricsContext(){return this.stack.getMetricsContext()}getNodeId(){return this.stack.getContentDeliveryManager().getNodeId()}getOptions(){return this.stack.getOptions()}getStreamParts(){return this.stack.getContentDeliveryManager().getStreamParts()}async fetchNodeInfo(e){return this.stack.fetchNodeInfo(e)}getDiagnosticInfo(){return{controlLayer:this.stack.getControlLayerNode().getDiagnosticInfo(),contentLayer:this.stack.getContentDeliveryManager().getDiagnosticInfo()}}registerExternalNetworkRpcMethod(e,t,r,n){this.externalNetworkRpc.registerRpcMethod(e,t,r,n)}createExternalRpcClient(e){return this.externalNetworkRpc.createRpcClient(e)}}var UN=r(7007),jN=r(7200),zN=r.n(jN),qN=r(8998),KN=r.n(qN),GN=r(5287),$N=r.n(GN),VN=r(4174),HN=r.n(VN),WN=r(3375),JN=r.n(WN),ZN=r(1684),QN=r.n(ZN);const YN=256,XN=3329,{mod:ex,nttZetas:tx,NTT:rx,bitsCoder:nx}=Yr({N:YN,Q:XN,F:3303,ROOT_OF_UNITY:17,newPoly:e=>new Uint16Array(e),brvBits:7,isKyber:!0}),ix=e=>nx(e,(e=>{if(e>=12)return{encode:e=>e,decode:e=>e};const t=2**(e-1);return{encode:t=>(1664.5+(t<<e))/XN,decode:r=>r*XN+t>>>e}})(e));function sx(e,t){for(let r=0;r<YN;r++)e[r]=ex(e[r]+t[r])}function ox(e,t,r,n,i){return{c0:ex(t*n*i+e*r),c1:ex(e*n+t*r)}}function ax(e,t){for(let r=0;r<128;r++){let n=tx[64+(r>>1)];1&r&&(n=-n);const{c0:i,c1:s}=ox(e[2*r+0],e[2*r+1],t[2*r+0],t[2*r+1],n);e[2*r+0]=i,e[2*r+1]=s}return e}function cx(e){const t=new Uint16Array(YN);for(let r=0;r<YN;){const n=e();if(n.length%3)throw new Error("SampleNTT: unaligned block");for(let e=0;r<YN&&e+3<=n.length;e+=3){const i=4095&(n[e+0]|n[e+1]<<8),s=4095&(n[e+1]>>4|n[e+2]<<4);i<XN&&(t[r++]=i),r<YN&&s<XN&&(t[r++]=s)}}return t}function ux(e,t,r,n){const i=e(n*YN/4,t,r),s=new Uint16Array(YN),o=Ge(i);let a=0;for(let e=0,t=0,r=0,i=0;e<o.length;e++){let c=o[e];for(let e=0;e<32;e++)r+=1&c,c>>=1,a+=1,a===n?(i=r,r=0):a===2*n&&(s[t++]=ex(i-r),r=0,a=0)}if(a)throw new Error(`sampleCBD: leftover bits: ${a}`);return s}function lx(e){const t=(e=>{const{K:t,PRF:r,XOF:n,HASH512:i,ETA1:s,ETA2:o,du:a,dv:c}=e,u=ix(1),l=ix(c),d=ix(a),h=Sr(kr(ix(12),t),32),f=kr(ix(12),t),p=Sr(kr(d,t),l),g=Sr(32,32);return{secretCoder:f,secretKeyLen:f.bytesLen,publicKeyLen:h.bytesLen,cipherTextLen:p.bytesLen,keygen:e=>{vr(e,32);const o=new Uint8Array(33);o.set(e),o[32]=t;const a=i(o),[c,u]=g.decode(a),l=[],d=[];for(let e=0;e<t;e++)l.push(rx.encode(ux(r,u,e,s)));const p=n(c);for(let e=0;e<t;e++){const n=rx.encode(ux(r,u,t+e,s));for(let r=0;r<t;r++)sx(n,ax(cx(p.get(r,e)),l[r]));d.push(n)}p.clean();const m={publicKey:h.encode([d,c]),secretKey:f.encode(l)};return Rr(c,u,l,d,o,a),m},encrypt:(e,i,a)=>{const[c,l]=h.decode(e),d=[];for(let e=0;e<t;e++)d.push(rx.encode(ux(r,a,e,s)));const f=n(l),g=new Uint16Array(YN),m=[];for(let e=0;e<t;e++){const n=ux(r,a,t+e,o),i=new Uint16Array(YN);for(let r=0;r<t;r++)sx(i,ax(cx(f.get(e,r)),d[r]));sx(n,rx.decode(i)),m.push(n),sx(g,ax(c[e],d[e])),i.fill(0)}f.clean();const y=ux(r,a,2*t,o);sx(y,rx.decode(g));const b=u.decode(i);return sx(b,y),Rr(c,d,g,y),p.encode([m,b])},decrypt:(e,r)=>{const[n,i]=p.decode(e),s=f.decode(r),o=new Uint16Array(YN);for(let e=0;e<t;e++)sx(o,ax(s[e],rx.encode(n[e])));return function(e,t){for(let r=0;r<YN;r++)e[r]=ex(e[r]-t[r])}(i,rx.decode(o)),Rr(o,s,n),u.encode(i)}}})(e),{HASH256:r,HASH512:n,KDF:i}=e,{secretCoder:s,cipherTextLen:o}=t,a=t.publicKeyLen,c=Sr(t.secretKeyLen,t.publicKeyLen,32,32),u=c.bytesLen;return{publicKeyLen:a,msgLen:32,keygen:(e=Er(64))=>{vr(e,64);const{publicKey:n,secretKey:i}=t.keygen(e.subarray(0,32)),s=r(n),o=c.encode([i,n,s,e.subarray(32)]);return Rr(i,s),{publicKey:n,secretKey:o}},encapsulate:(i,o=Er(32))=>{vr(i,a),vr(o,32);const c=i.subarray(0,384*e.K),u=s.encode(s.decode(c.slice()));if(!Ar(u,c))throw Rr(u),new Error("ML-KEM.encapsulate: wrong publicKey modulus");Rr(u);const l=n.create().update(o).update(r(i)).digest(),d=t.encrypt(i,o,l.subarray(32,64));return l.subarray(32).fill(0),{cipherText:d,sharedSecret:l.subarray(0,32)}},decapsulate:(e,r)=>{vr(r,u),vr(e,o);const[s,a,l,d]=c.decode(r),h=t.decrypt(e,s),f=n.create().update(h).update(l).digest(),p=f.subarray(0,32),g=t.encrypt(a,h,f.subarray(32,64)),m=Ar(e,g),y=i.create({dkLen:32}).update(d).update(e).digest();return Rr(h,g,m?y:p),m?p:y}}}const dx=lx({...{HASH256:pr,HASH512:mr,KDF:wr,XOF:en,PRF:function(e,t,r){return wr.create({dkLen:e}).update(t).update(new Uint8Array([r])).digest()}},...{N:YN,Q:XN,K:4,ETA1:2,ETA2:2,du:11,dv:5,RBGstrength:256}}),hx=(e,t)=>t.some(t=>e instanceof t);let fx,px;const gx=new WeakMap,mx=new WeakMap,yx=new WeakMap;let bx={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return gx.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Ex(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function wx(e){bx=e(bx)}function vx(e){return"function"==typeof e?(t=e,(px||(px=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Ax(this),e),Ex(this.request)}:function(...e){return Ex(t.apply(Ax(this),e))}):(e instanceof IDBTransaction&&function(e){if(gx.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});gx.set(e,t)}(e),hx(e,fx||(fx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,bx):e);var t}function Ex(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Ex(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return yx.set(t,e),t}(e);if(mx.has(e))return mx.get(e);const t=vx(e);return t!==e&&(mx.set(e,t),yx.set(t,e)),t}const Ax=e=>yx.get(e),Sx=["get","getKey","getAll","getAllKeys","count"],kx=["put","add","delete","clear"],Rx=new Map;function Px(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Rx.get(t))return Rx.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=kx.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!Sx.includes(r))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[r](...t),i&&s.done]))[0]};return Rx.set(t,s),s}wx(e=>({...e,get:(t,r,n)=>Px(t,r)||e.get(t,r,n),has:(t,r)=>!!Px(t,r)||e.has(t,r)}));const Ix=["continue","continuePrimaryKey","advance"],Cx={},_x=new WeakMap,Tx=new WeakMap,Nx={get(e,t){if(!Ix.includes(t))return e[t];let r=Cx[t];return r||(r=Cx[t]=function(...e){_x.set(this,Tx.get(this)[t](...e))}),r}};async function*xx(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const r=new Proxy(t,Nx);for(Tx.set(r,t),yx.set(r,Ax(t));t;)yield r,t=await(_x.get(r)||t.continue()),_x.delete(r)}function Ox(e,t){return t===Symbol.asyncIterator&&hx(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&hx(e,[IDBIndex,IDBObjectStore])}wx(e=>({...e,get:(t,r,n)=>Ox(t,r)?xx:e.get(t,r,n),has:(t,r)=>Ox(t,r)||e.has(t,r)}));var Dx=r(179),Mx=r.n(Dx),Bx=r(9456),Lx=r(3686),Fx=r(5364),Ux=r.n(Fx),jx=r(5015),zx=r.n(jx),qx=r(8055),Kx=r.n(qx),Gx=r(8023),$x=r.n(Gx),Vx=r(3181),Hx=r.n(Vx);function Wx(e,t,r){function n(r,n){if(r._zod||Object.defineProperty(r,"_zod",{value:{def:n,constr:o,traits:new Set},enumerable:!1}),r._zod.traits.has(e))return;r._zod.traits.add(e),t(r,n);const i=o.prototype,s=Object.keys(i);for(let e=0;e<s.length;e++){const t=s[e];t in r||(r[t]=i[t].bind(r))}}const i=r?.Parent??Object;class s extends i{}function o(e){var t;const i=r?.Parent?new s:this;n(i,e),(t=i._zod).deferred??(t.deferred=[]);for(const e of i._zod.deferred)e();return i}return Object.defineProperty(s,"name",{value:e}),Object.defineProperty(o,"init",{value:n}),Object.defineProperty(o,Symbol.hasInstance,{value:t=>!!(r?.Parent&&t instanceof r.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(o,"name",{value:e}),o}Object.freeze({status:"aborted"}),Symbol("zod_brand");class Jx extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Zx extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const Qx={};function Yx(e){return e&&Object.assign(Qx,e),Qx}function Xx(e){const t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function eO(e,t="|"){return e.map(e=>vO(e)).join(t)}function tO(e,t){return"bigint"==typeof t?t.toString():t}function rO(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function nO(e){return null==e}function iO(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}const sO=Symbol("evaluating");function oO(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==sO)return void 0===n&&(n=sO,n=r()),n},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function aO(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function cO(...e){const t={};for(const r of e){const e=Object.getOwnPropertyDescriptors(r);Object.assign(t,e)}return Object.defineProperties({},t)}function uO(e){return JSON.stringify(e)}const lO="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function dO(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}const hO=rO(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(e){return!1}});function fO(e){if(!1===dO(e))return!1;const t=e.constructor;if(void 0===t)return!0;if("function"!=typeof t)return!0;const r=t.prototype;return!1!==dO(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}function pO(e){return fO(e)?{...e}:Array.isArray(e)?[...e]:e}const gO=new Set(["string","number","symbol"]),mO=new Set(["string","number","bigint","boolean","symbol","undefined"]);function yO(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function bO(e,t,r){const n=new e._zod.constr(t??e._zod.def);return t&&!r?.parent||(n._zod.parent=e),n}function wO(e){const t=e;if(!t)return{};if("string"==typeof t)return{error:()=>t};if(void 0!==t?.message){if(void 0!==t?.error)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,"string"==typeof t.error?{...t,error:()=>t.error}:t}function vO(e){return"bigint"==typeof e?e.toString()+"n":"string"==typeof e?`"${e}"`:`${e}`}const EO={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},AO={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function SO(e,t=0){if(!0===e.aborted)return!0;for(let r=t;r<e.issues.length;r++)if(!0!==e.issues[r]?.continue)return!0;return!1}function kO(e,t){return t.map(t=>{var r;return(r=t).path??(r.path=[]),t.path.unshift(e),t})}function RO(e){return"string"==typeof e?e:e?.message}function PO(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const i=RO(e.inst?._zod.def?.error?.(e))??RO(t?.error?.(e))??RO(r.customError?.(e))??RO(r.localeError?.(e))??"Invalid input";n.message=i}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function IO(e){return e instanceof Set?"set":e instanceof Map?"map":e instanceof File?"file":"unknown"}function CO(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function _O(...e){const[t,r,n]=e;return"string"==typeof t?{message:t,code:"custom",input:r,inst:n}:{...t}}const TO=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,tO,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},NO=Wx("$ZodError",TO),xO=Wx("$ZodError",TO,{Parent:Error}),OO=e=>(t,r,n,i)=>{const s=n?Object.assign(n,{async:!1}):{async:!1},o=t._zod.run({value:r,issues:[]},s);if(o instanceof Promise)throw new Jx;if(o.issues.length){const t=new(i?.Err??e)(o.issues.map(e=>PO(e,s,Yx())));throw lO(t,i?.callee),t}return o.value},DO=OO(xO),MO=e=>async(t,r,n,i)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},s);if(o instanceof Promise&&(o=await o),o.issues.length){const t=new(i?.Err??e)(o.issues.map(e=>PO(e,s,Yx())));throw lO(t,i?.callee),t}return o.value},BO=MO(xO),LO=e=>(t,r,n)=>{const i=n?{...n,async:!1}:{async:!1},s=t._zod.run({value:r,issues:[]},i);if(s instanceof Promise)throw new Jx;return s.issues.length?{success:!1,error:new(e??NO)(s.issues.map(e=>PO(e,i,Yx())))}:{success:!0,data:s.value}},FO=LO(xO),UO=e=>async(t,r,n)=>{const i=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:r,issues:[]},i);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(e=>PO(e,i,Yx())))}:{success:!0,data:s.value}},jO=UO(xO),zO=e=>(t,r,n)=>{const i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return OO(e)(t,r,i)},qO=e=>(t,r,n)=>OO(e)(t,r,n),KO=e=>async(t,r,n)=>{const i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return MO(e)(t,r,i)},GO=e=>async(t,r,n)=>MO(e)(t,r,n),$O=e=>(t,r,n)=>{const i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return LO(e)(t,r,i)},VO=e=>(t,r,n)=>LO(e)(t,r,n),HO=e=>async(t,r,n)=>{const i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return UO(e)(t,r,i)},WO=e=>async(t,r,n)=>UO(e)(t,r,n),JO=/^[cC][^\s-]{8,}$/,ZO=/^[0-9a-z]+$/,QO=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,YO=/^[0-9a-vA-V]{20}$/,XO=/^[A-Za-z0-9]{27}$/,eD=/^[a-zA-Z0-9_-]{21}$/,tD=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,rD=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,nD=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,iD=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,sD=iD(4),oD=iD(6),aD=iD(7),cD=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,uD=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,lD=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,dD=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,hD=dD,fD=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,pD="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function gD(){return new RegExp(pD,"u")}const mD=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,yD=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,bD=e=>{const t=yO(e??":");return new RegExp(`^(?:[0-9A-F]{2}${t}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${t}){5}[0-9a-f]{2}$`)},wD=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,vD=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ED=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,AD=/^[A-Za-z0-9_-]*$/,SD=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,kD=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,RD=/^\+[1-9]\d{6,14}$/,PD="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",ID=new RegExp(`^${PD}$`);function CD(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function _D(e){return new RegExp(`^${CD(e)}$`)}function TD(e){const t=CD({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${PD}T(?:${n})$`)}const ND=e=>new RegExp(`^${e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*"}$`),xD=/^-?\d+n?$/,OD=/^-?\d+$/,DD=/^-?\d+(?:\.\d+)?$/,MD=/^(?:true|false)$/i,BD=/^null$/i,LD=/^undefined$/i,FD=/^[^A-Z]*$/,UD=/^[^a-z]*$/,jD=/^[0-9a-fA-F]*$/;function zD(e,t){return new RegExp(`^[A-Za-z0-9+/]{${e}}${t}$`)}function qD(e){return new RegExp(`^[A-Za-z0-9_-]{${e}}$`)}const KD=/^[0-9a-fA-F]{32}$/,GD=zD(22,"=="),$D=qD(22),VD=/^[0-9a-fA-F]{40}$/,HD=zD(27,"="),WD=qD(27),JD=/^[0-9a-fA-F]{64}$/,ZD=zD(43,"="),QD=qD(43),YD=/^[0-9a-fA-F]{96}$/,XD=zD(64,""),eM=qD(64),tM=/^[0-9a-fA-F]{128}$/,rM=zD(86,"=="),nM=qD(86),iM=Wx("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),sM={number:"number",bigint:"bigint",object:"date"},oM=Wx("$ZodCheckLessThan",(e,t)=>{iM.init(e,t);const r=sM[typeof t.value];e._zod.onattach.push(e=>{const r=e._zod.bag,n=(t.inclusive?r.maximum:r.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<n&&(t.inclusive?r.maximum=t.value:r.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:"object"==typeof t.value?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),aM=Wx("$ZodCheckGreaterThan",(e,t)=>{iM.init(e,t);const r=sM[typeof t.value];e._zod.onattach.push(e=>{const r=e._zod.bag,n=(t.inclusive?r.minimum:r.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>n&&(t.inclusive?r.minimum=t.value:r.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:"object"==typeof t.value?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),cM=Wx("$ZodCheckMultipleOf",(e,t)=>{iM.init(e,t),e._zod.onattach.push(e=>{var r;(r=e._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof r.value?r.value%t.value===BigInt(0):0===function(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let i=(n.split(".")[1]||"").length;if(0===i&&/\d?e-\d?/.test(n)){const e=n.match(/\d?e-(\d?)/);e?.[1]&&(i=Number.parseInt(e[1]))}const s=r>i?r:i;return Number.parseInt(e.toFixed(s).replace(".",""))%Number.parseInt(t.toFixed(s).replace(".",""))/10**s}(r.value,t.value))||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),uM=Wx("$ZodCheckNumberFormat",(e,t)=>{iM.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[i,s]=EO[t.format];e._zod.onattach.push(e=>{const n=e._zod.bag;n.format=t.format,n.minimum=i,n.maximum=s,r&&(n.pattern=OD)}),e._zod.check=o=>{const a=o.value;if(r){if(!Number.isInteger(a))return void o.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});if(!Number.isSafeInteger(a))return void(a>0?o.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort}):o.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort}))}a<i&&o.issues.push({origin:"number",input:a,code:"too_small",minimum:i,inclusive:!0,inst:e,continue:!t.abort}),a>s&&o.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inclusive:!0,inst:e,continue:!t.abort})}}),lM=Wx("$ZodCheckBigIntFormat",(e,t)=>{iM.init(e,t);const[r,n]=AO[t.format];e._zod.onattach.push(e=>{const i=e._zod.bag;i.format=t.format,i.minimum=r,i.maximum=n}),e._zod.check=i=>{const s=i.value;s<r&&i.issues.push({origin:"bigint",input:s,code:"too_small",minimum:r,inclusive:!0,inst:e,continue:!t.abort}),s>n&&i.issues.push({origin:"bigint",input:s,code:"too_big",maximum:n,inclusive:!0,inst:e,continue:!t.abort})}}),dM=Wx("$ZodCheckMaxSize",(e,t)=>{var r;iM.init(e,t),(r=e._zod.def).when??(r.when=e=>{const t=e.value;return!nO(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{const r=e._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const n=r.value;n.size<=t.maximum||r.issues.push({origin:IO(n),code:"too_big",maximum:t.maximum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),hM=Wx("$ZodCheckMinSize",(e,t)=>{var r;iM.init(e,t),(r=e._zod.def).when??(r.when=e=>{const t=e.value;return!nO(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{const r=e._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const n=r.value;n.size>=t.minimum||r.issues.push({origin:IO(n),code:"too_small",minimum:t.minimum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),fM=Wx("$ZodCheckSizeEquals",(e,t)=>{var r;iM.init(e,t),(r=e._zod.def).when??(r.when=e=>{const t=e.value;return!nO(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{const r=e._zod.bag;r.minimum=t.size,r.maximum=t.size,r.size=t.size}),e._zod.check=r=>{const n=r.value,i=n.size;if(i===t.size)return;const s=i>t.size;r.issues.push({origin:IO(n),...s?{code:"too_big",maximum:t.size}:{code:"too_small",minimum:t.size},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),pM=Wx("$ZodCheckMaxLength",(e,t)=>{var r;iM.init(e,t),(r=e._zod.def).when??(r.when=e=>{const t=e.value;return!nO(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const r=e._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const n=r.value;if(n.length<=t.maximum)return;const i=CO(n);r.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),gM=Wx("$ZodCheckMinLength",(e,t)=>{var r;iM.init(e,t),(r=e._zod.def).when??(r.when=e=>{const t=e.value;return!nO(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const r=e._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const n=r.value;if(n.length>=t.minimum)return;const i=CO(n);r.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),mM=Wx("$ZodCheckLengthEquals",(e,t)=>{var r;iM.init(e,t),(r=e._zod.def).when??(r.when=e=>{const t=e.value;return!nO(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const r=e._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=r=>{const n=r.value,i=n.length;if(i===t.length)return;const s=CO(n),o=i>t.length;r.issues.push({origin:s,...o?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),yM=Wx("$ZodCheckStringFormat",(e,t)=>{var r,n;iM.init(e,t),e._zod.onattach.push(e=>{const r=e._zod.bag;r.format=t.format,t.pattern&&(r.patterns??(r.patterns=new Set),r.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),bM=Wx("$ZodCheckRegex",(e,t)=>{yM.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),wM=Wx("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=FD),yM.init(e,t)}),vM=Wx("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=UD),yM.init(e,t)}),EM=Wx("$ZodCheckIncludes",(e,t)=>{iM.init(e,t);const r=yO(t.includes),n=new RegExp("number"==typeof t.position?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(n)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),AM=Wx("$ZodCheckStartsWith",(e,t)=>{iM.init(e,t);const r=new RegExp(`^${yO(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),SM=Wx("$ZodCheckEndsWith",(e,t)=>{iM.init(e,t);const r=new RegExp(`.*${yO(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}});function kM(e,t,r){e.issues.length&&t.issues.push(...kO(r,e.issues))}const RM=Wx("$ZodCheckProperty",(e,t)=>{iM.init(e,t),e._zod.check=e=>{const r=t.schema._zod.run({value:e.value[t.property],issues:[]},{});if(r instanceof Promise)return r.then(r=>kM(r,e,t.property));kM(r,e,t.property)}}),PM=Wx("$ZodCheckMimeType",(e,t)=>{iM.init(e,t);const r=new Set(t.mime);e._zod.onattach.push(e=>{e._zod.bag.mime=t.mime}),e._zod.check=n=>{r.has(n.value.type)||n.issues.push({code:"invalid_value",values:t.mime,input:n.value.type,inst:e,continue:!t.abort})}}),IM=Wx("$ZodCheckOverwrite",(e,t)=>{iM.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});class CM{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e)return e(this,{execution:"sync"}),void e(this,{execution:"async"});const t=e.split("\n").filter(e=>e),r=Math.min(...t.map(e=>e.length-e.trimStart().length)),n=t.map(e=>e.slice(r)).map(e=>" ".repeat(2*this.indent)+e);for(const e of n)this.content.push(e)}compile(){const e=Function,t=this?.args,r=[...(this?.content??[""]).map(e=>`  ${e}`)];return new e(...t,r.join("\n"))}}const _M={major:4,minor:3,patch:6},TM=Wx("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=_M;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const t of n)for(const r of t._zod.onattach)r(e);if(0===n.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const t=(e,t,r)=>{let n,i=SO(e);for(const s of t){if(s._zod.def.when){if(!s._zod.def.when(e))continue}else if(i)continue;const t=e.issues.length,o=s._zod.check(e);if(o instanceof Promise&&!1===r?.async)throw new Jx;if(n||o instanceof Promise)n=(n??Promise.resolve()).then(async()=>{await o,e.issues.length!==t&&(i||(i=SO(e,t)))});else{if(e.issues.length===t)continue;i||(i=SO(e,t))}}return n?n.then(()=>e):e},r=(r,i,s)=>{if(SO(r))return r.aborted=!0,r;const o=t(i,n,s);if(o instanceof Promise){if(!1===s.async)throw new Jx;return o.then(t=>e._zod.parse(t,s))}return e._zod.parse(o,s)};e._zod.run=(i,s)=>{if(s.skipChecks)return e._zod.parse(i,s);if("backward"===s.direction){const t=e._zod.parse({value:i.value,issues:[]},{...s,skipChecks:!0});return t instanceof Promise?t.then(e=>r(e,i,s)):r(t,i,s)}const o=e._zod.parse(i,s);if(o instanceof Promise){if(!1===s.async)throw new Jx;return o.then(e=>t(e,n,s))}return t(o,n,s)}}oO(e,"~standard",()=>({validate:t=>{try{const r=FO(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return jO(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}))}),NM=Wx("$ZodString",(e,t)=>{TM.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??ND(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch(n){}return"string"==typeof r.value||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),xM=Wx("$ZodStringFormat",(e,t)=>{yM.init(e,t),NM.init(e,t)}),OM=Wx("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=nD),xM.init(e,t)}),DM=Wx("$ZodUUID",(e,t)=>{if(t.version){const e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=iD(e))}else t.pattern??(t.pattern=iD());xM.init(e,t)}),MM=Wx("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=cD),xM.init(e,t)}),BM=Wx("$ZodURL",(e,t)=>{xM.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),i=new URL(n);return t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),void(t.normalize?r.value=i.href:r.value=n)}catch(n){r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),LM=Wx("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=gD()),xM.init(e,t)}),FM=Wx("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=eD),xM.init(e,t)}),UM=Wx("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=JO),xM.init(e,t)}),jM=Wx("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=ZO),xM.init(e,t)}),zM=Wx("$ZodULID",(e,t)=>{t.pattern??(t.pattern=QO),xM.init(e,t)}),qM=Wx("$ZodXID",(e,t)=>{t.pattern??(t.pattern=YO),xM.init(e,t)}),KM=Wx("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=XO),xM.init(e,t)}),GM=Wx("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=TD(t)),xM.init(e,t)}),$M=Wx("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=ID),xM.init(e,t)}),VM=Wx("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=_D(t)),xM.init(e,t)}),HM=Wx("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=tD),xM.init(e,t)}),WM=Wx("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=mD),xM.init(e,t),e._zod.bag.format="ipv4"}),JM=Wx("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=yD),xM.init(e,t),e._zod.bag.format="ipv6",e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),ZM=Wx("$ZodMAC",(e,t)=>{t.pattern??(t.pattern=bD(t.delimiter)),xM.init(e,t),e._zod.bag.format="mac"}),QM=Wx("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=wD),xM.init(e,t)}),YM=Wx("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=vD),xM.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(2!==n.length)throw new Error;const[e,t]=n;if(!t)throw new Error;const r=Number(t);if(`${r}`!==t)throw new Error;if(r<0||r>128)throw new Error;new URL(`http://[${e}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function XM(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}const eB=Wx("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=ED),xM.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=r=>{XM(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}}),tB=Wx("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=AD),xM.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=r=>{(function(e){if(!AD.test(e))return!1;const t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return XM(t.padEnd(4*Math.ceil(t.length/4),"="))})(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),rB=Wx("$ZodE164",(e,t)=>{t.pattern??(t.pattern=RD),xM.init(e,t)}),nB=Wx("$ZodJWT",(e,t)=>{xM.init(e,t),e._zod.check=r=>{(function(e,t=null){try{const r=e.split(".");if(3!==r.length)return!1;const[n]=r;if(!n)return!1;const i=JSON.parse(atob(n));return!("typ"in i&&"JWT"!==i?.typ||!i.alg||t&&(!("alg"in i)||i.alg!==t))}catch{return!1}})(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),iB=Wx("$ZodCustomStringFormat",(e,t)=>{xM.init(e,t),e._zod.check=r=>{t.fn(r.value)||r.issues.push({code:"invalid_format",format:t.format,input:r.value,inst:e,continue:!t.abort})}}),sB=Wx("$ZodNumber",(e,t)=>{TM.init(e,t),e._zod.pattern=e._zod.bag.pattern??DD,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch(e){}const i=r.value;if("number"==typeof i&&!Number.isNaN(i)&&Number.isFinite(i))return r;const s="number"==typeof i?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:i,inst:e,...s?{received:s}:{}}),r}}),oB=Wx("$ZodNumberFormat",(e,t)=>{uM.init(e,t),sB.init(e,t)}),aB=Wx("$ZodBoolean",(e,t)=>{TM.init(e,t),e._zod.pattern=MD,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Boolean(r.value)}catch(e){}const i=r.value;return"boolean"==typeof i||r.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:e}),r}}),cB=Wx("$ZodBigInt",(e,t)=>{TM.init(e,t),e._zod.pattern=xD,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=BigInt(r.value)}catch(e){}return"bigint"==typeof r.value||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:e}),r}}),uB=Wx("$ZodBigIntFormat",(e,t)=>{lM.init(e,t),cB.init(e,t)}),lB=Wx("$ZodSymbol",(e,t)=>{TM.init(e,t),e._zod.parse=(t,r)=>{const n=t.value;return"symbol"==typeof n||t.issues.push({expected:"symbol",code:"invalid_type",input:n,inst:e}),t}}),dB=Wx("$ZodUndefined",(e,t)=>{TM.init(e,t),e._zod.pattern=LD,e._zod.values=new Set([void 0]),e._zod.optin="optional",e._zod.optout="optional",e._zod.parse=(t,r)=>{const n=t.value;return void 0===n||t.issues.push({expected:"undefined",code:"invalid_type",input:n,inst:e}),t}}),hB=Wx("$ZodNull",(e,t)=>{TM.init(e,t),e._zod.pattern=BD,e._zod.values=new Set([null]),e._zod.parse=(t,r)=>{const n=t.value;return null===n||t.issues.push({expected:"null",code:"invalid_type",input:n,inst:e}),t}}),fB=Wx("$ZodAny",(e,t)=>{TM.init(e,t),e._zod.parse=e=>e}),pB=Wx("$ZodUnknown",(e,t)=>{TM.init(e,t),e._zod.parse=e=>e}),gB=Wx("$ZodNever",(e,t)=>{TM.init(e,t),e._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)}),mB=Wx("$ZodVoid",(e,t)=>{TM.init(e,t),e._zod.parse=(t,r)=>{const n=t.value;return void 0===n||t.issues.push({expected:"void",code:"invalid_type",input:n,inst:e}),t}}),yB=Wx("$ZodDate",(e,t)=>{TM.init(e,t),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=new Date(r.value)}catch(e){}const i=r.value,s=i instanceof Date;return s&&!Number.isNaN(i.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:i,...s?{received:"Invalid Date"}:{},inst:e}),r}});function bB(e,t,r){e.issues.length&&t.issues.push(...kO(r,e.issues)),t.value[r]=e.value}const wB=Wx("$ZodArray",(e,t)=>{TM.init(e,t),e._zod.parse=(r,n)=>{const i=r.value;if(!Array.isArray(i))return r.issues.push({expected:"array",code:"invalid_type",input:i,inst:e}),r;r.value=Array(i.length);const s=[];for(let e=0;e<i.length;e++){const o=i[e],a=t.element._zod.run({value:o,issues:[]},n);a instanceof Promise?s.push(a.then(t=>bB(t,r,e))):bB(a,r,e)}return s.length?Promise.all(s).then(()=>r):r}});function vB(e,t,r,n,i){if(e.issues.length){if(i&&!(r in n))return;t.issues.push(...kO(r,e.issues))}void 0===e.value?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function EB(e){const t=Object.keys(e.shape);for(const r of t)if(!e.shape?.[r]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const r=(n=e.shape,Object.keys(n).filter(e=>"optional"===n[e]._zod.optin&&"optional"===n[e]._zod.optout));var n;return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function AB(e,t,r,n,i,s){const o=[],a=i.keySet,c=i.catchall._zod,u=c.def.type,l="optional"===c.optout;for(const i in t){if(a.has(i))continue;if("never"===u){o.push(i);continue}const s=c.run({value:t[i],issues:[]},n);s instanceof Promise?e.push(s.then(e=>vB(e,r,i,t,l))):vB(s,r,i,t,l)}return o.length&&r.issues.push({code:"unrecognized_keys",keys:o,input:t,inst:s}),e.length?Promise.all(e).then(()=>r):r}const SB=Wx("$ZodObject",(e,t)=>{TM.init(e,t);const r=Object.getOwnPropertyDescriptor(t,"shape");if(!r?.get){const e=t.shape;Object.defineProperty(t,"shape",{get:()=>{const r={...e};return Object.defineProperty(t,"shape",{value:r}),r}})}const n=rO(()=>EB(t));oO(e._zod,"propValues",()=>{const e=t.shape,r={};for(const t in e){const n=e[t]._zod;if(n.values){r[t]??(r[t]=new Set);for(const e of n.values)r[t].add(e)}}return r});const i=dO,s=t.catchall;let o;e._zod.parse=(t,r)=>{o??(o=n.value);const a=t.value;if(!i(a))return t.issues.push({expected:"object",code:"invalid_type",input:a,inst:e}),t;t.value={};const c=[],u=o.shape;for(const e of o.keys){const n=u[e],i="optional"===n._zod.optout,s=n._zod.run({value:a[e],issues:[]},r);s instanceof Promise?c.push(s.then(r=>vB(r,t,e,a,i))):vB(s,t,e,a,i)}return s?AB(c,a,t,r,n.value,e):c.length?Promise.all(c).then(()=>t):t}}),kB=Wx("$ZodObjectJIT",(e,t)=>{SB.init(e,t);const r=e._zod.parse,n=rO(()=>EB(t));let i;const s=dO,o=!Qx.jitless,a=o&&hO.value,c=t.catchall;let u;e._zod.parse=(l,d)=>{u??(u=n.value);const h=l.value;return s(h)?o&&a&&!1===d?.async&&!0!==d.jitless?(i||(i=(e=>{const t=new CM(["shape","payload","ctx"]),r=n.value,i=e=>{const t=uO(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");const s=Object.create(null);let o=0;for(const e of r.keys)s[e]="key_"+o++;t.write("const newResult = {};");for(const n of r.keys){const r=s[n],o=uO(n),a=e[n],c="optional"===a?._zod?.optout;t.write(`const ${r} = ${i(n)};`),c?t.write(`\n        if (${r}.issues.length) {\n          if (${o} in input) {\n            payload.issues = payload.issues.concat(${r}.issues.map(iss => ({\n              ...iss,\n              path: iss.path ? [${o}, ...iss.path] : [${o}]\n            })));\n          }\n        }\n        \n        if (${r}.value === undefined) {\n          if (${o} in input) {\n            newResult[${o}] = undefined;\n          }\n        } else {\n          newResult[${o}] = ${r}.value;\n        }\n        \n      `):t.write(`\n        if (${r}.issues.length) {\n          payload.issues = payload.issues.concat(${r}.issues.map(iss => ({\n            ...iss,\n            path: iss.path ? [${o}, ...iss.path] : [${o}]\n          })));\n        }\n        \n        if (${r}.value === undefined) {\n          if (${o} in input) {\n            newResult[${o}] = undefined;\n          }\n        } else {\n          newResult[${o}] = ${r}.value;\n        }\n        \n      `)}t.write("payload.value = newResult;"),t.write("return payload;");const a=t.compile();return(t,r)=>a(e,t,r)})(t.shape)),l=i(l,d),c?AB([],h,l,d,u,e):l):r(l,d):(l.issues.push({expected:"object",code:"invalid_type",input:h,inst:e}),l)}});function RB(e,t,r,n){for(const r of e)if(0===r.issues.length)return t.value=r.value,t;const i=e.filter(e=>!SO(e));return 1===i.length?(t.value=i[0].value,i[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>PO(e,n,Yx())))}),t)}const PB=Wx("$ZodUnion",(e,t)=>{TM.init(e,t),oO(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),oO(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),oO(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),oO(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){const e=t.options.map(e=>e._zod.pattern);return new RegExp(`^(${e.map(e=>iO(e.source)).join("|")})$`)}});const r=1===t.options.length,n=t.options[0]._zod.run;e._zod.parse=(i,s)=>{if(r)return n(i,s);let o=!1;const a=[];for(const e of t.options){const t=e._zod.run({value:i.value,issues:[]},s);if(t instanceof Promise)a.push(t),o=!0;else{if(0===t.issues.length)return t;a.push(t)}}return o?Promise.all(a).then(t=>RB(t,i,e,s)):RB(a,i,e,s)}});function IB(e,t,r,n){const i=e.filter(e=>0===e.issues.length);return 1===i.length?(t.value=i[0].value,t):(0===i.length?t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>PO(e,n,Yx())))}):t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:[],inclusive:!1}),t)}const CB=Wx("$ZodXor",(e,t)=>{PB.init(e,t),t.inclusive=!1;const r=1===t.options.length,n=t.options[0]._zod.run;e._zod.parse=(i,s)=>{if(r)return n(i,s);let o=!1;const a=[];for(const e of t.options){const t=e._zod.run({value:i.value,issues:[]},s);t instanceof Promise?(a.push(t),o=!0):a.push(t)}return o?Promise.all(a).then(t=>IB(t,i,e,s)):IB(a,i,e,s)}}),_B=Wx("$ZodDiscriminatedUnion",(e,t)=>{t.inclusive=!1,PB.init(e,t);const r=e._zod.parse;oO(e._zod,"propValues",()=>{const e={};for(const r of t.options){const n=r._zod.propValues;if(!n||0===Object.keys(n).length)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(r)}"`);for(const[t,r]of Object.entries(n)){e[t]||(e[t]=new Set);for(const n of r)e[t].add(n)}}return e});const n=rO(()=>{const e=t.options,r=new Map;for(const n of e){const e=n._zod.propValues?.[t.discriminator];if(!e||0===e.size)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(n)}"`);for(const t of e){if(r.has(t))throw new Error(`Duplicate discriminator value "${String(t)}"`);r.set(t,n)}}return r});e._zod.parse=(i,s)=>{const o=i.value;if(!dO(o))return i.issues.push({code:"invalid_type",expected:"object",input:o,inst:e}),i;const a=n.value.get(o?.[t.discriminator]);return a?a._zod.run(i,s):t.unionFallback?r(i,s):(i.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:o,path:[t.discriminator],inst:e}),i)}}),TB=Wx("$ZodIntersection",(e,t)=>{TM.init(e,t),e._zod.parse=(e,r)=>{const n=e.value,i=t.left._zod.run({value:n,issues:[]},r),s=t.right._zod.run({value:n,issues:[]},r);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([t,r])=>xB(e,t,r)):xB(e,i,s)}});function NB(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e===+t)return{valid:!0,data:e};if(fO(e)&&fO(t)){const r=Object.keys(t),n=Object.keys(e).filter(e=>-1!==r.indexOf(e)),i={...e,...t};for(const r of n){const n=NB(e[r],t[r]);if(!n.valid)return{valid:!1,mergeErrorPath:[r,...n.mergeErrorPath]};i[r]=n.data}return{valid:!0,data:i}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const i=NB(e[n],t[n]);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function xB(e,t,r){const n=new Map;let i;for(const r of t.issues)if("unrecognized_keys"===r.code){i??(i=r);for(const e of r.keys)n.has(e)||n.set(e,{}),n.get(e).l=!0}else e.issues.push(r);for(const t of r.issues)if("unrecognized_keys"===t.code)for(const e of t.keys)n.has(e)||n.set(e,{}),n.get(e).r=!0;else e.issues.push(t);const s=[...n].filter(([,e])=>e.l&&e.r).map(([e])=>e);if(s.length&&i&&e.issues.push({...i,keys:s}),SO(e))return e;const o=NB(t.value,r.value);if(!o.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return e.value=o.data,e}const OB=Wx("$ZodTuple",(e,t)=>{TM.init(e,t);const r=t.items;e._zod.parse=(n,i)=>{const s=n.value;if(!Array.isArray(s))return n.issues.push({input:s,inst:e,expected:"tuple",code:"invalid_type"}),n;n.value=[];const o=[],a=[...r].reverse().findIndex(e=>"optional"!==e._zod.optin),c=-1===a?0:r.length-a;if(!t.rest){const t=s.length>r.length,i=s.length<c-1;if(t||i)return n.issues.push({...t?{code:"too_big",maximum:r.length,inclusive:!0}:{code:"too_small",minimum:r.length},input:s,inst:e,origin:"array"}),n}let u=-1;for(const e of r){if(u++,u>=s.length&&u>=c)continue;const t=e._zod.run({value:s[u],issues:[]},i);t instanceof Promise?o.push(t.then(e=>DB(e,n,u))):DB(t,n,u)}if(t.rest){const e=s.slice(r.length);for(const r of e){u++;const e=t.rest._zod.run({value:r,issues:[]},i);e instanceof Promise?o.push(e.then(e=>DB(e,n,u))):DB(e,n,u)}}return o.length?Promise.all(o).then(()=>n):n}});function DB(e,t,r){e.issues.length&&t.issues.push(...kO(r,e.issues)),t.value[r]=e.value}const MB=Wx("$ZodRecord",(e,t)=>{TM.init(e,t),e._zod.parse=(r,n)=>{const i=r.value;if(!fO(i))return r.issues.push({expected:"record",code:"invalid_type",input:i,inst:e}),r;const s=[],o=t.keyType._zod.values;if(o){r.value={};const a=new Set;for(const e of o)if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){a.add("number"==typeof e?e.toString():e);const o=t.valueType._zod.run({value:i[e],issues:[]},n);o instanceof Promise?s.push(o.then(t=>{t.issues.length&&r.issues.push(...kO(e,t.issues)),r.value[e]=t.value})):(o.issues.length&&r.issues.push(...kO(e,o.issues)),r.value[e]=o.value)}let c;for(const e in i)a.has(e)||(c=c??[],c.push(e));c&&c.length>0&&r.issues.push({code:"unrecognized_keys",input:i,inst:e,keys:c})}else{r.value={};for(const o of Reflect.ownKeys(i)){if("__proto__"===o)continue;let a=t.keyType._zod.run({value:o,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if("string"==typeof o&&DD.test(o)&&a.issues.length){const e=t.keyType._zod.run({value:Number(o),issues:[]},n);if(e instanceof Promise)throw new Error("Async schemas not supported in object keys currently");0===e.issues.length&&(a=e)}if(a.issues.length){"loose"===t.mode?r.value[o]=i[o]:r.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(e=>PO(e,n,Yx())),input:o,path:[o],inst:e});continue}const c=t.valueType._zod.run({value:i[o],issues:[]},n);c instanceof Promise?s.push(c.then(e=>{e.issues.length&&r.issues.push(...kO(o,e.issues)),r.value[a.value]=e.value})):(c.issues.length&&r.issues.push(...kO(o,c.issues)),r.value[a.value]=c.value)}}return s.length?Promise.all(s).then(()=>r):r}}),BB=Wx("$ZodMap",(e,t)=>{TM.init(e,t),e._zod.parse=(r,n)=>{const i=r.value;if(!(i instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:i,inst:e}),r;const s=[];r.value=new Map;for(const[o,a]of i){const c=t.keyType._zod.run({value:o,issues:[]},n),u=t.valueType._zod.run({value:a,issues:[]},n);c instanceof Promise||u instanceof Promise?s.push(Promise.all([c,u]).then(([t,s])=>{LB(t,s,r,o,i,e,n)})):LB(c,u,r,o,i,e,n)}return s.length?Promise.all(s).then(()=>r):r}});function LB(e,t,r,n,i,s,o){e.issues.length&&(gO.has(typeof n)?r.issues.push(...kO(n,e.issues)):r.issues.push({code:"invalid_key",origin:"map",input:i,inst:s,issues:e.issues.map(e=>PO(e,o,Yx()))})),t.issues.length&&(gO.has(typeof n)?r.issues.push(...kO(n,t.issues)):r.issues.push({origin:"map",code:"invalid_element",input:i,inst:s,key:n,issues:t.issues.map(e=>PO(e,o,Yx()))})),r.value.set(e.value,t.value)}const FB=Wx("$ZodSet",(e,t)=>{TM.init(e,t),e._zod.parse=(r,n)=>{const i=r.value;if(!(i instanceof Set))return r.issues.push({input:i,inst:e,expected:"set",code:"invalid_type"}),r;const s=[];r.value=new Set;for(const e of i){const i=t.valueType._zod.run({value:e,issues:[]},n);i instanceof Promise?s.push(i.then(e=>UB(e,r))):UB(i,r)}return s.length?Promise.all(s).then(()=>r):r}});function UB(e,t){e.issues.length&&t.issues.push(...e.issues),t.value.add(e.value)}const jB=Wx("$ZodEnum",(e,t)=>{TM.init(e,t);const r=Xx(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(e=>gO.has(typeof e)).map(e=>"string"==typeof e?yO(e):e.toString()).join("|")})$`),e._zod.parse=(t,i)=>{const s=t.value;return n.has(s)||t.issues.push({code:"invalid_value",values:r,input:s,inst:e}),t}}),zB=Wx("$ZodLiteral",(e,t)=>{if(TM.init(e,t),0===t.values.length)throw new Error("Cannot create literal schema with no valid values");const r=new Set(t.values);e._zod.values=r,e._zod.pattern=new RegExp(`^(${t.values.map(e=>"string"==typeof e?yO(e):e?yO(e.toString()):String(e)).join("|")})$`),e._zod.parse=(n,i)=>{const s=n.value;return r.has(s)||n.issues.push({code:"invalid_value",values:t.values,input:s,inst:e}),n}}),qB=Wx("$ZodFile",(e,t)=>{TM.init(e,t),e._zod.parse=(t,r)=>{const n=t.value;return n instanceof File||t.issues.push({expected:"file",code:"invalid_type",input:n,inst:e}),t}}),KB=Wx("$ZodTransform",(e,t)=>{TM.init(e,t),e._zod.parse=(r,n)=>{if("backward"===n.direction)throw new Zx(e.constructor.name);const i=t.transform(r.value,r);if(n.async)return(i instanceof Promise?i:Promise.resolve(i)).then(e=>(r.value=e,r));if(i instanceof Promise)throw new Jx;return r.value=i,r}});function GB(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}const $B=Wx("$ZodOptional",(e,t)=>{TM.init(e,t),e._zod.optin="optional",e._zod.optout="optional",oO(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),oO(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${iO(e.source)})?$`):void 0}),e._zod.parse=(e,r)=>{if("optional"===t.innerType._zod.optin){const n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(t=>GB(t,e.value)):GB(n,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,r)}}),VB=Wx("$ZodExactOptional",(e,t)=>{$B.init(e,t),oO(e._zod,"values",()=>t.innerType._zod.values),oO(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(e,r)=>t.innerType._zod.run(e,r)}),HB=Wx("$ZodNullable",(e,t)=>{TM.init(e,t),oO(e._zod,"optin",()=>t.innerType._zod.optin),oO(e._zod,"optout",()=>t.innerType._zod.optout),oO(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${iO(e.source)}|null)$`):void 0}),oO(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,r)=>null===e.value?e:t.innerType._zod.run(e,r)}),WB=Wx("$ZodDefault",(e,t)=>{TM.init(e,t),e._zod.optin="optional",oO(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if("backward"===r.direction)return t.innerType._zod.run(e,r);if(void 0===e.value)return e.value=t.defaultValue,e;const n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(e=>JB(e,t)):JB(n,t)}});function JB(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}const ZB=Wx("$ZodPrefault",(e,t)=>{TM.init(e,t),e._zod.optin="optional",oO(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>("backward"===r.direction||void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,r))}),QB=Wx("$ZodNonOptional",(e,t)=>{TM.init(e,t),oO(e._zod,"values",()=>{const e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(r,n)=>{const i=t.innerType._zod.run(r,n);return i instanceof Promise?i.then(t=>YB(t,e)):YB(i,e)}});function YB(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const XB=Wx("$ZodSuccess",(e,t)=>{TM.init(e,t),e._zod.parse=(e,r)=>{if("backward"===r.direction)throw new Zx("ZodSuccess");const n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(t=>(e.value=0===t.issues.length,e)):(e.value=0===n.issues.length,e)}}),eL=Wx("$ZodCatch",(e,t)=>{TM.init(e,t),oO(e._zod,"optin",()=>t.innerType._zod.optin),oO(e._zod,"optout",()=>t.innerType._zod.optout),oO(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if("backward"===r.direction)return t.innerType._zod.run(e,r);const n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(n=>(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>PO(e,r,Yx()))},input:e.value}),e.issues=[]),e)):(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>PO(e,r,Yx()))},input:e.value}),e.issues=[]),e)}}),tL=Wx("$ZodNaN",(e,t)=>{TM.init(e,t),e._zod.parse=(t,r)=>("number"==typeof t.value&&Number.isNaN(t.value)||t.issues.push({input:t.value,inst:e,expected:"nan",code:"invalid_type"}),t)}),rL=Wx("$ZodPipe",(e,t)=>{TM.init(e,t),oO(e._zod,"values",()=>t.in._zod.values),oO(e._zod,"optin",()=>t.in._zod.optin),oO(e._zod,"optout",()=>t.out._zod.optout),oO(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,r)=>{if("backward"===r.direction){const n=t.out._zod.run(e,r);return n instanceof Promise?n.then(e=>nL(e,t.in,r)):nL(n,t.in,r)}const n=t.in._zod.run(e,r);return n instanceof Promise?n.then(e=>nL(e,t.out,r)):nL(n,t.out,r)}});function nL(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const iL=Wx("$ZodCodec",(e,t)=>{TM.init(e,t),oO(e._zod,"values",()=>t.in._zod.values),oO(e._zod,"optin",()=>t.in._zod.optin),oO(e._zod,"optout",()=>t.out._zod.optout),oO(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,r)=>{if("forward"===(r.direction||"forward")){const n=t.in._zod.run(e,r);return n instanceof Promise?n.then(e=>sL(e,t,r)):sL(n,t,r)}{const n=t.out._zod.run(e,r);return n instanceof Promise?n.then(e=>sL(e,t,r)):sL(n,t,r)}}});function sL(e,t,r){if(e.issues.length)return e.aborted=!0,e;if("forward"===(r.direction||"forward")){const n=t.transform(e.value,e);return n instanceof Promise?n.then(n=>oL(e,n,t.out,r)):oL(e,n,t.out,r)}{const n=t.reverseTransform(e.value,e);return n instanceof Promise?n.then(n=>oL(e,n,t.in,r)):oL(e,n,t.in,r)}}function oL(e,t,r,n){return e.issues.length?(e.aborted=!0,e):r._zod.run({value:t,issues:e.issues},n)}const aL=Wx("$ZodReadonly",(e,t)=>{TM.init(e,t),oO(e._zod,"propValues",()=>t.innerType._zod.propValues),oO(e._zod,"values",()=>t.innerType._zod.values),oO(e._zod,"optin",()=>t.innerType?._zod?.optin),oO(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(e,r)=>{if("backward"===r.direction)return t.innerType._zod.run(e,r);const n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(cL):cL(n)}});function cL(e){return e.value=Object.freeze(e.value),e}const uL=Wx("$ZodTemplateLiteral",(e,t)=>{TM.init(e,t);const r=[];for(const e of t.parts)if("object"==typeof e&&null!==e){if(!e._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...e._zod.traits].shift()}`);const t=e._zod.pattern instanceof RegExp?e._zod.pattern.source:e._zod.pattern;if(!t)throw new Error(`Invalid template literal part: ${e._zod.traits}`);const n=t.startsWith("^")?1:0,i=t.endsWith("$")?t.length-1:t.length;r.push(t.slice(n,i))}else{if(null!==e&&!mO.has(typeof e))throw new Error(`Invalid template literal part: ${e}`);r.push(yO(`${e}`))}e._zod.pattern=new RegExp(`^${r.join("")}$`),e._zod.parse=(r,n)=>"string"!=typeof r.value?(r.issues.push({input:r.value,inst:e,expected:"string",code:"invalid_type"}),r):(e._zod.pattern.lastIndex=0,e._zod.pattern.test(r.value)||r.issues.push({input:r.value,inst:e,code:"invalid_format",format:t.format??"template_literal",pattern:e._zod.pattern.source}),r)}),lL=Wx("$ZodFunction",(e,t)=>(TM.init(e,t),e._def=t,e._zod.def=t,e.implement=t=>{if("function"!=typeof t)throw new Error("implement() must be called with a function");return function(...r){const n=e._def.input?DO(e._def.input,r):r,i=Reflect.apply(t,this,n);return e._def.output?DO(e._def.output,i):i}},e.implementAsync=t=>{if("function"!=typeof t)throw new Error("implementAsync() must be called with a function");return async function(...r){const n=e._def.input?await BO(e._def.input,r):r,i=await Reflect.apply(t,this,n);return e._def.output?await BO(e._def.output,i):i}},e._zod.parse=(t,r)=>{if("function"!=typeof t.value)return t.issues.push({code:"invalid_type",expected:"function",input:t.value,inst:e}),t;const n=e._def.output&&"promise"===e._def.output._zod.def.type;return t.value=n?e.implementAsync(t.value):e.implement(t.value),t},e.input=(...t)=>{const r=e.constructor;return Array.isArray(t[0])?new r({type:"function",input:new OB({type:"tuple",items:t[0],rest:t[1]}),output:e._def.output}):new r({type:"function",input:t[0],output:e._def.output})},e.output=t=>new(0,e.constructor)({type:"function",input:e._def.input,output:t}),e)),dL=Wx("$ZodPromise",(e,t)=>{TM.init(e,t),e._zod.parse=(e,r)=>Promise.resolve(e.value).then(e=>t.innerType._zod.run({value:e,issues:[]},r))}),hL=Wx("$ZodLazy",(e,t)=>{TM.init(e,t),oO(e._zod,"innerType",()=>t.getter()),oO(e._zod,"pattern",()=>e._zod.innerType?._zod?.pattern),oO(e._zod,"propValues",()=>e._zod.innerType?._zod?.propValues),oO(e._zod,"optin",()=>e._zod.innerType?._zod?.optin??void 0),oO(e._zod,"optout",()=>e._zod.innerType?._zod?.optout??void 0),e._zod.parse=(t,r)=>e._zod.innerType._zod.run(t,r)}),fL=Wx("$ZodCustom",(e,t)=>{iM.init(e,t),TM.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=r=>{const n=r.value,i=t.fn(n);if(i instanceof Promise)return i.then(t=>pL(t,r,n,e));pL(i,r,n,e)}});function pL(e,t,r,n){if(!e){const e={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(e.params=n._zod.def.params),t.issues.push(_O(e))}}var gL;Symbol("ZodOutput"),Symbol("ZodInput");(gL=globalThis).__zod_globalRegistry??(gL.__zod_globalRegistry=new class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const r=t[0];return this._map.set(e,r),r&&"object"==typeof r&&"id"in r&&this._idmap.set(r.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const r={...this.get(t)??{}};delete r.id;const n={...r,...this._map.get(e)};return Object.keys(n).length?n:void 0}return this._map.get(e)}has(e){return this._map.has(e)}});const mL=globalThis.__zod_globalRegistry;function yL(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...wO(t)})}function bL(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...wO(t)})}function wL(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...wO(t)})}function vL(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...wO(t)})}function EL(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...wO(t)})}function AL(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...wO(t)})}function SL(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...wO(t)})}function kL(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...wO(t)})}function RL(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...wO(t)})}function PL(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...wO(t)})}function IL(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...wO(t)})}function CL(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...wO(t)})}function _L(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...wO(t)})}function TL(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...wO(t)})}function NL(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...wO(t)})}function xL(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...wO(t)})}function OL(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...wO(t)})}function DL(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...wO(t)})}function ML(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...wO(t)})}function BL(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...wO(t)})}function LL(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...wO(t)})}function FL(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...wO(t)})}function UL(e,t){return new oM({check:"less_than",...wO(t),value:e,inclusive:!1})}function jL(e,t){return new oM({check:"less_than",...wO(t),value:e,inclusive:!0})}function zL(e,t){return new aM({check:"greater_than",...wO(t),value:e,inclusive:!1})}function qL(e,t){return new aM({check:"greater_than",...wO(t),value:e,inclusive:!0})}function KL(e){return zL(0,e)}function GL(e){return UL(0,e)}function $L(e){return jL(0,e)}function VL(e){return qL(0,e)}function HL(e,t){return new cM({check:"multiple_of",...wO(t),value:e})}function WL(e,t){return new dM({check:"max_size",...wO(t),maximum:e})}function JL(e,t){return new hM({check:"min_size",...wO(t),minimum:e})}function ZL(e,t){return new fM({check:"size_equals",...wO(t),size:e})}function QL(e,t){return new pM({check:"max_length",...wO(t),maximum:e})}function YL(e,t){return new gM({check:"min_length",...wO(t),minimum:e})}function XL(e,t){return new mM({check:"length_equals",...wO(t),length:e})}function eF(e,t){return new bM({check:"string_format",format:"regex",...wO(t),pattern:e})}function tF(e){return new wM({check:"string_format",format:"lowercase",...wO(e)})}function rF(e){return new vM({check:"string_format",format:"uppercase",...wO(e)})}function nF(e,t){return new EM({check:"string_format",format:"includes",...wO(t),includes:e})}function iF(e,t){return new AM({check:"string_format",format:"starts_with",...wO(t),prefix:e})}function sF(e,t){return new SM({check:"string_format",format:"ends_with",...wO(t),suffix:e})}function oF(e,t,r){return new RM({check:"property",property:e,schema:t,...wO(r)})}function aF(e,t){return new PM({check:"mime_type",mime:e,...wO(t)})}function cF(e){return new IM({check:"overwrite",tx:e})}function uF(e){return cF(t=>t.normalize(e))}function lF(){return cF(e=>e.trim())}function dF(){return cF(e=>e.toLowerCase())}function hF(){return cF(e=>e.toUpperCase())}function fF(){return cF(e=>function(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}(e))}function pF(e,t,r,n={}){const i=wO(n),s={...wO(n),check:"string_format",type:"string",format:t,fn:"function"==typeof r?r:e=>r.test(e),...i};return r instanceof RegExp&&(s.pattern=r),new e(s)}function gF(e){let t=e?.target??"draft-2020-12";return"draft-4"===t&&(t="draft-04"),"draft-7"===t&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??mL,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function mF(e,t,r={path:[],schemaPath:[]}){var n;const i=e._zod.def,s=t.seen.get(e);if(s)return s.count++,r.schemaPath.includes(e)&&(s.cycle=r.path),s.schema;const o={schema:{},count:1,cycle:void 0,path:r.path};t.seen.set(e,o);const a=e._zod.toJSONSchema?.();if(a)o.schema=a;else{const n={...r,schemaPath:[...r.schemaPath,e],path:r.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,o.schema,n);else{const r=o.schema,s=t.processors[i.type];if(!s)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${i.type}`);s(e,t,r,n)}const s=e._zod.parent;s&&(o.ref||(o.ref=s),mF(s,t,n),t.seen.get(s).isParent=!0)}const c=t.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),"input"===t.io&&wF(e)&&(delete o.schema.examples,delete o.schema.default),"input"===t.io&&o.schema._prefault&&((n=o.schema).default??(n.default=o.schema._prefault)),delete o.schema._prefault,t.seen.get(e).schema}function yF(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=new Map;for(const t of e.seen.entries()){const r=e.metadataRegistry.get(t[0])?.id;if(r){const e=n.get(r);if(e&&e!==t[0])throw new Error(`Duplicate schema id "${r}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);n.set(r,t[0])}}const i=t=>{if(t[1].schema.$ref)return;const n=t[1],{ref:i,defId:s}=(t=>{const n="draft-2020-12"===e.target?"$defs":"definitions";if(e.external){const r=e.external.registry.get(t[0])?.id,i=e.external.uri??(e=>e);if(r)return{ref:i(r)};const s=t[1].defId??t[1].schema.id??"schema"+e.counter++;return t[1].defId=s,{defId:s,ref:`${i("__shared")}#/${n}/${s}`}}if(t[1]===r)return{ref:"#"};const i=`#/${n}/`,s=t[1].schema.id??"__schema"+e.counter++;return{defId:s,ref:i+s}})(t);n.def={...n.schema},s&&(n.defId=s);const o=n.schema;for(const e in o)delete o[e];o.$ref=i};if("throw"===e.cycles)for(const t of e.seen.entries()){const e=t[1];if(e.cycle)throw new Error(`Cycle detected: #/${e.cycle?.join("/")}/<root>\n\nSet the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const r of e.seen.entries()){const n=r[1];if(t===r[0]){i(r);continue}if(e.external){const n=e.external.registry.get(r[0])?.id;if(t!==r[0]&&n){i(r);continue}}const s=e.metadataRegistry.get(r[0])?.id;(s||n.cycle||n.count>1&&"ref"===e.reused)&&i(r)}}function bF(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=t=>{const r=e.seen.get(t);if(null===r.ref)return;const i=r.def??r.schema,s={...i},o=r.ref;if(r.ref=null,o){n(o);const r=e.seen.get(o),a=r.schema;if(!a.$ref||"draft-07"!==e.target&&"draft-04"!==e.target&&"openapi-3.0"!==e.target?Object.assign(i,a):(i.allOf=i.allOf??[],i.allOf.push(a)),Object.assign(i,s),t._zod.parent===o)for(const e in i)"$ref"!==e&&"allOf"!==e&&(e in s||delete i[e]);if(a.$ref&&r.def)for(const e in i)"$ref"!==e&&"allOf"!==e&&e in r.def&&JSON.stringify(i[e])===JSON.stringify(r.def[e])&&delete i[e]}const a=t._zod.parent;if(a&&a!==o){n(a);const t=e.seen.get(a);if(t?.schema.$ref&&(i.$ref=t.schema.$ref,t.def))for(const e in i)"$ref"!==e&&"allOf"!==e&&e in t.def&&JSON.stringify(i[e])===JSON.stringify(t.def[e])&&delete i[e]}e.override({zodSchema:t,jsonSchema:i,path:r.path??[]})};for(const t of[...e.seen.entries()].reverse())n(t[0]);const i={};if("draft-2020-12"===e.target?i.$schema="https://json-schema.org/draft/2020-12/schema":"draft-07"===e.target?i.$schema="http://json-schema.org/draft-07/schema#":"draft-04"===e.target?i.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){const r=e.external.registry.get(t)?.id;if(!r)throw new Error("Schema is missing an `id` property");i.$id=e.external.uri(r)}Object.assign(i,r.def??r.schema);const s=e.external?.defs??{};for(const t of e.seen.entries()){const e=t[1];e.def&&e.defId&&(s[e.defId]=e.def)}e.external||Object.keys(s).length>0&&("draft-2020-12"===e.target?i.$defs=s:i.definitions=s);try{const r=JSON.parse(JSON.stringify(i));return Object.defineProperty(r,"~standard",{value:{...t["~standard"],jsonSchema:{input:vF(t,"input",e.processors),output:vF(t,"output",e.processors)}},enumerable:!1,writable:!1}),r}catch(e){throw new Error("Error converting schema to JSON.")}}function wF(e,t){const r=t??{seen:new Set};if(r.seen.has(e))return!1;r.seen.add(e);const n=e._zod.def;if("transform"===n.type)return!0;if("array"===n.type)return wF(n.element,r);if("set"===n.type)return wF(n.valueType,r);if("lazy"===n.type)return wF(n.getter(),r);if("promise"===n.type||"optional"===n.type||"nonoptional"===n.type||"nullable"===n.type||"readonly"===n.type||"default"===n.type||"prefault"===n.type)return wF(n.innerType,r);if("intersection"===n.type)return wF(n.left,r)||wF(n.right,r);if("record"===n.type||"map"===n.type)return wF(n.keyType,r)||wF(n.valueType,r);if("pipe"===n.type)return wF(n.in,r)||wF(n.out,r);if("object"===n.type){for(const e in n.shape)if(wF(n.shape[e],r))return!0;return!1}if("union"===n.type){for(const e of n.options)if(wF(e,r))return!0;return!1}if("tuple"===n.type){for(const e of n.items)if(wF(e,r))return!0;return!(!n.rest||!wF(n.rest,r))}return!1}const vF=(e,t,r={})=>n=>{const{libraryOptions:i,target:s}=n??{},o=gF({...i??{},target:s,io:t,processors:r});return mF(e,o),yF(o,e),bF(o,e)},EF={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},AF=(e,t,r,n)=>{const i=e._zod.def,s=!1===i.inclusive,o=i.options.map((e,r)=>mF(e,t,{...n,path:[...n.path,s?"oneOf":"anyOf",r]}));s?r.oneOf=o:r.anyOf=o},SF=(e,t,r,n)=>{const i=e._zod.def;mF(i.innerType,t,n),t.seen.get(e).ref=i.innerType},kF=Wx("ZodISODateTime",(e,t)=>{GM.init(e,t),ZF.init(e,t)});function RF(e){return function(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...wO(t)})}(kF,e)}const PF=Wx("ZodISODate",(e,t)=>{$M.init(e,t),ZF.init(e,t)});function IF(e){return function(e,t){return new e({type:"string",format:"date",check:"string_format",...wO(t)})}(PF,e)}const CF=Wx("ZodISOTime",(e,t)=>{VM.init(e,t),ZF.init(e,t)});function _F(e){return function(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...wO(t)})}(CF,e)}const TF=Wx("ZodISODuration",(e,t)=>{HM.init(e,t),ZF.init(e,t)});function NF(e){return function(e,t){return new e({type:"string",format:"duration",check:"string_format",...wO(t)})}(TF,e)}const xF=(e,t)=>{NO.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>function(e,t=e=>e.message){const r={_errors:[]},n=e=>{for(const i of e.issues)if("invalid_union"===i.code&&i.errors.length)i.errors.map(e=>n({issues:e}));else if("invalid_key"===i.code)n({issues:i.issues});else if("invalid_element"===i.code)n({issues:i.issues});else if(0===i.path.length)r._errors.push(t(i));else{let e=r,n=0;for(;n<i.path.length;){const r=i.path[n];n===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(e),r}(e,t)},flatten:{value:t=>function(e,t=e=>e.message){const r={},n=[];for(const i of e.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(t(i))):n.push(t(i));return{formErrors:n,fieldErrors:r}}(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,tO,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,tO,2)}},isEmpty:{get:()=>0===e.issues.length}})},OF=(Wx("ZodError",xF),Wx("ZodError",xF,{Parent:Error})),DF=OO(OF),MF=MO(OF),BF=LO(OF),LF=UO(OF),FF=zO(OF),UF=qO(OF),jF=KO(OF),zF=GO(OF),qF=$O(OF),KF=VO(OF),GF=HO(OF),$F=WO(OF),VF=Wx("ZodType",(e,t)=>(TM.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:vF(e,"input"),output:vF(e,"output")}}),e.toJSONSchema=((e,t={})=>r=>{const n=gF({...r,processors:t});return mF(e,n),yF(n,e),bF(n,e)})(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(cO(t,{checks:[...t.checks??[],...r.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),{parent:!0}),e.with=e.check,e.clone=(t,r)=>bO(e,t,r),e.brand=()=>e,e.register=(t,r)=>(t.add(e,r),e),e.parse=(t,r)=>DF(e,t,r,{callee:e.parse}),e.safeParse=(t,r)=>BF(e,t,r),e.parseAsync=async(t,r)=>MF(e,t,r,{callee:e.parseAsync}),e.safeParseAsync=async(t,r)=>LF(e,t,r),e.spa=e.safeParseAsync,e.encode=(t,r)=>FF(e,t,r),e.decode=(t,r)=>UF(e,t,r),e.encodeAsync=async(t,r)=>jF(e,t,r),e.decodeAsync=async(t,r)=>zF(e,t,r),e.safeEncode=(t,r)=>qF(e,t,r),e.safeDecode=(t,r)=>KF(e,t,r),e.safeEncodeAsync=async(t,r)=>GF(e,t,r),e.safeDecodeAsync=async(t,r)=>$F(e,t,r),e.refine=(t,r)=>e.check(Uz(t,r)),e.superRefine=t=>e.check(jz(t)),e.overwrite=t=>e.check(cF(t)),e.optional=()=>iz(e),e.exactOptional=()=>oz(e),e.nullable=()=>cz(e),e.nullish=()=>iz(cz(e)),e.nonoptional=t=>gz(e,t),e.array=()=>kj(e),e.or=t=>Nj([e,t]),e.and=t=>Lj(e,t),e.transform=t=>Sz(e,rz(t)),e.default=t=>dz(e,t),e.prefault=t=>fz(e,t),e.catch=t=>wz(e,t),e.pipe=t=>Sz(e,t),e.readonly=()=>Iz(e),e.describe=t=>{const r=e.clone();return mL.add(r,{description:t}),r},Object.defineProperty(e,"description",{get:()=>mL.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return mL.get(e);const r=e.clone();return mL.add(r,t[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=t=>t(e),e)),HF=Wx("_ZodString",(e,t)=>{NM.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r)=>{const n=r;n.type="string";const{minimum:i,maximum:s,format:o,patterns:a,contentEncoding:c}=e._zod.bag;if("number"==typeof i&&(n.minLength=i),"number"==typeof s&&(n.maxLength=s),o&&(n.format=EF[o]??o,""===n.format&&delete n.format,"time"===o&&delete n.format),c&&(n.contentEncoding=c),a&&a.size>0){const e=[...a];1===e.length?n.pattern=e[0].source:e.length>1&&(n.allOf=[...e.map(e=>({..."draft-07"===t.target||"draft-04"===t.target||"openapi-3.0"===t.target?{type:"string"}:{},pattern:e.source}))])}})(e,t,r);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...t)=>e.check(eF(...t)),e.includes=(...t)=>e.check(nF(...t)),e.startsWith=(...t)=>e.check(iF(...t)),e.endsWith=(...t)=>e.check(sF(...t)),e.min=(...t)=>e.check(YL(...t)),e.max=(...t)=>e.check(QL(...t)),e.length=(...t)=>e.check(XL(...t)),e.nonempty=(...t)=>e.check(YL(1,...t)),e.lowercase=t=>e.check(tF(t)),e.uppercase=t=>e.check(rF(t)),e.trim=()=>e.check(lF()),e.normalize=(...t)=>e.check(uF(...t)),e.toLowerCase=()=>e.check(dF()),e.toUpperCase=()=>e.check(hF()),e.slugify=()=>e.check(fF())}),WF=Wx("ZodString",(e,t)=>{NM.init(e,t),HF.init(e,t),e.email=t=>e.check(yL(QF,t)),e.url=t=>e.check(SL(oU,t)),e.jwt=t=>e.check(FL(UU,t)),e.emoji=t=>e.check(kL(uU,t)),e.guid=t=>e.check(bL(XF,t)),e.uuid=t=>e.check(wL(tU,t)),e.uuidv4=t=>e.check(vL(tU,t)),e.uuidv6=t=>e.check(EL(tU,t)),e.uuidv7=t=>e.check(AL(tU,t)),e.nanoid=t=>e.check(RL(dU,t)),e.guid=t=>e.check(bL(XF,t)),e.cuid=t=>e.check(PL(fU,t)),e.cuid2=t=>e.check(IL(gU,t)),e.ulid=t=>e.check(CL(yU,t)),e.base64=t=>e.check(ML(OU,t)),e.base64url=t=>e.check(BL(MU,t)),e.xid=t=>e.check(_L(wU,t)),e.ksuid=t=>e.check(TL(EU,t)),e.ipv4=t=>e.check(NL(SU,t)),e.ipv6=t=>e.check(xL(IU,t)),e.cidrv4=t=>e.check(OL(_U,t)),e.cidrv6=t=>e.check(DL(NU,t)),e.e164=t=>e.check(LL(LU,t)),e.datetime=t=>e.check(RF(t)),e.date=t=>e.check(IF(t)),e.time=t=>e.check(_F(t)),e.duration=t=>e.check(NF(t))});function JF(e){return function(e,t){return new e({type:"string",...wO(t)})}(WF,e)}const ZF=Wx("ZodStringFormat",(e,t)=>{xM.init(e,t),HF.init(e,t)}),QF=Wx("ZodEmail",(e,t)=>{MM.init(e,t),ZF.init(e,t)});function YF(e){return yL(QF,e)}const XF=Wx("ZodGUID",(e,t)=>{OM.init(e,t),ZF.init(e,t)});function eU(e){return bL(XF,e)}const tU=Wx("ZodUUID",(e,t)=>{DM.init(e,t),ZF.init(e,t)});function rU(e){return wL(tU,e)}function nU(e){return vL(tU,e)}function iU(e){return EL(tU,e)}function sU(e){return AL(tU,e)}const oU=Wx("ZodURL",(e,t)=>{BM.init(e,t),ZF.init(e,t)});function aU(e){return SL(oU,e)}function cU(e){return SL(oU,{protocol:/^https?$/,hostname:kD,...wO(e)})}const uU=Wx("ZodEmoji",(e,t)=>{LM.init(e,t),ZF.init(e,t)});function lU(e){return kL(uU,e)}const dU=Wx("ZodNanoID",(e,t)=>{FM.init(e,t),ZF.init(e,t)});function hU(e){return RL(dU,e)}const fU=Wx("ZodCUID",(e,t)=>{UM.init(e,t),ZF.init(e,t)});function pU(e){return PL(fU,e)}const gU=Wx("ZodCUID2",(e,t)=>{jM.init(e,t),ZF.init(e,t)});function mU(e){return IL(gU,e)}const yU=Wx("ZodULID",(e,t)=>{zM.init(e,t),ZF.init(e,t)});function bU(e){return CL(yU,e)}const wU=Wx("ZodXID",(e,t)=>{qM.init(e,t),ZF.init(e,t)});function vU(e){return _L(wU,e)}const EU=Wx("ZodKSUID",(e,t)=>{KM.init(e,t),ZF.init(e,t)});function AU(e){return TL(EU,e)}const SU=Wx("ZodIPv4",(e,t)=>{WM.init(e,t),ZF.init(e,t)});function kU(e){return NL(SU,e)}const RU=Wx("ZodMAC",(e,t)=>{ZM.init(e,t),ZF.init(e,t)});function PU(e){return function(e,t){return new e({type:"string",format:"mac",check:"string_format",abort:!1,...wO(t)})}(RU,e)}const IU=Wx("ZodIPv6",(e,t)=>{JM.init(e,t),ZF.init(e,t)});function CU(e){return xL(IU,e)}const _U=Wx("ZodCIDRv4",(e,t)=>{QM.init(e,t),ZF.init(e,t)});function TU(e){return OL(_U,e)}const NU=Wx("ZodCIDRv6",(e,t)=>{YM.init(e,t),ZF.init(e,t)});function xU(e){return DL(NU,e)}const OU=Wx("ZodBase64",(e,t)=>{eB.init(e,t),ZF.init(e,t)});function DU(e){return ML(OU,e)}const MU=Wx("ZodBase64URL",(e,t)=>{tB.init(e,t),ZF.init(e,t)});function BU(e){return BL(MU,e)}const LU=Wx("ZodE164",(e,t)=>{rB.init(e,t),ZF.init(e,t)});function FU(e){return LL(LU,e)}const UU=Wx("ZodJWT",(e,t)=>{nB.init(e,t),ZF.init(e,t)});function jU(e){return FL(UU,e)}const zU=Wx("ZodCustomStringFormat",(e,t)=>{iB.init(e,t),ZF.init(e,t)});function qU(e,t,r={}){return pF(zU,e,t,r)}function KU(e){return pF(zU,"hostname",SD,e)}function GU(e){return pF(zU,"hex",jD,e)}function $U(e,r){const n=`${e}_${r?.enc??"hex"}`,i=t[n];if(!i)throw new Error(`Unrecognized hash format: ${n}`);return pF(zU,n,i,r)}const VU=Wx("ZodNumber",(e,t)=>{sB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r)=>{const n=r,{minimum:i,maximum:s,format:o,multipleOf:a,exclusiveMaximum:c,exclusiveMinimum:u}=e._zod.bag;"string"==typeof o&&o.includes("int")?n.type="integer":n.type="number","number"==typeof u&&("draft-04"===t.target||"openapi-3.0"===t.target?(n.minimum=u,n.exclusiveMinimum=!0):n.exclusiveMinimum=u),"number"==typeof i&&(n.minimum=i,"number"==typeof u&&"draft-04"!==t.target&&(u>=i?delete n.minimum:delete n.exclusiveMinimum)),"number"==typeof c&&("draft-04"===t.target||"openapi-3.0"===t.target?(n.maximum=c,n.exclusiveMaximum=!0):n.exclusiveMaximum=c),"number"==typeof s&&(n.maximum=s,"number"==typeof c&&"draft-04"!==t.target&&(c<=s?delete n.maximum:delete n.exclusiveMaximum)),"number"==typeof a&&(n.multipleOf=a)})(e,t,r),e.gt=(t,r)=>e.check(zL(t,r)),e.gte=(t,r)=>e.check(qL(t,r)),e.min=(t,r)=>e.check(qL(t,r)),e.lt=(t,r)=>e.check(UL(t,r)),e.lte=(t,r)=>e.check(jL(t,r)),e.max=(t,r)=>e.check(jL(t,r)),e.int=t=>e.check(JU(t)),e.safe=t=>e.check(JU(t)),e.positive=t=>e.check(zL(0,t)),e.nonnegative=t=>e.check(qL(0,t)),e.negative=t=>e.check(UL(0,t)),e.nonpositive=t=>e.check(jL(0,t)),e.multipleOf=(t,r)=>e.check(HL(t,r)),e.step=(t,r)=>e.check(HL(t,r)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function HU(e){return function(e,t){return new e({type:"number",checks:[],...wO(t)})}(VU,e)}const WU=Wx("ZodNumberFormat",(e,t)=>{oB.init(e,t),VU.init(e,t)});function JU(e){return function(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...wO(t)})}(WU,e)}function ZU(e){return function(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float32",...wO(t)})}(WU,e)}function QU(e){return function(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float64",...wO(t)})}(WU,e)}function YU(e){return function(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"int32",...wO(t)})}(WU,e)}function XU(e){return function(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"uint32",...wO(t)})}(WU,e)}const ej=Wx("ZodBoolean",(e,t)=>{aB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t,r)=>{r.type="boolean"})(0,0,t)});function tj(e){return function(e,t){return new e({type:"boolean",...wO(t)})}(ej,e)}const rj=Wx("ZodBigInt",(e,t)=>{cB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("BigInt cannot be represented in JSON Schema")})(0,e),e.gte=(t,r)=>e.check(qL(t,r)),e.min=(t,r)=>e.check(qL(t,r)),e.gt=(t,r)=>e.check(zL(t,r)),e.gte=(t,r)=>e.check(qL(t,r)),e.min=(t,r)=>e.check(qL(t,r)),e.lt=(t,r)=>e.check(UL(t,r)),e.lte=(t,r)=>e.check(jL(t,r)),e.max=(t,r)=>e.check(jL(t,r)),e.positive=t=>e.check(zL(BigInt(0),t)),e.negative=t=>e.check(UL(BigInt(0),t)),e.nonpositive=t=>e.check(jL(BigInt(0),t)),e.nonnegative=t=>e.check(qL(BigInt(0),t)),e.multipleOf=(t,r)=>e.check(HL(t,r));const r=e._zod.bag;e.minValue=r.minimum??null,e.maxValue=r.maximum??null,e.format=r.format??null});function nj(e){return function(e,t){return new e({type:"bigint",...wO(t)})}(rj,e)}const ij=Wx("ZodBigIntFormat",(e,t)=>{uB.init(e,t),rj.init(e,t)});function sj(e){return function(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...wO(t)})}(ij,e)}function oj(e){return function(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...wO(t)})}(ij,e)}const aj=Wx("ZodSymbol",(e,t)=>{lB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("Symbols cannot be represented in JSON Schema")})(0,e)});function cj(e){return function(e,t){return new e({type:"symbol",...wO(t)})}(aj,e)}const uj=Wx("ZodUndefined",(e,t)=>{dB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("Undefined cannot be represented in JSON Schema")})(0,e)});function lj(e){return function(e,t){return new e({type:"undefined",...wO(t)})}(uj,e)}const dj=Wx("ZodNull",(e,t)=>{hB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t,r)=>{"openapi-3.0"===t.target?(r.type="string",r.nullable=!0,r.enum=[null]):r.type="null"})(0,e,t)});function hj(e){return function(e,t){return new e({type:"null",...wO(t)})}(dj,e)}const fj=Wx("ZodAny",(e,t)=>{fB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>{}});function pj(){return new fj({type:"any"})}const gj=Wx("ZodUnknown",(e,t)=>{pB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>{}});function mj(){return new gj({type:"unknown"})}const yj=Wx("ZodNever",(e,t)=>{gB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t,r)=>{r.not={}})(0,0,t)});function bj(e){return function(e,t){return new e({type:"never",...wO(t)})}(yj,e)}const wj=Wx("ZodVoid",(e,t)=>{mB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("Void cannot be represented in JSON Schema")})(0,e)});function vj(e){return function(e,t){return new e({type:"void",...wO(t)})}(wj,e)}const Ej=Wx("ZodDate",(e,t)=>{yB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("Date cannot be represented in JSON Schema")})(0,e),e.min=(t,r)=>e.check(qL(t,r)),e.max=(t,r)=>e.check(jL(t,r));const r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function Aj(e){return function(e,t){return new e({type:"date",...wO(t)})}(Ej,e)}const Sj=Wx("ZodArray",(e,t)=>{wB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=r,s=e._zod.def,{minimum:o,maximum:a}=e._zod.bag;"number"==typeof o&&(i.minItems=o),"number"==typeof a&&(i.maxItems=a),i.type="array",i.items=mF(s.element,t,{...n,path:[...n.path,"items"]})})(e,t,r,n),e.element=t.element,e.min=(t,r)=>e.check(YL(t,r)),e.nonempty=t=>e.check(YL(1,t)),e.max=(t,r)=>e.check(QL(t,r)),e.length=(t,r)=>e.check(XL(t,r)),e.unwrap=()=>e.element});function kj(e,t){return function(e,t,r){return new e({type:"array",element:t,...wO(r)})}(Sj,e,t)}function Rj(e){const t=e._zod.def.shape;return Jj(Object.keys(t))}const Pj=Wx("ZodObject",(e,t)=>{kB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=r,s=e._zod.def;i.type="object",i.properties={};const o=s.shape;for(const e in o)i.properties[e]=mF(o[e],t,{...n,path:[...n.path,"properties",e]});const a=new Set(Object.keys(o)),c=new Set([...a].filter(e=>{const r=s.shape[e]._zod;return"input"===t.io?void 0===r.optin:void 0===r.optout}));c.size>0&&(i.required=Array.from(c)),"never"===s.catchall?._zod.def.type?i.additionalProperties=!1:s.catchall?s.catchall&&(i.additionalProperties=mF(s.catchall,t,{...n,path:[...n.path,"additionalProperties"]})):"output"===t.io&&(i.additionalProperties=!1)})(e,t,r,n),oO(e,"shape",()=>t.shape),e.keyof=()=>Jj(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:mj()}),e.loose=()=>e.clone({...e._zod.def,catchall:mj()}),e.strict=()=>e.clone({...e._zod.def,catchall:bj()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>function(e,t){if(!fO(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0){const r=e._zod.def.shape;for(const e in t)if(void 0!==Object.getOwnPropertyDescriptor(r,e))throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const n=cO(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t};return aO(this,"shape",r),r}});return bO(e,n)}(e,t),e.safeExtend=t=>function(e,t){if(!fO(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r=cO(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t};return aO(this,"shape",r),r}});return bO(e,r)}(e,t),e.merge=t=>function(e,t){const r=cO(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return aO(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return bO(e,r)}(e,t),e.pick=t=>function(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");return bO(e,cO(e._zod.def,{get shape(){const e={};for(const n in t){if(!(n in r.shape))throw new Error(`Unrecognized key: "${n}"`);t[n]&&(e[n]=r.shape[n])}return aO(this,"shape",e),e},checks:[]}))}(e,t),e.omit=t=>function(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const i=cO(e._zod.def,{get shape(){const n={...e._zod.def.shape};for(const e in t){if(!(e in r.shape))throw new Error(`Unrecognized key: "${e}"`);t[e]&&delete n[e]}return aO(this,"shape",n),n},checks:[]});return bO(e,i)}(e,t),e.partial=(...t)=>function(e,t,r){const n=t._zod.def.checks;if(n&&n.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const i=cO(t._zod.def,{get shape(){const n=t._zod.def.shape,i={...n};if(r)for(const t in r){if(!(t in n))throw new Error(`Unrecognized key: "${t}"`);r[t]&&(i[t]=e?new e({type:"optional",innerType:n[t]}):n[t])}else for(const t in n)i[t]=e?new e({type:"optional",innerType:n[t]}):n[t];return aO(this,"shape",i),i},checks:[]});return bO(t,i)}(nz,e,t[0]),e.required=(...t)=>function(e,t,r){const n=cO(t._zod.def,{get shape(){const n=t._zod.def.shape,i={...n};if(r)for(const t in r){if(!(t in i))throw new Error(`Unrecognized key: "${t}"`);r[t]&&(i[t]=new e({type:"nonoptional",innerType:n[t]}))}else for(const t in n)i[t]=new e({type:"nonoptional",innerType:n[t]});return aO(this,"shape",i),i}});return bO(t,n)}(pz,e,t[0])});function Ij(e,t){const r={type:"object",shape:e??{},...wO(t)};return new Pj(r)}function Cj(e,t){return new Pj({type:"object",shape:e,catchall:bj(),...wO(t)})}function _j(e,t){return new Pj({type:"object",shape:e,catchall:mj(),...wO(t)})}const Tj=Wx("ZodUnion",(e,t)=>{PB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>AF(e,t,r,n),e.options=t.options});function Nj(e,t){return new Tj({type:"union",options:e,...wO(t)})}const xj=Wx("ZodXor",(e,t)=>{Tj.init(e,t),CB.init(e,t),e._zod.processJSONSchema=(t,r,n)=>AF(e,t,r,n),e.options=t.options});function Oj(e,t){return new xj({type:"union",options:e,inclusive:!1,...wO(t)})}const Dj=Wx("ZodDiscriminatedUnion",(e,t)=>{Tj.init(e,t),_B.init(e,t)});function Mj(e,t,r){return new Dj({type:"union",options:t,discriminator:e,...wO(r)})}const Bj=Wx("ZodIntersection",(e,t)=>{TB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.def,s=mF(i.left,t,{...n,path:[...n.path,"allOf",0]}),o=mF(i.right,t,{...n,path:[...n.path,"allOf",1]}),a=e=>"allOf"in e&&1===Object.keys(e).length,c=[...a(s)?s.allOf:[s],...a(o)?o.allOf:[o]];r.allOf=c})(e,t,r,n)});function Lj(e,t){return new Bj({type:"intersection",left:e,right:t})}const Fj=Wx("ZodTuple",(e,t)=>{OB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=r,s=e._zod.def;i.type="array";const o="draft-2020-12"===t.target?"prefixItems":"items",a="draft-2020-12"===t.target||"openapi-3.0"===t.target?"items":"additionalItems",c=s.items.map((e,r)=>mF(e,t,{...n,path:[...n.path,o,r]})),u=s.rest?mF(s.rest,t,{...n,path:[...n.path,a,..."openapi-3.0"===t.target?[s.items.length]:[]]}):null;"draft-2020-12"===t.target?(i.prefixItems=c,u&&(i.items=u)):"openapi-3.0"===t.target?(i.items={anyOf:c},u&&i.items.anyOf.push(u),i.minItems=c.length,u||(i.maxItems=c.length)):(i.items=c,u&&(i.additionalItems=u));const{minimum:l,maximum:d}=e._zod.bag;"number"==typeof l&&(i.minItems=l),"number"==typeof d&&(i.maxItems=d)})(e,t,r,n),e.rest=t=>e.clone({...e._zod.def,rest:t})});function Uj(e,t,r){const n=t instanceof TM;return new Fj({type:"tuple",items:e,rest:n?t:null,...wO(n?r:t)})}const jj=Wx("ZodRecord",(e,t)=>{MB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=r,s=e._zod.def;i.type="object";const o=s.keyType,a=o._zod.bag,c=a?.patterns;if("loose"===s.mode&&c&&c.size>0){const e=mF(s.valueType,t,{...n,path:[...n.path,"patternProperties","*"]});i.patternProperties={};for(const t of c)i.patternProperties[t.source]=e}else"draft-07"!==t.target&&"draft-2020-12"!==t.target||(i.propertyNames=mF(s.keyType,t,{...n,path:[...n.path,"propertyNames"]})),i.additionalProperties=mF(s.valueType,t,{...n,path:[...n.path,"additionalProperties"]});const u=o._zod.values;if(u){const e=[...u].filter(e=>"string"==typeof e||"number"==typeof e);e.length>0&&(i.required=e)}})(e,t,r,n),e.keyType=t.keyType,e.valueType=t.valueType});function zj(e,t,r){return new jj({type:"record",keyType:e,valueType:t,...wO(r)})}function qj(e,t,r){const n=bO(e);return n._zod.values=void 0,new jj({type:"record",keyType:n,valueType:t,...wO(r)})}function Kj(e,t,r){return new jj({type:"record",keyType:e,valueType:t,mode:"loose",...wO(r)})}const Gj=Wx("ZodMap",(e,t)=>{BB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("Map cannot be represented in JSON Schema")})(0,e),e.keyType=t.keyType,e.valueType=t.valueType,e.min=(...t)=>e.check(JL(...t)),e.nonempty=t=>e.check(JL(1,t)),e.max=(...t)=>e.check(WL(...t)),e.size=(...t)=>e.check(ZL(...t))});function $j(e,t,r){return new Gj({type:"map",keyType:e,valueType:t,...wO(r)})}const Vj=Wx("ZodSet",(e,t)=>{FB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("Set cannot be represented in JSON Schema")})(0,e),e.min=(...t)=>e.check(JL(...t)),e.nonempty=t=>e.check(JL(1,t)),e.max=(...t)=>e.check(WL(...t)),e.size=(...t)=>e.check(ZL(...t))});function Hj(e,t){return new Vj({type:"set",valueType:e,...wO(t)})}const Wj=Wx("ZodEnum",(e,t)=>{jB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r)=>{const n=Xx(e._zod.def.entries);n.every(e=>"number"==typeof e)&&(r.type="number"),n.every(e=>"string"==typeof e)&&(r.type="string"),r.enum=n})(e,0,r),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(e,n)=>{const i={};for(const n of e){if(!r.has(n))throw new Error(`Key ${n} not found in enum`);i[n]=t.entries[n]}return new Wj({...t,checks:[],...wO(n),entries:i})},e.exclude=(e,n)=>{const i={...t.entries};for(const t of e){if(!r.has(t))throw new Error(`Key ${t} not found in enum`);delete i[t]}return new Wj({...t,checks:[],...wO(n),entries:i})}});function Jj(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e;return new Wj({type:"enum",entries:r,...wO(t)})}function Zj(e,t){return new Wj({type:"enum",entries:e,...wO(t)})}const Qj=Wx("ZodLiteral",(e,t)=>{zB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r)=>{const n=e._zod.def,i=[];for(const e of n.values)if(void 0===e){if("throw"===t.unrepresentable)throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof e){if("throw"===t.unrepresentable)throw new Error("BigInt literals cannot be represented in JSON Schema");i.push(Number(e))}else i.push(e);if(0===i.length);else if(1===i.length){const e=i[0];r.type=null===e?"null":typeof e,"draft-04"===t.target||"openapi-3.0"===t.target?r.enum=[e]:r.const=e}else i.every(e=>"number"==typeof e)&&(r.type="number"),i.every(e=>"string"==typeof e)&&(r.type="string"),i.every(e=>"boolean"==typeof e)&&(r.type="boolean"),i.every(e=>null===e)&&(r.type="null"),r.enum=i})(e,t,r),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function Yj(e,t){return new Qj({type:"literal",values:Array.isArray(e)?e:[e],...wO(t)})}const Xj=Wx("ZodFile",(e,t)=>{qB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r)=>{const n=r,i={type:"string",format:"binary",contentEncoding:"binary"},{minimum:s,maximum:o,mime:a}=e._zod.bag;void 0!==s&&(i.minLength=s),void 0!==o&&(i.maxLength=o),a?1===a.length?(i.contentMediaType=a[0],Object.assign(n,i)):(Object.assign(n,i),n.anyOf=a.map(e=>({contentMediaType:e}))):Object.assign(n,i)})(e,0,r),e.min=(t,r)=>e.check(JL(t,r)),e.max=(t,r)=>e.check(WL(t,r)),e.mime=(t,r)=>e.check(aF(Array.isArray(t)?t:[t],r))});function ez(e){return function(e,t){return new e({type:"file",...wO(t)})}(Xj,e)}const tz=Wx("ZodTransform",(e,t)=>{KB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("Transforms cannot be represented in JSON Schema")})(0,e),e._zod.parse=(r,n)=>{if("backward"===n.direction)throw new Zx(e.constructor.name);r.addIssue=n=>{if("string"==typeof n)r.issues.push(_O(n,r.value,t));else{const t=n;t.fatal&&(t.continue=!1),t.code??(t.code="custom"),t.input??(t.input=r.value),t.inst??(t.inst=e),r.issues.push(_O(t))}};const i=t.transform(r.value,r);return i instanceof Promise?i.then(e=>(r.value=e,r)):(r.value=i,r)}});function rz(e){return new tz({type:"transform",transform:e})}const nz=Wx("ZodOptional",(e,t)=>{$B.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>SF(e,t,0,n),e.unwrap=()=>e._zod.def.innerType});function iz(e){return new nz({type:"optional",innerType:e})}const sz=Wx("ZodExactOptional",(e,t)=>{VB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>SF(e,t,0,n),e.unwrap=()=>e._zod.def.innerType});function oz(e){return new sz({type:"optional",innerType:e})}const az=Wx("ZodNullable",(e,t)=>{HB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.def,s=mF(i.innerType,t,n),o=t.seen.get(e);"openapi-3.0"===t.target?(o.ref=i.innerType,r.nullable=!0):r.anyOf=[s,{type:"null"}]})(e,t,r,n),e.unwrap=()=>e._zod.def.innerType});function cz(e){return new az({type:"nullable",innerType:e})}function uz(e){return iz(cz(e))}const lz=Wx("ZodDefault",(e,t)=>{WB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.def;mF(i.innerType,t,n),t.seen.get(e).ref=i.innerType,r.default=JSON.parse(JSON.stringify(i.defaultValue))})(e,t,r,n),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function dz(e,t){return new lz({type:"default",innerType:e,get defaultValue(){return"function"==typeof t?t():pO(t)}})}const hz=Wx("ZodPrefault",(e,t)=>{ZB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.def;mF(i.innerType,t,n),t.seen.get(e).ref=i.innerType,"input"===t.io&&(r._prefault=JSON.parse(JSON.stringify(i.defaultValue)))})(e,t,r,n),e.unwrap=()=>e._zod.def.innerType});function fz(e,t){return new hz({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof t?t():pO(t)}})}const pz=Wx("ZodNonOptional",(e,t)=>{QB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.def;mF(i.innerType,t,n),t.seen.get(e).ref=i.innerType})(e,t,0,n),e.unwrap=()=>e._zod.def.innerType});function gz(e,t){return new pz({type:"nonoptional",innerType:e,...wO(t)})}const mz=Wx("ZodSuccess",(e,t)=>{XB.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t,r)=>{r.type="boolean"})(0,0,t),e.unwrap=()=>e._zod.def.innerType});function yz(e){return new mz({type:"success",innerType:e})}const bz=Wx("ZodCatch",(e,t)=>{eL.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.def;let s;mF(i.innerType,t,n),t.seen.get(e).ref=i.innerType;try{s=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=s})(e,t,r,n),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function wz(e,t){return new bz({type:"catch",innerType:e,catchValue:"function"==typeof t?t:()=>t})}const vz=Wx("ZodNaN",(e,t)=>{tL.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("NaN cannot be represented in JSON Schema")})(0,e)});function Ez(e){return function(e,t){return new e({type:"nan",...wO(t)})}(vz,e)}const Az=Wx("ZodPipe",(e,t)=>{rL.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.def,s="input"===t.io?"transform"===i.in._zod.def.type?i.out:i.in:i.out;mF(s,t,n),t.seen.get(e).ref=s})(e,t,0,n),e.in=t.in,e.out=t.out});function Sz(e,t){return new Az({type:"pipe",in:e,out:t})}const kz=Wx("ZodCodec",(e,t)=>{Az.init(e,t),iL.init(e,t)});function Rz(e,t,r){return new kz({type:"pipe",in:e,out:t,transform:r.decode,reverseTransform:r.encode})}const Pz=Wx("ZodReadonly",(e,t)=>{aL.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.def;mF(i.innerType,t,n),t.seen.get(e).ref=i.innerType,r.readOnly=!0})(e,t,r,n),e.unwrap=()=>e._zod.def.innerType});function Iz(e){return new Pz({type:"readonly",innerType:e})}const Cz=Wx("ZodTemplateLiteral",(e,t)=>{uL.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r)=>{const n=r,i=e._zod.pattern;if(!i)throw new Error("Pattern not found in template literal");n.type="string",n.pattern=i.source})(e,0,r)});function _z(e,t){return new Cz({type:"template_literal",parts:e,...wO(t)})}const Tz=Wx("ZodLazy",(e,t)=>{hL.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.innerType;mF(i,t,n),t.seen.get(e).ref=i})(e,t,0,n),e.unwrap=()=>e._zod.def.getter()});function Nz(e){return new Tz({type:"lazy",getter:e})}const xz=Wx("ZodPromise",(e,t)=>{dL.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{const i=e._zod.def;mF(i.innerType,t,n),t.seen.get(e).ref=i.innerType})(e,t,0,n),e.unwrap=()=>e._zod.def.innerType});function Oz(e){return new xz({type:"promise",innerType:e})}const Dz=Wx("ZodFunction",(e,t)=>{lL.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("Function types cannot be represented in JSON Schema")})(0,e)});function Mz(e){return new Dz({type:"function",input:Array.isArray(e?.input)?Uj(e?.input):e?.input??kj(mj()),output:e?.output??mj()})}const Bz=Wx("ZodCustom",(e,t)=>{fL.init(e,t),VF.init(e,t),e._zod.processJSONSchema=(e,t,r)=>((e,t)=>{if("throw"===t.unrepresentable)throw new Error("Custom types cannot be represented in JSON Schema")})(0,e)});function Lz(e){const t=new iM({check:"custom"});return t._zod.check=e,t}function Fz(e,t){return function(e,t,r){const n=wO(r);return n.abort??(n.abort=!0),new e({type:"custom",check:"custom",fn:t,...n})}(Bz,e??(()=>!0),t)}function Uz(e,t={}){return function(e,t,r){return new e({type:"custom",check:"custom",fn:t,...wO(r)})}(Bz,e,t)}function jz(e){return function(e){const t=function(e){const t=new iM({check:"custom",...wO(void 0)});return t._zod.check=e,t}(r=>(r.addIssue=e=>{if("string"==typeof e)r.issues.push(_O(e,r.value,t._zod.def));else{const n=e;n.fatal&&(n.continue=!1),n.code??(n.code="custom"),n.input??(n.input=r.value),n.inst??(n.inst=t),n.continue??(n.continue=!t._zod.def.abort),r.issues.push(_O(n))}},e(r.value,r)));return t}(e)}const zz=function(e){const t=new iM({check:"describe"});return t._zod.onattach=[t=>{const r=mL.get(t)??{};mL.add(t,{...r,description:e})}],t._zod.check=()=>{},t},qz=function(e){const t=new iM({check:"meta"});return t._zod.onattach=[t=>{const r=mL.get(t)??{};mL.add(t,{...r,...e})}],t._zod.check=()=>{},t};function Kz(e,t={}){const r=new Bz({type:"custom",check:"custom",fn:t=>t instanceof e,abort:!0,...wO(t)});return r._zod.bag.Class=e,r._zod.check=t=>{t.value instanceof e||t.issues.push({code:"invalid_type",expected:e.name,input:t.value,inst:r,path:[...r._zod.def.path??[]]})},r}const Gz=(...e)=>function(e,t){const r=wO(t);let n=r.truthy??["true","1","yes","on","y","enabled"],i=r.falsy??["false","0","no","off","n","disabled"];"sensitive"!==r.case&&(n=n.map(e=>"string"==typeof e?e.toLowerCase():e),i=i.map(e=>"string"==typeof e?e.toLowerCase():e));const s=new Set(n),o=new Set(i),a=e.Codec??iL,c=e.Boolean??aB,u=new a({type:"pipe",in:new(e.String??NM)({type:"string",error:r.error}),out:new c({type:"boolean",error:r.error}),transform:(e,t)=>{let n=e;return"sensitive"!==r.case&&(n=n.toLowerCase()),!!s.has(n)||!o.has(n)&&(t.issues.push({code:"invalid_value",expected:"stringbool",values:[...s,...o],input:t.value,inst:u,continue:!1}),{})},reverseTransform:(e,t)=>!0===e?n[0]||"true":i[0]||"false",error:r.error});return u}({Codec:kz,Boolean:ej,String:WF},...e);function $z(e){const t=Nz(()=>Nj([JF(e),HU(),tj(),hj(),kj(t),zj(JF(),t)]));return t}function Vz(e,t){return Sz(rz(e),t)}var Hz,Wz;Hz||(Hz={}),new Set(["$schema","$ref","$defs","definitions","$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor","type","enum","const","anyOf","oneOf","allOf","not","properties","required","additionalProperties","patternProperties","propertyNames","minProperties","maxProperties","items","prefixItems","additionalItems","minItems","maxItems","uniqueItems","contains","minContains","maxContains","minLength","maxLength","pattern","format","minimum","maximum","exclusiveMinimum","exclusiveMaximum","multipleOf","description","default","contentEncoding","contentMediaType","contentSchema","unevaluatedItems","unevaluatedProperties","if","then","else","dependentSchemas","dependentRequired","nullable","readOnly"]),Yx({localeError:(()=>{const e={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"},map:{unit:"entries",verb:"to have"}};function t(t){return e[t]??null}const r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},n={nan:"NaN"};return e=>{switch(e.code){case"invalid_type":{const t=n[e.expected]??e.expected,r=function(e){const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"nan":"number";case"object":{if(null===e)return"null";if(Array.isArray(e))return"array";const t=e;if(t&&Object.getPrototypeOf(t)!==Object.prototype&&"constructor"in t&&t.constructor)return t.constructor.name}}return t}(e.input);return`Invalid input: expected ${t}, received ${n[r]??r}`}case"invalid_value":return 1===e.values.length?`Invalid input: expected ${vO(e.values[0])}`:`Invalid option: expected one of ${eO(e.values,"|")}`;case"too_big":{const r=e.inclusive?"<=":"<",n=t(e.origin);return n?`Too big: expected ${e.origin??"value"} to have ${r}${e.maximum.toString()} ${n.unit??"elements"}`:`Too big: expected ${e.origin??"value"} to be ${r}${e.maximum.toString()}`}case"too_small":{const r=e.inclusive?">=":">",n=t(e.origin);return n?`Too small: expected ${e.origin} to have ${r}${e.minimum.toString()} ${n.unit}`:`Too small: expected ${e.origin} to be ${r}${e.minimum.toString()}`}case"invalid_format":{const t=e;return"starts_with"===t.format?`Invalid string: must start with "${t.prefix}"`:"ends_with"===t.format?`Invalid string: must end with "${t.suffix}"`:"includes"===t.format?`Invalid string: must include "${t.includes}"`:"regex"===t.format?`Invalid string: must match pattern ${t.pattern}`:`Invalid ${r[t.format]??e.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${e.divisor}`;case"unrecognized_keys":return`Unrecognized key${e.keys.length>1?"s":""}: ${eO(e.keys,", ")}`;case"invalid_key":return`Invalid key in ${e.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${e.origin}`}}})()}),function(e){e.NODEJS="nodejs",e.BROWSER="browser"}(Wz||(Wz={}));const Jz="0x31546eEA76F2B2b3C5cC06B1c93601dc35c9D916",Zz=Symbol("Config");class Qz extends Error{code;messageId;constructor(e,t,r){super(`${e} ${Yz(t,r)}`),this.code=t,this.name=this.constructor.name,this.messageId=r?.messageId}}const Yz=(e,t)=>{const r=[];return r.push(`code=${e}`),void 0!==t&&r.push(`messageId=${Xz(t.messageId)}`),`(${r.join(", ")})`},Xz=e=>JSON.stringify(e),eq=Symbol("Identity");class tq{}const rq=new Ta("LoggingJsonRpcProvider");class nq extends Vb{urlConfig;constructor(e,t,r){super(e,t,r),this.urlConfig=e}async send(e,t){const r=qa(5),n=Date.now(),i={traceId:r,method:e,params:t,connection:{url:this.urlConfig.url,timeout:this.urlConfig.timeout}};let s;rq.debug("Send request",i);try{s=await super.send(e,t)}catch(e){throw rq.debug("Encountered error while requesting",{...i,err:e,elapsedTime:Date.now()-n}),e}return rq.debug("Received response",{...i,elapsedTime:Date.now()-n}),s}}var iq=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},sq=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},oq=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};function aq(e){return e.contracts.ethereumNetwork.chainId===QE.$.dev2.id}const cq=e=>({staticNetwork:!0,batchStallTime:aq(e)?0:void 0,cacheTimeout:aq(e)?-1:void 0});let uq=class{config;provider;subProviders;constructor(e){this.config=e}getProvider(){if(void 0===this.provider){const e=this.getSubProviders();this.provider=new ow(e,this.config.contracts.ethereumNetwork.chainId,{quorum:Math.min(this.config.contracts.rpcQuorum,this.config.contracts.rpcs.length),cacheTimeout:cq(this.config).cacheTimeout})}return this.provider}getSubProviders(){return this.subProviders??=this.config.contracts.rpcs.map(e=>{const t=new pp(e.url);t.retryFunc=async()=>!1,t.timeout=this.config._timeouts.jsonRpcTimeout;const r=cq(this.config);return new nq(t,this.config.contracts.ethereumNetwork.chainId,r)}),this.subProviders}};uq=iq([te(l.ContainerScoped),oq(0,X(Zz)),sq("design:paramtypes",[Object])],uq);const lq=async(e,t)=>{const r=t.contracts.ethereumNetwork,n=r.overrides??{};if(r.highGasPriceStrategy&&void 0===r.overrides?.gasPrice){const t=await e.getProvider().getFeeData(),r=e=>null===e.gasPrice?void 0:e.gasPrice*BigInt(130)/100n;return{...n,gasPrice:r(t)}}return n};var dq=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let hq=class extends Ya{};hq=dq([te(l.ContainerScoped)],hq);var fq=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},pq=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},gq=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let mq=class{config;constructor(e){this.config=e}createLogger(e){return new Ta(e,{id:this.config.id},this.config.logLevel)}};async function yq(e){return(await e).wait()}mq=fq([te(l.ContainerScoped),gq(0,X(Zz)),pq("design:paramtypes",[Object])],mq);const bq=async(e,t,r)=>{try{return await e()}catch(e){const n=Fr()(["reason","code"].map(t=>void 0!==e[t]?`${t}=${e[t]}`:void 0),void 0),i=new Error(`Error while ${r} contract call "${t}"${n.length>0?", "+n.join(", "):""}`);throw i.reason=e,i}},wq=(e,t,r,n)=>{const i=new zr,s=XE()(n),o={eventEmitter:i,getAddress:()=>e.getAddress(),on:(t,r)=>{e.on(t,r)},off:(t,r)=>{e.off(t,r)}},a=e.interface.fragments.filter(e=>Xd.isFunction(e)).map(e=>e.name);return a.forEach(r=>{o[r]=((e,t,r,n,i)=>{const s=e[r],o=`${t}.${r}`,a=async(...e)=>{const t=await bq(()=>i(()=>(n.emit("onMethodExecute",o),s(...e))),o,"executing");if((e=>void 0!==e.wait&&"function"==typeof e.wait)(t)){n.emit("onTransactionSubmit",o,t);const e=t.wait.bind(t);t.wait=async(t,i)=>{const s=await bq(()=>e(t,i),r,"waiting transaction for");return n.emit("onTransactionConfirm",o,s),s}}return t};return a.estimateGas=(...e)=>s.estimateGas(...e),a})(e,t,r,i,s)}),((e,t)=>{const r=t.createLogger("contract");e.on("onMethodExecute",e=>{r.debug("Execute method",{methodName:e})}),e.on("onTransactionSubmit",(e,t)=>{r.debug("Submit transaction",{method:e,tx:t.hash,to:t.to,nonce:t.nonce,gasLimit:t.gasLimit,gasPrice:t.gasPrice})}),e.on("onTransactionConfirm",(e,t)=>{r.debug("Received transaction confirmation",{method:e,tx:t?.hash,block:t?.blockNumber,confirmations:t?.confirmations,gasUsed:t?.gasUsed,events:t?.logs??[]})})})(i,r),o},vq=e=>{const t=e.loggerFactory.createLogger("contract");((t,r,n,i)=>{const s=i.getObserver(),o=e=>i.emit(t,e);let a;s.on("addEventListener",e=>{e===t&&void 0===a&&(a=r(o))}),s.on("removeEventListener",r=>{var n;r===t&&void 0!==a&&0===i.getListenerCount(t)&&(n=a,e.sourceEmitter.off({onEvent:n,...e.sourceDefinition}),a=void 0)}),i.getListenerCount(t)>0&&(a=r(o))})(e.targetName,r=>{const n=(n,i)=>{let s;try{s=e.transformation(n,i)}catch(r){return void t.error("Skip emit event",{eventName:e.targetName,reason:r?.message})}r(s)};return e.sourceEmitter.on({onEvent:n,...e.sourceDefinition}),n},0,e.targetEmitter)};var Eq=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Aq=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Sq=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let kq=class{config;eventEmitter;loggerFactory;constructor(e,t,r){this.config=e,this.eventEmitter=t,this.loggerFactory=r}createReadContract(e,t,r,n){return wq(new dg(e,t,r),n,this.loggerFactory,this.config.contracts.maxConcurrentCalls)}createWriteContract(e,t,r,n){const i=wq(new dg(e,t,r),n,this.loggerFactory,999999);return i.eventEmitter.on("onTransactionConfirm",(e,t)=>{this.eventEmitter.emit("contractTransactionConfirmed",{methodName:e,receipt:t})}),i}createEventContract(e,t,r){return new dg(e,t,r)}};kq=Eq([te(l.ContainerScoped),Sq(0,X(Zz)),Aq("design:paramtypes",[Object,hq,mq])],kq);var Rq=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Pq=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Iq=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let Cq=class{nodeRegistryContract;nodeRegistryContractReadonly;contractFactory;rpcProviderSource;config;identity;constructor(e,t,r,n){this.contractFactory=e,this.rpcProviderSource=t,this.config=r,this.identity=n,this.nodeRegistryContractReadonly=this.contractFactory.createReadContract(ts(this.config.contracts.storageNodeRegistryChainAddress),_c.NodeRegistryABI,t.getProvider(),"storageNodeRegistry")}async connectToContract(){if(void 0===this.nodeRegistryContract){const e=await this.identity.getTransactionSigner(this.rpcProviderSource);this.nodeRegistryContract=this.contractFactory.createWriteContract(ts(this.config.contracts.storageNodeRegistryChainAddress),_c.NodeRegistryABI,e,"storageNodeRegistry")}}async setStorageNodeMetadata(e){await this.connectToContract();const t=await lq(this.rpcProviderSource,this.config);void 0!==e?await yq(this.nodeRegistryContract.createOrUpdateNodeSelf(JSON.stringify(e),t)):await yq(this.nodeRegistryContract.removeNodeSelf(t))}async getStorageNodeMetadata(e){const[t,r]=await this.nodeRegistryContractReadonly.getNode(e);if("0x0000000000000000000000000000000000000000"!==t)return JSON.parse(r);throw new Qz("Node not found, id: "+e,"NODE_NOT_FOUND")}};Cq=Rq([te(l.ContainerScoped),Iq(2,X(Zz)),Iq(3,X(eq)),Pq("design:paramtypes",[kq,uq,Object,tq])],Cq);class _q extends Error{code;constructor(e,t){super(e),this.code=t}}function Tq(e,t){if(void 0===t)throw new _q(`Expected ${e} to not be undefined.`)}function Nq(e,t,r=!1){if(!r||void 0!==t){if(Tq(e,t),!Number.isInteger(t))throw new _q(`Expected ${e} to be an integer but was a ${typeof t} (${t}).`);if(t<0)throw new _q(`Expected ${e} to not be negative (${t}).`)}}class xq{timestamp;sequenceNumber;constructor(e,t){Nq("timestamp",e),Nq("sequenceNumber",t,!0),this.timestamp=e,this.sequenceNumber=t}compareTo(e){return this.timestamp<e.timestamp?-1:this.timestamp>e.timestamp?1:this.sequenceNumber<e.sequenceNumber?-1:this.sequenceNumber>e.sequenceNumber?1:0}}class Oq{streamId;streamPartition;timestamp;sequenceNumber;publisherId;msgChainId;constructor(e,t,r,n,i,s){Nq("streamPartition",t),Nq("timestamp",r),Nq("sequenceNumber",n),this.streamId=e,this.streamPartition=t,this.timestamp=r,this.sequenceNumber=n,this.publisherId=i,this.msgChainId=s}getStreamPartID(){return pc(this.streamId,this.streamPartition)}toMessageRef(){return new xq(this.timestamp,this.sequenceNumber)}}var Dq;!function(e){e[e.MESSAGE=0]="MESSAGE",e[e.GROUP_KEY_REQUEST=1]="GROUP_KEY_REQUEST",e[e.GROUP_KEY_RESPONSE=2]="GROUP_KEY_RESPONSE"}(Dq||(Dq={}));class Mq{messageId;prevMsgRef;messageType;content;contentType;signature;signatureType;encryptionType;groupKeyId;newGroupKey;constructor({messageId:e,prevMsgRef:t,messageType:r=Dq.MESSAGE,content:n,contentType:i,signature:s,signatureType:o,encryptionType:a,groupKeyId:c,newGroupKey:u}){!function(e,t){if(void 0===t)return;const r=e.toMessageRef().compareTo(t);if(0===r)throw new _q(`prevMessageRef cannot be identical to current. Current: ${JSON.stringify(e.toMessageRef())} Previous: ${JSON.stringify(t)}`);if(r<0)throw new _q(`prevMessageRef must come before current. Current: ${JSON.stringify(e.toMessageRef())} Previous: ${JSON.stringify(t)}`)}(e,t),a===V_.AES&&Tq("groupKeyId",c),this.messageId=e,this.prevMsgRef=t,this.messageType=r,this.contentType=i,this.encryptionType=a,this.groupKeyId=c,this.newGroupKey=u,this.signature=s,this.signatureType=o,this.content=n}getStreamId(){return this.messageId.streamId}getStreamPartition(){return this.messageId.streamPartition}getStreamPartID(){return this.messageId.getStreamPartID()}getTimestamp(){return this.messageId.timestamp}getSequenceNumber(){return this.messageId.sequenceNumber}getPublisherId(){return this.messageId.publisherId}getMsgChainId(){return this.messageId.msgChainId}getMessageRef(){return new xq(this.getTimestamp(),this.getSequenceNumber())}getParsedContent(){if(this.encryptionType!==V_.NONE||this.contentType===$_.BINARY)return this.content;if(this.contentType!==$_.JSON)throw new Qz(`Unknown content type: ${this.contentType}`,"ASSERTION_FAILED",this);try{return JSON.parse(lo(this.content))}catch(e){throw new Qz(`Unable to parse JSON: ${e}`,"INVALID_MESSAGE_CONTENT",this)}}static isAESEncrypted(e){return e.encryptionType===V_.AES}}class Bq{static toProtobuf(e){const t={timestamp:e.getTimestamp(),sequenceNumber:e.getSequenceNumber(),streamId:e.getStreamId(),streamPartition:e.getStreamPartition(),publisherId:bc(e.getPublisherId()),messageChainId:e.getMsgChainId()};let r,n;if(e.prevMsgRef&&(r={timestamp:e.prevMsgRef.timestamp,sequenceNumber:e.prevMsgRef.sequenceNumber}),e.messageType===Dq.MESSAGE){let t;e.newGroupKey&&(t={id:e.newGroupKey.id,data:e.newGroupKey.data}),n={oneofKind:"contentMessage",contentMessage:{content:e.content,contentType:e.contentType,encryptionType:e.encryptionType,groupKeyId:e.groupKeyId??void 0,newGroupKey:t}}}else if(e.messageType===Dq.GROUP_KEY_REQUEST)n={oneofKind:"groupKeyRequest",groupKeyRequest:eT.fromBinary(e.content)};else{if(e.messageType!==Dq.GROUP_KEY_RESPONSE)throw new Error("invalid message type");n={oneofKind:"groupKeyResponse",groupKeyResponse:tT.fromBinary(e.content)}}return{messageId:t,previousMessageRef:r,signature:e.signature,signatureType:e.signatureType,body:n}}static toClientProtocol(e){let t,r,n,i,s=$_.BINARY,o=V_.NONE;if("contentMessage"===e.body.oneofKind)t=Dq.MESSAGE,r=e.body.contentMessage.content,s=e.body.contentMessage.contentType,o=e.body.contentMessage.encryptionType,n=e.body.contentMessage.newGroupKey,i=e.body.contentMessage.groupKeyId;else if("groupKeyRequest"===e.body.oneofKind){t=Dq.GROUP_KEY_REQUEST;try{r=eT.toBinary(e.body.groupKeyRequest)}catch(e){throw new Error(`invalid group key request: ${e}`)}}else{if("groupKeyResponse"!==e.body.oneofKind)throw new Error("invalid message type");t=Dq.GROUP_KEY_RESPONSE;try{r=tT.toBinary(e.body.groupKeyResponse)}catch(e){throw new Error(`invalid group key response: ${e}`)}}const a=new Oq(e.messageId.streamId,e.messageId.streamPartition,Number(e.messageId.timestamp),e.messageId.sequenceNumber,yc(e.messageId.publisherId),e.messageId.messageChainId);let c;return e.previousMessageRef&&(c=new xq(Number(e.previousMessageRef.timestamp),e.previousMessageRef.sequenceNumber)),new Mq({messageId:a,prevMsgRef:c,messageType:t,content:r,contentType:s,signature:e.signature,signatureType:e.signatureType,encryptionType:o,groupKeyId:i,newGroupKey:n})}}async function*Lq(e,t,r){let n=0;for await(const r of e){try{await t(r,n,e)}catch(e){throw e}finally{n+=1}yield r}}async function*Fq(e,t,r){let n=0;for await(const r of e)try{yield await t(r,n,e)}catch(e){throw e}finally{n+=1}}async function*Uq(e,t,r){let n=0;for await(const i of e){let s;try{s=await t(i,n,e)}catch(e){if(r){await r(e,i);continue}throw e}finally{n+=1}s&&(yield i)}}class jq{isLocked=!1;pending;open(){this.isLocked||this.clearPending()}lock(){this.isLocked||(this.isLocked=!0,this.clearPending())}error(e){this.isLocked||this.clearPending(e)}close(){this.isLocked||(this.pending??=new Yi)}setOpenState(e){e?this.open():this.close()}isOpen(){return!this.isLocked&&!this.pending}clearPending(e){const{pending:t}=this;t&&(this.pending=void 0,e?t.reject(e):t.resolve(void 0))}async check(){return this.pending&&await this.pending,!this.isLocked}}function zq(e){return!!e&&(e instanceof Error||!(!e?.stack||!e.message||"string"!=typeof e.stack||"string"!=typeof e.message))}class qq{buffer=[];bufferSize;writeGate;readGate;error;iterator;isIterating=!1;constructor(e=256){if(!(e>0&&Number.isSafeInteger(e)))throw new Qz(`bufferSize must be a safe positive integer, got: ${e}`,"INVALID_ARGUMENT");this.bufferSize=e,this.writeGate=new jq,this.readGate=new jq,this.writeGate.close(),this.readGate.close(),this.iterator=this.iterate()}async push(e){return!!this.isWritable()&&(this.buffer.push(e),this.updateWriteGate(),this.readGate.open(),this.writeGate.check())}updateWriteGate(){this.writeGate.setOpenState(!this.isFull())}end(e){e&&(this.error=e),this.lock()}lock(){this.writeGate.lock(),this.readGate.lock()}endWrite(e){e&&!this.error&&(this.error=e),this.readGate.open(),this.writeGate.lock()}isFull(){return this.buffer.length>=this.bufferSize}isDone(){return this.writeGate.isLocked&&this.readGate.isLocked}isWritable(){return!this.writeGate.isLocked&&!this.readGate.isLocked}async*iterate(){this.isIterating=!0;try{for(;!this.readGate.isLocked;){for(;this.buffer.length&&!this.readGate.isLocked;){const e=this.buffer.shift();if(this.updateWriteGate(),zq(e))throw e;yield e}if(0===this.buffer.length&&this.writeGate.isLocked)break;if(this.isDone())break;if(this.readGate.close(),!await this.readGate.check())break}const{error:e}=this;if(e)throw this.error=void 0,e}finally{this.buffer=[],this.lock()}}get length(){return this.buffer.length}clear(){this.buffer=[]}async throw(e){return this.endWrite(e),this.iterator.throw(e)}async return(e){return this.end(),this.iterator.return(e)}next(){return this.iterator.next()}[Symbol.asyncIterator](){if(this.isIterating)throw new this.constructor.Error(this,"already iterating");return this}async[Symbol.asyncDispose](){this.end()}}let Kq;function Gq(e=""){return void 0===Kq&&(Kq=hS()),zN()(`${Kq}${e?`-${e}`:""}`)}const $q=new Ta("sdk-utils"),Vq=((e,{maxPrefixes:t=256}={})=>{let r={},n=!1;const i=(i="ID",s="-")=>{if(r[i]=(r[i]+1||0)%Number.MAX_SAFE_INTEGER,!n){const e=Object.keys(r).length;e>t&&(n=!0,console.warn(`counterId should not be used for a large number of unique prefixes: ${e} > ${t}`))}return[e,i,r[i]].filter(e=>null!=e).join(s)};return i.clear=(...e)=>{if(e.length){const[t]=e;delete r[t]}else r={}},i})();class Hq{delegate;constructor(e){this.delegate=new Ek({maxSize:e,sizeCalculation:()=>1})}add(e){this.delegate.set(e,!0)}has(e){return this.delegate.has(e)}delete(e){this.delegate.delete(e)}}function Wq(e){const t=e.type===Wz.BROWSER?Xk.BROWSER:Xk.NODEJS,r={...e,nodeId:Ok(e.nodeId??e.id),type:t,websocket:e.websocket};return void 0!==r.id&&delete r.id,r}function Jq(e){return{nodeId:xk(e.nodeId),type:e.type===Xk.NODEJS?Wz.NODEJS:Wz.BROWSER,websocket:e.websocket,region:e.region}}const Zq=e=>Array.isArray(e)?e.map(e=>e.toString()).join("|"):e.toString();class Qq extends Error{response;constructor(e){super(`Fetch error, url=${e.url}`),this.response=e}}function Yq(e,t=1){const r=XE()(t);return Object.assign((...t)=>r(()=>e(...t)),{clear(){r.clearQueue()}})}function Xq(e){let t={status:"init"};return Object.assign(async function(...r){const n=t;if("pending"===n.status)return n.promise;if("fulfilled"===n.status)return n.value;if("rejected"===n.status)throw n.reason;t=n;const i=(async()=>{try{const t=await e(...r);return Object.assign(n,{promise:void 0,status:"fulfilled",value:t}),t}catch(e){throw Object.assign(n,{promise:void 0,status:"rejected",reason:e}),e}})();return i.catch(()=>{}),Object.assign(n,{status:"pending",promise:i}),i},{isStarted:()=>"init"!==t.status,reset(){t={status:"init"}}})}var eK;!function(e){e.ONCE="ONCE",e.ONE="ONE",e.QUEUE="QUEUE",e.PARALLEL="PARALLEL"}(eK||(eK={}));class tK{static TRIGGER_TYPE=eK;static create(e=eK.PARALLEL){return new this(e)}static once(){return this.create(eK.ONCE)}static one(){return this.create(eK.ONE)}static queue(){return this.create(eK.QUEUE)}static parallel(){return this.create(eK.PARALLEL)}listeners=[];isEnded=!1;triggerCountValue=0;triggerType;constructor(e=eK.PARALLEL){switch(this.triggerType=e,this.trigger=Function.prototype.bind.call(this.trigger,this),e){case eK.ONCE:this.trigger=Xq(this.trigger);break;case eK.QUEUE:this.trigger=Yq(this.trigger);break;case eK.ONE:this.trigger=function(e){const t=Xq(e);return async(...e)=>{try{return await t(...e)}finally{t.reset()}}}(this.trigger);break;case eK.PARALLEL:break;default:throw new Error(`unknown trigger type: ${e}`)}}triggerCount(){return this.triggerCountValue}lastValue;end=(...e)=>{this.lastValue=e,this.isEnded=!0};wait(){return new Promise(e=>{this.once((...t)=>e(t[0]))})}async getLastValue(){if(this.currentTask&&await this.currentTask,!this.lastValue)throw new Error("Signal ended with no value");return this.lastValue}listen(e){return e?this.isEnded?(this.getLastValue().then(t=>e(...t)).catch(()=>{}),this):(this.listeners.push(e),this):new Promise(e=>{this.once((...t)=>{e(t[0])})})}once(e){if(!e)return this.listen();const t=Object.assign((...t)=>(this.unlisten(e),e(...t)),{listener:e});return this.listen(t)}countListeners(){return this.listeners.length}unlisten(e){const t=this.listeners.findIndex(t=>t===e||"listener"in t&&t.listener===e);return this.listeners.splice(t,1),this}async execTrigger(...e){if(this.isEnded)return;this.triggerCountValue+=1;const t=this.listeners.slice();this.triggerType===eK.ONCE&&(this.listeners=[],this.end(...e)),t.length&&await t.reduce(async(t,r)=>{await t,await r(...e)},Promise.resolve())}currentTask;async trigger(...e){const t=this.execTrigger(...e);this.currentTask=t;try{await this.currentTask}finally{this.currentTask===t&&(this.currentTask=void 0)}}async*[Symbol.asyncIterator](){for(;!this.isEnded;)yield await this.listen()}}class rK extends tK{seenErrors=new WeakSet;ignoredErrors=new WeakSet;minListeners=1;async execTrigger(...e){if(this.isEnded)return;this.triggerCountValue+=1;const t=this.listeners.slice();this.triggerType===eK.ONCE&&(this.listeners=[],this.end(...e)),t.length&&await t.reduce(async(t,r)=>{try{await t}catch(e){return void await r(e)}await r(...e)},Promise.resolve())}async trigger(...e){const t=e[0];if(this.ignoredErrors.has(t))return;if(this.seenErrors.has(t))throw t;this.seenErrors.add(t);const r=!!(this.countListeners()>=this.minListeners);try{if(await super.trigger(...e),!r)throw t;this.ignoredErrors.add(t)}catch(e){throw this.seenErrors.add(e),e}}}class nK{source;transforms;constructor(e,t=[]){this.source=this.setSource(e),this.transforms=t}pipe(e){return this.transforms.push(e),this}clearTransforms(){this.transforms=[]}setSource(e){const t="id"in e?e.id:function(e,t=""){return Vq(e.constructor.name)+t}(e,"Source");return this.source=Object.assign(e,{id:t}),this.source}getTransforms(){return this.transforms}}class iK{source;iterator;isIterating=!1;isCleaningUp=!1;definition;constructor(e,t){this.source=e,this.definition=t??new nK(e),this.cleanup=Xq(this.cleanup.bind(this)),this.iterator=function(e,t){if(!t)return async function*(){yield*e}();let r,n,i=!1,s=!1,o=e=>(n??=Promise.resolve(t(e)).finally(()=>{o=()=>{}}),n);function a(e){return async(...t)=>{if(s=!0,i)return e(...t);try{return await e(...t)}catch(e){throw r??=e,e}finally{await o(r)}}}const c=async function*(){i=!0;try{yield*e}catch(e){throw r??=e,e}finally{await o(r)}}(),u=c[Symbol.asyncIterator].bind(c);let l;return l="cancel"in e?Object.assign(c,{cancel:t=>e.cancel(t),isCancelled:()=>e.isCancelled()}):c,Object.assign(l,{return:a(l.return.bind(l)),throw:a(l.throw.bind(l)),[Symbol.asyncIterator]:()=>s&&!i?async function*(){try{"return"in e&&await e.return(void 0)}finally{await o()}}():u()})}(this.iterate(),this.cleanup),this.handleError=this.handleError.bind(this)}pipe(e){if(this.isIterating)throw new Qz(`cannot pipe after already iterating: ${this.isIterating}`,"PIPELINE_ERROR");return this.definition.pipe(e),this}onFinally=tK.once();onBeforeFinally=tK.once();onMessage=tK.create();onError=rK.create();filter(e){return this.pipe(t=>Uq(t,e,this.onError.trigger))}flow(){return setImmediate(()=>{this.isIterating||async function(e,t=e=>e){(async e=>{for await(const t of e);})(Lq(e,t))}(this)}),this}async cleanup(e){this.isCleaningUp=!0;try{try{e&&await this.onError.trigger(e)}finally{await this.definition.source.return(void 0)}}finally{await this.onBeforeFinally.trigger(),await this.onFinally.trigger(e),this.definition.clearTransforms()}}async handleError(e){await this.onError.trigger(e)}async*iterate(){if(this.isIterating=!0,!this.definition.source)throw new Qz("no source","PIPELINE_ERROR");const e=this.definition.getTransforms().reduce((e,t)=>t(e),this.definition.source);try{for await(const t of e)await this.onMessage.trigger(t),yield t;this.isCleaningUp=!0}catch(e){this.isCleaningUp=!0,await this.handleError(e)}finally{this.isCleaningUp=!0,this.onBeforeFinally.triggerCount||await this.onBeforeFinally.trigger()}}async throw(e){if(this.isCleaningUp)throw e;return this.onBeforeFinally.triggerCount||await this.onBeforeFinally.trigger(),await this.definition.source.throw(e).catch(()=>{}),this.iterator.throw(e)}async return(e){return this.isCleaningUp?Promise.resolve({done:!0,value:e}):(this.onBeforeFinally.triggerCount||await this.onBeforeFinally.trigger(),await this.definition.source.return(void 0),this.iterator.return(e))}async next(){return this.iterator.next()}[Symbol.asyncIterator](){if(this.isIterating)throw new Qz("already iterating","PIPELINE_ERROR");return this}[Symbol.asyncDispose](){return this.cleanup()}}class sK extends iK{source;constructor(e=256){const t=new qq(e);super(t),this.source=t}pipe(e){return super.pipe(e),this}filter(e){return super.filter(e)}async push(e){return this.source.push(e)}async handleError(e){try{await this.onError.trigger(e)}catch(e){if(this.isCleaningUp)throw e;await this.push(e)}}end(e){this.source.end(e)}endWrite(e){this.source.endWrite(e)}isDone(){return this.source.isDone()}get length(){return this.source.length||0}clear(){this.source.clear()}}var oK=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},aK=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let cK=class{onDestroy=tK.once();trigger=this.destroy;abortSignal;constructor(){const e=new AbortController;this.abortSignal=e.signal,this.onDestroy.listen(()=>{e.abort()})}destroy(){return this.onDestroy.trigger()}assertNotDestroyed(){if(this.isDestroyed())throw new Qz("Client is destroyed. Create a new instance","CLIENT_DESTROYED")}isDestroyed(){return this.onDestroy.triggerCount()>0}};cK=oK([te(l.ContainerScoped),aK("design:paramtypes",[])],cK);var uK=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},lK=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},dK=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};function hK(e){const t=e;if(void 0!==t.id)return t.id;if(void 0!==t.stream)return t.stream;if(void 0!==t.streamId)return t.streamId;throw new Error('streamDefinition: object must have property: "id", "stream", or "streamId"')}let fK=class{identity;constructor(e){this.identity=e}async toStreamID(e){let t;return hc.isPathOnlyFormat(e)&&(t=ts(await this.identity.getUserId())),dc(e,t)}async toStreamPartID(e){const[t,r]=await this.toStreamPartElements(e);return pc(t,r??0)}async toStreamPartElements(e){const[t,r]=function(e){if("string"==typeof e)return gc.parseRawElements(e);if("object"==typeof e)return[hK(e),e.partition];throw new Error("streamDefinition: must be of type string or object")}(e);return[await this.toStreamID(t),r]}async getMatcher(e){const[t,r]=await this.toStreamPartElements(e);return e=>t===gc.getStreamID(e)&&(void 0===r||r===gc.getStreamPartition(e))}};fK=uK([te(l.ContainerScoped),dK(0,X(eq)),lK("design:paramtypes",[tq])],fK);const pK=e=>{try{return JSON.parse(e)}catch(e){return{}}},gK=e=>{const t=e.partitions;if(void 0!==t)try{!function(e){if(!Number.isSafeInteger(e)||e<0||e>100)throw new Error(`invalid streamPartition value: ${e}`)}(t)}catch{throw new Qz(`Invalid partition count: ${t}`,"INVALID_STREAM_METADATA")}return t??1};var mK;!function(e){e.EDIT="edit",e.DELETE="delete",e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.GRANT="grant"}(mK||(mK={}));const yK="0x0000000000000000000000000000000000000000",bK=e=>!0===e.public,wK=e=>"userId"in e?{...e,userId:yc(e.userId)}:e,vK=e=>{switch(e){case mK.EDIT:return 0n;case mK.DELETE:return 1n;case mK.PUBLISH:return 2n;case mK.SUBSCRIBE:return 3n;case mK.GRANT:return 4n}return 0n},EK=e=>{const t=Math.round(Date.now()/1e3),r=[];return e.canEdit&&r.push(mK.EDIT),e.canDelete&&r.push(mK.DELETE),e.publishExpiration>t&&r.push(mK.PUBLISH),e.subscribeExpiration>t&&r.push(mK.SUBSCRIBE),e.canGrant&&r.push(mK.GRANT),r};class AK{delegate;pendingPromises=new Map;opts;constructor(e){this.delegate="maxSize"in e?new Ek({maxSize:e.maxSize,sizeCalculation:()=>1,ttl:e.maxAge}):new Map,this.opts={isCacheableValue:()=>!0,...e}}async get(e){const t=Zq(e),r=this.pendingPromises.get(t);if(void 0!==r)return await r;{let r=this.delegate.get(t);if(void 0===r){const n=this.opts.valueFactory(e);let i;this.pendingPromises.set(t,n);try{i=await n}finally{this.pendingPromises.delete(t)}r={key:e,value:i},this.opts.isCacheableValue(i)&&this.delegate.set(t,r)}return r.value}}set(e,t){this.delegate.set(Zq(e),{key:e,value:t})}invalidate(e){for(const[t,r]of this.delegate.entries())e(r.key)&&this.delegate.delete(t)}*values(){for(const e of this.delegate.values())yield e.value}}const SK=e=>new AK(e),kK=e=>new AK(e);var RK=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},PK=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},IK=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let CK=class{listeners=[];providers;pollInterval;abortController;constructor(e,t){this.providers=e.getSubProviders(),this.pollInterval=t.contracts.pollInterval}on(e){const t=this.listeners.length>0;this.listeners.push(e),t||this.start()}off(e){const t=this.listeners.length>0;HN()(this.listeners,t=>t.contractAddress===e.contractAddress&&t.contractInterfaceFragment.topicHash===e.contractInterfaceFragment.topicHash&&t.onEvent==e.onEvent),t&&0===this.listeners.length&&this.abortController.abort()}start(){const e=new AbortController;this.abortController=e,setImmediate(async()=>{const t=new Ta("ChainEventPoller",{sessionId:qa(6)});let r;t.debug("Start polling",{pollInterval:this.pollInterval});do{try{r=await Cc()(this.providers).getBlockNumber()}catch(e){t.debug("Failed to query block number",{err:e}),await Ga(1e3)}}while(void 0===r);let n=0;await Ka(async()=>{const i=Cc()(this.providers),s=this.listeners.map(e=>e.contractInterfaceFragment.name);let o,a=0;try{if(n>=30&&(a=await i.getBlockNumber()+1,t.debug("Fetch next block number explicitly",{newFromBlock:a}),e.signal.aborted))return;t.debug("Polling",{fromBlock:r,eventNames:s});const c={address:JN()(this.listeners.map(e=>e.contractAddress)),topics:[JN()(this.listeners.map(e=>e.contractInterfaceFragment.topicHash))],fromBlock:r},u=await i.getLogs(c);o=[];for(const e of u){const t=this.listeners.find(t=>t.contractAddress===ts(e.address)&&t.contractInterfaceFragment.topicHash===e.topics[0]);if(void 0!==t){const r=new kp([t.contractInterfaceFragment.format("minimal")]).decodeEventLog(t.contractInterfaceFragment.name,e.data,e.topics);o.push({contractAddress:t.contractAddress,name:t.contractInterfaceFragment.name,args:r,blockNumber:e.blockNumber})}}t.debug("Polled",{fromBlock:r,events:o.length})}catch(e){t.debug("Failed to poll",{reason:e?.reason,eventNames:s,fromBlock:r})}if(!e.signal.aborted){if(void 0!==o&&o.length>0){for(const e of o){const t=this.listeners.filter(t=>t.contractAddress===e.contractAddress&&t.contractInterfaceFragment.name===e.name);for(const r of t)r.onEvent(e.args,e.blockNumber)}a=Math.max(...o.map(e=>e.blockNumber))+1}void 0!==o&&a>r?(t.debug("Forward fromBlock",{before:r,after:a}),r=a,n=0):n+=1}},this.pollInterval,!0,e.signal)})}};CK=RK([te(l.ContainerScoped),IK(1,X(Zz)),PK("design:paramtypes",[uq,Object])],CK);const _K=e=>e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),TK=e=>`"${e}"`,NK=e=>`{ ${e} }`,xK=(e,t,r)=>{const n=[];return e.includes(mK.EDIT)&&n.push("canEdit: true"),e.includes(mK.DELETE)&&n.push("canDelete: true"),e.includes(mK.PUBLISH)&&n.push(`publishExpiration_gt: "${r}"`),e.includes(mK.SUBSCRIBE)&&n.push(`subscribeExpiration_gt: "${r}"`),e.includes(mK.GRANT)&&n.push("canGrant: true"),`${t}: [${n.map(NK).join(", ")}]`};var OK,DK=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},MK=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},BK=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};const LK=e=>{for(const t of e){const e=[mK.EDIT,mK.DELETE,mK.GRANT],r=$N()(t.permissions,e);if(r.length>0){const e=e=>new Qz(`${e} is not supported for permission types: ${r.map(e=>e.toUpperCase()).join(", ")}`,"UNSUPPORTED_OPERATION");if(bK(t))throw e("Public permission");if(!vc(t.userId))throw e("Non-Ethereum user id")}}},FK=(e,t,r)=>{throw"CALL_EXCEPTION"===e.reason?.code?new Qz("Stream not found: id="+t,"STREAM_NOT_FOUND"):new Error(`Could not reach the ${r} Smart Contract: ${e.message}`)},UK=(e,t)=>{e.invalidate(e=>(Array.isArray(e)?e[0]:e)===t)};let jK=OK=class{streamRegistryContract;streamRegistryContractReadonly;contractFactory;rpcProviderSource;theGraphClient;streamIdBuilder;config;identity;logger;metadataCache;publisherCache;subscriberCache;publicSubscribePermissionCache;constructor(e,t,r,n,i,s,o,a,c){this.contractFactory=e,this.rpcProviderSource=t,this.theGraphClient=n,this.streamIdBuilder=i,this.config=s,this.identity=o,this.logger=c.createLogger("StreamRegistry"),this.streamRegistryContractReadonly=this.contractFactory.createReadContract(ts(this.config.contracts.streamRegistryChainAddress),_c.StreamRegistryABI,this.rpcProviderSource.getProvider(),"streamRegistry"),vq({sourceDefinition:{contractInterfaceFragment:new kp(_c.StreamRegistryABI).getEvent("StreamCreated"),contractAddress:ts(this.config.contracts.streamRegistryChainAddress)},sourceEmitter:r,targetName:"streamCreated",targetEmitter:a,transformation:([e,t],r)=>({streamId:dc(e),metadata:pK(t),blockNumber:r}),loggerFactory:c}),this.metadataCache=SK({valueFactory:e=>this.getStreamMetadata_nonCached(e),...s.cache}),this.publisherCache=SK({valueFactory:([e,t])=>this.isStreamPublisherOrSubscriber_nonCached(e,t,mK.PUBLISH),...s.cache}),this.subscriberCache=SK({valueFactory:([e,t])=>this.isStreamPublisherOrSubscriber_nonCached(e,t,mK.SUBSCRIBE),...s.cache}),this.publicSubscribePermissionCache=SK({valueFactory:e=>this.hasPermission({streamId:e,public:!0,permission:mK.SUBSCRIBE}),...s.cache})}async connectToContract(){if(void 0===this.streamRegistryContract){const e=await this.identity.getTransactionSigner(this.rpcProviderSource);this.streamRegistryContract=this.contractFactory.createWriteContract(ts(this.config.contracts.streamRegistryChainAddress),_c.StreamRegistryABI,e,"streamRegistry")}}async createStream(e,t){const r=await lq(this.rpcProviderSource,this.config),n=hc.getDomainAndPath(e);if(void 0===n)throw new Error(`stream id "${e}" not valid`);const[i,s]=n;if(await this.connectToContract(),function(e){return Xi(e)}(i)){await yq(this.streamRegistryContract.createStreamWithENS(i,s,JSON.stringify(t),r));try{await Qa(async()=>this.streamExistsOnChain(e),this.config._timeouts.ensStreamCreation.timeout,this.config._timeouts.ensStreamCreation.retryInterval)}catch{throw new Error(`unable to create stream "${e}"`)}}else await this.ensureStreamIdInNamespaceOfAuthenticatedUser(i,e),await yq(this.streamRegistryContract.createStream(s,JSON.stringify(t),r));this.populateMetadataCache(e,t)}async ensureStreamIdInNamespaceOfAuthenticatedUser(e,t){const r=ts(await this.identity.getUserId());if(e!==r)throw new Error(`stream id "${t}" not in namespace of authenticated user "${r}"`)}async setStreamMetadata(e,t){await this.connectToContract();const r=await lq(this.rpcProviderSource,this.config);await yq(this.streamRegistryContract.updateStreamMetadata(e,JSON.stringify(t),r)),this.populateMetadataCache(e,t)}async deleteStream(e){const t=await this.streamIdBuilder.toStreamID(e);await this.connectToContract();const r=await lq(this.rpcProviderSource,this.config);await yq(this.streamRegistryContract.deleteStream(t,r)),UK(this.metadataCache,t),this.invalidatePermissionCaches(t)}async streamExistsOnChain(e){const t=await this.streamIdBuilder.toStreamID(e);return this.logger.debug("Check if stream exists on chain",{streamId:t}),this.streamRegistryContractReadonly.exists(t)}async getStreamMetadata_nonCached(e){let t;try{t=await this.streamRegistryContractReadonly.getStreamMetadata(e)}catch(t){return FK(t,e,"StreamRegistry")}return pK(t)}async*searchStreams(e,t){const r=async function*(e,t,r){yield*r.queryEntities((r,n)=>((e,t,r,n)=>{const i=[];if(i.push(`id_gt: "${_K(r)}"`),void 0!==e&&i.push(`idAsString_contains: "${_K(e)}"`),void 0!==t){const e=[],r=[t.userId];t.allowPublic&&r.push(yK),e.push(`userId_in: [${r.map(TK).join(",")}]`);const n=Math.round(Date.now()/1e3);void 0!==t.allOf&&e.push(xK(t.allOf,"and",n));const s=t.anyOf??(void 0===t.allOf||0===t.allOf.length?Object.values(mK):void 0);void 0!==s&&e.push(xK(s,"or",n)),i.push(`permissions_: { and: [${e.map(NK).join(", ")}] }`)}return{query:`\n        query {\n            streams (\n                first: ${n}\n                orderBy: "id"\n                where: {\n                    ${i.join(", ")}\n                }\n            ) {\n                id\n                metadata\n            }\n        }`}})(e,t,r,n))}(e,t,this.theGraphClient);for await(const e of r){const t=dc(e.id);this.populateMetadataCache(t,pK(e.metadata)),yield t}}getStreamPublishers(e){return this.getStreamPublishersOrSubscribersList(e,"publishExpiration")}getStreamSubscribers(e){return this.getStreamPublishersOrSubscribersList(e,"subscribeExpiration")}async*getStreamPublishersOrSubscribersList(e,t){const r=await this.streamIdBuilder.toStreamID(e),n=Uq(this.theGraphClient.queryEntities((e,n)=>OK.buildStreamPublishersOrSubscribersQuery(r,t,e,n)),e=>null!==e.stream);yield*Fq(n,e=>yc(e.userId))}static buildStreamPublishersOrSubscribersQuery(e,t,r,n){return{query:`\n        {\n            streamPermissions (\n                first: ${n}\n                orderBy: "id"\n                where: {\n                    id_gt: "${r}"\n                    stream: "${e}"\n                    ${t}_gt: "${Math.round(Date.now()/1e3)}"\n                }\n            ) {\n                id\n                userId\n                stream {\n                    id\n                }\n            }\n        }`}}async hasPermission(e){if((e=>!0===e.public)(e)){const t=vK(e.permission);return this.streamRegistryContractReadonly.hasPublicPermission(e.streamId,t)}{const t=e.allowPublic?await this.streamRegistryContractReadonly.getPermissionsForUserId(e.streamId,e.userId):await this.streamRegistryContractReadonly.getDirectPermissionsForUserId(e.streamId,e.userId);return EK(t).includes(e.permission)}}async getPermissions(e){const t=await this.streamIdBuilder.toStreamID(e),r=await tc(this.theGraphClient.queryEntities((e,r)=>({query:`{\n                    stream (id: "${t}") {\n                        id\n                        metadata\n                        permissions(first: ${r} orderBy: "id" where: { id_gt: "${e}"}) {\n                            id\n                            userId\n                            canEdit\n                            canDelete\n                            publishExpiration\n                            subscribeExpiration\n                            canGrant\n                        }\n                    }\n                }`}),e=>{if(null!==e.stream)return e.stream.permissions;throw new Qz("Stream not found: id="+t,"STREAM_NOT_FOUND")})),n=[];return r.forEach(e=>{const t=EK(e);t.length>0&&(e.userId===yK?n.push({public:!0,permissions:t}):n.push({userId:yc(e.userId),permissions:t}))}),n}async grantPermissions(e,...t){LK(t);const r=await lq(this.rpcProviderSource,this.config);return this.updatePermissions(e,(e,t,n)=>void 0===t?this.streamRegistryContract.grantPublicPermission(e,n,r):this.streamRegistryContract.grantPermissionForUserId(e,t,n,r),...t)}async revokePermissions(e,...t){LK(t);const r=await lq(this.rpcProviderSource,this.config);return this.updatePermissions(e,(e,t,n)=>void 0===t?this.streamRegistryContract.revokePublicPermission(e,n,r):this.streamRegistryContract.revokePermissionForUserId(e,t,n,r),...t)}async updatePermissions(e,t,...r){const n=await this.streamIdBuilder.toStreamID(e);this.invalidatePermissionCaches(n),await this.connectToContract();for(const e of r)for(const r of e.permissions){const i=vK(r),s=t(n,bK(e)?void 0:e.userId,i);await yq(s)}}async setPermissions(...e){const t=[],r=[],n=[];for(const i of e){LK(i.assignments);const e=await this.streamIdBuilder.toStreamID(i.streamId);this.invalidatePermissionCaches(e),t.push(e),r.push(i.assignments.map(e=>bK(e)?yK:e.userId)),n.push(i.assignments.map(e=>{return{canEdit:(t=e.permissions).includes(mK.EDIT),canDelete:t.includes(mK.DELETE),publishExpiration:t.includes(mK.PUBLISH)?uw:0n,subscribeExpiration:t.includes(mK.SUBSCRIBE)?uw:0n,canGrant:t.includes(mK.GRANT)};var t}))}await this.connectToContract();const i=await lq(this.rpcProviderSource,this.config),s=this.streamRegistryContract.setMultipleStreamPermissionsForUserIds(t,r,n,i);await yq(s)}async isStreamPublisherOrSubscriber_nonCached(e,t,r){try{return await this.hasPermission({streamId:e,userId:t,permission:r,allowPublic:!0})}catch(t){return FK(t,e,"StreamPermission")}}getStreamMetadata(e){return this.metadataCache.get(e)}isStreamPublisher(e,t){return this.publisherCache.get([e,t])}isStreamSubscriber(e,t){return this.subscriberCache.get([e,t])}hasPublicSubscribePermission(e){return this.publicSubscribePermissionCache.get(e)}populateMetadataCache(e,t){this.metadataCache.set(e,t)}invalidatePermissionCaches(e){this.logger.trace("Clear permission caches for stream",{streamId:e}),UK(this.publisherCache,e),UK(this.subscriberCache,e)}};jK=OK=DK([te(l.ContainerScoped),BK(5,X(Zz)),BK(6,X(eq)),MK("design:paramtypes",[kq,uq,CK,nc,fK,Object,tq,hq,mq])],jK);var zK=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},qK=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},KK=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};const GK=Symbol("GET_ALL_STORAGE_NODES");let $K=class{streamStorageRegistryContract;streamStorageRegistryContractReadonly;streamIdBuilder;contractFactory;rpcProviderSource;theGraphClient;config;identity;logger;storageNodesCache;constructor(e,t,r,n,i,s,o,a,c){this.streamIdBuilder=e,this.contractFactory=t,this.rpcProviderSource=r,this.theGraphClient=i,this.config=s,this.identity=o,this.logger=c.createLogger("StreamStorageRegistry"),this.streamStorageRegistryContractReadonly=this.contractFactory.createReadContract(ts(this.config.contracts.streamStorageRegistryChainAddress),_c.StreamStorageRegistryABI,r.getProvider(),"streamStorageRegistry"),this.initStreamAssignmentEventListeners(a,n,c),this.storageNodesCache=SK({valueFactory:e=>this.getStorageNodes_nonCached(e),...s.cache})}initStreamAssignmentEventListeners(e,t,r){const n=([e,t],r)=>({streamId:dc(e),nodeAddress:ts(t),blockNumber:r}),i=ts(this.config.contracts.streamStorageRegistryChainAddress),s=new kp(_c.StreamStorageRegistryABI);vq({sourceDefinition:{contractInterfaceFragment:s.getEvent("Added"),contractAddress:i},sourceEmitter:t,targetName:"streamAddedToStorageNode",targetEmitter:e,transformation:n,loggerFactory:r}),vq({sourceDefinition:{contractInterfaceFragment:s.getEvent("Removed"),contractAddress:i},sourceEmitter:t,targetName:"streamRemovedFromStorageNode",targetEmitter:e,transformation:n,loggerFactory:r})}async connectToContract(){if(!this.streamStorageRegistryContract){const e=await this.identity.getTransactionSigner(this.rpcProviderSource);this.streamStorageRegistryContract=this.contractFactory.createWriteContract(ts(this.config.contracts.streamStorageRegistryChainAddress),_c.StreamStorageRegistryABI,e,"streamStorageRegistry")}}async addStreamToStorageNode(e,t){const r=await this.streamIdBuilder.toStreamID(e);this.logger.debug("Add stream to storage node",{streamId:r,nodeAddress:t}),await this.connectToContract();const n=await lq(this.rpcProviderSource,this.config);await yq(this.streamStorageRegistryContract.addStorageNode(r,t,n)),this.storageNodesCache.invalidate(e=>e===r)}async removeStreamFromStorageNode(e,t){const r=await this.streamIdBuilder.toStreamID(e);this.logger.debug("Remove stream from storage node",{streamId:r,nodeAddress:t}),await this.connectToContract();const n=await lq(this.rpcProviderSource,this.config);await yq(this.streamStorageRegistryContract.removeStorageNode(r,t,n)),this.storageNodesCache.invalidate(e=>e===r)}async isStoredStream(e,t){const r=await this.streamIdBuilder.toStreamID(e);return this.logger.debug("Check if stream is stored in storage node",{streamId:r,nodeAddress:t}),await this.streamStorageRegistryContractReadonly.isStorageNodeOf(r,t)}async getStoredStreams(e){this.logger.debug("Get stored streams of storage node",{nodeAddress:e});const t=[];return{streams:(await tc(this.theGraphClient.queryEntities((t,r)=>({query:`{\n                    node (id: "${e}") {\n                        id\n                        metadata\n                        lastSeen\n                        storedStreams (first: ${r} orderBy: "id" where: { id_gt: "${t}"}) {\n                            id,\n                            metadata\n                        }\n                    }\n                    _meta {\n                        block {\n                            number\n                        }\n                    }\n                }`}),e=>(t.push(e._meta.block.number),null!==e.node?e.node.storedStreams:[])))).map(e=>({id:dc(e.id),metadata:pK(e.metadata)})),blockNumber:QN()(t)}}async getStorageNodes(e){const t=void 0!==e?await this.streamIdBuilder.toStreamID(e):GK;return this.storageNodesCache.get(t)}async getStorageNodes_nonCached(e){let t;if(e!==GK){const r=e;this.logger.debug("Get storage nodes of stream",{streamId:r}),t=await tc(this.theGraphClient.queryEntities((e,t)=>({query:`{\n                        stream (id: "${r}") {\n                            id\n                            metadata\n                            storageNodes (first: ${t} orderBy: "id" where: { id_gt: "${e}"}) {\n                                id\n                                metadata\n                                lastSeen\n                            }\n                        }\n                    }`}),e=>null!==e.stream?e.stream.storageNodes:[]))}else this.logger.debug("Get all storage nodes"),t=await tc(this.theGraphClient.queryEntities((e,t)=>({query:`{\n                        nodes (first: ${t} orderBy: "id" where: { id_gt: "${e}"}) {\n                            id\n                            metadata\n                            lastSeen\n                        }\n                    }`})));return t.map(e=>ts(e.id))}};$K=zK([te(l.ContainerScoped),KK(5,X(Zz)),KK(6,X(eq)),qK("design:paramtypes",[fK,kq,uq,CK,nc,Object,tq,hq,mq])],$K);const VK=Buffer.from("streamr-key-exchange"),HK=1568;class WK{static async encryptForPublicKey(e,t,r){if(r===H_.ML_KEM)return this.encryptWithMLKEMPublicKey(e,t);if(r===H_.RSA)return this.encryptWithRSAPublicKey(e,t);throw new Error(`Unexpected encryption type: ${r}`)}static async decryptWithPrivateKey(e,t,r){if(r===H_.ML_KEM)return this.decryptWithMLKEMPrivateKey(e,t);if(r===H_.RSA)return this.decryptWithRSAPrivateKey(e,t);throw new Error(`Unexpected encryption type: ${r}`)}static toRSAPublicKeyString(e){const t=lo(e);if(!t.startsWith("-----BEGIN PUBLIC KEY-----")||!t.endsWith("-----END PUBLIC KEY-----\n"))throw new Error('"publicKey" must be an RSA public key (SPKI) in PEM format, encoded in UTF-8');return t}static toRSAPrivateKeyString(e){const t=lo(e);if(!t.startsWith("-----BEGIN PRIVATE KEY-----")||!t.endsWith("-----END PRIVATE KEY-----\n"))throw new Error('"privateKey" must be a PKCS#8 RSA private key in PEM format, encoded in UTF-8');return t}static encryptWithRSAPublicKey(e,t){const r=function(e,t){return Aa.publicEncrypt(e,t)}(this.toRSAPublicKeyString(t),e);return r}static decryptWithRSAPrivateKey(e,t){return function(e,t){return Aa.privateDecrypt(e,t)}(this.toRSAPrivateKeyString(t),e)}static async deriveAESWrapperKey(e,t){const r=Sa(),n=await r.importKey("raw",e,{name:"HKDF"},!1,["deriveKey"]),i=await r.deriveKey({name:"HKDF",hash:"SHA-512",salt:t,info:VK},n,{name:"AES-CTR",length:256},!0,["encrypt","decrypt"]),s=await r.exportKey("raw",i);return new Uint8Array(s)}static async encryptWithMLKEMPublicKey(e,t){const{cipherText:r,sharedSecret:n}=dx.encapsulate(t);if(r.length!==HK)throw new Error(`Expected KEM cipher to be 1568, but it was ${r.length} bytes`);const i=Er(64),s=await this.deriveAESWrapperKey(n,i),o=this.encryptWithAES(e,Buffer.from(s));return Buffer.concat([r,i,o])}static async decryptWithMLKEMPrivateKey(e,t){let r=0;const n=e.slice(0,HK);r+=HK;const i=e.slice(r,r+64);r+=64;const s=e.slice(r),o=dx.decapsulate(n,t),a=await this.deriveAESWrapperKey(o,i);return this.decryptWithAES(s,Buffer.from(a))}static encryptWithAES(e,t){const r=Er(16),n=function(e,t,r){const n=e.toLowerCase();if(uo[n])return co.createCipheriv(n,t,r);throw new TypeError(`Invalid suite type.  In browser only AES is supported but got ${e}.`)}("aes-256-ctr",t,r);return Buffer.concat([r,n.update(e),n.final()])}static decryptWithAES(e,t){const r=function(e,t,r){const n=e.toLowerCase();if(uo[n])return co.createDecipheriv(n,t,r);throw new TypeError(`Invalid suite type.  In browser only AES is supported but got ${e}.`)}("aes-256-ctr",t,e.slice(0,16));return Buffer.concat([r.update(e.slice(16)),r.final()])}static decryptStreamMessage(e,t){let r,n;try{r=this.decryptWithAES(e.content,t.data)}catch{throw new Qz("AES decryption failed","DECRYPT_ERROR",e)}if(e.newGroupKey)try{n=t.decryptNextGroupKey(e.newGroupKey)}catch{throw new Qz("Could not decrypt new encryption key","DECRYPT_ERROR",e)}return[r,n]}}class JK extends Error{groupKey;constructor(e,t){super(e),this.groupKey=t}}class ZK{id;data;constructor(e,t){if(this.id=e,!e)throw new JK(`groupKeyId must not be falsey ${e}`);if(!t)throw new JK(`groupKeyBufferOrHexString must not be falsey ${t}`);this.data=t,ZK.validate(this)}static validate(e){if(!e)throw new JK(`value must be a ${this.name}: ${e}`,e);if(!(e instanceof this))throw new JK(`value must be a ${this.name}: ${e}`,e);if(!e.id||"string"!=typeof e.id)throw new JK(`${this.name} id must be a string: ${e}`,e);if(e.id.includes("---BEGIN"))throw new JK(`${this.name} public/private key is not a valid group key id: ${e}`,e);if(!e.data||!Buffer.isBuffer(e.data))throw new JK(`${this.name} data must be a Buffer: ${e}`,e);if(32!==e.data.length)throw new JK("Group key must have a size of 256 bits, not "+8*e.data.length,e)}static generate(e=Gq("GroupKey")){const t=Er(32);return new ZK(e,Buffer.from(t))}encryptNextGroupKey(e){return{id:e.id,data:WK.encryptWithAES(e.data,this.data)}}decryptNextGroupKey(e){return new ZK(e.id,WK.decryptWithAES(e.data,this.data))}}class QK{db;static async createInstance(e){const t=await function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=Ex(o);return n&&o.addEventListener("upgradeneeded",e=>{n(Ex(o.result),e.oldVersion,e.newVersion,Ex(o.transaction),e)}),r&&o.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}(`streamr-sdk::${e.ownerId}`,1,{upgrade(t){e.namespaces.forEach(e=>t.createObjectStore(e))}});return new QK(t)}constructor(e){this.db=e}async exists(){throw new Error("Method not implemented in browser Persistence.")}async get(e,t){return this.db.get(t,e)}async set(e,t,r){await this.db.put(r,t,e)}async close(){}}var YK=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},XK=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},eG=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};const tG={ENCRYPTION_KEYS:"EncryptionKeys",LATEST_ENCRYPTION_KEY_IDS:"LatestEncryptionKeyIds"};let rG=class{persistence;identity;loggerFactory;constructor(e,t,r){this.identity=e,this.loggerFactory=r,t.onDestroy.listen(()=>{if(void 0!==this.persistence)return this.persistence.close()})}async ensureInitialized(){this.persistence??=await QK.createInstance({loggerFactory:this.loggerFactory,ownerId:await this.identity.getUserId(),namespaces:Object.values(tG),migrationsUrl:new URL("./encryption/migrations",r.b)})}async getPersistence(e){return await this.ensureInitialized(),{get:t=>this.persistence.get(t,e),set:(t,r)=>this.persistence.set(t,r,e)}}};rG=YK([te(l.ContainerScoped),eG(0,X(eq)),XK("design:paramtypes",[tq,cK,mq])],rG);var nG=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},iG=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};function sG(e,t){return`${t}::${e}`}function oG(e,t){return`${e}::${t}`}let aG=class{persistenceManager;eventEmitter;logger;constructor(e,t,r){this.persistenceManager=e,this.eventEmitter=t,this.logger=r.createLogger("LocalGroupKeyStore")}async get(e,t){const r=await this.persistenceManager.getPersistence(tG.ENCRYPTION_KEYS),n=await r.get(sG(e,t));return void 0!==n?new ZK(e,Buffer.from(n,"hex")):void 0}async set(e,t,r){const n=await this.persistenceManager.getPersistence(tG.ENCRYPTION_KEYS);await n.set(sG(e,t),Buffer.from(r).toString("hex")),this.logger.debug("Set key",{keyId:e,publisherId:t}),this.eventEmitter.emit("encryptionKeyStoredToLocalStore",e)}async setLatestEncryptionKeyId(e,t,r){const n=await this.persistenceManager.getPersistence(tG.LATEST_ENCRYPTION_KEY_IDS);this.logger.debug("Set latest encryptionKeyId",{keyId:e,publisherId:t,streamId:r}),await n.set(oG(t,r),e)}async getLatestEncryptionKeyId(e,t){const r=await this.persistenceManager.getPersistence(tG.LATEST_ENCRYPTION_KEY_IDS);return await r.get(oG(e,t))}};aG=nG([te(l.ContainerScoped),iG("design:paramtypes",[rG,hq,mq])],aG);var cG=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},uG=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let lG=class{theGraphClient;logger;constructor(e,t){this.theGraphClient=e,this.logger=t.createLogger("OperatorRegistry")}async findRandomNetworkEntrypoints(e,t,r){const n=this.theGraphClient.queryEntities(()=>({query:`{\n                    operators(\n                        orderBy: latestHeartbeatTimestamp\n                        orderDirection: desc\n                        first: ${t}\n                        where: {\n                            latestHeartbeatMetadata_contains: "\\"tls\\":true", \n                            latestHeartbeatTimestamp_gt: "${Math.floor(Date.now()/1e3)-60*r*60}"\n                        }\n                    ) {\n                        id\n                        latestHeartbeatMetadata\n                    }\n                }`})),i=[];for await(const e of n)i.push(JSON.parse(e.latestHeartbeatMetadata));const s=ZS()(i).slice(0,e);return this.logger.debug(`Found ${i.length} network entrypoints, picked ${s.length}`,{picked:s}),s}async findOperatorsOnStream(e,t,r){const n={query:`{\n                stream(id: "${e}") {\n                    sponsorships(where: { isRunning: true }) {\n                        stakes(first: ${t}, orderBy: updateTimestamp, orderDirection: desc) {\n                            operator (\n                                where: {\n                                    latestHeartbeatMetadata_contains: "\\"tls\\":true", \n                                    latestHeartbeatTimestamp_gt: "${Math.floor(Date.now()/1e3)-60*r*60}"\n                                }\n                            ) {\n                                id\n                                latestHeartbeatMetadata\n                            }\n                        }\n                    }\n                }\n            }`};return(await this.theGraphClient.queryEntity(n)).stream.sponsorships.flatMap(e=>e.stakes.map(e=>({operatorId:ts(e.operator.id),peerDescriptor:JSON.parse(e.operator.latestHeartbeatMetadata)})))}};lG=cG([te(l.ContainerScoped),uG("design:paramtypes",[nc,mq])],lG);const dG=new class extends sS{constructor(){super("google.protobuf.Empty",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();{let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}},hG=new class extends sS{constructor(){super("google.protobuf.Any",[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}])}pack(e,t){return{typeUrl:this.typeNameToUrl(t.typeName),value:t.toBinary(e)}}unpack(e,t,r){if(!this.contains(e,t))throw new Error("Cannot unpack google.protobuf.Any with typeUrl '"+e.typeUrl+"' as "+t.typeName+".");return t.fromBinary(e.value,r)}contains(e,t){return!!e.typeUrl.length&&("string"==typeof t?t:t.typeName)===this.typeUrlToName(e.typeUrl)}internalJsonWrite(e,t){if(""===e.typeUrl)return{};let r=this.typeUrlToName(e.typeUrl),n=HA(t),i=n.typeRegistry?.find(e=>e.typeName===r);if(!i)throw new globalThis.Error("Unable to convert google.protobuf.Any with typeUrl '"+e.typeUrl+"' to JSON. The specified type "+r+" is not available in the type registry.");let s=i.fromBinary(e.value,{readUnknownField:!1}),o=i.internalJsonWrite(s,n);return!r.startsWith("google.protobuf.")&&fA(o)||(o={value:o}),o["@type"]=e.typeUrl,o}internalJsonRead(e,t,r){if(!fA(e))throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON "+hA(e)+".");if("string"!=typeof e["@type"]||""==e["@type"])return this.create();let n,i=this.typeUrlToName(e["@type"]),s=t?.typeRegistry?.find(e=>e.typeName==i);if(!s)throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON. The specified type "+i+" is not available in the type registry.");if(i.startsWith("google.protobuf.")&&e.hasOwnProperty("value"))n=s.fromJson(e.value,t);else{let r=Object.assign({},e);delete r["@type"],n=s.fromJson(r,t)}return void 0===r&&(r=this.create()),r.typeUrl=e["@type"],r.value=s.toBinary(n),r}typeNameToUrl(e){if(!e.length)throw new Error("invalid type name: "+e);return"type.googleapis.com/"+e}typeUrlToName(e){if(!e.length)throw new Error("invalid type url: "+e);let t=e.lastIndexOf("/"),r=t>0?e.substring(t+1):e;if(!r.length)throw new Error("invalid type url: "+e);return r}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.typeUrl="",t.value=new Uint8Array(0),void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();switch(t){case 1:i.typeUrl=e.string();break;case 2:i.value=e.bytes();break;default:let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){""!==e.typeUrl&&t.tag(1,UA.LengthDelimited).string(e.typeUrl),e.value.length&&t.tag(2,UA.LengthDelimited).bytes(e.value);let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}};var fG;!function(e){e[e.SERVER_TIMEOUT=0]="SERVER_TIMEOUT",e[e.CLIENT_TIMEOUT=1]="CLIENT_TIMEOUT",e[e.UNKNOWN_RPC_METHOD=2]="UNKNOWN_RPC_METHOD",e[e.CLIENT_ERROR=3]="CLIENT_ERROR",e[e.SERVER_ERROR=4]="SERVER_ERROR"}(fG||(fG={}));const pG=new class extends sS{constructor(){super("protorpc.RpcMessage",[{no:1,name:"header",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:2,name:"body",kind:"message",T:()=>hG},{no:3,name:"requestId",kind:"scalar",T:9},{no:4,name:"errorType",kind:"enum",opt:!0,T:()=>["protorpc.RpcErrorType",fG]},{no:5,name:"errorClassName",kind:"scalar",opt:!0,T:9},{no:6,name:"errorCode",kind:"scalar",opt:!0,T:9},{no:7,name:"errorMessage",kind:"scalar",opt:!0,T:9}])}};new class extends sS{constructor(){super("protorpc.Mnfo2uhnf92hvqi2nviouq2hv9puhq",[{no:1,name:"empty",kind:"message",T:()=>dG}])}};const gG=new class extends sS{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3,L:2},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const e=this.create(),t=Date.now();return e.seconds=TA.from(Math.floor(t/1e3)).toNumber(),e.nanos=t%1e3*1e6,e}toDate(e){return new Date(1e3*TA.from(e.seconds).toNumber()+Math.ceil(e.nanos/1e6))}fromDate(e){const t=this.create(),r=e.getTime();return t.seconds=TA.from(Math.floor(r/1e3)).toNumber(),t.nanos=1e6*(r%1e3+(r<0&&r%1e3!=0?1e3:0)),t}internalJsonWrite(e,t){let r=1e3*TA.from(e.seconds).toNumber();if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let n="Z";if(e.nanos>0){let t=(e.nanos+1e9).toString().substring(1);n="000000"===t.substring(3)?"."+t.substring(0,3)+"Z":"000"===t.substring(6)?"."+t.substring(0,6)+"Z":"."+t+"Z"}return new Date(r).toISOString().replace(".000Z",n)}internalJsonRead(e,t,r){if("string"!=typeof e)throw new Error("Unable to parse Timestamp from JSON "+hA(e)+".");let n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return r||(r=this.create()),r.seconds=TA.from(i/1e3).toNumber(),r.nanos=0,n[7]&&(r.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),r}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.seconds=0,t.nanos=0,void 0!==e&&GA(this,t,e),t}internalBinaryRead(e,t,r,n){let i=n??this.create(),s=e.pos+t;for(;e.pos<s;){let[t,n]=e.tag();switch(t){case 1:i.seconds=e.int64().toNumber();break;case 2:i.nanos=e.int32();break;default:let s=r.readUnknownField;if("throw"===s)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?FA.onRead:s)(this.typeName,i,t,n,o)}}return i}internalBinaryWrite(e,t,r){0!==e.seconds&&t.tag(1,UA.Varint).int64(e.seconds),0!==e.nanos&&t.tag(2,UA.Varint).int32(e.nanos);let n=r.writeUnknownFields;return!1!==n&&(1==n?FA.onWrite:n)(this.typeName,e,t),t}};var mG,yG,bG,wG,vG,EG;!function(e){e[e.FIND_CLOSEST_NODES=0]="FIND_CLOSEST_NODES",e[e.FETCH_DATA=1]="FETCH_DATA",e[e.DELETE_DATA=2]="DELETE_DATA"}(mG||(mG={})),function(e){e[e.NODEJS=0]="NODEJS",e[e.BROWSER=1]="BROWSER"}(yG||(yG={})),function(e){e[e.SERVER_TIMOUT=0]="SERVER_TIMOUT",e[e.CLIENT_TIMEOUT=1]="CLIENT_TIMEOUT",e[e.SERVER_ERROR=2]="SERVER_ERROR",e[e.UNKNOWN_RPC_METHOD=3]="UNKNOWN_RPC_METHOD"}(bG||(bG={})),function(e){e[e.NO_TARGETS=0]="NO_TARGETS",e[e.DUPLICATE=1]="DUPLICATE",e[e.STOPPED=2]="STOPPED"}(wG||(wG={})),function(e){e[e.DUPLICATE_CONNECTION=0]="DUPLICATE_CONNECTION",e[e.INVALID_TARGET_PEER_DESCRIPTOR=1]="INVALID_TARGET_PEER_DESCRIPTOR",e[e.UNSUPPORTED_PROTOCOL_VERSION=2]="UNSUPPORTED_PROTOCOL_VERSION"}(vG||(vG={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.LEAVING=1]="LEAVING"}(EG||(EG={}));const AG=new class extends sS{constructor(){super("dht.StoreDataRequest",[{no:1,name:"key",kind:"scalar",T:12},{no:2,name:"data",kind:"message",T:()=>hG},{no:3,name:"creator",kind:"scalar",T:12},{no:4,name:"createdAt",kind:"message",T:()=>gG},{no:5,name:"ttl",kind:"scalar",T:13}])}},SG=new class extends sS{constructor(){super("dht.StoreDataResponse",[])}},kG=new class extends sS{constructor(){super("dht.ExternalStoreDataRequest",[{no:1,name:"key",kind:"scalar",T:12},{no:2,name:"data",kind:"message",T:()=>hG}])}},RG=new class extends sS{constructor(){super("dht.ExternalStoreDataResponse",[{no:1,name:"storers",kind:"message",repeat:2,T:()=>LG}])}},PG=new class extends sS{constructor(){super("dht.ReplicateDataRequest",[{no:1,name:"entry",kind:"message",T:()=>IG}])}},IG=new class extends sS{constructor(){super("dht.DataEntry",[{no:1,name:"key",kind:"scalar",T:12},{no:2,name:"data",kind:"message",T:()=>hG},{no:3,name:"creator",kind:"scalar",T:12},{no:4,name:"createdAt",kind:"message",T:()=>gG},{no:5,name:"storedAt",kind:"message",T:()=>gG},{no:6,name:"ttl",kind:"scalar",T:13},{no:7,name:"stale",kind:"scalar",T:8},{no:8,name:"deleted",kind:"scalar",T:8}])}},CG=new class extends sS{constructor(){super("dht.ClosestPeersRequest",[{no:1,name:"nodeId",kind:"scalar",T:12},{no:2,name:"requestId",kind:"scalar",T:9}])}},_G=new class extends sS{constructor(){super("dht.ClosestPeersResponse",[{no:1,name:"peers",kind:"message",repeat:2,T:()=>LG},{no:2,name:"requestId",kind:"scalar",T:9}])}},TG=new class extends sS{constructor(){super("dht.ClosestRingPeersRequest",[{no:1,name:"ringId",kind:"scalar",T:12},{no:2,name:"requestId",kind:"scalar",T:9}])}},NG=new class extends sS{constructor(){super("dht.ClosestRingPeersResponse",[{no:1,name:"leftPeers",kind:"message",repeat:2,T:()=>LG},{no:2,name:"rightPeers",kind:"message",repeat:2,T:()=>LG},{no:3,name:"requestId",kind:"scalar",T:9}])}},xG=new class extends sS{constructor(){super("dht.RecursiveOperationRequest",[{no:1,name:"sessionId",kind:"scalar",T:9},{no:2,name:"operation",kind:"enum",T:()=>["dht.RecursiveOperation",mG]}])}},OG=new class extends sS{constructor(){super("dht.RecursiveOperationResponse",[{no:1,name:"closestConnectedNodes",kind:"message",repeat:2,T:()=>LG},{no:2,name:"dataEntries",kind:"message",repeat:2,T:()=>IG},{no:3,name:"noCloserNodesFound",kind:"scalar",T:8},{no:4,name:"routingPath",kind:"message",repeat:2,T:()=>LG}])}},DG=new class extends sS{constructor(){super("dht.PingRequest",[{no:1,name:"requestId",kind:"scalar",T:9}])}},MG=new class extends sS{constructor(){super("dht.PingResponse",[{no:1,name:"requestId",kind:"scalar",T:9}])}},BG=new class extends sS{constructor(){super("dht.LeaveNotice",[])}},LG=new class extends sS{constructor(){super("dht.PeerDescriptor",[{no:1,name:"nodeId",kind:"scalar",T:12},{no:2,name:"type",kind:"enum",T:()=>["dht.NodeType",yG]},{no:3,name:"udp",kind:"message",T:()=>FG},{no:4,name:"tcp",kind:"message",T:()=>FG},{no:5,name:"websocket",kind:"message",T:()=>FG},{no:6,name:"region",kind:"scalar",opt:!0,T:13},{no:7,name:"ipAddress",kind:"scalar",opt:!0,T:13},{no:8,name:"publicKey",kind:"scalar",opt:!0,T:12},{no:9,name:"signature",kind:"scalar",opt:!0,T:12}])}},FG=new class extends sS{constructor(){super("dht.ConnectivityMethod",[{no:1,name:"port",kind:"scalar",T:13},{no:2,name:"host",kind:"scalar",T:9},{no:3,name:"tls",kind:"scalar",T:8}])}},UG=new class extends sS{constructor(){super("dht.RouteMessageWrapper",[{no:1,name:"requestId",kind:"scalar",T:9},{no:2,name:"sourcePeer",kind:"message",T:()=>LG},{no:3,name:"target",kind:"scalar",T:12},{no:4,name:"message",kind:"message",T:()=>$G},{no:5,name:"reachableThrough",kind:"message",repeat:2,T:()=>LG},{no:6,name:"routingPath",kind:"message",repeat:2,T:()=>LG},{no:7,name:"parallelRootNodeIds",kind:"scalar",repeat:2,T:9}])}},jG=new class extends sS{constructor(){super("dht.RouteMessageAck",[{no:1,name:"requestId",kind:"scalar",T:9},{no:2,name:"error",kind:"enum",opt:!0,T:()=>["dht.RouteMessageError",wG]}])}},zG=new class extends sS{constructor(){super("dht.ConnectivityRequest",[{no:1,name:"port",kind:"scalar",T:13},{no:2,name:"tls",kind:"scalar",T:8},{no:3,name:"host",kind:"scalar",opt:!0,T:9},{no:4,name:"allowSelfSignedCertificate",kind:"scalar",T:8}])}},qG=new class extends sS{constructor(){super("dht.ConnectivityResponse",[{no:1,name:"host",kind:"scalar",T:9},{no:2,name:"natType",kind:"scalar",T:9},{no:3,name:"websocket",kind:"message",T:()=>FG},{no:4,name:"ipAddress",kind:"scalar",T:13},{no:5,name:"protocolVersion",kind:"scalar",T:9},{no:6,name:"latitude",kind:"scalar",opt:!0,T:1},{no:7,name:"longitude",kind:"scalar",opt:!0,T:1}])}},KG=new class extends sS{constructor(){super("dht.HandshakeRequest",[{no:1,name:"sourcePeerDescriptor",kind:"message",T:()=>LG},{no:2,name:"targetPeerDescriptor",kind:"message",T:()=>LG},{no:3,name:"protocolVersion",kind:"scalar",T:9},{no:4,name:"applicationVersion",kind:"scalar",T:9}])}},GG=new class extends sS{constructor(){super("dht.HandshakeResponse",[{no:1,name:"sourcePeerDescriptor",kind:"message",T:()=>LG},{no:2,name:"error",kind:"enum",opt:!0,T:()=>["dht.HandshakeError",vG]},{no:3,name:"protocolVersion",kind:"scalar",T:9},{no:4,name:"applicationVersion",kind:"scalar",T:9}])}},$G=new class extends sS{constructor(){super("dht.Message",[{no:1,name:"messageId",kind:"scalar",T:9},{no:2,name:"sourceDescriptor",kind:"message",T:()=>LG},{no:3,name:"targetDescriptor",kind:"message",T:()=>LG},{no:4,name:"serviceId",kind:"scalar",T:9},{no:5,name:"rpcMessage",kind:"message",oneof:"body",T:()=>pG},{no:6,name:"connectivityRequest",kind:"message",oneof:"body",T:()=>zG},{no:7,name:"connectivityResponse",kind:"message",oneof:"body",T:()=>qG},{no:8,name:"handshakeRequest",kind:"message",oneof:"body",T:()=>KG},{no:9,name:"handshakeResponse",kind:"message",oneof:"body",T:()=>GG},{no:10,name:"recursiveOperationRequest",kind:"message",oneof:"body",T:()=>xG}])}},VG=new class extends sS{constructor(){super("dht.WebsocketConnectionRequest",[])}},HG=new class extends sS{constructor(){super("dht.WebrtcConnectionRequest",[])}},WG=new class extends sS{constructor(){super("dht.RtcOffer",[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"connectionId",kind:"scalar",T:9}])}},JG=new class extends sS{constructor(){super("dht.RtcAnswer",[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"connectionId",kind:"scalar",T:9}])}},ZG=new class extends sS{constructor(){super("dht.IceCandidate",[{no:1,name:"candidate",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"connectionId",kind:"scalar",T:9}])}},QG=new class extends sS{constructor(){super("dht.LockRequest",[{no:1,name:"lockId",kind:"scalar",T:9}])}},YG=new class extends sS{constructor(){super("dht.UnlockRequest",[{no:1,name:"lockId",kind:"scalar",T:9}])}},XG=new class extends sS{constructor(){super("dht.LockResponse",[{no:1,name:"accepted",kind:"scalar",T:8}])}},e$=new class extends sS{constructor(){super("dht.DisconnectNotice",[{no:1,name:"disconnectMode",kind:"enum",T:()=>["dht.DisconnectMode",EG]}])}},t$=new class extends sS{constructor(){super("dht.SetPrivateRequest",[{no:1,name:"isPrivate",kind:"scalar",T:8}])}},r$=new class extends sS{constructor(){super("dht.ExternalFetchDataRequest",[{no:1,name:"key",kind:"scalar",T:12}])}},n$=new class extends sS{constructor(){super("dht.ExternalFetchDataResponse",[{no:1,name:"entries",kind:"message",repeat:2,T:()=>IG}])}},i$=new class extends sS{constructor(){super("dht.ExternalFindClosestNodesRequest",[{no:1,name:"nodeId",kind:"scalar",T:12}])}},s$=new class extends sS{constructor(){super("dht.ExternalFindClosestNodesResponse",[{no:1,name:"closestNodes",kind:"message",repeat:2,T:()=>LG}])}};new oS("dht.DhtNodeRpc",[{name:"getClosestPeers",options:{},I:CG,O:_G},{name:"getClosestRingPeers",options:{},I:TG,O:NG},{name:"ping",options:{},I:DG,O:MG},{name:"leaveNotice",options:{},I:BG,O:dG}]),new oS("dht.RouterRpc",[{name:"routeMessage",options:{},I:UG,O:jG},{name:"forwardMessage",options:{},I:UG,O:jG}]),new oS("dht.RecursiveOperationRpc",[{name:"routeRequest",options:{},I:UG,O:jG}]),new oS("dht.StoreRpc",[{name:"storeData",options:{},I:AG,O:SG},{name:"replicateData",options:{},I:PG,O:dG}]),new oS("dht.RecursiveOperationSessionRpc",[{name:"sendResponse",options:{},I:OG,O:dG}]),new oS("dht.WebsocketClientConnectorRpc",[{name:"requestConnection",options:{},I:VG,O:dG}]),new oS("dht.WebrtcConnectorRpc",[{name:"requestConnection",options:{},I:HG,O:dG},{name:"rtcOffer",options:{},I:WG,O:dG},{name:"rtcAnswer",options:{},I:JG,O:dG},{name:"iceCandidate",options:{},I:ZG,O:dG}]),new oS("dht.ConnectionLockRpc",[{name:"lockRequest",options:{},I:QG,O:XG},{name:"unlockRequest",options:{},I:YG,O:dG},{name:"gracefulDisconnect",options:{},I:e$,O:dG},{name:"setPrivate",options:{},I:t$,O:dG}]),new oS("dht.ExternalApiRpc",[{name:"externalFetchData",options:{},I:r$,O:n$},{name:"externalStoreData",options:{},I:kG,O:RG},{name:"externalFindClosestNodes",options:{},I:i$,O:s$}]);const o$=new class extends sS{constructor(){super("OperatorDiscoveryRequest",[{no:1,name:"streamPartId",kind:"scalar",T:9}])}},a$=new class extends sS{constructor(){super("OperatorDiscoveryResponse",[{no:1,name:"operators",kind:"message",repeat:2,T:()=>LG}])}},c$=new oS("OperatorDiscovery",[{name:"discoverOperators",options:{},I:o$,O:a$}]);class u${_transport;typeName=c$.typeName;methods=c$.methods;options=c$.options;constructor(e){this._transport=e}discoverOperators(e,t){const r=this.methods[0],n=this._transport.mergeOptions(t);return aS("unary",this._transport,r,n,e)}}var l$=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},d$=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h$=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let f$=class{createNetworkNode(e){return(e=>new FN(new LN(e)))(e)}};f$=l$([te(l.ContainerScoped)],f$);const p$=new Ta("NetworkNodeFacade");let g$=class{cachedNode;startNodeCalled=!1;startNodeComplete=!1;messageListeners=[];networkNodeFactory;operatorRegistry;config;identity;eventEmitter;destroySignal;constructor(e,t,r,n,i){this.networkNodeFactory=e,this.operatorRegistry=t,this.config=r,this.identity=n,this.eventEmitter=new zr,this.destroySignal=i,i.onDestroy.listen(this.destroy)}async getNetworkOptions(){const e=await this.getEntryPoints(),t=this.config.network.controlLayer.peerDescriptor?Wq(this.config.network.controlLayer.peerDescriptor):void 0;return{layer0:{...this.config.network.controlLayer,entryPoints:e.map(Wq),peerDescriptor:t,websocketPortRange:null!==this.config.network.controlLayer.websocketPortRange?this.config.network.controlLayer.websocketPortRange:void 0},networkNode:{...Mx()(this.config.network.node,"contentDeliveryBufferWhileConnecting"),bufferWhileConnecting:this.config.network.node.contentDeliveryBufferWhileConnecting},metricsContext:new za}}destroy=Xq(async()=>{const e=this.cachedNode;if(this.cachedNode=void 0,e&&this.startNodeCalled){if(!this.startNodeComplete){const e=this.startNodeTask();this.startNodeTask.reset(),await e}await e.stop()}this.startNodeTask.reset()});startNodeTask=Xq(async(e=!0)=>{this.startNodeCalled=!0;try{const t=await this.initNode();return this.destroySignal.isDestroyed()||await t.start(e),t.addMessageListener(e=>{if(this.messageListeners.length>0)try{const t=Bq.toClientProtocol(e);for(const e of this.messageListeners)e(t)}catch(e){p$.trace("Could not translate message",{err:e})}}),this.destroySignal.isDestroyed()?await t.stop():this.eventEmitter.emit("start"),this.destroySignal.assertNotDestroyed(),t}finally{this.startNodeComplete=!0}});async initNode(){if(this.destroySignal.assertNotDestroyed(),this.cachedNode)return this.cachedNode;const e=this.networkNodeFactory.createNetworkNode(await this.getNetworkOptions());return this.destroySignal.isDestroyed()||(this.cachedNode=e),e}startNode=this.startNodeTask;getNode(){return this.destroySignal.assertNotDestroyed(),this.startNodeTask()}async getNodeId(){return(await this.getNode()).getNodeId()}async join(e,t,r){const n=await this.getNode();await n.join(e,t,r)}async leave(e){const t=await this.getNode();await t.leave(e)}async broadcast(e,t){(await this.getNode()).broadcast(Bq.toProtobuf(e),t)}addMessageListener(e){this.messageListeners.push(e)}removeMessageListener(e){lk()(this.messageListeners,e)}async isProxiedStreamPart(e){return(await this.getNode()).isProxiedStreamPart(e)}async getMetricsContext(){return(await this.getNode()).getMetricsContext()}async getPeerDescriptor(){return(await this.getNode()).getPeerDescriptor()}async getDiagnosticInfo(){return(await this.getNode()).getDiagnosticInfo()}async getStreamParts(){return(await this.getNode()).getStreamParts()}async getNeighbors(e){return(await this.getNode()).getNeighbors(e)}async getOptions(){return(await this.getNode()).getOptions()}async inspect(e,t){this.isStarting()&&await this.startNodeTask(!1);const r=Wq(e);return this.cachedNode.inspect(r,t)}async setProxies(e,t,r,n){this.isStarting()&&await this.startNodeTask(!1);const i=t.map(Wq);await this.cachedNode.setProxies(e,i,await this.identity.getUserId(),r,n)}async setStreamPartEntryPoints(e,t){this.isStarting()&&await this.startNodeTask(!1);const r=t.map(Wq);this.cachedNode.setStreamPartEntryPoints(e,r)}async discoverOperators(e,t){const r=await this.createExternalRpcClient(u$);return(await r.discoverOperators(o$.create({streamPartId:t}),{sourceDescriptor:await this.getPeerDescriptor(),targetDescriptor:Wq(e)})).operators.map(e=>Jq(e))}async createExternalRpcClient(e){return this.isStarting()&&await this.startNodeTask(!1),this.cachedNode.createExternalRpcClient(e)}async registerOperator(e){(await this.getNode()).registerExternalNetworkRpcMethod(o$,a$,"discoverOperators",async t=>{const r=gc.parse(t.streamPartId),n=e.getAssignedNodesForStreamPart(r);return a$.create({operators:n.map(e=>Wq(e))})})}isStarting(){return!this.cachedNode||!this.startNodeComplete}once(e,t){this.eventEmitter.once(e,t)}async getEntryPoints(){const e=this.config.network.controlLayer.entryPointDiscovery,t=e?.enabled?await this.operatorRegistry.findRandomNetworkEntrypoints(e.maxEntryPoints,e.maxQueryResults,e.maxHeartbeatAgeHours):[];return[...this.config.network.controlLayer.entryPoints,...t]}};g$=l$([te(l.ContainerScoped),h$(2,X(Zz)),h$(3,X(eq)),d$("design:paramtypes",[f$,lG,Object,tq,cK])],g$);const m$=()=>qa(20),y$=e=>{const t=Buffer.concat([Buffer.from(`${e.messageId.streamId}${e.messageId.streamPartition}${e.messageId.timestamp}${e.messageId.sequenceNumber}${e.messageId.publisherId}${e.messageId.msgChainId}`),void 0!==e.prevMsgRef?Buffer.from(`${e.prevMsgRef.timestamp}${e.prevMsgRef.sequenceNumber}`):new Uint8Array(0)]);if(e.messageType===Dq.MESSAGE){const r=e.newGroupKey?Buffer.from(e.newGroupKey.id):void 0;return Buffer.concat([t,e.content,r??new Uint8Array(0),e.newGroupKey?.data??new Uint8Array(0)])}if(e.messageType===Dq.GROUP_KEY_REQUEST){const r=eT.fromBinary(e.content);return Buffer.concat([t,ho(r.requestId),r.recipientId,r.publicKey,Buffer.concat(r.groupKeyIds.map(e=>ho(e)))])}if(e.messageType===Dq.GROUP_KEY_RESPONSE){const r=tT.fromBinary(e.content);return Buffer.concat([t,ho(r.requestId),r.recipientId,Buffer.concat(r.groupKeys.map(e=>Buffer.concat([ho(e.id),e.data])))])}throw new Error(`Assertion failed: unknown message type ${e.messageType}`)};var b$=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},w$=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v$=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let E$=class{identity;constructor(e){this.identity=e}async createSignedMessage(e,t){const r=await this.identity.createMessageSignature(y$(e));return new Mq({...e,signature:r,signatureType:t})}};E$=b$([te(l.ContainerScoped),v$(0,X(eq)),w$("design:paramtypes",[tq])],E$);var A$=["function isValidSignature(bytes32 hash, bytes signature) view returns (bytes4 magicValue)"],S$=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},k$=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const R$=new Ac;let P$=class{contractsByAddress;publisherCache=new lc(()=>6e5);constructor(e,t){this.contractsByAddress=kK({valueFactory:async r=>e.createReadContract(r,A$,t.getProvider(),"erc1271Contract")})}async isValidSignature(e,t,r){const n=function(e,t){return`${e}_${t}`}(e,yc(R$.recoverSignerUserId(r,t))),i=this.publisherCache.get(n);if(void 0!==i)return i;{const i=await this.contractsByAddress.get(e),s="0x1626ba7e"===await i.isValidSignature(R$.keccakHash(t),r);return this.publisherCache.set(n,s),s}}};P$=S$([te(l.ContainerScoped),k$("design:paramtypes",[kq,uq])],P$);class I$ extends tq{publicKeyString;publicKey;privateKey;constructor(e,t){super(),this.publicKey=e,this.privateKey=t,this.publicKeyString=yc(this.publicKey),this.assertValidKeyPair()}async getUserIdRaw(){return this.publicKey}async getUserId(){return this.publicKeyString}async getPrivateKey(){return this.privateKey}async getTransactionSigner(e){throw new Error("This key pair can not sign transactions!")}static getKeyPairFromConfig(e){const t=e.auth;if(!t.privateKey)throw new Error("A privateKey was expected in the config, but none is defined!");return t}}const C$=new Ac;class _$ extends I${assertValidKeyPair(){C$.assertValidKeyPair(this.publicKey,this.privateKey)}getSignatureType(){return W_.ECDSA_SECP256K1_EVM}async createMessageSignature(e){return C$.createSignature(e,this.privateKey)}async getTransactionSigner(e){const t=e.getProvider();return new DE(fo(this.privateKey),t)}static fromConfig(e){const t=e.auth.privateKey,r=e.auth.publicKey;return _$.fromPrivateKey(t,r)}static fromPrivateKey(e,t){return new _$(po(t??new DE(e).address),po(e))}static generate(){const e=C$.generateKeyPair();return new _$(e.publicKey,e.privateKey)}}class T$ extends tq{provider;expectedChainId;signer;cachedUserIdString;cachedUserIdBytes;rateLimitedSigner;constructor(e,t){super(),this.provider=e,this.expectedChainId=t,this.signer=e.getSigner(),this.rateLimitedSigner=Yq(async e=>{const t=await(await this.signer).signMessage(e);return await Ga(50),po(t)},1)}async getUserIdRaw(){return this.cachedUserIdBytes??=bc(await this.getUserId()),this.cachedUserIdBytes}async getUserId(){return this.cachedUserIdString??=yc(await(await this.signer).getAddress()),this.cachedUserIdString}getSignatureType(){return W_.ECDSA_SECP256K1_EVM}async createMessageSignature(e){return this.rateLimitedSigner(e)}async getTransactionSigner(){if(void 0===this.expectedChainId)throw new Error("Streamr chainId not configuredin the StreamrClient options!");const e=(await this.provider.getNetwork()).chainId;if(e!==BigInt(this.expectedChainId))throw new Error(`Connect your wallet to the chain with chainId ${this.expectedChainId} (chainId of currently selected chain is ${e})`);return this.signer}static fromConfig(e){const t=e.auth?.ethereum,r=new ME(t);return new T$(r,e.contracts.ethereumNetwork.chainId)}}const N$=Ec.getInstance("ML_DSA_87");class x$ extends I${assertValidKeyPair(){N$.assertValidKeyPair(this.publicKey,this.privateKey)}getSignatureType(){return W_.ML_DSA_87}async createMessageSignature(e){return N$.createSignature(e,this.privateKey)}static fromConfig(e){const t=I$.getKeyPairFromConfig(e);if(!t.publicKey)throw new Error("ML-DSA identity requires a publicKey to be given in the config!");return new x$(po(t.publicKey),po(t.privateKey))}static generate(){const e=N$.generateKeyPair();return new x$(e.publicKey,e.privateKey)}}const O$=new Sc;class D$ extends I${cachedJWK;assertValidKeyPair(){O$.assertValidKeyPair(this.publicKey,this.privateKey)}getSignatureType(){return W_.ECDSA_SECP256R1}async createMessageSignature(e){return this.cachedJWK??=O$.privateKeyToJWK(this.privateKey),O$.createSignature(e,this.cachedJWK)}static fromConfig(e){const t=I$.getKeyPairFromConfig(e),r=po(t.privateKey),n=t.publicKey?po(t.publicKey):O$.getPublicKeyFromPrivateKey(r);return new D$(n,r)}static generate(){const e=O$.generateKeyPair();return new D$(e.publicKey,e.privateKey)}}const M$=[{keyType:"ECDSA_SECP256K1_EVM",fromConfig:_$.fromConfig,signatureType:W_.ECDSA_SECP256K1_EVM},{keyType:"ECDSA_SECP256R1",fromConfig:D$.fromConfig,signatureType:W_.ECDSA_SECP256R1},{keyType:"ML_DSA_87",fromConfig:x$.fromConfig,signatureType:W_.ML_DSA_87}];["ECDSA_SECP256K1_EVM","ECDSA_SECP256R1","ML_DSA_87"].forEach(e=>{if(!M$.find(t=>t.keyType===e))throw new Error(`keyType missing from IDENTITIES: ${e}`)});var B$=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},L$=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const F$=Object.fromEntries(M$.map(e=>[e.signatureType,Ec.getInstance(e.keyType)])),U$=Ec.getInstance("ECDSA_SECP256K1_EVM");let j$=class{erc1271ContractFacade;constructor(e){this.erc1271ContractFacade=e}async assertSignatureIsValid(e){let t;try{t=await this.validate(e)}catch(t){throw new Qz(`An error occurred during address recovery from signature: ${t}`,"INVALID_SIGNATURE",e)}if(!t)throw new Qz("Signature validation failed","INVALID_SIGNATURE",e)}async validate(e){const t=F$[e.signatureType];if(t)return t.verifySignature(bc(e.getPublisherId()),y$(e),e.signature);if(e.signatureType===W_.ECDSA_SECP256K1_LEGACY)return U$.verifySignature(bc(e.getPublisherId()),(e=>{const t=void 0!==e.prevMsgRef?`${e.prevMsgRef.timestamp}${e.prevMsgRef.sequenceNumber}`:"",r=void 0!==e.newGroupKey?(({id:e,data:t})=>JSON.stringify([e,fo(t)]))(e.newGroupKey):"",n=e.encryptionType===V_.NONE?lo(e.content):fo(e.content);return Buffer.from(`${e.messageId.streamId}${e.messageId.streamPartition}${e.messageId.timestamp}${e.messageId.sequenceNumber}${e.messageId.publisherId}${e.messageId.msgChainId}${t}${n}${r}`)})(e),e.signature);if(e.signatureType===W_.ERC_1271)return this.erc1271ContractFacade.isValidSignature(ts(e.getPublisherId()),y$(e),e.signature);throw new Error(`Cannot validate message signature, unsupported signatureType: "${e.signatureType}"`)}};j$=B$([te(l.ContainerScoped),L$("design:paramtypes",[P$])],j$);const z$=async(e,t,r,n)=>{await q$(e,t,r,n).catch(t=>{throw t.streamMessage??=e,t})},q$=async(e,t,r,n)=>{switch(await r.assertSignatureIsValid(e),e.messageType){case Dq.MESSAGE:return K$(e,t,n);case Dq.GROUP_KEY_REQUEST:return G$(e,yc(eT.fromBinary(e.content).recipientId),e.getPublisherId(),t,n);case Dq.GROUP_KEY_RESPONSE:return G$(e,e.getPublisherId(),yc(tT.fromBinary(e.content).recipientId),t,n);default:throw new Qz(`Unknown message type: ${e.messageType}!`,"ASSERTION_FAILED",e)}},K$=async(e,t,r)=>{const n=e.getStreamId();if(r.validation.partitions){const r=await t.getStreamMetadata(n),i=gK(r);if(e.getStreamPartition()<0||e.getStreamPartition()>=i)throw new Qz(`Partition ${e.getStreamPartition()} is out of range (0..${i-1})`,"INVALID_PARTITION",e)}if(r.validation.permissions){const r=e.getPublisherId();if(!await t.isStreamPublisher(n,r))throw new Qz(`${r} is not a publisher on stream ${n}`,"MISSING_PERMISSION",e)}},G$=async(e,t,r,n,i)=>{if(i.validation.permissions){const i=e.getStreamId();if(!await n.isStreamPublisher(i,t))throw new Qz(`${t} is not a publisher on stream ${i}`,"MISSING_PERMISSION",e);if(!await n.isStreamSubscriber(i,r))throw new Qz(`${r} is not a subscriber on stream ${i}`,"MISSING_PERMISSION",e)}};async function $$(e,{isPrivate:t=!1}={}){const r=t?"pkcs8":"spki",n=function(e){return String.fromCharCode.apply(null,[...new Uint8Array(e)])}(await Sa().exportKey(r,e)),i=t?"PRIVATE":"PUBLIC";return`-----BEGIN ${i} KEY-----\n${btoa(n)}\n-----END ${i} KEY-----\n`}class V${privateKey;publicKey;constructor(e,t){this.privateKey=e,this.publicKey=t}getPublicKey(){return ho(this.publicKey)}getPrivateKey(){return ho(this.privateKey)}getEncryptionType(){return H_.RSA}static async create(e){const{privateKey:t,publicKey:r}=await async function(e){const{publicKey:t,privateKey:r}=await Sa().generateKey({name:"RSA-OAEP",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]),[n,i]=await Promise.all([$$(r,{isPrivate:!0}),$$(t,{isPrivate:!1})]);return{privateKey:n,publicKey:i}}(e);return new V$(t,r)}}class H${privateKey;publicKey;constructor(e,t){this.privateKey=e,this.publicKey=t}getPublicKey(){return this.publicKey}getPrivateKey(){return this.privateKey}getEncryptionType(){return H_.ML_KEM}static create(){const e=dx.keygen();return new H$(Buffer.from(e.secretKey),Buffer.from(e.publicKey))}}const W$=new Set([W_.ML_DSA_87]),J$=new Set([H_.ML_KEM]),Z$=new Set([V_.AES]);function Q$(e,t){const r=Z$.has(e),n=t.encryption?.requireQuantumResistantEncryption;return r||!n}function Y$(e){return W$.has(e.getSignatureType())}const X$={Resends:Symbol("Resends"),Subscriber:Symbol("Subscriber")};var eV=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},tV=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},rV=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let nV=class{keyPair;pendingRequests=new Hq(5e4);networkNodeFacade;streamRegistry;signatureValidator;messageSigner;store;subscriber;identity;logger;ensureStarted;config;requestGroupKey;constructor(e,t,r,n,i,s,o,a,c){var u,l;this.networkNodeFacade=e,this.streamRegistry=t,this.signatureValidator=r,this.messageSigner=n,this.store=i,this.subscriber=s,this.identity=a,this.logger=c.createLogger("SubscriberKeyExchange"),this.config=o,void 0===o.encryption.keys?(this.ensureStarted=Xq(async()=>{this.keyPair=await async function(e,t){return t.encryption.requireQuantumResistantKeyExchange||Y$(e)?H$.create():V$.create(t.encryption.rsaKeyLength)}(a,o),e.addMessageListener(e=>this.onMessage(e)),this.logger.debug("Started")}),this.requestGroupKey=(u=(e,t,r)=>this.doRequestGroupKey(e,t,r),l=o.encryption.maxKeyRequestsPerSecond,KN()({limit:l,interval:1e3})(u))):(this.ensureStarted=async()=>{throw new Qz("Assertion failed","ASSERTION_FAILED")},this.requestGroupKey=async()=>{throw new Qz("Assertion failed","ASSERTION_FAILED")})}async doRequestGroupKey(e,t,r){await this.ensureStarted();const n=hS(),{message:i,request:s}=await this.createRequest(e,r,t,n);await this.networkNodeFacade.broadcast(i),this.pendingRequests.add(n),this.logger.debug("Sent group key request (waiting for response)",{groupKeyId:e,requestId:n,publisherId:t,keyEncryptionType:H_[s.encryptionType]})}async createRequest(e,t,r,n){const i={recipientId:bc(r),requestId:n,publicKey:this.keyPair.getPublicKey(),groupKeyIds:[e],encryptionType:this.keyPair.getEncryptionType()},s=this.subscriber.getERC1271ContractAddress(t);return{message:await this.messageSigner.createSignedMessage({messageId:new Oq(gc.getStreamID(t),gc.getStreamPartition(t),Date.now(),0,void 0===s?await this.identity.getUserId():yc(s),m$()),content:eT.toBinary(i),contentType:$_.BINARY,messageType:Dq.GROUP_KEY_REQUEST,encryptionType:V_.NONE},void 0===s?this.identity.getSignatureType():W_.ERC_1271),request:i}}async onMessage(e){if(e.messageType===Dq.GROUP_KEY_RESPONSE)try{const{requestId:t,recipientId:r,groupKeys:n,encryptionType:i}=tT.fromBinary(e.content),s=yc(r);await this.isAssignedToMe(e.getStreamPartID(),s,t)&&(this.logger.debug("Handle group key response",{requestId:t}),this.pendingRequests.delete(t),await z$(e,this.streamRegistry,this.signatureValidator,this.config),await Promise.all(n.map(async t=>{const r=await WK.decryptWithPrivateKey(t.data,this.keyPair.getPrivateKey(),i);await this.store.set(t.id,e.getPublisherId(),r)})))}catch(e){this.logger.debug("Failed to handle group key response",{err:e})}}async isAssignedToMe(e,t,r){if(this.pendingRequests.has(r)){const r=await this.identity.getUserId(),n=this.subscriber.getERC1271ContractAddress(e);return t===r||void 0!==n&&t===yc(n)}return!1}};nV=eV([te(l.ContainerScoped),rV(1,X(F(()=>jK))),rV(5,X(X$.Subscriber)),rV(6,X(Zz)),rV(7,X(eq)),tV("design:paramtypes",[g$,jK,j$,E$,aG,Function,Object,tq,mq])],nV);var iV=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},sV=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},oV=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};const aV=async(e,t,r)=>{if(void 0!==r.keys)for(const n of Object.entries(r.keys))if(await t.toStreamID(n[0])===e)return new ZK(n[1].id,Buffer.from(po(n[1].data)))};let cV=class{subscriberKeyExchange;localGroupKeyStore;explicitKeys;config;identity;eventEmitter;destroySignal;constructor(e,t,r,n,i,s,o){this.subscriberKeyExchange=e,this.localGroupKeyStore=t,this.config=n,this.identity=i,this.eventEmitter=s,this.destroySignal=o,void 0!==n.encryption.keys&&(this.explicitKeys=kK({valueFactory:async e=>aV(e,r,n.encryption)}))}async fetchKey(e,t,r){if(void 0!==this.explicitKeys){const r=await this.explicitKeys.get(gc.getStreamID(e));if(void 0!==r)return r;throw new Qz(`No encryption key available for stream part ID: groupKeyId=${t}, streamPartId=${e}`,"UNEXPECTED_INPUT")}let n=await this.localGroupKeyStore.get(t,r);if(void 0!==n)return n;await this.subscriberKeyExchange.requestGroupKey(t,r,e);const i=await Ha(this.eventEmitter,"encryptionKeyStoredToLocalStore",this.config.encryption.keyRequestTimeout,e=>e===t,this.destroySignal.abortSignal);return n=await this.localGroupKeyStore.get(i[0],r),n}async fetchLatestEncryptionKey(e,t){if(e!==await this.identity.getUserId())throw new Error("storeKey: fetching latest encryption keys for other publishers not supported.");const r=await this.localGroupKeyStore.getLatestEncryptionKeyId(e,t);return void 0!==r?this.localGroupKeyStore.get(r,e):void 0}async storeKey(e,t,r){if(t!==await this.identity.getUserId())throw new Error("storeKey: storing latest encryption keys for other publishers not supported.");if(void 0===e){const t=Buffer.from(Er(32));e=new ZK(Gq("GroupKey"),t)}return await this.localGroupKeyStore.set(e.id,t,e.data),await this.localGroupKeyStore.setLatestEncryptionKeyId(e.id,t,r),e}addKeyToLocalStore(e,t){return this.localGroupKeyStore.set(e.id,t,e.data)}};cV=iV([te(l.ContainerScoped),oV(3,X(Zz)),oV(4,X(eq)),sV("design:paramtypes",[nV,aG,fK,Object,tq,hq,cK])],cV);class uV{busy=new rc(!0);inputBuffer=[];outputBuffer;processMessageFn;onError;constructor(e,t,r){this.outputBuffer=e,this.processMessageFn=t,this.onError=r}async addMessage(e){if(this.inputBuffer.push(e),this.busy.isOpen()){for(this.busy.close();this.inputBuffer.length>0;){const e=this.inputBuffer.shift();try{const t=await this.processMessageFn(e);this.outputBuffer.push(t)}catch(e){this.onError.trigger(e)}}this.busy.open()}}}class lV{outputBuffer=new qq;processors=new Map;processMessageFn;onError;constructor(e,t){this.processMessageFn=e,this.onError=t}addMessage(e){const t=`${e.getPublisherId()}-${e.getMsgChainId()}`;let r=this.processors.get(t);void 0===r&&(r=new uV(this.outputBuffer,this.processMessageFn,this.onError),this.processors.set(t,r)),r.addMessage(e)}async flush(){await Promise.all(Array.from(this.processors.values()).map(e=>e.busy.waitUntilOpen()))}stop(e){this.outputBuffer.endWrite(e)}[Symbol.asyncIterator](){return this.outputBuffer}}const dV=new Ta("GapFiller"),hV=async e=>{try{await e()}catch(e){if("AbortError"!==e.code)throw e}};class fV{currentTask=void 0;chain;resend;getStorageNodeAddresses;strategy;initialWaitTime;retryWaitTime;maxRequestsPerGap;constructor(e){this.chain=e.chain,this.resend=e.resend,this.getStorageNodeAddresses=e.getStorageNodeAddresses,this.strategy=e.strategy,this.initialWaitTime=e.initialWaitTime,this.retryWaitTime=e.retryWaitTime,this.maxRequestsPerGap=e.maxRequestsPerGap,e.abortSignal.addEventListener("abort",()=>{this.currentTask?.abortController.abort()})}start(){this.chain.on("gapFound",e=>this.onGapFound(e)),this.chain.on("gapResolved",()=>this.onGapResolved())}async onGapFound(e){const t=new AbortController;this.currentTask={gap:e,abortController:t};try{await hV(async()=>{if(await Ga(this.initialWaitTime,t.signal),this.maxRequestsPerGap>0&&await this.fetchFromStorageNode(e,t.signal),"full"===this.strategy)this.chain.resolveMessages(e.to.getMessageRef(),!0);else{if("light"!==this.strategy)throw new Error(`Assertion failed: unexpected gap fill strategy "${this.strategy}"`);this.chain.resolveMessages(void 0,!1)}})}catch(t){this.onError(t,e)}}onGapResolved(){void 0!==this.currentTask&&(this.currentTask.abortController.abort(),this.currentTask=void 0)}async fetchFromStorageNode(e,t){const r=await this.getStorageNodeAddresses();if(r.length>0)for(let n=0;n<this.maxRequestsPerGap;n++){try{await hV(async()=>{const n=this.resend(e,Cc()(r),t);for await(const e of n)this.chain.addMessage(e)})}catch(t){this.onError(t,e)}n!==this.maxRequestsPerGap-1&&await Ga(this.retryWaitTime,t)}}onError(e,t){dV.debug("Unable to fill gap",{error:{message:e?.message,code:e?.code},context:this.chain.getContext(),from:t.from.getMessageRef(),to:t.to.getMessageRef()})}}const pV=new Ta("OrderedMessageChain"),gV=(e,t)=>0===e.compareTo(t);class mV{lastOrderedMsg;currentGap;pendingMsgs;eventEmitter;context;abortSignal;constructor(e,t){this.context=e,this.pendingMsgs=new oc((e,t)=>e.getMessageRef().compareTo(t.getMessageRef())),this.eventEmitter=new zr,this.abortSignal=t,t.addEventListener("abort",()=>{this.eventEmitter.removeAllListeners()})}addMessage(e){this.isStaleMessage(e)||(this.pendingMsgs.push(e),this.consumePendingOrderedMessages(e=>this.isNextOrderedMessage(e)))}resolveMessages(e,t){this.consumePendingOrderedMessages(t=>{if(this.isNextOrderedMessage(t))return!0;if(void 0===e||t.getMessageRef().compareTo(e)<=0){const e={from:this.lastOrderedMsg,to:t};return this.eventEmitter.emit("unfillableGap",e),!0}return!1},t)}async waitUntilIdle(){const e=()=>this.pendingMsgs.isEmpty()||this.abortSignal.aborted;if(!e()){const t=new rc(!1),r=()=>{e()&&t.open()};this.on("orderedMessageAdded",r),this.abortSignal.addEventListener("abort",r),await t.waitUntilOpen(),this.off("orderedMessageAdded",r),this.abortSignal.removeEventListener("abort",r)}}consumePendingOrderedMessages(e,t=!0){for(;!this.pendingMsgs.isEmpty()&&e(this.pendingMsgs.peek());){const e=this.pendingMsgs.pop();this.lastOrderedMsg=e,this.eventEmitter.emit("orderedMessageAdded",e),this.checkGapResolved()}t&&this.checkGapFound()}checkGapFound(){this.pendingMsgs.isEmpty()||void 0!==this.currentGap||(this.currentGap={from:this.lastOrderedMsg,to:this.pendingMsgs.peek()},pV.debug("Gap found",{context:this.context,from:this.currentGap.from.getMessageRef(),to:this.currentGap.to.getMessageRef()}),this.eventEmitter.emit("gapFound",this.currentGap))}checkGapResolved(){if(void 0!==this.currentGap&&gV(this.lastOrderedMsg.getMessageRef(),this.currentGap.to.getMessageRef())){const e=this.currentGap;this.currentGap=void 0,pV.debug("Gap resolved",{context:this.context,from:e.from.getMessageRef(),to:e.to.getMessageRef()}),this.eventEmitter.emit("gapResolved")}}isNextOrderedMessage(e){const t=e.prevMsgRef;return void 0===this.lastOrderedMsg||void 0===t||gV(t,this.lastOrderedMsg.getMessageRef())}isStaleMessage(e){return void 0!==this.lastOrderedMsg&&e.getMessageRef().compareTo(this.lastOrderedMsg.getMessageRef())<=0||this.pendingMsgs.contains(e)}getContext(){return this.context}on(e,t){this.eventEmitter.on(e,t)}once(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}}class yV{chains;outBuffer=new qq;abortController=new AbortController;constructor(e,t,r,n,i){this.chains=kK({valueFactory:async([s,o])=>{const a=((e,t,r,n,i,s)=>{const o=new mV(e,s);return o.on("unfillableGap",e=>r(e)),new fV({chain:o,resend:async function*(t,r,i){const s=await n.resend(e.streamPartId,{from:{timestamp:t.from.getMessageRef().timestamp,sequenceNumber:t.from.getMessageRef().sequenceNumber+1},to:t.to.prevMsgRef,publisherId:e.publisherId,msgChainId:e.msgChainId,raw:!0},async()=>[r],i);yield*s},getStorageNodeAddresses:()=>t(gc.getStreamID(e.streamPartId)),strategy:i.gapFillStrategy,initialWaitTime:i.gapFillTimeout,retryWaitTime:i.retryResendAfter,maxRequestsPerGap:i.gapFill?i.maxGapRequests:0,abortSignal:s}).start(),o})({streamPartId:e,publisherId:s,msgChainId:o},t,r,n,i,this.abortController.signal);return a.on("orderedMessageAdded",e=>this.onOrdered(e)),a}})}onOrdered(e){this.outBuffer.isDone()||ac(()=>this.outBuffer.push(e))}destroy(){this.outBuffer.endWrite(),this.abortController.abort()}async addMessages(e){try{for await(const t of e){if(this.abortController.signal.aborted)return;(await this.chains.get([t.getPublisherId(),t.getMsgChainId()])).addMessage(t)}await Promise.all([...this.chains.values()].map(e=>e.waitUntilIdle())),this.outBuffer.endWrite()}catch(e){this.outBuffer.endWrite(e)}}[Symbol.asyncIterator](){return this.outBuffer}}var bV=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},wV=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},vV=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let EV=class{resends;streamStorageRegistry;streamRegistry;signatureValidator;groupKeyManager;config;destroySignal;loggerFactory;constructor(e,t,r,n,i,s,o,a){this.resends=e,this.streamStorageRegistry=t,this.streamRegistry=r,this.signatureValidator=n,this.groupKeyManager=i,this.config=s,this.destroySignal=o,this.loggerFactory=a}createMessagePipeline(e){return(e=>{const t=e.loggerFactory.createLogger("messagePipeline"),r=new sK,n=new lV(async r=>{if(await z$(r,e.streamRegistry,e.signatureValidator,e.config),r.encryptionType!==V_.NONE&&!Q$(r.encryptionType,e.config))throw new Qz(`A message in stream ${r.getStreamId()} was rejected because the encryption type violates configured requirements (encryptionType: ${r.encryptionType})!`,"ENCRYPTION_POLICY_VIOLATION",r);if(!function(e,t){const r=W$.has(e),n=t.encryption?.requireQuantumResistantSignatures;return r||!n}(r.signatureType,e.config))throw new Qz(`A message in stream ${r.getStreamId()} was rejected because the signature type violates configured requirements (signatureType: ${r.encryptionType})!`,"SIGNATURE_POLICY_VIOLATION",r);let n;if(Mq.isAESEncrypted(r))try{n=await(async(e,t,r)=>{if(r.isDestroyed())return e;let n;try{n=await t.fetchKey(e.getStreamPartID(),e.groupKeyId,e.getPublisherId())}catch{if(r.isDestroyed())return e;throw new Qz(`Could not get encryption key ${e.groupKeyId}`,"DECRYPT_ERROR",e)}if(r.isDestroyed())return e;const[i,s]=WK.decryptStreamMessage(e,n);return void 0!==s&&await t.addKeyToLocalStore(s,e.getPublisherId()),new Mq({...e,content:i,encryptionType:V_.NONE})})(r,e.groupKeyManager,e.destroySignal)}catch(n){throw t.debug("Failed to decrypt",{messageId:r.messageId,err:n}),e.streamRegistry.invalidatePermissionCaches(r.getStreamId()),n}else n=r;return n.getParsedContent(),n},r.onError),i=new WeakSet;if(r.onError.listen((e,t)=>{throw t&&i.add(t.messageId),e&&"messageId"in e&&e.messageId&&i.add(e.messageId),e}),e.config.orderMessages){const t=new yV(e.streamPartId,e.getStorageNodes,()=>{},e.resends,e.config);r.pipe(async function*(e){setImmediate(()=>{t.addMessages(e)}),yield*t}),r.onBeforeFinally.listen(()=>{t.destroy()})}return r.pipe(async function*(e){setImmediate(async()=>{let t;try{for await(const t of e)n.addMessage(t)}catch(e){t=e}await n.flush(),n.stop(t)}),yield*n}).filter(e=>!i.has(e.messageId)),r})({...e,getStorageNodes:e.getStorageNodes??(e=>this.streamStorageRegistry.getStorageNodes(e)),resends:this.resends,streamRegistry:this.streamRegistry,signatureValidator:this.signatureValidator,groupKeyManager:this.groupKeyManager,config:e.config??this.config,destroySignal:this.destroySignal,loggerFactory:this.loggerFactory})}};EV=bV([te(l.ContainerScoped),vV(0,X(X$.Resends)),vV(2,X(F(()=>jK))),vV(4,X(F(()=>cV))),vV(5,X(Zz)),wV("design:paramtypes",[Function,$K,jK,j$,cV,Object,cK,mq])],EV);var AV=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},SV=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},kV=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};const RV=e=>({...e,publisherId:"publisherId"in e&&void 0!==e.publisherId?yc(e.publisherId):void 0});let PV=class{storageNodeRegistry;messagePipelineFactory;config;logger;constructor(e,t,r,n){this.storageNodeRegistry=e,this.messagePipelineFactory=t,this.config=r,this.logger=n.createLogger("Resends")}async resend(e,t,r,n){const i=t.raw??!1;if(function(e){return e&&"object"==typeof e&&"last"in e&&null!=e.last}(t)){if(t.last<=0){const e=new sK;return e.endWrite(),e}return this.fetchStream("last",e,{count:t.last},i,r,n)}if(function(e){return e&&"object"==typeof e&&"from"in e&&"to"in e&&e.to&&null!=e.from}(t))return this.fetchStream("range",e,{fromTimestamp:new Date(t.from.timestamp).getTime(),fromSequenceNumber:t.from.sequenceNumber,toTimestamp:new Date(t.to.timestamp).getTime(),toSequenceNumber:t.to.sequenceNumber,publisherId:t.publisherId,msgChainId:t.msgChainId},i,r,n);if(function(e){return e&&"object"==typeof e&&"from"in e&&!("to"in e)&&null!=e.from}(t))return this.fetchStream("from",e,{fromTimestamp:new Date(t.from.timestamp).getTime(),fromSequenceNumber:t.from.sequenceNumber,publisherId:t.publisherId},i,r,n);throw new Qz(`can not resend without valid resend options: ${JSON.stringify({streamPartId:e,options:t})}`,"INVALID_ARGUMENT")}async fetchStream(e,t,r,n,i,s){const o=qa(5);this.logger.debug("Fetch resend data",{loggerIdx:o,resendType:e,streamPartId:t,query:r});const a=gc.getStreamID(t),c=await i(a);if(!c.length)throw new Qz(`no storage assigned: ${a}`,"NO_STORAGE_NODES");const u=c[Pc()(0,c.length-1)],l=(await this.storageNodeRegistry.getStorageNodeMetadata(u)).urls,d=((e,t,r,n={})=>{const i={...n,format:"raw"},[s,o]=gc.getStreamIDAndPartition(r),a=(e=>{const t=Object.fromEntries(Object.entries(e).filter(([e,t])=>null!=t));return new URLSearchParams(t).toString()})(i);return`${e}/streams/${encodeURIComponent(s)}/data/partitions/${o}/${t}?${a}`})(Cc()(l),e,t,r),h=n?new sK:this.messagePipelineFactory.createMessagePipeline({streamPartId:t,getStorageNodes:async()=>Fr()(c,u),config:1===c.length?{...this.config,orderMessages:!1}:this.config}),f=async function*(e){try{for await(const t of e)yield t}catch(e){throw await(async e=>{let t;if(e instanceof Qq){const r=await e.response.text();let n;try{n=`: ${JSON.parse(r).error}`}catch{n=""}t=`Storage node fetch failed${n}, httpStatus=${e.response.status}, url=${e.response.url}`}else t=e?.message??"Unknown error";return new Qz(t,"STORAGE_NODE_ERROR")})(e)}}(async function*(e,t){$q.debug("Send HTTP request",{url:e});const r=new AbortController,n=Ja(r.signal,t);try{const t=await fetch(e,{signal:n});if($q.debug("Received HTTP response",{url:e,status:t.status}),!t.ok)throw new Qq(t);if(!t.body)throw new Error("No Response Body");let i;try{const e=function(e,t){if("pipe"in e)return e;const r=new ue.PassThrough(t);return async function(e,t){const r=e.getReader(),n=new AbortController;try{for(;;){const{value:e,done:i}=await r.read();if(i)break;if(!t.writable)break;if(!t.write(e))try{await(0,UN.once)(t,"drain",n)}catch(e){if("AbortError"===e.name)break;throw e}}}catch(e){t.destroy(e),n.abort()}finally{t.end();try{await r.cancel()}catch(e){}r.releaseLock()}}(e,r),r}(t.body);i=e.pipe(new cc),e.on("error",e=>i.destroy(e)),i.once("close",()=>{r.abort()}),yield*i}catch(e){throw r.abort(),e}finally{i?.destroy()}}finally{n.destroy()}}(d,s));return setImmediate(async()=>{let e=0;const t=Fq(f,e=>function(e){return Bq.toClientProtocol(Y_.fromBinary(e))}(e));await async function(e,t){if(!e)throw new Error("no source");try{for await(const r of e)if(!await t.push(r))break}catch(e){t.endWrite(e)}finally{t.endWrite()}}(Lq(t,()=>e++),h),this.logger.debug("Finished resend",{loggerIdx:o,messageCount:e})}),h}};function IV(e){return e.filter(Boolean).join("\n")}PV=AV([ee(),kV(0,X(F(()=>Cq))),kV(1,X(F(()=>EV))),kV(2,X(Zz)),SV("design:paramtypes",[Cq,EV,Object,mq])],PV);class CV extends Error{errors;ownMessage;ownStack;constructor(e=[],t=""){const r=IV([t,...e.map(e=>e.message)]);super(r),e.forEach(e=>{Object.assign(this,e)}),this.message=r,this.ownMessage=t,this.errors=new Set(e),this.ownStack=this.stack,this.stack=[this,...e].flatMap(e=>function(e){return e instanceof CV?[e.ownStack,...[...e.errors].map(({stack:e})=>e)]:[e.stack]}(e)).filter(Boolean).join("\n")}static fromAllSettled(e=[],t=""){const r=e.map(({reason:e})=>e).filter(Boolean);if(r.length)return new this(r,t)}static throwAllSettled(e=[],t=""){const r=this.fromAllSettled(e,t);if(r)throw r}static from(e,t,r){return t?e?e instanceof CV?e.extend(t,r,this):new this([e]).extend(t,r):(t&&r&&(t.message=IV([t.message,r])),t):(e&&r&&(e.message=IV([e.message,r])),e)}extend(e,t="",r=this.constructor){return e===this||this.errors.has(e)?this:new r([e,...this.errors],IV([t,this.ownMessage]))}}const _V=()=>{};function TV(e=[],t,{id:r="",onError:n,onDone:i,onChange:s}={}){let o;const a=e.slice().reverse().map(e=>async()=>{const t=await e();return"function"==typeof t?t:_V}),c=[],u=[],l=XE()(1);let d=!1,h=!1;function f(e){try{if("function"!=typeof n)throw e;n(e)}catch(e){o=CV.from(o,e,`ScaffoldError:${r}`)}}let p=!1,g=!1;const m=XE()(1);async function y(){p=await(async()=>{if(o)return!1;try{return await t()}catch(e){f(e)}return!1})();const e=g!==p;if(g=p,e&&"function"==typeof s){try{await s(p)}catch(e){f(e)}return y()}if(p){if(a.length){let e;d=!1,h=!0;const t=a.pop();c.push(t);try{e=await t()}catch(e){f(e)}return u.push(e??(()=>{})),void await y()}}else{if(u.length){d=!1,h=!0;const e=u.pop();try{await e()}catch(e){f(e)}return a.push(c.pop()),void await y()}if(o){const e=o;throw o=void 0,d=!0,e}}return d=!0,Promise.resolve()}function b(){return!(h&&d&&!l.activeCount&&!l.pendingCount)}const w=async()=>{await m(()=>y())};let v;return Object.assign(async()=>{let e;try{v=l(()=>w()),await v}catch(t){throw e=t,t}finally{if(!b()&&(h=!1,"function"==typeof i)){const t=e;e=void 0,await i(p,t)}}},{next:w,isActive:b,getCurrentStep:()=>v,get activeCount(){return l.activeCount},get pendingCount(){return l.pendingCount},setError(e){o=CV.from(o,e)},getError:()=>o,clearError(){const e=o;return o=void 0,e}})}class NV{streamPartId;onRetired=tK.once();isRetired=!1;isStopped=!1;subscriptions=new Set;pendingRemoval=new WeakSet;pipeline;node;constructor(e,t,r){this.streamPartId=e,this.distributeMessage=this.distributeMessage.bind(this),this.node=r,this.onError=this.onError.bind(this),this.pipeline=t.createMessagePipeline({streamPartId:e}),this.pipeline.onError.listen(this.onError),this.pipeline.pipe(this.distributeMessage).onBeforeFinally.listen(async()=>{this.isStopped||await this.stop()}),this.pipeline.flow()}async retire(){this.isRetired||(this.isRetired=!0,await this.onRetired.trigger())}async onError(e){await Promise.allSettled([...this.subscriptions].map(async t=>{await t.handleError(e)}))}async*distributeMessage(e){for await(const t of e)await Promise.all([...this.subscriptions].map(async e=>{await e.push(t)})),yield t}onMessageInput=async e=>{if(!e||this.isStopped||this.isRetired)return;if(e.getStreamPartID()!==this.streamPartId)return;if(e.messageType!==Dq.MESSAGE)return;const t=[];let r=!1;for(const n of this.subscriptions.values())n.isRaw?t.push(n.push(e)):r=!0;r&&t.push(this.pipeline.push(e)),await Promise.all(t)};async subscribe(){if(this.node.addMessageListener(this.onMessageInput),!await this.node.isProxiedStreamPart(this.streamPartId)){const e=(()=>this.subscriptions.values().next().value)().deliveryOptions;await this.node.join(this.streamPartId,void 0,e)}}async unsubscribe(){this.pipeline.end(),this.pipeline.return(),this.pipeline.onError.end(new Error("done")),this.node.removeMessageListener(this.onMessageInput),await this.node.leave(this.streamPartId)}updateNodeSubscriptions=(()=>TV([async()=>(await this.subscribe(),async()=>{await this.unsubscribe(),await this.stop()})],()=>this.shouldBeSubscribed()))();async updateSubscriptions(){await this.updateNodeSubscriptions(),this.shouldBeSubscribed()||this.isStopped||await this.stop()}shouldBeSubscribed(){return!this.isRetired&&!this.isStopped&&!!this.count()}async stop(){this.isStopped=!0,this.pipeline.end(),await this.retire(),await this.pipeline.return()}has(e){return this.subscriptions.has(e)}async add(e){if(!e||this.subscriptions.has(e)||this.pendingRemoval.has(e))return;const t=this.getERC1271ContractAddress();if(this.subscriptions.size>0&&t!==e.erc1271ContractAddress)throw new Error("Subscription ERC-1271 mismatch");this.subscriptions.add(e),e.onBeforeFinally.listen(()=>this.remove(e)),await this.updateSubscriptions()}async remove(e){if(e&&!this.pendingRemoval.has(e)&&this.subscriptions.has(e)){this.pendingRemoval.add(e),this.subscriptions.delete(e);try{e.isDone()||await e.unsubscribe()}finally{await this.updateSubscriptions()}}}getERC1271ContractAddress(){for(const e of this.subscriptions)if(void 0!==e.erc1271ContractAddress)return e.erc1271ContractAddress}count(){return this.subscriptions.size}}var xV=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},OV=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},DV=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let MV=class{subSessions=new Map;node;messagePipelineFactory;logger;constructor(e,t,r){this.node=e,this.messagePipelineFactory=t,this.logger=r.createLogger("Subscriber")}getOrCreateSubscriptionSession(e){if(this.subSessions.has(e))return this.getSubscriptionSession(e);const t=new NV(e,this.messagePipelineFactory,this.node);return this.subSessions.set(e,t),t.onRetired.listen(()=>{this.subSessions.delete(e)}),this.logger.debug("Created new SubscriptionSession",{streamPartId:e}),t}async add(e){const t=this.getOrCreateSubscriptionSession(e.streamPartId);try{await t.add(e)}catch(t){throw this.logger.debug("Failed to add Subscription to SubscriptionSession",t),await this.remove(e),t}}async remove(e){const t=this.subSessions.get(e.streamPartId);t&&await t.remove(e)}getSubscriptions(){return[...this.subSessions.values()].reduce((e,t)=>(e.push(...t.subscriptions),e),[])}getERC1271ContractAddress(e){return this.subSessions.get(e)?.getERC1271ContractAddress()}getSubscriptionSession(e){return this.subSessions.get(e)}countSubscriptionSessions(){return this.subSessions.size}};MV=xV([ee(),DV(1,X(F(()=>EV))),OV("design:paramtypes",[g$,EV,mq])],MV),Q.register(X$.Resends,{useClass:PV},{lifecycle:l.ContainerScoped}),Q.register(X$.Subscriber,{useClass:MV},{lifecycle:l.ContainerScoped}),Q.constructor.prototype.resolveParams=function(e,t){return(r,n)=>{try{return(0,Bx.X2)(r)?(0,Bx.gC)(r)?r.multiple?this.resolve(r.transform).transform(this.resolveAll(r.token),...r.transformArgs):this.resolve(r.transform).transform(this.resolve(r.token,e),...r.transformArgs):r.multiple?this.resolveAll(r.token):this.resolve(r.token,e):(0,Bx.gC)(r)?this.resolve(r.transform,e).transform(this.resolve(r.token,e),...r.transformArgs):this.resolve(r,e)}catch(e){throw e.message=(0,Lx.O)(t,n,e),e}}};class BV{currentGroupKey;queuedGroupKey;streamId;identity;groupKeyManager;static async createInstance(e,t,r,n){const i=new BV(e,t,r);return i.currentGroupKey=n??await i.groupKeyManager.fetchLatestEncryptionKey(await t.getUserId(),e)??void 0,i}constructor(e,t,r){this.streamId=e,this.identity=t,this.groupKeyManager=r}async useGroupKey(){this.currentGroupKey||(this.currentGroupKey=this.queuedGroupKey??await this.rekey(),this.queuedGroupKey=void 0);const e={current:this.currentGroupKey,next:this.queuedGroupKey};return this.queuedGroupKey&&(this.currentGroupKey=this.queuedGroupKey,this.queuedGroupKey=void 0),e}async rotate(e){const t=await this.identity.getUserId();return e=await this.groupKeyManager.storeKey(e,t,this.streamId),this.queuedGroupKey=e,e}async rekey(e){const t=await this.identity.getUserId();return e=await this.groupKeyManager.storeKey(e,t,this.streamId),this.currentGroupKey=e,this.queuedGroupKey=void 0,e}}class LV{streamId;identity;defaultPartition;defaultMessageChainIds;prevMsgRefs=new Map;streamRegistry;groupKeyQueue;signatureValidator;messageSigner;config;firstMessage=!0;constructor(e){this.streamId=e.streamId,this.identity=e.identity,this.streamRegistry=e.streamRegistry,this.groupKeyQueue=e.groupKeyQueue,this.signatureValidator=e.signatureValidator,this.messageSigner=e.messageSigner,this.config=e.config,this.defaultMessageChainIds=kK({valueFactory:async()=>m$()})}async createMessage(e,t,r){const n=await this.getPublisherId(t);if(this.config.validation.permissions&&!await this.streamRegistry.isStreamPublisher(this.streamId,n))throw this.streamRegistry.invalidatePermissionCaches(this.streamId),new Qz(`You don't have permission to publish to this stream. Using address: ${n}`,"MISSING_PERMISSION");let i;if(this.config.validation.partitions){const e=await this.streamRegistry.getStreamMetadata(this.streamId),n=gK(e);if(void 0!==r){if(r<0||r>=n)throw new Error(`Partition ${r} is out of range (0..${n-1})`);if(void 0!==t.partitionKey)throw new Error('Invalid combination of "partition" and "partitionKey"');i=r}else i=void 0!==t.partitionKey?function(e,t){if(!(Number.isSafeInteger(e)&&e>0))throw new Error(`lengthOfArray is not a safe positive integer! ${e}`);if(1===e)return 0;if("number"==typeof t)return Math.abs(t)%e;const r=ka(t).readInt32LE(0);return Math.abs(r)%e}(n,t.partitionKey):this.getDefaultPartition(n)}else{if(void 0===r)throw new Error("Explicit partition must be set when partition validation is disabled");i=r}const s=t.msgChainId??await this.defaultMessageChainIds.get(i),o=Zq([i,s]),a=this.prevMsgRefs.get(o),c=((e,t)=>{if(void 0!==t&&e<t.timestamp)throw new Error("prevMessageRef must come before current");const r=t?.timestamp===e?t.sequenceNumber+1:0;return new xq(e,r)})(t.timestamp,a);this.prevMsgRefs.set(o,c);const u=new Oq(this.streamId,i,c.timestamp,c.sequenceNumber,n,s),l=this.config.validation.permissions&&await this.streamRegistry.hasPublicSubscribePermission(this.streamId)?V_.NONE:V_.AES;if(!Q$(l,this.config))throw new Qz(`Publishing to stream ${this.streamId} was prevented because configuration requires encryption!`,"ENCRYPTION_POLICY_VIOLATION");let d,h,f,p;if(e instanceof Uint8Array?(p=$_.BINARY,f=e):(p=$_.JSON,f=ho(JSON.stringify(e))),l===V_.AES){const e=await this.groupKeyQueue.useGroupKey();f=WK.encryptWithAES(f,e.current.data),d=e.current.id,void 0!==e.next&&(h=e.current.encryptNextGroupKey(e.next))}const g=await this.messageSigner.createSignedMessage({messageId:u,messageType:Dq.MESSAGE,content:f,prevMsgRef:a,encryptionType:l,groupKeyId:d,newGroupKey:h,contentType:p},void 0!==t.erc1271Contract?W_.ERC_1271:this.identity.getSignatureType());return this.firstMessage&&(this.firstMessage=!1,void 0!==t.erc1271Contract&&await this.signatureValidator.assertSignatureIsValid(g)),g}async getPublisherId(e){return void 0!==e.erc1271Contract?yc(ts(e.erc1271Contract)):this.identity.getUserId()}getDefaultPartition(e){return(void 0===this.defaultPartition||this.defaultPartition>=e)&&(this.defaultPartition=Pc()(e-1)),this.defaultPartition}}var FV=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},UV=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},jV=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let zV=class{messageFactories;groupKeyQueues;concurrencyLimit=XE()(1);node;streamRegistry;streamIdBuilder;identity;signatureValidator;messageSigner;config;constructor(e,t,r,n,i,s,o,a){this.node=e,this.streamRegistry=t,this.streamIdBuilder=n,this.identity=i,this.signatureValidator=s,this.messageSigner=o,this.config=a,this.messageFactories=kK({valueFactory:async e=>this.createMessageFactory(e)}),this.groupKeyQueues=kK({valueFactory:async e=>{const t=await aV(e,this.streamIdBuilder,this.config.encryption);return await BV.createInstance(e,this.identity,r,t)}})}async publish(e,t,r,n){const i=(e=>void 0===e?.timestamp?Date.now():e.timestamp instanceof Date?e.timestamp.getTime():zx()(e.timestamp)?new Date(e.timestamp).getTime():e.timestamp)(r);return this.concurrencyLimit(async()=>{const[s,o]=await this.streamIdBuilder.toStreamPartElements(e);try{const e=await this.messageFactories.get(s),a=await e.createMessage(t,{...r,timestamp:i},o);return await this.node.broadcast(a,n),a}catch(e){const t=e instanceof Qz?e.code:"UNKNOWN_ERROR";throw new Qz(`Failed to publish to stream ${s}. Cause: ${e.message}`,t)}})}getGroupKeyQueue(e){return this.groupKeyQueues.get(e)}async createMessageFactory(e){return new LV({streamId:e,identity:this.identity,streamRegistry:this.streamRegistry,groupKeyQueue:await this.groupKeyQueues.get(e),signatureValidator:this.signatureValidator,messageSigner:this.messageSigner,config:this.config})}};function qV(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}zV=FV([te(l.ContainerScoped),jV(4,X(eq)),jV(7,X(Zz)),UV("design:paramtypes",[g$,jK,cV,fK,tq,j$,E$,Object])],zV);var KV,GV={exports:{}},$V=function(){if(KV)return GV.exports;KV=1,GV.exports=u,GV.exports.default=u;const e={properties:{environment:{type:"string",enum:["polygon","polygonAmoy","peaq","iotex","dev2"],description:"applies all environment-specific defaults for the given environment"},id:{type:"string"},logLevel:{type:"string",enum:["silent","fatal","error","warn","info","debug","trace"],default:"info"},auth:{type:"object",additionalProperties:!1,properties:{publicKey:{type:"string",format:"hex-string"},privateKey:{type:"string",format:"hex-string"},keyType:{type:"string",default:"ECDSA_SECP256K1_EVM"},ethereum:{type:"object"},identity:{type:"object"}}},orderMessages:{type:"boolean",default:!0},gapFill:{type:"boolean",default:!0},maxGapRequests:{type:"number",default:5},retryResendAfter:{type:"number",default:5e3},gapFillTimeout:{type:"number",default:5e3},gapFillStrategy:{type:"string",enum:["light","full"],default:"light"},network:{type:"object",additionalProperties:!1,required:[],properties:{controlLayer:{type:"object",additionalProperties:!1,properties:{entryPoints:{type:"array",items:{$ref:"#/definitions/peerDescriptor"}},entryPointDiscovery:{type:"object",additionalProperties:!1,properties:{enabled:{type:"boolean"},maxEntryPoints:{type:"number"},maxQueryResults:{type:"number"},maxHeartbeatAgeHours:{type:"number"}},default:{enabled:!0,maxEntryPoints:5,maxQueryResults:50,maxHeartbeatAgeHours:24}},websocketPortRange:{anyOf:[{type:"null"},{$ref:"#/definitions/portRange"}],default:{min:32200,max:32250}},websocketHost:{type:"string",format:"hostname"},peerDescriptor:{$ref:"#/definitions/peerDescriptor"},maxConnections:{type:"number",default:80},tlsCertificate:{description:"Files to use for TLS",type:"object",required:["certFileName","privateKeyFileName"],additionalProperties:!1,properties:{certFileName:{type:"string",description:"Path of certificate file"},privateKeyFileName:{type:"string",description:"Path of private key file"}}},iceServers:{type:"array",items:{type:"object",required:["url","port"],additionalProperties:!1,properties:{url:{type:"string"},port:{type:"number"},username:{type:"string"},password:{type:"string"},tcp:{type:"boolean"}}},default:[{url:"stun:stun.streamr.network",port:5349},{url:"turn:turn.streamr.network",port:5349,username:"BrubeckTurn1",password:"MIlbgtMw4nhpmbgqRrht1Q=="},{url:"turn:turn.streamr.network",port:5349,username:"BrubeckTurn1",password:"MIlbgtMw4nhpmbgqRrht1Q==",tcp:!0}]},webrtcAllowPrivateAddresses:{type:"boolean",default:!1},webrtcDatachannelBufferThresholdLow:{type:"number",default:32768},webrtcDatachannelBufferThresholdHigh:{type:"number",default:131072},maxMessageSize:{type:"number",default:1048576},externalIp:{type:"string",format:"ipv4"},webrtcPortRange:{$ref:"#/definitions/portRange",default:{min:5e4,max:64e3}},networkConnectivityTimeout:{type:"number",default:1e4},websocketServerEnableTls:{type:"boolean",default:!0},autoCertifierUrl:{type:"string",default:"https://ns1.streamr-nodes.xyz:59833"},autoCertifierConfigFile:{type:"string",default:"~/.streamr/certificate.json"},geoIpDatabaseFolder:{type:"string"}},default:{}},node:{type:"object",additionalProperties:!1,properties:{streamPartitionNeighborTargetCount:{type:"number",default:4},streamPartitionMinPropagationTargets:{type:"number",default:2},streamPartitionMaxPropagationBufferSize:{type:"number",default:150},contentDeliveryBufferWhileConnecting:{type:"boolean",default:!0},acceptProxyConnections:{type:"boolean",default:!1}},default:{}}},default:{}},contracts:{type:"object",additionalProperties:!1,properties:{ethereumNetwork:{type:"object",additionalProperties:!1,properties:{chainId:{type:"number"},overrides:{type:"object"},highGasPriceStrategy:{type:"boolean"}},default:{}},streamRegistryChainAddress:{type:"string",format:"ethereum-address"},streamStorageRegistryChainAddress:{type:"string",format:"ethereum-address"},storageNodeRegistryChainAddress:{type:"string",format:"ethereum-address"},sponsorshipFactoryChainAddress:{type:"string",format:"ethereum-address"},rpcs:{type:"array",items:{type:"object",$ref:"#/definitions/rpcProviderConfig"},minItems:1},rpcQuorum:{type:"number",default:2},theGraphUrl:{type:"string",format:"uri"},maxConcurrentCalls:{type:"number",default:10},pollInterval:{type:"number",default:4e3}},default:{}},encryption:{type:"object",additionalProperties:!1,properties:{keyRequestTimeout:{type:"number",default:3e4},maxKeyRequestsPerSecond:{type:"number",default:20},rsaKeyLength:{type:"number",default:4096},requireQuantumResistantKeyExchange:{type:"boolean",default:!1},requireQuantumResistantSignatures:{type:"boolean",default:!1},requireQuantumResistantEncryption:{type:"boolean",default:!1},keys:{type:"object",propertyNames:{$ref:"#/definitions/streamIdOrPath"},additionalProperties:{$ref:"#/definitions/encryptionKey"}}},default:{}},validation:{type:"object",additionalProperties:!1,properties:{permissions:{type:"boolean",default:!0},partitions:{type:"boolean",default:!0}},default:{}},metrics:{anyOf:[{type:"boolean"},{type:"object",additionalProperties:!1,properties:{periods:{type:"array",items:{type:"object",required:["streamId","duration"],properties:{id:{type:"string"},duration:{type:"number"}}}},maxPublishDelay:{type:"number"}}}]},cache:{type:"object",additionalProperties:!1,properties:{maxSize:{type:"number",default:1e4},maxAge:{type:"number",default:864e5}},default:{}},_timeouts:{type:"object",additionalProperties:!1,properties:{theGraph:{type:"object",additionalProperties:!1,properties:{indexTimeout:{type:"number",default:6e4},indexPollInterval:{type:"number",default:1e3},fetchTimeout:{type:"number",default:3e4}},default:{}},storageNode:{type:"object",additionalProperties:!1,properties:{timeout:{type:"number",default:3e4},retryInterval:{type:"number",default:1e3}},default:{}},ensStreamCreation:{type:"object",additionalProperties:!1,properties:{timeout:{type:"number",default:18e4},retryInterval:{type:"number",default:1e3}},default:{}},jsonRpcTimeout:{type:"number",default:3e4}},default:{}}}},t=Object.prototype.hasOwnProperty,r=/^(0x)?[a-fA-F0-9]+$/,n=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,i=/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,s=/^0x[a-fA-F0-9]{40}$/,o=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,a={enum:["browser","nodejs"]};function c(e,{instancePath:t="",parentData:r,parentDataProperty:n,rootData:i=e}={}){if(!e||"object"!=typeof e||Array.isArray(e))return c.errors=[{instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;for(const r in e)if("nodeId"!==r&&"id"!==r&&"type"!==r&&"websocket"!==r)return c.errors=[{instancePath:t,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:r},message:"must NOT have additional properties"}],!1;if(void 0!==e.nodeId){const r=0;if("string"!=typeof e.nodeId)return c.errors=[{instancePath:t+"/nodeId",schemaPath:"#/properties/nodeId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var s=0===r}else s=!0;if(s){if(void 0!==e.id){const r=0;if("string"!=typeof e.id)return c.errors=[{instancePath:t+"/id",schemaPath:"#/properties/id/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;s=0===r}else s=!0;if(s){if(void 0!==e.type){let r=e.type;const n=0;if("string"!=typeof r)return c.errors=[{instancePath:t+"/type",schemaPath:"#/definitions/nodeType/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if("browser"!==r&&"nodejs"!==r)return c.errors=[{instancePath:t+"/type",schemaPath:"#/definitions/nodeType/enum",keyword:"enum",params:{allowedValues:a.enum},message:"must be equal to one of the allowed values"}],!1;s=0===n}else s=!0;if(s)if(void 0!==e.websocket){let r=e.websocket;const n=0;if(!r||"object"!=typeof r||Array.isArray(r))return c.errors=[{instancePath:t+"/websocket",schemaPath:"#/definitions/connectivityMethod/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let e;if(void 0===r.host&&(e="host")||void 0===r.port&&(e="port")||void 0===r.tls&&(e="tls"))return c.errors=[{instancePath:t+"/websocket",schemaPath:"#/definitions/connectivityMethod/required",keyword:"required",params:{missingProperty:e},message:"must have required property '"+e+"'"}],!1;for(const e in r)if("host"!==e&&"port"!==e&&"tls"!==e)return c.errors=[{instancePath:t+"/websocket",schemaPath:"#/definitions/connectivityMethod/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"}],!1;if(void 0!==r.host){const e=0;if("string"!=typeof r.host)return c.errors=[{instancePath:t+"/websocket/host",schemaPath:"#/definitions/connectivityMethod/properties/host/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var o=0===e}else o=!0;if(o){if(void 0!==r.port){let e=r.port;const n=0;if("number"!=typeof e||!isFinite(e))return c.errors=[{instancePath:t+"/websocket/port",schemaPath:"#/definitions/connectivityMethod/properties/port/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;o=0===n}else o=!0;if(o)if(void 0!==r.tls){const e=0;if("boolean"!=typeof r.tls)return c.errors=[{instancePath:t+"/websocket/tls",schemaPath:"#/definitions/connectivityMethod/properties/tls/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;o=0===e}else o=!0}}s=0===n}else s=!0}}return c.errors=null,!0}function u(a,{instancePath:l="",parentData:d,parentDataProperty:h,rootData:f=a}={}){let p=null,g=0;if(0===g){if(!a||"object"!=typeof a||Array.isArray(a))return u.errors=[{instancePath:l,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===a.logLevel&&(a.logLevel="info"),void 0===a.orderMessages&&(a.orderMessages=!0),void 0===a.gapFill&&(a.gapFill=!0),void 0===a.maxGapRequests&&(a.maxGapRequests=5),void 0===a.retryResendAfter&&(a.retryResendAfter=5e3),void 0===a.gapFillTimeout&&(a.gapFillTimeout=5e3),void 0===a.gapFillStrategy&&(a.gapFillStrategy="light"),void 0===a.network&&(a.network={}),void 0===a.contracts&&(a.contracts={}),void 0===a.encryption&&(a.encryption={}),void 0===a.validation&&(a.validation={}),void 0===a.cache&&(a.cache={}),void 0===a._timeouts&&(a._timeouts={});const d=g;for(const r in a)if(!t.call(e.properties,r))return u.errors=[{instancePath:l,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:r},message:"must NOT have additional properties"}],!1;if(d===g){if(void 0!==a.environment){let t=a.environment;const r=g;if("string"!=typeof t)return u.errors=[{instancePath:l+"/environment",schemaPath:"#/properties/environment/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if("polygon"!==t&&"polygonAmoy"!==t&&"peaq"!==t&&"iotex"!==t&&"dev2"!==t)return u.errors=[{instancePath:l+"/environment",schemaPath:"#/properties/environment/enum",keyword:"enum",params:{allowedValues:e.properties.environment.enum},message:"must be equal to one of the allowed values"}],!1;var m=r===g}else m=!0;if(m){if(void 0!==a.id){const e=g;if("string"!=typeof a.id)return u.errors=[{instancePath:l+"/id",schemaPath:"#/properties/id/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;m=e===g}else m=!0;if(m){let d=a.logLevel;const h=g;if("string"!=typeof d)return u.errors=[{instancePath:l+"/logLevel",schemaPath:"#/properties/logLevel/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if("silent"!==d&&"fatal"!==d&&"error"!==d&&"warn"!==d&&"info"!==d&&"debug"!==d&&"trace"!==d)return u.errors=[{instancePath:l+"/logLevel",schemaPath:"#/properties/logLevel/enum",keyword:"enum",params:{allowedValues:e.properties.logLevel.enum},message:"must be equal to one of the allowed values"}],!1;if(m=h===g){if(void 0!==a.auth){let e=a.auth;const t=g;if(g===t){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/auth",schemaPath:"#/properties/auth/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===e.keyType&&(e.keyType="ECDSA_SECP256K1_EVM");const t=g;for(const t in e)if("publicKey"!==t&&"privateKey"!==t&&"keyType"!==t&&"ethereum"!==t&&"identity"!==t)return u.errors=[{instancePath:l+"/auth",schemaPath:"#/properties/auth/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){if(void 0!==e.publicKey){let t=e.publicKey;const n=g;if(g===n&&g===n){if("string"!=typeof t)return u.errors=[{instancePath:l+"/auth/publicKey",schemaPath:"#/properties/auth/properties/publicKey/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!r.test(t))return u.errors=[{instancePath:l+"/auth/publicKey",schemaPath:"#/properties/auth/properties/publicKey/format",keyword:"format",params:{format:"hex-string"},message:'must match format "hex-string"'}],!1}var y=n===g}else y=!0;if(y){if(void 0!==e.privateKey){let t=e.privateKey;const n=g;if(g===n&&g===n){if("string"!=typeof t)return u.errors=[{instancePath:l+"/auth/privateKey",schemaPath:"#/properties/auth/properties/privateKey/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!r.test(t))return u.errors=[{instancePath:l+"/auth/privateKey",schemaPath:"#/properties/auth/properties/privateKey/format",keyword:"format",params:{format:"hex-string"},message:'must match format "hex-string"'}],!1}y=n===g}else y=!0;if(y){const t=g;if("string"!=typeof e.keyType)return u.errors=[{instancePath:l+"/auth/keyType",schemaPath:"#/properties/auth/properties/keyType/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(y=t===g){if(void 0!==e.ethereum){let t=e.ethereum;const r=g;if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/auth/ethereum",schemaPath:"#/properties/auth/properties/ethereum/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;y=r===g}else y=!0;if(y)if(void 0!==e.identity){let t=e.identity;const r=g;if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/auth/identity",schemaPath:"#/properties/auth/properties/identity/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;y=r===g}else y=!0}}}}}}m=t===g}else m=!0;if(m){const d=g;if("boolean"!=typeof a.orderMessages)return u.errors=[{instancePath:l+"/orderMessages",schemaPath:"#/properties/orderMessages/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;if(m=d===g){const d=g;if("boolean"!=typeof a.gapFill)return u.errors=[{instancePath:l+"/gapFill",schemaPath:"#/properties/gapFill/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;if(m=d===g){let d=a.maxGapRequests;const h=g;if("number"!=typeof d||!isFinite(d))return u.errors=[{instancePath:l+"/maxGapRequests",schemaPath:"#/properties/maxGapRequests/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(m=h===g){let d=a.retryResendAfter;const h=g;if("number"!=typeof d||!isFinite(d))return u.errors=[{instancePath:l+"/retryResendAfter",schemaPath:"#/properties/retryResendAfter/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(m=h===g){let d=a.gapFillTimeout;const h=g;if("number"!=typeof d||!isFinite(d))return u.errors=[{instancePath:l+"/gapFillTimeout",schemaPath:"#/properties/gapFillTimeout/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(m=h===g){let d=a.gapFillStrategy;const h=g;if("string"!=typeof d)return u.errors=[{instancePath:l+"/gapFillStrategy",schemaPath:"#/properties/gapFillStrategy/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if("light"!==d&&"full"!==d)return u.errors=[{instancePath:l+"/gapFillStrategy",schemaPath:"#/properties/gapFillStrategy/enum",keyword:"enum",params:{allowedValues:e.properties.gapFillStrategy.enum},message:"must be equal to one of the allowed values"}],!1;if(m=h===g){let d=a.network;const h=g;if(g===h){if(!d||"object"!=typeof d||Array.isArray(d))return u.errors=[{instancePath:l+"/network",schemaPath:"#/properties/network/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===d.controlLayer&&(d.controlLayer={}),void 0===d.node&&(d.node={});const r=g;for(const e in d)if("controlLayer"!==e&&"node"!==e)return u.errors=[{instancePath:l+"/network",schemaPath:"#/properties/network/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"}],!1;if(r===g){let r=d.controlLayer;const s=g;if(g===s){if(!r||"object"!=typeof r||Array.isArray(r))return u.errors=[{instancePath:l+"/network/controlLayer",schemaPath:"#/properties/network/properties/controlLayer/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===r.entryPointDiscovery&&(r.entryPointDiscovery={enabled:!0,maxEntryPoints:5,maxQueryResults:50,maxHeartbeatAgeHours:24}),void 0===r.websocketPortRange&&(r.websocketPortRange={min:32200,max:32250}),void 0===r.maxConnections&&(r.maxConnections=80),void 0===r.iceServers&&(r.iceServers=[{url:"stun:stun.streamr.network",port:5349},{url:"turn:turn.streamr.network",port:5349,username:"BrubeckTurn1",password:"MIlbgtMw4nhpmbgqRrht1Q=="},{url:"turn:turn.streamr.network",port:5349,username:"BrubeckTurn1",password:"MIlbgtMw4nhpmbgqRrht1Q==",tcp:!0}]),void 0===r.webrtcAllowPrivateAddresses&&(r.webrtcAllowPrivateAddresses=!1),void 0===r.webrtcDatachannelBufferThresholdLow&&(r.webrtcDatachannelBufferThresholdLow=32768),void 0===r.webrtcDatachannelBufferThresholdHigh&&(r.webrtcDatachannelBufferThresholdHigh=131072),void 0===r.maxMessageSize&&(r.maxMessageSize=1048576),void 0===r.webrtcPortRange&&(r.webrtcPortRange={min:5e4,max:64e3}),void 0===r.networkConnectivityTimeout&&(r.networkConnectivityTimeout=1e4),void 0===r.websocketServerEnableTls&&(r.websocketServerEnableTls=!0),void 0===r.autoCertifierUrl&&(r.autoCertifierUrl="https://ns1.streamr-nodes.xyz:59833"),void 0===r.autoCertifierConfigFile&&(r.autoCertifierConfigFile="~/.streamr/certificate.json");const s=g;for(const n in r)if(!t.call(e.properties.network.properties.controlLayer.properties,n))return u.errors=[{instancePath:l+"/network/controlLayer",schemaPath:"#/properties/network/properties/controlLayer/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:n},message:"must NOT have additional properties"}],!1;if(s===g){if(void 0!==r.entryPoints){let e=r.entryPoints;const t=g;if(g===t){if(!Array.isArray(e))return u.errors=[{instancePath:l+"/network/controlLayer/entryPoints",schemaPath:"#/properties/network/properties/controlLayer/properties/entryPoints/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;{const t=e.length;for(let r=0;r<t;r++){const t=g;if(c(e[r],{instancePath:l+"/network/controlLayer/entryPoints/"+r,parentData:e,parentDataProperty:r,rootData:f})||(p=null===p?c.errors:p.concat(c.errors),g=p.length),t!==g)break}}}var b=t===g}else b=!0;if(b){let e=r.entryPointDiscovery;const t=g;if(g===t){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/network/controlLayer/entryPointDiscovery",schemaPath:"#/properties/network/properties/controlLayer/properties/entryPointDiscovery/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{const t=g;for(const t in e)if("enabled"!==t&&"maxEntryPoints"!==t&&"maxQueryResults"!==t&&"maxHeartbeatAgeHours"!==t)return u.errors=[{instancePath:l+"/network/controlLayer/entryPointDiscovery",schemaPath:"#/properties/network/properties/controlLayer/properties/entryPointDiscovery/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){if(void 0!==e.enabled){const t=g;if("boolean"!=typeof e.enabled)return u.errors=[{instancePath:l+"/network/controlLayer/entryPointDiscovery/enabled",schemaPath:"#/properties/network/properties/controlLayer/properties/entryPointDiscovery/properties/enabled/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var w=t===g}else w=!0;if(w){if(void 0!==e.maxEntryPoints){let t=e.maxEntryPoints;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/network/controlLayer/entryPointDiscovery/maxEntryPoints",schemaPath:"#/properties/network/properties/controlLayer/properties/entryPointDiscovery/properties/maxEntryPoints/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;w=r===g}else w=!0;if(w){if(void 0!==e.maxQueryResults){let t=e.maxQueryResults;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/network/controlLayer/entryPointDiscovery/maxQueryResults",schemaPath:"#/properties/network/properties/controlLayer/properties/entryPointDiscovery/properties/maxQueryResults/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;w=r===g}else w=!0;if(w)if(void 0!==e.maxHeartbeatAgeHours){let t=e.maxHeartbeatAgeHours;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/network/controlLayer/entryPointDiscovery/maxHeartbeatAgeHours",schemaPath:"#/properties/network/properties/controlLayer/properties/entryPointDiscovery/properties/maxHeartbeatAgeHours/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;w=r===g}else w=!0}}}}}if(b=t===g){let e=r.websocketPortRange;const t=g,s=g;let o=!1;const a=g;if(null!==e){const e={instancePath:l+"/network/controlLayer/websocketPortRange",schemaPath:"#/properties/network/properties/controlLayer/properties/websocketPortRange/anyOf/0/type",keyword:"type",params:{type:"null"},message:"must be null"};null===p?p=[e]:p.push(e),g++}var v=a===g;if(o=o||v,!o){const t=g;if(g==g)if(e&&"object"==typeof e&&!Array.isArray(e)){let t;if(void 0===e.min&&(t="min")||void 0===e.max&&(t="max")){const e={instancePath:l+"/network/controlLayer/websocketPortRange",schemaPath:"#/definitions/portRange/required",keyword:"required",params:{missingProperty:t},message:"must have required property '"+t+"'"};null===p?p=[e]:p.push(e),g++}else{const t=g;for(const t in e)if("min"!==t&&"max"!==t){const e={instancePath:l+"/network/controlLayer/websocketPortRange",schemaPath:"#/definitions/portRange/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"};null===p?p=[e]:p.push(e),g++;break}if(t===g){if(void 0!==e.min){let t=e.min;const r=g;if("number"!=typeof t||!isFinite(t)){const e={instancePath:l+"/network/controlLayer/websocketPortRange/min",schemaPath:"#/definitions/portRange/properties/min/type",keyword:"type",params:{type:"number"},message:"must be number"};null===p?p=[e]:p.push(e),g++}var E=r===g}else E=!0;if(E)if(void 0!==e.max){let t=e.max;const r=g;if("number"!=typeof t||!isFinite(t)){const e={instancePath:l+"/network/controlLayer/websocketPortRange/max",schemaPath:"#/definitions/portRange/properties/max/type",keyword:"type",params:{type:"number"},message:"must be number"};null===p?p=[e]:p.push(e),g++}E=r===g}else E=!0}}}else{const e={instancePath:l+"/network/controlLayer/websocketPortRange",schemaPath:"#/definitions/portRange/type",keyword:"type",params:{type:"object"},message:"must be object"};null===p?p=[e]:p.push(e),g++}v=t===g,o=o||v}if(!o){const e={instancePath:l+"/network/controlLayer/websocketPortRange",schemaPath:"#/properties/network/properties/controlLayer/properties/websocketPortRange/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return null===p?p=[e]:p.push(e),g++,u.errors=p,!1}if(g=s,null!==p&&(s?p.length=s:p=null),b=t===g){if(void 0!==r.websocketHost){let e=r.websocketHost;const t=g;if(g===t&&g===t){if("string"!=typeof e)return u.errors=[{instancePath:l+"/network/controlLayer/websocketHost",schemaPath:"#/properties/network/properties/controlLayer/properties/websocketHost/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!n.test(e))return u.errors=[{instancePath:l+"/network/controlLayer/websocketHost",schemaPath:"#/properties/network/properties/controlLayer/properties/websocketHost/format",keyword:"format",params:{format:"hostname"},message:'must match format "hostname"'}],!1}b=t===g}else b=!0;if(b){if(void 0!==r.peerDescriptor){const e=g;c(r.peerDescriptor,{instancePath:l+"/network/controlLayer/peerDescriptor",parentData:r,parentDataProperty:"peerDescriptor",rootData:f})||(p=null===p?c.errors:p.concat(c.errors),g=p.length),b=e===g}else b=!0;if(b){let e=r.maxConnections;const t=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/network/controlLayer/maxConnections",schemaPath:"#/properties/network/properties/controlLayer/properties/maxConnections/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(b=t===g){if(void 0!==r.tlsCertificate){let e=r.tlsCertificate;const t=g;if(g===t){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/network/controlLayer/tlsCertificate",schemaPath:"#/properties/network/properties/controlLayer/properties/tlsCertificate/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let t;if(void 0===e.certFileName&&(t="certFileName")||void 0===e.privateKeyFileName&&(t="privateKeyFileName"))return u.errors=[{instancePath:l+"/network/controlLayer/tlsCertificate",schemaPath:"#/properties/network/properties/controlLayer/properties/tlsCertificate/required",keyword:"required",params:{missingProperty:t},message:"must have required property '"+t+"'"}],!1;{const t=g;for(const t in e)if("certFileName"!==t&&"privateKeyFileName"!==t)return u.errors=[{instancePath:l+"/network/controlLayer/tlsCertificate",schemaPath:"#/properties/network/properties/controlLayer/properties/tlsCertificate/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){if(void 0!==e.certFileName){const t=g;if("string"!=typeof e.certFileName)return u.errors=[{instancePath:l+"/network/controlLayer/tlsCertificate/certFileName",schemaPath:"#/properties/network/properties/controlLayer/properties/tlsCertificate/properties/certFileName/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var A=t===g}else A=!0;if(A)if(void 0!==e.privateKeyFileName){const t=g;if("string"!=typeof e.privateKeyFileName)return u.errors=[{instancePath:l+"/network/controlLayer/tlsCertificate/privateKeyFileName",schemaPath:"#/properties/network/properties/controlLayer/properties/tlsCertificate/properties/privateKeyFileName/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;A=t===g}else A=!0}}}}b=t===g}else b=!0;if(b){let e=r.iceServers;const t=g;if(g===t){if(!Array.isArray(e))return u.errors=[{instancePath:l+"/network/controlLayer/iceServers",schemaPath:"#/properties/network/properties/controlLayer/properties/iceServers/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;{const t=e.length;for(let r=0;r<t;r++){let t=e[r];const n=g;if(g===n){if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/network/controlLayer/iceServers/"+r,schemaPath:"#/properties/network/properties/controlLayer/properties/iceServers/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let e;if(void 0===t.url&&(e="url")||void 0===t.port&&(e="port"))return u.errors=[{instancePath:l+"/network/controlLayer/iceServers/"+r,schemaPath:"#/properties/network/properties/controlLayer/properties/iceServers/items/required",keyword:"required",params:{missingProperty:e},message:"must have required property '"+e+"'"}],!1;{const e=g;for(const e in t)if("url"!==e&&"port"!==e&&"username"!==e&&"password"!==e&&"tcp"!==e)return u.errors=[{instancePath:l+"/network/controlLayer/iceServers/"+r,schemaPath:"#/properties/network/properties/controlLayer/properties/iceServers/items/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"}],!1;if(e===g){if(void 0!==t.url){const e=g;if("string"!=typeof t.url)return u.errors=[{instancePath:l+"/network/controlLayer/iceServers/"+r+"/url",schemaPath:"#/properties/network/properties/controlLayer/properties/iceServers/items/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var S=e===g}else S=!0;if(S){if(void 0!==t.port){let e=t.port;const n=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/network/controlLayer/iceServers/"+r+"/port",schemaPath:"#/properties/network/properties/controlLayer/properties/iceServers/items/properties/port/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;S=n===g}else S=!0;if(S){if(void 0!==t.username){const e=g;if("string"!=typeof t.username)return u.errors=[{instancePath:l+"/network/controlLayer/iceServers/"+r+"/username",schemaPath:"#/properties/network/properties/controlLayer/properties/iceServers/items/properties/username/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;S=e===g}else S=!0;if(S){if(void 0!==t.password){const e=g;if("string"!=typeof t.password)return u.errors=[{instancePath:l+"/network/controlLayer/iceServers/"+r+"/password",schemaPath:"#/properties/network/properties/controlLayer/properties/iceServers/items/properties/password/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;S=e===g}else S=!0;if(S)if(void 0!==t.tcp){const e=g;if("boolean"!=typeof t.tcp)return u.errors=[{instancePath:l+"/network/controlLayer/iceServers/"+r+"/tcp",schemaPath:"#/properties/network/properties/controlLayer/properties/iceServers/items/properties/tcp/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;S=e===g}else S=!0}}}}}}}if(n!==g)break}}}if(b=t===g){const e=g;if("boolean"!=typeof r.webrtcAllowPrivateAddresses)return u.errors=[{instancePath:l+"/network/controlLayer/webrtcAllowPrivateAddresses",schemaPath:"#/properties/network/properties/controlLayer/properties/webrtcAllowPrivateAddresses/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;if(b=e===g){let e=r.webrtcDatachannelBufferThresholdLow;const t=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/network/controlLayer/webrtcDatachannelBufferThresholdLow",schemaPath:"#/properties/network/properties/controlLayer/properties/webrtcDatachannelBufferThresholdLow/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(b=t===g){let e=r.webrtcDatachannelBufferThresholdHigh;const t=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/network/controlLayer/webrtcDatachannelBufferThresholdHigh",schemaPath:"#/properties/network/properties/controlLayer/properties/webrtcDatachannelBufferThresholdHigh/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(b=t===g){let e=r.maxMessageSize;const t=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/network/controlLayer/maxMessageSize",schemaPath:"#/properties/network/properties/controlLayer/properties/maxMessageSize/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(b=t===g){if(void 0!==r.externalIp){let e=r.externalIp;const t=g;if(g===t&&g===t){if("string"!=typeof e)return u.errors=[{instancePath:l+"/network/controlLayer/externalIp",schemaPath:"#/properties/network/properties/controlLayer/properties/externalIp/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!i.test(e))return u.errors=[{instancePath:l+"/network/controlLayer/externalIp",schemaPath:"#/properties/network/properties/controlLayer/properties/externalIp/format",keyword:"format",params:{format:"ipv4"},message:'must match format "ipv4"'}],!1}b=t===g}else b=!0;if(b){let e=r.webrtcPortRange;const t=g;if(g==g){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/network/controlLayer/webrtcPortRange",schemaPath:"#/definitions/portRange/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let t;if(void 0===e.min&&(t="min")||void 0===e.max&&(t="max"))return u.errors=[{instancePath:l+"/network/controlLayer/webrtcPortRange",schemaPath:"#/definitions/portRange/required",keyword:"required",params:{missingProperty:t},message:"must have required property '"+t+"'"}],!1;{const t=g;for(const t in e)if("min"!==t&&"max"!==t)return u.errors=[{instancePath:l+"/network/controlLayer/webrtcPortRange",schemaPath:"#/definitions/portRange/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){if(void 0!==e.min){let t=e.min;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/network/controlLayer/webrtcPortRange/min",schemaPath:"#/definitions/portRange/properties/min/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var k=r===g}else k=!0;if(k)if(void 0!==e.max){let t=e.max;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/network/controlLayer/webrtcPortRange/max",schemaPath:"#/definitions/portRange/properties/max/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;k=r===g}else k=!0}}}}if(b=t===g){let e=r.networkConnectivityTimeout;const t=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/network/controlLayer/networkConnectivityTimeout",schemaPath:"#/properties/network/properties/controlLayer/properties/networkConnectivityTimeout/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(b=t===g){const e=g;if("boolean"!=typeof r.websocketServerEnableTls)return u.errors=[{instancePath:l+"/network/controlLayer/websocketServerEnableTls",schemaPath:"#/properties/network/properties/controlLayer/properties/websocketServerEnableTls/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;if(b=e===g){const e=g;if("string"!=typeof r.autoCertifierUrl)return u.errors=[{instancePath:l+"/network/controlLayer/autoCertifierUrl",schemaPath:"#/properties/network/properties/controlLayer/properties/autoCertifierUrl/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(b=e===g){const e=g;if("string"!=typeof r.autoCertifierConfigFile)return u.errors=[{instancePath:l+"/network/controlLayer/autoCertifierConfigFile",schemaPath:"#/properties/network/properties/controlLayer/properties/autoCertifierConfigFile/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(b=e===g)if(void 0!==r.geoIpDatabaseFolder){const e=g;if("string"!=typeof r.geoIpDatabaseFolder)return u.errors=[{instancePath:l+"/network/controlLayer/geoIpDatabaseFolder",schemaPath:"#/properties/network/properties/controlLayer/properties/geoIpDatabaseFolder/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;b=e===g}else b=!0}}}}}}}}}}}}}}}}}}}}if(s===g){let e=d.node;if(g===g){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/network/node",schemaPath:"#/properties/network/properties/node/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===e.streamPartitionNeighborTargetCount&&(e.streamPartitionNeighborTargetCount=4),void 0===e.streamPartitionMinPropagationTargets&&(e.streamPartitionMinPropagationTargets=2),void 0===e.streamPartitionMaxPropagationBufferSize&&(e.streamPartitionMaxPropagationBufferSize=150),void 0===e.contentDeliveryBufferWhileConnecting&&(e.contentDeliveryBufferWhileConnecting=!0),void 0===e.acceptProxyConnections&&(e.acceptProxyConnections=!1);const t=g;for(const t in e)if("streamPartitionNeighborTargetCount"!==t&&"streamPartitionMinPropagationTargets"!==t&&"streamPartitionMaxPropagationBufferSize"!==t&&"contentDeliveryBufferWhileConnecting"!==t&&"acceptProxyConnections"!==t)return u.errors=[{instancePath:l+"/network/node",schemaPath:"#/properties/network/properties/node/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){let t=e.streamPartitionNeighborTargetCount;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/network/node/streamPartitionNeighborTargetCount",schemaPath:"#/properties/network/properties/node/properties/streamPartitionNeighborTargetCount/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(r===g){let t=e.streamPartitionMinPropagationTargets;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/network/node/streamPartitionMinPropagationTargets",schemaPath:"#/properties/network/properties/node/properties/streamPartitionMinPropagationTargets/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(r===g){let t=e.streamPartitionMaxPropagationBufferSize;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/network/node/streamPartitionMaxPropagationBufferSize",schemaPath:"#/properties/network/properties/node/properties/streamPartitionMaxPropagationBufferSize/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(r===g){const t=g;if("boolean"!=typeof e.contentDeliveryBufferWhileConnecting)return u.errors=[{instancePath:l+"/network/node/contentDeliveryBufferWhileConnecting",schemaPath:"#/properties/network/properties/node/properties/contentDeliveryBufferWhileConnecting/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;if(t===g&&"boolean"!=typeof e.acceptProxyConnections)return u.errors=[{instancePath:l+"/network/node/acceptProxyConnections",schemaPath:"#/properties/network/properties/node/properties/acceptProxyConnections/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1}}}}}}}}}}if(m=h===g){let n=a.contracts;const i=g;if(g===i){if(!n||"object"!=typeof n||Array.isArray(n))return u.errors=[{instancePath:l+"/contracts",schemaPath:"#/properties/contracts/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===n.ethereumNetwork&&(n.ethereumNetwork={}),void 0===n.rpcQuorum&&(n.rpcQuorum=2),void 0===n.maxConcurrentCalls&&(n.maxConcurrentCalls=10),void 0===n.pollInterval&&(n.pollInterval=4e3);const r=g;for(const r in n)if(!t.call(e.properties.contracts.properties,r))return u.errors=[{instancePath:l+"/contracts",schemaPath:"#/properties/contracts/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:r},message:"must NOT have additional properties"}],!1;if(r===g){let e=n.ethereumNetwork;const t=g;if(g===t){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/contracts/ethereumNetwork",schemaPath:"#/properties/contracts/properties/ethereumNetwork/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{const t=g;for(const t in e)if("chainId"!==t&&"overrides"!==t&&"highGasPriceStrategy"!==t)return u.errors=[{instancePath:l+"/contracts/ethereumNetwork",schemaPath:"#/properties/contracts/properties/ethereumNetwork/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){if(void 0!==e.chainId){let t=e.chainId;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/contracts/ethereumNetwork/chainId",schemaPath:"#/properties/contracts/properties/ethereumNetwork/properties/chainId/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var R=r===g}else R=!0;if(R){if(void 0!==e.overrides){let t=e.overrides;const r=g;if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/contracts/ethereumNetwork/overrides",schemaPath:"#/properties/contracts/properties/ethereumNetwork/properties/overrides/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;R=r===g}else R=!0;if(R)if(void 0!==e.highGasPriceStrategy){const t=g;if("boolean"!=typeof e.highGasPriceStrategy)return u.errors=[{instancePath:l+"/contracts/ethereumNetwork/highGasPriceStrategy",schemaPath:"#/properties/contracts/properties/ethereumNetwork/properties/highGasPriceStrategy/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;R=t===g}else R=!0}}}}if(P=t===g){if(void 0!==n.streamRegistryChainAddress){let e=n.streamRegistryChainAddress;const t=g;if(g===t&&g===t){if("string"!=typeof e)return u.errors=[{instancePath:l+"/contracts/streamRegistryChainAddress",schemaPath:"#/properties/contracts/properties/streamRegistryChainAddress/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!s.test(e))return u.errors=[{instancePath:l+"/contracts/streamRegistryChainAddress",schemaPath:"#/properties/contracts/properties/streamRegistryChainAddress/format",keyword:"format",params:{format:"ethereum-address"},message:'must match format "ethereum-address"'}],!1}var P=t===g}else P=!0;if(P){if(void 0!==n.streamStorageRegistryChainAddress){let e=n.streamStorageRegistryChainAddress;const t=g;if(g===t&&g===t){if("string"!=typeof e)return u.errors=[{instancePath:l+"/contracts/streamStorageRegistryChainAddress",schemaPath:"#/properties/contracts/properties/streamStorageRegistryChainAddress/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!s.test(e))return u.errors=[{instancePath:l+"/contracts/streamStorageRegistryChainAddress",schemaPath:"#/properties/contracts/properties/streamStorageRegistryChainAddress/format",keyword:"format",params:{format:"ethereum-address"},message:'must match format "ethereum-address"'}],!1}P=t===g}else P=!0;if(P){if(void 0!==n.storageNodeRegistryChainAddress){let e=n.storageNodeRegistryChainAddress;const t=g;if(g===t&&g===t){if("string"!=typeof e)return u.errors=[{instancePath:l+"/contracts/storageNodeRegistryChainAddress",schemaPath:"#/properties/contracts/properties/storageNodeRegistryChainAddress/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!s.test(e))return u.errors=[{instancePath:l+"/contracts/storageNodeRegistryChainAddress",schemaPath:"#/properties/contracts/properties/storageNodeRegistryChainAddress/format",keyword:"format",params:{format:"ethereum-address"},message:'must match format "ethereum-address"'}],!1}P=t===g}else P=!0;if(P){if(void 0!==n.sponsorshipFactoryChainAddress){let e=n.sponsorshipFactoryChainAddress;const t=g;if(g===t&&g===t){if("string"!=typeof e)return u.errors=[{instancePath:l+"/contracts/sponsorshipFactoryChainAddress",schemaPath:"#/properties/contracts/properties/sponsorshipFactoryChainAddress/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!s.test(e))return u.errors=[{instancePath:l+"/contracts/sponsorshipFactoryChainAddress",schemaPath:"#/properties/contracts/properties/sponsorshipFactoryChainAddress/format",keyword:"format",params:{format:"ethereum-address"},message:'must match format "ethereum-address"'}],!1}P=t===g}else P=!0;if(P){if(void 0!==n.rpcs){let e=n.rpcs;const t=g;if(g===t){if(!Array.isArray(e))return u.errors=[{instancePath:l+"/contracts/rpcs",schemaPath:"#/properties/contracts/properties/rpcs/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;if(e.length<1)return u.errors=[{instancePath:l+"/contracts/rpcs",schemaPath:"#/properties/contracts/properties/rpcs/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{const t=e.length;for(let r=0;r<t;r++){let t=e[r];const n=g;if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/contracts/rpcs/"+r,schemaPath:"#/properties/contracts/properties/rpcs/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;if(g==g){if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/contracts/rpcs/"+r,schemaPath:"#/definitions/rpcProviderConfig/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let e;if(void 0===t.url&&(e="url"))return u.errors=[{instancePath:l+"/contracts/rpcs/"+r,schemaPath:"#/definitions/rpcProviderConfig/required",keyword:"required",params:{missingProperty:e},message:"must have required property '"+e+"'"}],!1;if(void 0!==t.url){let e=t.url;if(g==g&&g==g){if("string"!=typeof e)return u.errors=[{instancePath:l+"/contracts/rpcs/"+r+"/url",schemaPath:"#/definitions/rpcProviderConfig/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!o.test(e))return u.errors=[{instancePath:l+"/contracts/rpcs/"+r+"/url",schemaPath:"#/definitions/rpcProviderConfig/properties/url/format",keyword:"format",params:{format:"uri"},message:'must match format "uri"'}],!1}}}}if(n!==g)break}}}P=t===g}else P=!0;if(P){let e=n.rpcQuorum;const t=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/contracts/rpcQuorum",schemaPath:"#/properties/contracts/properties/rpcQuorum/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(P=t===g){if(void 0!==n.theGraphUrl){let e=n.theGraphUrl;const t=g;if(g===t&&g===t){if("string"!=typeof e)return u.errors=[{instancePath:l+"/contracts/theGraphUrl",schemaPath:"#/properties/contracts/properties/theGraphUrl/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!o.test(e))return u.errors=[{instancePath:l+"/contracts/theGraphUrl",schemaPath:"#/properties/contracts/properties/theGraphUrl/format",keyword:"format",params:{format:"uri"},message:'must match format "uri"'}],!1}P=t===g}else P=!0;if(P){let e=n.maxConcurrentCalls;const t=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/contracts/maxConcurrentCalls",schemaPath:"#/properties/contracts/properties/maxConcurrentCalls/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(P=t===g){let e=n.pollInterval;const t=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/contracts/pollInterval",schemaPath:"#/properties/contracts/properties/pollInterval/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;P=t===g}}}}}}}}}}}}if(m=i===g){let e=a.encryption;const t=g;if(g===t){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/encryption",schemaPath:"#/properties/encryption/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===e.keyRequestTimeout&&(e.keyRequestTimeout=3e4),void 0===e.maxKeyRequestsPerSecond&&(e.maxKeyRequestsPerSecond=20),void 0===e.rsaKeyLength&&(e.rsaKeyLength=4096),void 0===e.requireQuantumResistantKeyExchange&&(e.requireQuantumResistantKeyExchange=!1),void 0===e.requireQuantumResistantSignatures&&(e.requireQuantumResistantSignatures=!1),void 0===e.requireQuantumResistantEncryption&&(e.requireQuantumResistantEncryption=!1);const t=g;for(const t in e)if("keyRequestTimeout"!==t&&"maxKeyRequestsPerSecond"!==t&&"rsaKeyLength"!==t&&"requireQuantumResistantKeyExchange"!==t&&"requireQuantumResistantSignatures"!==t&&"requireQuantumResistantEncryption"!==t&&"keys"!==t)return u.errors=[{instancePath:l+"/encryption",schemaPath:"#/properties/encryption/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){let t=e.keyRequestTimeout;const n=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/encryption/keyRequestTimeout",schemaPath:"#/properties/encryption/properties/keyRequestTimeout/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(n===g){let t=e.maxKeyRequestsPerSecond;const n=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/encryption/maxKeyRequestsPerSecond",schemaPath:"#/properties/encryption/properties/maxKeyRequestsPerSecond/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(n===g){let t=e.rsaKeyLength;const n=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/encryption/rsaKeyLength",schemaPath:"#/properties/encryption/properties/rsaKeyLength/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(n===g){const t=g;if("boolean"!=typeof e.requireQuantumResistantKeyExchange)return u.errors=[{instancePath:l+"/encryption/requireQuantumResistantKeyExchange",schemaPath:"#/properties/encryption/properties/requireQuantumResistantKeyExchange/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;if(t===g){const t=g;if("boolean"!=typeof e.requireQuantumResistantSignatures)return u.errors=[{instancePath:l+"/encryption/requireQuantumResistantSignatures",schemaPath:"#/properties/encryption/properties/requireQuantumResistantSignatures/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;if(t===g){const t=g;if("boolean"!=typeof e.requireQuantumResistantEncryption)return u.errors=[{instancePath:l+"/encryption/requireQuantumResistantEncryption",schemaPath:"#/properties/encryption/properties/requireQuantumResistantEncryption/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;if(t===g&&void 0!==e.keys){let t=e.keys;if(g===g){if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/encryption/keys",schemaPath:"#/properties/encryption/properties/keys/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;for(const e in t){const t=g;if("string"!=typeof e){const t={instancePath:l+"/encryption/keys",schemaPath:"#/definitions/streamIdOrPath/type",keyword:"type",params:{type:"string"},message:"must be string",propertyName:e};null===p?p=[t]:p.push(t),g++}var I=t===g;if(!I){const t={instancePath:l+"/encryption/keys",schemaPath:"#/properties/encryption/properties/keys/propertyNames",keyword:"propertyNames",params:{propertyName:e},message:"property name must be valid"};return null===p?p=[t]:p.push(t),g++,u.errors=p,!1}}if(I)for(const e in t){let n=t[e];const i=g;if(g==g){if(!n||"object"!=typeof n||Array.isArray(n))return u.errors=[{instancePath:l+"/encryption/keys/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/encryptionKey/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let t;if(void 0===n.id&&(t="id")||void 0===n.data&&(t="data"))return u.errors=[{instancePath:l+"/encryption/keys/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/encryptionKey/required",keyword:"required",params:{missingProperty:t},message:"must have required property '"+t+"'"}],!1;if(void 0!==n.id){const t=g;if("string"!=typeof n.id)return u.errors=[{instancePath:l+"/encryption/keys/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/id",schemaPath:"#/definitions/encryptionKey/properties/id/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var C=t===g}else C=!0;if(C)if(void 0!==n.data){let t=n.data;const i=g;if(g===i&&g===i){if("string"!=typeof t)return u.errors=[{instancePath:l+"/encryption/keys/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/data",schemaPath:"#/definitions/encryptionKey/properties/data/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!r.test(t))return u.errors=[{instancePath:l+"/encryption/keys/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/data",schemaPath:"#/definitions/encryptionKey/properties/data/format",keyword:"format",params:{format:"hex-string"},message:'must match format "hex-string"'}],!1}C=i===g}else C=!0}}if(i!==g)break}}}}}}}}}}}if(m=t===g){let e=a.validation;const t=g;if(g===t){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/validation",schemaPath:"#/properties/validation/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===e.permissions&&(e.permissions=!0),void 0===e.partitions&&(e.partitions=!0);const t=g;for(const t in e)if("permissions"!==t&&"partitions"!==t)return u.errors=[{instancePath:l+"/validation",schemaPath:"#/properties/validation/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){const t=g;if("boolean"!=typeof e.permissions)return u.errors=[{instancePath:l+"/validation/permissions",schemaPath:"#/properties/validation/properties/permissions/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;if(t===g&&"boolean"!=typeof e.partitions)return u.errors=[{instancePath:l+"/validation/partitions",schemaPath:"#/properties/validation/properties/partitions/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1}}}if(m=t===g){if(void 0!==a.metrics){let e=a.metrics;const t=g,r=g;let n=!1;const i=g;if("boolean"!=typeof e){const e={instancePath:l+"/metrics",schemaPath:"#/properties/metrics/anyOf/0/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};null===p?p=[e]:p.push(e),g++}var _=i===g;if(n=n||_,!n){const t=g;if(g===t)if(e&&"object"==typeof e&&!Array.isArray(e)){const t=g;for(const t in e)if("periods"!==t&&"maxPublishDelay"!==t){const e={instancePath:l+"/metrics",schemaPath:"#/properties/metrics/anyOf/1/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"};null===p?p=[e]:p.push(e),g++;break}if(t===g){if(void 0!==e.periods){let t=e.periods;const r=g;if(g===r)if(Array.isArray(t)){const e=t.length;for(let r=0;r<e;r++){let e=t[r];const n=g;if(g===n)if(e&&"object"==typeof e&&!Array.isArray(e)){let t;if(void 0===e.streamId&&(t="streamId")||void 0===e.duration&&(t="duration")){const e={instancePath:l+"/metrics/periods/"+r,schemaPath:"#/properties/metrics/anyOf/1/properties/periods/items/required",keyword:"required",params:{missingProperty:t},message:"must have required property '"+t+"'"};null===p?p=[e]:p.push(e),g++}else{if(void 0!==e.id){const t=g;if("string"!=typeof e.id){const e={instancePath:l+"/metrics/periods/"+r+"/id",schemaPath:"#/properties/metrics/anyOf/1/properties/periods/items/properties/id/type",keyword:"type",params:{type:"string"},message:"must be string"};null===p?p=[e]:p.push(e),g++}var T=t===g}else T=!0;if(T)if(void 0!==e.duration){let t=e.duration;const n=g;if("number"!=typeof t||!isFinite(t)){const e={instancePath:l+"/metrics/periods/"+r+"/duration",schemaPath:"#/properties/metrics/anyOf/1/properties/periods/items/properties/duration/type",keyword:"type",params:{type:"number"},message:"must be number"};null===p?p=[e]:p.push(e),g++}T=n===g}else T=!0}}else{const e={instancePath:l+"/metrics/periods/"+r,schemaPath:"#/properties/metrics/anyOf/1/properties/periods/items/type",keyword:"type",params:{type:"object"},message:"must be object"};null===p?p=[e]:p.push(e),g++}if(n!==g)break}}else{const e={instancePath:l+"/metrics/periods",schemaPath:"#/properties/metrics/anyOf/1/properties/periods/type",keyword:"type",params:{type:"array"},message:"must be array"};null===p?p=[e]:p.push(e),g++}var N=r===g}else N=!0;if(N)if(void 0!==e.maxPublishDelay){let t=e.maxPublishDelay;const r=g;if("number"!=typeof t||!isFinite(t)){const e={instancePath:l+"/metrics/maxPublishDelay",schemaPath:"#/properties/metrics/anyOf/1/properties/maxPublishDelay/type",keyword:"type",params:{type:"number"},message:"must be number"};null===p?p=[e]:p.push(e),g++}N=r===g}else N=!0}}else{const e={instancePath:l+"/metrics",schemaPath:"#/properties/metrics/anyOf/1/type",keyword:"type",params:{type:"object"},message:"must be object"};null===p?p=[e]:p.push(e),g++}_=t===g,n=n||_}if(!n){const e={instancePath:l+"/metrics",schemaPath:"#/properties/metrics/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return null===p?p=[e]:p.push(e),g++,u.errors=p,!1}g=r,null!==p&&(r?p.length=r:p=null),m=t===g}else m=!0;if(m){let e=a.cache;const t=g;if(g===t){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/cache",schemaPath:"#/properties/cache/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===e.maxSize&&(e.maxSize=1e4),void 0===e.maxAge&&(e.maxAge=864e5);const t=g;for(const t in e)if("maxSize"!==t&&"maxAge"!==t)return u.errors=[{instancePath:l+"/cache",schemaPath:"#/properties/cache/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){let t=e.maxSize;const r=g;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/cache/maxSize",schemaPath:"#/properties/cache/properties/maxSize/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(r===g){let t=e.maxAge;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/cache/maxAge",schemaPath:"#/properties/cache/properties/maxAge/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1}}}}if(m=t===g){let e=a._timeouts;const t=g;if(g===t){if(!e||"object"!=typeof e||Array.isArray(e))return u.errors=[{instancePath:l+"/_timeouts",schemaPath:"#/properties/_timeouts/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===e.theGraph&&(e.theGraph={}),void 0===e.storageNode&&(e.storageNode={}),void 0===e.ensStreamCreation&&(e.ensStreamCreation={}),void 0===e.jsonRpcTimeout&&(e.jsonRpcTimeout=3e4);const t=g;for(const t in e)if("theGraph"!==t&&"storageNode"!==t&&"ensStreamCreation"!==t&&"jsonRpcTimeout"!==t)return u.errors=[{instancePath:l+"/_timeouts",schemaPath:"#/properties/_timeouts/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:t},message:"must NOT have additional properties"}],!1;if(t===g){let t=e.theGraph;const r=g;if(g===r){if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/_timeouts/theGraph",schemaPath:"#/properties/_timeouts/properties/theGraph/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===t.indexTimeout&&(t.indexTimeout=6e4),void 0===t.indexPollInterval&&(t.indexPollInterval=1e3),void 0===t.fetchTimeout&&(t.fetchTimeout=3e4);const e=g;for(const e in t)if("indexTimeout"!==e&&"indexPollInterval"!==e&&"fetchTimeout"!==e)return u.errors=[{instancePath:l+"/_timeouts/theGraph",schemaPath:"#/properties/_timeouts/properties/theGraph/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"}],!1;if(e===g){let e=t.indexTimeout;const r=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/_timeouts/theGraph/indexTimeout",schemaPath:"#/properties/_timeouts/properties/theGraph/properties/indexTimeout/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(r===g){let e=t.indexPollInterval;const r=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/_timeouts/theGraph/indexPollInterval",schemaPath:"#/properties/_timeouts/properties/theGraph/properties/indexPollInterval/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(r===g){let e=t.fetchTimeout;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/_timeouts/theGraph/fetchTimeout",schemaPath:"#/properties/_timeouts/properties/theGraph/properties/fetchTimeout/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1}}}}}if(r===g){let t=e.storageNode;const r=g;if(g===r){if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/_timeouts/storageNode",schemaPath:"#/properties/_timeouts/properties/storageNode/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===t.timeout&&(t.timeout=3e4),void 0===t.retryInterval&&(t.retryInterval=1e3);const e=g;for(const e in t)if("timeout"!==e&&"retryInterval"!==e)return u.errors=[{instancePath:l+"/_timeouts/storageNode",schemaPath:"#/properties/_timeouts/properties/storageNode/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"}],!1;if(e===g){let e=t.timeout;const r=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/_timeouts/storageNode/timeout",schemaPath:"#/properties/_timeouts/properties/storageNode/properties/timeout/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(r===g){let e=t.retryInterval;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/_timeouts/storageNode/retryInterval",schemaPath:"#/properties/_timeouts/properties/storageNode/properties/retryInterval/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1}}}}if(r===g){let t=e.ensStreamCreation;const r=g;if(g===r){if(!t||"object"!=typeof t||Array.isArray(t))return u.errors=[{instancePath:l+"/_timeouts/ensStreamCreation",schemaPath:"#/properties/_timeouts/properties/ensStreamCreation/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{void 0===t.timeout&&(t.timeout=18e4),void 0===t.retryInterval&&(t.retryInterval=1e3);const e=g;for(const e in t)if("timeout"!==e&&"retryInterval"!==e)return u.errors=[{instancePath:l+"/_timeouts/ensStreamCreation",schemaPath:"#/properties/_timeouts/properties/ensStreamCreation/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"}],!1;if(e===g){let e=t.timeout;const r=g;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/_timeouts/ensStreamCreation/timeout",schemaPath:"#/properties/_timeouts/properties/ensStreamCreation/properties/timeout/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;if(r===g){let e=t.retryInterval;if("number"!=typeof e||!isFinite(e))return u.errors=[{instancePath:l+"/_timeouts/ensStreamCreation/retryInterval",schemaPath:"#/properties/_timeouts/properties/ensStreamCreation/properties/retryInterval/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1}}}}if(r===g){let t=e.jsonRpcTimeout;if("number"!=typeof t||!isFinite(t))return u.errors=[{instancePath:l+"/_timeouts/jsonRpcTimeout",schemaPath:"#/properties/_timeouts/properties/jsonRpcTimeout/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1}}}}}}m=t===g}}}}}}}}}}}}}}}}}}}return u.errors=p,0===g}return GV.exports}(),VV=qV($V);const HV={network:{controlLayer:{entryPointDiscovery:{enabled:!1},websocketPortRange:{min:32400,max:32800},iceServers:[],webrtcAllowPrivateAddresses:!0,websocketServerEnableTls:!1}},encryption:{rsaKeyLength:640},_timeouts:{theGraph:{indexTimeout:1e4,indexPollInterval:500},storageNode:{timeout:3e4,retryInterval:500},ensStreamCreation:{timeout:2e4,retryInterval:500}},metrics:!1};ts("0xde1112f631486CfC759A50196853011528bC5FA0");const WV=(e,t)=>{const r=QE.$[e];let n=ec({environment:e,network:{controlLayer:{entryPoints:r.entryPoints}},contracts:{ethereumNetwork:{chainId:r.id},streamRegistryChainAddress:r.contracts.StreamRegistry,streamStorageRegistryChainAddress:r.contracts.StreamStorageRegistry,storageNodeRegistryChainAddress:r.contracts.StorageNodeRegistry,sponsorshipFactoryChainAddress:r.contracts.SponsorshipFactory,rpcs:r.rpcEndpoints,theGraphUrl:r.theGraphUrl}},t);return"polygon"===e?n.contracts.ethereumNetwork={highGasPriceStrategy:!0,...n.contracts.ethereumNetwork}:"dev2"===e&&(n=ec(HV,n)),n},JV=e=>{if(!VV(e))throw new Error(VV.errors.map(e=>{let t=e.instancePath+" "+e.message;return e.params.additionalProperty&&(t+=`: ${e.params.additionalProperty}`),t}).join("\n"));return e},ZV={...Object.fromEntries(M$.map(e=>[e.signatureType,e.keyType])),[W_.ECDSA_SECP256K1_LEGACY]:"ECDSA_SECP256K1_LEGACY",[W_.ERC_1271]:"ERC_1271"};function QV(e){const t=ZV[e];if(!t)throw new Error(`Unknown signature type: ${e}`);return t}const YV=e=>({content:e.getParsedContent(),streamId:e.getStreamId(),streamPartition:e.getStreamPartition(),timestamp:e.getTimestamp(),sequenceNumber:e.getSequenceNumber(),signature:e.signature,signatureType:QV(e.signatureType),publisherId:e.getPublisherId(),msgChainId:e.getMsgChainId(),encryptionKeyId:e.groupKeyId,streamMessage:e});var XV=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},eH=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},tH=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};const rH={periods:[{duration:6e4,streamId:"streamr.eth/metrics/nodes/firehose/min"},{duration:36e5,streamId:"streamr.eth/metrics/nodes/firehose/hour"},{duration:864e5,streamId:"streamr.eth/metrics/nodes/firehose/day"}],maxPublishDelay:3e4};let nH=class{publisher;node;config;eventEmitter;destroySignal;constructor(e,t,r,n,i){this.publisher=e,this.node=t,this.config=(e=>{if(!0===e.metrics)return rH;if(!1===e.metrics)return{...rH,periods:[]};if(void 0!==e.metrics)return ec(rH,e.metrics);{const t=void 0!==e.auth?.ethereum;return{...rH,periods:t?[]:rH.periods}}})(r),this.eventEmitter=n,this.destroySignal=i;const s=Xq(async()=>{const e=await this.node.getMetricsContext(),t=await this.node.getNodeId();this.config.periods.forEach(r=>{e.createReportProducer(async e=>{await this.publish(e,r.streamId,t)},r.duration,this.destroySignal.abortSignal)})});this.config.periods.length>0&&(this.eventEmitter.on("messagePublished",()=>s()),this.eventEmitter.on("streamPartSubscribed",()=>s()))}async publish(e,t,r){await Ga(Math.random()*this.config.maxPublishDelay);const n={...e,node:{...e.node,id:r}};try{await this.publisher.publish(t,n,{timestamp:e.period.end,partitionKey:r})}catch(e){console.warn(`Unable to publish metrics: ${e.message}`)}}};nH=XV([te(l.ContainerScoped),tH(2,X(Zz)),eH("design:paramtypes",[zV,g$,Object,hq,cK])],nH);var iH=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},sH=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oH=class{streamIdBuilder;operatorRegistry;node;logger;constructor(e,t,r,n){this.streamIdBuilder=e,this.operatorRegistry=t,this.node=r,this.logger=n.createLogger("ProxyNodeFinder")}async find(e,t=1,r=100,n=24){const[i,s]=await this.streamIdBuilder.toStreamPartElements(e);this.logger.debug(`Trying to find ${t} proxy nodes for stream ${i} partition ${s}`);const o=await this.operatorRegistry.findOperatorsOnStream(i,r,n);if(this.logger.debug(`Found ${o.length} operators on stream ${i}`),o.length<t)throw new Error(`Not enough operators found for stream ${i}: found ${o.length} operators, but ${t} are required`);const a=ZS()(o),c=[];let u=()=>{};const l=new Promise(e=>{u=e});let d=0;const h=async e=>{for(;d<a.length&&c.length<t;){const r=a[d];d++;const n=pc(i,s??0);try{const i=await this.node.discoverOperators(r.peerDescriptor,n);i.length>0?c.length<t&&(this.logger.debug(`(worker ${e}): found ${i.length} nodes for operator ${r.operatorId} and streamPartId ${n}`),c.push(Cc()(i)),c.length>=t&&u()):this.logger.debug(`(worker ${e}): no nodes found for operator ${r.operatorId} and streamPartId ${n}`)}catch(t){this.logger.error(`(worker ${e}): error discovering nodes for operator ${r.operatorId}: ${t.message}`)}}};if(await Promise.race([Promise.all(Array.from({length:t},(e,t)=>h(t))),l]),c.length<t)throw new Error(`Not enough proxy nodes were resolved for stream ${i}: found ${c.length} nodes, but ${t} are required`);return c}};oH=iH([te(l.ContainerScoped),sH("design:paramtypes",[fK,lG,g$,mq])],oH);class aH{id;client;constructor(e,t){this.id=e,this.client=t}publish(e,t){return this.client.publish(this.id,e,t)}async hasPermission(e){return this.client.hasPermission({streamId:this.id,...e})}async getPermissions(){return this.client.getPermissions(this.id)}async grantPermissions(...e){return this.client.grantPermissions(this.id,...e.map(wK))}async revokePermissions(...e){return this.client.revokePermissions(this.id,...e.map(wK))}async addToStorageNode(e,t={wait:!1}){await this.client.addStreamToStorageNode(this.id,e,t)}async removeFromStorageNode(e){return this.client.removeStreamFromStorageNode(this.id,ts(e))}async getStorageNodes(){return this.client.getStorageNodes(this.id)}async getStreamParts(){return Hx()(0,await this.getPartitionCount()).map(e=>pc(this.id,e))}async getPartitionCount(){return gK(await this.getMetadata())}async getDescription(){const e=(await this.getMetadata()).description;return zx()(e)?e:void 0}async setDescription(e){await this.setMetadata({...await this.getMetadata(),description:e})}async getStorageDayCount(){const e=(await this.getMetadata()).storageDays;return $x()(e)?e:void 0}async setStorageDayCount(e){await this.setMetadata({...await this.getMetadata(),storageDays:e})}async getMetadata(){return this.client.getStreamMetadata(this.id)}async setMetadata(e){await this.client.setStreamMetadata(this.id,e)}}class cH extends Error{reasonText;constructor(e){super(`Failed to parse metadata: ${e}`),this.reasonText=e}}const uH=new Ta("Operator");class lH{contractAddress;contract;contractReadonly;contractFactory;rpcProviderSource;theGraphClient;identity;getEthersOverrides;eventEmitter=new Ya;constructor(e,t,r,n,i,s,o,a,c){this.contractAddress=e,this.contractFactory=t,this.rpcProviderSource=r,this.contractReadonly=t.createReadContract(ts(e),_c.OperatorABI,r.getProvider(),"operator"),this.theGraphClient=i,this.identity=s,this.getEthersOverrides=c,this.initEventGateways(e,n,a),o.onDestroy.listen(()=>{this.eventEmitter.removeAllListeners()})}initEventGateways(e,t,r){const n=new kp(_c.OperatorABI),i=([e])=>({sponsorship:ts(e)});vq({sourceDefinition:{contractInterfaceFragment:n.getEvent("Staked"),contractAddress:e},sourceEmitter:t,targetName:"staked",targetEmitter:this.eventEmitter,transformation:i,loggerFactory:r}),vq({sourceDefinition:{contractInterfaceFragment:n.getEvent("Unstaked"),contractAddress:e},sourceEmitter:t,targetName:"unstaked",targetEmitter:this.eventEmitter,transformation:i,loggerFactory:r}),vq({sourceDefinition:{contractInterfaceFragment:n.getEvent("ReviewRequest"),contractAddress:e},sourceEmitter:t,targetName:"reviewRequested",targetEmitter:this.eventEmitter,transformation:([e,t,r,n,i])=>{const s=function(e){if(void 0===e)throw new cH("no metadata");let t;try{t=JSON.parse(e)}catch{throw new cH("malformed metadata")}const r=Number(t.partition);if(isNaN(r))throw new cH('invalid or missing "partition" field');try{fc(r)}catch{throw new cH("invalid partition numbering")}return r}(i);return{sponsorship:ts(e),targetOperator:ts(t),partition:s,votingPeriodStartTimestamp:1e3*Number(r),votingPeriodEndTimestamp:1e3*Number(n)}},loggerFactory:r})}async writeHeartbeat(e){const t=JSON.stringify(e);await this.connectToContract(),await(await this.contract.heartbeat(t,await this.getEthersOverrides())).wait()}async getTimestampOfLastHeartbeat(){const e=await this.theGraphClient.queryEntity({query:`{\n                operator(id: "${await this.getContractAddress()}") {\n                    latestHeartbeatTimestamp\n                }\n            }`});if(null!==e.operator&&null!==e.operator.latestHeartbeatTimestamp){const t=parseInt(e.operator.latestHeartbeatTimestamp);if(isNaN(t))throw new Error("Assertion failed: unexpected non-integer latestHeartbeatTimestamp");return 1e3*t}}async getContractAddress(){return ts(await this.contractReadonly.getAddress())}async getSponsorships(){const e=await this.getContractAddress(),t=this.theGraphClient.queryEntities((t,r)=>({query:`\n                    {\n                        operator(id: "${e}") {\n                            stakes(where: {id_gt: "${t}"}, first: ${r}) {\n                                id\n                                sponsorship {\n                                    id\n                                    operatorCount\n                                    stream {\n                                        id\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    `}),e=>e.operator?.stakes??[]),r=[];for await(const e of t)r.push({sponsorshipAddress:ts(e.sponsorship.id),streamId:dc(e.sponsorship.stream.id),operatorCount:e.sponsorship.operatorCount});return r}async getExpiredFlags(e,t){const r=Math.floor((Date.now()-t)/1e3),n=this.theGraphClient.queryEntities((t,n)=>({query:`\n                {\n                    flags (where : {\n                        id_gt: "${t}",\n                        voteEndTimestamp_lt: ${r},\n                        result_in: ["waiting", "voting"],\n                        sponsorship_in: ${JSON.stringify(e)}\n                    }, first: ${n}) {\n                        id\n                        flaggingTimestamp\n                        target {\n                            id\n                        }\n                        sponsorship {\n                            id\n                        }\n                    }\n                }`})),i=[];for await(const e of n)i.push({id:e.id,flaggingTimestamp:e.flaggingTimestamp,targetOperator:ts(e.target.id),sponsorship:ts(e.sponsorship.id)});return i}async getOperatorsInSponsorship(e){const t=this.theGraphClient.queryEntities((t,r)=>({query:`\n                    {\n                        sponsorship(id: "${e}") {\n                            stakes(where: {id_gt: "${t}"}, first: ${r}) {\n                                id\n                                operator {\n                                    id\n                                }\n                            }\n                        }\n                    }\n                    `}),e=>e.sponsorship?.stakes??[]),r=[];for await(const e of t)r.push(ts(e.operator.id));return r}async flag(e,t,r){const n=JSON.stringify({partition:r});await this.connectToContract(),await(await this.contract.flag(e,t,n,await this.getEthersOverrides())).wait()}async getEarnings(e,t){const{addresses:r,earnings:n,maxAllowedEarnings:i}=await this.contractReadonly.getSponsorshipsAndEarnings(),s=r.map((e,t)=>({address:e,earnings:n[t]})).filter(t=>t.earnings>=e).sort((e,t)=>((e,t)=>e<t?-1:e>t?1:0)(e.earnings,t.earnings)).slice(0,t);return{sponsorshipAddresses:s.map(e=>ts(e.address)),sum:s.reduce((e,t)=>e+t.earnings,0n),maxAllowedEarnings:i}}async withdrawEarningsFromSponsorships(e){await this.connectToContract(),await(await this.contract.withdrawEarningsFromSponsorships(e,await this.getEthersOverrides())).wait()}async triggerAnotherOperatorWithdraw(e,t){await this.connectToContract(),await(await this.contract.triggerAnotherOperatorWithdraw(e,t,await this.getEthersOverrides())).wait()}async getStakedOperators(){const e=this.theGraphClient.queryEntities((e,t)=>({query:`\n                    {\n                        operators(where: {totalStakeInSponsorshipsWei_gt: "0", id_gt: "${e}"}, first: ${t}) {\n                            id\n                        }\n                    }\n                    `})),t=[];for await(const r of e)t.push(ts(r.id));return t}async*pullStakedStreams(e){const t=await this.getContractAddress();this.theGraphClient.updateRequiredBlockNumber(e);const r=this.theGraphClient.queryEntities((e,r)=>({query:`\n                    {\n                        operator(id: "${t}") {\n                            stakes(where: {id_gt: "${e}"}, first: ${r}) {\n                                sponsorship {\n                                    id\n                                    stream {\n                                        id\n                                    }\n                                }\n                            }\n                        }\n                        _meta {\n                            block {\n                            number\n                            }\n                        }\n                    }\n                    `}),e=>e.operator?e.operator.stakes:(uH.error("Unable to find operator in The Graph",{operatorContractAddress:t}),[]));for await(const e of r)yield{sponsorship:ts(e.sponsorship.id),streamId:dc(e.sponsorship.stream.id)}}async hasOpenFlag(e){const t=await this.getContractAddress(),r=this.theGraphClient.queryEntities(()=>({query:`\n                    {\n                        flags(where: {\n                            sponsorship: "${e}",\n                            target: "${t}",\n                            result_in: ["waiting", "voting"]\n                        }) {\n                            id\n                        }\n                    }\n                    `})),n=await tc(r,1);return n.length>0&&(uH.debug("Found open flag",{flag:n[0]}),!0)}async getStreamId(e){const t=this.contractFactory.createReadContract(ts(e),_c.SponsorshipABI,this.rpcProviderSource.getProvider(),"sponsorship");return dc(await t.streamId())}async voteOnFlag(e,t,r){const n=r?"0x0000000000000000000000000000000000000000000000000000000000000001":"0x0000000000000000000000000000000000000000000000000000000000000000";await this.connectToContract();const i=1300000n,s=await this.contract.voteOnFlag.estimateGas(e,t,n);if(s>i)throw new Error(`Gas estimate (${s}) exceeds limit (1300000)`);await(await this.contract.voteOnFlag(e,t,n,{...await this.getEthersOverrides(),gasLimit:i})).wait()}async closeFlag(e,t){await this.voteOnFlag(e,t,!1)}async fetchRedundancyFactor(){const e=Ij({redundancyFactor:HU().int().gte(1)}),t=await this.contractReadonly.metadata();if(0===t.length)return 1;let r,n;try{r=JSON.parse(t)}catch{return void uH.warn("Encountered malformed metadata",{operatorAddress:await this.getContractAddress(),metadataAsString:t})}try{n=e.parse(r)}catch(e){return void uH.warn("Encountered invalid metadata",{operatorAddress:await this.getContractAddress(),metadataAsString:t,reason:e?.reason})}return n.redundancyFactor}getCurrentBlockNumber(){return this.rpcProviderSource.getProvider().getBlockNumber()}on(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}async connectToContract(){if(void 0===this.contract){const e=await this.identity.getTransactionSigner(this.rpcProviderSource);this.contract=this.contractFactory.createWriteContract(this.contractAddress,_c.OperatorABI,e,"operator")}}}var dH=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},hH=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},fH=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};let pH=class{config;constructor(e,t,r,n){this.config=t,this.initEventListener(r,e,n)}initEventListener(e,t,r){const n=ts(this.config.contracts.sponsorshipFactoryChainAddress),i=new kp(_c.SponsorshipFactoryABI);vq({sourceDefinition:{contractInterfaceFragment:i.getEvent("NewSponsorship"),contractAddress:n},sourceEmitter:t,targetName:"sponsorshipCreated",targetEmitter:e,transformation:([e,t],r)=>({sponsorshipContractAddress:ts(e),streamId:dc(t),blockNumber:r}),loggerFactory:r})}};pH=dH([te(l.ContainerScoped),fH(1,X(Zz)),hH("design:paramtypes",[CK,Object,hq,mq])],pH);var gH,mH=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},yH=globalThis&&globalThis.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},bH=globalThis&&globalThis.__param||function(e,t){return function(r,n){t(r,n,e)}};!function(e){e[e.NONE=0]="NONE",e[e.NORMAL=1]="NORMAL",e[e.ERC_1271=2]="ERC_1271"}(gH||(gH={}));let wH=class{networkNodeFacade;streamRegistry;signatureValidator;messageSigner;store;identity;logger;erc1271Publishers=new Set;config;constructor(e,t,r,n,i,s,o,a,c){this.networkNodeFacade=e,this.streamRegistry=t,this.signatureValidator=r,this.messageSigner=n,this.store=i,this.identity=s,this.logger=c.createLogger("PublisherKeyExchange"),this.config=o,void 0===o.encryption.keys&&(e.once("start",async()=>{e.addMessageListener(e=>this.onMessage(e)),this.logger.debug("Started")}),a.on("messagePublished",e=>{if(e.signatureType===W_.ERC_1271){const t=e.getPublisherId();this.erc1271Publishers.has(t)||(this.logger.debug("Add ERC-1271 publisher",{publisherId:t}),this.erc1271Publishers.add(t))}}))}async onMessage(e){if(e.messageType===Dq.GROUP_KEY_REQUEST)try{const{recipientId:t,requestId:r,publicKey:n,groupKeyIds:i,encryptionType:s}=eT.fromBinary(e.content),o=yc(t);if(!function(e,t){const r=J$.has(e),n=t.encryption?.requireQuantumResistantKeyExchange;return r||!n}(s,this.config))throw new Qz(`EncryptionType in key request (${s}) is not compliant with encryption settings!`,"ENCRYPTION_POLICY_VIOLATION",e);const a=await this.getResponseType(o);if(a!==gH.NONE){this.logger.debug("Handling group key request",{requestId:r,responseType:a,keyEncryptionType:H_[s]}),await z$(e,this.streamRegistry,this.signatureValidator,this.config);const t=await this.identity.getUserId(),c=Fr()(await Promise.all(i.map(e=>this.store.get(e,t))),void 0);if(c.length>0){const t=await this.createResponse(c,a,o,e.getStreamPartID(),n,e.getPublisherId(),r,s);await this.networkNodeFacade.broadcast(t),this.logger.debug("Handled group key request (found keys)",{groupKeyIds:c.map(e=>e.id).join(),recipient:e.getPublisherId()})}else this.logger.debug("Handled group key request (no keys found)",{requestId:r,recipient:e.getPublisherId()})}}catch(e){this.logger.debug("Failed to handle group key request",e)}}async getResponseType(e){return e===await this.identity.getUserId()?gH.NORMAL:this.erc1271Publishers.has(e)?gH.ERC_1271:gH.NONE}async createResponse(e,t,r,n,i,s,o,a){const c=await Promise.all(e.map(async e=>({id:e.id,data:await WK.encryptForPublicKey(e.data,i,a)}))),u={recipientId:bc(s),requestId:o,groupKeys:c,encryptionType:a};return this.messageSigner.createSignedMessage({messageId:new Oq(gc.getStreamID(n),gc.getStreamPartition(n),Date.now(),0,r,m$()),content:tT.toBinary(u),contentType:$_.BINARY,messageType:Dq.GROUP_KEY_RESPONSE,encryptionType:V_.NONE},t===gH.NORMAL?this.identity.getSignatureType():W_.ERC_1271)}};wH=mH([te(l.ContainerScoped),bH(5,X(eq)),bH(6,X(Zz)),yH("design:paramtypes",[g$,jK,j$,E$,aG,tq,Object,hq,mq])],wH);class vH{pipeline;onFinally;onBeforeFinally;onError;constructor(e){this.pipeline=e??new sK,this.onFinally=this.pipeline.onFinally,this.onBeforeFinally=this.pipeline.onBeforeFinally,this.onError=this.pipeline.onError}useLegacyOnMessageHandler(e){return this.pipeline.onMessage.listen(async t=>{const r=YV(t);await e(r.content,Mx()(r,"content"))}),this.pipeline.flow(),this}async*[Symbol.asyncIterator](){for await(const e of this.pipeline)yield YV(e)}async push(e){await this.pipeline.push(e)}pipe(e){return this.pipeline.pipe(e)}async handleError(e){await this.pipeline.handleError(e)}end(e){this.pipeline.end(e)}isDone(){return this.pipeline.isDone()}return(){return this.pipeline.return()}}class EH extends vH{streamPartId;isRaw;erc1271ContractAddress;deliveryOptions;eventEmitter;logger;constructor(e,t,r,n,i,s){super(),this.streamPartId=e,this.isRaw=t,this.erc1271ContractAddress=r,this.deliveryOptions=n,this.eventEmitter=i,this.logger=s.createLogger("Subscription"),this.onError.listen(e=>{this.eventEmitter.emit("error",e),this.logger.debug("Encountered error",{err:e})})}async unsubscribe(){this.end(),await this.return(),this.eventEmitter.removeAllListeners()}on(e,t){this.eventEmitter.on(e,t)}once(e,t){this.eventEmitter.once(e,t)}off(e,t){this.eventEmitter.off(e,t)}}const AH=new Ta("waitForStorage"),SH=new Ta("StreamrClient");class kH{id;publisher;subscriber;resends;node;rpcProviderSource;streamRegistry;streamStorageRegistry;storageNodeRegistry;operatorRegistry;contractFactory;localGroupKeyStore;chainEventPoller;theGraphClient;streamIdBuilder;config;identity;eventEmitter;destroySignal;loggerFactory;proxyNodeFinder;constructor(e={},t=Q){const r=((e={})=>{let t=Kx()(e);const r=t.environment??"polygon";t=WV(r,t);const n=JV(t);return n.id??=Vq("undefined"!=typeof process&&process.pid?`${process.pid}`:qa(4),"/"),n})(e),n=function(e){if(void 0!==e.auth?.privateKey){const t=e.auth.keyType??"ECDSA_SECP256K1_EVM",r=M$.find(e=>e.keyType===t);if(r)return r.fromConfig(e);throw new Error(`Unsupported keyType given in config: ${t}`)}return void 0!==e.auth?.identity?e.auth?.identity:void 0!==e.auth?.ethereum?T$.fromConfig(e):_$.generate()}(r);!function(e,t){const r=Y$(e),n=t.encryption?.requireQuantumResistantSignatures;if(n&&!r)throw new Qz("Quantum resistant signatures are required, but the configured key type doesn't enable quantum resistance!","SIGNATURE_POLICY_VIOLATION")}(n,r),(e=>{void 0!==e.auth?.privateKey&&(e.auth.privateKey="(redacted)")})(r);const i=t.createChildContainer();i.register(eq,{useValue:n}),i.register(Zz,{useValue:r});const s=((e,t)=>{const r=new nc({serverUrl:t.contracts.theGraphUrl,fetch:(e,r)=>{const n=t._timeouts.theGraph.fetchTimeout,i=[AbortSignal.timeout(n)];r?.signal instanceof AbortSignal&&i.push(r.signal);const s=Ja(...i);try{return fetch(e,ec(r,{signal:s}))}finally{s.destroy()}},indexTimeout:t._timeouts.theGraph.indexTimeout,indexPollInterval:t._timeouts.theGraph.indexPollInterval});return e.on("contractTransactionConfirmed",e=>{null!=e.receipt&&r.updateRequiredBlockNumber(e.receipt.blockNumber)}),r})(i.resolve(hq),r);i.register(nc,{useValue:s}),this.id=r.id,this.config=r,this.identity=n,this.theGraphClient=s,this.publisher=i.resolve(zV),this.subscriber=i.resolve(X$.Subscriber),this.resends=i.resolve(X$.Resends),this.node=i.resolve(g$),this.rpcProviderSource=i.resolve(uq),this.streamRegistry=i.resolve(jK),this.streamStorageRegistry=i.resolve($K),this.storageNodeRegistry=i.resolve(Cq),this.operatorRegistry=i.resolve(lG),this.contractFactory=i.resolve(kq),this.localGroupKeyStore=i.resolve(aG),this.chainEventPoller=i.resolve(CK),this.streamIdBuilder=i.resolve(fK),this.eventEmitter=i.resolve(hq),this.destroySignal=i.resolve(cK),this.loggerFactory=i.resolve(mq),this.proxyNodeFinder=i.resolve(oH),i.resolve(wH),i.resolve(nH),i.resolve(pH)}async publish(e,t,r,n){const i=await this.publisher.publish(e,t,r,n);return this.eventEmitter.emit("messagePublished",i),YV(i)}async publishRaw(e,t){await this.node.broadcast(e,t),this.eventEmitter.emit("messagePublished",e)}async updateEncryptionKey(e){if(void 0===e.streamId)throw new Error("streamId required");const t=await this.streamIdBuilder.toStreamID(e.streamId),r=await this.publisher.getGroupKeyQueue(t);if("rotate"===e.distributionMethod)await r.rotate(e.key);else{if("rekey"!==e.distributionMethod)throw new Error(`assertion failed: distribution method ${e.distributionMethod}`);await r.rekey(e.key)}}async addEncryptionKey(e,t){await this.localGroupKeyStore.set(e.id,yc(t),e.data)}async subscribe(e,t){if(!0===e.raw&&void 0!==e.resend)throw new Error("Raw subscriptions are not supported for resend");const r=await this.streamIdBuilder.toStreamPartID(e),n=new zr,i=new EH(r,e.raw??!1,void 0!==e.erc1271Contract?ts(e.erc1271Contract):void 0,e.delivery??{},n,this.loggerFactory);return void 0!==e.resend&&((e,t,r,n,i,s,o)=>{if(e.pipe(async function*(i){try{const i=await r.resend(e.streamPartId,RV(t),n);e.onBeforeFinally.listen(async()=>{i.end(),await i.return()}),yield*i}catch(r){"NO_STORAGE_NODES"===r.code?o.createLogger("resendSubscription").warn("Skip resend (no storage assigned to stream)",{streamPartId:e.streamPartId,resendOptions:t}):await e.handleError(r)}s.emit("resendCompleted"),yield*i}),i.orderMessages){const t=new yV(e.streamPartId,n,()=>{},r,i);e.pipe(async function*(e){setImmediate(()=>{t.addMessages(e)}),yield*t}),e.onBeforeFinally.listen(()=>t.destroy())}})(i,e.resend,this.resends,e=>this.streamStorageRegistry.getStorageNodes(e),this.config,n,this.loggerFactory),await this.subscriber.add(i),void 0!==t&&i.useLegacyOnMessageHandler(t),this.eventEmitter.emit("streamPartSubscribed",void 0),i}async unsubscribe(e){if(e instanceof EH){const t=e;return this.subscriber.remove(t)}{const t=await this.getSubscriptions(e);return Promise.allSettled(t.map(e=>this.subscriber.remove(e)))}}async getSubscriptions(e){const t=void 0!==e?await this.streamIdBuilder.getMatcher(e):()=>!0;return this.subscriber.getSubscriptions().filter(e=>t(e.streamPartId))}async resend(e,t,r){const n=await this.streamIdBuilder.toStreamPartID(e),i=await this.resends.resend(n,RV(t),e=>this.streamStorageRegistry.getStorageNodes(e)),s=new vH(i);return void 0!==r&&s.useLegacyOnMessageHandler(r),s}waitForStorage(e,t){const r={interval:this.config._timeouts.storageNode.retryInterval,timeout:this.config._timeouts.storageNode.timeout,count:100};return(async(e,t,r,n)=>{if(!e)throw new Qz("waitForStorage requires a Message","INVALID_ARGUMENT");const i=t.messageMatchFn??((e,t)=>go(e.signature,t.signature)),s=Date.now();let o,a=!1;for(;!a;){const c=Date.now()-s;if(c>t.timeout)throw AH.debug("Timed out waiting for storage to contain message",{expected:e.streamMessage.messageId,lastReceived:o?.map(e=>e.messageId)}),new Error(`timed out after ${c}ms waiting for message`);const u=e=>n.getStorageNodes(e),l=await r.resend(pc(e.streamId,e.streamPartition),{last:t.count},u);o=await tc(l);for(const t of o)if(i(e,YV(t)))return a=!0,void AH.debug("Found matching message");AH.debug("Retry after delay (matching message not found)",{expected:e.streamMessage.messageId,"last-3":o.slice(-3).map(e=>e.messageId),delayInMs:t.interval}),await Ga(t.interval)}})(e,Ux()(r,t),this.resends,this.streamStorageRegistry)}async getStream(e){const t=await this.streamIdBuilder.toStreamID(e);return await this.streamRegistry.getStreamMetadata(t),new aH(t,this)}async createStream(e){const t="object"==typeof e?e:{id:e},r=await this.streamIdBuilder.toStreamID(t.id),n=Ux()({partitions:1},Mx()(t,"id"));return await this.streamRegistry.createStream(r,n),new aH(r,this)}async getOrCreateStream(e){try{return await this.getStream(e.id)}catch(t){if("STREAM_NOT_FOUND"===t.code)return this.createStream(e);throw t}}async getStreamMetadata(e){const t=await this.streamIdBuilder.toStreamID(e);return this.streamRegistry.getStreamMetadata(t)}async setStreamMetadata(e,t){const r=await this.streamIdBuilder.toStreamID(e);await this.streamRegistry.setStreamMetadata(r,t)}deleteStream(e){return this.streamRegistry.deleteStream(e)}searchStreams(e,t){if(SH.debug("Search for streams",{term:e,permissionFilter:t}),void 0===e&&void 0===t)throw new Error("Requires a search term or a permission filter");const r=this.streamRegistry.searchStreams(e,void 0!==t?(e=>({...e,userId:yc(e.userId)}))(t):void 0);return Fq(r,e=>new aH(e,this))}getStreamPublishers(e){return this.streamRegistry.getStreamPublishers(e)}getStreamSubscribers(e){return this.streamRegistry.getStreamSubscribers(e)}async hasPermission(e){return this.streamRegistry.hasPermission(await(async(e,t)=>{const r={...e,streamId:await t.toStreamID(e.streamId)};return"userId"in r?{...r,userId:yc(r.userId)}:r})(e,this.streamIdBuilder))}getPermissions(e){return this.streamRegistry.getPermissions(e)}grantPermissions(e,...t){return this.streamRegistry.grantPermissions(e,...t.map(wK))}revokePermissions(e,...t){return this.streamRegistry.revokePermissions(e,...t.map(wK))}setPermissions(...e){return this.streamRegistry.setPermissions(...e.map(e=>({...e,assignments:e.assignments.map(wK)})))}async isStreamPublisher(e,t){const r=await this.streamIdBuilder.toStreamID(e);return this.streamRegistry.isStreamPublisher(r,yc(t))}async isStreamSubscriber(e,t){const r=await this.streamIdBuilder.toStreamID(e);return this.streamRegistry.isStreamSubscriber(r,yc(t))}async addStreamToStorageNode(e,t,r={wait:!1}){const n=await this.streamIdBuilder.toStreamID(e);await(async(e,t,r,n,i,s,o,a,c)=>{if(r.wait){if(await o.isStoredStream(e,t))return;let u;try{const s=pc(dc("/assignments",ts(t)),0);u=new EH(s,!1,void 0,void 0,new zr,a),await i.add(u);const l=async function(e,t,r){const n=new Set;for await(const i of e){const e=i.content.streamPart;try{const r=gc.parse(e),[i,s]=gc.getStreamIDAndPartition(r);if(i===t.id&&s<t.partitions&&(n.add(s),n.size===t.partitions))return}catch{r.createLogger("waitForAssignmentsToPropagate").debug("Ignore malformed content")}}}(u,{id:e,partitions:n},a);await o.addStreamToStorageNode(e,t),await Va(l,r.timeout??c._timeouts.storageNode.timeout,"storage node did not respond")}finally{s.invalidatePermissionCaches(e),await(u?.unsubscribe())}}else await o.addStreamToStorageNode(e,t)})(n,ts(t),r,gK(await this.streamRegistry.getStreamMetadata(n)),this.subscriber,this.streamRegistry,this.streamStorageRegistry,this.loggerFactory,this.config)}async removeStreamFromStorageNode(e,t){return this.streamStorageRegistry.removeStreamFromStorageNode(e,ts(t))}async isStoredStream(e,t){return this.streamStorageRegistry.isStoredStream(e,ts(t))}async getStoredStreams(e){const t=await this.streamStorageRegistry.getStoredStreams(ts(e));for(const e of t.streams)this.streamRegistry.populateMetadataCache(e.id,e.metadata);return{streams:t.streams.map(e=>new aH(e.id,this)),blockNumber:t.blockNumber}}async getStorageNodes(e){return this.streamStorageRegistry.getStorageNodes(e)}setStorageNodeMetadata(e){return this.storageNodeRegistry.setStorageNodeMetadata(e)}async getStorageNodeMetadata(e){return this.storageNodeRegistry.getStorageNodeMetadata(ts(e))}getSigner(){return this.identity.getTransactionSigner(this.rpcProviderSource)}async getUserId(){return await this.identity.getUserId()}getAddress(){return this.getUserId()}getNode(){return this.node}async inspect(e,t){const r=await this.streamIdBuilder.toStreamPartID(t);return this.node.inspect(e,r)}async setProxies(e,t,r,n){const i=await this.streamIdBuilder.toStreamPartID(e);await this.node.setProxies(i,t,r,n)}async setStreamPartitionEntryPoints(e,t){const r=await this.streamIdBuilder.toStreamPartID(e);await this.node.setStreamPartEntryPoints(r,t)}connect(){return this._connect()}_connect=Xq(async()=>{await this.node.startNode()});destroy(){return this._destroy()}_destroy=Xq(async()=>{this.eventEmitter.removeAllListeners(),this._connect.reset();const e=[this.destroySignal.destroy().then(()=>{}),this.unsubscribe()];await Promise.allSettled(e),await Promise.all(e)});async getPeerDescriptor(){return Jq(await this.node.getPeerDescriptor())}async getNodeId(){return this.node.getNodeId()}async getDiagnosticInfo(){return this.node.getDiagnosticInfo()}getConfig(){return this.config}getTheGraphClient(){return this.theGraphClient}getEthersOverrides(){return lq(this.rpcProviderSource,this.config)}getOperator(e){return new lH(e,this.contractFactory,this.rpcProviderSource,this.chainEventPoller,this.theGraphClient,this.identity,this.destroySignal,this.loggerFactory,()=>this.getEthersOverrides())}async findProxyNodes(e,t=1,r=100,n=24){return this.proxyNodeFinder.find(e,t,r,n)}on(e,t){this.eventEmitter.on(e,t)}once(e,t){this.eventEmitter.once(e,t)}off(e,t){this.eventEmitter.off(e,t)}}function RH(e){const t=id(e);if(t.length>31)throw new Error("bytes32 string must be less than 32 bytes");return nu(t,32)}function PH(e){const t=$c(e,"bytes");if(32!==t.length)throw new Error("invalid bytes32 - not 32 bytes long");if(0!==t[31])throw new Error("invalid bytes32 string - no null terminator");let r=31;for(;0===t[r-1];)r--;return sd(t.slice(0,r))}ZE("1"),new Ta("operatorContractUtils");class IH{interface;bytecode;runner;constructor(e,t,r){const n=kp.from(e);t instanceof Uint8Array||("object"==typeof t&&(t=t.object),t.startsWith("0x")||(t="0x"+t)),Oc(this,{bytecode:t=Zc($c(t)),interface:n,runner:r||null})}attach(e){return new lg(e,this.interface,this.runner)}async getDeployTransaction(...e){let t={};const r=this.interface.deploy;if(r.inputs.length+1===e.length&&(t=await Yp(e.pop())),r.inputs.length!==e.length)throw new Error("incorrect number of arguments to constructor");const n=await Xp(this.runner,r.inputs,e),i=Qc([this.bytecode,this.interface.encodeDeploy(n)]);return Object.assign({},t,{data:i})}async deploy(...e){const t=await this.getDeployTransaction(...e);Fc(this.runner&&"function"==typeof this.runner.sendTransaction,"factory runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const r=await this.runner.sendTransaction(t),n=Fy(r);return new lg(n,this.interface,this.runner,r)}connect(e){return new IH(this.interface,this.bytecode,e)}static fromSolidity(e,t){Uc(null!=e,"bad compiler output","output",e),"string"==typeof e&&(e=JSON.parse(e));const r=e.abi;let n="";return e.bytecode?n=e.bytecode:e.evm&&e.evm.bytecode&&(n=e.evm.bytecode),new this(r,n,t)}}function CH(){Aw.lock(),Rl.lock(),tv.lock(),Gw.lock(),jw.lock(),eE.lock(),tE.lock(),Jm.lock(),Zm.lock(),Gw.lock()}const _H=new RegExp("^bytes([0-9]+)$"),TH=new RegExp("^(u?int)([0-9]*)$"),NH=new RegExp("^(.*)\\[([0-9]*)\\]$");function xH(e,t,r){switch(e){case"address":return $c(r?ru(t,32):Ol(t));case"string":return id(t);case"bytes":return $c(t);case"bool":return t=t?"0x01":"0x00",$c(r?ru(t,32):t)}let n=e.match(TH);if(n){let i="int"===n[1],s=parseInt(n[2]||"256");return Uc((!n[2]||n[2]===String(s))&&s%8==0&&0!==s&&s<=256,"invalid number type","type",e),r&&(s=256),i&&(t=cu(t,s)),$c(ru(yu(t),s/8))}if(n=e.match(_H),n){const i=parseInt(n[1]);return Uc(String(i)===n[1]&&0!==i&&i<=32,"invalid bytes type","type",e),Uc(Yc(t)===i,`invalid value for ${e}`,"value",t),r?$c(nu(t,32)):t}if(n=e.match(NH),n&&Array.isArray(t)){const r=n[1];Uc(parseInt(n[2]||String(t.length))===t.length,`invalid array length for ${e}`,"value",t);const i=[];return t.forEach(function(e){i.push(xH(r,e,!0))}),$c(Qc(i))}Uc(!1,"invalid type","type",e)}function OH(e,t){Uc(e.length===t.length,"wrong number of values; expected ${ types.length }","values",t);const r=[];return e.forEach(function(e,n){r.push(xH(e,t[n]))}),Zc(Qc(r))}function DH(e,t){return Rl(OH(e,t))}function MH(e,t){return Jm(OH(e,t))}const BH=new Set;function LH(e){BH.has(e)||(BH.add(e),console.log("========= NOTICE ========="),console.log(`Request-Rate Exceeded for ${e} (this message will not be repeated)`),console.log(""),console.log("The default API keys for each service are provided as a highly-throttled,"),console.log("community resource for low-traffic projects and early prototyping."),console.log(""),console.log("While your application will continue to function, we highly recommended"),console.log("signing up for your own API keys to improve performance, increase your"),console.log("request rate/limit and enable other perks, such as metrics and advanced APIs."),console.log(""),console.log("For more details: https://docs.ethers.org/api-keys/"),console.log("=========================="))}const FH="9f7d929b018cdffb338517efa06f58359e86ff1ffd350bc889738523659e7972";class UH extends Vb{apiKey;constructor(e,t){null==e&&(e="mainnet");const r=nb.from(e);null==t&&(t=FH);const n={polling:!0,staticNetwork:r};super(UH.getRequest(r,t),r,n),Oc(this,{apiKey:t})}_getProvider(e){try{return new UH(e,this.apiKey)}catch(e){}return super._getProvider(e)}static getRequest(e,t){null==t&&(t=FH);const r=new pp(`https://${function(e){switch(e){case"mainnet":return"rpc.ankr.com/eth";case"goerli":return"rpc.ankr.com/eth_goerli";case"sepolia":return"rpc.ankr.com/eth_sepolia";case"arbitrum":return"rpc.ankr.com/arbitrum";case"base":return"rpc.ankr.com/base";case"base-goerli":return"rpc.ankr.com/base_goerli";case"base-sepolia":return"rpc.ankr.com/base_sepolia";case"bnb":return"rpc.ankr.com/bsc";case"bnbt":return"rpc.ankr.com/bsc_testnet_chapel";case"filecoin":return"rpc.ankr.com/filecoin";case"filecoin-calibration":return"rpc.ankr.com/filecoin_testnet";case"matic":return"rpc.ankr.com/polygon";case"matic-mumbai":return"rpc.ankr.com/polygon_mumbai";case"optimism":return"rpc.ankr.com/optimism";case"optimism-goerli":return"rpc.ankr.com/optimism_testnet";case"optimism-sepolia":return"rpc.ankr.com/optimism_sepolia"}Uc(!1,"unsupported network","network",e)}(e.name)}/${t}`);return r.allowGzip=!0,t===FH&&(r.retryFunc=async(e,t,r)=>(LH("AnkrProvider"),!0)),r}getRpcError(e,t){return"eth_sendRawTransaction"===e.method&&t&&t.error&&"INTERNAL_ERROR: could not replace existing tx"===t.error.message&&(t.error.message="replacement transaction underpriced"),super.getRpcError(e,t)}isCommunityResource(){return this.apiKey===FH}}const jH="_gg7wSSi0KMBsdKnGVfHDueq6xMB9EkC";class zH extends Vb{apiKey;constructor(e,t){null==e&&(e="mainnet");const r=nb.from(e);null==t&&(t=jH),super(zH.getRequest(r,t),r,{staticNetwork:r}),Oc(this,{apiKey:t})}_getProvider(e){try{return new zH(e,this.apiKey)}catch(e){}return super._getProvider(e)}async _perform(e){if("getTransactionResult"===e.method){const{trace:t,tx:r}=await xc({trace:this.send("trace_transaction",[e.hash]),tx:this.getTransaction(e.hash)});if(null==t||null==r)return null;let n,i=!1;try{n=t[0].result.output,i="Reverted"===t[0].error}catch(e){}if(n)return Fc(!i,"an error occurred during transaction executions","CALL_EXCEPTION",{action:"getTransactionResult",data:n,reason:null,transaction:r,invocation:null,revert:null}),n;Fc(!1,"could not parse trace result","BAD_DATA",{value:t})}return await super._perform(e)}isCommunityResource(){return this.apiKey===jH}static getRequest(e,t){null==t&&(t=jH);const r=new pp(`https://${function(e){switch(e){case"mainnet":return"eth-mainnet.g.alchemy.com";case"goerli":return"eth-goerli.g.alchemy.com";case"sepolia":return"eth-sepolia.g.alchemy.com";case"arbitrum":return"arb-mainnet.g.alchemy.com";case"arbitrum-goerli":return"arb-goerli.g.alchemy.com";case"arbitrum-sepolia":return"arb-sepolia.g.alchemy.com";case"base":return"base-mainnet.g.alchemy.com";case"base-goerli":return"base-goerli.g.alchemy.com";case"base-sepolia":return"base-sepolia.g.alchemy.com";case"matic":return"polygon-mainnet.g.alchemy.com";case"matic-amoy":return"polygon-amoy.g.alchemy.com";case"matic-mumbai":return"polygon-mumbai.g.alchemy.com";case"optimism":return"opt-mainnet.g.alchemy.com";case"optimism-goerli":return"opt-goerli.g.alchemy.com";case"optimism-sepolia":return"opt-sepolia.g.alchemy.com"}Uc(!1,"unsupported network","network",e)}(e.name)}/v2/${t}`);return r.allowGzip=!0,t===jH&&(r.retryFunc=async(e,t,r)=>(LH("alchemy"),!0)),r}}function qH(e){switch(e){case"mainnet":return"39f1d67cedf8b7831010a665328c9197";case"arbitrum":return"0550c209db33c3abf4cc927e1e18cea1";case"bnb":return"98b5a77e531614387366f6fc5da097f8";case"matic":return"cd9d4d70377471aa7c142ec4a4205249"}Uc(!1,"unsupported network","network",e)}class KH extends Vb{apiKey;constructor(e,t){null==e&&(e="mainnet");const r=nb.from(e);null==t&&(t=qH(r.name)),super(KH.getRequest(r,t),r,{staticNetwork:r}),Oc(this,{apiKey:t})}_getProvider(e){try{return new KH(e,this.apiKey)}catch(e){}return super._getProvider(e)}isCommunityResource(){return this.apiKey===qH(this._network.name)}static getRequest(e,t){null==t&&(t=qH(e.name));const r=new pp(`https://${function(e){switch(e){case"mainnet":return"ethereum-mainnet.core.chainstack.com";case"arbitrum":return"arbitrum-mainnet.core.chainstack.com";case"bnb":return"bsc-mainnet.core.chainstack.com";case"matic":return"polygon-mainnet.core.chainstack.com"}Uc(!1,"unsupported network","network",e)}(e.name)}/${t}`);return r.allowGzip=!0,t===qH(e.name)&&(r.retryFunc=async(e,t,r)=>(LH("ChainstackProvider"),!0)),r}}class GH extends Vb{constructor(e){null==e&&(e="mainnet");const t=nb.from(e);Uc("mainnet"===t.name,"unsupported network","network",e),super("https://cloudflare-eth.com/",t,{staticNetwork:t})}}const $H="1 11155111 17000 560048 2741 11124 33111 33139 42170 42161 421614 43114 43113 8453 84532 80069 80094 199 1029 81457 168587773 56 97 42220 11142220 252 2523 100 999 737373 747474 59144 59141 5000 5003 43521 143 10143 1287 1284 1285 10 11155420 204 5611 80002 137 534352 534351 1329 1328 146 14601 988 2201 1923 1924 167013 167000 130 1301 480 4801 51 50 324 300".split(/ /g),VH="org.ethers.plugins.provider.Etherscan";class HH extends Qy{baseUrl;constructor(e){super(VH),Oc(this,{baseUrl:e})}clone(){return new HH(this.baseUrl)}}const WH=["enableCcipRead"];let JH=1;class ZH extends Ab{network;apiKey;#Tr;constructor(e,t){const r=null!=t?t:null;super();const n=nb.from(e);Uc($H.indexOf(`${n.chainId}`)>=0,"unsupported network","network",n),this.#Tr=n.getPlugin(VH),Oc(this,{apiKey:r,network:n})}getBaseUrl(){if(this.#Tr)return this.#Tr.baseUrl;switch(this.network.name){case"mainnet":return"https://api.etherscan.io";case"goerli":return"https://api-goerli.etherscan.io";case"sepolia":return"https://api-sepolia.etherscan.io";case"holesky":return"https://api-holesky.etherscan.io";case"arbitrum":return"https://api.arbiscan.io";case"arbitrum-goerli":return"https://api-goerli.arbiscan.io";case"base":return"https://api.basescan.org";case"base-sepolia":return"https://api-sepolia.basescan.org";case"bnb":return"https://api.bscscan.com";case"bnbt":return"https://api-testnet.bscscan.com";case"matic":return"https://api.polygonscan.com";case"matic-amoy":return"https://api-amoy.polygonscan.com";case"matic-mumbai":return"https://api-testnet.polygonscan.com";case"optimism":return"https://api-optimistic.etherscan.io";case"optimism-goerli":return"https://api-goerli-optimistic.etherscan.io"}Uc(!1,"unsupported network","network",this.network)}getUrl(e,t){let r=Object.keys(t).reduce((e,r)=>{const n=t[r];return null!=n&&(e+=`&${r}=${n}`),e},"");return this.apiKey&&(r+=`&apikey=${this.apiKey}`),`https://api.etherscan.io/v2/api?chainid=${this.network.chainId}&module=${e}${r}`}getPostUrl(){return`https://api.etherscan.io/v2/api?chainid=${this.network.chainId}`}getPostData(e,t){return t.module=e,t.apikey=this.apiKey,t.chainid=this.network.chainId,t}async detectNetwork(){return this.network}async fetch(e,t,r){const n=JH++,i=r?this.getPostUrl():this.getUrl(e,t),s=r?this.getPostData(e,t):null;this.emit("debug",{action:"sendRequest",id:n,url:i,payload:s});const o=new pp(i);o.setThrottleParams({slotInterval:1e3}),o.retryFunc=(e,t,r)=>(this.isCommunityResource()&&LH("Etherscan"),Promise.resolve(!0)),o.processFunc=async(t,r)=>{const i=r.hasBody()?JSON.parse(sd(r.body)):{},s=("string"==typeof i.result?i.result:"").toLowerCase().indexOf("rate limit")>=0;return"proxy"===e?i&&0==i.status&&"NOTOK"==i.message&&s&&(this.emit("debug",{action:"receiveError",id:n,reason:"proxy-NOTOK",error:i}),r.throwThrottleError(i.result,2e3)):s&&(this.emit("debug",{action:"receiveError",id:n,reason:"null result",error:i.result}),r.throwThrottleError(i.result,2e3)),r},s&&(o.setHeader("content-type","application/x-www-form-urlencoded; charset=UTF-8"),o.body=Object.keys(s).map(e=>`${e}=${s[e]}`).join("&"));const a=await o.send();try{a.assertOk()}catch(e){this.emit("debug",{action:"receiveError",id:n,error:e,reason:"assertOk"}),Fc(!1,"response error","SERVER_ERROR",{request:o,response:a})}a.hasBody()||(this.emit("debug",{action:"receiveError",id:n,error:"missing body",reason:"null body"}),Fc(!1,"missing response","SERVER_ERROR",{request:o,response:a}));const c=JSON.parse(sd(a.body));return"proxy"===e?("2.0"!=c.jsonrpc&&(this.emit("debug",{action:"receiveError",id:n,result:c,reason:"invalid JSON-RPC"}),Fc(!1,"invalid JSON-RPC response (missing jsonrpc='2.0')","SERVER_ERROR",{request:o,response:a,info:{result:c}})),c.error&&(this.emit("debug",{action:"receiveError",id:n,result:c,reason:"JSON-RPC error"}),Fc(!1,"error response","SERVER_ERROR",{request:o,response:a,info:{result:c}})),this.emit("debug",{action:"receiveRequest",id:n,result:c}),c.result):0!=c.status||"No records found"!==c.message&&"No transactions found"!==c.message?((1!=c.status||"string"==typeof c.message&&!c.message.match(/^OK/))&&(this.emit("debug",{action:"receiveError",id:n,result:c}),Fc(!1,"error response","SERVER_ERROR",{request:o,response:a,info:{result:c}})),this.emit("debug",{action:"receiveRequest",id:n,result:c}),c.result):(this.emit("debug",{action:"receiveRequest",id:n,result:c}),c.result)}_getTransactionPostData(e){const t={};for(let r in e){if(WH.indexOf(r)>=0)continue;if(null==e[r])continue;let n=e[r];if(!("type"===r&&0===n||"blockTag"===r&&"latest"===n)){if({type:!0,gasLimit:!0,gasPrice:!0,maxFeePerGs:!0,maxPriorityFeePerGas:!0,nonce:!0,value:!0}[r])n=bu(n);else if("accessList"===r)n="["+Xf(n).map(e=>`{address:"${e.address}",storageKeys:["${e.storageKeys.join('","')}"]}`).join(",")+"]";else if("blobVersionedHashes"===r){if(0===n.length)continue;Fc(!1,"Etherscan API does not support blobVersionedHashes","UNSUPPORTED_OPERATION",{operation:"_getTransactionPostData",info:{transaction:e}})}else n=Zc(n);t[r]=n}}return t}_checkError(e,t,r){let n="";if(Mc(t,"SERVER_ERROR")){try{n=t.info.result.error.message}catch(e){}if(!n)try{n=t.info.message}catch(e){}}if("estimateGas"===e.method&&!n.match(/revert/i)&&n.match(/insufficient funds/i)&&Fc(!1,"insufficient funds","INSUFFICIENT_FUNDS",{transaction:e.transaction}),("call"===e.method||"estimateGas"===e.method)&&n.match(/execution reverted/i)){let r="";try{r=t.info.result.error.data}catch(t){}const n=oh.getBuiltinCallException(e.method,e.transaction,r);throw n.info={request:e,error:t},n}if(n&&"broadcastTransaction"===e.method){const t=Ry.from(e.signedTransaction);n.match(/replacement/i)&&n.match(/underpriced/i)&&Fc(!1,"replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:t}),n.match(/insufficient funds/)&&Fc(!1,"insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:t}),n.match(/same hash was already imported|transaction nonce is too low|nonce too low/)&&Fc(!1,"nonce has already been used","NONCE_EXPIRED",{transaction:t})}throw t}async _detectNetwork(){return this.network}async _perform(e){switch(e.method){case"chainId":return this.network.chainId;case"getBlockNumber":return this.fetch("proxy",{action:"eth_blockNumber"});case"getGasPrice":return this.fetch("proxy",{action:"eth_gasPrice"});case"getPriorityFee":if("mainnet"===this.network.name)return"1000000000";if("optimism"===this.network.name)return"1000000";throw new Error("fallback onto the AbstractProvider default");case"getBalance":return this.fetch("account",{action:"balance",address:e.address,tag:e.blockTag});case"getTransactionCount":return this.fetch("proxy",{action:"eth_getTransactionCount",address:e.address,tag:e.blockTag});case"getCode":return this.fetch("proxy",{action:"eth_getCode",address:e.address,tag:e.blockTag});case"getStorage":return this.fetch("proxy",{action:"eth_getStorageAt",address:e.address,position:e.position,tag:e.blockTag});case"broadcastTransaction":return this.fetch("proxy",{action:"eth_sendRawTransaction",hex:e.signedTransaction},!0).catch(t=>this._checkError(e,t,e.signedTransaction));case"getBlock":if("blockTag"in e)return this.fetch("proxy",{action:"eth_getBlockByNumber",tag:e.blockTag,boolean:e.includeTransactions?"true":"false"});Fc(!1,"getBlock by blockHash not supported by Etherscan","UNSUPPORTED_OPERATION",{operation:"getBlock(blockHash)"});case"getTransaction":return this.fetch("proxy",{action:"eth_getTransactionByHash",txhash:e.hash});case"getTransactionReceipt":return this.fetch("proxy",{action:"eth_getTransactionReceipt",txhash:e.hash});case"call":{if("latest"!==e.blockTag)throw new Error("EtherscanProvider does not support blockTag for call");const t=this._getTransactionPostData(e.transaction);t.module="proxy",t.action="eth_call";try{return await this.fetch("proxy",t,!0)}catch(t){return this._checkError(e,t,e.transaction)}}case"estimateGas":{const t=this._getTransactionPostData(e.transaction);t.module="proxy",t.action="eth_estimateGas";try{return await this.fetch("proxy",t,!0)}catch(t){return this._checkError(e,t,e.transaction)}}}return super._perform(e)}async getNetwork(){return this.network}async getEtherPrice(){return"mainnet"!==this.network.name?0:parseFloat((await this.fetch("stats",{action:"ethprice"})).ethusd)}async getContract(e){let t=this._getAddress(e);var r;(r=t)&&"function"==typeof r.then&&(t=await t);try{const e=await this.fetch("contract",{action:"getabi",address:t}),r=JSON.parse(e);return new dg(t,r,this)}catch(e){return null}}isCommunityResource(){return null==this.apiKey}}const QH=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}().WebSocket;class YH{#Te;#ne;get filter(){return JSON.parse(this.#ne)}#Nr;#xr;#Or;constructor(e,t){this.#Te=e,this.#ne=JSON.stringify(t),this.#Nr=null,this.#xr=null,this.#Or=null}start(){this.#Nr=this.#Te.send("eth_subscribe",this.filter).then(e=>(this.#Te._register(e,this),e))}stop(){this.#Nr.then(e=>{this.#Te.destroyed||this.#Te.send("eth_unsubscribe",[e])}),this.#Nr=null}pause(e){Fc(e,"preserve logs while paused not supported by SocketSubscriber yet","UNSUPPORTED_OPERATION",{operation:"pause(false)"}),this.#xr=!!e}resume(){this.#xr=null}_handleMessage(e){if(null!=this.#Nr&&null===this.#xr){let t=this.#Or;t=null==t?this._emit(this.#Te,e):t.then(async()=>{await this._emit(this.#Te,e)}),this.#Or=t.then(()=>{this.#Or===t&&(this.#Or=null)})}}async _emit(e,t){throw new Error("sub-classes must implemente this; _emit")}}class XH extends YH{constructor(e){super(e,["newHeads"])}async _emit(e,t){e.emit("block",parseInt(t.number))}}class eW extends YH{constructor(e){super(e,["newPendingTransactions"])}async _emit(e,t){e.emit("pending",t)}}class tW extends YH{#Dr;get logFilter(){return JSON.parse(this.#Dr)}constructor(e,t){super(e,["logs",t]),this.#Dr=JSON.stringify(t)}async _emit(e,t){e.emit(this.logFilter,e._wrapLog(t,e._network))}}class rW extends Gb{#Mr;#Ue;#Br;constructor(e,t){const r=Object.assign({},null!=t?t:{});Uc(null==r.batchMaxCount||1===r.batchMaxCount,"sockets-based providers do not support batches","options.batchMaxCount",t),r.batchMaxCount=1,null==r.staticNetwork&&(r.staticNetwork=!0),super(e,r),this.#Mr=new Map,this.#Ue=new Map,this.#Br=new Map}_getSubscriber(e){switch(e.type){case"close":return new yb("close");case"block":return new XH(this);case"pending":return new eW(this);case"event":return new tW(this,e.filter);case"orphan":if("drop-log"===e.filter.orphan)return new yb("drop-log")}return super._getSubscriber(e)}_register(e,t){this.#Ue.set(e,t);const r=this.#Br.get(e);if(r){for(const e of r)t._handleMessage(e);this.#Br.delete(e)}}async _send(e){Uc(!Array.isArray(e),"WebSocket does not support batch send","payload",e);const t=new Promise((t,r)=>{this.#Mr.set(e.id,{payload:e,resolve:t,reject:r})});return await this._waitUntilReady(),await this._write(JSON.stringify(e)),[await t]}async _processMessage(e){const t=JSON.parse(e);if(t&&"object"==typeof t&&"id"in t){const e=this.#Mr.get(t.id);if(null==e)return void this.emit("error",Lc("received result for unknown id","UNKNOWN_ERROR",{reasonCode:"UNKNOWN_ID",result:t}));this.#Mr.delete(t.id),e.resolve(t)}else{if(!t||"eth_subscription"!==t.method)return void this.emit("error",Lc("received unexpected message","UNKNOWN_ERROR",{reasonCode:"UNEXPECTED_MESSAGE",result:t}));{const e=t.params.subscription,r=this.#Ue.get(e);if(r)r._handleMessage(t.params.result);else{let r=this.#Br.get(e);null==r&&(r=[],this.#Br.set(e,r)),r.push(t.params.result)}}}}async _write(e){throw new Error("sub-classes must override this")}}class nW extends rW{#gt;#Lr;get websocket(){if(null==this.#Lr)throw new Error("websocket closed");return this.#Lr}constructor(e,t,r){super(t,r),"string"==typeof e?(this.#gt=()=>new QH(e),this.#Lr=this.#gt()):"function"==typeof e?(this.#gt=e,this.#Lr=e()):(this.#gt=null,this.#Lr=e),this.websocket.onopen=async()=>{try{await this._start(),this.resume()}catch(e){console.log("failed to start WebsocketProvider",e)}},this.websocket.onmessage=e=>{this._processMessage(e.data)}}async _write(e){this.websocket.send(e)}async destroy(){null!=this.#Lr&&(this.#Lr.close(),this.#Lr=null),super.destroy()}}const iW="84842078b09946638c03157f83405213";class sW extends nW{projectId;projectSecret;constructor(e,t){const r=new oW(e,t),n=r._getConnection();Fc(!n.credentials,"INFURA WebSocket project secrets unsupported","UNSUPPORTED_OPERATION",{operation:"InfuraProvider.getWebSocketProvider()"}),super(n.url.replace(/^http/i,"ws").replace("/v3/","/ws/v3/"),r._network),Oc(this,{projectId:r.projectId,projectSecret:r.projectSecret})}isCommunityResource(){return this.projectId===iW}}class oW extends Vb{projectId;projectSecret;constructor(e,t,r){null==e&&(e="mainnet");const n=nb.from(e);null==t&&(t=iW),null==r&&(r=null),super(oW.getRequest(n,t,r),n,{staticNetwork:n}),Oc(this,{projectId:t,projectSecret:r})}_getProvider(e){try{return new oW(e,this.projectId,this.projectSecret)}catch(e){}return super._getProvider(e)}isCommunityResource(){return this.projectId===iW}static getWebSocketProvider(e,t){return new sW(e,t)}static getRequest(e,t,r){null==t&&(t=iW),null==r&&(r=null);const n=new pp(`https://${function(e){switch(e){case"mainnet":return"mainnet.infura.io";case"goerli":return"goerli.infura.io";case"sepolia":return"sepolia.infura.io";case"arbitrum":return"arbitrum-mainnet.infura.io";case"arbitrum-goerli":return"arbitrum-goerli.infura.io";case"arbitrum-sepolia":return"arbitrum-sepolia.infura.io";case"base":return"base-mainnet.infura.io";case"base-goerlia":case"base-goerli":return"base-goerli.infura.io";case"base-sepolia":return"base-sepolia.infura.io";case"bnb":return"bsc-mainnet.infura.io";case"bnbt":return"bsc-testnet.infura.io";case"linea":return"linea-mainnet.infura.io";case"linea-goerli":return"linea-goerli.infura.io";case"linea-sepolia":return"linea-sepolia.infura.io";case"matic":return"polygon-mainnet.infura.io";case"matic-amoy":return"polygon-amoy.infura.io";case"matic-mumbai":return"polygon-mumbai.infura.io";case"optimism":return"optimism-mainnet.infura.io";case"optimism-goerli":return"optimism-goerli.infura.io";case"optimism-sepolia":return"optimism-sepolia.infura.io"}Uc(!1,"unsupported network","network",e)}(e.name)}/v3/${t}`);return n.allowGzip=!0,r&&n.setCredentials("",r),t===iW&&(n.retryFunc=async(e,t,r)=>(LH("InfuraProvider"),!0)),n}}const aW="919b412a057b5e9c9b6dce193c5a60242d6efadb";class cW extends Vb{token;constructor(e,t){null==e&&(e="mainnet");const r=nb.from(e);null==t&&(t=aW),super(cW.getRequest(r,t),r,{staticNetwork:r}),Oc(this,{token:t})}_getProvider(e){try{return new cW(e,this.token)}catch(e){}return super._getProvider(e)}isCommunityResource(){return this.token===aW}static getRequest(e,t){null==t&&(t=aW);const r=new pp(`https://${function(e){switch(e){case"mainnet":return"ethers.quiknode.pro";case"goerli":return"ethers.ethereum-goerli.quiknode.pro";case"sepolia":return"ethers.ethereum-sepolia.quiknode.pro";case"holesky":return"ethers.ethereum-holesky.quiknode.pro";case"arbitrum":return"ethers.arbitrum-mainnet.quiknode.pro";case"arbitrum-goerli":return"ethers.arbitrum-goerli.quiknode.pro";case"arbitrum-sepolia":return"ethers.arbitrum-sepolia.quiknode.pro";case"base":return"ethers.base-mainnet.quiknode.pro";case"base-goerli":return"ethers.base-goerli.quiknode.pro";case"base-spolia":return"ethers.base-sepolia.quiknode.pro";case"bnb":return"ethers.bsc.quiknode.pro";case"bnbt":return"ethers.bsc-testnet.quiknode.pro";case"matic":return"ethers.matic.quiknode.pro";case"matic-mumbai":return"ethers.matic-testnet.quiknode.pro";case"optimism":return"ethers.optimism.quiknode.pro";case"optimism-goerli":return"ethers.optimism-goerli.quiknode.pro";case"optimism-sepolia":return"ethers.optimism-sepolia.quiknode.pro";case"xdai":return"ethers.xdai.quiknode.pro"}Uc(!1,"unsupported network","network",e)}(e.name)}/${t}`);return r.allowGzip=!0,t===aW&&(r.retryFunc=async(e,t,r)=>(LH("QuickNodeProvider"),!0)),r}}const uW="goerli kovan sepolia classicKotti optimism-goerli arbitrum-goerli matic-mumbai bnbt".split(" ");function lW(e,t){null==t&&(t={});const r=e=>"-"!==t[e]&&("string"==typeof t.exclusive?e===t.exclusive:!Array.isArray(t.exclusive)||-1!==t.exclusive.indexOf(e));if("string"==typeof e&&e.match(/^https?:/))return new Vb(e);if("string"==typeof e&&e.match(/^wss?:/)||(n=e)&&"function"==typeof n.send&&"function"==typeof n.close)return new nW(e);var n;let i=null;try{i=nb.from(e)}catch(e){}const s=[];if(r("publicPolygon")&&i&&("matic"===i.name?s.push(new Vb("https://polygon-rpc.com/",i,{staticNetwork:i})):"matic-amoy"===i.name&&s.push(new Vb("https://rpc-amoy.polygon.technology/",i,{staticNetwork:i}))),r("alchemy"))try{s.push(new zH(e,t.alchemy))}catch(e){}if(r("ankr")&&null!=t.ankr)try{s.push(new UH(e,t.ankr))}catch(e){}if(r("chainstack"))try{s.push(new KH(e,t.chainstack))}catch(e){}if(r("cloudflare"))try{s.push(new GH(e))}catch(e){}if(r("etherscan"))try{s.push(new ZH(e,t.etherscan))}catch(e){}if(r("infura"))try{let r,n=t.infura;"object"==typeof n&&(r=n.projectSecret,n=n.projectId),s.push(new oW(e,n,r))}catch(e){}if(r("quicknode"))try{let r=t.quicknode;s.push(new cW(e,r))}catch(e){}if(Fc(s.length,"unsupported default network","UNSUPPORTED_OPERATION",{operation:"getDefaultProvider"}),1===s.length)return s[0];let o=Math.floor(s.length/2);return o>2&&(o=2),i&&-1!==uW.indexOf(i.name)&&(o=1),t&&t.quorum&&(o=t.quorum),new ow(s,void 0,{quorum:o})}class dW extends xb{signer;#Fr;#Ur;constructor(e){super(e.provider),Oc(this,{signer:e}),this.#Fr=null,this.#Ur=0}async getAddress(){return this.signer.getAddress()}connect(e){return new dW(this.signer.connect(e))}async getNonce(e){if("pending"===e){null==this.#Fr&&(this.#Fr=super.getNonce("pending"));const e=this.#Ur;return await this.#Fr+e}return super.getNonce(e)}increment(){this.#Ur++}reset(){this.#Ur=0,this.#Fr=null}async sendTransaction(e){const t=this.getNonce("pending");return this.increment(),(e=await this.signer.populateTransaction(e)).nonce=await t,await this.signer.sendTransaction(e)}signTransaction(e){return this.signer.signTransaction(e)}signMessage(e){return this.signer.signMessage(e)}signTypedData(e,t,r){return this.signer.signTypedData(e,t,r)}}class hW extends Vb{apiKey;constructor(e,t){null==e&&(e="mainnet");const r=nb.from(e);null==t&&(t=null),super(hW.getRequest(r),r,{staticNetwork:r}),Oc(this,{apiKey:t})}_getProvider(e){try{return new hW(e,this.apiKey)}catch(e){}return super._getProvider(e)}isCommunityResource(){return null===this.apiKey}getRpcRequest(e){const t=super.getRpcRequest(e);return t&&"eth_estimateGas"===t.method&&1==t.args.length&&(t.args=t.args.slice(),t.args.push("latest")),t}getRpcError(e,t){const r=t?t.error:null;if(r&&-32015===r.code&&!Hc(r.data||"",!0)){const e={"assert(false)":"01","arithmetic underflow or overflow":"11","division or modulo by zero":"12","out-of-bounds array access; popping on an empty array":"31","out-of-bounds access of an array or bytesN":"32"};let t="";"VM execution error."===r.message?t=e[r.data]||"":e[r.message||""]&&(t=e[r.message||""]),t&&(r.message+=` (reverted: ${r.data})`,r.data="0x4e487b7100000000000000000000000000000000000000000000000000000000000000"+t)}else r&&-32e3===r.code&&"wrong transaction nonce"===r.message&&(r.message+=" (nonce too low)");return super.getRpcError(e,t)}static getRequest(e){const t=new pp(function(e){switch(e){case"mainnet":return"https://eth.blockscout.com/api/eth-rpc";case"sepolia":return"https://eth-sepolia.blockscout.com/api/eth-rpc";case"holesky":return"https://eth-holesky.blockscout.com/api/eth-rpc";case"classic":return"https://etc.blockscout.com/api/eth-rpc";case"arbitrum":return"https://arbitrum.blockscout.com/api/eth-rpc";case"base":return"https://base.blockscout.com/api/eth-rpc";case"base-sepolia":return"https://base-sepolia.blockscout.com/api/eth-rpc";case"matic":return"https://polygon.blockscout.com/api/eth-rpc";case"optimism":return"https://optimism.blockscout.com/api/eth-rpc";case"optimism-sepolia":return"https://optimism-sepolia.blockscout.com/api/eth-rpc";case"xdai":return"https://gnosis.blockscout.com/api/eth-rpc"}Uc(!1,"unsupported network","network",e)}(e.name));return t.allowGzip=!0,t}}const fW="62e1ad51b37b8e00394bda3b";class pW extends Vb{applicationId;applicationSecret;constructor(e,t,r){null==e&&(e="mainnet");const n=nb.from(e);null==t&&(t=fW),null==r&&(r=null);const i={staticNetwork:n};super(pW.getRequest(n,t,r),n,i),Oc(this,{applicationId:t,applicationSecret:r})}_getProvider(e){try{return new pW(e,this.applicationId,this.applicationSecret)}catch(e){}return super._getProvider(e)}static getRequest(e,t,r){null==t&&(t=fW);const n=new pp(`https://${function(e){switch(e){case"mainnet":return"eth-mainnet.gateway.pokt.network";case"goerli":return"eth-goerli.gateway.pokt.network";case"matic":return"poly-mainnet.gateway.pokt.network";case"matic-mumbai":return"polygon-mumbai-rpc.gateway.pokt.network"}Uc(!1,"unsupported network","network",e)}(e.name)}/v1/lb/${t}`);return n.allowGzip=!0,r&&n.setCredentials("",r),t===fW&&(n.retryFunc=async(e,t,r)=>(LH("PocketProvider"),!0)),n}isCommunityResource(){return this.applicationId===fW}}const gW=void 0;class mW extends Jw{#jr;constructor(e,t,r,n){super(e,t,n),this.#jr=r}get _accent(){return this.#jr}_decodeWords(){return function(e,t){let r=Hw(e).join(",");return t.split(/,/g).forEach(e=>{const n=e.match(/^([a-z]*)([0-9]+)([0-9])(.*)$/);Uc(null!==n,"internal error parsing accents","accents",t);let i=0;const s=function(e,t){const r=(1<<e)-1,n=[];let i=0,s=0,o=0;for(let a=0;a<t.length;a++)for(i=i<<6|")!@#$%^&*(ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".indexOf(t[a]),s+=6;s>=e;){const t=i>>s-e;i&=(1<<s-e)-1,s-=e,0===t?o+=r:(n.push(t+o),o=0)}return n}(parseInt(n[3]),n[4]),o=parseInt(n[2]),a=new RegExp(`([${n[1]}])`,"g");r=r.replace(a,(e,t)=>(0===--s[i]&&(t=String.fromCharCode(t.charCodeAt(0),o),i++),t))}),r.split(",")}(this._data,this._accent)}}const yW={en:Qw.wordlist()};var bW=r(7583);"undefined"!=typeof window&&(window.StreamrClient=kH,window.StreamPermission=mK,window.STREAMR_STORAGE_NODE_GERMANY=Jz,window.ethers=u,window.QRCode=bW)})(),n})());